(function(){"use strict";function S0(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Gw={exports:{}},_p={},Vw={exports:{}},ft={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ah=Symbol.for("react.element"),mU=Symbol.for("react.portal"),gU=Symbol.for("react.fragment"),_U=Symbol.for("react.strict_mode"),vU=Symbol.for("react.profiler"),yU=Symbol.for("react.provider"),xU=Symbol.for("react.context"),SU=Symbol.for("react.forward_ref"),TU=Symbol.for("react.suspense"),bU=Symbol.for("react.memo"),wU=Symbol.for("react.lazy"),Hw=Symbol.iterator;function MU(n){return n===null||typeof n!="object"?null:(n=Hw&&n[Hw]||n["@@iterator"],typeof n=="function"?n:null)}var Ww={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},$w=Object.assign,jw={};function du(n,e,t){this.props=n,this.context=e,this.refs=jw,this.updater=t||Ww}du.prototype.isReactComponent={},du.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")},du.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function Xw(){}Xw.prototype=du.prototype;function T0(n,e,t){this.props=n,this.context=e,this.refs=jw,this.updater=t||Ww}var b0=T0.prototype=new Xw;b0.constructor=T0,$w(b0,du.prototype),b0.isPureReactComponent=!0;var qw=Array.isArray,Yw=Object.prototype.hasOwnProperty,w0={current:null},Kw={key:!0,ref:!0,__self:!0,__source:!0};function Qw(n,e,t){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)Yw.call(e,i)&&!Kw.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=t;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];r.children=l}if(n&&n.defaultProps)for(i in a=n.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:Ah,type:n,key:s,ref:o,props:r,_owner:w0.current}}function EU(n,e){return{$$typeof:Ah,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function M0(n){return typeof n=="object"&&n!==null&&n.$$typeof===Ah}function AU(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var Zw=/\/+/g;function E0(n,e){return typeof n=="object"&&n!==null&&n.key!=null?AU(""+n.key):e.toString(36)}function vp(n,e,t,i,r){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case Ah:case mU:o=!0}}if(o)return o=n,r=r(o),n=i===""?"."+E0(o,0):i,qw(r)?(t="",n!=null&&(t=n.replace(Zw,"$&/")+"/"),vp(r,e,t,"",function(u){return u})):r!=null&&(M0(r)&&(r=EU(r,t+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(Zw,"$&/")+"/")+n)),e.push(r)),1;if(o=0,i=i===""?".":i+":",qw(n))for(var a=0;a<n.length;a++){s=n[a];var l=i+E0(s,a);o+=vp(s,e,t,l,r)}else if(l=MU(n),typeof l=="function")for(n=l.call(n),a=0;!(s=n.next()).done;)s=s.value,l=i+E0(s,a++),o+=vp(s,e,t,l,r);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function yp(n,e,t){if(n==null)return n;var i=[],r=0;return vp(n,i,"","",function(s){return e.call(t,s,r++)}),i}function CU(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var vi={current:null},xp={transition:null},RU={ReactCurrentDispatcher:vi,ReactCurrentBatchConfig:xp,ReactCurrentOwner:w0};function Jw(){throw Error("act(...) is not supported in production builds of React.")}ft.Children={map:yp,forEach:function(n,e,t){yp(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return yp(n,function(){e++}),e},toArray:function(n){return yp(n,function(e){return e})||[]},only:function(n){if(!M0(n))throw Error("React.Children.only expected to receive a single React element child.");return n}},ft.Component=du,ft.Fragment=gU,ft.Profiler=vU,ft.PureComponent=T0,ft.StrictMode=_U,ft.Suspense=TU,ft.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=RU,ft.act=Jw,ft.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var i=$w({},n.props),r=n.key,s=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=w0.current),e.key!==void 0&&(r=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)Yw.call(e,l)&&!Kw.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=t;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];i.children=a}return{$$typeof:Ah,type:n.type,key:r,ref:s,props:i,_owner:o}},ft.createContext=function(n){return n={$$typeof:xU,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:yU,_context:n},n.Consumer=n},ft.createElement=Qw,ft.createFactory=function(n){var e=Qw.bind(null,n);return e.type=n,e},ft.createRef=function(){return{current:null}},ft.forwardRef=function(n){return{$$typeof:SU,render:n}},ft.isValidElement=M0,ft.lazy=function(n){return{$$typeof:wU,_payload:{_status:-1,_result:n},_init:CU}},ft.memo=function(n,e){return{$$typeof:bU,type:n,compare:e===void 0?null:e}},ft.startTransition=function(n){var e=xp.transition;xp.transition={};try{n()}finally{xp.transition=e}},ft.unstable_act=Jw,ft.useCallback=function(n,e){return vi.current.useCallback(n,e)},ft.useContext=function(n){return vi.current.useContext(n)},ft.useDebugValue=function(){},ft.useDeferredValue=function(n){return vi.current.useDeferredValue(n)},ft.useEffect=function(n,e){return vi.current.useEffect(n,e)},ft.useId=function(){return vi.current.useId()},ft.useImperativeHandle=function(n,e,t){return vi.current.useImperativeHandle(n,e,t)},ft.useInsertionEffect=function(n,e){return vi.current.useInsertionEffect(n,e)},ft.useLayoutEffect=function(n,e){return vi.current.useLayoutEffect(n,e)},ft.useMemo=function(n,e){return vi.current.useMemo(n,e)},ft.useReducer=function(n,e,t){return vi.current.useReducer(n,e,t)},ft.useRef=function(n){return vi.current.useRef(n)},ft.useState=function(n){return vi.current.useState(n)},ft.useSyncExternalStore=function(n,e,t){return vi.current.useSyncExternalStore(n,e,t)},ft.useTransition=function(){return vi.current.useTransition()},ft.version="18.3.1",Vw.exports=ft;var Ks=Vw.exports;const NU=S0(Ks);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var PU=Ks,DU=Symbol.for("react.element"),LU=Symbol.for("react.fragment"),IU=Object.prototype.hasOwnProperty,UU=PU.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,FU={key:!0,ref:!0,__self:!0,__source:!0};function eM(n,e,t){var i,r={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)IU.call(e,i)&&!FU.hasOwnProperty(i)&&(r[i]=e[i]);if(n&&n.defaultProps)for(i in e=n.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:DU,type:n,key:s,ref:o,props:r,_owner:UU.current}}_p.Fragment=LU,_p.jsx=eM,_p.jsxs=eM,Gw.exports=_p;var Qs=Gw.exports,tM={exports:{}},or={},nM={exports:{}},iM={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(B,J){var H=B.length;B.push(J);e:for(;0<H;){var K=H-1>>>1,le=B[K];if(0<r(le,J))B[K]=J,B[H]=le,H=K;else break e}}function t(B){return B.length===0?null:B[0]}function i(B){if(B.length===0)return null;var J=B[0],H=B.pop();if(H!==J){B[0]=H;e:for(var K=0,le=B.length,Pe=le>>>1;K<Pe;){var O=2*(K+1)-1,j=B[O],ae=O+1,re=B[ae];if(0>r(j,H))ae<le&&0>r(re,j)?(B[K]=re,B[ae]=H,K=ae):(B[K]=j,B[O]=H,K=O);else if(ae<le&&0>r(re,H))B[K]=re,B[ae]=H,K=ae;else break e}}return J}function r(B,J){var H=B.sortIndex-J.sortIndex;return H!==0?H:B.id-J.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],c=1,h=null,d=3,f=!1,m=!1,g=!1,_=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(B){for(var J=t(u);J!==null;){if(J.callback===null)i(u);else if(J.startTime<=B)i(u),J.sortIndex=J.expirationTime,e(l,J);else break;J=t(u)}}function x(B){if(g=!1,y(B),!m)if(t(l)!==null)m=!0,F(S);else{var J=t(u);J!==null&&Q(x,J.startTime-B)}}function S(B,J){m=!1,g&&(g=!1,p(E),E=-1),f=!0;var H=d;try{for(y(J),h=t(l);h!==null&&(!(h.expirationTime>J)||B&&!C());){var K=h.callback;if(typeof K=="function"){h.callback=null,d=h.priorityLevel;var le=K(h.expirationTime<=J);J=n.unstable_now(),typeof le=="function"?h.callback=le:h===t(l)&&i(l),y(J)}else i(l);h=t(l)}if(h!==null)var Pe=!0;else{var O=t(u);O!==null&&Q(x,O.startTime-J),Pe=!1}return Pe}finally{h=null,d=H,f=!1}}var T=!1,w=null,E=-1,M=5,b=-1;function C(){return!(n.unstable_now()-b<M)}function I(){if(w!==null){var B=n.unstable_now();b=B;var J=!0;try{J=w(!0,B)}finally{J?U():(T=!1,w=null)}}else T=!1}var U;if(typeof v=="function")U=function(){v(I)};else if(typeof MessageChannel<"u"){var D=new MessageChannel,L=D.port2;D.port1.onmessage=I,U=function(){L.postMessage(null)}}else U=function(){_(I,0)};function F(B){w=B,T||(T=!0,U())}function Q(B,J){E=_(function(){B(n.unstable_now())},J)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(B){B.callback=null},n.unstable_continueExecution=function(){m||f||(m=!0,F(S))},n.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<B?Math.floor(1e3/B):5},n.unstable_getCurrentPriorityLevel=function(){return d},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(B){switch(d){case 1:case 2:case 3:var J=3;break;default:J=d}var H=d;d=J;try{return B()}finally{d=H}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(B,J){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var H=d;d=B;try{return J()}finally{d=H}},n.unstable_scheduleCallback=function(B,J,H){var K=n.unstable_now();switch(typeof H=="object"&&H!==null?(H=H.delay,H=typeof H=="number"&&0<H?K+H:K):H=K,B){case 1:var le=-1;break;case 2:le=250;break;case 5:le=1073741823;break;case 4:le=1e4;break;default:le=5e3}return le=H+le,B={id:c++,callback:J,priorityLevel:B,startTime:H,expirationTime:le,sortIndex:-1},H>K?(B.sortIndex=H,e(u,B),t(l)===null&&B===t(u)&&(g?(p(E),E=-1):g=!0,Q(x,H-K))):(B.sortIndex=le,e(l,B),m||f||(m=!0,F(S))),B},n.unstable_shouldYield=C,n.unstable_wrapCallback=function(B){var J=d;return function(){var H=d;d=J;try{return B.apply(this,arguments)}finally{d=H}}}})(iM),nM.exports=iM;var OU=nM.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BU=Ks,ar=OU;function fe(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var rM=new Set,Ch={};function el(n,e){fu(n,e),fu(n+"Capture",e)}function fu(n,e){for(Ch[n]=e,n=0;n<e.length;n++)rM.add(e[n])}var Zs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),A0=Object.prototype.hasOwnProperty,kU=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,sM={},oM={};function zU(n){return A0.call(oM,n)?!0:A0.call(sM,n)?!1:kU.test(n)?oM[n]=!0:(sM[n]=!0,!1)}function GU(n,e,t,i){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function VU(n,e,t,i){if(e===null||typeof e>"u"||GU(n,e,t,i))return!0;if(i)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function yi(n,e,t,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Xn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Xn[n]=new yi(n,0,!1,n,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Xn[e]=new yi(e,1,!1,n[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(n){Xn[n]=new yi(n,2,!1,n.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Xn[n]=new yi(n,2,!1,n,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Xn[n]=new yi(n,3,!1,n.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(n){Xn[n]=new yi(n,3,!0,n,null,!1,!1)}),["capture","download"].forEach(function(n){Xn[n]=new yi(n,4,!1,n,null,!1,!1)}),["cols","rows","size","span"].forEach(function(n){Xn[n]=new yi(n,6,!1,n,null,!1,!1)}),["rowSpan","start"].forEach(function(n){Xn[n]=new yi(n,5,!1,n.toLowerCase(),null,!1,!1)});var C0=/[\-:]([a-z])/g;function R0(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(C0,R0);Xn[e]=new yi(e,1,!1,n,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(C0,R0);Xn[e]=new yi(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(C0,R0);Xn[e]=new yi(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(n){Xn[n]=new yi(n,1,!1,n.toLowerCase(),null,!1,!1)}),Xn.xlinkHref=new yi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(n){Xn[n]=new yi(n,1,!1,n.toLowerCase(),null,!0,!0)});function N0(n,e,t,i){var r=Xn.hasOwnProperty(e)?Xn[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(VU(e,t,r,i)&&(t=null),i||r===null?zU(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):r.mustUseProperty?n[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,i=r.attributeNamespace,t===null?n.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,i?n.setAttributeNS(i,e,t):n.setAttribute(e,t))))}var Js=BU.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Sp=Symbol.for("react.element"),pu=Symbol.for("react.portal"),mu=Symbol.for("react.fragment"),P0=Symbol.for("react.strict_mode"),D0=Symbol.for("react.profiler"),aM=Symbol.for("react.provider"),lM=Symbol.for("react.context"),L0=Symbol.for("react.forward_ref"),I0=Symbol.for("react.suspense"),U0=Symbol.for("react.suspense_list"),F0=Symbol.for("react.memo"),Xo=Symbol.for("react.lazy"),uM=Symbol.for("react.offscreen"),cM=Symbol.iterator;function Rh(n){return n===null||typeof n!="object"?null:(n=cM&&n[cM]||n["@@iterator"],typeof n=="function"?n:null)}var en=Object.assign,O0;function Nh(n){if(O0===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);O0=e&&e[1]||""}return`
`+O0+n}var B0=!1;function k0(n,e){if(!n||B0)return"";B0=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var i=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){i=u}n.call(e.prototype)}else{try{throw Error()}catch(u){i=u}n()}}catch(u){if(u&&i&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var l=`
`+r[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{B0=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Nh(n):""}function HU(n){switch(n.tag){case 5:return Nh(n.type);case 16:return Nh("Lazy");case 13:return Nh("Suspense");case 19:return Nh("SuspenseList");case 0:case 2:case 15:return n=k0(n.type,!1),n;case 11:return n=k0(n.type.render,!1),n;case 1:return n=k0(n.type,!0),n;default:return""}}function z0(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case mu:return"Fragment";case pu:return"Portal";case D0:return"Profiler";case P0:return"StrictMode";case I0:return"Suspense";case U0:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case lM:return(n.displayName||"Context")+".Consumer";case aM:return(n._context.displayName||"Context")+".Provider";case L0:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case F0:return e=n.displayName||null,e!==null?e:z0(n.type)||"Memo";case Xo:e=n._payload,n=n._init;try{return z0(n(e))}catch{}}return null}function WU(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return z0(e);case 8:return e===P0?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function qo(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function hM(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function $U(n){var e=hM(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),i=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Tp(n){n._valueTracker||(n._valueTracker=$U(n))}function dM(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return n&&(i=hM(n)?n.checked?"true":"false":n.value),n=i,n!==t?(e.setValue(n),!0):!1}function bp(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function G0(n,e){var t=e.checked;return en({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function fM(n,e){var t=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;t=qo(e.value!=null?e.value:t),n._wrapperState={initialChecked:i,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function pM(n,e){e=e.checked,e!=null&&N0(n,"checked",e,!1)}function V0(n,e){pM(n,e);var t=qo(e.value),i=e.type;if(t!=null)i==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(i==="submit"||i==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?H0(n,e.type,t):e.hasOwnProperty("defaultValue")&&H0(n,e.type,qo(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function mM(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function H0(n,e,t){(e!=="number"||bp(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var Ph=Array.isArray;function gu(n,e,t,i){if(n=n.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<n.length;t++)r=e.hasOwnProperty("$"+n[t].value),n[t].selected!==r&&(n[t].selected=r),r&&i&&(n[t].defaultSelected=!0)}else{for(t=""+qo(t),e=null,r=0;r<n.length;r++){if(n[r].value===t){n[r].selected=!0,i&&(n[r].defaultSelected=!0);return}e!==null||n[r].disabled||(e=n[r])}e!==null&&(e.selected=!0)}}function W0(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(fe(91));return en({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function gM(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(fe(92));if(Ph(t)){if(1<t.length)throw Error(fe(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:qo(t)}}function _M(n,e){var t=qo(e.value),i=qo(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),i!=null&&(n.defaultValue=""+i)}function vM(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function yM(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function $0(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?yM(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var wp,xM=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,i,r){MSApp.execUnsafeLocalFunction(function(){return n(e,t,i,r)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(wp=wp||document.createElement("div"),wp.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=wp.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Dh(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Lh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},jU=["Webkit","ms","Moz","O"];Object.keys(Lh).forEach(function(n){jU.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Lh[e]=Lh[n]})});function SM(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Lh.hasOwnProperty(n)&&Lh[n]?(""+e).trim():e+"px"}function TM(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var i=t.indexOf("--")===0,r=SM(t,e[t],i);t==="float"&&(t="cssFloat"),i?n.setProperty(t,r):n[t]=r}}var XU=en({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function j0(n,e){if(e){if(XU[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(fe(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(fe(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(fe(61))}if(e.style!=null&&typeof e.style!="object")throw Error(fe(62))}}function X0(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var q0=null;function Y0(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var K0=null,_u=null,vu=null;function bM(n){if(n=td(n)){if(typeof K0!="function")throw Error(fe(280));var e=n.stateNode;e&&(e=Xp(e),K0(n.stateNode,n.type,e))}}function wM(n){_u?vu?vu.push(n):vu=[n]:_u=n}function MM(){if(_u){var n=_u,e=vu;if(vu=_u=null,bM(n),e)for(n=0;n<e.length;n++)bM(e[n])}}function EM(n,e){return n(e)}function AM(){}var Q0=!1;function CM(n,e,t){if(Q0)return n(e,t);Q0=!0;try{return EM(n,e,t)}finally{Q0=!1,(_u!==null||vu!==null)&&(AM(),MM())}}function Ih(n,e){var t=n.stateNode;if(t===null)return null;var i=Xp(t);if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(n=n.type,i=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!i;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(fe(231,e,typeof t));return t}var Z0=!1;if(Zs)try{var Uh={};Object.defineProperty(Uh,"passive",{get:function(){Z0=!0}}),window.addEventListener("test",Uh,Uh),window.removeEventListener("test",Uh,Uh)}catch{Z0=!1}function qU(n,e,t,i,r,s,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(c){this.onError(c)}}var Fh=!1,Mp=null,Ep=!1,J0=null,YU={onError:function(n){Fh=!0,Mp=n}};function KU(n,e,t,i,r,s,o,a,l){Fh=!1,Mp=null,qU.apply(YU,arguments)}function QU(n,e,t,i,r,s,o,a,l){if(KU.apply(this,arguments),Fh){if(Fh){var u=Mp;Fh=!1,Mp=null}else throw Error(fe(198));Ep||(Ep=!0,J0=u)}}function tl(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function RM(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function NM(n){if(tl(n)!==n)throw Error(fe(188))}function ZU(n){var e=n.alternate;if(!e){if(e=tl(n),e===null)throw Error(fe(188));return e!==n?null:n}for(var t=n,i=e;;){var r=t.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){t=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===t)return NM(r),n;if(s===i)return NM(r),e;s=s.sibling}throw Error(fe(188))}if(t.return!==i.return)t=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===t){o=!0,t=r,i=s;break}if(a===i){o=!0,i=r,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,i=r;break}if(a===i){o=!0,i=s,t=r;break}a=a.sibling}if(!o)throw Error(fe(189))}}if(t.alternate!==i)throw Error(fe(190))}if(t.tag!==3)throw Error(fe(188));return t.stateNode.current===t?n:e}function PM(n){return n=ZU(n),n!==null?DM(n):null}function DM(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=DM(n);if(e!==null)return e;n=n.sibling}return null}var LM=ar.unstable_scheduleCallback,IM=ar.unstable_cancelCallback,JU=ar.unstable_shouldYield,eF=ar.unstable_requestPaint,pn=ar.unstable_now,tF=ar.unstable_getCurrentPriorityLevel,ev=ar.unstable_ImmediatePriority,UM=ar.unstable_UserBlockingPriority,Ap=ar.unstable_NormalPriority,nF=ar.unstable_LowPriority,FM=ar.unstable_IdlePriority,Cp=null,Ss=null;function iF(n){if(Ss&&typeof Ss.onCommitFiberRoot=="function")try{Ss.onCommitFiberRoot(Cp,n,void 0,(n.current.flags&128)===128)}catch{}}var Kr=Math.clz32?Math.clz32:oF,rF=Math.log,sF=Math.LN2;function oF(n){return n>>>=0,n===0?32:31-(rF(n)/sF|0)|0}var Rp=64,Np=4194304;function Oh(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Pp(n,e){var t=n.pendingLanes;if(t===0)return 0;var i=0,r=n.suspendedLanes,s=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~r;a!==0?i=Oh(a):(s&=o,s!==0&&(i=Oh(s)))}else o=t&~r,o!==0?i=Oh(o):s!==0&&(i=Oh(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=i;0<e;)t=31-Kr(e),r=1<<t,i|=n[t],e&=~r;return i}function aF(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function lF(n,e){for(var t=n.suspendedLanes,i=n.pingedLanes,r=n.expirationTimes,s=n.pendingLanes;0<s;){var o=31-Kr(s),a=1<<o,l=r[o];l===-1?(!(a&t)||a&i)&&(r[o]=aF(a,e)):l<=e&&(n.expiredLanes|=a),s&=~a}}function tv(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function OM(){var n=Rp;return Rp<<=1,!(Rp&4194240)&&(Rp=64),n}function nv(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Bh(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Kr(e),n[e]=t}function uF(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var i=n.eventTimes;for(n=n.expirationTimes;0<t;){var r=31-Kr(t),s=1<<r;e[r]=0,i[r]=-1,n[r]=-1,t&=~s}}function iv(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var i=31-Kr(t),r=1<<i;r&e|n[i]&e&&(n[i]|=e),t&=~r}}var Dt=0;function BM(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var kM,rv,zM,GM,VM,sv=!1,Dp=[],Yo=null,Ko=null,Qo=null,kh=new Map,zh=new Map,Zo=[],cF="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function HM(n,e){switch(n){case"focusin":case"focusout":Yo=null;break;case"dragenter":case"dragleave":Ko=null;break;case"mouseover":case"mouseout":Qo=null;break;case"pointerover":case"pointerout":kh.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":zh.delete(e.pointerId)}}function Gh(n,e,t,i,r,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=td(e),e!==null&&rv(e)),n):(n.eventSystemFlags|=i,e=n.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),n)}function hF(n,e,t,i,r){switch(e){case"focusin":return Yo=Gh(Yo,n,e,t,i,r),!0;case"dragenter":return Ko=Gh(Ko,n,e,t,i,r),!0;case"mouseover":return Qo=Gh(Qo,n,e,t,i,r),!0;case"pointerover":var s=r.pointerId;return kh.set(s,Gh(kh.get(s)||null,n,e,t,i,r)),!0;case"gotpointercapture":return s=r.pointerId,zh.set(s,Gh(zh.get(s)||null,n,e,t,i,r)),!0}return!1}function WM(n){var e=nl(n.target);if(e!==null){var t=tl(e);if(t!==null){if(e=t.tag,e===13){if(e=RM(t),e!==null){n.blockedOn=e,VM(n.priority,function(){zM(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Lp(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=av(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var i=new t.constructor(t.type,t);q0=i,t.target.dispatchEvent(i),q0=null}else return e=td(t),e!==null&&rv(e),n.blockedOn=t,!1;e.shift()}return!0}function $M(n,e,t){Lp(n)&&t.delete(e)}function dF(){sv=!1,Yo!==null&&Lp(Yo)&&(Yo=null),Ko!==null&&Lp(Ko)&&(Ko=null),Qo!==null&&Lp(Qo)&&(Qo=null),kh.forEach($M),zh.forEach($M)}function Vh(n,e){n.blockedOn===e&&(n.blockedOn=null,sv||(sv=!0,ar.unstable_scheduleCallback(ar.unstable_NormalPriority,dF)))}function Hh(n){function e(r){return Vh(r,n)}if(0<Dp.length){Vh(Dp[0],n);for(var t=1;t<Dp.length;t++){var i=Dp[t];i.blockedOn===n&&(i.blockedOn=null)}}for(Yo!==null&&Vh(Yo,n),Ko!==null&&Vh(Ko,n),Qo!==null&&Vh(Qo,n),kh.forEach(e),zh.forEach(e),t=0;t<Zo.length;t++)i=Zo[t],i.blockedOn===n&&(i.blockedOn=null);for(;0<Zo.length&&(t=Zo[0],t.blockedOn===null);)WM(t),t.blockedOn===null&&Zo.shift()}var yu=Js.ReactCurrentBatchConfig,Ip=!0;function fF(n,e,t,i){var r=Dt,s=yu.transition;yu.transition=null;try{Dt=1,ov(n,e,t,i)}finally{Dt=r,yu.transition=s}}function pF(n,e,t,i){var r=Dt,s=yu.transition;yu.transition=null;try{Dt=4,ov(n,e,t,i)}finally{Dt=r,yu.transition=s}}function ov(n,e,t,i){if(Ip){var r=av(n,e,t,i);if(r===null)wv(n,e,i,Up,t),HM(n,i);else if(hF(r,n,e,t,i))i.stopPropagation();else if(HM(n,i),e&4&&-1<cF.indexOf(n)){for(;r!==null;){var s=td(r);if(s!==null&&kM(s),s=av(n,e,t,i),s===null&&wv(n,e,i,Up,t),s===r)break;r=s}r!==null&&i.stopPropagation()}else wv(n,e,i,null,t)}}var Up=null;function av(n,e,t,i){if(Up=null,n=Y0(i),n=nl(n),n!==null)if(e=tl(n),e===null)n=null;else if(t=e.tag,t===13){if(n=RM(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Up=n,null}function jM(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(tF()){case ev:return 1;case UM:return 4;case Ap:case nF:return 16;case FM:return 536870912;default:return 16}default:return 16}}var Jo=null,lv=null,Fp=null;function XM(){if(Fp)return Fp;var n,e=lv,t=e.length,i,r="value"in Jo?Jo.value:Jo.textContent,s=r.length;for(n=0;n<t&&e[n]===r[n];n++);var o=t-n;for(i=1;i<=o&&e[t-i]===r[s-i];i++);return Fp=r.slice(n,1<i?1-i:void 0)}function Op(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Bp(){return!0}function qM(){return!1}function lr(n){function e(t,i,r,s,o){this._reactName=t,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Bp:qM,this.isPropagationStopped=qM,this}return en(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Bp)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Bp)},persist:function(){},isPersistent:Bp}),e}var xu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},uv=lr(xu),Wh=en({},xu,{view:0,detail:0}),mF=lr(Wh),cv,hv,$h,kp=en({},Wh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:fv,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==$h&&($h&&n.type==="mousemove"?(cv=n.screenX-$h.screenX,hv=n.screenY-$h.screenY):hv=cv=0,$h=n),cv)},movementY:function(n){return"movementY"in n?n.movementY:hv}}),YM=lr(kp),gF=en({},kp,{dataTransfer:0}),_F=lr(gF),vF=en({},Wh,{relatedTarget:0}),dv=lr(vF),yF=en({},xu,{animationName:0,elapsedTime:0,pseudoElement:0}),xF=lr(yF),SF=en({},xu,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),TF=lr(SF),bF=en({},xu,{data:0}),KM=lr(bF),wF={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},MF={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},EF={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function AF(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=EF[n])?!!e[n]:!1}function fv(){return AF}var CF=en({},Wh,{key:function(n){if(n.key){var e=wF[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Op(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?MF[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:fv,charCode:function(n){return n.type==="keypress"?Op(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Op(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),RF=lr(CF),NF=en({},kp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),QM=lr(NF),PF=en({},Wh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:fv}),DF=lr(PF),LF=en({},xu,{propertyName:0,elapsedTime:0,pseudoElement:0}),IF=lr(LF),UF=en({},kp,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),FF=lr(UF),OF=[9,13,27,32],pv=Zs&&"CompositionEvent"in window,jh=null;Zs&&"documentMode"in document&&(jh=document.documentMode);var BF=Zs&&"TextEvent"in window&&!jh,ZM=Zs&&(!pv||jh&&8<jh&&11>=jh),JM=" ",eE=!1;function tE(n,e){switch(n){case"keyup":return OF.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function nE(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Su=!1;function kF(n,e){switch(n){case"compositionend":return nE(e);case"keypress":return e.which!==32?null:(eE=!0,JM);case"textInput":return n=e.data,n===JM&&eE?null:n;default:return null}}function zF(n,e){if(Su)return n==="compositionend"||!pv&&tE(n,e)?(n=XM(),Fp=lv=Jo=null,Su=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return ZM&&e.locale!=="ko"?null:e.data;default:return null}}var GF={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function iE(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!GF[n.type]:e==="textarea"}function rE(n,e,t,i){wM(i),e=Wp(e,"onChange"),0<e.length&&(t=new uv("onChange","change",null,t,i),n.push({event:t,listeners:e}))}var Xh=null,qh=null;function VF(n){TE(n,0)}function zp(n){var e=Eu(n);if(dM(e))return n}function HF(n,e){if(n==="change")return e}var sE=!1;if(Zs){var mv;if(Zs){var gv="oninput"in document;if(!gv){var oE=document.createElement("div");oE.setAttribute("oninput","return;"),gv=typeof oE.oninput=="function"}mv=gv}else mv=!1;sE=mv&&(!document.documentMode||9<document.documentMode)}function aE(){Xh&&(Xh.detachEvent("onpropertychange",lE),qh=Xh=null)}function lE(n){if(n.propertyName==="value"&&zp(qh)){var e=[];rE(e,qh,n,Y0(n)),CM(VF,e)}}function WF(n,e,t){n==="focusin"?(aE(),Xh=e,qh=t,Xh.attachEvent("onpropertychange",lE)):n==="focusout"&&aE()}function $F(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return zp(qh)}function jF(n,e){if(n==="click")return zp(e)}function XF(n,e){if(n==="input"||n==="change")return zp(e)}function qF(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Qr=typeof Object.is=="function"?Object.is:qF;function Yh(n,e){if(Qr(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var r=t[i];if(!A0.call(e,r)||!Qr(n[r],e[r]))return!1}return!0}function uE(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function cE(n,e){var t=uE(n);n=0;for(var i;t;){if(t.nodeType===3){if(i=n+t.textContent.length,n<=e&&i>=e)return{node:t,offset:e-n};n=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=uE(t)}}function hE(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?hE(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function dE(){for(var n=window,e=bp();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=bp(n.document)}return e}function _v(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function YF(n){var e=dE(),t=n.focusedElem,i=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&hE(t.ownerDocument.documentElement,t)){if(i!==null&&_v(t)){if(e=i.start,n=i.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var r=t.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!n.extend&&s>i&&(r=i,i=s,s=r),r=cE(t,s);var o=cE(t,i);r&&o&&(n.rangeCount!==1||n.anchorNode!==r.node||n.anchorOffset!==r.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),n.removeAllRanges(),s>i?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var KF=Zs&&"documentMode"in document&&11>=document.documentMode,Tu=null,vv=null,Kh=null,yv=!1;function fE(n,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;yv||Tu==null||Tu!==bp(i)||(i=Tu,"selectionStart"in i&&_v(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Kh&&Yh(Kh,i)||(Kh=i,i=Wp(vv,"onSelect"),0<i.length&&(e=new uv("onSelect","select",null,e,t),n.push({event:e,listeners:i}),e.target=Tu)))}function Gp(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var bu={animationend:Gp("Animation","AnimationEnd"),animationiteration:Gp("Animation","AnimationIteration"),animationstart:Gp("Animation","AnimationStart"),transitionend:Gp("Transition","TransitionEnd")},xv={},pE={};Zs&&(pE=document.createElement("div").style,"AnimationEvent"in window||(delete bu.animationend.animation,delete bu.animationiteration.animation,delete bu.animationstart.animation),"TransitionEvent"in window||delete bu.transitionend.transition);function Vp(n){if(xv[n])return xv[n];if(!bu[n])return n;var e=bu[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in pE)return xv[n]=e[t];return n}var mE=Vp("animationend"),gE=Vp("animationiteration"),_E=Vp("animationstart"),vE=Vp("transitionend"),yE=new Map,xE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ea(n,e){yE.set(n,e),el(e,[n])}for(var Sv=0;Sv<xE.length;Sv++){var Tv=xE[Sv],QF=Tv.toLowerCase(),ZF=Tv[0].toUpperCase()+Tv.slice(1);ea(QF,"on"+ZF)}ea(mE,"onAnimationEnd"),ea(gE,"onAnimationIteration"),ea(_E,"onAnimationStart"),ea("dblclick","onDoubleClick"),ea("focusin","onFocus"),ea("focusout","onBlur"),ea(vE,"onTransitionEnd"),fu("onMouseEnter",["mouseout","mouseover"]),fu("onMouseLeave",["mouseout","mouseover"]),fu("onPointerEnter",["pointerout","pointerover"]),fu("onPointerLeave",["pointerout","pointerover"]),el("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),el("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),el("onBeforeInput",["compositionend","keypress","textInput","paste"]),el("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),el("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),el("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),JF=new Set("cancel close invalid load scroll toggle".split(" ").concat(Qh));function SE(n,e,t){var i=n.type||"unknown-event";n.currentTarget=t,QU(i,e,void 0,n),n.currentTarget=null}function TE(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var i=n[t],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;SE(r,a,u),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;SE(r,a,u),s=l}}}if(Ep)throw n=J0,Ep=!1,J0=null,n}function zt(n,e){var t=e[Nv];t===void 0&&(t=e[Nv]=new Set);var i=n+"__bubble";t.has(i)||(bE(e,n,2,!1),t.add(i))}function bv(n,e,t){var i=0;e&&(i|=4),bE(t,n,i,e)}var Hp="_reactListening"+Math.random().toString(36).slice(2);function Zh(n){if(!n[Hp]){n[Hp]=!0,rM.forEach(function(t){t!=="selectionchange"&&(JF.has(t)||bv(t,!1,n),bv(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Hp]||(e[Hp]=!0,bv("selectionchange",!1,e))}}function bE(n,e,t,i){switch(jM(e)){case 1:var r=fF;break;case 4:r=pF;break;default:r=ov}t=r.bind(null,e,t,n),r=void 0,!Z0||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?n.addEventListener(e,t,{capture:!0,passive:r}):n.addEventListener(e,t,!0):r!==void 0?n.addEventListener(e,t,{passive:r}):n.addEventListener(e,t,!1)}function wv(n,e,t,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=nl(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}CM(function(){var u=s,c=Y0(t),h=[];e:{var d=yE.get(n);if(d!==void 0){var f=uv,m=n;switch(n){case"keypress":if(Op(t)===0)break e;case"keydown":case"keyup":f=RF;break;case"focusin":m="focus",f=dv;break;case"focusout":m="blur",f=dv;break;case"beforeblur":case"afterblur":f=dv;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=YM;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=_F;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=DF;break;case mE:case gE:case _E:f=xF;break;case vE:f=IF;break;case"scroll":f=mF;break;case"wheel":f=FF;break;case"copy":case"cut":case"paste":f=TF;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=QM}var g=(e&4)!==0,_=!g&&n==="scroll",p=g?d!==null?d+"Capture":null:d;g=[];for(var v=u,y;v!==null;){y=v;var x=y.stateNode;if(y.tag===5&&x!==null&&(y=x,p!==null&&(x=Ih(v,p),x!=null&&g.push(Jh(v,x,y)))),_)break;v=v.return}0<g.length&&(d=new f(d,m,null,t,c),h.push({event:d,listeners:g}))}}if(!(e&7)){e:{if(d=n==="mouseover"||n==="pointerover",f=n==="mouseout"||n==="pointerout",d&&t!==q0&&(m=t.relatedTarget||t.fromElement)&&(nl(m)||m[eo]))break e;if((f||d)&&(d=c.window===c?c:(d=c.ownerDocument)?d.defaultView||d.parentWindow:window,f?(m=t.relatedTarget||t.toElement,f=u,m=m?nl(m):null,m!==null&&(_=tl(m),m!==_||m.tag!==5&&m.tag!==6)&&(m=null)):(f=null,m=u),f!==m)){if(g=YM,x="onMouseLeave",p="onMouseEnter",v="mouse",(n==="pointerout"||n==="pointerover")&&(g=QM,x="onPointerLeave",p="onPointerEnter",v="pointer"),_=f==null?d:Eu(f),y=m==null?d:Eu(m),d=new g(x,v+"leave",f,t,c),d.target=_,d.relatedTarget=y,x=null,nl(c)===u&&(g=new g(p,v+"enter",m,t,c),g.target=y,g.relatedTarget=_,x=g),_=x,f&&m)t:{for(g=f,p=m,v=0,y=g;y;y=wu(y))v++;for(y=0,x=p;x;x=wu(x))y++;for(;0<v-y;)g=wu(g),v--;for(;0<y-v;)p=wu(p),y--;for(;v--;){if(g===p||p!==null&&g===p.alternate)break t;g=wu(g),p=wu(p)}g=null}else g=null;f!==null&&wE(h,d,f,g,!1),m!==null&&_!==null&&wE(h,_,m,g,!0)}}e:{if(d=u?Eu(u):window,f=d.nodeName&&d.nodeName.toLowerCase(),f==="select"||f==="input"&&d.type==="file")var S=HF;else if(iE(d))if(sE)S=XF;else{S=$F;var T=WF}else(f=d.nodeName)&&f.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(S=jF);if(S&&(S=S(n,u))){rE(h,S,t,c);break e}T&&T(n,d,u),n==="focusout"&&(T=d._wrapperState)&&T.controlled&&d.type==="number"&&H0(d,"number",d.value)}switch(T=u?Eu(u):window,n){case"focusin":(iE(T)||T.contentEditable==="true")&&(Tu=T,vv=u,Kh=null);break;case"focusout":Kh=vv=Tu=null;break;case"mousedown":yv=!0;break;case"contextmenu":case"mouseup":case"dragend":yv=!1,fE(h,t,c);break;case"selectionchange":if(KF)break;case"keydown":case"keyup":fE(h,t,c)}var w;if(pv)e:{switch(n){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else Su?tE(n,t)&&(E="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(E="onCompositionStart");E&&(ZM&&t.locale!=="ko"&&(Su||E!=="onCompositionStart"?E==="onCompositionEnd"&&Su&&(w=XM()):(Jo=c,lv="value"in Jo?Jo.value:Jo.textContent,Su=!0)),T=Wp(u,E),0<T.length&&(E=new KM(E,n,null,t,c),h.push({event:E,listeners:T}),w?E.data=w:(w=nE(t),w!==null&&(E.data=w)))),(w=BF?kF(n,t):zF(n,t))&&(u=Wp(u,"onBeforeInput"),0<u.length&&(c=new KM("onBeforeInput","beforeinput",null,t,c),h.push({event:c,listeners:u}),c.data=w))}TE(h,e)})}function Jh(n,e,t){return{instance:n,listener:e,currentTarget:t}}function Wp(n,e){for(var t=e+"Capture",i=[];n!==null;){var r=n,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=Ih(n,t),s!=null&&i.unshift(Jh(n,s,r)),s=Ih(n,e),s!=null&&i.push(Jh(n,s,r))),n=n.return}return i}function wu(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function wE(n,e,t,i,r){for(var s=e._reactName,o=[];t!==null&&t!==i;){var a=t,l=a.alternate,u=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&u!==null&&(a=u,r?(l=Ih(t,s),l!=null&&o.unshift(Jh(t,l,a))):r||(l=Ih(t,s),l!=null&&o.push(Jh(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var eO=/\r\n?/g,tO=/\u0000|\uFFFD/g;function ME(n){return(typeof n=="string"?n:""+n).replace(eO,`
`).replace(tO,"")}function $p(n,e,t){if(e=ME(e),ME(n)!==e&&t)throw Error(fe(425))}function jp(){}var Mv=null,Ev=null;function Av(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Cv=typeof setTimeout=="function"?setTimeout:void 0,nO=typeof clearTimeout=="function"?clearTimeout:void 0,EE=typeof Promise=="function"?Promise:void 0,iO=typeof queueMicrotask=="function"?queueMicrotask:typeof EE<"u"?function(n){return EE.resolve(null).then(n).catch(rO)}:Cv;function rO(n){setTimeout(function(){throw n})}function Rv(n,e){var t=e,i=0;do{var r=t.nextSibling;if(n.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(i===0){n.removeChild(r),Hh(e);return}i--}else t!=="$"&&t!=="$?"&&t!=="$!"||i++;t=r}while(t);Hh(e)}function ta(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function AE(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Mu=Math.random().toString(36).slice(2),Ts="__reactFiber$"+Mu,ed="__reactProps$"+Mu,eo="__reactContainer$"+Mu,Nv="__reactEvents$"+Mu,sO="__reactListeners$"+Mu,oO="__reactHandles$"+Mu;function nl(n){var e=n[Ts];if(e)return e;for(var t=n.parentNode;t;){if(e=t[eo]||t[Ts]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=AE(n);n!==null;){if(t=n[Ts])return t;n=AE(n)}return e}n=t,t=n.parentNode}return null}function td(n){return n=n[Ts]||n[eo],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Eu(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(fe(33))}function Xp(n){return n[ed]||null}var Pv=[],Au=-1;function na(n){return{current:n}}function Gt(n){0>Au||(n.current=Pv[Au],Pv[Au]=null,Au--)}function Bt(n,e){Au++,Pv[Au]=n.current,n.current=e}var ia={},ni=na(ia),Ui=na(!1),il=ia;function Cu(n,e){var t=n.type.contextTypes;if(!t)return ia;var i=n.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in t)r[s]=e[s];return i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=r),r}function Fi(n){return n=n.childContextTypes,n!=null}function qp(){Gt(Ui),Gt(ni)}function CE(n,e,t){if(ni.current!==ia)throw Error(fe(168));Bt(ni,e),Bt(Ui,t)}function RE(n,e,t){var i=n.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return t;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(fe(108,WU(n)||"Unknown",r));return en({},t,i)}function Yp(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||ia,il=ni.current,Bt(ni,n),Bt(Ui,Ui.current),!0}function NE(n,e,t){var i=n.stateNode;if(!i)throw Error(fe(169));t?(n=RE(n,e,il),i.__reactInternalMemoizedMergedChildContext=n,Gt(Ui),Gt(ni),Bt(ni,n)):Gt(Ui),Bt(Ui,t)}var to=null,Kp=!1,Dv=!1;function PE(n){to===null?to=[n]:to.push(n)}function aO(n){Kp=!0,PE(n)}function ra(){if(!Dv&&to!==null){Dv=!0;var n=0,e=Dt;try{var t=to;for(Dt=1;n<t.length;n++){var i=t[n];do i=i(!0);while(i!==null)}to=null,Kp=!1}catch(r){throw to!==null&&(to=to.slice(n+1)),LM(ev,ra),r}finally{Dt=e,Dv=!1}}return null}var Ru=[],Nu=0,Qp=null,Zp=0,Pr=[],Dr=0,rl=null,no=1,io="";function sl(n,e){Ru[Nu++]=Zp,Ru[Nu++]=Qp,Qp=n,Zp=e}function DE(n,e,t){Pr[Dr++]=no,Pr[Dr++]=io,Pr[Dr++]=rl,rl=n;var i=no;n=io;var r=32-Kr(i)-1;i&=~(1<<r),t+=1;var s=32-Kr(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,no=1<<32-Kr(e)+r|t<<r|i,io=s+n}else no=1<<s|t<<r|i,io=n}function Lv(n){n.return!==null&&(sl(n,1),DE(n,1,0))}function Iv(n){for(;n===Qp;)Qp=Ru[--Nu],Ru[Nu]=null,Zp=Ru[--Nu],Ru[Nu]=null;for(;n===rl;)rl=Pr[--Dr],Pr[Dr]=null,io=Pr[--Dr],Pr[Dr]=null,no=Pr[--Dr],Pr[Dr]=null}var ur=null,cr=null,jt=!1,Zr=null;function LE(n,e){var t=Fr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function IE(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,ur=n,cr=ta(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,ur=n,cr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=rl!==null?{id:no,overflow:io}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Fr(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,ur=n,cr=null,!0):!1;default:return!1}}function Uv(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Fv(n){if(jt){var e=cr;if(e){var t=e;if(!IE(n,e)){if(Uv(n))throw Error(fe(418));e=ta(t.nextSibling);var i=ur;e&&IE(n,e)?LE(i,t):(n.flags=n.flags&-4097|2,jt=!1,ur=n)}}else{if(Uv(n))throw Error(fe(418));n.flags=n.flags&-4097|2,jt=!1,ur=n}}}function UE(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;ur=n}function Jp(n){if(n!==ur)return!1;if(!jt)return UE(n),jt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!Av(n.type,n.memoizedProps)),e&&(e=cr)){if(Uv(n))throw FE(),Error(fe(418));for(;e;)LE(n,e),e=ta(e.nextSibling)}if(UE(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(fe(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){cr=ta(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}cr=null}}else cr=ur?ta(n.stateNode.nextSibling):null;return!0}function FE(){for(var n=cr;n;)n=ta(n.nextSibling)}function Pu(){cr=ur=null,jt=!1}function Ov(n){Zr===null?Zr=[n]:Zr.push(n)}var lO=Js.ReactCurrentBatchConfig;function nd(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(fe(309));var i=t.stateNode}if(!i)throw Error(fe(147,n));var r=i,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof n!="string")throw Error(fe(284));if(!t._owner)throw Error(fe(290,n))}return n}function em(n,e){throw n=Object.prototype.toString.call(e),Error(fe(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function OE(n){var e=n._init;return e(n._payload)}function BE(n){function e(p,v){if(n){var y=p.deletions;y===null?(p.deletions=[v],p.flags|=16):y.push(v)}}function t(p,v){if(!n)return null;for(;v!==null;)e(p,v),v=v.sibling;return null}function i(p,v){for(p=new Map;v!==null;)v.key!==null?p.set(v.key,v):p.set(v.index,v),v=v.sibling;return p}function r(p,v){return p=da(p,v),p.index=0,p.sibling=null,p}function s(p,v,y){return p.index=y,n?(y=p.alternate,y!==null?(y=y.index,y<v?(p.flags|=2,v):y):(p.flags|=2,v)):(p.flags|=1048576,v)}function o(p){return n&&p.alternate===null&&(p.flags|=2),p}function a(p,v,y,x){return v===null||v.tag!==6?(v=Cy(y,p.mode,x),v.return=p,v):(v=r(v,y),v.return=p,v)}function l(p,v,y,x){var S=y.type;return S===mu?c(p,v,y.props.children,x,y.key):v!==null&&(v.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Xo&&OE(S)===v.type)?(x=r(v,y.props),x.ref=nd(p,v,y),x.return=p,x):(x=wm(y.type,y.key,y.props,null,p.mode,x),x.ref=nd(p,v,y),x.return=p,x)}function u(p,v,y,x){return v===null||v.tag!==4||v.stateNode.containerInfo!==y.containerInfo||v.stateNode.implementation!==y.implementation?(v=Ry(y,p.mode,x),v.return=p,v):(v=r(v,y.children||[]),v.return=p,v)}function c(p,v,y,x,S){return v===null||v.tag!==7?(v=fl(y,p.mode,x,S),v.return=p,v):(v=r(v,y),v.return=p,v)}function h(p,v,y){if(typeof v=="string"&&v!==""||typeof v=="number")return v=Cy(""+v,p.mode,y),v.return=p,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Sp:return y=wm(v.type,v.key,v.props,null,p.mode,y),y.ref=nd(p,null,v),y.return=p,y;case pu:return v=Ry(v,p.mode,y),v.return=p,v;case Xo:var x=v._init;return h(p,x(v._payload),y)}if(Ph(v)||Rh(v))return v=fl(v,p.mode,y,null),v.return=p,v;em(p,v)}return null}function d(p,v,y,x){var S=v!==null?v.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return S!==null?null:a(p,v,""+y,x);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Sp:return y.key===S?l(p,v,y,x):null;case pu:return y.key===S?u(p,v,y,x):null;case Xo:return S=y._init,d(p,v,S(y._payload),x)}if(Ph(y)||Rh(y))return S!==null?null:c(p,v,y,x,null);em(p,y)}return null}function f(p,v,y,x,S){if(typeof x=="string"&&x!==""||typeof x=="number")return p=p.get(y)||null,a(v,p,""+x,S);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Sp:return p=p.get(x.key===null?y:x.key)||null,l(v,p,x,S);case pu:return p=p.get(x.key===null?y:x.key)||null,u(v,p,x,S);case Xo:var T=x._init;return f(p,v,y,T(x._payload),S)}if(Ph(x)||Rh(x))return p=p.get(y)||null,c(v,p,x,S,null);em(v,x)}return null}function m(p,v,y,x){for(var S=null,T=null,w=v,E=v=0,M=null;w!==null&&E<y.length;E++){w.index>E?(M=w,w=null):M=w.sibling;var b=d(p,w,y[E],x);if(b===null){w===null&&(w=M);break}n&&w&&b.alternate===null&&e(p,w),v=s(b,v,E),T===null?S=b:T.sibling=b,T=b,w=M}if(E===y.length)return t(p,w),jt&&sl(p,E),S;if(w===null){for(;E<y.length;E++)w=h(p,y[E],x),w!==null&&(v=s(w,v,E),T===null?S=w:T.sibling=w,T=w);return jt&&sl(p,E),S}for(w=i(p,w);E<y.length;E++)M=f(w,p,E,y[E],x),M!==null&&(n&&M.alternate!==null&&w.delete(M.key===null?E:M.key),v=s(M,v,E),T===null?S=M:T.sibling=M,T=M);return n&&w.forEach(function(C){return e(p,C)}),jt&&sl(p,E),S}function g(p,v,y,x){var S=Rh(y);if(typeof S!="function")throw Error(fe(150));if(y=S.call(y),y==null)throw Error(fe(151));for(var T=S=null,w=v,E=v=0,M=null,b=y.next();w!==null&&!b.done;E++,b=y.next()){w.index>E?(M=w,w=null):M=w.sibling;var C=d(p,w,b.value,x);if(C===null){w===null&&(w=M);break}n&&w&&C.alternate===null&&e(p,w),v=s(C,v,E),T===null?S=C:T.sibling=C,T=C,w=M}if(b.done)return t(p,w),jt&&sl(p,E),S;if(w===null){for(;!b.done;E++,b=y.next())b=h(p,b.value,x),b!==null&&(v=s(b,v,E),T===null?S=b:T.sibling=b,T=b);return jt&&sl(p,E),S}for(w=i(p,w);!b.done;E++,b=y.next())b=f(w,p,E,b.value,x),b!==null&&(n&&b.alternate!==null&&w.delete(b.key===null?E:b.key),v=s(b,v,E),T===null?S=b:T.sibling=b,T=b);return n&&w.forEach(function(I){return e(p,I)}),jt&&sl(p,E),S}function _(p,v,y,x){if(typeof y=="object"&&y!==null&&y.type===mu&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case Sp:e:{for(var S=y.key,T=v;T!==null;){if(T.key===S){if(S=y.type,S===mu){if(T.tag===7){t(p,T.sibling),v=r(T,y.props.children),v.return=p,p=v;break e}}else if(T.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Xo&&OE(S)===T.type){t(p,T.sibling),v=r(T,y.props),v.ref=nd(p,T,y),v.return=p,p=v;break e}t(p,T);break}else e(p,T);T=T.sibling}y.type===mu?(v=fl(y.props.children,p.mode,x,y.key),v.return=p,p=v):(x=wm(y.type,y.key,y.props,null,p.mode,x),x.ref=nd(p,v,y),x.return=p,p=x)}return o(p);case pu:e:{for(T=y.key;v!==null;){if(v.key===T)if(v.tag===4&&v.stateNode.containerInfo===y.containerInfo&&v.stateNode.implementation===y.implementation){t(p,v.sibling),v=r(v,y.children||[]),v.return=p,p=v;break e}else{t(p,v);break}else e(p,v);v=v.sibling}v=Ry(y,p.mode,x),v.return=p,p=v}return o(p);case Xo:return T=y._init,_(p,v,T(y._payload),x)}if(Ph(y))return m(p,v,y,x);if(Rh(y))return g(p,v,y,x);em(p,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,v!==null&&v.tag===6?(t(p,v.sibling),v=r(v,y),v.return=p,p=v):(t(p,v),v=Cy(y,p.mode,x),v.return=p,p=v),o(p)):t(p,v)}return _}var Du=BE(!0),kE=BE(!1),tm=na(null),nm=null,Lu=null,Bv=null;function kv(){Bv=Lu=nm=null}function zv(n){var e=tm.current;Gt(tm),n._currentValue=e}function Gv(n,e,t){for(;n!==null;){var i=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),n===t)break;n=n.return}}function Iu(n,e){nm=n,Bv=Lu=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Oi=!0),n.firstContext=null)}function Lr(n){var e=n._currentValue;if(Bv!==n)if(n={context:n,memoizedValue:e,next:null},Lu===null){if(nm===null)throw Error(fe(308));Lu=n,nm.dependencies={lanes:0,firstContext:n}}else Lu=Lu.next=n;return e}var ol=null;function Vv(n){ol===null?ol=[n]:ol.push(n)}function zE(n,e,t,i){var r=e.interleaved;return r===null?(t.next=t,Vv(e)):(t.next=r.next,r.next=t),e.interleaved=t,ro(n,i)}function ro(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var sa=!1;function Hv(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function GE(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function so(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function oa(n,e,t){var i=n.updateQueue;if(i===null)return null;if(i=i.shared,vt&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,ro(n,t)}return r=i.interleaved,r===null?(e.next=e,Vv(i)):(e.next=r.next,r.next=e),i.interleaved=e,ro(n,t)}function im(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,iv(n,t)}}function VE(n,e){var t=n.updateQueue,i=n.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var r=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?r=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?r=s=e:s=s.next=e}else r=s=e;t={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function rm(n,e,t,i){var r=n.updateQueue;sa=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?s=u:o.next=u,o=l;var c=n.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==o&&(a===null?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l))}if(s!==null){var h=r.baseState;o=0,c=u=l=null,a=s;do{var d=a.lane,f=a.eventTime;if((i&d)===d){c!==null&&(c=c.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=n,g=a;switch(d=e,f=t,g.tag){case 1:if(m=g.payload,typeof m=="function"){h=m.call(f,h,d);break e}h=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=g.payload,d=typeof m=="function"?m.call(f,h,d):m,d==null)break e;h=en({},h,d);break e;case 2:sa=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,d=r.effects,d===null?r.effects=[a]:d.push(a))}else f={eventTime:f,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(u=c=f,l=h):c=c.next=f,o|=d;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;d=a,a=d.next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}while(!0);if(c===null&&(l=h),r.baseState=l,r.firstBaseUpdate=u,r.lastBaseUpdate=c,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);ul|=o,n.lanes=o,n.memoizedState=h}}function HE(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var i=n[e],r=i.callback;if(r!==null){if(i.callback=null,i=t,typeof r!="function")throw Error(fe(191,r));r.call(i)}}}var id={},bs=na(id),rd=na(id),sd=na(id);function al(n){if(n===id)throw Error(fe(174));return n}function Wv(n,e){switch(Bt(sd,e),Bt(rd,n),Bt(bs,id),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:$0(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=$0(e,n)}Gt(bs),Bt(bs,e)}function Uu(){Gt(bs),Gt(rd),Gt(sd)}function WE(n){al(sd.current);var e=al(bs.current),t=$0(e,n.type);e!==t&&(Bt(rd,n),Bt(bs,t))}function $v(n){rd.current===n&&(Gt(bs),Gt(rd))}var tn=na(0);function sm(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var jv=[];function Xv(){for(var n=0;n<jv.length;n++)jv[n]._workInProgressVersionPrimary=null;jv.length=0}var om=Js.ReactCurrentDispatcher,qv=Js.ReactCurrentBatchConfig,ll=0,nn=null,Ln=null,zn=null,am=!1,od=!1,ad=0,uO=0;function ii(){throw Error(fe(321))}function Yv(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Qr(n[t],e[t]))return!1;return!0}function Kv(n,e,t,i,r,s){if(ll=s,nn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,om.current=n===null||n.memoizedState===null?fO:pO,n=t(i,r),od){s=0;do{if(od=!1,ad=0,25<=s)throw Error(fe(301));s+=1,zn=Ln=null,e.updateQueue=null,om.current=mO,n=t(i,r)}while(od)}if(om.current=cm,e=Ln!==null&&Ln.next!==null,ll=0,zn=Ln=nn=null,am=!1,e)throw Error(fe(300));return n}function Qv(){var n=ad!==0;return ad=0,n}function ws(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return zn===null?nn.memoizedState=zn=n:zn=zn.next=n,zn}function Ir(){if(Ln===null){var n=nn.alternate;n=n!==null?n.memoizedState:null}else n=Ln.next;var e=zn===null?nn.memoizedState:zn.next;if(e!==null)zn=e,Ln=n;else{if(n===null)throw Error(fe(310));Ln=n,n={memoizedState:Ln.memoizedState,baseState:Ln.baseState,baseQueue:Ln.baseQueue,queue:Ln.queue,next:null},zn===null?nn.memoizedState=zn=n:zn=zn.next=n}return zn}function ld(n,e){return typeof e=="function"?e(n):e}function Zv(n){var e=Ir(),t=e.queue;if(t===null)throw Error(fe(311));t.lastRenderedReducer=n;var i=Ln,r=i.baseQueue,s=t.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,t.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,l=null,u=s;do{var c=u.lane;if((ll&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:n(i,u.action);else{var h={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=h,o=i):l=l.next=h,nn.lanes|=c,ul|=c}u=u.next}while(u!==null&&u!==s);l===null?o=i:l.next=a,Qr(i,e.memoizedState)||(Oi=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,t.lastRenderedState=i}if(n=t.interleaved,n!==null){r=n;do s=r.lane,nn.lanes|=s,ul|=s,r=r.next;while(r!==n)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Jv(n){var e=Ir(),t=e.queue;if(t===null)throw Error(fe(311));t.lastRenderedReducer=n;var i=t.dispatch,r=t.pending,s=e.memoizedState;if(r!==null){t.pending=null;var o=r=r.next;do s=n(s,o.action),o=o.next;while(o!==r);Qr(s,e.memoizedState)||(Oi=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,i]}function $E(){}function jE(n,e){var t=nn,i=Ir(),r=e(),s=!Qr(i.memoizedState,r);if(s&&(i.memoizedState=r,Oi=!0),i=i.queue,ey(YE.bind(null,t,i,n),[n]),i.getSnapshot!==e||s||zn!==null&&zn.memoizedState.tag&1){if(t.flags|=2048,ud(9,qE.bind(null,t,i,r,e),void 0,null),Gn===null)throw Error(fe(349));ll&30||XE(t,e,r)}return r}function XE(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=nn.updateQueue,e===null?(e={lastEffect:null,stores:null},nn.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function qE(n,e,t,i){e.value=t,e.getSnapshot=i,KE(e)&&QE(n)}function YE(n,e,t){return t(function(){KE(e)&&QE(n)})}function KE(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Qr(n,t)}catch{return!0}}function QE(n){var e=ro(n,1);e!==null&&ns(e,n,1,-1)}function ZE(n){var e=ws();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ld,lastRenderedState:n},e.queue=n,n=n.dispatch=dO.bind(null,nn,n),[e.memoizedState,n]}function ud(n,e,t,i){return n={tag:n,create:e,destroy:t,deps:i,next:null},e=nn.updateQueue,e===null?(e={lastEffect:null,stores:null},nn.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(i=t.next,t.next=n,n.next=i,e.lastEffect=n)),n}function JE(){return Ir().memoizedState}function lm(n,e,t,i){var r=ws();nn.flags|=n,r.memoizedState=ud(1|e,t,void 0,i===void 0?null:i)}function um(n,e,t,i){var r=Ir();i=i===void 0?null:i;var s=void 0;if(Ln!==null){var o=Ln.memoizedState;if(s=o.destroy,i!==null&&Yv(i,o.deps)){r.memoizedState=ud(e,t,s,i);return}}nn.flags|=n,r.memoizedState=ud(1|e,t,s,i)}function e1(n,e){return lm(8390656,8,n,e)}function ey(n,e){return um(2048,8,n,e)}function t1(n,e){return um(4,2,n,e)}function n1(n,e){return um(4,4,n,e)}function i1(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function r1(n,e,t){return t=t!=null?t.concat([n]):null,um(4,4,i1.bind(null,e,n),t)}function ty(){}function s1(n,e){var t=Ir();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&Yv(e,i[1])?i[0]:(t.memoizedState=[n,e],n)}function o1(n,e){var t=Ir();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&Yv(e,i[1])?i[0]:(n=n(),t.memoizedState=[n,e],n)}function a1(n,e,t){return ll&21?(Qr(t,e)||(t=OM(),nn.lanes|=t,ul|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Oi=!0),n.memoizedState=t)}function cO(n,e){var t=Dt;Dt=t!==0&&4>t?t:4,n(!0);var i=qv.transition;qv.transition={};try{n(!1),e()}finally{Dt=t,qv.transition=i}}function l1(){return Ir().memoizedState}function hO(n,e,t){var i=ca(n);if(t={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null},u1(n))c1(e,t);else if(t=zE(n,e,t,i),t!==null){var r=Si();ns(t,n,i,r),h1(t,e,i)}}function dO(n,e,t){var i=ca(n),r={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null};if(u1(n))c1(e,r);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(r.hasEagerState=!0,r.eagerState=a,Qr(a,o)){var l=e.interleaved;l===null?(r.next=r,Vv(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}t=zE(n,e,r,i),t!==null&&(r=Si(),ns(t,n,i,r),h1(t,e,i))}}function u1(n){var e=n.alternate;return n===nn||e!==null&&e===nn}function c1(n,e){od=am=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function h1(n,e,t){if(t&4194240){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,iv(n,t)}}var cm={readContext:Lr,useCallback:ii,useContext:ii,useEffect:ii,useImperativeHandle:ii,useInsertionEffect:ii,useLayoutEffect:ii,useMemo:ii,useReducer:ii,useRef:ii,useState:ii,useDebugValue:ii,useDeferredValue:ii,useTransition:ii,useMutableSource:ii,useSyncExternalStore:ii,useId:ii,unstable_isNewReconciler:!1},fO={readContext:Lr,useCallback:function(n,e){return ws().memoizedState=[n,e===void 0?null:e],n},useContext:Lr,useEffect:e1,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,lm(4194308,4,i1.bind(null,e,n),t)},useLayoutEffect:function(n,e){return lm(4194308,4,n,e)},useInsertionEffect:function(n,e){return lm(4,2,n,e)},useMemo:function(n,e){var t=ws();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var i=ws();return e=t!==void 0?t(e):e,i.memoizedState=i.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},i.queue=n,n=n.dispatch=hO.bind(null,nn,n),[i.memoizedState,n]},useRef:function(n){var e=ws();return n={current:n},e.memoizedState=n},useState:ZE,useDebugValue:ty,useDeferredValue:function(n){return ws().memoizedState=n},useTransition:function(){var n=ZE(!1),e=n[0];return n=cO.bind(null,n[1]),ws().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var i=nn,r=ws();if(jt){if(t===void 0)throw Error(fe(407));t=t()}else{if(t=e(),Gn===null)throw Error(fe(349));ll&30||XE(i,e,t)}r.memoizedState=t;var s={value:t,getSnapshot:e};return r.queue=s,e1(YE.bind(null,i,s,n),[n]),i.flags|=2048,ud(9,qE.bind(null,i,s,t,e),void 0,null),t},useId:function(){var n=ws(),e=Gn.identifierPrefix;if(jt){var t=io,i=no;t=(i&~(1<<32-Kr(i)-1)).toString(32)+t,e=":"+e+"R"+t,t=ad++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=uO++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},pO={readContext:Lr,useCallback:s1,useContext:Lr,useEffect:ey,useImperativeHandle:r1,useInsertionEffect:t1,useLayoutEffect:n1,useMemo:o1,useReducer:Zv,useRef:JE,useState:function(){return Zv(ld)},useDebugValue:ty,useDeferredValue:function(n){var e=Ir();return a1(e,Ln.memoizedState,n)},useTransition:function(){var n=Zv(ld)[0],e=Ir().memoizedState;return[n,e]},useMutableSource:$E,useSyncExternalStore:jE,useId:l1,unstable_isNewReconciler:!1},mO={readContext:Lr,useCallback:s1,useContext:Lr,useEffect:ey,useImperativeHandle:r1,useInsertionEffect:t1,useLayoutEffect:n1,useMemo:o1,useReducer:Jv,useRef:JE,useState:function(){return Jv(ld)},useDebugValue:ty,useDeferredValue:function(n){var e=Ir();return Ln===null?e.memoizedState=n:a1(e,Ln.memoizedState,n)},useTransition:function(){var n=Jv(ld)[0],e=Ir().memoizedState;return[n,e]},useMutableSource:$E,useSyncExternalStore:jE,useId:l1,unstable_isNewReconciler:!1};function Jr(n,e){if(n&&n.defaultProps){e=en({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function ny(n,e,t,i){e=n.memoizedState,t=t(i,e),t=t==null?e:en({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var hm={isMounted:function(n){return(n=n._reactInternals)?tl(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var i=Si(),r=ca(n),s=so(i,r);s.payload=e,t!=null&&(s.callback=t),e=oa(n,s,r),e!==null&&(ns(e,n,r,i),im(e,n,r))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var i=Si(),r=ca(n),s=so(i,r);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=oa(n,s,r),e!==null&&(ns(e,n,r,i),im(e,n,r))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Si(),i=ca(n),r=so(t,i);r.tag=2,e!=null&&(r.callback=e),e=oa(n,r,i),e!==null&&(ns(e,n,i,t),im(e,n,i))}};function d1(n,e,t,i,r,s,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!Yh(t,i)||!Yh(r,s):!0}function f1(n,e,t){var i=!1,r=ia,s=e.contextType;return typeof s=="object"&&s!==null?s=Lr(s):(r=Fi(e)?il:ni.current,i=e.contextTypes,s=(i=i!=null)?Cu(n,r):ia),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=hm,n.stateNode=e,e._reactInternals=n,i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=s),e}function p1(n,e,t,i){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==n&&hm.enqueueReplaceState(e,e.state,null)}function iy(n,e,t,i){var r=n.stateNode;r.props=t,r.state=n.memoizedState,r.refs={},Hv(n);var s=e.contextType;typeof s=="object"&&s!==null?r.context=Lr(s):(s=Fi(e)?il:ni.current,r.context=Cu(n,s)),r.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(ny(n,e,s,t),r.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&hm.enqueueReplaceState(r,r.state,null),rm(n,t,r,i),r.state=n.memoizedState),typeof r.componentDidMount=="function"&&(n.flags|=4194308)}function Fu(n,e){try{var t="",i=e;do t+=HU(i),i=i.return;while(i);var r=t}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:r,digest:null}}function ry(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function sy(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var gO=typeof WeakMap=="function"?WeakMap:Map;function m1(n,e,t){t=so(-1,t),t.tag=3,t.payload={element:null};var i=e.value;return t.callback=function(){vm||(vm=!0,xy=i),sy(n,e)},t}function g1(n,e,t){t=so(-1,t),t.tag=3;var i=n.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;t.payload=function(){return i(r)},t.callback=function(){sy(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){sy(n,e),typeof i!="function"&&(la===null?la=new Set([this]):la.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function _1(n,e,t){var i=n.pingCache;if(i===null){i=n.pingCache=new gO;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(t)||(r.add(t),n=NO.bind(null,n,e,t),e.then(n,n))}function v1(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function y1(n,e,t,i,r){return n.mode&1?(n.flags|=65536,n.lanes=r,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=so(-1,1),e.tag=2,oa(t,e,1))),t.lanes|=1),n)}var _O=Js.ReactCurrentOwner,Oi=!1;function xi(n,e,t,i){e.child=n===null?kE(e,null,t,i):Du(e,n.child,t,i)}function x1(n,e,t,i,r){t=t.render;var s=e.ref;return Iu(e,r),i=Kv(n,e,t,i,s,r),t=Qv(),n!==null&&!Oi?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,oo(n,e,r)):(jt&&t&&Lv(e),e.flags|=1,xi(n,e,i,r),e.child)}function S1(n,e,t,i,r){if(n===null){var s=t.type;return typeof s=="function"&&!Ay(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,T1(n,e,s,i,r)):(n=wm(t.type,null,i,e,e.mode,r),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&r)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:Yh,t(o,i)&&n.ref===e.ref)return oo(n,e,r)}return e.flags|=1,n=da(s,i),n.ref=e.ref,n.return=e,e.child=n}function T1(n,e,t,i,r){if(n!==null){var s=n.memoizedProps;if(Yh(s,i)&&n.ref===e.ref)if(Oi=!1,e.pendingProps=i=s,(n.lanes&r)!==0)n.flags&131072&&(Oi=!0);else return e.lanes=n.lanes,oo(n,e,r)}return oy(n,e,t,i,r)}function b1(n,e,t){var i=e.pendingProps,r=i.children,s=n!==null?n.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Bt(Bu,hr),hr|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Bt(Bu,hr),hr|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:t,Bt(Bu,hr),hr|=i}else s!==null?(i=s.baseLanes|t,e.memoizedState=null):i=t,Bt(Bu,hr),hr|=i;return xi(n,e,r,t),e.child}function w1(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function oy(n,e,t,i,r){var s=Fi(t)?il:ni.current;return s=Cu(e,s),Iu(e,r),t=Kv(n,e,t,i,s,r),i=Qv(),n!==null&&!Oi?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,oo(n,e,r)):(jt&&i&&Lv(e),e.flags|=1,xi(n,e,t,r),e.child)}function M1(n,e,t,i,r){if(Fi(t)){var s=!0;Yp(e)}else s=!1;if(Iu(e,r),e.stateNode===null)fm(n,e),f1(e,t,i),iy(e,t,i,r),i=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=Lr(u):(u=Fi(t)?il:ni.current,u=Cu(e,u));var c=t.getDerivedStateFromProps,h=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==u)&&p1(e,o,i,u),sa=!1;var d=e.memoizedState;o.state=d,rm(e,i,o,r),l=e.memoizedState,a!==i||d!==l||Ui.current||sa?(typeof c=="function"&&(ny(e,t,c,i),l=e.memoizedState),(a=sa||d1(e,t,a,i,d,l,u))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=u,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,GE(n,e),a=e.memoizedProps,u=e.type===e.elementType?a:Jr(e.type,a),o.props=u,h=e.pendingProps,d=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=Lr(l):(l=Fi(t)?il:ni.current,l=Cu(e,l));var f=t.getDerivedStateFromProps;(c=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||d!==l)&&p1(e,o,i,l),sa=!1,d=e.memoizedState,o.state=d,rm(e,i,o,r);var m=e.memoizedState;a!==h||d!==m||Ui.current||sa?(typeof f=="function"&&(ny(e,t,f,i),m=e.memoizedState),(u=sa||d1(e,t,u,i,d,m,l)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,m,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,m,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=m),o.props=i,o.state=m,o.context=l,i=u):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=1024),i=!1)}return ay(n,e,t,i,s,r)}function ay(n,e,t,i,r,s){w1(n,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&NE(e,t,!1),oo(n,e,s);i=e.stateNode,_O.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,n!==null&&o?(e.child=Du(e,n.child,null,s),e.child=Du(e,null,a,s)):xi(n,e,a,s),e.memoizedState=i.state,r&&NE(e,t,!0),e.child}function E1(n){var e=n.stateNode;e.pendingContext?CE(n,e.pendingContext,e.pendingContext!==e.context):e.context&&CE(n,e.context,!1),Wv(n,e.containerInfo)}function A1(n,e,t,i,r){return Pu(),Ov(r),e.flags|=256,xi(n,e,t,i),e.child}var ly={dehydrated:null,treeContext:null,retryLane:0};function uy(n){return{baseLanes:n,cachePool:null,transitions:null}}function C1(n,e,t){var i=e.pendingProps,r=tn.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(r|=1),Bt(tn,r&1),n===null)return Fv(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,n=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Mm(o,i,0,null),n=fl(n,i,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=uy(t),e.memoizedState=ly,n):cy(e,o));if(r=n.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return vO(n,e,o,i,a,r,t);if(s){s=i.fallback,o=e.mode,r=n.child,a=r.sibling;var l={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=da(r,l),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=da(a,s):(s=fl(s,o,t,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=n.child.memoizedState,o=o===null?uy(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=n.childLanes&~t,e.memoizedState=ly,i}return s=n.child,n=s.sibling,i=da(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=t),i.return=e,i.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=i,e.memoizedState=null,i}function cy(n,e){return e=Mm({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function dm(n,e,t,i){return i!==null&&Ov(i),Du(e,n.child,null,t),n=cy(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function vO(n,e,t,i,r,s,o){if(t)return e.flags&256?(e.flags&=-257,i=ry(Error(fe(422))),dm(n,e,o,i)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=Mm({mode:"visible",children:i.children},r,0,null),s=fl(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&Du(e,n.child,null,o),e.child.memoizedState=uy(o),e.memoizedState=ly,s);if(!(e.mode&1))return dm(n,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(fe(419)),i=ry(s,i,void 0),dm(n,e,o,i)}if(a=(o&n.childLanes)!==0,Oi||a){if(i=Gn,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,ro(n,r),ns(i,n,r,-1))}return Ey(),i=ry(Error(fe(421))),dm(n,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=n.child,e=PO.bind(null,n),r._reactRetry=e,null):(n=s.treeContext,cr=ta(r.nextSibling),ur=e,jt=!0,Zr=null,n!==null&&(Pr[Dr++]=no,Pr[Dr++]=io,Pr[Dr++]=rl,no=n.id,io=n.overflow,rl=e),e=cy(e,i.children),e.flags|=4096,e)}function R1(n,e,t){n.lanes|=e;var i=n.alternate;i!==null&&(i.lanes|=e),Gv(n.return,e,t)}function hy(n,e,t,i,r){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=t,s.tailMode=r)}function N1(n,e,t){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(xi(n,e,i.children,t),i=tn.current,i&2)i=i&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&R1(n,t,e);else if(n.tag===19)R1(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}i&=1}if(Bt(tn,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)n=t.alternate,n!==null&&sm(n)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),hy(e,!1,r,t,s);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(n=r.alternate,n!==null&&sm(n)===null){e.child=r;break}n=r.sibling,r.sibling=t,t=r,r=n}hy(e,!0,t,null,s);break;case"together":hy(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function fm(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function oo(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),ul|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(fe(153));if(e.child!==null){for(n=e.child,t=da(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=da(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function yO(n,e,t){switch(e.tag){case 3:E1(e),Pu();break;case 5:WE(e);break;case 1:Fi(e.type)&&Yp(e);break;case 4:Wv(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;Bt(tm,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(Bt(tn,tn.current&1),e.flags|=128,null):t&e.child.childLanes?C1(n,e,t):(Bt(tn,tn.current&1),n=oo(n,e,t),n!==null?n.sibling:null);Bt(tn,tn.current&1);break;case 19:if(i=(t&e.childLanes)!==0,n.flags&128){if(i)return N1(n,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Bt(tn,tn.current),i)break;return null;case 22:case 23:return e.lanes=0,b1(n,e,t)}return oo(n,e,t)}var P1,dy,D1,L1;P1=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}},dy=function(){},D1=function(n,e,t,i){var r=n.memoizedProps;if(r!==i){n=e.stateNode,al(bs.current);var s=null;switch(t){case"input":r=G0(n,r),i=G0(n,i),s=[];break;case"select":r=en({},r,{value:void 0}),i=en({},i,{value:void 0}),s=[];break;case"textarea":r=W0(n,r),i=W0(n,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(n.onclick=jp)}j0(t,i);var o;t=null;for(u in r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var a=r[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Ch.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in i){var l=i[u];if(a=r!=null?r[u]:void 0,i.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(s||(s=[]),s.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Ch.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&zt("scroll",n),s||a===l||(s=[])):(s=s||[]).push(u,l))}t&&(s=s||[]).push("style",t);var u=s;(e.updateQueue=u)&&(e.flags|=4)}},L1=function(n,e,t,i){t!==i&&(e.flags|=4)};function cd(n,e){if(!jt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:i.sibling=null}}function ri(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,i=0;if(e)for(var r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=n,r=r.sibling;else for(r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=n,r=r.sibling;return n.subtreeFlags|=i,n.childLanes=t,e}function xO(n,e,t){var i=e.pendingProps;switch(Iv(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ri(e),null;case 1:return Fi(e.type)&&qp(),ri(e),null;case 3:return i=e.stateNode,Uu(),Gt(Ui),Gt(ni),Xv(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(n===null||n.child===null)&&(Jp(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Zr!==null&&(by(Zr),Zr=null))),dy(n,e),ri(e),null;case 5:$v(e);var r=al(sd.current);if(t=e.type,n!==null&&e.stateNode!=null)D1(n,e,t,i,r),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(fe(166));return ri(e),null}if(n=al(bs.current),Jp(e)){i=e.stateNode,t=e.type;var s=e.memoizedProps;switch(i[Ts]=e,i[ed]=s,n=(e.mode&1)!==0,t){case"dialog":zt("cancel",i),zt("close",i);break;case"iframe":case"object":case"embed":zt("load",i);break;case"video":case"audio":for(r=0;r<Qh.length;r++)zt(Qh[r],i);break;case"source":zt("error",i);break;case"img":case"image":case"link":zt("error",i),zt("load",i);break;case"details":zt("toggle",i);break;case"input":fM(i,s),zt("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},zt("invalid",i);break;case"textarea":gM(i,s),zt("invalid",i)}j0(t,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&$p(i.textContent,a,n),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&$p(i.textContent,a,n),r=["children",""+a]):Ch.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&zt("scroll",i)}switch(t){case"input":Tp(i),mM(i,s,!0);break;case"textarea":Tp(i),vM(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=jp)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=yM(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof i.is=="string"?n=o.createElement(t,{is:i.is}):(n=o.createElement(t),t==="select"&&(o=n,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):n=o.createElementNS(n,t),n[Ts]=e,n[ed]=i,P1(n,e,!1,!1),e.stateNode=n;e:{switch(o=X0(t,i),t){case"dialog":zt("cancel",n),zt("close",n),r=i;break;case"iframe":case"object":case"embed":zt("load",n),r=i;break;case"video":case"audio":for(r=0;r<Qh.length;r++)zt(Qh[r],n);r=i;break;case"source":zt("error",n),r=i;break;case"img":case"image":case"link":zt("error",n),zt("load",n),r=i;break;case"details":zt("toggle",n),r=i;break;case"input":fM(n,i),r=G0(n,i),zt("invalid",n);break;case"option":r=i;break;case"select":n._wrapperState={wasMultiple:!!i.multiple},r=en({},i,{value:void 0}),zt("invalid",n);break;case"textarea":gM(n,i),r=W0(n,i),zt("invalid",n);break;default:r=i}j0(t,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?TM(n,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&xM(n,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Dh(n,l):typeof l=="number"&&Dh(n,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Ch.hasOwnProperty(s)?l!=null&&s==="onScroll"&&zt("scroll",n):l!=null&&N0(n,s,l,o))}switch(t){case"input":Tp(n),mM(n,i,!1);break;case"textarea":Tp(n),vM(n);break;case"option":i.value!=null&&n.setAttribute("value",""+qo(i.value));break;case"select":n.multiple=!!i.multiple,s=i.value,s!=null?gu(n,!!i.multiple,s,!1):i.defaultValue!=null&&gu(n,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(n.onclick=jp)}switch(t){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ri(e),null;case 6:if(n&&e.stateNode!=null)L1(n,e,n.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(fe(166));if(t=al(sd.current),al(bs.current),Jp(e)){if(i=e.stateNode,t=e.memoizedProps,i[Ts]=e,(s=i.nodeValue!==t)&&(n=ur,n!==null))switch(n.tag){case 3:$p(i.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&$p(i.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else i=(t.nodeType===9?t:t.ownerDocument).createTextNode(i),i[Ts]=e,e.stateNode=i}return ri(e),null;case 13:if(Gt(tn),i=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(jt&&cr!==null&&e.mode&1&&!(e.flags&128))FE(),Pu(),e.flags|=98560,s=!1;else if(s=Jp(e),i!==null&&i.dehydrated!==null){if(n===null){if(!s)throw Error(fe(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(fe(317));s[Ts]=e}else Pu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ri(e),s=!1}else Zr!==null&&(by(Zr),Zr=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(i=i!==null,i!==(n!==null&&n.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(n===null||tn.current&1?In===0&&(In=3):Ey())),e.updateQueue!==null&&(e.flags|=4),ri(e),null);case 4:return Uu(),dy(n,e),n===null&&Zh(e.stateNode.containerInfo),ri(e),null;case 10:return zv(e.type._context),ri(e),null;case 17:return Fi(e.type)&&qp(),ri(e),null;case 19:if(Gt(tn),s=e.memoizedState,s===null)return ri(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)cd(s,!1);else{if(In!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=sm(n),o!==null){for(e.flags|=128,cd(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=t,t=e.child;t!==null;)s=t,n=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,n=o.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Bt(tn,tn.current&1|2),e.child}n=n.sibling}s.tail!==null&&pn()>ku&&(e.flags|=128,i=!0,cd(s,!1),e.lanes=4194304)}else{if(!i)if(n=sm(o),n!==null){if(e.flags|=128,i=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),cd(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!jt)return ri(e),null}else 2*pn()-s.renderingStartTime>ku&&t!==1073741824&&(e.flags|=128,i=!0,cd(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=pn(),e.sibling=null,t=tn.current,Bt(tn,i?t&1|2:t&1),e):(ri(e),null);case 22:case 23:return My(),i=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?hr&1073741824&&(ri(e),e.subtreeFlags&6&&(e.flags|=8192)):ri(e),null;case 24:return null;case 25:return null}throw Error(fe(156,e.tag))}function SO(n,e){switch(Iv(e),e.tag){case 1:return Fi(e.type)&&qp(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Uu(),Gt(Ui),Gt(ni),Xv(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return $v(e),null;case 13:if(Gt(tn),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(fe(340));Pu()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Gt(tn),null;case 4:return Uu(),null;case 10:return zv(e.type._context),null;case 22:case 23:return My(),null;case 24:return null;default:return null}}var pm=!1,si=!1,TO=typeof WeakSet=="function"?WeakSet:Set,Ae=null;function Ou(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(i){un(n,e,i)}else t.current=null}function fy(n,e,t){try{t()}catch(i){un(n,e,i)}}var I1=!1;function bO(n,e){if(Mv=Ip,n=dE(),_v(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var i=t.getSelection&&t.getSelection();if(i&&i.rangeCount!==0){t=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,u=0,c=0,h=n,d=null;t:for(;;){for(var f;h!==t||r!==0&&h.nodeType!==3||(a=o+r),h!==s||i!==0&&h.nodeType!==3||(l=o+i),h.nodeType===3&&(o+=h.nodeValue.length),(f=h.firstChild)!==null;)d=h,h=f;for(;;){if(h===n)break t;if(d===t&&++u===r&&(a=o),d===s&&++c===i&&(l=o),(f=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=f}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(Ev={focusedElem:n,selectionRange:t},Ip=!1,Ae=e;Ae!==null;)if(e=Ae,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,Ae=n;else for(;Ae!==null;){e=Ae;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var g=m.memoizedProps,_=m.memoizedState,p=e.stateNode,v=p.getSnapshotBeforeUpdate(e.elementType===e.type?g:Jr(e.type,g),_);p.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var y=e.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(fe(163))}}catch(x){un(e,e.return,x)}if(n=e.sibling,n!==null){n.return=e.return,Ae=n;break}Ae=e.return}return m=I1,I1=!1,m}function hd(n,e,t){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&n)===n){var s=r.destroy;r.destroy=void 0,s!==void 0&&fy(e,t,s)}r=r.next}while(r!==i)}}function mm(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var i=t.create;t.destroy=i()}t=t.next}while(t!==e)}}function py(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function U1(n){var e=n.alternate;e!==null&&(n.alternate=null,U1(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Ts],delete e[ed],delete e[Nv],delete e[sO],delete e[oO])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function F1(n){return n.tag===5||n.tag===3||n.tag===4}function O1(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||F1(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function my(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=jp));else if(i!==4&&(n=n.child,n!==null))for(my(n,e,t),n=n.sibling;n!==null;)my(n,e,t),n=n.sibling}function gy(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(i!==4&&(n=n.child,n!==null))for(gy(n,e,t),n=n.sibling;n!==null;)gy(n,e,t),n=n.sibling}var qn=null,es=!1;function aa(n,e,t){for(t=t.child;t!==null;)B1(n,e,t),t=t.sibling}function B1(n,e,t){if(Ss&&typeof Ss.onCommitFiberUnmount=="function")try{Ss.onCommitFiberUnmount(Cp,t)}catch{}switch(t.tag){case 5:si||Ou(t,e);case 6:var i=qn,r=es;qn=null,aa(n,e,t),qn=i,es=r,qn!==null&&(es?(n=qn,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):qn.removeChild(t.stateNode));break;case 18:qn!==null&&(es?(n=qn,t=t.stateNode,n.nodeType===8?Rv(n.parentNode,t):n.nodeType===1&&Rv(n,t),Hh(n)):Rv(qn,t.stateNode));break;case 4:i=qn,r=es,qn=t.stateNode.containerInfo,es=!0,aa(n,e,t),qn=i,es=r;break;case 0:case 11:case 14:case 15:if(!si&&(i=t.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&fy(t,e,o),r=r.next}while(r!==i)}aa(n,e,t);break;case 1:if(!si&&(Ou(t,e),i=t.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=t.memoizedProps,i.state=t.memoizedState,i.componentWillUnmount()}catch(a){un(t,e,a)}aa(n,e,t);break;case 21:aa(n,e,t);break;case 22:t.mode&1?(si=(i=si)||t.memoizedState!==null,aa(n,e,t),si=i):aa(n,e,t);break;default:aa(n,e,t)}}function k1(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new TO),e.forEach(function(i){var r=DO.bind(null,n,i);t.has(i)||(t.add(i),i.then(r,r))})}}function ts(n,e){var t=e.deletions;if(t!==null)for(var i=0;i<t.length;i++){var r=t[i];try{var s=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:qn=a.stateNode,es=!1;break e;case 3:qn=a.stateNode.containerInfo,es=!0;break e;case 4:qn=a.stateNode.containerInfo,es=!0;break e}a=a.return}if(qn===null)throw Error(fe(160));B1(s,o,r),qn=null,es=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(u){un(r,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)z1(e,n),e=e.sibling}function z1(n,e){var t=n.alternate,i=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(ts(e,n),Ms(n),i&4){try{hd(3,n,n.return),mm(3,n)}catch(g){un(n,n.return,g)}try{hd(5,n,n.return)}catch(g){un(n,n.return,g)}}break;case 1:ts(e,n),Ms(n),i&512&&t!==null&&Ou(t,t.return);break;case 5:if(ts(e,n),Ms(n),i&512&&t!==null&&Ou(t,t.return),n.flags&32){var r=n.stateNode;try{Dh(r,"")}catch(g){un(n,n.return,g)}}if(i&4&&(r=n.stateNode,r!=null)){var s=n.memoizedProps,o=t!==null?t.memoizedProps:s,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&pM(r,s),X0(a,o);var u=X0(a,s);for(o=0;o<l.length;o+=2){var c=l[o],h=l[o+1];c==="style"?TM(r,h):c==="dangerouslySetInnerHTML"?xM(r,h):c==="children"?Dh(r,h):N0(r,c,h,u)}switch(a){case"input":V0(r,s);break;case"textarea":_M(r,s);break;case"select":var d=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var f=s.value;f!=null?gu(r,!!s.multiple,f,!1):d!==!!s.multiple&&(s.defaultValue!=null?gu(r,!!s.multiple,s.defaultValue,!0):gu(r,!!s.multiple,s.multiple?[]:"",!1))}r[ed]=s}catch(g){un(n,n.return,g)}}break;case 6:if(ts(e,n),Ms(n),i&4){if(n.stateNode===null)throw Error(fe(162));r=n.stateNode,s=n.memoizedProps;try{r.nodeValue=s}catch(g){un(n,n.return,g)}}break;case 3:if(ts(e,n),Ms(n),i&4&&t!==null&&t.memoizedState.isDehydrated)try{Hh(e.containerInfo)}catch(g){un(n,n.return,g)}break;case 4:ts(e,n),Ms(n);break;case 13:ts(e,n),Ms(n),r=n.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(yy=pn())),i&4&&k1(n);break;case 22:if(c=t!==null&&t.memoizedState!==null,n.mode&1?(si=(u=si)||c,ts(e,n),si=u):ts(e,n),Ms(n),i&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!c&&n.mode&1)for(Ae=n,c=n.child;c!==null;){for(h=Ae=c;Ae!==null;){switch(d=Ae,f=d.child,d.tag){case 0:case 11:case 14:case 15:hd(4,d,d.return);break;case 1:Ou(d,d.return);var m=d.stateNode;if(typeof m.componentWillUnmount=="function"){i=d,t=d.return;try{e=i,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(g){un(i,t,g)}}break;case 5:Ou(d,d.return);break;case 22:if(d.memoizedState!==null){H1(h);continue}}f!==null?(f.return=d,Ae=f):H1(h)}c=c.sibling}e:for(c=null,h=n;;){if(h.tag===5){if(c===null){c=h;try{r=h.stateNode,u?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=SM("display",o))}catch(g){un(n,n.return,g)}}}else if(h.tag===6){if(c===null)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(g){un(n,n.return,g)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===n)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===n)break e;for(;h.sibling===null;){if(h.return===null||h.return===n)break e;c===h&&(c=null),h=h.return}c===h&&(c=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:ts(e,n),Ms(n),i&4&&k1(n);break;case 21:break;default:ts(e,n),Ms(n)}}function Ms(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(F1(t)){var i=t;break e}t=t.return}throw Error(fe(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Dh(r,""),i.flags&=-33);var s=O1(n);gy(n,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=O1(n);my(n,a,o);break;default:throw Error(fe(161))}}catch(l){un(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function wO(n,e,t){Ae=n,G1(n)}function G1(n,e,t){for(var i=(n.mode&1)!==0;Ae!==null;){var r=Ae,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||pm;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||si;a=pm;var u=si;if(pm=o,(si=l)&&!u)for(Ae=r;Ae!==null;)o=Ae,l=o.child,o.tag===22&&o.memoizedState!==null?W1(r):l!==null?(l.return=o,Ae=l):W1(r);for(;s!==null;)Ae=s,G1(s),s=s.sibling;Ae=r,pm=a,si=u}V1(n)}else r.subtreeFlags&8772&&s!==null?(s.return=r,Ae=s):V1(n)}}function V1(n){for(;Ae!==null;){var e=Ae;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:si||mm(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!si)if(t===null)i.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:Jr(e.type,t.memoizedProps);i.componentDidUpdate(r,t.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&HE(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}HE(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var h=c.dehydrated;h!==null&&Hh(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(fe(163))}si||e.flags&512&&py(e)}catch(d){un(e,e.return,d)}}if(e===n){Ae=null;break}if(t=e.sibling,t!==null){t.return=e.return,Ae=t;break}Ae=e.return}}function H1(n){for(;Ae!==null;){var e=Ae;if(e===n){Ae=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Ae=t;break}Ae=e.return}}function W1(n){for(;Ae!==null;){var e=Ae;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{mm(4,e)}catch(l){un(e,t,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){un(e,r,l)}}var s=e.return;try{py(e)}catch(l){un(e,s,l)}break;case 5:var o=e.return;try{py(e)}catch(l){un(e,o,l)}}}catch(l){un(e,e.return,l)}if(e===n){Ae=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Ae=a;break}Ae=e.return}}var MO=Math.ceil,gm=Js.ReactCurrentDispatcher,_y=Js.ReactCurrentOwner,Ur=Js.ReactCurrentBatchConfig,vt=0,Gn=null,xn=null,Yn=0,hr=0,Bu=na(0),In=0,dd=null,ul=0,_m=0,vy=0,fd=null,Bi=null,yy=0,ku=1/0,ao=null,vm=!1,xy=null,la=null,ym=!1,ua=null,xm=0,pd=0,Sy=null,Sm=-1,Tm=0;function Si(){return vt&6?pn():Sm!==-1?Sm:Sm=pn()}function ca(n){return n.mode&1?vt&2&&Yn!==0?Yn&-Yn:lO.transition!==null?(Tm===0&&(Tm=OM()),Tm):(n=Dt,n!==0||(n=window.event,n=n===void 0?16:jM(n.type)),n):1}function ns(n,e,t,i){if(50<pd)throw pd=0,Sy=null,Error(fe(185));Bh(n,t,i),(!(vt&2)||n!==Gn)&&(n===Gn&&(!(vt&2)&&(_m|=t),In===4&&ha(n,Yn)),ki(n,i),t===1&&vt===0&&!(e.mode&1)&&(ku=pn()+500,Kp&&ra()))}function ki(n,e){var t=n.callbackNode;lF(n,e);var i=Pp(n,n===Gn?Yn:0);if(i===0)t!==null&&IM(t),n.callbackNode=null,n.callbackPriority=0;else if(e=i&-i,n.callbackPriority!==e){if(t!=null&&IM(t),e===1)n.tag===0?aO(j1.bind(null,n)):PE(j1.bind(null,n)),iO(function(){!(vt&6)&&ra()}),t=null;else{switch(BM(i)){case 1:t=ev;break;case 4:t=UM;break;case 16:t=Ap;break;case 536870912:t=FM;break;default:t=Ap}t=eA(t,$1.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function $1(n,e){if(Sm=-1,Tm=0,vt&6)throw Error(fe(327));var t=n.callbackNode;if(zu()&&n.callbackNode!==t)return null;var i=Pp(n,n===Gn?Yn:0);if(i===0)return null;if(i&30||i&n.expiredLanes||e)e=bm(n,i);else{e=i;var r=vt;vt|=2;var s=q1();(Gn!==n||Yn!==e)&&(ao=null,ku=pn()+500,hl(n,e));do try{CO();break}catch(a){X1(n,a)}while(!0);kv(),gm.current=s,vt=r,xn!==null?e=0:(Gn=null,Yn=0,e=In)}if(e!==0){if(e===2&&(r=tv(n),r!==0&&(i=r,e=Ty(n,r))),e===1)throw t=dd,hl(n,0),ha(n,i),ki(n,pn()),t;if(e===6)ha(n,i);else{if(r=n.current.alternate,!(i&30)&&!EO(r)&&(e=bm(n,i),e===2&&(s=tv(n),s!==0&&(i=s,e=Ty(n,s))),e===1))throw t=dd,hl(n,0),ha(n,i),ki(n,pn()),t;switch(n.finishedWork=r,n.finishedLanes=i,e){case 0:case 1:throw Error(fe(345));case 2:dl(n,Bi,ao);break;case 3:if(ha(n,i),(i&130023424)===i&&(e=yy+500-pn(),10<e)){if(Pp(n,0)!==0)break;if(r=n.suspendedLanes,(r&i)!==i){Si(),n.pingedLanes|=n.suspendedLanes&r;break}n.timeoutHandle=Cv(dl.bind(null,n,Bi,ao),e);break}dl(n,Bi,ao);break;case 4:if(ha(n,i),(i&4194240)===i)break;for(e=n.eventTimes,r=-1;0<i;){var o=31-Kr(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=pn()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*MO(i/1960))-i,10<i){n.timeoutHandle=Cv(dl.bind(null,n,Bi,ao),i);break}dl(n,Bi,ao);break;case 5:dl(n,Bi,ao);break;default:throw Error(fe(329))}}}return ki(n,pn()),n.callbackNode===t?$1.bind(null,n):null}function Ty(n,e){var t=fd;return n.current.memoizedState.isDehydrated&&(hl(n,e).flags|=256),n=bm(n,e),n!==2&&(e=Bi,Bi=t,e!==null&&by(e)),n}function by(n){Bi===null?Bi=n:Bi.push.apply(Bi,n)}function EO(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var i=0;i<t.length;i++){var r=t[i],s=r.getSnapshot;r=r.value;try{if(!Qr(s(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ha(n,e){for(e&=~vy,e&=~_m,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Kr(e),i=1<<t;n[t]=-1,e&=~i}}function j1(n){if(vt&6)throw Error(fe(327));zu();var e=Pp(n,0);if(!(e&1))return ki(n,pn()),null;var t=bm(n,e);if(n.tag!==0&&t===2){var i=tv(n);i!==0&&(e=i,t=Ty(n,i))}if(t===1)throw t=dd,hl(n,0),ha(n,e),ki(n,pn()),t;if(t===6)throw Error(fe(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,dl(n,Bi,ao),ki(n,pn()),null}function wy(n,e){var t=vt;vt|=1;try{return n(e)}finally{vt=t,vt===0&&(ku=pn()+500,Kp&&ra())}}function cl(n){ua!==null&&ua.tag===0&&!(vt&6)&&zu();var e=vt;vt|=1;var t=Ur.transition,i=Dt;try{if(Ur.transition=null,Dt=1,n)return n()}finally{Dt=i,Ur.transition=t,vt=e,!(vt&6)&&ra()}}function My(){hr=Bu.current,Gt(Bu)}function hl(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,nO(t)),xn!==null)for(t=xn.return;t!==null;){var i=t;switch(Iv(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&qp();break;case 3:Uu(),Gt(Ui),Gt(ni),Xv();break;case 5:$v(i);break;case 4:Uu();break;case 13:Gt(tn);break;case 19:Gt(tn);break;case 10:zv(i.type._context);break;case 22:case 23:My()}t=t.return}if(Gn=n,xn=n=da(n.current,null),Yn=hr=e,In=0,dd=null,vy=_m=ul=0,Bi=fd=null,ol!==null){for(e=0;e<ol.length;e++)if(t=ol[e],i=t.interleaved,i!==null){t.interleaved=null;var r=i.next,s=t.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}t.pending=i}ol=null}return n}function X1(n,e){do{var t=xn;try{if(kv(),om.current=cm,am){for(var i=nn.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}am=!1}if(ll=0,zn=Ln=nn=null,od=!1,ad=0,_y.current=null,t===null||t.return===null){In=1,dd=e,xn=null;break}e:{var s=n,o=t.return,a=t,l=e;if(e=Yn,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=a,h=c.tag;if(!(c.mode&1)&&(h===0||h===11||h===15)){var d=c.alternate;d?(c.updateQueue=d.updateQueue,c.memoizedState=d.memoizedState,c.lanes=d.lanes):(c.updateQueue=null,c.memoizedState=null)}var f=v1(o);if(f!==null){f.flags&=-257,y1(f,o,a,s,e),f.mode&1&&_1(s,u,e),e=f,l=u;var m=e.updateQueue;if(m===null){var g=new Set;g.add(l),e.updateQueue=g}else m.add(l);break e}else{if(!(e&1)){_1(s,u,e),Ey();break e}l=Error(fe(426))}}else if(jt&&a.mode&1){var _=v1(o);if(_!==null){!(_.flags&65536)&&(_.flags|=256),y1(_,o,a,s,e),Ov(Fu(l,a));break e}}s=l=Fu(l,a),In!==4&&(In=2),fd===null?fd=[s]:fd.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var p=m1(s,l,e);VE(s,p);break e;case 1:a=l;var v=s.type,y=s.stateNode;if(!(s.flags&128)&&(typeof v.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(la===null||!la.has(y)))){s.flags|=65536,e&=-e,s.lanes|=e;var x=g1(s,a,e);VE(s,x);break e}}s=s.return}while(s!==null)}K1(t)}catch(S){e=S,xn===t&&t!==null&&(xn=t=t.return);continue}break}while(!0)}function q1(){var n=gm.current;return gm.current=cm,n===null?cm:n}function Ey(){(In===0||In===3||In===2)&&(In=4),Gn===null||!(ul&268435455)&&!(_m&268435455)||ha(Gn,Yn)}function bm(n,e){var t=vt;vt|=2;var i=q1();(Gn!==n||Yn!==e)&&(ao=null,hl(n,e));do try{AO();break}catch(r){X1(n,r)}while(!0);if(kv(),vt=t,gm.current=i,xn!==null)throw Error(fe(261));return Gn=null,Yn=0,In}function AO(){for(;xn!==null;)Y1(xn)}function CO(){for(;xn!==null&&!JU();)Y1(xn)}function Y1(n){var e=J1(n.alternate,n,hr);n.memoizedProps=n.pendingProps,e===null?K1(n):xn=e,_y.current=null}function K1(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=SO(t,e),t!==null){t.flags&=32767,xn=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{In=6,xn=null;return}}else if(t=xO(t,e,hr),t!==null){xn=t;return}if(e=e.sibling,e!==null){xn=e;return}xn=e=n}while(e!==null);In===0&&(In=5)}function dl(n,e,t){var i=Dt,r=Ur.transition;try{Ur.transition=null,Dt=1,RO(n,e,t,i)}finally{Ur.transition=r,Dt=i}return null}function RO(n,e,t,i){do zu();while(ua!==null);if(vt&6)throw Error(fe(327));t=n.finishedWork;var r=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(fe(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(uF(n,s),n===Gn&&(xn=Gn=null,Yn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||ym||(ym=!0,eA(Ap,function(){return zu(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=Ur.transition,Ur.transition=null;var o=Dt;Dt=1;var a=vt;vt|=4,_y.current=null,bO(n,t),z1(t,n),YF(Ev),Ip=!!Mv,Ev=Mv=null,n.current=t,wO(t),eF(),vt=a,Dt=o,Ur.transition=s}else n.current=t;if(ym&&(ym=!1,ua=n,xm=r),s=n.pendingLanes,s===0&&(la=null),iF(t.stateNode),ki(n,pn()),e!==null)for(i=n.onRecoverableError,t=0;t<e.length;t++)r=e[t],i(r.value,{componentStack:r.stack,digest:r.digest});if(vm)throw vm=!1,n=xy,xy=null,n;return xm&1&&n.tag!==0&&zu(),s=n.pendingLanes,s&1?n===Sy?pd++:(pd=0,Sy=n):pd=0,ra(),null}function zu(){if(ua!==null){var n=BM(xm),e=Ur.transition,t=Dt;try{if(Ur.transition=null,Dt=16>n?16:n,ua===null)var i=!1;else{if(n=ua,ua=null,xm=0,vt&6)throw Error(fe(331));var r=vt;for(vt|=4,Ae=n.current;Ae!==null;){var s=Ae,o=s.child;if(Ae.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(Ae=u;Ae!==null;){var c=Ae;switch(c.tag){case 0:case 11:case 15:hd(8,c,s)}var h=c.child;if(h!==null)h.return=c,Ae=h;else for(;Ae!==null;){c=Ae;var d=c.sibling,f=c.return;if(U1(c),c===u){Ae=null;break}if(d!==null){d.return=f,Ae=d;break}Ae=f}}}var m=s.alternate;if(m!==null){var g=m.child;if(g!==null){m.child=null;do{var _=g.sibling;g.sibling=null,g=_}while(g!==null)}}Ae=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,Ae=o;else e:for(;Ae!==null;){if(s=Ae,s.flags&2048)switch(s.tag){case 0:case 11:case 15:hd(9,s,s.return)}var p=s.sibling;if(p!==null){p.return=s.return,Ae=p;break e}Ae=s.return}}var v=n.current;for(Ae=v;Ae!==null;){o=Ae;var y=o.child;if(o.subtreeFlags&2064&&y!==null)y.return=o,Ae=y;else e:for(o=v;Ae!==null;){if(a=Ae,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:mm(9,a)}}catch(S){un(a,a.return,S)}if(a===o){Ae=null;break e}var x=a.sibling;if(x!==null){x.return=a.return,Ae=x;break e}Ae=a.return}}if(vt=r,ra(),Ss&&typeof Ss.onPostCommitFiberRoot=="function")try{Ss.onPostCommitFiberRoot(Cp,n)}catch{}i=!0}return i}finally{Dt=t,Ur.transition=e}}return!1}function Q1(n,e,t){e=Fu(t,e),e=m1(n,e,1),n=oa(n,e,1),e=Si(),n!==null&&(Bh(n,1,e),ki(n,e))}function un(n,e,t){if(n.tag===3)Q1(n,n,t);else for(;e!==null;){if(e.tag===3){Q1(e,n,t);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(la===null||!la.has(i))){n=Fu(t,n),n=g1(e,n,1),e=oa(e,n,1),n=Si(),e!==null&&(Bh(e,1,n),ki(e,n));break}}e=e.return}}function NO(n,e,t){var i=n.pingCache;i!==null&&i.delete(e),e=Si(),n.pingedLanes|=n.suspendedLanes&t,Gn===n&&(Yn&t)===t&&(In===4||In===3&&(Yn&130023424)===Yn&&500>pn()-yy?hl(n,0):vy|=t),ki(n,e)}function Z1(n,e){e===0&&(n.mode&1?(e=Np,Np<<=1,!(Np&130023424)&&(Np=4194304)):e=1);var t=Si();n=ro(n,e),n!==null&&(Bh(n,e,t),ki(n,t))}function PO(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),Z1(n,t)}function DO(n,e){var t=0;switch(n.tag){case 13:var i=n.stateNode,r=n.memoizedState;r!==null&&(t=r.retryLane);break;case 19:i=n.stateNode;break;default:throw Error(fe(314))}i!==null&&i.delete(e),Z1(n,t)}var J1;J1=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Ui.current)Oi=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Oi=!1,yO(n,e,t);Oi=!!(n.flags&131072)}else Oi=!1,jt&&e.flags&1048576&&DE(e,Zp,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;fm(n,e),n=e.pendingProps;var r=Cu(e,ni.current);Iu(e,t),r=Kv(null,e,i,n,r,t);var s=Qv();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Fi(i)?(s=!0,Yp(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Hv(e),r.updater=hm,e.stateNode=r,r._reactInternals=e,iy(e,i,n,t),e=ay(null,e,i,!0,s,t)):(e.tag=0,jt&&s&&Lv(e),xi(null,e,r,t),e=e.child),e;case 16:i=e.elementType;e:{switch(fm(n,e),n=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=IO(i),n=Jr(i,n),r){case 0:e=oy(null,e,i,n,t);break e;case 1:e=M1(null,e,i,n,t);break e;case 11:e=x1(null,e,i,n,t);break e;case 14:e=S1(null,e,i,Jr(i.type,n),t);break e}throw Error(fe(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Jr(i,r),oy(n,e,i,r,t);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Jr(i,r),M1(n,e,i,r,t);case 3:e:{if(E1(e),n===null)throw Error(fe(387));i=e.pendingProps,s=e.memoizedState,r=s.element,GE(n,e),rm(e,i,null,t);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Fu(Error(fe(423)),e),e=A1(n,e,i,t,r);break e}else if(i!==r){r=Fu(Error(fe(424)),e),e=A1(n,e,i,t,r);break e}else for(cr=ta(e.stateNode.containerInfo.firstChild),ur=e,jt=!0,Zr=null,t=kE(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Pu(),i===r){e=oo(n,e,t);break e}xi(n,e,i,t)}e=e.child}return e;case 5:return WE(e),n===null&&Fv(e),i=e.type,r=e.pendingProps,s=n!==null?n.memoizedProps:null,o=r.children,Av(i,r)?o=null:s!==null&&Av(i,s)&&(e.flags|=32),w1(n,e),xi(n,e,o,t),e.child;case 6:return n===null&&Fv(e),null;case 13:return C1(n,e,t);case 4:return Wv(e,e.stateNode.containerInfo),i=e.pendingProps,n===null?e.child=Du(e,null,i,t):xi(n,e,i,t),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Jr(i,r),x1(n,e,i,r,t);case 7:return xi(n,e,e.pendingProps,t),e.child;case 8:return xi(n,e,e.pendingProps.children,t),e.child;case 12:return xi(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,Bt(tm,i._currentValue),i._currentValue=o,s!==null)if(Qr(s.value,o)){if(s.children===r.children&&!Ui.current){e=oo(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=so(-1,t&-t),l.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}s.lanes|=t,l=s.alternate,l!==null&&(l.lanes|=t),Gv(s.return,t,e),a.lanes|=t;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(fe(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),Gv(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}xi(n,e,r.children,t),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,Iu(e,t),r=Lr(r),i=i(r),e.flags|=1,xi(n,e,i,t),e.child;case 14:return i=e.type,r=Jr(i,e.pendingProps),r=Jr(i.type,r),S1(n,e,i,r,t);case 15:return T1(n,e,e.type,e.pendingProps,t);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Jr(i,r),fm(n,e),e.tag=1,Fi(i)?(n=!0,Yp(e)):n=!1,Iu(e,t),f1(e,i,r),iy(e,i,r,t),ay(null,e,i,!0,n,t);case 19:return N1(n,e,t);case 22:return b1(n,e,t)}throw Error(fe(156,e.tag))};function eA(n,e){return LM(n,e)}function LO(n,e,t,i){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Fr(n,e,t,i){return new LO(n,e,t,i)}function Ay(n){return n=n.prototype,!(!n||!n.isReactComponent)}function IO(n){if(typeof n=="function")return Ay(n)?1:0;if(n!=null){if(n=n.$$typeof,n===L0)return 11;if(n===F0)return 14}return 2}function da(n,e){var t=n.alternate;return t===null?(t=Fr(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function wm(n,e,t,i,r,s){var o=2;if(i=n,typeof n=="function")Ay(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case mu:return fl(t.children,r,s,e);case P0:o=8,r|=8;break;case D0:return n=Fr(12,t,e,r|2),n.elementType=D0,n.lanes=s,n;case I0:return n=Fr(13,t,e,r),n.elementType=I0,n.lanes=s,n;case U0:return n=Fr(19,t,e,r),n.elementType=U0,n.lanes=s,n;case uM:return Mm(t,r,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case aM:o=10;break e;case lM:o=9;break e;case L0:o=11;break e;case F0:o=14;break e;case Xo:o=16,i=null;break e}throw Error(fe(130,n==null?n:typeof n,""))}return e=Fr(o,t,e,r),e.elementType=n,e.type=i,e.lanes=s,e}function fl(n,e,t,i){return n=Fr(7,n,i,e),n.lanes=t,n}function Mm(n,e,t,i){return n=Fr(22,n,i,e),n.elementType=uM,n.lanes=t,n.stateNode={isHidden:!1},n}function Cy(n,e,t){return n=Fr(6,n,null,e),n.lanes=t,n}function Ry(n,e,t){return e=Fr(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function UO(n,e,t,i,r){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=nv(0),this.expirationTimes=nv(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=nv(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Ny(n,e,t,i,r,s,o,a,l){return n=new UO(n,e,t,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Fr(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:i,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Hv(s),n}function FO(n,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:pu,key:i==null?null:""+i,children:n,containerInfo:e,implementation:t}}function tA(n){if(!n)return ia;n=n._reactInternals;e:{if(tl(n)!==n||n.tag!==1)throw Error(fe(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Fi(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(fe(171))}if(n.tag===1){var t=n.type;if(Fi(t))return RE(n,t,e)}return e}function nA(n,e,t,i,r,s,o,a,l){return n=Ny(t,i,!0,n,r,s,o,a,l),n.context=tA(null),t=n.current,i=Si(),r=ca(t),s=so(i,r),s.callback=e??null,oa(t,s,r),n.current.lanes=r,Bh(n,r,i),ki(n,i),n}function Em(n,e,t,i){var r=e.current,s=Si(),o=ca(r);return t=tA(t),e.context===null?e.context=t:e.pendingContext=t,e=so(s,o),e.payload={element:n},i=i===void 0?null:i,i!==null&&(e.callback=i),n=oa(r,e,o),n!==null&&(ns(n,r,o,s),im(n,r,o)),o}function Am(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function iA(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function Py(n,e){iA(n,e),(n=n.alternate)&&iA(n,e)}var rA=typeof reportError=="function"?reportError:function(n){console.error(n)};function Dy(n){this._internalRoot=n}Cm.prototype.render=Dy.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(fe(409));Em(n,e,null,null)},Cm.prototype.unmount=Dy.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;cl(function(){Em(null,n,null,null)}),e[eo]=null}};function Cm(n){this._internalRoot=n}Cm.prototype.unstable_scheduleHydration=function(n){if(n){var e=GM();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Zo.length&&e!==0&&e<Zo[t].priority;t++);Zo.splice(t,0,n),t===0&&WM(n)}};function Ly(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Rm(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function sA(){}function OO(n,e,t,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var u=Am(o);s.call(u)}}var o=nA(e,i,n,0,null,!1,!1,"",sA);return n._reactRootContainer=o,n[eo]=o.current,Zh(n.nodeType===8?n.parentNode:n),cl(),o}for(;r=n.lastChild;)n.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var u=Am(l);a.call(u)}}var l=Ny(n,0,!1,null,null,!1,!1,"",sA);return n._reactRootContainer=l,n[eo]=l.current,Zh(n.nodeType===8?n.parentNode:n),cl(function(){Em(e,l,t,i)}),l}function Nm(n,e,t,i,r){var s=t._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var l=Am(o);a.call(l)}}Em(e,o,n,r)}else o=OO(t,e,n,r,i);return Am(o)}kM=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Oh(e.pendingLanes);t!==0&&(iv(e,t|1),ki(e,pn()),!(vt&6)&&(ku=pn()+500,ra()))}break;case 13:cl(function(){var i=ro(n,1);if(i!==null){var r=Si();ns(i,n,1,r)}}),Py(n,1)}},rv=function(n){if(n.tag===13){var e=ro(n,134217728);if(e!==null){var t=Si();ns(e,n,134217728,t)}Py(n,134217728)}},zM=function(n){if(n.tag===13){var e=ca(n),t=ro(n,e);if(t!==null){var i=Si();ns(t,n,e,i)}Py(n,e)}},GM=function(){return Dt},VM=function(n,e){var t=Dt;try{return Dt=n,e()}finally{Dt=t}},K0=function(n,e,t){switch(e){case"input":if(V0(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==n&&i.form===n.form){var r=Xp(i);if(!r)throw Error(fe(90));dM(i),V0(i,r)}}}break;case"textarea":_M(n,t);break;case"select":e=t.value,e!=null&&gu(n,!!t.multiple,e,!1)}},EM=wy,AM=cl;var BO={usingClientEntryPoint:!1,Events:[td,Eu,Xp,wM,MM,wy]},md={findFiberByHostInstance:nl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},kO={bundleType:md.bundleType,version:md.version,rendererPackageName:md.rendererPackageName,rendererConfig:md.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Js.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=PM(n),n===null?null:n.stateNode},findFiberByHostInstance:md.findFiberByHostInstance,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Pm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Pm.isDisabled&&Pm.supportsFiber)try{Cp=Pm.inject(kO),Ss=Pm}catch{}}or.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=BO,or.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ly(e))throw Error(fe(200));return FO(n,e,null,t)},or.createRoot=function(n,e){if(!Ly(n))throw Error(fe(299));var t=!1,i="",r=rA;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Ny(n,1,!1,null,null,t,!1,i,r),n[eo]=e.current,Zh(n.nodeType===8?n.parentNode:n),new Dy(e)},or.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(fe(188)):(n=Object.keys(n).join(","),Error(fe(268,n)));return n=PM(e),n=n===null?null:n.stateNode,n},or.flushSync=function(n){return cl(n)},or.hydrate=function(n,e,t){if(!Rm(e))throw Error(fe(200));return Nm(null,n,e,!0,t)},or.hydrateRoot=function(n,e,t){if(!Ly(n))throw Error(fe(405));var i=t!=null&&t.hydratedSources||null,r=!1,s="",o=rA;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=nA(e,null,n,1,t??null,r,!1,s,o),n[eo]=e.current,Zh(n),i)for(n=0;n<i.length;n++)t=i[n],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new Cm(e)},or.render=function(n,e,t){if(!Rm(e))throw Error(fe(200));return Nm(null,n,e,!1,t)},or.unmountComponentAtNode=function(n){if(!Rm(n))throw Error(fe(40));return n._reactRootContainer?(cl(function(){Nm(null,null,n,!1,function(){n._reactRootContainer=null,n[eo]=null})}),!0):!1},or.unstable_batchedUpdates=wy,or.unstable_renderSubtreeIntoContainer=function(n,e,t,i){if(!Rm(t))throw Error(fe(200));if(n==null||n._reactInternals===void 0)throw Error(fe(38));return Nm(n,e,t,!1,i)},or.version="18.3.1-next-f1338f8080-20240426";function oA(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(oA)}catch(n){console.error(n)}}oA(),tM.exports=or;var zO=tM.exports,aA,lA=zO;aA=lA.createRoot,lA.hydrateRoot;/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Gu="172",Vn={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},lo={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},uA=0,Iy=1,cA=2,GO=0,Uy=1,VO=2,dr=3,is=0,Xt=1,Ti=2,zi=0,Or=1,Vu=2,Hu=3,Wu=4,Fy=5,fr=100,Oy=101,By=102,hA=103,dA=104,ky=200,zy=201,Gy=202,Vy=203,gd=204,_d=205,Hy=206,Wy=207,$y=208,jy=209,Xy=210,HO=211,WO=212,$O=213,jO=214,vd=0,yd=1,xd=2,fa=3,Sd=4,Td=5,bd=6,wd=7,Md=0,fA=1,pA=2,Gi=0,mA=1,gA=2,_A=3,vA=4,XO=5,yA=6,xA=7,qy=300,Br=301,kr=302,pa=303,ma=304,pl=306,ml=1e3,Es=1001,gl=1002,Vt=1003,Dm=1004,As=1005,Sn=1006,$u=1007,bi=1008,oi=1009,_l=1010,vl=1011,rs=1012,Hn=1013,rn=1014,mn=1015,wi=1016,Lm=1017,Im=1018,Cs=1020,Um=35902,Yy=1021,Ed=1022,Kn=1023,Ky=1024,Qy=1025,Rs=1026,Ns=1027,Ad=1028,ju=1029,yl=1030,Xu=1031,qO=1032,qu=1033,xl=33776,ga=33777,_a=33778,va=33779,Cd=35840,Rd=35841,Nd=35842,Pd=35843,Dd=36196,Yu=37492,Ku=37496,Qu=37808,Zu=37809,Ju=37810,ec=37811,tc=37812,nc=37813,ic=37814,rc=37815,sc=37816,oc=37817,ac=37818,lc=37819,uc=37820,cc=37821,Sl=36492,Zy=36494,Jy=36495,ex=36283,Ld=36284,Id=36285,Ud=36286,YO=3200,KO=3201,uo=0,SA=1,pr="",Be="srgb",zr="srgb-linear",Fm="linear",At="srgb",QO=0,Tl=7680,ZO=7681,JO=7682,e3=7683,t3=34055,n3=34056,i3=5386,r3=512,s3=513,o3=514,a3=515,l3=516,u3=517,c3=518,tx=519,nx=512,Om=513,ix=514,Bm=515,rx=516,sx=517,ox=518,ax=519,km=35044,hc=35048,TA="300 es",Vi=2e3,ya=2001;class co{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const ai=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let bA=1234567;const Fd=Math.PI/180,dc=180/Math.PI;function ho(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(ai[n&255]+ai[n>>8&255]+ai[n>>16&255]+ai[n>>24&255]+"-"+ai[e&255]+ai[e>>8&255]+"-"+ai[e>>16&15|64]+ai[e>>24&255]+"-"+ai[t&63|128]+ai[t>>8&255]+"-"+ai[t>>16&255]+ai[t>>24&255]+ai[i&255]+ai[i>>8&255]+ai[i>>16&255]+ai[i>>24&255]).toLowerCase()}function nt(n,e,t){return Math.max(e,Math.min(t,n))}function lx(n,e){return(n%e+e)%e}function h3(n,e,t,i,r){return i+(n-e)*(r-i)/(t-e)}function d3(n,e,t){return n!==e?(t-n)/(e-n):0}function Od(n,e,t){return(1-t)*n+t*e}function f3(n,e,t,i){return Od(n,e,1-Math.exp(-t*i))}function p3(n,e=1){return e-Math.abs(lx(n,e*2)-e)}function m3(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function g3(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function _3(n,e){return n+Math.floor(Math.random()*(e-n+1))}function v3(n,e){return n+Math.random()*(e-n)}function y3(n){return n*(.5-Math.random())}function x3(n){n!==void 0&&(bA=n);let e=bA+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function S3(n){return n*Fd}function T3(n){return n*dc}function b3(n){return(n&n-1)===0&&n!==0}function w3(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function M3(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function E3(n,e,t,i,r){const s=Math.cos,o=Math.sin,a=s(t/2),l=o(t/2),u=s((e+i)/2),c=o((e+i)/2),h=s((e-i)/2),d=o((e-i)/2),f=s((i-e)/2),m=o((i-e)/2);switch(r){case"XYX":n.set(a*c,l*h,l*d,a*u);break;case"YZY":n.set(l*d,a*c,l*h,a*u);break;case"ZXZ":n.set(l*h,l*d,a*c,a*u);break;case"XZX":n.set(a*c,l*m,l*f,a*u);break;case"YXY":n.set(l*f,a*c,l*m,a*u);break;case"ZYZ":n.set(l*m,l*f,a*c,a*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function Mi(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function it(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const zm={DEG2RAD:Fd,RAD2DEG:dc,generateUUID:ho,clamp:nt,euclideanModulo:lx,mapLinear:h3,inverseLerp:d3,lerp:Od,damp:f3,pingpong:p3,smoothstep:m3,smootherstep:g3,randInt:_3,randFloat:v3,randFloatSpread:y3,seededRandom:x3,degToRad:S3,radToDeg:T3,isPowerOfTwo:b3,ceilPowerOfTwo:w3,floorPowerOfTwo:M3,setQuaternionFromProperEuler:E3,normalize:it,denormalize:Mi};class he{constructor(e=0,t=0){he.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=nt(this.x,e.x,t.x),this.y=nt(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=nt(this.x,e,t),this.y=nt(this.y,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(nt(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(nt(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*i-o*r+e.x,this.y=s*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class je{constructor(e,t,i,r,s,o,a,l,u){je.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,r,s,o,a,l,u)}set(e,t,i,r,s,o,a,l,u){const c=this.elements;return c[0]=e,c[1]=r,c[2]=a,c[3]=t,c[4]=s,c[5]=l,c[6]=i,c[7]=o,c[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[3],l=i[6],u=i[1],c=i[4],h=i[7],d=i[2],f=i[5],m=i[8],g=r[0],_=r[3],p=r[6],v=r[1],y=r[4],x=r[7],S=r[2],T=r[5],w=r[8];return s[0]=o*g+a*v+l*S,s[3]=o*_+a*y+l*T,s[6]=o*p+a*x+l*w,s[1]=u*g+c*v+h*S,s[4]=u*_+c*y+h*T,s[7]=u*p+c*x+h*w,s[2]=d*g+f*v+m*S,s[5]=d*_+f*y+m*T,s[8]=d*p+f*x+m*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8];return t*o*c-t*a*u-i*s*c+i*a*l+r*s*u-r*o*l}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=c*o-a*u,d=a*l-c*s,f=u*s-o*l,m=t*h+i*d+r*f;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/m;return e[0]=h*g,e[1]=(r*u-c*i)*g,e[2]=(a*i-r*o)*g,e[3]=d*g,e[4]=(c*t-r*l)*g,e[5]=(r*s-a*t)*g,e[6]=f*g,e[7]=(i*l-u*t)*g,e[8]=(o*t-i*s)*g,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,o,a){const l=Math.cos(s),u=Math.sin(s);return this.set(i*l,i*u,-i*(l*o+u*a)+o+e,-r*u,r*l,-r*(-u*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(ux.makeScale(e,t)),this}rotate(e){return this.premultiply(ux.makeRotation(-e)),this}translate(e,t){return this.premultiply(ux.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const ux=new je;function wA(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function Bd(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function MA(){const n=Bd("canvas");return n.style.display="block",n}const EA={};function bl(n){n in EA||(EA[n]=!0,console.warn(n))}function A3(n,e,t){return new Promise(function(i,r){function s(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:r();break;case n.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:i()}}setTimeout(s,t)})}function C3(n){const e=n.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function R3(n){const e=n.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const AA=new je().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),CA=new je().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function N3(){const n={enabled:!0,workingColorSpace:zr,spaces:{},convert:function(r,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===At&&(r.r=fo(r.r),r.g=fo(r.g),r.b=fo(r.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(r.applyMatrix3(this.spaces[s].toXYZ),r.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===At&&(r.r=fc(r.r),r.g=fc(r.g),r.b=fc(r.b))),r},fromWorkingColorSpace:function(r,s){return this.convert(r,this.workingColorSpace,s)},toWorkingColorSpace:function(r,s){return this.convert(r,s,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===pr?Fm:this.spaces[r].transfer},getLuminanceCoefficients:function(r,s=this.workingColorSpace){return r.fromArray(this.spaces[s].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,s,o){return r.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],i=[.3127,.329];return n.define({[zr]:{primaries:e,whitePoint:i,transfer:Fm,toXYZ:AA,fromXYZ:CA,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Be},outputColorSpaceConfig:{drawingBufferColorSpace:Be}},[Be]:{primaries:e,whitePoint:i,transfer:At,toXYZ:AA,fromXYZ:CA,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Be}}}),n}const st=N3();function fo(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function fc(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let pc;class P3{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{pc===void 0&&(pc=Bd("canvas")),pc.width=e.width,pc.height=e.height;const i=pc.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=pc}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Bd("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=fo(s[o]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(fo(t[i]/255)*255):t[i]=fo(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let D3=0;class RA{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:D3++}),this.uuid=ho(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(cx(r[o].image)):s.push(cx(r[o]))}else s=cx(r);i.url=s}return t||(e.images[this.uuid]=i),i}}function cx(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?P3.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let L3=0;class Tn extends co{constructor(e=Tn.DEFAULT_IMAGE,t=Tn.DEFAULT_MAPPING,i=Es,r=Es,s=Sn,o=bi,a=Kn,l=oi,u=Tn.DEFAULT_ANISOTROPY,c=pr){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:L3++}),this.uuid=ho(),this.name="",this.source=new RA(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=u,this.format=a,this.internalFormat=null,this.type=l,this.offset=new he(0,0),this.repeat=new he(1,1),this.center=new he(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new je,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==qy)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ml:e.x=e.x-Math.floor(e.x);break;case Es:e.x=e.x<0?0:1;break;case gl:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case ml:e.y=e.y-Math.floor(e.y);break;case Es:e.y=e.y<0?0:1;break;case gl:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Tn.DEFAULT_IMAGE=null,Tn.DEFAULT_MAPPING=qy,Tn.DEFAULT_ANISOTROPY=1;class et{constructor(e=0,t=0,i=0,r=1){et.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s;const l=e.elements,u=l[0],c=l[4],h=l[8],d=l[1],f=l[5],m=l[9],g=l[2],_=l[6],p=l[10];if(Math.abs(c-d)<.01&&Math.abs(h-g)<.01&&Math.abs(m-_)<.01){if(Math.abs(c+d)<.1&&Math.abs(h+g)<.1&&Math.abs(m+_)<.1&&Math.abs(u+f+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const y=(u+1)/2,x=(f+1)/2,S=(p+1)/2,T=(c+d)/4,w=(h+g)/4,E=(m+_)/4;return y>x&&y>S?y<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(y),r=T/i,s=w/i):x>S?x<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(x),i=T/r,s=E/r):S<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(S),i=w/s,r=E/s),this.set(i,r,s,t),this}let v=Math.sqrt((_-m)*(_-m)+(h-g)*(h-g)+(d-c)*(d-c));return Math.abs(v)<.001&&(v=1),this.x=(_-m)/v,this.y=(h-g)/v,this.z=(d-c)/v,this.w=Math.acos((u+f+p-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=nt(this.x,e.x,t.x),this.y=nt(this.y,e.y,t.y),this.z=nt(this.z,e.z,t.z),this.w=nt(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=nt(this.x,e,t),this.y=nt(this.y,e,t),this.z=nt(this.z,e,t),this.w=nt(this.w,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(nt(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class mc extends co{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new et(0,0,e,t),this.scissorTest=!1,this.viewport=new et(0,0,e,t);const r={width:e,height:t,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Sn,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const s=new Tn(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);s.flipY=!1,s.generateMipmaps=i.generateMipmaps,s.internalFormat=i.internalFormat,this.textures=[];const o=i.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,r=e.textures.length;i<r;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0,this.textures[i].renderTarget=this;const t=Object.assign({},e.texture.image);return this.texture.source=new RA(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class xa extends mc{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class hx extends Tn{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Vt,this.minFilter=Vt,this.wrapR=Es,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class I3 extends Tn{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Vt,this.minFilter=Vt,this.wrapR=Es,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ss{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,o,a){let l=i[r+0],u=i[r+1],c=i[r+2],h=i[r+3];const d=s[o+0],f=s[o+1],m=s[o+2],g=s[o+3];if(a===0){e[t+0]=l,e[t+1]=u,e[t+2]=c,e[t+3]=h;return}if(a===1){e[t+0]=d,e[t+1]=f,e[t+2]=m,e[t+3]=g;return}if(h!==g||l!==d||u!==f||c!==m){let _=1-a;const p=l*d+u*f+c*m+h*g,v=p>=0?1:-1,y=1-p*p;if(y>Number.EPSILON){const S=Math.sqrt(y),T=Math.atan2(S,p*v);_=Math.sin(_*T)/S,a=Math.sin(a*T)/S}const x=a*v;if(l=l*_+d*x,u=u*_+f*x,c=c*_+m*x,h=h*_+g*x,_===1-a){const S=1/Math.sqrt(l*l+u*u+c*c+h*h);l*=S,u*=S,c*=S,h*=S}}e[t]=l,e[t+1]=u,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,r,s,o){const a=i[r],l=i[r+1],u=i[r+2],c=i[r+3],h=s[o],d=s[o+1],f=s[o+2],m=s[o+3];return e[t]=a*m+c*h+l*f-u*d,e[t+1]=l*m+c*d+u*h-a*f,e[t+2]=u*m+c*f+a*d-l*h,e[t+3]=c*m-a*h-l*d-u*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,u=a(i/2),c=a(r/2),h=a(s/2),d=l(i/2),f=l(r/2),m=l(s/2);switch(o){case"XYZ":this._x=d*c*h+u*f*m,this._y=u*f*h-d*c*m,this._z=u*c*m+d*f*h,this._w=u*c*h-d*f*m;break;case"YXZ":this._x=d*c*h+u*f*m,this._y=u*f*h-d*c*m,this._z=u*c*m-d*f*h,this._w=u*c*h+d*f*m;break;case"ZXY":this._x=d*c*h-u*f*m,this._y=u*f*h+d*c*m,this._z=u*c*m+d*f*h,this._w=u*c*h-d*f*m;break;case"ZYX":this._x=d*c*h-u*f*m,this._y=u*f*h+d*c*m,this._z=u*c*m-d*f*h,this._w=u*c*h+d*f*m;break;case"YZX":this._x=d*c*h+u*f*m,this._y=u*f*h+d*c*m,this._z=u*c*m-d*f*h,this._w=u*c*h-d*f*m;break;case"XZY":this._x=d*c*h-u*f*m,this._y=u*f*h-d*c*m,this._z=u*c*m+d*f*h,this._w=u*c*h+d*f*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=t[8],o=t[1],a=t[5],l=t[9],u=t[2],c=t[6],h=t[10],d=i+a+h;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(c-l)*f,this._y=(s-u)*f,this._z=(o-r)*f}else if(i>a&&i>h){const f=2*Math.sqrt(1+i-a-h);this._w=(c-l)/f,this._x=.25*f,this._y=(r+o)/f,this._z=(s+u)/f}else if(a>h){const f=2*Math.sqrt(1+a-i-h);this._w=(s-u)/f,this._x=(r+o)/f,this._y=.25*f,this._z=(l+c)/f}else{const f=2*Math.sqrt(1+h-i-a);this._w=(o-r)/f,this._x=(s+u)/f,this._y=(l+c)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(nt(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,s=e._z,o=e._w,a=t._x,l=t._y,u=t._z,c=t._w;return this._x=i*c+o*a+r*u-s*l,this._y=r*c+o*l+s*a-i*u,this._z=s*c+o*u+i*l-r*a,this._w=o*c-i*a-r*l-s*u,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+i*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const f=1-t;return this._w=f*o+t*this._w,this._x=f*i+t*this._x,this._y=f*r+t*this._y,this._z=f*s+t*this._z,this.normalize(),this}const u=Math.sqrt(l),c=Math.atan2(u,a),h=Math.sin((1-t)*c)/u,d=Math.sin(t*c)/u;return this._w=o*h+this._w*d,this._x=i*h+this._x*d,this._y=r*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class N{constructor(e=0,t=0,i=0){N.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(NA.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(NA.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,u=2*(o*r-a*i),c=2*(a*t-s*r),h=2*(s*i-o*t);return this.x=t+l*u+o*h-a*c,this.y=i+l*c+a*u-s*h,this.z=r+l*h+s*c-o*u,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=nt(this.x,e.x,t.x),this.y=nt(this.y,e.y,t.y),this.z=nt(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=nt(this.x,e,t),this.y=nt(this.y,e,t),this.z=nt(this.z,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(nt(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=r*l-s*a,this.y=s*o-i*l,this.z=i*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return dx.copy(this).projectOnVector(e),this.sub(dx)}reflect(e){return this.sub(dx.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(nt(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const dx=new N,NA=new ss;class wl{constructor(e=new N(1/0,1/0,1/0),t=new N(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(os.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(os.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=os.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const s=i.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,os):os.fromBufferAttribute(s,o),os.applyMatrix4(e.matrixWorld),this.expandByPoint(os);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Gm.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),Gm.copy(i.boundingBox)),Gm.applyMatrix4(e.matrixWorld),this.union(Gm)}const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,os),os.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(kd),Vm.subVectors(this.max,kd),gc.subVectors(e.a,kd),_c.subVectors(e.b,kd),vc.subVectors(e.c,kd),Sa.subVectors(_c,gc),Ta.subVectors(vc,_c),Ml.subVectors(gc,vc);let t=[0,-Sa.z,Sa.y,0,-Ta.z,Ta.y,0,-Ml.z,Ml.y,Sa.z,0,-Sa.x,Ta.z,0,-Ta.x,Ml.z,0,-Ml.x,-Sa.y,Sa.x,0,-Ta.y,Ta.x,0,-Ml.y,Ml.x,0];return!fx(t,gc,_c,vc,Vm)||(t=[1,0,0,0,1,0,0,0,1],!fx(t,gc,_c,vc,Vm))?!1:(Hm.crossVectors(Sa,Ta),t=[Hm.x,Hm.y,Hm.z],fx(t,gc,_c,vc,Vm))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,os).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(os).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(po[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),po[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),po[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),po[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),po[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),po[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),po[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),po[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(po),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const po=[new N,new N,new N,new N,new N,new N,new N,new N],os=new N,Gm=new wl,gc=new N,_c=new N,vc=new N,Sa=new N,Ta=new N,Ml=new N,kd=new N,Vm=new N,Hm=new N,El=new N;function fx(n,e,t,i,r){for(let s=0,o=n.length-3;s<=o;s+=3){El.fromArray(n,s);const a=r.x*Math.abs(El.x)+r.y*Math.abs(El.y)+r.z*Math.abs(El.z),l=e.dot(El),u=t.dot(El),c=i.dot(El);if(Math.max(-Math.max(l,u,c),Math.min(l,u,c))>a)return!1}return!0}const U3=new wl,zd=new N,px=new N;class Wm{constructor(e=new N,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):U3.setFromPoints(e).getCenter(i);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;zd.subVectors(e,this.center);const t=zd.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(zd,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(px.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(zd.copy(e.center).add(px)),this.expandByPoint(zd.copy(e.center).sub(px))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const mo=new N,mx=new N,$m=new N,ba=new N,gx=new N,jm=new N,_x=new N;class Xm{constructor(e=new N,t=new N(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,mo)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=mo.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(mo.copy(this.origin).addScaledVector(this.direction,t),mo.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){mx.copy(e).add(t).multiplyScalar(.5),$m.copy(t).sub(e).normalize(),ba.copy(this.origin).sub(mx);const s=e.distanceTo(t)*.5,o=-this.direction.dot($m),a=ba.dot(this.direction),l=-ba.dot($m),u=ba.lengthSq(),c=Math.abs(1-o*o);let h,d,f,m;if(c>0)if(h=o*l-a,d=o*a-l,m=s*c,h>=0)if(d>=-m)if(d<=m){const g=1/c;h*=g,d*=g,f=h*(h+o*d+2*a)+d*(o*h+d+2*l)+u}else d=s,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*l)+u;else d=-s,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*l)+u;else d<=-m?(h=Math.max(0,-(-o*s+a)),d=h>0?-s:Math.min(Math.max(-s,-l),s),f=-h*h+d*(d+2*l)+u):d<=m?(h=0,d=Math.min(Math.max(-s,-l),s),f=d*(d+2*l)+u):(h=Math.max(0,-(o*s+a)),d=h>0?s:Math.min(Math.max(-s,-l),s),f=-h*h+d*(d+2*l)+u);else d=o>0?-s:s,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*l)+u;return i&&i.copy(this.origin).addScaledVector(this.direction,h),r&&r.copy(mx).addScaledVector($m,d),f}intersectSphere(e,t){mo.subVectors(e.center,this.origin);const i=mo.dot(this.direction),r=mo.dot(mo)-i*i,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,o,a,l;const u=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,d=this.origin;return u>=0?(i=(e.min.x-d.x)*u,r=(e.max.x-d.x)*u):(i=(e.max.x-d.x)*u,r=(e.min.x-d.x)*u),c>=0?(s=(e.min.y-d.y)*c,o=(e.max.y-d.y)*c):(s=(e.max.y-d.y)*c,o=(e.min.y-d.y)*c),i>o||s>r||((s>i||isNaN(i))&&(i=s),(o<r||isNaN(r))&&(r=o),h>=0?(a=(e.min.z-d.z)*h,l=(e.max.z-d.z)*h):(a=(e.max.z-d.z)*h,l=(e.min.z-d.z)*h),i>l||a>r)||((a>i||i!==i)&&(i=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,mo)!==null}intersectTriangle(e,t,i,r,s){gx.subVectors(t,e),jm.subVectors(i,e),_x.crossVectors(gx,jm);let o=this.direction.dot(_x),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;ba.subVectors(this.origin,e);const l=a*this.direction.dot(jm.crossVectors(ba,jm));if(l<0)return null;const u=a*this.direction.dot(gx.cross(ba));if(u<0||l+u>o)return null;const c=-a*ba.dot(_x);return c<0?null:this.at(c/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class pt{constructor(e,t,i,r,s,o,a,l,u,c,h,d,f,m,g,_){pt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,r,s,o,a,l,u,c,h,d,f,m,g,_)}set(e,t,i,r,s,o,a,l,u,c,h,d,f,m,g,_){const p=this.elements;return p[0]=e,p[4]=t,p[8]=i,p[12]=r,p[1]=s,p[5]=o,p[9]=a,p[13]=l,p[2]=u,p[6]=c,p[10]=h,p[14]=d,p[3]=f,p[7]=m,p[11]=g,p[15]=_,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new pt().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/yc.setFromMatrixColumn(e,0).length(),s=1/yc.setFromMatrixColumn(e,1).length(),o=1/yc.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,s=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(r),u=Math.sin(r),c=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const d=o*c,f=o*h,m=a*c,g=a*h;t[0]=l*c,t[4]=-l*h,t[8]=u,t[1]=f+m*u,t[5]=d-g*u,t[9]=-a*l,t[2]=g-d*u,t[6]=m+f*u,t[10]=o*l}else if(e.order==="YXZ"){const d=l*c,f=l*h,m=u*c,g=u*h;t[0]=d+g*a,t[4]=m*a-f,t[8]=o*u,t[1]=o*h,t[5]=o*c,t[9]=-a,t[2]=f*a-m,t[6]=g+d*a,t[10]=o*l}else if(e.order==="ZXY"){const d=l*c,f=l*h,m=u*c,g=u*h;t[0]=d-g*a,t[4]=-o*h,t[8]=m+f*a,t[1]=f+m*a,t[5]=o*c,t[9]=g-d*a,t[2]=-o*u,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const d=o*c,f=o*h,m=a*c,g=a*h;t[0]=l*c,t[4]=m*u-f,t[8]=d*u+g,t[1]=l*h,t[5]=g*u+d,t[9]=f*u-m,t[2]=-u,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const d=o*l,f=o*u,m=a*l,g=a*u;t[0]=l*c,t[4]=g-d*h,t[8]=m*h+f,t[1]=h,t[5]=o*c,t[9]=-a*c,t[2]=-u*c,t[6]=f*h+m,t[10]=d-g*h}else if(e.order==="XZY"){const d=o*l,f=o*u,m=a*l,g=a*u;t[0]=l*c,t[4]=-h,t[8]=u*c,t[1]=d*h+g,t[5]=o*c,t[9]=f*h-m,t[2]=m*h-f,t[6]=a*c,t[10]=g*h+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(F3,e,O3)}lookAt(e,t,i){const r=this.elements;return mr.subVectors(e,t),mr.lengthSq()===0&&(mr.z=1),mr.normalize(),wa.crossVectors(i,mr),wa.lengthSq()===0&&(Math.abs(i.z)===1?mr.x+=1e-4:mr.z+=1e-4,mr.normalize(),wa.crossVectors(i,mr)),wa.normalize(),qm.crossVectors(mr,wa),r[0]=wa.x,r[4]=qm.x,r[8]=mr.x,r[1]=wa.y,r[5]=qm.y,r[9]=mr.y,r[2]=wa.z,r[6]=qm.z,r[10]=mr.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[4],l=i[8],u=i[12],c=i[1],h=i[5],d=i[9],f=i[13],m=i[2],g=i[6],_=i[10],p=i[14],v=i[3],y=i[7],x=i[11],S=i[15],T=r[0],w=r[4],E=r[8],M=r[12],b=r[1],C=r[5],I=r[9],U=r[13],D=r[2],L=r[6],F=r[10],Q=r[14],B=r[3],J=r[7],H=r[11],K=r[15];return s[0]=o*T+a*b+l*D+u*B,s[4]=o*w+a*C+l*L+u*J,s[8]=o*E+a*I+l*F+u*H,s[12]=o*M+a*U+l*Q+u*K,s[1]=c*T+h*b+d*D+f*B,s[5]=c*w+h*C+d*L+f*J,s[9]=c*E+h*I+d*F+f*H,s[13]=c*M+h*U+d*Q+f*K,s[2]=m*T+g*b+_*D+p*B,s[6]=m*w+g*C+_*L+p*J,s[10]=m*E+g*I+_*F+p*H,s[14]=m*M+g*U+_*Q+p*K,s[3]=v*T+y*b+x*D+S*B,s[7]=v*w+y*C+x*L+S*J,s[11]=v*E+y*I+x*F+S*H,s[15]=v*M+y*U+x*Q+S*K,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],u=e[13],c=e[2],h=e[6],d=e[10],f=e[14],m=e[3],g=e[7],_=e[11],p=e[15];return m*(+s*l*h-r*u*h-s*a*d+i*u*d+r*a*f-i*l*f)+g*(+t*l*f-t*u*d+s*o*d-r*o*f+r*u*c-s*l*c)+_*(+t*u*h-t*a*f-s*o*h+i*o*f+s*a*c-i*u*c)+p*(-r*a*c-t*l*h+t*a*d+r*o*h-i*o*d+i*l*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],m=e[12],g=e[13],_=e[14],p=e[15],v=h*_*u-g*d*u+g*l*f-a*_*f-h*l*p+a*d*p,y=m*d*u-c*_*u-m*l*f+o*_*f+c*l*p-o*d*p,x=c*g*u-m*h*u+m*a*f-o*g*f-c*a*p+o*h*p,S=m*h*l-c*g*l-m*a*d+o*g*d+c*a*_-o*h*_,T=t*v+i*y+r*x+s*S;if(T===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/T;return e[0]=v*w,e[1]=(g*d*s-h*_*s-g*r*f+i*_*f+h*r*p-i*d*p)*w,e[2]=(a*_*s-g*l*s+g*r*u-i*_*u-a*r*p+i*l*p)*w,e[3]=(h*l*s-a*d*s-h*r*u+i*d*u+a*r*f-i*l*f)*w,e[4]=y*w,e[5]=(c*_*s-m*d*s+m*r*f-t*_*f-c*r*p+t*d*p)*w,e[6]=(m*l*s-o*_*s-m*r*u+t*_*u+o*r*p-t*l*p)*w,e[7]=(o*d*s-c*l*s+c*r*u-t*d*u-o*r*f+t*l*f)*w,e[8]=x*w,e[9]=(m*h*s-c*g*s-m*i*f+t*g*f+c*i*p-t*h*p)*w,e[10]=(o*g*s-m*a*s+m*i*u-t*g*u-o*i*p+t*a*p)*w,e[11]=(c*a*s-o*h*s-c*i*u+t*h*u+o*i*f-t*a*f)*w,e[12]=S*w,e[13]=(c*g*r-m*h*r+m*i*d-t*g*d-c*i*_+t*h*_)*w,e[14]=(m*a*r-o*g*r-m*i*l+t*g*l+o*i*_-t*a*_)*w,e[15]=(o*h*r-c*a*r+c*i*l-t*h*l-o*i*d+t*a*d)*w,this}scale(e){const t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),s=1-i,o=e.x,a=e.y,l=e.z,u=s*o,c=s*a;return this.set(u*o+i,u*a-r*l,u*l+r*a,0,u*a+r*l,c*a+i,c*l-r*o,0,u*l-r*a,c*l+r*o,s*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,o){return this.set(1,i,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,u=s+s,c=o+o,h=a+a,d=s*u,f=s*c,m=s*h,g=o*c,_=o*h,p=a*h,v=l*u,y=l*c,x=l*h,S=i.x,T=i.y,w=i.z;return r[0]=(1-(g+p))*S,r[1]=(f+x)*S,r[2]=(m-y)*S,r[3]=0,r[4]=(f-x)*T,r[5]=(1-(d+p))*T,r[6]=(_+v)*T,r[7]=0,r[8]=(m+y)*w,r[9]=(_-v)*w,r[10]=(1-(d+g))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let s=yc.set(r[0],r[1],r[2]).length();const o=yc.set(r[4],r[5],r[6]).length(),a=yc.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],as.copy(this);const u=1/s,c=1/o,h=1/a;return as.elements[0]*=u,as.elements[1]*=u,as.elements[2]*=u,as.elements[4]*=c,as.elements[5]*=c,as.elements[6]*=c,as.elements[8]*=h,as.elements[9]*=h,as.elements[10]*=h,t.setFromRotationMatrix(as),i.x=s,i.y=o,i.z=a,this}makePerspective(e,t,i,r,s,o,a=Vi){const l=this.elements,u=2*s/(t-e),c=2*s/(i-r),h=(t+e)/(t-e),d=(i+r)/(i-r);let f,m;if(a===Vi)f=-(o+s)/(o-s),m=-2*o*s/(o-s);else if(a===ya)f=-o/(o-s),m=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=u,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=c,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=m,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,r,s,o,a=Vi){const l=this.elements,u=1/(t-e),c=1/(i-r),h=1/(o-s),d=(t+e)*u,f=(i+r)*c;let m,g;if(a===Vi)m=(o+s)*h,g=-2*h;else if(a===ya)m=s*h,g=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*u,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*c,l[9]=0,l[13]=-f,l[2]=0,l[6]=0,l[10]=g,l[14]=-m,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const yc=new N,as=new pt,F3=new N(0,0,0),O3=new N(1,1,1),wa=new N,qm=new N,mr=new N,PA=new pt,DA=new ss;class gr{constructor(e=0,t=0,i=0,r=gr.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],l=r[1],u=r[5],c=r[9],h=r[2],d=r[6],f=r[10];switch(t){case"XYZ":this._y=Math.asin(nt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,f),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(d,u),this._z=0);break;case"YXZ":this._x=Math.asin(-nt(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(nt(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-nt(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,u));break;case"YZX":this._z=Math.asin(nt(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-nt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,u),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-c,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return PA.makeRotationFromQuaternion(e),this.setFromRotationMatrix(PA,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return DA.setFromEuler(this),this.setFromQuaternion(DA,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}gr.DEFAULT_ORDER="XYZ";class vx{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let B3=0;const LA=new N,xc=new ss,go=new pt,Ym=new N,Gd=new N,k3=new N,z3=new ss,IA=new N(1,0,0),UA=new N(0,1,0),FA=new N(0,0,1),OA={type:"added"},G3={type:"removed"},Sc={type:"childadded",child:null},yx={type:"childremoved",child:null};class gn extends co{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:B3++}),this.uuid=ho(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=gn.DEFAULT_UP.clone();const e=new N,t=new gr,i=new ss,r=new N(1,1,1);function s(){i.setFromEuler(t,!1)}function o(){t.setFromQuaternion(i,void 0,!1)}t._onChange(s),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new pt},normalMatrix:{value:new je}}),this.matrix=new pt,this.matrixWorld=new pt,this.matrixAutoUpdate=gn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=gn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new vx,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return xc.setFromAxisAngle(e,t),this.quaternion.multiply(xc),this}rotateOnWorldAxis(e,t){return xc.setFromAxisAngle(e,t),this.quaternion.premultiply(xc),this}rotateX(e){return this.rotateOnAxis(IA,e)}rotateY(e){return this.rotateOnAxis(UA,e)}rotateZ(e){return this.rotateOnAxis(FA,e)}translateOnAxis(e,t){return LA.copy(e).applyQuaternion(this.quaternion),this.position.add(LA.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(IA,e)}translateY(e){return this.translateOnAxis(UA,e)}translateZ(e){return this.translateOnAxis(FA,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(go.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Ym.copy(e):Ym.set(e,t,i);const r=this.parent;this.updateWorldMatrix(!0,!1),Gd.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?go.lookAt(Gd,Ym,this.up):go.lookAt(Ym,Gd,this.up),this.quaternion.setFromRotationMatrix(go),r&&(go.extractRotation(r.matrixWorld),xc.setFromRotationMatrix(go),this.quaternion.premultiply(xc.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(OA),Sc.child=e,this.dispatchEvent(Sc),Sc.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(G3),yx.child=e,this.dispatchEvent(yx),yx.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),go.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),go.multiply(e.parent.matrixWorld)),e.applyMatrix4(go),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(OA),Sc.child=e,this.dispatchEvent(Sc),Sc.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Gd,e,k3),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Gd,z3,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let u=0,c=l.length;u<c;u++){const h=l[u];s(e.shapes,h)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,u=this.material.length;l<u;l++)a.push(s(e.materials,this.material[l]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];r.animations.push(s(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),u=o(e.textures),c=o(e.images),h=o(e.shapes),d=o(e.skeletons),f=o(e.animations),m=o(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),u.length>0&&(i.textures=u),c.length>0&&(i.images=c),h.length>0&&(i.shapes=h),d.length>0&&(i.skeletons=d),f.length>0&&(i.animations=f),m.length>0&&(i.nodes=m)}return i.object=r,i;function o(a){const l=[];for(const u in a){const c=a[u];delete c.metadata,l.push(c)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}}gn.DEFAULT_UP=new N(0,1,0),gn.DEFAULT_MATRIX_AUTO_UPDATE=!0,gn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ls=new N,_o=new N,xx=new N,vo=new N,Tc=new N,bc=new N,BA=new N,Sx=new N,Tx=new N,bx=new N,wx=new et,Mx=new et,Ex=new et;class Gr{constructor(e=new N,t=new N,i=new N){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),ls.subVectors(e,t),r.cross(ls);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){ls.subVectors(r,t),_o.subVectors(i,t),xx.subVectors(e,t);const o=ls.dot(ls),a=ls.dot(_o),l=ls.dot(xx),u=_o.dot(_o),c=_o.dot(xx),h=o*u-a*a;if(h===0)return s.set(0,0,0),null;const d=1/h,f=(u*l-a*c)*d,m=(o*c-a*l)*d;return s.set(1-f-m,m,f)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,vo)===null?!1:vo.x>=0&&vo.y>=0&&vo.x+vo.y<=1}static getInterpolation(e,t,i,r,s,o,a,l){return this.getBarycoord(e,t,i,r,vo)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,vo.x),l.addScaledVector(o,vo.y),l.addScaledVector(a,vo.z),l)}static getInterpolatedAttribute(e,t,i,r,s,o){return wx.setScalar(0),Mx.setScalar(0),Ex.setScalar(0),wx.fromBufferAttribute(e,t),Mx.fromBufferAttribute(e,i),Ex.fromBufferAttribute(e,r),o.setScalar(0),o.addScaledVector(wx,s.x),o.addScaledVector(Mx,s.y),o.addScaledVector(Ex,s.z),o}static isFrontFacing(e,t,i,r){return ls.subVectors(i,t),_o.subVectors(e,t),ls.cross(_o).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ls.subVectors(this.c,this.b),_o.subVectors(this.a,this.b),ls.cross(_o).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Gr.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Gr.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,r,s){return Gr.getInterpolation(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return Gr.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Gr.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,s=this.c;let o,a;Tc.subVectors(r,i),bc.subVectors(s,i),Sx.subVectors(e,i);const l=Tc.dot(Sx),u=bc.dot(Sx);if(l<=0&&u<=0)return t.copy(i);Tx.subVectors(e,r);const c=Tc.dot(Tx),h=bc.dot(Tx);if(c>=0&&h<=c)return t.copy(r);const d=l*h-c*u;if(d<=0&&l>=0&&c<=0)return o=l/(l-c),t.copy(i).addScaledVector(Tc,o);bx.subVectors(e,s);const f=Tc.dot(bx),m=bc.dot(bx);if(m>=0&&f<=m)return t.copy(s);const g=f*u-l*m;if(g<=0&&u>=0&&m<=0)return a=u/(u-m),t.copy(i).addScaledVector(bc,a);const _=c*m-f*h;if(_<=0&&h-c>=0&&f-m>=0)return BA.subVectors(s,r),a=(h-c)/(h-c+(f-m)),t.copy(r).addScaledVector(BA,a);const p=1/(_+g+d);return o=g*p,a=d*p,t.copy(i).addScaledVector(Tc,o).addScaledVector(bc,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const kA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ma={h:0,s:0,l:0},Km={h:0,s:0,l:0};function Ax(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}let Ue=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Be){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,st.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=st.workingColorSpace){return this.r=e,this.g=t,this.b=i,st.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=st.workingColorSpace){if(e=lx(e,1),t=nt(t,0,1),i=nt(i,0,1),t===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,o=2*i-s;this.r=Ax(o,s,e+1/3),this.g=Ax(o,s,e),this.b=Ax(o,s,e-1/3)}return st.toWorkingColorSpace(this,r),this}setStyle(e,t=Be){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Be){const i=kA[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=fo(e.r),this.g=fo(e.g),this.b=fo(e.b),this}copyLinearToSRGB(e){return this.r=fc(e.r),this.g=fc(e.g),this.b=fc(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Be){return st.fromWorkingColorSpace(li.copy(this),e),Math.round(nt(li.r*255,0,255))*65536+Math.round(nt(li.g*255,0,255))*256+Math.round(nt(li.b*255,0,255))}getHexString(e=Be){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=st.workingColorSpace){st.fromWorkingColorSpace(li.copy(this),t);const i=li.r,r=li.g,s=li.b,o=Math.max(i,r,s),a=Math.min(i,r,s);let l,u;const c=(a+o)/2;if(a===o)l=0,u=0;else{const h=o-a;switch(u=c<=.5?h/(o+a):h/(2-o-a),o){case i:l=(r-s)/h+(r<s?6:0);break;case r:l=(s-i)/h+2;break;case s:l=(i-r)/h+4;break}l/=6}return e.h=l,e.s=u,e.l=c,e}getRGB(e,t=st.workingColorSpace){return st.fromWorkingColorSpace(li.copy(this),t),e.r=li.r,e.g=li.g,e.b=li.b,e}getStyle(e=Be){st.fromWorkingColorSpace(li.copy(this),e);const t=li.r,i=li.g,r=li.b;return e!==Be?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(r*255)})`}offsetHSL(e,t,i){return this.getHSL(Ma),this.setHSL(Ma.h+e,Ma.s+t,Ma.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Ma),e.getHSL(Km);const i=Od(Ma.h,Km.h,t),r=Od(Ma.s,Km.s,t),s=Od(Ma.l,Km.l,t);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*i+s[6]*r,this.g=s[1]*t+s[4]*i+s[7]*r,this.b=s[2]*t+s[5]*i+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const li=new Ue;Ue.NAMES=kA;let V3=0;class ui extends co{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:V3++}),this.uuid=ho(),this.name="",this.type="Material",this.blending=Or,this.side=is,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=gd,this.blendDst=_d,this.blendEquation=fr,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Ue(0,0,0),this.blendAlpha=0,this.depthFunc=fa,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=tx,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Tl,this.stencilZFail=Tl,this.stencilZPass=Tl,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Or&&(i.blending=this.blending),this.side!==is&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==gd&&(i.blendSrc=this.blendSrc),this.blendDst!==_d&&(i.blendDst=this.blendDst),this.blendEquation!==fr&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==fa&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==tx&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Tl&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Tl&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Tl&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(t){const s=r(e.textures),o=r(e.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Vd extends ui{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ue(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new gr,this.combine=Md,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const yo=H3();function H3(){const n=new ArrayBuffer(4),e=new Float32Array(n),t=new Uint32Array(n),i=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const u=l-127;u<-27?(i[l]=0,i[l|256]=32768,r[l]=24,r[l|256]=24):u<-14?(i[l]=1024>>-u-14,i[l|256]=1024>>-u-14|32768,r[l]=-u-1,r[l|256]=-u-1):u<=15?(i[l]=u+15<<10,i[l|256]=u+15<<10|32768,r[l]=13,r[l|256]=13):u<128?(i[l]=31744,i[l|256]=64512,r[l]=24,r[l|256]=24):(i[l]=31744,i[l|256]=64512,r[l]=13,r[l|256]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let u=l<<13,c=0;for(;!(u&8388608);)u<<=1,c-=8388608;u&=-8388609,c+=947912704,s[l]=u|c}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:e,uint32View:t,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:a}}function _r(n){Math.abs(n)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=nt(n,-65504,65504),yo.floatView[0]=n;const e=yo.uint32View[0],t=e>>23&511;return yo.baseTable[t]+((e&8388607)>>yo.shiftTable[t])}function Qm(n){const e=n>>10;return yo.uint32View[0]=yo.mantissaTable[yo.offsetTable[e]+(n&1023)]+yo.exponentTable[e],yo.floatView[0]}const bn=new N,Zm=new he;class Qn{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=km,this.updateRanges=[],this.gpuType=mn,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Zm.fromBufferAttribute(this,t),Zm.applyMatrix3(e),this.setXY(t,Zm.x,Zm.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)bn.fromBufferAttribute(this,t),bn.applyMatrix3(e),this.setXYZ(t,bn.x,bn.y,bn.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)bn.fromBufferAttribute(this,t),bn.applyMatrix4(e),this.setXYZ(t,bn.x,bn.y,bn.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)bn.fromBufferAttribute(this,t),bn.applyNormalMatrix(e),this.setXYZ(t,bn.x,bn.y,bn.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)bn.fromBufferAttribute(this,t),bn.transformDirection(e),this.setXYZ(t,bn.x,bn.y,bn.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=Mi(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=it(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Mi(t,this.array)),t}setX(e,t){return this.normalized&&(t=it(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Mi(t,this.array)),t}setY(e,t){return this.normalized&&(t=it(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Mi(t,this.array)),t}setZ(e,t){return this.normalized&&(t=it(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Mi(t,this.array)),t}setW(e,t){return this.normalized&&(t=it(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=it(t,this.array),i=it(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=it(t,this.array),i=it(i,this.array),r=it(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=it(t,this.array),i=it(i,this.array),r=it(r,this.array),s=it(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==km&&(e.usage=this.usage),e}}class Cx extends Qn{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class Rx extends Qn{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class zA extends Qn{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}getX(e){let t=Qm(this.array[e*this.itemSize]);return this.normalized&&(t=Mi(t,this.array)),t}setX(e,t){return this.normalized&&(t=it(t,this.array)),this.array[e*this.itemSize]=_r(t),this}getY(e){let t=Qm(this.array[e*this.itemSize+1]);return this.normalized&&(t=Mi(t,this.array)),t}setY(e,t){return this.normalized&&(t=it(t,this.array)),this.array[e*this.itemSize+1]=_r(t),this}getZ(e){let t=Qm(this.array[e*this.itemSize+2]);return this.normalized&&(t=Mi(t,this.array)),t}setZ(e,t){return this.normalized&&(t=it(t,this.array)),this.array[e*this.itemSize+2]=_r(t),this}getW(e){let t=Qm(this.array[e*this.itemSize+3]);return this.normalized&&(t=Mi(t,this.array)),t}setW(e,t){return this.normalized&&(t=it(t,this.array)),this.array[e*this.itemSize+3]=_r(t),this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=it(t,this.array),i=it(i,this.array)),this.array[e+0]=_r(t),this.array[e+1]=_r(i),this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=it(t,this.array),i=it(i,this.array),r=it(r,this.array)),this.array[e+0]=_r(t),this.array[e+1]=_r(i),this.array[e+2]=_r(r),this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=it(t,this.array),i=it(i,this.array),r=it(r,this.array),s=it(s,this.array)),this.array[e+0]=_r(t),this.array[e+1]=_r(i),this.array[e+2]=_r(r),this.array[e+3]=_r(s),this}}class _n extends Qn{constructor(e,t,i){super(new Float32Array(e),t,i)}}let W3=0;const Vr=new pt,Nx=new gn,wc=new N,vr=new wl,Hd=new wl,Wn=new N;class ci extends co{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:W3++}),this.uuid=ho(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(wA(e)?Rx:Cx)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new je().getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Vr.makeRotationFromQuaternion(e),this.applyMatrix4(Vr),this}rotateX(e){return Vr.makeRotationX(e),this.applyMatrix4(Vr),this}rotateY(e){return Vr.makeRotationY(e),this.applyMatrix4(Vr),this}rotateZ(e){return Vr.makeRotationZ(e),this.applyMatrix4(Vr),this}translate(e,t,i){return Vr.makeTranslation(e,t,i),this.applyMatrix4(Vr),this}scale(e,t,i){return Vr.makeScale(e,t,i),this.applyMatrix4(Vr),this}lookAt(e){return Nx.lookAt(e),Nx.updateMatrix(),this.applyMatrix4(Nx.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(wc).negate(),this.translate(wc.x,wc.y,wc.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const i=[];for(let r=0,s=e.length;r<s;r++){const o=e[r];i.push(o.x,o.y,o.z||0)}this.setAttribute("position",new _n(i,3))}else{const i=Math.min(e.length,t.count);for(let r=0;r<i;r++){const s=e[r];t.setXYZ(r,s.x,s.y,s.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new wl);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new N(-1/0,-1/0,-1/0),new N(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){const s=t[i];vr.setFromBufferAttribute(s),this.morphTargetsRelative?(Wn.addVectors(this.boundingBox.min,vr.min),this.boundingBox.expandByPoint(Wn),Wn.addVectors(this.boundingBox.max,vr.max),this.boundingBox.expandByPoint(Wn)):(this.boundingBox.expandByPoint(vr.min),this.boundingBox.expandByPoint(vr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Wm);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new N,1/0);return}if(e){const i=this.boundingSphere.center;if(vr.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];Hd.setFromBufferAttribute(a),this.morphTargetsRelative?(Wn.addVectors(vr.min,Hd.min),vr.expandByPoint(Wn),Wn.addVectors(vr.max,Hd.max),vr.expandByPoint(Wn)):(vr.expandByPoint(Hd.min),vr.expandByPoint(Hd.max))}vr.getCenter(i);let r=0;for(let s=0,o=e.count;s<o;s++)Wn.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(Wn));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let u=0,c=a.count;u<c;u++)Wn.fromBufferAttribute(a,u),l&&(wc.fromBufferAttribute(e,u),Wn.add(wc)),r=Math.max(r,i.distanceToSquared(Wn))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,r=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Qn(new Float32Array(4*i.count),4));const o=this.getAttribute("tangent"),a=[],l=[];for(let E=0;E<i.count;E++)a[E]=new N,l[E]=new N;const u=new N,c=new N,h=new N,d=new he,f=new he,m=new he,g=new N,_=new N;function p(E,M,b){u.fromBufferAttribute(i,E),c.fromBufferAttribute(i,M),h.fromBufferAttribute(i,b),d.fromBufferAttribute(s,E),f.fromBufferAttribute(s,M),m.fromBufferAttribute(s,b),c.sub(u),h.sub(u),f.sub(d),m.sub(d);const C=1/(f.x*m.y-m.x*f.y);isFinite(C)&&(g.copy(c).multiplyScalar(m.y).addScaledVector(h,-f.y).multiplyScalar(C),_.copy(h).multiplyScalar(f.x).addScaledVector(c,-m.x).multiplyScalar(C),a[E].add(g),a[M].add(g),a[b].add(g),l[E].add(_),l[M].add(_),l[b].add(_))}let v=this.groups;v.length===0&&(v=[{start:0,count:e.count}]);for(let E=0,M=v.length;E<M;++E){const b=v[E],C=b.start,I=b.count;for(let U=C,D=C+I;U<D;U+=3)p(e.getX(U+0),e.getX(U+1),e.getX(U+2))}const y=new N,x=new N,S=new N,T=new N;function w(E){S.fromBufferAttribute(r,E),T.copy(S);const M=a[E];y.copy(M),y.sub(S.multiplyScalar(S.dot(M))).normalize(),x.crossVectors(T,M);const C=x.dot(l[E])<0?-1:1;o.setXYZW(E,y.x,y.y,y.z,C)}for(let E=0,M=v.length;E<M;++E){const b=v[E],C=b.start,I=b.count;for(let U=C,D=C+I;U<D;U+=3)w(e.getX(U+0)),w(e.getX(U+1)),w(e.getX(U+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Qn(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let d=0,f=i.count;d<f;d++)i.setXYZ(d,0,0,0);const r=new N,s=new N,o=new N,a=new N,l=new N,u=new N,c=new N,h=new N;if(e)for(let d=0,f=e.count;d<f;d+=3){const m=e.getX(d+0),g=e.getX(d+1),_=e.getX(d+2);r.fromBufferAttribute(t,m),s.fromBufferAttribute(t,g),o.fromBufferAttribute(t,_),c.subVectors(o,s),h.subVectors(r,s),c.cross(h),a.fromBufferAttribute(i,m),l.fromBufferAttribute(i,g),u.fromBufferAttribute(i,_),a.add(c),l.add(c),u.add(c),i.setXYZ(m,a.x,a.y,a.z),i.setXYZ(g,l.x,l.y,l.z),i.setXYZ(_,u.x,u.y,u.z)}else for(let d=0,f=t.count;d<f;d+=3)r.fromBufferAttribute(t,d+0),s.fromBufferAttribute(t,d+1),o.fromBufferAttribute(t,d+2),c.subVectors(o,s),h.subVectors(r,s),c.cross(h),i.setXYZ(d+0,c.x,c.y,c.z),i.setXYZ(d+1,c.x,c.y,c.z),i.setXYZ(d+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Wn.fromBufferAttribute(e,t),Wn.normalize(),e.setXYZ(t,Wn.x,Wn.y,Wn.z)}toNonIndexed(){function e(a,l){const u=a.array,c=a.itemSize,h=a.normalized,d=new u.constructor(l.length*c);let f=0,m=0;for(let g=0,_=l.length;g<_;g++){a.isInterleavedBufferAttribute?f=l[g]*a.data.stride+a.offset:f=l[g]*c;for(let p=0;p<c;p++)d[m++]=u[f++]}return new Qn(d,c,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new ci,i=this.index.array,r=this.attributes;for(const a in r){const l=r[a],u=e(l,i);t.setAttribute(a,u)}const s=this.morphAttributes;for(const a in s){const l=[],u=s[a];for(let c=0,h=u.length;c<h;c++){const d=u[c],f=e(d,i);l.push(f)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const u=o[a];t.addGroup(u.start,u.count,u.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const u in l)l[u]!==void 0&&(e[u]=l[u]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const u=i[l];e.data.attributes[l]=u.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const u=this.morphAttributes[l],c=[];for(let h=0,d=u.length;h<d;h++){const f=u[h];c.push(f.toJSON(e.data))}c.length>0&&(r[l]=c,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const r=e.attributes;for(const u in r){const c=r[u];this.setAttribute(u,c.clone(t))}const s=e.morphAttributes;for(const u in s){const c=[],h=s[u];for(let d=0,f=h.length;d<f;d++)c.push(h[d].clone(t));this.morphAttributes[u]=c}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let u=0,c=o.length;u<c;u++){const h=o[u];this.addGroup(h.start,h.count,h.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const GA=new pt,Al=new Xm,Jm=new Wm,VA=new N,eg=new N,tg=new N,ng=new N,Px=new N,ig=new N,HA=new N,rg=new N;class $n extends gn{constructor(e=new ci,t=new Vd){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const i=this.geometry,r=i.attributes.position,s=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(s&&a){ig.set(0,0,0);for(let l=0,u=s.length;l<u;l++){const c=a[l],h=s[l];c!==0&&(Px.fromBufferAttribute(h,e),o?ig.addScaledVector(Px,c):ig.addScaledVector(Px.sub(t),c))}t.add(ig)}return t}raycast(e,t){const i=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),Jm.copy(i.boundingSphere),Jm.applyMatrix4(s),Al.copy(e.ray).recast(e.near),!(Jm.containsPoint(Al.origin)===!1&&(Al.intersectSphere(Jm,VA)===null||Al.origin.distanceToSquared(VA)>(e.far-e.near)**2))&&(GA.copy(s).invert(),Al.copy(e.ray).applyMatrix4(GA),!(i.boundingBox!==null&&Al.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,Al)))}_computeIntersections(e,t,i){let r;const s=this.geometry,o=this.material,a=s.index,l=s.attributes.position,u=s.attributes.uv,c=s.attributes.uv1,h=s.attributes.normal,d=s.groups,f=s.drawRange;if(a!==null)if(Array.isArray(o))for(let m=0,g=d.length;m<g;m++){const _=d[m],p=o[_.materialIndex],v=Math.max(_.start,f.start),y=Math.min(a.count,Math.min(_.start+_.count,f.start+f.count));for(let x=v,S=y;x<S;x+=3){const T=a.getX(x),w=a.getX(x+1),E=a.getX(x+2);r=sg(this,p,e,i,u,c,h,T,w,E),r&&(r.faceIndex=Math.floor(x/3),r.face.materialIndex=_.materialIndex,t.push(r))}}else{const m=Math.max(0,f.start),g=Math.min(a.count,f.start+f.count);for(let _=m,p=g;_<p;_+=3){const v=a.getX(_),y=a.getX(_+1),x=a.getX(_+2);r=sg(this,o,e,i,u,c,h,v,y,x),r&&(r.faceIndex=Math.floor(_/3),t.push(r))}}else if(l!==void 0)if(Array.isArray(o))for(let m=0,g=d.length;m<g;m++){const _=d[m],p=o[_.materialIndex],v=Math.max(_.start,f.start),y=Math.min(l.count,Math.min(_.start+_.count,f.start+f.count));for(let x=v,S=y;x<S;x+=3){const T=x,w=x+1,E=x+2;r=sg(this,p,e,i,u,c,h,T,w,E),r&&(r.faceIndex=Math.floor(x/3),r.face.materialIndex=_.materialIndex,t.push(r))}}else{const m=Math.max(0,f.start),g=Math.min(l.count,f.start+f.count);for(let _=m,p=g;_<p;_+=3){const v=_,y=_+1,x=_+2;r=sg(this,o,e,i,u,c,h,v,y,x),r&&(r.faceIndex=Math.floor(_/3),t.push(r))}}}}function $3(n,e,t,i,r,s,o,a){let l;if(e.side===Xt?l=i.intersectTriangle(o,s,r,!0,a):l=i.intersectTriangle(r,s,o,e.side===is,a),l===null)return null;rg.copy(a),rg.applyMatrix4(n.matrixWorld);const u=t.ray.origin.distanceTo(rg);return u<t.near||u>t.far?null:{distance:u,point:rg.clone(),object:n}}function sg(n,e,t,i,r,s,o,a,l,u){n.getVertexPosition(a,eg),n.getVertexPosition(l,tg),n.getVertexPosition(u,ng);const c=$3(n,e,t,i,eg,tg,ng,HA);if(c){const h=new N;Gr.getBarycoord(HA,eg,tg,ng,h),r&&(c.uv=Gr.getInterpolatedAttribute(r,a,l,u,h,new he)),s&&(c.uv1=Gr.getInterpolatedAttribute(s,a,l,u,h,new he)),o&&(c.normal=Gr.getInterpolatedAttribute(o,a,l,u,h,new N),c.normal.dot(i.direction)>0&&c.normal.multiplyScalar(-1));const d={a,b:l,c:u,normal:new N,materialIndex:0};Gr.getNormal(eg,tg,ng,d.normal),c.face=d,c.barycoord=h}return c}class Cl extends ci{constructor(e=1,t=1,i=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],u=[],c=[],h=[];let d=0,f=0;m("z","y","x",-1,-1,i,t,e,o,s,0),m("z","y","x",1,-1,i,t,-e,o,s,1),m("x","z","y",1,1,e,i,t,r,o,2),m("x","z","y",1,-1,e,i,-t,r,o,3),m("x","y","z",1,-1,e,t,i,r,s,4),m("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(l),this.setAttribute("position",new _n(u,3)),this.setAttribute("normal",new _n(c,3)),this.setAttribute("uv",new _n(h,2));function m(g,_,p,v,y,x,S,T,w,E,M){const b=x/w,C=S/E,I=x/2,U=S/2,D=T/2,L=w+1,F=E+1;let Q=0,B=0;const J=new N;for(let H=0;H<F;H++){const K=H*C-U;for(let le=0;le<L;le++){const Pe=le*b-I;J[g]=Pe*v,J[_]=K*y,J[p]=D,u.push(J.x,J.y,J.z),J[g]=0,J[_]=0,J[p]=T>0?1:-1,c.push(J.x,J.y,J.z),h.push(le/w),h.push(1-H/E),Q+=1}}for(let H=0;H<E;H++)for(let K=0;K<w;K++){const le=d+K+L*H,Pe=d+K+L*(H+1),O=d+(K+1)+L*(H+1),j=d+(K+1)+L*H;l.push(le,Pe,j),l.push(Pe,O,j),B+=6}a.addGroup(f,B,M),f+=B,d+=Q}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Cl(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Mc(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=r.clone():Array.isArray(r)?e[t][i]=r.slice():e[t][i]=r}}return e}function Ei(n){const e={};for(let t=0;t<n.length;t++){const i=Mc(n[t]);for(const r in i)e[r]=i[r]}return e}function j3(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function WA(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:st.workingColorSpace}const $A={clone:Mc,merge:Ei};var X3=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,q3=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Ps extends ui{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=X3,this.fragmentShader=q3,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Mc(e.uniforms),this.uniformsGroups=j3(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class jA extends gn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new pt,this.projectionMatrix=new pt,this.projectionMatrixInverse=new pt,this.coordinateSystem=Vi}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Ea=new N,XA=new he,qA=new he;class Ai extends jA{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=dc*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Fd*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return dc*2*Math.atan(Math.tan(Fd*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){Ea.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Ea.x,Ea.y).multiplyScalar(-e/Ea.z),Ea.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Ea.x,Ea.y).multiplyScalar(-e/Ea.z)}getViewSize(e,t){return this.getViewBounds(e,XA,qA),t.subVectors(qA,XA)}setViewOffset(e,t,i,r,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Fd*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,u=o.fullHeight;s+=o.offsetX*r/l,t-=o.offsetY*i/u,r*=o.width/l,i*=o.height/u}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Ec=-90,Ac=1;class YA extends gn{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Ai(Ec,Ac,e,t);r.layers=this.layers,this.add(r);const s=new Ai(Ec,Ac,e,t);s.layers=this.layers,this.add(s);const o=new Ai(Ec,Ac,e,t);o.layers=this.layers,this.add(o);const a=new Ai(Ec,Ac,e,t);a.layers=this.layers,this.add(a);const l=new Ai(Ec,Ac,e,t);l.layers=this.layers,this.add(l);const u=new Ai(Ec,Ac,e,t);u.layers=this.layers,this.add(u)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,r,s,o,a,l]=t;for(const u of t)this.remove(u);if(e===Vi)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===ya)i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const u of t)this.add(u),u.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,l,u,c]=this.children,h=e.getRenderTarget(),d=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),m=e.xr.enabled;e.xr.enabled=!1;const g=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,r),e.render(t,s),e.setRenderTarget(i,1,r),e.render(t,o),e.setRenderTarget(i,2,r),e.render(t,a),e.setRenderTarget(i,3,r),e.render(t,l),e.setRenderTarget(i,4,r),e.render(t,u),i.texture.generateMipmaps=g,e.setRenderTarget(i,5,r),e.render(t,c),e.setRenderTarget(h,d,f),e.xr.enabled=m,i.texture.needsPMREMUpdate=!0}}class og extends Tn{constructor(e,t,i,r,s,o,a,l,u,c){e=e!==void 0?e:[],t=t!==void 0?t:Br,super(e,t,i,r,s,o,a,l,u,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class KA extends xa{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new og(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Sn}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new Cl(5,5,5),s=new Ps({name:"CubemapFromEquirect",uniforms:Mc(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Xt,blending:zi});s.uniforms.tEquirect.value=t;const o=new $n(r,s),a=t.minFilter;return t.minFilter===bi&&(t.minFilter=Sn),new YA(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,r);e.setRenderTarget(s)}}class Dx extends gn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new gr,this.environmentIntensity=1,this.environmentRotation=new gr,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class Lx{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=km,this.updateRanges=[],this.version=0,this.uuid=ho()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ho()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ho()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Ci=new N;class Wd{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)Ci.fromBufferAttribute(this,t),Ci.applyMatrix4(e),this.setXYZ(t,Ci.x,Ci.y,Ci.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Ci.fromBufferAttribute(this,t),Ci.applyNormalMatrix(e),this.setXYZ(t,Ci.x,Ci.y,Ci.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Ci.fromBufferAttribute(this,t),Ci.transformDirection(e),this.setXYZ(t,Ci.x,Ci.y,Ci.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=Mi(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=it(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=it(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=it(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=it(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=it(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Mi(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Mi(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Mi(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Mi(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=it(t,this.array),i=it(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=it(t,this.array),i=it(i,this.array),r=it(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=it(t,this.array),i=it(i,this.array),r=it(r,this.array),s=it(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new Qn(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Wd(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Ix extends ui{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Ue(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Cc;const $d=new N,Rc=new N,Nc=new N,Pc=new he,jd=new he,QA=new pt,ag=new N,Xd=new N,lg=new N,ZA=new he,Ux=new he,JA=new he;class Y3 extends gn{constructor(e=new Ix){if(super(),this.isSprite=!0,this.type="Sprite",Cc===void 0){Cc=new ci;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new Lx(t,5);Cc.setIndex([0,1,2,0,2,3]),Cc.setAttribute("position",new Wd(i,3,0,!1)),Cc.setAttribute("uv",new Wd(i,2,3,!1))}this.geometry=Cc,this.material=e,this.center=new he(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Rc.setFromMatrixScale(this.matrixWorld),QA.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Nc.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Rc.multiplyScalar(-Nc.z);const i=this.material.rotation;let r,s;i!==0&&(s=Math.cos(i),r=Math.sin(i));const o=this.center;ug(ag.set(-.5,-.5,0),Nc,o,Rc,r,s),ug(Xd.set(.5,-.5,0),Nc,o,Rc,r,s),ug(lg.set(.5,.5,0),Nc,o,Rc,r,s),ZA.set(0,0),Ux.set(1,0),JA.set(1,1);let a=e.ray.intersectTriangle(ag,Xd,lg,!1,$d);if(a===null&&(ug(Xd.set(-.5,.5,0),Nc,o,Rc,r,s),Ux.set(0,1),a=e.ray.intersectTriangle(ag,lg,Xd,!1,$d),a===null))return;const l=e.ray.origin.distanceTo($d);l<e.near||l>e.far||t.push({distance:l,point:$d.clone(),uv:Gr.getInterpolation($d,ag,Xd,lg,ZA,Ux,JA,new he),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function ug(n,e,t,i,r,s){Pc.subVectors(n,t).addScalar(.5).multiply(i),r!==void 0?(jd.x=s*Pc.x-r*Pc.y,jd.y=r*Pc.x+s*Pc.y):jd.copy(Pc),n.copy(e),n.x+=jd.x,n.y+=jd.y,n.applyMatrix4(QA)}class K3 extends Tn{constructor(e=null,t=1,i=1,r,s,o,a,l,u=Vt,c=Vt,h,d){super(null,o,a,l,u,c,r,s,h,d),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Q3 extends Qn{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Fx=new N,Z3=new N,J3=new je;class us{constructor(e=new N(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=Fx.subVectors(i,t).cross(Z3.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(Fx),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||J3.getNormalMatrix(e),r=this.coplanarPoint(Fx).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Rl=new Wm,cg=new N;class hg{constructor(e=new us,t=new us,i=new us,r=new us,s=new us,o=new us){this.planes=[e,t,i,r,s,o]}set(e,t,i,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=Vi){const i=this.planes,r=e.elements,s=r[0],o=r[1],a=r[2],l=r[3],u=r[4],c=r[5],h=r[6],d=r[7],f=r[8],m=r[9],g=r[10],_=r[11],p=r[12],v=r[13],y=r[14],x=r[15];if(i[0].setComponents(l-s,d-u,_-f,x-p).normalize(),i[1].setComponents(l+s,d+u,_+f,x+p).normalize(),i[2].setComponents(l+o,d+c,_+m,x+v).normalize(),i[3].setComponents(l-o,d-c,_-m,x-v).normalize(),i[4].setComponents(l-a,d-h,_-g,x-y).normalize(),t===Vi)i[5].setComponents(l+a,d+h,_+g,x+y).normalize();else if(t===ya)i[5].setComponents(a,h,g,y).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Rl.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Rl.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Rl)}intersectsSprite(e){return Rl.center.set(0,0,0),Rl.radius=.7071067811865476,Rl.applyMatrix4(e.matrixWorld),this.intersectsSphere(Rl)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(cg.x=r.normal.x>0?e.max.x:e.min.x,cg.y=r.normal.y>0?e.max.y:e.min.y,cg.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(cg)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class dg extends ui{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ue(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const fg=new N,pg=new N,eC=new pt,qd=new Xm,mg=new Wm,Ox=new N,tC=new N;class eB extends gn{constructor(e=new ci,t=new dg){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let r=1,s=t.count;r<s;r++)fg.fromBufferAttribute(t,r-1),pg.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=fg.distanceTo(pg);e.setAttribute("lineDistance",new _n(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),mg.copy(i.boundingSphere),mg.applyMatrix4(r),mg.radius+=s,e.ray.intersectsSphere(mg)===!1)return;eC.copy(r).invert(),qd.copy(e.ray).applyMatrix4(eC);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,u=this.isLineSegments?2:1,c=i.index,d=i.attributes.position;if(c!==null){const f=Math.max(0,o.start),m=Math.min(c.count,o.start+o.count);for(let g=f,_=m-1;g<_;g+=u){const p=c.getX(g),v=c.getX(g+1),y=gg(this,e,qd,l,p,v);y&&t.push(y)}if(this.isLineLoop){const g=c.getX(m-1),_=c.getX(f),p=gg(this,e,qd,l,g,_);p&&t.push(p)}}else{const f=Math.max(0,o.start),m=Math.min(d.count,o.start+o.count);for(let g=f,_=m-1;g<_;g+=u){const p=gg(this,e,qd,l,g,g+1);p&&t.push(p)}if(this.isLineLoop){const g=gg(this,e,qd,l,m-1,f);g&&t.push(g)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function gg(n,e,t,i,r,s){const o=n.geometry.attributes.position;if(fg.fromBufferAttribute(o,r),pg.fromBufferAttribute(o,s),t.distanceSqToSegment(fg,pg,Ox,tC)>i)return;Ox.applyMatrix4(n.matrixWorld);const l=e.ray.origin.distanceTo(Ox);if(!(l<e.near||l>e.far))return{distance:l,point:tC.clone().applyMatrix4(n.matrixWorld),index:r,face:null,faceIndex:null,barycoord:null,object:n}}class tB extends ui{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ue(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Dc=class extends gn{constructor(){super(),this.isGroup=!0,this.type="Group"}};class nB extends Tn{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Vt,this.minFilter=Vt,this.generateMipmaps=!1,this.needsUpdate=!0}}class iB extends Tn{constructor(e,t,i,r,s,o,a,l,u){super(e,t,i,r,s,o,a,l,u),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Aa extends Tn{constructor(e,t,i,r,s,o,a,l,u,c=Rs){if(c!==Rs&&c!==Ns)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&c===Rs&&(i=rn),i===void 0&&c===Ns&&(i=Cs),super(null,r,s,o,a,l,c,i,u),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:Vt,this.minFilter=l!==void 0?l:Vt,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class xo{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,r=this.getPoint(0),s=0;t.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),s+=i.distanceTo(r),t.push(s),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let r=0;const s=i.length;let o;t?o=t:o=e*i[s-1];let a=0,l=s-1,u;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),u=i[r]-o,u<0)a=r+1;else if(u>0)l=r-1;else{l=r;break}if(r=l,i[r]===o)return r/(s-1);const c=i[r],d=i[r+1]-c,f=(o-c)/d;return(r+f)/(s-1)}getTangent(e,t){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const o=this.getPoint(r),a=this.getPoint(s),l=t||(o.isVector2?new he:new N);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new N,r=[],s=[],o=[],a=new N,l=new pt;for(let f=0;f<=e;f++){const m=f/e;r[f]=this.getTangentAt(m,new N)}s[0]=new N,o[0]=new N;let u=Number.MAX_VALUE;const c=Math.abs(r[0].x),h=Math.abs(r[0].y),d=Math.abs(r[0].z);c<=u&&(u=c,i.set(1,0,0)),h<=u&&(u=h,i.set(0,1,0)),d<=u&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),s[0].crossVectors(r[0],a),o[0].crossVectors(r[0],s[0]);for(let f=1;f<=e;f++){if(s[f]=s[f-1].clone(),o[f]=o[f-1].clone(),a.crossVectors(r[f-1],r[f]),a.length()>Number.EPSILON){a.normalize();const m=Math.acos(nt(r[f-1].dot(r[f]),-1,1));s[f].applyMatrix4(l.makeRotationAxis(a,m))}o[f].crossVectors(r[f],s[f])}if(t===!0){let f=Math.acos(nt(s[0].dot(s[e]),-1,1));f/=e,r[0].dot(a.crossVectors(s[0],s[e]))>0&&(f=-f);for(let m=1;m<=e;m++)s[m].applyMatrix4(l.makeRotationAxis(r[m],f*m)),o[m].crossVectors(r[m],s[m])}return{tangents:r,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class nC extends xo{constructor(e=0,t=0,i=1,r=1,s=0,o=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,t=new he){const i=t,r=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(o?s=0:s=r),this.aClockwise===!0&&!o&&(s===r?s=-r:s=s-r);const a=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(a),u=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const c=Math.cos(this.aRotation),h=Math.sin(this.aRotation),d=l-this.aX,f=u-this.aY;l=d*c-f*h+this.aX,u=d*h+f*c+this.aY}return i.set(l,u)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class rB extends nC{constructor(e,t,i,r,s,o){super(e,t,i,i,r,s,o),this.isArcCurve=!0,this.type="ArcCurve"}}function Bx(){let n=0,e=0,t=0,i=0;function r(s,o,a,l){n=s,e=a,t=-3*s+3*o-2*a-l,i=2*s-2*o+a+l}return{initCatmullRom:function(s,o,a,l,u){r(o,a,u*(a-s),u*(l-o))},initNonuniformCatmullRom:function(s,o,a,l,u,c,h){let d=(o-s)/u-(a-s)/(u+c)+(a-o)/c,f=(a-o)/c-(l-o)/(c+h)+(l-a)/h;d*=c,f*=c,r(o,a,d,f)},calc:function(s){const o=s*s,a=o*s;return n+e*s+t*o+i*a}}}const _g=new N,kx=new Bx,zx=new Bx,Gx=new Bx;class sB extends xo{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new N){const i=t,r=this.points,s=r.length,o=(s-(this.closed?0:1))*e;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:l===0&&a===s-1&&(a=s-2,l=1);let u,c;this.closed||a>0?u=r[(a-1)%s]:(_g.subVectors(r[0],r[1]).add(r[0]),u=_g);const h=r[a%s],d=r[(a+1)%s];if(this.closed||a+2<s?c=r[(a+2)%s]:(_g.subVectors(r[s-1],r[s-2]).add(r[s-1]),c=_g),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let m=Math.pow(u.distanceToSquared(h),f),g=Math.pow(h.distanceToSquared(d),f),_=Math.pow(d.distanceToSquared(c),f);g<1e-4&&(g=1),m<1e-4&&(m=g),_<1e-4&&(_=g),kx.initNonuniformCatmullRom(u.x,h.x,d.x,c.x,m,g,_),zx.initNonuniformCatmullRom(u.y,h.y,d.y,c.y,m,g,_),Gx.initNonuniformCatmullRom(u.z,h.z,d.z,c.z,m,g,_)}else this.curveType==="catmullrom"&&(kx.initCatmullRom(u.x,h.x,d.x,c.x,this.tension),zx.initCatmullRom(u.y,h.y,d.y,c.y,this.tension),Gx.initCatmullRom(u.z,h.z,d.z,c.z,this.tension));return i.set(kx.calc(l),zx.calc(l),Gx.calc(l)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new N().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function iC(n,e,t,i,r){const s=(i-e)*.5,o=(r-t)*.5,a=n*n,l=n*a;return(2*t-2*i+s+o)*l+(-3*t+3*i-2*s-o)*a+s*n+t}function oB(n,e){const t=1-n;return t*t*e}function aB(n,e){return 2*(1-n)*n*e}function lB(n,e){return n*n*e}function Yd(n,e,t,i){return oB(n,e)+aB(n,t)+lB(n,i)}function uB(n,e){const t=1-n;return t*t*t*e}function cB(n,e){const t=1-n;return 3*t*t*n*e}function hB(n,e){return 3*(1-n)*n*n*e}function dB(n,e){return n*n*n*e}function Kd(n,e,t,i,r){return uB(n,e)+cB(n,t)+hB(n,i)+dB(n,r)}class fB extends xo{constructor(e=new he,t=new he,i=new he,r=new he){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new he){const i=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return i.set(Kd(e,r.x,s.x,o.x,a.x),Kd(e,r.y,s.y,o.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class rC extends xo{constructor(e=new N,t=new N,i=new N,r=new N){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new N){const i=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return i.set(Kd(e,r.x,s.x,o.x,a.x),Kd(e,r.y,s.y,o.y,a.y),Kd(e,r.z,s.z,o.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class pB extends xo{constructor(e=new he,t=new he){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new he){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new he){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class mB extends xo{constructor(e=new N,t=new N){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new N){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new N){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class gB extends xo{constructor(e=new he,t=new he,i=new he){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new he){const i=t,r=this.v0,s=this.v1,o=this.v2;return i.set(Yd(e,r.x,s.x,o.x),Yd(e,r.y,s.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Vx extends xo{constructor(e=new N,t=new N,i=new N){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new N){const i=t,r=this.v0,s=this.v1,o=this.v2;return i.set(Yd(e,r.x,s.x,o.x),Yd(e,r.y,s.y,o.y),Yd(e,r.z,s.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class _B extends xo{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new he){const i=t,r=this.points,s=(r.length-1)*e,o=Math.floor(s),a=s-o,l=r[o===0?o:o-1],u=r[o],c=r[o>r.length-2?r.length-1:o+1],h=r[o>r.length-3?r.length-1:o+2];return i.set(iC(a,l.x,u.x,c.x,h.x),iC(a,l.y,u.y,c.y,h.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new he().fromArray(r))}return this}}var vB=Object.freeze({__proto__:null,ArcCurve:rB,CatmullRomCurve3:sB,CubicBezierCurve:fB,CubicBezierCurve3:rC,EllipseCurve:nC,LineCurve:pB,LineCurve3:mB,QuadraticBezierCurve:gB,QuadraticBezierCurve3:Vx,SplineCurve:_B});class vg extends ci{constructor(e=1,t=1,i=1,r=32,s=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l};const u=this;r=Math.floor(r),s=Math.floor(s);const c=[],h=[],d=[],f=[];let m=0;const g=[],_=i/2;let p=0;v(),o===!1&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(c),this.setAttribute("position",new _n(h,3)),this.setAttribute("normal",new _n(d,3)),this.setAttribute("uv",new _n(f,2));function v(){const x=new N,S=new N;let T=0;const w=(t-e)/i;for(let E=0;E<=s;E++){const M=[],b=E/s,C=b*(t-e)+e;for(let I=0;I<=r;I++){const U=I/r,D=U*l+a,L=Math.sin(D),F=Math.cos(D);S.x=C*L,S.y=-b*i+_,S.z=C*F,h.push(S.x,S.y,S.z),x.set(L,w,F).normalize(),d.push(x.x,x.y,x.z),f.push(U,1-b),M.push(m++)}g.push(M)}for(let E=0;E<r;E++)for(let M=0;M<s;M++){const b=g[M][E],C=g[M+1][E],I=g[M+1][E+1],U=g[M][E+1];(e>0||M!==0)&&(c.push(b,C,U),T+=3),(t>0||M!==s-1)&&(c.push(C,I,U),T+=3)}u.addGroup(p,T,0),p+=T}function y(x){const S=m,T=new he,w=new N;let E=0;const M=x===!0?e:t,b=x===!0?1:-1;for(let I=1;I<=r;I++)h.push(0,_*b,0),d.push(0,b,0),f.push(.5,.5),m++;const C=m;for(let I=0;I<=r;I++){const D=I/r*l+a,L=Math.cos(D),F=Math.sin(D);w.x=M*F,w.y=_*b,w.z=M*L,h.push(w.x,w.y,w.z),d.push(0,b,0),T.x=L*.5+.5,T.y=F*.5*b+.5,f.push(T.x,T.y),m++}for(let I=0;I<r;I++){const U=S+I,D=C+I;x===!0?c.push(D,D+1,U):c.push(D+1,D,U),E+=3}u.addGroup(p,E,x===!0?1:2),p+=E}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new vg(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Hx extends vg{constructor(e=1,t=1,i=32,r=1,s=!1,o=0,a=Math.PI*2){super(0,e,t,i,r,s,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a}}static fromJSON(e){return new Hx(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class yg extends ci{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(i),l=Math.floor(r),u=a+1,c=l+1,h=e/a,d=t/l,f=[],m=[],g=[],_=[];for(let p=0;p<c;p++){const v=p*d-o;for(let y=0;y<u;y++){const x=y*h-s;m.push(x,-v,0),g.push(0,0,1),_.push(y/a),_.push(1-p/l)}}for(let p=0;p<l;p++)for(let v=0;v<a;v++){const y=v+u*p,x=v+u*(p+1),S=v+1+u*(p+1),T=v+1+u*p;f.push(y,x,T),f.push(x,S,T)}this.setIndex(f),this.setAttribute("position",new _n(m,3)),this.setAttribute("normal",new _n(g,3)),this.setAttribute("uv",new _n(_,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new yg(e.width,e.height,e.widthSegments,e.heightSegments)}}class Qd extends ci{constructor(e=1,t=32,i=16,r=0,s=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:s,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const l=Math.min(o+a,Math.PI);let u=0;const c=[],h=new N,d=new N,f=[],m=[],g=[],_=[];for(let p=0;p<=i;p++){const v=[],y=p/i;let x=0;p===0&&o===0?x=.5/t:p===i&&l===Math.PI&&(x=-.5/t);for(let S=0;S<=t;S++){const T=S/t;h.x=-e*Math.cos(r+T*s)*Math.sin(o+y*a),h.y=e*Math.cos(o+y*a),h.z=e*Math.sin(r+T*s)*Math.sin(o+y*a),m.push(h.x,h.y,h.z),d.copy(h).normalize(),g.push(d.x,d.y,d.z),_.push(T+x,1-y),v.push(u++)}c.push(v)}for(let p=0;p<i;p++)for(let v=0;v<t;v++){const y=c[p][v+1],x=c[p][v],S=c[p+1][v],T=c[p+1][v+1];(p!==0||o>0)&&f.push(y,x,T),(p!==i-1||l<Math.PI)&&f.push(x,S,T)}this.setIndex(f),this.setAttribute("position",new _n(m,3)),this.setAttribute("normal",new _n(g,3)),this.setAttribute("uv",new _n(_,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Qd(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Wx extends ci{constructor(e=new Vx(new N(-1,-1,0),new N(-1,1,0),new N(1,1,0)),t=64,i=1,r=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:s};const o=e.computeFrenetFrames(t,s);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new N,l=new N,u=new he;let c=new N;const h=[],d=[],f=[],m=[];g(),this.setIndex(m),this.setAttribute("position",new _n(h,3)),this.setAttribute("normal",new _n(d,3)),this.setAttribute("uv",new _n(f,2));function g(){for(let y=0;y<t;y++)_(y);_(s===!1?t:0),v(),p()}function _(y){c=e.getPointAt(y/t,c);const x=o.normals[y],S=o.binormals[y];for(let T=0;T<=r;T++){const w=T/r*Math.PI*2,E=Math.sin(w),M=-Math.cos(w);l.x=M*x.x+E*S.x,l.y=M*x.y+E*S.y,l.z=M*x.z+E*S.z,l.normalize(),d.push(l.x,l.y,l.z),a.x=c.x+i*l.x,a.y=c.y+i*l.y,a.z=c.z+i*l.z,h.push(a.x,a.y,a.z)}}function p(){for(let y=1;y<=t;y++)for(let x=1;x<=r;x++){const S=(r+1)*(y-1)+(x-1),T=(r+1)*y+(x-1),w=(r+1)*y+x,E=(r+1)*(y-1)+x;m.push(S,T,E),m.push(T,w,E)}}function v(){for(let y=0;y<=t;y++)for(let x=0;x<=r;x++)u.x=y/t,u.y=x/r,f.push(u.x,u.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Wx(new vB[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class yB extends ui{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Ue(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class sC extends ui{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Ue(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ue(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=uo,this.normalScale=new he(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new gr,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class xB extends sC{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new he(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return nt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Ue(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Ue(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ue(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class SB extends ui{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ue(16777215),this.specular=new Ue(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ue(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=uo,this.normalScale=new he(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new gr,this.combine=Md,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class TB extends ui{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ue(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ue(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=uo,this.normalScale=new he(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class bB extends ui{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=uo,this.normalScale=new he(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class oC extends ui{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ue(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ue(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=uo,this.normalScale=new he(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new gr,this.combine=Md,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class wB extends ui{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=YO,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class MB extends ui{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class EB extends ui{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ue(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=uo,this.normalScale=new he(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class AB extends dg{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}const aC={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class CB{constructor(e,t,i){const r=this;let s=!1,o=0,a=0,l;const u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(c){a++,s===!1&&r.onStart!==void 0&&r.onStart(c,o,a),s=!0},this.itemEnd=function(c){o++,r.onProgress!==void 0&&r.onProgress(c,o,a),o===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(c){r.onError!==void 0&&r.onError(c)},this.resolveURL=function(c){return l?l(c):c},this.setURLModifier=function(c){return l=c,this},this.addHandler=function(c,h){return u.push(c,h),this},this.removeHandler=function(c){const h=u.indexOf(c);return h!==-1&&u.splice(h,2),this},this.getHandler=function(c){for(let h=0,d=u.length;h<d;h+=2){const f=u[h],m=u[h+1];if(f.global&&(f.lastIndex=0),f.test(c))return m}return null}}}const RB=new CB;class $x{constructor(e){this.manager=e!==void 0?e:RB,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(r,s){i.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}$x.DEFAULT_MATERIAL_NAME="__DEFAULT";class NB extends $x{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=aC.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=Bd("img");function l(){c(),aC.add(e,this),t&&t(this),s.manager.itemEnd(e)}function u(h){c(),r&&r(h),s.manager.itemError(e),s.manager.itemEnd(e)}function c(){a.removeEventListener("load",l,!1),a.removeEventListener("error",u,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",u,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class PB extends $x{constructor(e){super(e)}load(e,t,i,r){const s=new Tn,o=new NB(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,t!==void 0&&t(s)},i,r),s}}class Nl extends gn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Ue(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}class DB extends Nl{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(gn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Ue(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const jx=new pt,lC=new N,uC=new N;class Xx{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new he(512,512),this.map=null,this.mapPass=null,this.matrix=new pt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new hg,this._frameExtents=new he(1,1),this._viewportCount=1,this._viewports=[new et(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;lC.setFromMatrixPosition(e.matrixWorld),t.position.copy(lC),uC.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(uC),t.updateMatrixWorld(),jx.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(jx),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(jx)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class LB extends Xx{constructor(){super(new Ai(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=dc*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(i!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=i,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class cC extends Nl{constructor(e,t,i=0,r=Math.PI/3,s=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(gn.DEFAULT_UP),this.updateMatrix(),this.target=new gn,this.distance=i,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new LB}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const hC=new pt,Zd=new N,qx=new N;class IB extends Xx{constructor(){super(new Ai(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new he(4,2),this._viewportCount=6,this._viewports=[new et(2,1,1,1),new et(0,1,1,1),new et(3,1,1,1),new et(1,1,1,1),new et(3,0,1,1),new et(1,0,1,1)],this._cubeDirections=[new N(1,0,0),new N(-1,0,0),new N(0,0,1),new N(0,0,-1),new N(0,1,0),new N(0,-1,0)],this._cubeUps=[new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,0,1),new N(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,r=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),Zd.setFromMatrixPosition(e.matrixWorld),i.position.copy(Zd),qx.copy(i.position),qx.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(qx),i.updateMatrixWorld(),r.makeTranslation(-Zd.x,-Zd.y,-Zd.z),hC.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(hC)}}class UB extends Nl{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new IB}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Jd extends jA{constructor(e=-1,t=1,i=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,o=i+e,a=r+t,l=r-t;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=u*this.view.offsetX,o=s+u*this.view.width,a-=c*this.view.offsetY,l=a-c*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class FB extends Xx{constructor(){super(new Jd(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class dC extends Nl{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(gn.DEFAULT_UP),this.updateMatrix(),this.target=new gn,this.shadow=new FB}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class fC extends Nl{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class OB extends Nl{constructor(e,t,i=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class BB{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new N)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*s),t.addScaledVector(o[3],.488603*i),t.addScaledVector(o[4],1.092548*(i*r)),t.addScaledVector(o[5],1.092548*(r*s)),t.addScaledVector(o[6],.315392*(3*s*s-1)),t.addScaledVector(o[7],1.092548*(i*s)),t.addScaledVector(o[8],.546274*(i*i-r*r)),t}getIrradianceAt(e,t){const i=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*r),t.addScaledVector(o[2],2*.511664*s),t.addScaledVector(o[3],2*.511664*i),t.addScaledVector(o[4],2*.429043*i*r),t.addScaledVector(o[5],2*.429043*r*s),t.addScaledVector(o[6],.743125*s*s-.247708),t.addScaledVector(o[7],2*.429043*i*s),t.addScaledVector(o[8],.429043*(i*i-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const i=e.x,r=e.y,s=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*s,t[3]=.488603*i,t[4]=1.092548*i*r,t[5]=1.092548*r*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*i*s,t[8]=.546274*(i*i-r*r)}}class kB extends Nl{constructor(e=new BB,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class zB extends Ai{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class pC{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=mC(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=mC();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function mC(){return performance.now()}class GB extends Lx{constructor(e,t,i=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}const gC=new pt;class _C{constructor(e,t,i=0,r=1/0){this.ray=new Xm(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new vx,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return gC.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(gC),this}intersectObject(e,t=!0,i=[]){return Yx(e,this,i,t),i.sort(vC),i}intersectObjects(e,t=!0,i=[]){for(let r=0,s=e.length;r<s;r++)Yx(e[r],this,i,t);return i.sort(vC),i}}function vC(n,e){return n.distance-e.distance}function Yx(n,e,t,i){let r=!0;if(n.layers.test(e.layers)&&n.raycast(e,t)===!1&&(r=!1),r===!0&&i===!0){const s=n.children;for(let o=0,a=s.length;o<a;o++)Yx(s[o],e,t,!0)}}class Kx{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=nt(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(nt(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class xg extends co{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}function yC(n,e,t,i){const r=VB(i);switch(t){case Yy:return n*e;case Ky:return n*e;case Qy:return n*e*2;case Ad:return n*e/r.components*r.byteLength;case ju:return n*e/r.components*r.byteLength;case yl:return n*e*2/r.components*r.byteLength;case Xu:return n*e*2/r.components*r.byteLength;case Ed:return n*e*3/r.components*r.byteLength;case Kn:return n*e*4/r.components*r.byteLength;case qu:return n*e*4/r.components*r.byteLength;case xl:case ga:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case _a:case va:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Rd:case Pd:return Math.max(n,16)*Math.max(e,8)/4;case Cd:case Nd:return Math.max(n,8)*Math.max(e,8)/2;case Dd:case Yu:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case Ku:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Qu:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Zu:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case Ju:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case ec:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case tc:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case nc:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case ic:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case rc:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case sc:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case oc:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case ac:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case lc:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case uc:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case cc:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case Sl:case Zy:case Jy:return Math.ceil(n/4)*Math.ceil(e/4)*16;case ex:case Ld:return Math.ceil(n/4)*Math.ceil(e/4)*8;case Id:case Ud:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function VB(n){switch(n){case oi:case _l:return{byteLength:1,components:1};case rs:case vl:case wi:return{byteLength:2,components:1};case Lm:case Im:return{byteLength:2,components:4};case rn:case Hn:case mn:return{byteLength:4,components:1};case Um:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Gu}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Gu);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function xC(){let n=null,e=!1,t=null,i=null;function r(s,o){t(s,o),i=n.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function HB(n){const e=new WeakMap;function t(a,l){const u=a.array,c=a.usage,h=u.byteLength,d=n.createBuffer();n.bindBuffer(l,d),n.bufferData(l,u,c),a.onUploadCallback();let f;if(u instanceof Float32Array)f=n.FLOAT;else if(u instanceof Uint16Array)a.isFloat16BufferAttribute?f=n.HALF_FLOAT:f=n.UNSIGNED_SHORT;else if(u instanceof Int16Array)f=n.SHORT;else if(u instanceof Uint32Array)f=n.UNSIGNED_INT;else if(u instanceof Int32Array)f=n.INT;else if(u instanceof Int8Array)f=n.BYTE;else if(u instanceof Uint8Array)f=n.UNSIGNED_BYTE;else if(u instanceof Uint8ClampedArray)f=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:d,type:f,bytesPerElement:u.BYTES_PER_ELEMENT,version:a.version,size:h}}function i(a,l,u){const c=l.array,h=l.updateRanges;if(n.bindBuffer(u,a),h.length===0)n.bufferSubData(u,0,c);else{h.sort((f,m)=>f.start-m.start);let d=0;for(let f=1;f<h.length;f++){const m=h[d],g=h[f];g.start<=m.start+m.count+1?m.count=Math.max(m.count,g.start+g.count-m.start):(++d,h[d]=g)}h.length=d+1;for(let f=0,m=h.length;f<m;f++){const g=h[f];n.bufferSubData(u,g.start*c.BYTES_PER_ELEMENT,c,g.start,g.count)}l.clearUpdateRanges()}l.onUploadCallback()}function r(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function s(a){a.isInterleavedBufferAttribute&&(a=a.data);const l=e.get(a);l&&(n.deleteBuffer(l.buffer),e.delete(a))}function o(a,l){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const c=e.get(a);(!c||c.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const u=e.get(a);if(u===void 0)e.set(a,t(a,l));else if(u.version<a.version){if(u.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(u.buffer,a,l),u.version=a.version}}return{get:r,remove:s,update:o}}var WB=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,$B=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,jB=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,XB=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,qB=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,YB=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,KB=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,QB=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,ZB=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,JB=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,ek=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,tk=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,nk=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,ik=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,rk=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,sk=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,ok=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,ak=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,lk=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,uk=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,ck=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,hk=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,dk=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,fk=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,pk=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,mk=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,gk=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,_k=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,vk=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,yk=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,xk="gl_FragColor = linearToOutputTexel( gl_FragColor );",Sk=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Tk=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,bk=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,wk=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Mk=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Ek=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Ak=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Ck=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Rk=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Nk=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Pk=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Dk=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Lk=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Ik=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Uk=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Fk=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,Ok=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Bk=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,kk=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,zk=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Gk=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,Vk=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Hk=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Wk=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,$k=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,jk=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Xk=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,qk=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Yk=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,Kk=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,Qk=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Zk=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Jk=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,ez=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,tz=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,nz=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,iz=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,rz=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,sz=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,oz=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,az=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,lz=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,uz=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,cz=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,hz=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,dz=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,fz=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,pz=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,mz=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,gz=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,_z=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,vz=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,yz=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,xz=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Sz=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Tz=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,bz=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,wz=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Mz=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,Ez=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Az=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Cz=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Rz=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Nz=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Pz=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Dz=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Lz=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Iz=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Uz=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Fz=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Oz=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,Bz=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,kz=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,zz=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Gz=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,Vz=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const ot={alphahash_fragment:WB,alphahash_pars_fragment:$B,alphamap_fragment:jB,alphamap_pars_fragment:XB,alphatest_fragment:qB,alphatest_pars_fragment:YB,aomap_fragment:KB,aomap_pars_fragment:QB,batching_pars_vertex:ZB,batching_vertex:JB,begin_vertex:ek,beginnormal_vertex:tk,bsdfs:nk,iridescence_fragment:ik,bumpmap_pars_fragment:rk,clipping_planes_fragment:sk,clipping_planes_pars_fragment:ok,clipping_planes_pars_vertex:ak,clipping_planes_vertex:lk,color_fragment:uk,color_pars_fragment:ck,color_pars_vertex:hk,color_vertex:dk,common:fk,cube_uv_reflection_fragment:pk,defaultnormal_vertex:mk,displacementmap_pars_vertex:gk,displacementmap_vertex:_k,emissivemap_fragment:vk,emissivemap_pars_fragment:yk,colorspace_fragment:xk,colorspace_pars_fragment:Sk,envmap_fragment:Tk,envmap_common_pars_fragment:bk,envmap_pars_fragment:wk,envmap_pars_vertex:Mk,envmap_physical_pars_fragment:Fk,envmap_vertex:Ek,fog_vertex:Ak,fog_pars_vertex:Ck,fog_fragment:Rk,fog_pars_fragment:Nk,gradientmap_pars_fragment:Pk,lightmap_pars_fragment:Dk,lights_lambert_fragment:Lk,lights_lambert_pars_fragment:Ik,lights_pars_begin:Uk,lights_toon_fragment:Ok,lights_toon_pars_fragment:Bk,lights_phong_fragment:kk,lights_phong_pars_fragment:zk,lights_physical_fragment:Gk,lights_physical_pars_fragment:Vk,lights_fragment_begin:Hk,lights_fragment_maps:Wk,lights_fragment_end:$k,logdepthbuf_fragment:jk,logdepthbuf_pars_fragment:Xk,logdepthbuf_pars_vertex:qk,logdepthbuf_vertex:Yk,map_fragment:Kk,map_pars_fragment:Qk,map_particle_fragment:Zk,map_particle_pars_fragment:Jk,metalnessmap_fragment:ez,metalnessmap_pars_fragment:tz,morphinstance_vertex:nz,morphcolor_vertex:iz,morphnormal_vertex:rz,morphtarget_pars_vertex:sz,morphtarget_vertex:oz,normal_fragment_begin:az,normal_fragment_maps:lz,normal_pars_fragment:uz,normal_pars_vertex:cz,normal_vertex:hz,normalmap_pars_fragment:dz,clearcoat_normal_fragment_begin:fz,clearcoat_normal_fragment_maps:pz,clearcoat_pars_fragment:mz,iridescence_pars_fragment:gz,opaque_fragment:_z,packing:vz,premultiplied_alpha_fragment:yz,project_vertex:xz,dithering_fragment:Sz,dithering_pars_fragment:Tz,roughnessmap_fragment:bz,roughnessmap_pars_fragment:wz,shadowmap_pars_fragment:Mz,shadowmap_pars_vertex:Ez,shadowmap_vertex:Az,shadowmask_pars_fragment:Cz,skinbase_vertex:Rz,skinning_pars_vertex:Nz,skinning_vertex:Pz,skinnormal_vertex:Dz,specularmap_fragment:Lz,specularmap_pars_fragment:Iz,tonemapping_fragment:Uz,tonemapping_pars_fragment:Fz,transmission_fragment:Oz,transmission_pars_fragment:Bz,uv_pars_fragment:kz,uv_pars_vertex:zz,uv_vertex:Gz,worldpos_vertex:Vz,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,depth_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`},xe={common:{diffuse:{value:new Ue(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new je},alphaMap:{value:null},alphaMapTransform:{value:new je},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new je}},envmap:{envMap:{value:null},envMapRotation:{value:new je},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new je}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new je}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new je},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new je},normalScale:{value:new he(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new je},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new je}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new je}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new je}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ue(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ue(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new je},alphaTest:{value:0},uvTransform:{value:new je}},sprite:{diffuse:{value:new Ue(16777215)},opacity:{value:1},center:{value:new he(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new je},alphaMap:{value:null},alphaMapTransform:{value:new je},alphaTest:{value:0}}},Ds={basic:{uniforms:Ei([xe.common,xe.specularmap,xe.envmap,xe.aomap,xe.lightmap,xe.fog]),vertexShader:ot.meshbasic_vert,fragmentShader:ot.meshbasic_frag},lambert:{uniforms:Ei([xe.common,xe.specularmap,xe.envmap,xe.aomap,xe.lightmap,xe.emissivemap,xe.bumpmap,xe.normalmap,xe.displacementmap,xe.fog,xe.lights,{emissive:{value:new Ue(0)}}]),vertexShader:ot.meshlambert_vert,fragmentShader:ot.meshlambert_frag},phong:{uniforms:Ei([xe.common,xe.specularmap,xe.envmap,xe.aomap,xe.lightmap,xe.emissivemap,xe.bumpmap,xe.normalmap,xe.displacementmap,xe.fog,xe.lights,{emissive:{value:new Ue(0)},specular:{value:new Ue(1118481)},shininess:{value:30}}]),vertexShader:ot.meshphong_vert,fragmentShader:ot.meshphong_frag},standard:{uniforms:Ei([xe.common,xe.envmap,xe.aomap,xe.lightmap,xe.emissivemap,xe.bumpmap,xe.normalmap,xe.displacementmap,xe.roughnessmap,xe.metalnessmap,xe.fog,xe.lights,{emissive:{value:new Ue(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ot.meshphysical_vert,fragmentShader:ot.meshphysical_frag},toon:{uniforms:Ei([xe.common,xe.aomap,xe.lightmap,xe.emissivemap,xe.bumpmap,xe.normalmap,xe.displacementmap,xe.gradientmap,xe.fog,xe.lights,{emissive:{value:new Ue(0)}}]),vertexShader:ot.meshtoon_vert,fragmentShader:ot.meshtoon_frag},matcap:{uniforms:Ei([xe.common,xe.bumpmap,xe.normalmap,xe.displacementmap,xe.fog,{matcap:{value:null}}]),vertexShader:ot.meshmatcap_vert,fragmentShader:ot.meshmatcap_frag},points:{uniforms:Ei([xe.points,xe.fog]),vertexShader:ot.points_vert,fragmentShader:ot.points_frag},dashed:{uniforms:Ei([xe.common,xe.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ot.linedashed_vert,fragmentShader:ot.linedashed_frag},depth:{uniforms:Ei([xe.common,xe.displacementmap]),vertexShader:ot.depth_vert,fragmentShader:ot.depth_frag},normal:{uniforms:Ei([xe.common,xe.bumpmap,xe.normalmap,xe.displacementmap,{opacity:{value:1}}]),vertexShader:ot.meshnormal_vert,fragmentShader:ot.meshnormal_frag},sprite:{uniforms:Ei([xe.sprite,xe.fog]),vertexShader:ot.sprite_vert,fragmentShader:ot.sprite_frag},background:{uniforms:{uvTransform:{value:new je},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ot.background_vert,fragmentShader:ot.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new je}},vertexShader:ot.backgroundCube_vert,fragmentShader:ot.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ot.cube_vert,fragmentShader:ot.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ot.equirect_vert,fragmentShader:ot.equirect_frag},distanceRGBA:{uniforms:Ei([xe.common,xe.displacementmap,{referencePosition:{value:new N},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ot.distanceRGBA_vert,fragmentShader:ot.distanceRGBA_frag},shadow:{uniforms:Ei([xe.lights,xe.fog,{color:{value:new Ue(0)},opacity:{value:1}}]),vertexShader:ot.shadow_vert,fragmentShader:ot.shadow_frag}};Ds.physical={uniforms:Ei([Ds.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new je},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new je},clearcoatNormalScale:{value:new he(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new je},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new je},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new je},sheen:{value:0},sheenColor:{value:new Ue(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new je},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new je},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new je},transmissionSamplerSize:{value:new he},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new je},attenuationDistance:{value:0},attenuationColor:{value:new Ue(0)},specularColor:{value:new Ue(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new je},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new je},anisotropyVector:{value:new he},anisotropyMap:{value:null},anisotropyMapTransform:{value:new je}}]),vertexShader:ot.meshphysical_vert,fragmentShader:ot.meshphysical_frag};const Sg={r:0,b:0,g:0},Pl=new gr,Hz=new pt;function Wz(n,e,t,i,r,s,o){const a=new Ue(0);let l=s===!0?0:1,u,c,h=null,d=0,f=null;function m(y){let x=y.isScene===!0?y.background:null;return x&&x.isTexture&&(x=(y.backgroundBlurriness>0?t:e).get(x)),x}function g(y){let x=!1;const S=m(y);S===null?p(a,l):S&&S.isColor&&(p(S,1),x=!0);const T=n.xr.getEnvironmentBlendMode();T==="additive"?i.buffers.color.setClear(0,0,0,1,o):T==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,o),(n.autoClear||x)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function _(y,x){const S=m(x);S&&(S.isCubeTexture||S.mapping===pl)?(c===void 0&&(c=new $n(new Cl(1,1,1),new Ps({name:"BackgroundCubeMaterial",uniforms:Mc(Ds.backgroundCube.uniforms),vertexShader:Ds.backgroundCube.vertexShader,fragmentShader:Ds.backgroundCube.fragmentShader,side:Xt,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(T,w,E){this.matrixWorld.copyPosition(E.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),Pl.copy(x.backgroundRotation),Pl.x*=-1,Pl.y*=-1,Pl.z*=-1,S.isCubeTexture&&S.isRenderTargetTexture===!1&&(Pl.y*=-1,Pl.z*=-1),c.material.uniforms.envMap.value=S,c.material.uniforms.flipEnvMap.value=S.isCubeTexture&&S.isRenderTargetTexture===!1?-1:1,c.material.uniforms.backgroundBlurriness.value=x.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(Hz.makeRotationFromEuler(Pl)),c.material.toneMapped=st.getTransfer(S.colorSpace)!==At,(h!==S||d!==S.version||f!==n.toneMapping)&&(c.material.needsUpdate=!0,h=S,d=S.version,f=n.toneMapping),c.layers.enableAll(),y.unshift(c,c.geometry,c.material,0,0,null)):S&&S.isTexture&&(u===void 0&&(u=new $n(new yg(2,2),new Ps({name:"BackgroundMaterial",uniforms:Mc(Ds.background.uniforms),vertexShader:Ds.background.vertexShader,fragmentShader:Ds.background.fragmentShader,side:is,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(u)),u.material.uniforms.t2D.value=S,u.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,u.material.toneMapped=st.getTransfer(S.colorSpace)!==At,S.matrixAutoUpdate===!0&&S.updateMatrix(),u.material.uniforms.uvTransform.value.copy(S.matrix),(h!==S||d!==S.version||f!==n.toneMapping)&&(u.material.needsUpdate=!0,h=S,d=S.version,f=n.toneMapping),u.layers.enableAll(),y.unshift(u,u.geometry,u.material,0,0,null))}function p(y,x){y.getRGB(Sg,WA(n)),i.buffers.color.setClear(Sg.r,Sg.g,Sg.b,x,o)}function v(){c!==void 0&&(c.geometry.dispose(),c.material.dispose()),u!==void 0&&(u.geometry.dispose(),u.material.dispose())}return{getClearColor:function(){return a},setClearColor:function(y,x=1){a.set(y),l=x,p(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(y){l=y,p(a,l)},render:g,addToRenderList:_,dispose:v}}function $z(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},r=d(null);let s=r,o=!1;function a(b,C,I,U,D){let L=!1;const F=h(U,I,C);s!==F&&(s=F,u(s.object)),L=f(b,U,I,D),L&&m(b,U,I,D),D!==null&&e.update(D,n.ELEMENT_ARRAY_BUFFER),(L||o)&&(o=!1,x(b,C,I,U),D!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(D).buffer))}function l(){return n.createVertexArray()}function u(b){return n.bindVertexArray(b)}function c(b){return n.deleteVertexArray(b)}function h(b,C,I){const U=I.wireframe===!0;let D=i[b.id];D===void 0&&(D={},i[b.id]=D);let L=D[C.id];L===void 0&&(L={},D[C.id]=L);let F=L[U];return F===void 0&&(F=d(l()),L[U]=F),F}function d(b){const C=[],I=[],U=[];for(let D=0;D<t;D++)C[D]=0,I[D]=0,U[D]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:C,enabledAttributes:I,attributeDivisors:U,object:b,attributes:{},index:null}}function f(b,C,I,U){const D=s.attributes,L=C.attributes;let F=0;const Q=I.getAttributes();for(const B in Q)if(Q[B].location>=0){const H=D[B];let K=L[B];if(K===void 0&&(B==="instanceMatrix"&&b.instanceMatrix&&(K=b.instanceMatrix),B==="instanceColor"&&b.instanceColor&&(K=b.instanceColor)),H===void 0||H.attribute!==K||K&&H.data!==K.data)return!0;F++}return s.attributesNum!==F||s.index!==U}function m(b,C,I,U){const D={},L=C.attributes;let F=0;const Q=I.getAttributes();for(const B in Q)if(Q[B].location>=0){let H=L[B];H===void 0&&(B==="instanceMatrix"&&b.instanceMatrix&&(H=b.instanceMatrix),B==="instanceColor"&&b.instanceColor&&(H=b.instanceColor));const K={};K.attribute=H,H&&H.data&&(K.data=H.data),D[B]=K,F++}s.attributes=D,s.attributesNum=F,s.index=U}function g(){const b=s.newAttributes;for(let C=0,I=b.length;C<I;C++)b[C]=0}function _(b){p(b,0)}function p(b,C){const I=s.newAttributes,U=s.enabledAttributes,D=s.attributeDivisors;I[b]=1,U[b]===0&&(n.enableVertexAttribArray(b),U[b]=1),D[b]!==C&&(n.vertexAttribDivisor(b,C),D[b]=C)}function v(){const b=s.newAttributes,C=s.enabledAttributes;for(let I=0,U=C.length;I<U;I++)C[I]!==b[I]&&(n.disableVertexAttribArray(I),C[I]=0)}function y(b,C,I,U,D,L,F){F===!0?n.vertexAttribIPointer(b,C,I,D,L):n.vertexAttribPointer(b,C,I,U,D,L)}function x(b,C,I,U){g();const D=U.attributes,L=I.getAttributes(),F=C.defaultAttributeValues;for(const Q in L){const B=L[Q];if(B.location>=0){let J=D[Q];if(J===void 0&&(Q==="instanceMatrix"&&b.instanceMatrix&&(J=b.instanceMatrix),Q==="instanceColor"&&b.instanceColor&&(J=b.instanceColor)),J!==void 0){const H=J.normalized,K=J.itemSize,le=e.get(J);if(le===void 0)continue;const Pe=le.buffer,O=le.type,j=le.bytesPerElement,ae=O===n.INT||O===n.UNSIGNED_INT||J.gpuType===Hn;if(J.isInterleavedBufferAttribute){const re=J.data,Ee=re.stride,Re=J.offset;if(re.isInstancedInterleavedBuffer){for(let Fe=0;Fe<B.locationSize;Fe++)p(B.location+Fe,re.meshPerAttribute);b.isInstancedMesh!==!0&&U._maxInstanceCount===void 0&&(U._maxInstanceCount=re.meshPerAttribute*re.count)}else for(let Fe=0;Fe<B.locationSize;Fe++)_(B.location+Fe);n.bindBuffer(n.ARRAY_BUFFER,Pe);for(let Fe=0;Fe<B.locationSize;Fe++)y(B.location+Fe,K/B.locationSize,O,H,Ee*j,(Re+K/B.locationSize*Fe)*j,ae)}else{if(J.isInstancedBufferAttribute){for(let re=0;re<B.locationSize;re++)p(B.location+re,J.meshPerAttribute);b.isInstancedMesh!==!0&&U._maxInstanceCount===void 0&&(U._maxInstanceCount=J.meshPerAttribute*J.count)}else for(let re=0;re<B.locationSize;re++)_(B.location+re);n.bindBuffer(n.ARRAY_BUFFER,Pe);for(let re=0;re<B.locationSize;re++)y(B.location+re,K/B.locationSize,O,H,K*j,K/B.locationSize*re*j,ae)}}else if(F!==void 0){const H=F[Q];if(H!==void 0)switch(H.length){case 2:n.vertexAttrib2fv(B.location,H);break;case 3:n.vertexAttrib3fv(B.location,H);break;case 4:n.vertexAttrib4fv(B.location,H);break;default:n.vertexAttrib1fv(B.location,H)}}}}v()}function S(){E();for(const b in i){const C=i[b];for(const I in C){const U=C[I];for(const D in U)c(U[D].object),delete U[D];delete C[I]}delete i[b]}}function T(b){if(i[b.id]===void 0)return;const C=i[b.id];for(const I in C){const U=C[I];for(const D in U)c(U[D].object),delete U[D];delete C[I]}delete i[b.id]}function w(b){for(const C in i){const I=i[C];if(I[b.id]===void 0)continue;const U=I[b.id];for(const D in U)c(U[D].object),delete U[D];delete I[b.id]}}function E(){M(),o=!0,s!==r&&(s=r,u(s.object))}function M(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:a,reset:E,resetDefaultState:M,dispose:S,releaseStatesOfGeometry:T,releaseStatesOfProgram:w,initAttributes:g,enableAttribute:_,disableUnusedAttributes:v}}function jz(n,e,t){let i;function r(u){i=u}function s(u,c){n.drawArrays(i,u,c),t.update(c,i,1)}function o(u,c,h){h!==0&&(n.drawArraysInstanced(i,u,c,h),t.update(c,i,h))}function a(u,c,h){if(h===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,u,0,c,0,h);let f=0;for(let m=0;m<h;m++)f+=c[m];t.update(f,i,1)}function l(u,c,h,d){if(h===0)return;const f=e.get("WEBGL_multi_draw");if(f===null)for(let m=0;m<u.length;m++)o(u[m],c[m],d[m]);else{f.multiDrawArraysInstancedWEBGL(i,u,0,c,0,d,0,h);let m=0;for(let g=0;g<h;g++)m+=c[g]*d[g];t.update(m,i,1)}}this.setMode=r,this.render=s,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=l}function Xz(n,e,t,i){let r;function s(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const w=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(w.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function o(w){return!(w!==Kn&&i.convert(w)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(w){const E=w===wi&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(w!==oi&&i.convert(w)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&w!==mn&&!E)}function l(w){if(w==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";w="mediump"}return w==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let u=t.precision!==void 0?t.precision:"highp";const c=l(u);c!==u&&(console.warn("THREE.WebGLRenderer:",u,"not supported, using",c,"instead."),u=c);const h=t.logarithmicDepthBuffer===!0,d=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),f=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),m=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),g=n.getParameter(n.MAX_TEXTURE_SIZE),_=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),p=n.getParameter(n.MAX_VERTEX_ATTRIBS),v=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),y=n.getParameter(n.MAX_VARYING_VECTORS),x=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),S=m>0,T=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:l,textureFormatReadable:o,textureTypeReadable:a,precision:u,logarithmicDepthBuffer:h,reverseDepthBuffer:d,maxTextures:f,maxVertexTextures:m,maxTextureSize:g,maxCubemapSize:_,maxAttributes:p,maxVertexUniforms:v,maxVaryings:y,maxFragmentUniforms:x,vertexTextures:S,maxSamples:T}}function qz(n){const e=this;let t=null,i=0,r=!1,s=!1;const o=new us,a=new je,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const f=h.length!==0||d||i!==0||r;return r=d,i=h.length,f},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){t=c(h,d,0)},this.setState=function(h,d,f){const m=h.clippingPlanes,g=h.clipIntersection,_=h.clipShadows,p=n.get(h);if(!r||m===null||m.length===0||s&&!_)s?c(null):u();else{const v=s?0:i,y=v*4;let x=p.clippingState||null;l.value=x,x=c(m,d,y,f);for(let S=0;S!==y;++S)x[S]=t[S];p.clippingState=x,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=v}};function u(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function c(h,d,f,m){const g=h!==null?h.length:0;let _=null;if(g!==0){if(_=l.value,m!==!0||_===null){const p=f+g*4,v=d.matrixWorldInverse;a.getNormalMatrix(v),(_===null||_.length<p)&&(_=new Float32Array(p));for(let y=0,x=f;y!==g;++y,x+=4)o.copy(h[y]).applyMatrix4(v,a),o.normal.toArray(_,x),_[x+3]=o.constant}l.value=_,l.needsUpdate=!0}return e.numPlanes=g,e.numIntersection=0,_}}function Yz(n){let e=new WeakMap;function t(o,a){return a===pa?o.mapping=Br:a===ma&&(o.mapping=kr),o}function i(o){if(o&&o.isTexture){const a=o.mapping;if(a===pa||a===ma)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const u=new KA(l.height);return u.fromEquirectangularTexture(n,o),e.set(o,u),o.addEventListener("dispose",r),t(u.texture,o.mapping)}else return null}}return o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function s(){e=new WeakMap}return{get:i,dispose:s}}const Lc=4,SC=[.125,.215,.35,.446,.526,.582],Dl=20,Qx=new Jd,TC=new Ue;let Zx=null,Jx=0,eS=0,tS=!1;const Ll=(1+Math.sqrt(5))/2,Ic=1/Ll,bC=[new N(-Ll,Ic,0),new N(Ll,Ic,0),new N(-Ic,0,Ll),new N(Ic,0,Ll),new N(0,Ll,-Ic),new N(0,Ll,Ic),new N(-1,1,-1),new N(1,1,-1),new N(-1,1,1),new N(1,1,1)];let wC=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){Zx=this._renderer.getRenderTarget(),Jx=this._renderer.getActiveCubeFace(),eS=this._renderer.getActiveMipmapLevel(),tS=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,i,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=AC(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=EC(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Zx,Jx,eS),this._renderer.xr.enabled=tS,e.scissorTest=!1,Tg(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Br||e.mapping===kr?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Zx=this._renderer.getRenderTarget(),Jx=this._renderer.getActiveCubeFace(),eS=this._renderer.getActiveMipmapLevel(),tS=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Sn,minFilter:Sn,generateMipmaps:!1,type:wi,format:Kn,colorSpace:zr,depthBuffer:!1},r=MC(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=MC(e,t,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Kz(s)),this._blurMaterial=Qz(s,e,t)}return r}_compileMaterial(e){const t=new $n(this._lodPlanes[0],e);this._renderer.compile(t,Qx)}_sceneToCubeUV(e,t,i,r){const a=new Ai(90,1,t,i),l=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],c=this._renderer,h=c.autoClear,d=c.toneMapping;c.getClearColor(TC),c.toneMapping=Gi,c.autoClear=!1;const f=new Vd({name:"PMREM.Background",side:Xt,depthWrite:!1,depthTest:!1}),m=new $n(new Cl,f);let g=!1;const _=e.background;_?_.isColor&&(f.color.copy(_),e.background=null,g=!0):(f.color.copy(TC),g=!0);for(let p=0;p<6;p++){const v=p%3;v===0?(a.up.set(0,l[p],0),a.lookAt(u[p],0,0)):v===1?(a.up.set(0,0,l[p]),a.lookAt(0,u[p],0)):(a.up.set(0,l[p],0),a.lookAt(0,0,u[p]));const y=this._cubeSize;Tg(r,v*y,p>2?y:0,y,y),c.setRenderTarget(r),g&&c.render(m,a),c.render(e,a)}m.geometry.dispose(),m.material.dispose(),c.toneMapping=d,c.autoClear=h,e.background=_}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===Br||e.mapping===kr;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=AC()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=EC());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new $n(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const l=this._cubeSize;Tg(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(o,Qx)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let s=1;s<r;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=bC[(r-s-1)%bC.length];this._blur(e,s-1,s,o,a)}t.autoClear=i}_blur(e,t,i,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,r,"latitudinal",s),this._halfBlur(o,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,o,a){const l=this._renderer,u=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const c=3,h=new $n(this._lodPlanes[r],u),d=u.uniforms,f=this._sizeLods[i]-1,m=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*Dl-1),g=s/m,_=isFinite(s)?1+Math.floor(c*g):Dl;_>Dl&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${_} samples when the maximum is set to ${Dl}`);const p=[];let v=0;for(let w=0;w<Dl;++w){const E=w/g,M=Math.exp(-E*E/2);p.push(M),w===0?v+=M:w<_&&(v+=2*M)}for(let w=0;w<p.length;w++)p[w]=p[w]/v;d.envMap.value=e.texture,d.samples.value=_,d.weights.value=p,d.latitudinal.value=o==="latitudinal",a&&(d.poleAxis.value=a);const{_lodMax:y}=this;d.dTheta.value=m,d.mipInt.value=y-i;const x=this._sizeLods[r],S=3*x*(r>y-Lc?r-y+Lc:0),T=4*(this._cubeSize-x);Tg(t,S,T,3*x,2*x),l.setRenderTarget(t),l.render(h,Qx)}};function Kz(n){const e=[],t=[],i=[];let r=n;const s=n-Lc+1+SC.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);t.push(a);let l=1/a;o>n-Lc?l=SC[o-n+Lc-1]:o===0&&(l=0),i.push(l);const u=1/(a-2),c=-u,h=1+u,d=[c,c,h,c,h,h,c,c,h,h,c,h],f=6,m=6,g=3,_=2,p=1,v=new Float32Array(g*m*f),y=new Float32Array(_*m*f),x=new Float32Array(p*m*f);for(let T=0;T<f;T++){const w=T%3*2/3-1,E=T>2?0:-1,M=[w,E,0,w+2/3,E,0,w+2/3,E+1,0,w,E,0,w+2/3,E+1,0,w,E+1,0];v.set(M,g*m*T),y.set(d,_*m*T);const b=[T,T,T,T,T,T];x.set(b,p*m*T)}const S=new ci;S.setAttribute("position",new Qn(v,g)),S.setAttribute("uv",new Qn(y,_)),S.setAttribute("faceIndex",new Qn(x,p)),e.push(S),r>Lc&&r--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function MC(n,e,t){const i=new xa(n,e,t);return i.texture.mapping=pl,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Tg(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function Qz(n,e,t){const i=new Float32Array(Dl),r=new N(0,1,0);return new Ps({name:"SphericalGaussianBlur",defines:{n:Dl,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:nS(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:zi,depthTest:!1,depthWrite:!1})}function EC(){return new Ps({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:nS(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:zi,depthTest:!1,depthWrite:!1})}function AC(){return new Ps({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:nS(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:zi,depthTest:!1,depthWrite:!1})}function nS(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Zz(n){let e=new WeakMap,t=null;function i(a){if(a&&a.isTexture){const l=a.mapping,u=l===pa||l===ma,c=l===Br||l===kr;if(u||c){let h=e.get(a);const d=h!==void 0?h.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==d)return t===null&&(t=new wC(n)),h=u?t.fromEquirectangular(a,h):t.fromCubemap(a,h),h.texture.pmremVersion=a.pmremVersion,e.set(a,h),h.texture;if(h!==void 0)return h.texture;{const f=a.image;return u&&f&&f.height>0||c&&f&&r(f)?(t===null&&(t=new wC(n)),h=u?t.fromEquirectangular(a):t.fromCubemap(a),h.texture.pmremVersion=a.pmremVersion,e.set(a,h),a.addEventListener("dispose",s),h.texture):null}}}return a}function r(a){let l=0;const u=6;for(let c=0;c<u;c++)a[c]!==void 0&&l++;return l===u}function s(a){const l=a.target;l.removeEventListener("dispose",s);const u=e.get(l);u!==void 0&&(e.delete(l),u.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:o}}function Jz(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const r=t(i);return r===null&&bl("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function eG(n,e,t,i){const r={},s=new WeakMap;function o(h){const d=h.target;d.index!==null&&e.remove(d.index);for(const m in d.attributes)e.remove(d.attributes[m]);d.removeEventListener("dispose",o),delete r[d.id];const f=s.get(d);f&&(e.remove(f),s.delete(d)),i.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,t.memory.geometries--}function a(h,d){return r[d.id]===!0||(d.addEventListener("dispose",o),r[d.id]=!0,t.memory.geometries++),d}function l(h){const d=h.attributes;for(const f in d)e.update(d[f],n.ARRAY_BUFFER)}function u(h){const d=[],f=h.index,m=h.attributes.position;let g=0;if(f!==null){const v=f.array;g=f.version;for(let y=0,x=v.length;y<x;y+=3){const S=v[y+0],T=v[y+1],w=v[y+2];d.push(S,T,T,w,w,S)}}else if(m!==void 0){const v=m.array;g=m.version;for(let y=0,x=v.length/3-1;y<x;y+=3){const S=y+0,T=y+1,w=y+2;d.push(S,T,T,w,w,S)}}else return;const _=new(wA(d)?Rx:Cx)(d,1);_.version=g;const p=s.get(h);p&&e.remove(p),s.set(h,_)}function c(h){const d=s.get(h);if(d){const f=h.index;f!==null&&d.version<f.version&&u(h)}else u(h);return s.get(h)}return{get:a,update:l,getWireframeAttribute:c}}function tG(n,e,t){let i;function r(d){i=d}let s,o;function a(d){s=d.type,o=d.bytesPerElement}function l(d,f){n.drawElements(i,f,s,d*o),t.update(f,i,1)}function u(d,f,m){m!==0&&(n.drawElementsInstanced(i,f,s,d*o,m),t.update(f,i,m))}function c(d,f,m){if(m===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,f,0,s,d,0,m);let _=0;for(let p=0;p<m;p++)_+=f[p];t.update(_,i,1)}function h(d,f,m,g){if(m===0)return;const _=e.get("WEBGL_multi_draw");if(_===null)for(let p=0;p<d.length;p++)u(d[p]/o,f[p],g[p]);else{_.multiDrawElementsInstancedWEBGL(i,f,0,s,d,0,g,0,m);let p=0;for(let v=0;v<m;v++)p+=f[v]*g[v];t.update(p,i,1)}}this.setMode=r,this.setIndex=a,this.render=l,this.renderInstances=u,this.renderMultiDraw=c,this.renderMultiDrawInstances=h}function nG(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,o,a){switch(t.calls++,o){case n.TRIANGLES:t.triangles+=a*(s/3);break;case n.LINES:t.lines+=a*(s/2);break;case n.LINE_STRIP:t.lines+=a*(s-1);break;case n.LINE_LOOP:t.lines+=a*s;break;case n.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:i}}function iG(n,e,t){const i=new WeakMap,r=new et;function s(o,a,l){const u=o.morphTargetInfluences,c=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,h=c!==void 0?c.length:0;let d=i.get(a);if(d===void 0||d.count!==h){let M=function(){w.dispose(),i.delete(a),a.removeEventListener("dispose",M)};d!==void 0&&d.texture.dispose();const f=a.morphAttributes.position!==void 0,m=a.morphAttributes.normal!==void 0,g=a.morphAttributes.color!==void 0,_=a.morphAttributes.position||[],p=a.morphAttributes.normal||[],v=a.morphAttributes.color||[];let y=0;f===!0&&(y=1),m===!0&&(y=2),g===!0&&(y=3);let x=a.attributes.position.count*y,S=1;x>e.maxTextureSize&&(S=Math.ceil(x/e.maxTextureSize),x=e.maxTextureSize);const T=new Float32Array(x*S*4*h),w=new hx(T,x,S,h);w.type=mn,w.needsUpdate=!0;const E=y*4;for(let b=0;b<h;b++){const C=_[b],I=p[b],U=v[b],D=x*S*4*b;for(let L=0;L<C.count;L++){const F=L*E;f===!0&&(r.fromBufferAttribute(C,L),T[D+F+0]=r.x,T[D+F+1]=r.y,T[D+F+2]=r.z,T[D+F+3]=0),m===!0&&(r.fromBufferAttribute(I,L),T[D+F+4]=r.x,T[D+F+5]=r.y,T[D+F+6]=r.z,T[D+F+7]=0),g===!0&&(r.fromBufferAttribute(U,L),T[D+F+8]=r.x,T[D+F+9]=r.y,T[D+F+10]=r.z,T[D+F+11]=U.itemSize===4?r.w:1)}}d={count:h,texture:w,size:new he(x,S)},i.set(a,d),a.addEventListener("dispose",M)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)l.getUniforms().setValue(n,"morphTexture",o.morphTexture,t);else{let f=0;for(let g=0;g<u.length;g++)f+=u[g];const m=a.morphTargetsRelative?1:1-f;l.getUniforms().setValue(n,"morphTargetBaseInfluence",m),l.getUniforms().setValue(n,"morphTargetInfluences",u)}l.getUniforms().setValue(n,"morphTargetsTexture",d.texture,t),l.getUniforms().setValue(n,"morphTargetsTextureSize",d.size)}return{update:s}}function rG(n,e,t,i){let r=new WeakMap;function s(l){const u=i.render.frame,c=l.geometry,h=e.get(l,c);if(r.get(h)!==u&&(e.update(h),r.set(h,u)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),r.get(l)!==u&&(t.update(l.instanceMatrix,n.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,n.ARRAY_BUFFER),r.set(l,u))),l.isSkinnedMesh){const d=l.skeleton;r.get(d)!==u&&(d.update(),r.set(d,u))}return h}function o(){r=new WeakMap}function a(l){const u=l.target;u.removeEventListener("dispose",a),t.remove(u.instanceMatrix),u.instanceColor!==null&&t.remove(u.instanceColor)}return{update:s,dispose:o}}const CC=new Tn,RC=new Aa(1,1),NC=new hx,PC=new I3,DC=new og,LC=[],IC=[],UC=new Float32Array(16),FC=new Float32Array(9),OC=new Float32Array(4);function Uc(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let s=LC[r];if(s===void 0&&(s=new Float32Array(r),LC[r]=s),e!==0){i.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(s,a)}return s}function Un(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function Fn(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function bg(n,e){let t=IC[e];t===void 0&&(t=new Int32Array(e),IC[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function sG(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function oG(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Un(t,e))return;n.uniform2fv(this.addr,e),Fn(t,e)}}function aG(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Un(t,e))return;n.uniform3fv(this.addr,e),Fn(t,e)}}function lG(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Un(t,e))return;n.uniform4fv(this.addr,e),Fn(t,e)}}function uG(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Un(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Fn(t,e)}else{if(Un(t,i))return;OC.set(i),n.uniformMatrix2fv(this.addr,!1,OC),Fn(t,i)}}function cG(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Un(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Fn(t,e)}else{if(Un(t,i))return;FC.set(i),n.uniformMatrix3fv(this.addr,!1,FC),Fn(t,i)}}function hG(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Un(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Fn(t,e)}else{if(Un(t,i))return;UC.set(i),n.uniformMatrix4fv(this.addr,!1,UC),Fn(t,i)}}function dG(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function fG(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Un(t,e))return;n.uniform2iv(this.addr,e),Fn(t,e)}}function pG(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Un(t,e))return;n.uniform3iv(this.addr,e),Fn(t,e)}}function mG(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Un(t,e))return;n.uniform4iv(this.addr,e),Fn(t,e)}}function gG(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function _G(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Un(t,e))return;n.uniform2uiv(this.addr,e),Fn(t,e)}}function vG(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Un(t,e))return;n.uniform3uiv(this.addr,e),Fn(t,e)}}function yG(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Un(t,e))return;n.uniform4uiv(this.addr,e),Fn(t,e)}}function xG(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r);let s;this.type===n.SAMPLER_2D_SHADOW?(RC.compareFunction=Bm,s=RC):s=CC,t.setTexture2D(e||s,r)}function SG(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||PC,r)}function TG(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||DC,r)}function bG(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||NC,r)}function wG(n){switch(n){case 5126:return sG;case 35664:return oG;case 35665:return aG;case 35666:return lG;case 35674:return uG;case 35675:return cG;case 35676:return hG;case 5124:case 35670:return dG;case 35667:case 35671:return fG;case 35668:case 35672:return pG;case 35669:case 35673:return mG;case 5125:return gG;case 36294:return _G;case 36295:return vG;case 36296:return yG;case 35678:case 36198:case 36298:case 36306:case 35682:return xG;case 35679:case 36299:case 36307:return SG;case 35680:case 36300:case 36308:case 36293:return TG;case 36289:case 36303:case 36311:case 36292:return bG}}function MG(n,e){n.uniform1fv(this.addr,e)}function EG(n,e){const t=Uc(e,this.size,2);n.uniform2fv(this.addr,t)}function AG(n,e){const t=Uc(e,this.size,3);n.uniform3fv(this.addr,t)}function CG(n,e){const t=Uc(e,this.size,4);n.uniform4fv(this.addr,t)}function RG(n,e){const t=Uc(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function NG(n,e){const t=Uc(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function PG(n,e){const t=Uc(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function DG(n,e){n.uniform1iv(this.addr,e)}function LG(n,e){n.uniform2iv(this.addr,e)}function IG(n,e){n.uniform3iv(this.addr,e)}function UG(n,e){n.uniform4iv(this.addr,e)}function FG(n,e){n.uniform1uiv(this.addr,e)}function OG(n,e){n.uniform2uiv(this.addr,e)}function BG(n,e){n.uniform3uiv(this.addr,e)}function kG(n,e){n.uniform4uiv(this.addr,e)}function zG(n,e,t){const i=this.cache,r=e.length,s=bg(t,r);Un(i,s)||(n.uniform1iv(this.addr,s),Fn(i,s));for(let o=0;o!==r;++o)t.setTexture2D(e[o]||CC,s[o])}function GG(n,e,t){const i=this.cache,r=e.length,s=bg(t,r);Un(i,s)||(n.uniform1iv(this.addr,s),Fn(i,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||PC,s[o])}function VG(n,e,t){const i=this.cache,r=e.length,s=bg(t,r);Un(i,s)||(n.uniform1iv(this.addr,s),Fn(i,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||DC,s[o])}function HG(n,e,t){const i=this.cache,r=e.length,s=bg(t,r);Un(i,s)||(n.uniform1iv(this.addr,s),Fn(i,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||NC,s[o])}function WG(n){switch(n){case 5126:return MG;case 35664:return EG;case 35665:return AG;case 35666:return CG;case 35674:return RG;case 35675:return NG;case 35676:return PG;case 5124:case 35670:return DG;case 35667:case 35671:return LG;case 35668:case 35672:return IG;case 35669:case 35673:return UG;case 5125:return FG;case 36294:return OG;case 36295:return BG;case 36296:return kG;case 35678:case 36198:case 36298:case 36306:case 35682:return zG;case 35679:case 36299:case 36307:return GG;case 35680:case 36300:case 36308:case 36293:return VG;case 36289:case 36303:case 36311:case 36292:return HG}}class $G{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=wG(t.type)}}class jG{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=WG(t.type)}}class XG{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,t[a.id],i)}}}const iS=/(\w+)(\])?(\[|\.)?/g;function BC(n,e){n.seq.push(e),n.map[e.id]=e}function qG(n,e,t){const i=n.name,r=i.length;for(iS.lastIndex=0;;){const s=iS.exec(i),o=iS.lastIndex;let a=s[1];const l=s[2]==="]",u=s[3];if(l&&(a=a|0),u===void 0||u==="["&&o+2===r){BC(t,u===void 0?new $G(a,n,e):new jG(a,n,e));break}else{let h=t.map[a];h===void 0&&(h=new XG(a),BC(t,h)),t=h}}}class wg{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const s=e.getActiveUniform(t,r),o=e.getUniformLocation(t,s.name);qG(s,o,this)}}setValue(e,t,i,r){const s=this.map[t];s!==void 0&&s.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let s=0,o=t.length;s!==o;++s){const a=t[s],l=i[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&i.push(o)}return i}}function kC(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}const YG=37297;let KG=0;function QG(n,e){const t=n.split(`
`),i=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join(`
`)}const zC=new je;function ZG(n){st._getMatrix(zC,st.workingColorSpace,n);const e=`mat3( ${zC.elements.map(t=>t.toFixed(4))} )`;switch(st.getTransfer(n)){case Fm:return[e,"LinearTransferOETF"];case At:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",n),[e,"LinearTransferOETF"]}}function GC(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),r=n.getShaderInfoLog(e).trim();if(i&&r==="")return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return t.toUpperCase()+`

`+r+`

`+QG(n.getShaderSource(e),o)}else return r}function JG(n,e){const t=ZG(e);return[`vec4 ${n}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function e4(n,e){let t;switch(e){case mA:t="Linear";break;case gA:t="Reinhard";break;case _A:t="Cineon";break;case vA:t="ACESFilmic";break;case yA:t="AgX";break;case xA:t="Neutral";break;case XO:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const Mg=new N;function t4(){st.getLuminanceCoefficients(Mg);const n=Mg.x.toFixed(4),e=Mg.y.toFixed(4),t=Mg.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function n4(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(ef).join(`
`)}function i4(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function r4(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const s=n.getActiveAttrib(e,r),o=s.name;let a=1;s.type===n.FLOAT_MAT2&&(a=2),s.type===n.FLOAT_MAT3&&(a=3),s.type===n.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}function ef(n){return n!==""}function VC(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function HC(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const s4=/^[ \t]*#include +<([\w\d./]+)>/gm;function rS(n){return n.replace(s4,a4)}const o4=new Map;function a4(n,e){let t=ot[e];if(t===void 0){const i=o4.get(e);if(i!==void 0)t=ot[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return rS(t)}const l4=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function WC(n){return n.replace(l4,u4)}function u4(n,e,t,i){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function $C(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function c4(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===Uy?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===VO?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===dr&&(e="SHADOWMAP_TYPE_VSM"),e}function h4(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Br:case kr:e="ENVMAP_TYPE_CUBE";break;case pl:e="ENVMAP_TYPE_CUBE_UV";break}return e}function d4(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case kr:e="ENVMAP_MODE_REFRACTION";break}return e}function f4(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case Md:e="ENVMAP_BLENDING_MULTIPLY";break;case fA:e="ENVMAP_BLENDING_MIX";break;case pA:e="ENVMAP_BLENDING_ADD";break}return e}function p4(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function m4(n,e,t,i){const r=n.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=c4(t),u=h4(t),c=d4(t),h=f4(t),d=p4(t),f=n4(t),m=i4(s),g=r.createProgram();let _,p,v=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(_=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m].filter(ef).join(`
`),_.length>0&&(_+=`
`),p=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m].filter(ef).join(`
`),p.length>0&&(p+=`
`)):(_=[$C(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(ef).join(`
`),p=[$C(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Gi?"#define TONE_MAPPING":"",t.toneMapping!==Gi?ot.tonemapping_pars_fragment:"",t.toneMapping!==Gi?e4("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",ot.colorspace_pars_fragment,JG("linearToOutputTexel",t.outputColorSpace),t4(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(ef).join(`
`)),o=rS(o),o=VC(o,t),o=HC(o,t),a=rS(a),a=VC(a,t),a=HC(a,t),o=WC(o),a=WC(a),t.isRawShaderMaterial!==!0&&(v=`#version 300 es
`,_=[f,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+_,p=["#define varying in",t.glslVersion===TA?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===TA?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+p);const y=v+_+o,x=v+p+a,S=kC(r,r.VERTEX_SHADER,y),T=kC(r,r.FRAGMENT_SHADER,x);r.attachShader(g,S),r.attachShader(g,T),t.index0AttributeName!==void 0?r.bindAttribLocation(g,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(g,0,"position"),r.linkProgram(g);function w(C){if(n.debug.checkShaderErrors){const I=r.getProgramInfoLog(g).trim(),U=r.getShaderInfoLog(S).trim(),D=r.getShaderInfoLog(T).trim();let L=!0,F=!0;if(r.getProgramParameter(g,r.LINK_STATUS)===!1)if(L=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(r,g,S,T);else{const Q=GC(r,S,"vertex"),B=GC(r,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(g,r.VALIDATE_STATUS)+`

Material Name: `+C.name+`
Material Type: `+C.type+`

Program Info Log: `+I+`
`+Q+`
`+B)}else I!==""?console.warn("THREE.WebGLProgram: Program Info Log:",I):(U===""||D==="")&&(F=!1);F&&(C.diagnostics={runnable:L,programLog:I,vertexShader:{log:U,prefix:_},fragmentShader:{log:D,prefix:p}})}r.deleteShader(S),r.deleteShader(T),E=new wg(r,g),M=r4(r,g)}let E;this.getUniforms=function(){return E===void 0&&w(this),E};let M;this.getAttributes=function(){return M===void 0&&w(this),M};let b=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return b===!1&&(b=r.getProgramParameter(g,YG)),b},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(g),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=KG++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=S,this.fragmentShader=T,this}let g4=0;class _4{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new v4(e),t.set(e,i)),i}}class v4{constructor(e){this.id=g4++,this.code=e,this.usedTimes=0}}function y4(n,e,t,i,r,s,o){const a=new vx,l=new _4,u=new Set,c=[],h=r.logarithmicDepthBuffer,d=r.vertexTextures;let f=r.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(M){return u.add(M),M===0?"uv":`uv${M}`}function _(M,b,C,I,U){const D=I.fog,L=U.geometry,F=M.isMeshStandardMaterial?I.environment:null,Q=(M.isMeshStandardMaterial?t:e).get(M.envMap||F),B=Q&&Q.mapping===pl?Q.image.height:null,J=m[M.type];M.precision!==null&&(f=r.getMaxPrecision(M.precision),f!==M.precision&&console.warn("THREE.WebGLProgram.getParameters:",M.precision,"not supported, using",f,"instead."));const H=L.morphAttributes.position||L.morphAttributes.normal||L.morphAttributes.color,K=H!==void 0?H.length:0;let le=0;L.morphAttributes.position!==void 0&&(le=1),L.morphAttributes.normal!==void 0&&(le=2),L.morphAttributes.color!==void 0&&(le=3);let Pe,O,j,ae;if(J){const It=Ds[J];Pe=It.vertexShader,O=It.fragmentShader}else Pe=M.vertexShader,O=M.fragmentShader,l.update(M),j=l.getVertexShaderID(M),ae=l.getFragmentShaderID(M);const re=n.getRenderTarget(),Ee=n.state.buffers.depth.getReversed(),Re=U.isInstancedMesh===!0,Fe=U.isBatchedMesh===!0,gt=!!M.map,ut=!!M.matcap,Rt=!!Q,z=!!M.aoMap,ln=!!M.lightMap,ct=!!M.bumpMap,dt=!!M.normalMap,Ge=!!M.displacementMap,$t=!!M.emissiveMap,ze=!!M.metalnessMap,P=!!M.roughnessMap,A=M.anisotropy>0,X=M.clearcoat>0,ue=M.dispersion>0,de=M.iridescence>0,se=M.sheen>0,ke=M.transmission>0,be=A&&!!M.anisotropyMap,Ne=X&&!!M.clearcoatMap,St=X&&!!M.clearcoatNormalMap,_e=X&&!!M.clearcoatRoughnessMap,De=de&&!!M.iridescenceMap,$e=de&&!!M.iridescenceThicknessMap,Ye=se&&!!M.sheenColorMap,Le=se&&!!M.sheenRoughnessMap,_t=!!M.specularMap,lt=!!M.specularColorMap,kt=!!M.specularIntensityMap,G=ke&&!!M.transmissionMap,Se=ke&&!!M.thicknessMap,te=!!M.gradientMap,ce=!!M.alphaMap,Me=M.alphaTest>0,we=!!M.alphaHash,rt=!!M.extensions;let dn=Gi;M.toneMapped&&(re===null||re.isXRRenderTarget===!0)&&(dn=n.toneMapping);const _i={shaderID:J,shaderType:M.type,shaderName:M.name,vertexShader:Pe,fragmentShader:O,defines:M.defines,customVertexShaderID:j,customFragmentShaderID:ae,isRawShaderMaterial:M.isRawShaderMaterial===!0,glslVersion:M.glslVersion,precision:f,batching:Fe,batchingColor:Fe&&U._colorsTexture!==null,instancing:Re,instancingColor:Re&&U.instanceColor!==null,instancingMorph:Re&&U.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:re===null?n.outputColorSpace:re.isXRRenderTarget===!0?re.texture.colorSpace:zr,alphaToCoverage:!!M.alphaToCoverage,map:gt,matcap:ut,envMap:Rt,envMapMode:Rt&&Q.mapping,envMapCubeUVHeight:B,aoMap:z,lightMap:ln,bumpMap:ct,normalMap:dt,displacementMap:d&&Ge,emissiveMap:$t,normalMapObjectSpace:dt&&M.normalMapType===SA,normalMapTangentSpace:dt&&M.normalMapType===uo,metalnessMap:ze,roughnessMap:P,anisotropy:A,anisotropyMap:be,clearcoat:X,clearcoatMap:Ne,clearcoatNormalMap:St,clearcoatRoughnessMap:_e,dispersion:ue,iridescence:de,iridescenceMap:De,iridescenceThicknessMap:$e,sheen:se,sheenColorMap:Ye,sheenRoughnessMap:Le,specularMap:_t,specularColorMap:lt,specularIntensityMap:kt,transmission:ke,transmissionMap:G,thicknessMap:Se,gradientMap:te,opaque:M.transparent===!1&&M.blending===Or&&M.alphaToCoverage===!1,alphaMap:ce,alphaTest:Me,alphaHash:we,combine:M.combine,mapUv:gt&&g(M.map.channel),aoMapUv:z&&g(M.aoMap.channel),lightMapUv:ln&&g(M.lightMap.channel),bumpMapUv:ct&&g(M.bumpMap.channel),normalMapUv:dt&&g(M.normalMap.channel),displacementMapUv:Ge&&g(M.displacementMap.channel),emissiveMapUv:$t&&g(M.emissiveMap.channel),metalnessMapUv:ze&&g(M.metalnessMap.channel),roughnessMapUv:P&&g(M.roughnessMap.channel),anisotropyMapUv:be&&g(M.anisotropyMap.channel),clearcoatMapUv:Ne&&g(M.clearcoatMap.channel),clearcoatNormalMapUv:St&&g(M.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:_e&&g(M.clearcoatRoughnessMap.channel),iridescenceMapUv:De&&g(M.iridescenceMap.channel),iridescenceThicknessMapUv:$e&&g(M.iridescenceThicknessMap.channel),sheenColorMapUv:Ye&&g(M.sheenColorMap.channel),sheenRoughnessMapUv:Le&&g(M.sheenRoughnessMap.channel),specularMapUv:_t&&g(M.specularMap.channel),specularColorMapUv:lt&&g(M.specularColorMap.channel),specularIntensityMapUv:kt&&g(M.specularIntensityMap.channel),transmissionMapUv:G&&g(M.transmissionMap.channel),thicknessMapUv:Se&&g(M.thicknessMap.channel),alphaMapUv:ce&&g(M.alphaMap.channel),vertexTangents:!!L.attributes.tangent&&(dt||A),vertexColors:M.vertexColors,vertexAlphas:M.vertexColors===!0&&!!L.attributes.color&&L.attributes.color.itemSize===4,pointsUvs:U.isPoints===!0&&!!L.attributes.uv&&(gt||ce),fog:!!D,useFog:M.fog===!0,fogExp2:!!D&&D.isFogExp2,flatShading:M.flatShading===!0,sizeAttenuation:M.sizeAttenuation===!0,logarithmicDepthBuffer:h,reverseDepthBuffer:Ee,skinning:U.isSkinnedMesh===!0,morphTargets:L.morphAttributes.position!==void 0,morphNormals:L.morphAttributes.normal!==void 0,morphColors:L.morphAttributes.color!==void 0,morphTargetsCount:K,morphTextureStride:le,numDirLights:b.directional.length,numPointLights:b.point.length,numSpotLights:b.spot.length,numSpotLightMaps:b.spotLightMap.length,numRectAreaLights:b.rectArea.length,numHemiLights:b.hemi.length,numDirLightShadows:b.directionalShadowMap.length,numPointLightShadows:b.pointShadowMap.length,numSpotLightShadows:b.spotShadowMap.length,numSpotLightShadowsWithMaps:b.numSpotLightShadowsWithMaps,numLightProbes:b.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:M.dithering,shadowMapEnabled:n.shadowMap.enabled&&C.length>0,shadowMapType:n.shadowMap.type,toneMapping:dn,decodeVideoTexture:gt&&M.map.isVideoTexture===!0&&st.getTransfer(M.map.colorSpace)===At,decodeVideoTextureEmissive:$t&&M.emissiveMap.isVideoTexture===!0&&st.getTransfer(M.emissiveMap.colorSpace)===At,premultipliedAlpha:M.premultipliedAlpha,doubleSided:M.side===Ti,flipSided:M.side===Xt,useDepthPacking:M.depthPacking>=0,depthPacking:M.depthPacking||0,index0AttributeName:M.index0AttributeName,extensionClipCullDistance:rt&&M.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(rt&&M.extensions.multiDraw===!0||Fe)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:M.customProgramCacheKey()};return _i.vertexUv1s=u.has(1),_i.vertexUv2s=u.has(2),_i.vertexUv3s=u.has(3),u.clear(),_i}function p(M){const b=[];if(M.shaderID?b.push(M.shaderID):(b.push(M.customVertexShaderID),b.push(M.customFragmentShaderID)),M.defines!==void 0)for(const C in M.defines)b.push(C),b.push(M.defines[C]);return M.isRawShaderMaterial===!1&&(v(b,M),y(b,M),b.push(n.outputColorSpace)),b.push(M.customProgramCacheKey),b.join()}function v(M,b){M.push(b.precision),M.push(b.outputColorSpace),M.push(b.envMapMode),M.push(b.envMapCubeUVHeight),M.push(b.mapUv),M.push(b.alphaMapUv),M.push(b.lightMapUv),M.push(b.aoMapUv),M.push(b.bumpMapUv),M.push(b.normalMapUv),M.push(b.displacementMapUv),M.push(b.emissiveMapUv),M.push(b.metalnessMapUv),M.push(b.roughnessMapUv),M.push(b.anisotropyMapUv),M.push(b.clearcoatMapUv),M.push(b.clearcoatNormalMapUv),M.push(b.clearcoatRoughnessMapUv),M.push(b.iridescenceMapUv),M.push(b.iridescenceThicknessMapUv),M.push(b.sheenColorMapUv),M.push(b.sheenRoughnessMapUv),M.push(b.specularMapUv),M.push(b.specularColorMapUv),M.push(b.specularIntensityMapUv),M.push(b.transmissionMapUv),M.push(b.thicknessMapUv),M.push(b.combine),M.push(b.fogExp2),M.push(b.sizeAttenuation),M.push(b.morphTargetsCount),M.push(b.morphAttributeCount),M.push(b.numDirLights),M.push(b.numPointLights),M.push(b.numSpotLights),M.push(b.numSpotLightMaps),M.push(b.numHemiLights),M.push(b.numRectAreaLights),M.push(b.numDirLightShadows),M.push(b.numPointLightShadows),M.push(b.numSpotLightShadows),M.push(b.numSpotLightShadowsWithMaps),M.push(b.numLightProbes),M.push(b.shadowMapType),M.push(b.toneMapping),M.push(b.numClippingPlanes),M.push(b.numClipIntersection),M.push(b.depthPacking)}function y(M,b){a.disableAll(),b.supportsVertexTextures&&a.enable(0),b.instancing&&a.enable(1),b.instancingColor&&a.enable(2),b.instancingMorph&&a.enable(3),b.matcap&&a.enable(4),b.envMap&&a.enable(5),b.normalMapObjectSpace&&a.enable(6),b.normalMapTangentSpace&&a.enable(7),b.clearcoat&&a.enable(8),b.iridescence&&a.enable(9),b.alphaTest&&a.enable(10),b.vertexColors&&a.enable(11),b.vertexAlphas&&a.enable(12),b.vertexUv1s&&a.enable(13),b.vertexUv2s&&a.enable(14),b.vertexUv3s&&a.enable(15),b.vertexTangents&&a.enable(16),b.anisotropy&&a.enable(17),b.alphaHash&&a.enable(18),b.batching&&a.enable(19),b.dispersion&&a.enable(20),b.batchingColor&&a.enable(21),M.push(a.mask),a.disableAll(),b.fog&&a.enable(0),b.useFog&&a.enable(1),b.flatShading&&a.enable(2),b.logarithmicDepthBuffer&&a.enable(3),b.reverseDepthBuffer&&a.enable(4),b.skinning&&a.enable(5),b.morphTargets&&a.enable(6),b.morphNormals&&a.enable(7),b.morphColors&&a.enable(8),b.premultipliedAlpha&&a.enable(9),b.shadowMapEnabled&&a.enable(10),b.doubleSided&&a.enable(11),b.flipSided&&a.enable(12),b.useDepthPacking&&a.enable(13),b.dithering&&a.enable(14),b.transmission&&a.enable(15),b.sheen&&a.enable(16),b.opaque&&a.enable(17),b.pointsUvs&&a.enable(18),b.decodeVideoTexture&&a.enable(19),b.decodeVideoTextureEmissive&&a.enable(20),b.alphaToCoverage&&a.enable(21),M.push(a.mask)}function x(M){const b=m[M.type];let C;if(b){const I=Ds[b];C=$A.clone(I.uniforms)}else C=M.uniforms;return C}function S(M,b){let C;for(let I=0,U=c.length;I<U;I++){const D=c[I];if(D.cacheKey===b){C=D,++C.usedTimes;break}}return C===void 0&&(C=new m4(n,b,M,s),c.push(C)),C}function T(M){if(--M.usedTimes===0){const b=c.indexOf(M);c[b]=c[c.length-1],c.pop(),M.destroy()}}function w(M){l.remove(M)}function E(){l.dispose()}return{getParameters:_,getProgramCacheKey:p,getUniforms:x,acquireProgram:S,releaseProgram:T,releaseShaderCache:w,programs:c,dispose:E}}function x4(){let n=new WeakMap;function e(o){return n.has(o)}function t(o){let a=n.get(o);return a===void 0&&(a={},n.set(o,a)),a}function i(o){n.delete(o)}function r(o,a,l){n.get(o)[a]=l}function s(){n=new WeakMap}return{has:e,get:t,remove:i,update:r,dispose:s}}function S4(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function jC(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function XC(){const n=[];let e=0;const t=[],i=[],r=[];function s(){e=0,t.length=0,i.length=0,r.length=0}function o(h,d,f,m,g,_){let p=n[e];return p===void 0?(p={id:h.id,object:h,geometry:d,material:f,groupOrder:m,renderOrder:h.renderOrder,z:g,group:_},n[e]=p):(p.id=h.id,p.object=h,p.geometry=d,p.material=f,p.groupOrder=m,p.renderOrder=h.renderOrder,p.z=g,p.group=_),e++,p}function a(h,d,f,m,g,_){const p=o(h,d,f,m,g,_);f.transmission>0?i.push(p):f.transparent===!0?r.push(p):t.push(p)}function l(h,d,f,m,g,_){const p=o(h,d,f,m,g,_);f.transmission>0?i.unshift(p):f.transparent===!0?r.unshift(p):t.unshift(p)}function u(h,d){t.length>1&&t.sort(h||S4),i.length>1&&i.sort(d||jC),r.length>1&&r.sort(d||jC)}function c(){for(let h=e,d=n.length;h<d;h++){const f=n[h];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:t,transmissive:i,transparent:r,init:s,push:a,unshift:l,finish:c,sort:u}}function T4(){let n=new WeakMap;function e(i,r){const s=n.get(i);let o;return s===void 0?(o=new XC,n.set(i,[o])):r>=s.length?(o=new XC,s.push(o)):o=s[r],o}function t(){n=new WeakMap}return{get:e,dispose:t}}function b4(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new N,color:new Ue};break;case"SpotLight":t={position:new N,direction:new N,color:new Ue,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new N,color:new Ue,distance:0,decay:0};break;case"HemisphereLight":t={direction:new N,skyColor:new Ue,groundColor:new Ue};break;case"RectAreaLight":t={color:new Ue,position:new N,halfWidth:new N,halfHeight:new N};break}return n[e.id]=t,t}}}function w4(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new he};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new he};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new he,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let M4=0;function E4(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function A4(n){const e=new b4,t=w4(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)i.probe.push(new N);const r=new N,s=new pt,o=new pt;function a(u){let c=0,h=0,d=0;for(let M=0;M<9;M++)i.probe[M].set(0,0,0);let f=0,m=0,g=0,_=0,p=0,v=0,y=0,x=0,S=0,T=0,w=0;u.sort(E4);for(let M=0,b=u.length;M<b;M++){const C=u[M],I=C.color,U=C.intensity,D=C.distance,L=C.shadow&&C.shadow.map?C.shadow.map.texture:null;if(C.isAmbientLight)c+=I.r*U,h+=I.g*U,d+=I.b*U;else if(C.isLightProbe){for(let F=0;F<9;F++)i.probe[F].addScaledVector(C.sh.coefficients[F],U);w++}else if(C.isDirectionalLight){const F=e.get(C);if(F.color.copy(C.color).multiplyScalar(C.intensity),C.castShadow){const Q=C.shadow,B=t.get(C);B.shadowIntensity=Q.intensity,B.shadowBias=Q.bias,B.shadowNormalBias=Q.normalBias,B.shadowRadius=Q.radius,B.shadowMapSize=Q.mapSize,i.directionalShadow[f]=B,i.directionalShadowMap[f]=L,i.directionalShadowMatrix[f]=C.shadow.matrix,v++}i.directional[f]=F,f++}else if(C.isSpotLight){const F=e.get(C);F.position.setFromMatrixPosition(C.matrixWorld),F.color.copy(I).multiplyScalar(U),F.distance=D,F.coneCos=Math.cos(C.angle),F.penumbraCos=Math.cos(C.angle*(1-C.penumbra)),F.decay=C.decay,i.spot[g]=F;const Q=C.shadow;if(C.map&&(i.spotLightMap[S]=C.map,S++,Q.updateMatrices(C),C.castShadow&&T++),i.spotLightMatrix[g]=Q.matrix,C.castShadow){const B=t.get(C);B.shadowIntensity=Q.intensity,B.shadowBias=Q.bias,B.shadowNormalBias=Q.normalBias,B.shadowRadius=Q.radius,B.shadowMapSize=Q.mapSize,i.spotShadow[g]=B,i.spotShadowMap[g]=L,x++}g++}else if(C.isRectAreaLight){const F=e.get(C);F.color.copy(I).multiplyScalar(U),F.halfWidth.set(C.width*.5,0,0),F.halfHeight.set(0,C.height*.5,0),i.rectArea[_]=F,_++}else if(C.isPointLight){const F=e.get(C);if(F.color.copy(C.color).multiplyScalar(C.intensity),F.distance=C.distance,F.decay=C.decay,C.castShadow){const Q=C.shadow,B=t.get(C);B.shadowIntensity=Q.intensity,B.shadowBias=Q.bias,B.shadowNormalBias=Q.normalBias,B.shadowRadius=Q.radius,B.shadowMapSize=Q.mapSize,B.shadowCameraNear=Q.camera.near,B.shadowCameraFar=Q.camera.far,i.pointShadow[m]=B,i.pointShadowMap[m]=L,i.pointShadowMatrix[m]=C.shadow.matrix,y++}i.point[m]=F,m++}else if(C.isHemisphereLight){const F=e.get(C);F.skyColor.copy(C.color).multiplyScalar(U),F.groundColor.copy(C.groundColor).multiplyScalar(U),i.hemi[p]=F,p++}}_>0&&(n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=xe.LTC_FLOAT_1,i.rectAreaLTC2=xe.LTC_FLOAT_2):(i.rectAreaLTC1=xe.LTC_HALF_1,i.rectAreaLTC2=xe.LTC_HALF_2)),i.ambient[0]=c,i.ambient[1]=h,i.ambient[2]=d;const E=i.hash;(E.directionalLength!==f||E.pointLength!==m||E.spotLength!==g||E.rectAreaLength!==_||E.hemiLength!==p||E.numDirectionalShadows!==v||E.numPointShadows!==y||E.numSpotShadows!==x||E.numSpotMaps!==S||E.numLightProbes!==w)&&(i.directional.length=f,i.spot.length=g,i.rectArea.length=_,i.point.length=m,i.hemi.length=p,i.directionalShadow.length=v,i.directionalShadowMap.length=v,i.pointShadow.length=y,i.pointShadowMap.length=y,i.spotShadow.length=x,i.spotShadowMap.length=x,i.directionalShadowMatrix.length=v,i.pointShadowMatrix.length=y,i.spotLightMatrix.length=x+S-T,i.spotLightMap.length=S,i.numSpotLightShadowsWithMaps=T,i.numLightProbes=w,E.directionalLength=f,E.pointLength=m,E.spotLength=g,E.rectAreaLength=_,E.hemiLength=p,E.numDirectionalShadows=v,E.numPointShadows=y,E.numSpotShadows=x,E.numSpotMaps=S,E.numLightProbes=w,i.version=M4++)}function l(u,c){let h=0,d=0,f=0,m=0,g=0;const _=c.matrixWorldInverse;for(let p=0,v=u.length;p<v;p++){const y=u[p];if(y.isDirectionalLight){const x=i.directional[h];x.direction.setFromMatrixPosition(y.matrixWorld),r.setFromMatrixPosition(y.target.matrixWorld),x.direction.sub(r),x.direction.transformDirection(_),h++}else if(y.isSpotLight){const x=i.spot[f];x.position.setFromMatrixPosition(y.matrixWorld),x.position.applyMatrix4(_),x.direction.setFromMatrixPosition(y.matrixWorld),r.setFromMatrixPosition(y.target.matrixWorld),x.direction.sub(r),x.direction.transformDirection(_),f++}else if(y.isRectAreaLight){const x=i.rectArea[m];x.position.setFromMatrixPosition(y.matrixWorld),x.position.applyMatrix4(_),o.identity(),s.copy(y.matrixWorld),s.premultiply(_),o.extractRotation(s),x.halfWidth.set(y.width*.5,0,0),x.halfHeight.set(0,y.height*.5,0),x.halfWidth.applyMatrix4(o),x.halfHeight.applyMatrix4(o),m++}else if(y.isPointLight){const x=i.point[d];x.position.setFromMatrixPosition(y.matrixWorld),x.position.applyMatrix4(_),d++}else if(y.isHemisphereLight){const x=i.hemi[g];x.direction.setFromMatrixPosition(y.matrixWorld),x.direction.transformDirection(_),g++}}}return{setup:a,setupView:l,state:i}}function qC(n){const e=new A4(n),t=[],i=[];function r(c){u.camera=c,t.length=0,i.length=0}function s(c){t.push(c)}function o(c){i.push(c)}function a(){e.setup(t)}function l(c){e.setupView(t,c)}const u={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:u,setupLights:a,setupLightsView:l,pushLight:s,pushShadow:o}}function C4(n){let e=new WeakMap;function t(r,s=0){const o=e.get(r);let a;return o===void 0?(a=new qC(n),e.set(r,[a])):s>=o.length?(a=new qC(n),o.push(a)):a=o[s],a}function i(){e=new WeakMap}return{get:t,dispose:i}}const R4=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,N4=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function P4(n,e,t){let i=new hg;const r=new he,s=new he,o=new et,a=new wB({depthPacking:KO}),l=new MB,u={},c=t.maxTextureSize,h={[is]:Xt,[Xt]:is,[Ti]:Ti},d=new Ps({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new he},radius:{value:4}},vertexShader:R4,fragmentShader:N4}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const m=new ci;m.setAttribute("position",new Qn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new $n(m,d),_=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Uy;let p=this.type;this.render=function(T,w,E){if(_.enabled===!1||_.autoUpdate===!1&&_.needsUpdate===!1||T.length===0)return;const M=n.getRenderTarget(),b=n.getActiveCubeFace(),C=n.getActiveMipmapLevel(),I=n.state;I.setBlending(zi),I.buffers.color.setClear(1,1,1,1),I.buffers.depth.setTest(!0),I.setScissorTest(!1);const U=p!==dr&&this.type===dr,D=p===dr&&this.type!==dr;for(let L=0,F=T.length;L<F;L++){const Q=T[L],B=Q.shadow;if(B===void 0){console.warn("THREE.WebGLShadowMap:",Q,"has no shadow.");continue}if(B.autoUpdate===!1&&B.needsUpdate===!1)continue;r.copy(B.mapSize);const J=B.getFrameExtents();if(r.multiply(J),s.copy(B.mapSize),(r.x>c||r.y>c)&&(r.x>c&&(s.x=Math.floor(c/J.x),r.x=s.x*J.x,B.mapSize.x=s.x),r.y>c&&(s.y=Math.floor(c/J.y),r.y=s.y*J.y,B.mapSize.y=s.y)),B.map===null||U===!0||D===!0){const K=this.type!==dr?{minFilter:Vt,magFilter:Vt}:{};B.map!==null&&B.map.dispose(),B.map=new xa(r.x,r.y,K),B.map.texture.name=Q.name+".shadowMap",B.camera.updateProjectionMatrix()}n.setRenderTarget(B.map),n.clear();const H=B.getViewportCount();for(let K=0;K<H;K++){const le=B.getViewport(K);o.set(s.x*le.x,s.y*le.y,s.x*le.z,s.y*le.w),I.viewport(o),B.updateMatrices(Q,K),i=B.getFrustum(),x(w,E,B.camera,Q,this.type)}B.isPointLightShadow!==!0&&this.type===dr&&v(B,E),B.needsUpdate=!1}p=this.type,_.needsUpdate=!1,n.setRenderTarget(M,b,C)};function v(T,w){const E=e.update(g);d.defines.VSM_SAMPLES!==T.blurSamples&&(d.defines.VSM_SAMPLES=T.blurSamples,f.defines.VSM_SAMPLES=T.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),T.mapPass===null&&(T.mapPass=new xa(r.x,r.y)),d.uniforms.shadow_pass.value=T.map.texture,d.uniforms.resolution.value=T.mapSize,d.uniforms.radius.value=T.radius,n.setRenderTarget(T.mapPass),n.clear(),n.renderBufferDirect(w,null,E,d,g,null),f.uniforms.shadow_pass.value=T.mapPass.texture,f.uniforms.resolution.value=T.mapSize,f.uniforms.radius.value=T.radius,n.setRenderTarget(T.map),n.clear(),n.renderBufferDirect(w,null,E,f,g,null)}function y(T,w,E,M){let b=null;const C=E.isPointLight===!0?T.customDistanceMaterial:T.customDepthMaterial;if(C!==void 0)b=C;else if(b=E.isPointLight===!0?l:a,n.localClippingEnabled&&w.clipShadows===!0&&Array.isArray(w.clippingPlanes)&&w.clippingPlanes.length!==0||w.displacementMap&&w.displacementScale!==0||w.alphaMap&&w.alphaTest>0||w.map&&w.alphaTest>0){const I=b.uuid,U=w.uuid;let D=u[I];D===void 0&&(D={},u[I]=D);let L=D[U];L===void 0&&(L=b.clone(),D[U]=L,w.addEventListener("dispose",S)),b=L}if(b.visible=w.visible,b.wireframe=w.wireframe,M===dr?b.side=w.shadowSide!==null?w.shadowSide:w.side:b.side=w.shadowSide!==null?w.shadowSide:h[w.side],b.alphaMap=w.alphaMap,b.alphaTest=w.alphaTest,b.map=w.map,b.clipShadows=w.clipShadows,b.clippingPlanes=w.clippingPlanes,b.clipIntersection=w.clipIntersection,b.displacementMap=w.displacementMap,b.displacementScale=w.displacementScale,b.displacementBias=w.displacementBias,b.wireframeLinewidth=w.wireframeLinewidth,b.linewidth=w.linewidth,E.isPointLight===!0&&b.isMeshDistanceMaterial===!0){const I=n.properties.get(b);I.light=E}return b}function x(T,w,E,M,b){if(T.visible===!1)return;if(T.layers.test(w.layers)&&(T.isMesh||T.isLine||T.isPoints)&&(T.castShadow||T.receiveShadow&&b===dr)&&(!T.frustumCulled||i.intersectsObject(T))){T.modelViewMatrix.multiplyMatrices(E.matrixWorldInverse,T.matrixWorld);const U=e.update(T),D=T.material;if(Array.isArray(D)){const L=U.groups;for(let F=0,Q=L.length;F<Q;F++){const B=L[F],J=D[B.materialIndex];if(J&&J.visible){const H=y(T,J,M,b);T.onBeforeShadow(n,T,w,E,U,H,B),n.renderBufferDirect(E,null,U,H,T,B),T.onAfterShadow(n,T,w,E,U,H,B)}}}else if(D.visible){const L=y(T,D,M,b);T.onBeforeShadow(n,T,w,E,U,L,null),n.renderBufferDirect(E,null,U,L,T,null),T.onAfterShadow(n,T,w,E,U,L,null)}}const I=T.children;for(let U=0,D=I.length;U<D;U++)x(I[U],w,E,M,b)}function S(T){T.target.removeEventListener("dispose",S);for(const E in u){const M=u[E],b=T.target.uuid;b in M&&(M[b].dispose(),delete M[b])}}}const D4={[vd]:yd,[xd]:bd,[Sd]:wd,[fa]:Td,[yd]:vd,[bd]:xd,[wd]:Sd,[Td]:fa};function L4(n,e){function t(){let G=!1;const Se=new et;let te=null;const ce=new et(0,0,0,0);return{setMask:function(Me){te!==Me&&!G&&(n.colorMask(Me,Me,Me,Me),te=Me)},setLocked:function(Me){G=Me},setClear:function(Me,we,rt,dn,_i){_i===!0&&(Me*=dn,we*=dn,rt*=dn),Se.set(Me,we,rt,dn),ce.equals(Se)===!1&&(n.clearColor(Me,we,rt,dn),ce.copy(Se))},reset:function(){G=!1,te=null,ce.set(-1,0,0,0)}}}function i(){let G=!1,Se=!1,te=null,ce=null,Me=null;return{setReversed:function(we){if(Se!==we){const rt=e.get("EXT_clip_control");Se?rt.clipControlEXT(rt.LOWER_LEFT_EXT,rt.ZERO_TO_ONE_EXT):rt.clipControlEXT(rt.LOWER_LEFT_EXT,rt.NEGATIVE_ONE_TO_ONE_EXT);const dn=Me;Me=null,this.setClear(dn)}Se=we},getReversed:function(){return Se},setTest:function(we){we?re(n.DEPTH_TEST):Ee(n.DEPTH_TEST)},setMask:function(we){te!==we&&!G&&(n.depthMask(we),te=we)},setFunc:function(we){if(Se&&(we=D4[we]),ce!==we){switch(we){case vd:n.depthFunc(n.NEVER);break;case yd:n.depthFunc(n.ALWAYS);break;case xd:n.depthFunc(n.LESS);break;case fa:n.depthFunc(n.LEQUAL);break;case Sd:n.depthFunc(n.EQUAL);break;case Td:n.depthFunc(n.GEQUAL);break;case bd:n.depthFunc(n.GREATER);break;case wd:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}ce=we}},setLocked:function(we){G=we},setClear:function(we){Me!==we&&(Se&&(we=1-we),n.clearDepth(we),Me=we)},reset:function(){G=!1,te=null,ce=null,Me=null,Se=!1}}}function r(){let G=!1,Se=null,te=null,ce=null,Me=null,we=null,rt=null,dn=null,_i=null;return{setTest:function(It){G||(It?re(n.STENCIL_TEST):Ee(n.STENCIL_TEST))},setMask:function(It){Se!==It&&!G&&(n.stencilMask(It),Se=It)},setFunc:function(It,ys,jo){(te!==It||ce!==ys||Me!==jo)&&(n.stencilFunc(It,ys,jo),te=It,ce=ys,Me=jo)},setOp:function(It,ys,jo){(we!==It||rt!==ys||dn!==jo)&&(n.stencilOp(It,ys,jo),we=It,rt=ys,dn=jo)},setLocked:function(It){G=It},setClear:function(It){_i!==It&&(n.clearStencil(It),_i=It)},reset:function(){G=!1,Se=null,te=null,ce=null,Me=null,we=null,rt=null,dn=null,_i=null}}}const s=new t,o=new i,a=new r,l=new WeakMap,u=new WeakMap;let c={},h={},d=new WeakMap,f=[],m=null,g=!1,_=null,p=null,v=null,y=null,x=null,S=null,T=null,w=new Ue(0,0,0),E=0,M=!1,b=null,C=null,I=null,U=null,D=null;const L=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let F=!1,Q=0;const B=n.getParameter(n.VERSION);B.indexOf("WebGL")!==-1?(Q=parseFloat(/^WebGL (\d)/.exec(B)[1]),F=Q>=1):B.indexOf("OpenGL ES")!==-1&&(Q=parseFloat(/^OpenGL ES (\d)/.exec(B)[1]),F=Q>=2);let J=null,H={};const K=n.getParameter(n.SCISSOR_BOX),le=n.getParameter(n.VIEWPORT),Pe=new et().fromArray(K),O=new et().fromArray(le);function j(G,Se,te,ce){const Me=new Uint8Array(4),we=n.createTexture();n.bindTexture(G,we),n.texParameteri(G,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(G,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let rt=0;rt<te;rt++)G===n.TEXTURE_3D||G===n.TEXTURE_2D_ARRAY?n.texImage3D(Se,0,n.RGBA,1,1,ce,0,n.RGBA,n.UNSIGNED_BYTE,Me):n.texImage2D(Se+rt,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,Me);return we}const ae={};ae[n.TEXTURE_2D]=j(n.TEXTURE_2D,n.TEXTURE_2D,1),ae[n.TEXTURE_CUBE_MAP]=j(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),ae[n.TEXTURE_2D_ARRAY]=j(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),ae[n.TEXTURE_3D]=j(n.TEXTURE_3D,n.TEXTURE_3D,1,1),s.setClear(0,0,0,1),o.setClear(1),a.setClear(0),re(n.DEPTH_TEST),o.setFunc(fa),ct(!1),dt(Iy),re(n.CULL_FACE),z(zi);function re(G){c[G]!==!0&&(n.enable(G),c[G]=!0)}function Ee(G){c[G]!==!1&&(n.disable(G),c[G]=!1)}function Re(G,Se){return h[G]!==Se?(n.bindFramebuffer(G,Se),h[G]=Se,G===n.DRAW_FRAMEBUFFER&&(h[n.FRAMEBUFFER]=Se),G===n.FRAMEBUFFER&&(h[n.DRAW_FRAMEBUFFER]=Se),!0):!1}function Fe(G,Se){let te=f,ce=!1;if(G){te=d.get(Se),te===void 0&&(te=[],d.set(Se,te));const Me=G.textures;if(te.length!==Me.length||te[0]!==n.COLOR_ATTACHMENT0){for(let we=0,rt=Me.length;we<rt;we++)te[we]=n.COLOR_ATTACHMENT0+we;te.length=Me.length,ce=!0}}else te[0]!==n.BACK&&(te[0]=n.BACK,ce=!0);ce&&n.drawBuffers(te)}function gt(G){return m!==G?(n.useProgram(G),m=G,!0):!1}const ut={[fr]:n.FUNC_ADD,[Oy]:n.FUNC_SUBTRACT,[By]:n.FUNC_REVERSE_SUBTRACT};ut[hA]=n.MIN,ut[dA]=n.MAX;const Rt={[ky]:n.ZERO,[zy]:n.ONE,[Gy]:n.SRC_COLOR,[gd]:n.SRC_ALPHA,[Xy]:n.SRC_ALPHA_SATURATE,[$y]:n.DST_COLOR,[Hy]:n.DST_ALPHA,[Vy]:n.ONE_MINUS_SRC_COLOR,[_d]:n.ONE_MINUS_SRC_ALPHA,[jy]:n.ONE_MINUS_DST_COLOR,[Wy]:n.ONE_MINUS_DST_ALPHA,[HO]:n.CONSTANT_COLOR,[WO]:n.ONE_MINUS_CONSTANT_COLOR,[$O]:n.CONSTANT_ALPHA,[jO]:n.ONE_MINUS_CONSTANT_ALPHA};function z(G,Se,te,ce,Me,we,rt,dn,_i,It){if(G===zi){g===!0&&(Ee(n.BLEND),g=!1);return}if(g===!1&&(re(n.BLEND),g=!0),G!==Fy){if(G!==_||It!==M){if((p!==fr||x!==fr)&&(n.blendEquation(n.FUNC_ADD),p=fr,x=fr),It)switch(G){case Or:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Vu:n.blendFunc(n.ONE,n.ONE);break;case Hu:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case Wu:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",G);break}else switch(G){case Or:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Vu:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case Hu:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case Wu:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",G);break}v=null,y=null,S=null,T=null,w.set(0,0,0),E=0,_=G,M=It}return}Me=Me||Se,we=we||te,rt=rt||ce,(Se!==p||Me!==x)&&(n.blendEquationSeparate(ut[Se],ut[Me]),p=Se,x=Me),(te!==v||ce!==y||we!==S||rt!==T)&&(n.blendFuncSeparate(Rt[te],Rt[ce],Rt[we],Rt[rt]),v=te,y=ce,S=we,T=rt),(dn.equals(w)===!1||_i!==E)&&(n.blendColor(dn.r,dn.g,dn.b,_i),w.copy(dn),E=_i),_=G,M=!1}function ln(G,Se){G.side===Ti?Ee(n.CULL_FACE):re(n.CULL_FACE);let te=G.side===Xt;Se&&(te=!te),ct(te),G.blending===Or&&G.transparent===!1?z(zi):z(G.blending,G.blendEquation,G.blendSrc,G.blendDst,G.blendEquationAlpha,G.blendSrcAlpha,G.blendDstAlpha,G.blendColor,G.blendAlpha,G.premultipliedAlpha),o.setFunc(G.depthFunc),o.setTest(G.depthTest),o.setMask(G.depthWrite),s.setMask(G.colorWrite);const ce=G.stencilWrite;a.setTest(ce),ce&&(a.setMask(G.stencilWriteMask),a.setFunc(G.stencilFunc,G.stencilRef,G.stencilFuncMask),a.setOp(G.stencilFail,G.stencilZFail,G.stencilZPass)),$t(G.polygonOffset,G.polygonOffsetFactor,G.polygonOffsetUnits),G.alphaToCoverage===!0?re(n.SAMPLE_ALPHA_TO_COVERAGE):Ee(n.SAMPLE_ALPHA_TO_COVERAGE)}function ct(G){b!==G&&(G?n.frontFace(n.CW):n.frontFace(n.CCW),b=G)}function dt(G){G!==uA?(re(n.CULL_FACE),G!==C&&(G===Iy?n.cullFace(n.BACK):G===cA?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):Ee(n.CULL_FACE),C=G}function Ge(G){G!==I&&(F&&n.lineWidth(G),I=G)}function $t(G,Se,te){G?(re(n.POLYGON_OFFSET_FILL),(U!==Se||D!==te)&&(n.polygonOffset(Se,te),U=Se,D=te)):Ee(n.POLYGON_OFFSET_FILL)}function ze(G){G?re(n.SCISSOR_TEST):Ee(n.SCISSOR_TEST)}function P(G){G===void 0&&(G=n.TEXTURE0+L-1),J!==G&&(n.activeTexture(G),J=G)}function A(G,Se,te){te===void 0&&(J===null?te=n.TEXTURE0+L-1:te=J);let ce=H[te];ce===void 0&&(ce={type:void 0,texture:void 0},H[te]=ce),(ce.type!==G||ce.texture!==Se)&&(J!==te&&(n.activeTexture(te),J=te),n.bindTexture(G,Se||ae[G]),ce.type=G,ce.texture=Se)}function X(){const G=H[J];G!==void 0&&G.type!==void 0&&(n.bindTexture(G.type,null),G.type=void 0,G.texture=void 0)}function ue(){try{n.compressedTexImage2D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function de(){try{n.compressedTexImage3D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function se(){try{n.texSubImage2D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function ke(){try{n.texSubImage3D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function be(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function Ne(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function St(){try{n.texStorage2D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function _e(){try{n.texStorage3D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function De(){try{n.texImage2D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function $e(){try{n.texImage3D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function Ye(G){Pe.equals(G)===!1&&(n.scissor(G.x,G.y,G.z,G.w),Pe.copy(G))}function Le(G){O.equals(G)===!1&&(n.viewport(G.x,G.y,G.z,G.w),O.copy(G))}function _t(G,Se){let te=u.get(Se);te===void 0&&(te=new WeakMap,u.set(Se,te));let ce=te.get(G);ce===void 0&&(ce=n.getUniformBlockIndex(Se,G.name),te.set(G,ce))}function lt(G,Se){const ce=u.get(Se).get(G);l.get(Se)!==ce&&(n.uniformBlockBinding(Se,ce,G.__bindingPointIndex),l.set(Se,ce))}function kt(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),o.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),c={},J=null,H={},h={},d=new WeakMap,f=[],m=null,g=!1,_=null,p=null,v=null,y=null,x=null,S=null,T=null,w=new Ue(0,0,0),E=0,M=!1,b=null,C=null,I=null,U=null,D=null,Pe.set(0,0,n.canvas.width,n.canvas.height),O.set(0,0,n.canvas.width,n.canvas.height),s.reset(),o.reset(),a.reset()}return{buffers:{color:s,depth:o,stencil:a},enable:re,disable:Ee,bindFramebuffer:Re,drawBuffers:Fe,useProgram:gt,setBlending:z,setMaterial:ln,setFlipSided:ct,setCullFace:dt,setLineWidth:Ge,setPolygonOffset:$t,setScissorTest:ze,activeTexture:P,bindTexture:A,unbindTexture:X,compressedTexImage2D:ue,compressedTexImage3D:de,texImage2D:De,texImage3D:$e,updateUBOMapping:_t,uniformBlockBinding:lt,texStorage2D:St,texStorage3D:_e,texSubImage2D:se,texSubImage3D:ke,compressedTexSubImage2D:be,compressedTexSubImage3D:Ne,scissor:Ye,viewport:Le,reset:kt}}function I4(n,e,t,i,r,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new he,c=new WeakMap;let h;const d=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function m(P,A){return f?new OffscreenCanvas(P,A):Bd("canvas")}function g(P,A,X){let ue=1;const de=ze(P);if((de.width>X||de.height>X)&&(ue=X/Math.max(de.width,de.height)),ue<1)if(typeof HTMLImageElement<"u"&&P instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&P instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&P instanceof ImageBitmap||typeof VideoFrame<"u"&&P instanceof VideoFrame){const se=Math.floor(ue*de.width),ke=Math.floor(ue*de.height);h===void 0&&(h=m(se,ke));const be=A?m(se,ke):h;return be.width=se,be.height=ke,be.getContext("2d").drawImage(P,0,0,se,ke),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+de.width+"x"+de.height+") to ("+se+"x"+ke+")."),be}else return"data"in P&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+de.width+"x"+de.height+")."),P;return P}function _(P){return P.generateMipmaps}function p(P){n.generateMipmap(P)}function v(P){return P.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:P.isWebGL3DRenderTarget?n.TEXTURE_3D:P.isWebGLArrayRenderTarget||P.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function y(P,A,X,ue,de=!1){if(P!==null){if(n[P]!==void 0)return n[P];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+P+"'")}let se=A;if(A===n.RED&&(X===n.FLOAT&&(se=n.R32F),X===n.HALF_FLOAT&&(se=n.R16F),X===n.UNSIGNED_BYTE&&(se=n.R8)),A===n.RED_INTEGER&&(X===n.UNSIGNED_BYTE&&(se=n.R8UI),X===n.UNSIGNED_SHORT&&(se=n.R16UI),X===n.UNSIGNED_INT&&(se=n.R32UI),X===n.BYTE&&(se=n.R8I),X===n.SHORT&&(se=n.R16I),X===n.INT&&(se=n.R32I)),A===n.RG&&(X===n.FLOAT&&(se=n.RG32F),X===n.HALF_FLOAT&&(se=n.RG16F),X===n.UNSIGNED_BYTE&&(se=n.RG8)),A===n.RG_INTEGER&&(X===n.UNSIGNED_BYTE&&(se=n.RG8UI),X===n.UNSIGNED_SHORT&&(se=n.RG16UI),X===n.UNSIGNED_INT&&(se=n.RG32UI),X===n.BYTE&&(se=n.RG8I),X===n.SHORT&&(se=n.RG16I),X===n.INT&&(se=n.RG32I)),A===n.RGB_INTEGER&&(X===n.UNSIGNED_BYTE&&(se=n.RGB8UI),X===n.UNSIGNED_SHORT&&(se=n.RGB16UI),X===n.UNSIGNED_INT&&(se=n.RGB32UI),X===n.BYTE&&(se=n.RGB8I),X===n.SHORT&&(se=n.RGB16I),X===n.INT&&(se=n.RGB32I)),A===n.RGBA_INTEGER&&(X===n.UNSIGNED_BYTE&&(se=n.RGBA8UI),X===n.UNSIGNED_SHORT&&(se=n.RGBA16UI),X===n.UNSIGNED_INT&&(se=n.RGBA32UI),X===n.BYTE&&(se=n.RGBA8I),X===n.SHORT&&(se=n.RGBA16I),X===n.INT&&(se=n.RGBA32I)),A===n.RGB&&X===n.UNSIGNED_INT_5_9_9_9_REV&&(se=n.RGB9_E5),A===n.RGBA){const ke=de?Fm:st.getTransfer(ue);X===n.FLOAT&&(se=n.RGBA32F),X===n.HALF_FLOAT&&(se=n.RGBA16F),X===n.UNSIGNED_BYTE&&(se=ke===At?n.SRGB8_ALPHA8:n.RGBA8),X===n.UNSIGNED_SHORT_4_4_4_4&&(se=n.RGBA4),X===n.UNSIGNED_SHORT_5_5_5_1&&(se=n.RGB5_A1)}return(se===n.R16F||se===n.R32F||se===n.RG16F||se===n.RG32F||se===n.RGBA16F||se===n.RGBA32F)&&e.get("EXT_color_buffer_float"),se}function x(P,A){let X;return P?A===null||A===rn||A===Cs?X=n.DEPTH24_STENCIL8:A===mn?X=n.DEPTH32F_STENCIL8:A===rs&&(X=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):A===null||A===rn||A===Cs?X=n.DEPTH_COMPONENT24:A===mn?X=n.DEPTH_COMPONENT32F:A===rs&&(X=n.DEPTH_COMPONENT16),X}function S(P,A){return _(P)===!0||P.isFramebufferTexture&&P.minFilter!==Vt&&P.minFilter!==Sn?Math.log2(Math.max(A.width,A.height))+1:P.mipmaps!==void 0&&P.mipmaps.length>0?P.mipmaps.length:P.isCompressedTexture&&Array.isArray(P.image)?A.mipmaps.length:1}function T(P){const A=P.target;A.removeEventListener("dispose",T),E(A),A.isVideoTexture&&c.delete(A)}function w(P){const A=P.target;A.removeEventListener("dispose",w),b(A)}function E(P){const A=i.get(P);if(A.__webglInit===void 0)return;const X=P.source,ue=d.get(X);if(ue){const de=ue[A.__cacheKey];de.usedTimes--,de.usedTimes===0&&M(P),Object.keys(ue).length===0&&d.delete(X)}i.remove(P)}function M(P){const A=i.get(P);n.deleteTexture(A.__webglTexture);const X=P.source,ue=d.get(X);delete ue[A.__cacheKey],o.memory.textures--}function b(P){const A=i.get(P);if(P.depthTexture&&(P.depthTexture.dispose(),i.remove(P.depthTexture)),P.isWebGLCubeRenderTarget)for(let ue=0;ue<6;ue++){if(Array.isArray(A.__webglFramebuffer[ue]))for(let de=0;de<A.__webglFramebuffer[ue].length;de++)n.deleteFramebuffer(A.__webglFramebuffer[ue][de]);else n.deleteFramebuffer(A.__webglFramebuffer[ue]);A.__webglDepthbuffer&&n.deleteRenderbuffer(A.__webglDepthbuffer[ue])}else{if(Array.isArray(A.__webglFramebuffer))for(let ue=0;ue<A.__webglFramebuffer.length;ue++)n.deleteFramebuffer(A.__webglFramebuffer[ue]);else n.deleteFramebuffer(A.__webglFramebuffer);if(A.__webglDepthbuffer&&n.deleteRenderbuffer(A.__webglDepthbuffer),A.__webglMultisampledFramebuffer&&n.deleteFramebuffer(A.__webglMultisampledFramebuffer),A.__webglColorRenderbuffer)for(let ue=0;ue<A.__webglColorRenderbuffer.length;ue++)A.__webglColorRenderbuffer[ue]&&n.deleteRenderbuffer(A.__webglColorRenderbuffer[ue]);A.__webglDepthRenderbuffer&&n.deleteRenderbuffer(A.__webglDepthRenderbuffer)}const X=P.textures;for(let ue=0,de=X.length;ue<de;ue++){const se=i.get(X[ue]);se.__webglTexture&&(n.deleteTexture(se.__webglTexture),o.memory.textures--),i.remove(X[ue])}i.remove(P)}let C=0;function I(){C=0}function U(){const P=C;return P>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+P+" texture units while this GPU supports only "+r.maxTextures),C+=1,P}function D(P){const A=[];return A.push(P.wrapS),A.push(P.wrapT),A.push(P.wrapR||0),A.push(P.magFilter),A.push(P.minFilter),A.push(P.anisotropy),A.push(P.internalFormat),A.push(P.format),A.push(P.type),A.push(P.generateMipmaps),A.push(P.premultiplyAlpha),A.push(P.flipY),A.push(P.unpackAlignment),A.push(P.colorSpace),A.join()}function L(P,A){const X=i.get(P);if(P.isVideoTexture&&Ge(P),P.isRenderTargetTexture===!1&&P.version>0&&X.__version!==P.version){const ue=P.image;if(ue===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ue.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{O(X,P,A);return}}t.bindTexture(n.TEXTURE_2D,X.__webglTexture,n.TEXTURE0+A)}function F(P,A){const X=i.get(P);if(P.version>0&&X.__version!==P.version){O(X,P,A);return}t.bindTexture(n.TEXTURE_2D_ARRAY,X.__webglTexture,n.TEXTURE0+A)}function Q(P,A){const X=i.get(P);if(P.version>0&&X.__version!==P.version){O(X,P,A);return}t.bindTexture(n.TEXTURE_3D,X.__webglTexture,n.TEXTURE0+A)}function B(P,A){const X=i.get(P);if(P.version>0&&X.__version!==P.version){j(X,P,A);return}t.bindTexture(n.TEXTURE_CUBE_MAP,X.__webglTexture,n.TEXTURE0+A)}const J={[ml]:n.REPEAT,[Es]:n.CLAMP_TO_EDGE,[gl]:n.MIRRORED_REPEAT},H={[Vt]:n.NEAREST,[Dm]:n.NEAREST_MIPMAP_NEAREST,[As]:n.NEAREST_MIPMAP_LINEAR,[Sn]:n.LINEAR,[$u]:n.LINEAR_MIPMAP_NEAREST,[bi]:n.LINEAR_MIPMAP_LINEAR},K={[nx]:n.NEVER,[ax]:n.ALWAYS,[Om]:n.LESS,[Bm]:n.LEQUAL,[ix]:n.EQUAL,[ox]:n.GEQUAL,[rx]:n.GREATER,[sx]:n.NOTEQUAL};function le(P,A){if(A.type===mn&&e.has("OES_texture_float_linear")===!1&&(A.magFilter===Sn||A.magFilter===$u||A.magFilter===As||A.magFilter===bi||A.minFilter===Sn||A.minFilter===$u||A.minFilter===As||A.minFilter===bi)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(P,n.TEXTURE_WRAP_S,J[A.wrapS]),n.texParameteri(P,n.TEXTURE_WRAP_T,J[A.wrapT]),(P===n.TEXTURE_3D||P===n.TEXTURE_2D_ARRAY)&&n.texParameteri(P,n.TEXTURE_WRAP_R,J[A.wrapR]),n.texParameteri(P,n.TEXTURE_MAG_FILTER,H[A.magFilter]),n.texParameteri(P,n.TEXTURE_MIN_FILTER,H[A.minFilter]),A.compareFunction&&(n.texParameteri(P,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(P,n.TEXTURE_COMPARE_FUNC,K[A.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(A.magFilter===Vt||A.minFilter!==As&&A.minFilter!==bi||A.type===mn&&e.has("OES_texture_float_linear")===!1)return;if(A.anisotropy>1||i.get(A).__currentAnisotropy){const X=e.get("EXT_texture_filter_anisotropic");n.texParameterf(P,X.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(A.anisotropy,r.getMaxAnisotropy())),i.get(A).__currentAnisotropy=A.anisotropy}}}function Pe(P,A){let X=!1;P.__webglInit===void 0&&(P.__webglInit=!0,A.addEventListener("dispose",T));const ue=A.source;let de=d.get(ue);de===void 0&&(de={},d.set(ue,de));const se=D(A);if(se!==P.__cacheKey){de[se]===void 0&&(de[se]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,X=!0),de[se].usedTimes++;const ke=de[P.__cacheKey];ke!==void 0&&(de[P.__cacheKey].usedTimes--,ke.usedTimes===0&&M(A)),P.__cacheKey=se,P.__webglTexture=de[se].texture}return X}function O(P,A,X){let ue=n.TEXTURE_2D;(A.isDataArrayTexture||A.isCompressedArrayTexture)&&(ue=n.TEXTURE_2D_ARRAY),A.isData3DTexture&&(ue=n.TEXTURE_3D);const de=Pe(P,A),se=A.source;t.bindTexture(ue,P.__webglTexture,n.TEXTURE0+X);const ke=i.get(se);if(se.version!==ke.__version||de===!0){t.activeTexture(n.TEXTURE0+X);const be=st.getPrimaries(st.workingColorSpace),Ne=A.colorSpace===pr?null:st.getPrimaries(A.colorSpace),St=A.colorSpace===pr||be===Ne?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,A.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,A.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,A.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,St);let _e=g(A.image,!1,r.maxTextureSize);_e=$t(A,_e);const De=s.convert(A.format,A.colorSpace),$e=s.convert(A.type);let Ye=y(A.internalFormat,De,$e,A.colorSpace,A.isVideoTexture);le(ue,A);let Le;const _t=A.mipmaps,lt=A.isVideoTexture!==!0,kt=ke.__version===void 0||de===!0,G=se.dataReady,Se=S(A,_e);if(A.isDepthTexture)Ye=x(A.format===Ns,A.type),kt&&(lt?t.texStorage2D(n.TEXTURE_2D,1,Ye,_e.width,_e.height):t.texImage2D(n.TEXTURE_2D,0,Ye,_e.width,_e.height,0,De,$e,null));else if(A.isDataTexture)if(_t.length>0){lt&&kt&&t.texStorage2D(n.TEXTURE_2D,Se,Ye,_t[0].width,_t[0].height);for(let te=0,ce=_t.length;te<ce;te++)Le=_t[te],lt?G&&t.texSubImage2D(n.TEXTURE_2D,te,0,0,Le.width,Le.height,De,$e,Le.data):t.texImage2D(n.TEXTURE_2D,te,Ye,Le.width,Le.height,0,De,$e,Le.data);A.generateMipmaps=!1}else lt?(kt&&t.texStorage2D(n.TEXTURE_2D,Se,Ye,_e.width,_e.height),G&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,_e.width,_e.height,De,$e,_e.data)):t.texImage2D(n.TEXTURE_2D,0,Ye,_e.width,_e.height,0,De,$e,_e.data);else if(A.isCompressedTexture)if(A.isCompressedArrayTexture){lt&&kt&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Se,Ye,_t[0].width,_t[0].height,_e.depth);for(let te=0,ce=_t.length;te<ce;te++)if(Le=_t[te],A.format!==Kn)if(De!==null)if(lt){if(G)if(A.layerUpdates.size>0){const Me=yC(Le.width,Le.height,A.format,A.type);for(const we of A.layerUpdates){const rt=Le.data.subarray(we*Me/Le.data.BYTES_PER_ELEMENT,(we+1)*Me/Le.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,te,0,0,we,Le.width,Le.height,1,De,rt)}A.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,te,0,0,0,Le.width,Le.height,_e.depth,De,Le.data)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,te,Ye,Le.width,Le.height,_e.depth,0,Le.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else lt?G&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,te,0,0,0,Le.width,Le.height,_e.depth,De,$e,Le.data):t.texImage3D(n.TEXTURE_2D_ARRAY,te,Ye,Le.width,Le.height,_e.depth,0,De,$e,Le.data)}else{lt&&kt&&t.texStorage2D(n.TEXTURE_2D,Se,Ye,_t[0].width,_t[0].height);for(let te=0,ce=_t.length;te<ce;te++)Le=_t[te],A.format!==Kn?De!==null?lt?G&&t.compressedTexSubImage2D(n.TEXTURE_2D,te,0,0,Le.width,Le.height,De,Le.data):t.compressedTexImage2D(n.TEXTURE_2D,te,Ye,Le.width,Le.height,0,Le.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):lt?G&&t.texSubImage2D(n.TEXTURE_2D,te,0,0,Le.width,Le.height,De,$e,Le.data):t.texImage2D(n.TEXTURE_2D,te,Ye,Le.width,Le.height,0,De,$e,Le.data)}else if(A.isDataArrayTexture)if(lt){if(kt&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Se,Ye,_e.width,_e.height,_e.depth),G)if(A.layerUpdates.size>0){const te=yC(_e.width,_e.height,A.format,A.type);for(const ce of A.layerUpdates){const Me=_e.data.subarray(ce*te/_e.data.BYTES_PER_ELEMENT,(ce+1)*te/_e.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,ce,_e.width,_e.height,1,De,$e,Me)}A.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,_e.width,_e.height,_e.depth,De,$e,_e.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,Ye,_e.width,_e.height,_e.depth,0,De,$e,_e.data);else if(A.isData3DTexture)lt?(kt&&t.texStorage3D(n.TEXTURE_3D,Se,Ye,_e.width,_e.height,_e.depth),G&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,_e.width,_e.height,_e.depth,De,$e,_e.data)):t.texImage3D(n.TEXTURE_3D,0,Ye,_e.width,_e.height,_e.depth,0,De,$e,_e.data);else if(A.isFramebufferTexture){if(kt)if(lt)t.texStorage2D(n.TEXTURE_2D,Se,Ye,_e.width,_e.height);else{let te=_e.width,ce=_e.height;for(let Me=0;Me<Se;Me++)t.texImage2D(n.TEXTURE_2D,Me,Ye,te,ce,0,De,$e,null),te>>=1,ce>>=1}}else if(_t.length>0){if(lt&&kt){const te=ze(_t[0]);t.texStorage2D(n.TEXTURE_2D,Se,Ye,te.width,te.height)}for(let te=0,ce=_t.length;te<ce;te++)Le=_t[te],lt?G&&t.texSubImage2D(n.TEXTURE_2D,te,0,0,De,$e,Le):t.texImage2D(n.TEXTURE_2D,te,Ye,De,$e,Le);A.generateMipmaps=!1}else if(lt){if(kt){const te=ze(_e);t.texStorage2D(n.TEXTURE_2D,Se,Ye,te.width,te.height)}G&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,De,$e,_e)}else t.texImage2D(n.TEXTURE_2D,0,Ye,De,$e,_e);_(A)&&p(ue),ke.__version=se.version,A.onUpdate&&A.onUpdate(A)}P.__version=A.version}function j(P,A,X){if(A.image.length!==6)return;const ue=Pe(P,A),de=A.source;t.bindTexture(n.TEXTURE_CUBE_MAP,P.__webglTexture,n.TEXTURE0+X);const se=i.get(de);if(de.version!==se.__version||ue===!0){t.activeTexture(n.TEXTURE0+X);const ke=st.getPrimaries(st.workingColorSpace),be=A.colorSpace===pr?null:st.getPrimaries(A.colorSpace),Ne=A.colorSpace===pr||ke===be?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,A.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,A.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,A.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ne);const St=A.isCompressedTexture||A.image[0].isCompressedTexture,_e=A.image[0]&&A.image[0].isDataTexture,De=[];for(let ce=0;ce<6;ce++)!St&&!_e?De[ce]=g(A.image[ce],!0,r.maxCubemapSize):De[ce]=_e?A.image[ce].image:A.image[ce],De[ce]=$t(A,De[ce]);const $e=De[0],Ye=s.convert(A.format,A.colorSpace),Le=s.convert(A.type),_t=y(A.internalFormat,Ye,Le,A.colorSpace),lt=A.isVideoTexture!==!0,kt=se.__version===void 0||ue===!0,G=de.dataReady;let Se=S(A,$e);le(n.TEXTURE_CUBE_MAP,A);let te;if(St){lt&&kt&&t.texStorage2D(n.TEXTURE_CUBE_MAP,Se,_t,$e.width,$e.height);for(let ce=0;ce<6;ce++){te=De[ce].mipmaps;for(let Me=0;Me<te.length;Me++){const we=te[Me];A.format!==Kn?Ye!==null?lt?G&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,Me,0,0,we.width,we.height,Ye,we.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,Me,_t,we.width,we.height,0,we.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):lt?G&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,Me,0,0,we.width,we.height,Ye,Le,we.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,Me,_t,we.width,we.height,0,Ye,Le,we.data)}}}else{if(te=A.mipmaps,lt&&kt){te.length>0&&Se++;const ce=ze(De[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,Se,_t,ce.width,ce.height)}for(let ce=0;ce<6;ce++)if(_e){lt?G&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,0,0,De[ce].width,De[ce].height,Ye,Le,De[ce].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,_t,De[ce].width,De[ce].height,0,Ye,Le,De[ce].data);for(let Me=0;Me<te.length;Me++){const rt=te[Me].image[ce].image;lt?G&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,Me+1,0,0,rt.width,rt.height,Ye,Le,rt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,Me+1,_t,rt.width,rt.height,0,Ye,Le,rt.data)}}else{lt?G&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,0,0,Ye,Le,De[ce]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,_t,Ye,Le,De[ce]);for(let Me=0;Me<te.length;Me++){const we=te[Me];lt?G&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,Me+1,0,0,Ye,Le,we.image[ce]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,Me+1,_t,Ye,Le,we.image[ce])}}}_(A)&&p(n.TEXTURE_CUBE_MAP),se.__version=de.version,A.onUpdate&&A.onUpdate(A)}P.__version=A.version}function ae(P,A,X,ue,de,se){const ke=s.convert(X.format,X.colorSpace),be=s.convert(X.type),Ne=y(X.internalFormat,ke,be,X.colorSpace),St=i.get(A),_e=i.get(X);if(_e.__renderTarget=A,!St.__hasExternalTextures){const De=Math.max(1,A.width>>se),$e=Math.max(1,A.height>>se);de===n.TEXTURE_3D||de===n.TEXTURE_2D_ARRAY?t.texImage3D(de,se,Ne,De,$e,A.depth,0,ke,be,null):t.texImage2D(de,se,Ne,De,$e,0,ke,be,null)}t.bindFramebuffer(n.FRAMEBUFFER,P),dt(A)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,ue,de,_e.__webglTexture,0,ct(A)):(de===n.TEXTURE_2D||de>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&de<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,ue,de,_e.__webglTexture,se),t.bindFramebuffer(n.FRAMEBUFFER,null)}function re(P,A,X){if(n.bindRenderbuffer(n.RENDERBUFFER,P),A.depthBuffer){const ue=A.depthTexture,de=ue&&ue.isDepthTexture?ue.type:null,se=x(A.stencilBuffer,de),ke=A.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,be=ct(A);dt(A)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,be,se,A.width,A.height):X?n.renderbufferStorageMultisample(n.RENDERBUFFER,be,se,A.width,A.height):n.renderbufferStorage(n.RENDERBUFFER,se,A.width,A.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,ke,n.RENDERBUFFER,P)}else{const ue=A.textures;for(let de=0;de<ue.length;de++){const se=ue[de],ke=s.convert(se.format,se.colorSpace),be=s.convert(se.type),Ne=y(se.internalFormat,ke,be,se.colorSpace),St=ct(A);X&&dt(A)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,St,Ne,A.width,A.height):dt(A)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,St,Ne,A.width,A.height):n.renderbufferStorage(n.RENDERBUFFER,Ne,A.width,A.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function Ee(P,A){if(A&&A.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,P),!(A.depthTexture&&A.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const ue=i.get(A.depthTexture);ue.__renderTarget=A,(!ue.__webglTexture||A.depthTexture.image.width!==A.width||A.depthTexture.image.height!==A.height)&&(A.depthTexture.image.width=A.width,A.depthTexture.image.height=A.height,A.depthTexture.needsUpdate=!0),L(A.depthTexture,0);const de=ue.__webglTexture,se=ct(A);if(A.depthTexture.format===Rs)dt(A)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,de,0,se):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,de,0);else if(A.depthTexture.format===Ns)dt(A)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,de,0,se):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,de,0);else throw new Error("Unknown depthTexture format")}function Re(P){const A=i.get(P),X=P.isWebGLCubeRenderTarget===!0;if(A.__boundDepthTexture!==P.depthTexture){const ue=P.depthTexture;if(A.__depthDisposeCallback&&A.__depthDisposeCallback(),ue){const de=()=>{delete A.__boundDepthTexture,delete A.__depthDisposeCallback,ue.removeEventListener("dispose",de)};ue.addEventListener("dispose",de),A.__depthDisposeCallback=de}A.__boundDepthTexture=ue}if(P.depthTexture&&!A.__autoAllocateDepthBuffer){if(X)throw new Error("target.depthTexture not supported in Cube render targets");Ee(A.__webglFramebuffer,P)}else if(X){A.__webglDepthbuffer=[];for(let ue=0;ue<6;ue++)if(t.bindFramebuffer(n.FRAMEBUFFER,A.__webglFramebuffer[ue]),A.__webglDepthbuffer[ue]===void 0)A.__webglDepthbuffer[ue]=n.createRenderbuffer(),re(A.__webglDepthbuffer[ue],P,!1);else{const de=P.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,se=A.__webglDepthbuffer[ue];n.bindRenderbuffer(n.RENDERBUFFER,se),n.framebufferRenderbuffer(n.FRAMEBUFFER,de,n.RENDERBUFFER,se)}}else if(t.bindFramebuffer(n.FRAMEBUFFER,A.__webglFramebuffer),A.__webglDepthbuffer===void 0)A.__webglDepthbuffer=n.createRenderbuffer(),re(A.__webglDepthbuffer,P,!1);else{const ue=P.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,de=A.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,de),n.framebufferRenderbuffer(n.FRAMEBUFFER,ue,n.RENDERBUFFER,de)}t.bindFramebuffer(n.FRAMEBUFFER,null)}function Fe(P,A,X){const ue=i.get(P);A!==void 0&&ae(ue.__webglFramebuffer,P,P.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),X!==void 0&&Re(P)}function gt(P){const A=P.texture,X=i.get(P),ue=i.get(A);P.addEventListener("dispose",w);const de=P.textures,se=P.isWebGLCubeRenderTarget===!0,ke=de.length>1;if(ke||(ue.__webglTexture===void 0&&(ue.__webglTexture=n.createTexture()),ue.__version=A.version,o.memory.textures++),se){X.__webglFramebuffer=[];for(let be=0;be<6;be++)if(A.mipmaps&&A.mipmaps.length>0){X.__webglFramebuffer[be]=[];for(let Ne=0;Ne<A.mipmaps.length;Ne++)X.__webglFramebuffer[be][Ne]=n.createFramebuffer()}else X.__webglFramebuffer[be]=n.createFramebuffer()}else{if(A.mipmaps&&A.mipmaps.length>0){X.__webglFramebuffer=[];for(let be=0;be<A.mipmaps.length;be++)X.__webglFramebuffer[be]=n.createFramebuffer()}else X.__webglFramebuffer=n.createFramebuffer();if(ke)for(let be=0,Ne=de.length;be<Ne;be++){const St=i.get(de[be]);St.__webglTexture===void 0&&(St.__webglTexture=n.createTexture(),o.memory.textures++)}if(P.samples>0&&dt(P)===!1){X.__webglMultisampledFramebuffer=n.createFramebuffer(),X.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,X.__webglMultisampledFramebuffer);for(let be=0;be<de.length;be++){const Ne=de[be];X.__webglColorRenderbuffer[be]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,X.__webglColorRenderbuffer[be]);const St=s.convert(Ne.format,Ne.colorSpace),_e=s.convert(Ne.type),De=y(Ne.internalFormat,St,_e,Ne.colorSpace,P.isXRRenderTarget===!0),$e=ct(P);n.renderbufferStorageMultisample(n.RENDERBUFFER,$e,De,P.width,P.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+be,n.RENDERBUFFER,X.__webglColorRenderbuffer[be])}n.bindRenderbuffer(n.RENDERBUFFER,null),P.depthBuffer&&(X.__webglDepthRenderbuffer=n.createRenderbuffer(),re(X.__webglDepthRenderbuffer,P,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(se){t.bindTexture(n.TEXTURE_CUBE_MAP,ue.__webglTexture),le(n.TEXTURE_CUBE_MAP,A);for(let be=0;be<6;be++)if(A.mipmaps&&A.mipmaps.length>0)for(let Ne=0;Ne<A.mipmaps.length;Ne++)ae(X.__webglFramebuffer[be][Ne],P,A,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+be,Ne);else ae(X.__webglFramebuffer[be],P,A,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+be,0);_(A)&&p(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(ke){for(let be=0,Ne=de.length;be<Ne;be++){const St=de[be],_e=i.get(St);t.bindTexture(n.TEXTURE_2D,_e.__webglTexture),le(n.TEXTURE_2D,St),ae(X.__webglFramebuffer,P,St,n.COLOR_ATTACHMENT0+be,n.TEXTURE_2D,0),_(St)&&p(n.TEXTURE_2D)}t.unbindTexture()}else{let be=n.TEXTURE_2D;if((P.isWebGL3DRenderTarget||P.isWebGLArrayRenderTarget)&&(be=P.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(be,ue.__webglTexture),le(be,A),A.mipmaps&&A.mipmaps.length>0)for(let Ne=0;Ne<A.mipmaps.length;Ne++)ae(X.__webglFramebuffer[Ne],P,A,n.COLOR_ATTACHMENT0,be,Ne);else ae(X.__webglFramebuffer,P,A,n.COLOR_ATTACHMENT0,be,0);_(A)&&p(be),t.unbindTexture()}P.depthBuffer&&Re(P)}function ut(P){const A=P.textures;for(let X=0,ue=A.length;X<ue;X++){const de=A[X];if(_(de)){const se=v(P),ke=i.get(de).__webglTexture;t.bindTexture(se,ke),p(se),t.unbindTexture()}}}const Rt=[],z=[];function ln(P){if(P.samples>0){if(dt(P)===!1){const A=P.textures,X=P.width,ue=P.height;let de=n.COLOR_BUFFER_BIT;const se=P.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ke=i.get(P),be=A.length>1;if(be)for(let Ne=0;Ne<A.length;Ne++)t.bindFramebuffer(n.FRAMEBUFFER,ke.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ne,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,ke.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ne,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,ke.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,ke.__webglFramebuffer);for(let Ne=0;Ne<A.length;Ne++){if(P.resolveDepthBuffer&&(P.depthBuffer&&(de|=n.DEPTH_BUFFER_BIT),P.stencilBuffer&&P.resolveStencilBuffer&&(de|=n.STENCIL_BUFFER_BIT)),be){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,ke.__webglColorRenderbuffer[Ne]);const St=i.get(A[Ne]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,St,0)}n.blitFramebuffer(0,0,X,ue,0,0,X,ue,de,n.NEAREST),l===!0&&(Rt.length=0,z.length=0,Rt.push(n.COLOR_ATTACHMENT0+Ne),P.depthBuffer&&P.resolveDepthBuffer===!1&&(Rt.push(se),z.push(se),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,z)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,Rt))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),be)for(let Ne=0;Ne<A.length;Ne++){t.bindFramebuffer(n.FRAMEBUFFER,ke.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ne,n.RENDERBUFFER,ke.__webglColorRenderbuffer[Ne]);const St=i.get(A[Ne]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,ke.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ne,n.TEXTURE_2D,St,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,ke.__webglMultisampledFramebuffer)}else if(P.depthBuffer&&P.resolveDepthBuffer===!1&&l){const A=P.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[A])}}}function ct(P){return Math.min(r.maxSamples,P.samples)}function dt(P){const A=i.get(P);return P.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&A.__useRenderToTexture!==!1}function Ge(P){const A=o.render.frame;c.get(P)!==A&&(c.set(P,A),P.update())}function $t(P,A){const X=P.colorSpace,ue=P.format,de=P.type;return P.isCompressedTexture===!0||P.isVideoTexture===!0||X!==zr&&X!==pr&&(st.getTransfer(X)===At?(ue!==Kn||de!==oi)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",X)),A}function ze(P){return typeof HTMLImageElement<"u"&&P instanceof HTMLImageElement?(u.width=P.naturalWidth||P.width,u.height=P.naturalHeight||P.height):typeof VideoFrame<"u"&&P instanceof VideoFrame?(u.width=P.displayWidth,u.height=P.displayHeight):(u.width=P.width,u.height=P.height),u}this.allocateTextureUnit=U,this.resetTextureUnits=I,this.setTexture2D=L,this.setTexture2DArray=F,this.setTexture3D=Q,this.setTextureCube=B,this.rebindTextures=Fe,this.setupRenderTarget=gt,this.updateRenderTargetMipmap=ut,this.updateMultisampleRenderTarget=ln,this.setupDepthRenderbuffer=Re,this.setupFrameBufferTexture=ae,this.useMultisampledRTT=dt}function U4(n,e){function t(i,r=pr){let s;const o=st.getTransfer(r);if(i===oi)return n.UNSIGNED_BYTE;if(i===Lm)return n.UNSIGNED_SHORT_4_4_4_4;if(i===Im)return n.UNSIGNED_SHORT_5_5_5_1;if(i===Um)return n.UNSIGNED_INT_5_9_9_9_REV;if(i===_l)return n.BYTE;if(i===vl)return n.SHORT;if(i===rs)return n.UNSIGNED_SHORT;if(i===Hn)return n.INT;if(i===rn)return n.UNSIGNED_INT;if(i===mn)return n.FLOAT;if(i===wi)return n.HALF_FLOAT;if(i===Yy)return n.ALPHA;if(i===Ed)return n.RGB;if(i===Kn)return n.RGBA;if(i===Ky)return n.LUMINANCE;if(i===Qy)return n.LUMINANCE_ALPHA;if(i===Rs)return n.DEPTH_COMPONENT;if(i===Ns)return n.DEPTH_STENCIL;if(i===Ad)return n.RED;if(i===ju)return n.RED_INTEGER;if(i===yl)return n.RG;if(i===Xu)return n.RG_INTEGER;if(i===qu)return n.RGBA_INTEGER;if(i===xl||i===ga||i===_a||i===va)if(o===At)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(i===xl)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===ga)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===_a)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===va)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(i===xl)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===ga)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===_a)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===va)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===Cd||i===Rd||i===Nd||i===Pd)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(i===Cd)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===Rd)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===Nd)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===Pd)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===Dd||i===Yu||i===Ku)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(i===Dd||i===Yu)return o===At?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(i===Ku)return o===At?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===Qu||i===Zu||i===Ju||i===ec||i===tc||i===nc||i===ic||i===rc||i===sc||i===oc||i===ac||i===lc||i===uc||i===cc)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(i===Qu)return o===At?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===Zu)return o===At?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===Ju)return o===At?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===ec)return o===At?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===tc)return o===At?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===nc)return o===At?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===ic)return o===At?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===rc)return o===At?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===sc)return o===At?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===oc)return o===At?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===ac)return o===At?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===lc)return o===At?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===uc)return o===At?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===cc)return o===At?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===Sl||i===Zy||i===Jy)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(i===Sl)return o===At?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===Zy)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===Jy)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===ex||i===Ld||i===Id||i===Ud)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(i===Sl)return s.COMPRESSED_RED_RGTC1_EXT;if(i===Ld)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===Id)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===Ud)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===Cs?n.UNSIGNED_INT_24_8:n[i]!==void 0?n[i]:null}return{convert:t}}const F4={type:"move"};class sS{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Dc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Dc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new N,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new N),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Dc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new N,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new N),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,u=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(u&&e.hand){o=!0;for(const g of e.hand.values()){const _=t.getJointPose(g,i),p=this._getHandJoint(u,g);_!==null&&(p.matrix.fromArray(_.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.matrixWorldNeedsUpdate=!0,p.jointRadius=_.radius),p.visible=_!==null}const c=u.joints["index-finger-tip"],h=u.joints["thumb-tip"],d=c.position.distanceTo(h.position),f=.02,m=.005;u.inputState.pinching&&d>f+m?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&d<=f-m&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&s!==null&&(r=s),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(F4)))}return a!==null&&(a.visible=r!==null),l!==null&&(l.visible=s!==null),u!==null&&(u.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new Dc;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}const O4=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,B4=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class k4{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(this.texture===null){const r=new Tn,s=e.properties.get(r);s.__webglTexture=t.texture,(t.depthNear!==i.depthNear||t.depthFar!==i.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=r}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,i=new Ps({vertexShader:O4,fragmentShader:B4,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new $n(new yg(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class z4 extends co{constructor(e,t){super();const i=this;let r=null,s=1,o=null,a="local-floor",l=1,u=null,c=null,h=null,d=null,f=null,m=null;const g=new k4,_=t.getContextAttributes();let p=null,v=null;const y=[],x=[],S=new he;let T=null;const w=new Ai;w.viewport=new et;const E=new Ai;E.viewport=new et;const M=[w,E],b=new zB;let C=null,I=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(O){let j=y[O];return j===void 0&&(j=new sS,y[O]=j),j.getTargetRaySpace()},this.getControllerGrip=function(O){let j=y[O];return j===void 0&&(j=new sS,y[O]=j),j.getGripSpace()},this.getHand=function(O){let j=y[O];return j===void 0&&(j=new sS,y[O]=j),j.getHandSpace()};function U(O){const j=x.indexOf(O.inputSource);if(j===-1)return;const ae=y[j];ae!==void 0&&(ae.update(O.inputSource,O.frame,u||o),ae.dispatchEvent({type:O.type,data:O.inputSource}))}function D(){r.removeEventListener("select",U),r.removeEventListener("selectstart",U),r.removeEventListener("selectend",U),r.removeEventListener("squeeze",U),r.removeEventListener("squeezestart",U),r.removeEventListener("squeezeend",U),r.removeEventListener("end",D),r.removeEventListener("inputsourceschange",L);for(let O=0;O<y.length;O++){const j=x[O];j!==null&&(x[O]=null,y[O].disconnect(j))}C=null,I=null,g.reset(),e.setRenderTarget(p),f=null,d=null,h=null,r=null,v=null,Pe.stop(),i.isPresenting=!1,e.setPixelRatio(T),e.setSize(S.width,S.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(O){s=O,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(O){a=O,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||o},this.setReferenceSpace=function(O){u=O},this.getBaseLayer=function(){return d!==null?d:f},this.getBinding=function(){return h},this.getFrame=function(){return m},this.getSession=function(){return r},this.setSession=async function(O){if(r=O,r!==null){if(p=e.getRenderTarget(),r.addEventListener("select",U),r.addEventListener("selectstart",U),r.addEventListener("selectend",U),r.addEventListener("squeeze",U),r.addEventListener("squeezestart",U),r.addEventListener("squeezeend",U),r.addEventListener("end",D),r.addEventListener("inputsourceschange",L),_.xrCompatible!==!0&&await t.makeXRCompatible(),T=e.getPixelRatio(),e.getSize(S),r.enabledFeatures!==void 0&&r.enabledFeatures.includes("layers")){let ae=null,re=null,Ee=null;_.depth&&(Ee=_.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ae=_.stencil?Ns:Rs,re=_.stencil?Cs:rn);const Re={colorFormat:t.RGBA8,depthFormat:Ee,scaleFactor:s};h=new XRWebGLBinding(r,t),d=h.createProjectionLayer(Re),r.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),v=new xa(d.textureWidth,d.textureHeight,{format:Kn,type:oi,depthTexture:new Aa(d.textureWidth,d.textureHeight,re,void 0,void 0,void 0,void 0,void 0,void 0,ae),stencilBuffer:_.stencil,colorSpace:e.outputColorSpace,samples:_.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1})}else{const ae={antialias:_.antialias,alpha:!0,depth:_.depth,stencil:_.stencil,framebufferScaleFactor:s};f=new XRWebGLLayer(r,t,ae),r.updateRenderState({baseLayer:f}),e.setPixelRatio(1),e.setSize(f.framebufferWidth,f.framebufferHeight,!1),v=new xa(f.framebufferWidth,f.framebufferHeight,{format:Kn,type:oi,colorSpace:e.outputColorSpace,stencilBuffer:_.stencil})}v.isXRRenderTarget=!0,this.setFoveation(l),u=null,o=await r.requestReferenceSpace(a),Pe.setContext(r),Pe.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode},this.getDepthTexture=function(){return g.getDepthTexture()};function L(O){for(let j=0;j<O.removed.length;j++){const ae=O.removed[j],re=x.indexOf(ae);re>=0&&(x[re]=null,y[re].disconnect(ae))}for(let j=0;j<O.added.length;j++){const ae=O.added[j];let re=x.indexOf(ae);if(re===-1){for(let Re=0;Re<y.length;Re++)if(Re>=x.length){x.push(ae),re=Re;break}else if(x[Re]===null){x[Re]=ae,re=Re;break}if(re===-1)break}const Ee=y[re];Ee&&Ee.connect(ae)}}const F=new N,Q=new N;function B(O,j,ae){F.setFromMatrixPosition(j.matrixWorld),Q.setFromMatrixPosition(ae.matrixWorld);const re=F.distanceTo(Q),Ee=j.projectionMatrix.elements,Re=ae.projectionMatrix.elements,Fe=Ee[14]/(Ee[10]-1),gt=Ee[14]/(Ee[10]+1),ut=(Ee[9]+1)/Ee[5],Rt=(Ee[9]-1)/Ee[5],z=(Ee[8]-1)/Ee[0],ln=(Re[8]+1)/Re[0],ct=Fe*z,dt=Fe*ln,Ge=re/(-z+ln),$t=Ge*-z;if(j.matrixWorld.decompose(O.position,O.quaternion,O.scale),O.translateX($t),O.translateZ(Ge),O.matrixWorld.compose(O.position,O.quaternion,O.scale),O.matrixWorldInverse.copy(O.matrixWorld).invert(),Ee[10]===-1)O.projectionMatrix.copy(j.projectionMatrix),O.projectionMatrixInverse.copy(j.projectionMatrixInverse);else{const ze=Fe+Ge,P=gt+Ge,A=ct-$t,X=dt+(re-$t),ue=ut*gt/P*ze,de=Rt*gt/P*ze;O.projectionMatrix.makePerspective(A,X,ue,de,ze,P),O.projectionMatrixInverse.copy(O.projectionMatrix).invert()}}function J(O,j){j===null?O.matrixWorld.copy(O.matrix):O.matrixWorld.multiplyMatrices(j.matrixWorld,O.matrix),O.matrixWorldInverse.copy(O.matrixWorld).invert()}this.updateCamera=function(O){if(r===null)return;let j=O.near,ae=O.far;g.texture!==null&&(g.depthNear>0&&(j=g.depthNear),g.depthFar>0&&(ae=g.depthFar)),b.near=E.near=w.near=j,b.far=E.far=w.far=ae,(C!==b.near||I!==b.far)&&(r.updateRenderState({depthNear:b.near,depthFar:b.far}),C=b.near,I=b.far),w.layers.mask=O.layers.mask|2,E.layers.mask=O.layers.mask|4,b.layers.mask=w.layers.mask|E.layers.mask;const re=O.parent,Ee=b.cameras;J(b,re);for(let Re=0;Re<Ee.length;Re++)J(Ee[Re],re);Ee.length===2?B(b,w,E):b.projectionMatrix.copy(w.projectionMatrix),H(O,b,re)};function H(O,j,ae){ae===null?O.matrix.copy(j.matrixWorld):(O.matrix.copy(ae.matrixWorld),O.matrix.invert(),O.matrix.multiply(j.matrixWorld)),O.matrix.decompose(O.position,O.quaternion,O.scale),O.updateMatrixWorld(!0),O.projectionMatrix.copy(j.projectionMatrix),O.projectionMatrixInverse.copy(j.projectionMatrixInverse),O.isPerspectiveCamera&&(O.fov=dc*2*Math.atan(1/O.projectionMatrix.elements[5]),O.zoom=1)}this.getCamera=function(){return b},this.getFoveation=function(){if(!(d===null&&f===null))return l},this.setFoveation=function(O){l=O,d!==null&&(d.fixedFoveation=O),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=O)},this.hasDepthSensing=function(){return g.texture!==null},this.getDepthSensingMesh=function(){return g.getMesh(b)};let K=null;function le(O,j){if(c=j.getViewerPose(u||o),m=j,c!==null){const ae=c.views;f!==null&&(e.setRenderTargetFramebuffer(v,f.framebuffer),e.setRenderTarget(v));let re=!1;ae.length!==b.cameras.length&&(b.cameras.length=0,re=!0);for(let Re=0;Re<ae.length;Re++){const Fe=ae[Re];let gt=null;if(f!==null)gt=f.getViewport(Fe);else{const Rt=h.getViewSubImage(d,Fe);gt=Rt.viewport,Re===0&&(e.setRenderTargetTextures(v,Rt.colorTexture,d.ignoreDepthValues?void 0:Rt.depthStencilTexture),e.setRenderTarget(v))}let ut=M[Re];ut===void 0&&(ut=new Ai,ut.layers.enable(Re),ut.viewport=new et,M[Re]=ut),ut.matrix.fromArray(Fe.transform.matrix),ut.matrix.decompose(ut.position,ut.quaternion,ut.scale),ut.projectionMatrix.fromArray(Fe.projectionMatrix),ut.projectionMatrixInverse.copy(ut.projectionMatrix).invert(),ut.viewport.set(gt.x,gt.y,gt.width,gt.height),Re===0&&(b.matrix.copy(ut.matrix),b.matrix.decompose(b.position,b.quaternion,b.scale)),re===!0&&b.cameras.push(ut)}const Ee=r.enabledFeatures;if(Ee&&Ee.includes("depth-sensing")){const Re=h.getDepthInformation(ae[0]);Re&&Re.isValid&&Re.texture&&g.init(e,Re,r.renderState)}}for(let ae=0;ae<y.length;ae++){const re=x[ae],Ee=y[ae];re!==null&&Ee!==void 0&&Ee.update(re,j,u||o)}K&&K(O,j),j.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:j}),m=null}const Pe=new xC;Pe.setAnimationLoop(le),this.setAnimationLoop=function(O){K=O},this.dispose=function(){}}}const Il=new gr,G4=new pt;function V4(n,e){function t(_,p){_.matrixAutoUpdate===!0&&_.updateMatrix(),p.value.copy(_.matrix)}function i(_,p){p.color.getRGB(_.fogColor.value,WA(n)),p.isFog?(_.fogNear.value=p.near,_.fogFar.value=p.far):p.isFogExp2&&(_.fogDensity.value=p.density)}function r(_,p,v,y,x){p.isMeshBasicMaterial||p.isMeshLambertMaterial?s(_,p):p.isMeshToonMaterial?(s(_,p),h(_,p)):p.isMeshPhongMaterial?(s(_,p),c(_,p)):p.isMeshStandardMaterial?(s(_,p),d(_,p),p.isMeshPhysicalMaterial&&f(_,p,x)):p.isMeshMatcapMaterial?(s(_,p),m(_,p)):p.isMeshDepthMaterial?s(_,p):p.isMeshDistanceMaterial?(s(_,p),g(_,p)):p.isMeshNormalMaterial?s(_,p):p.isLineBasicMaterial?(o(_,p),p.isLineDashedMaterial&&a(_,p)):p.isPointsMaterial?l(_,p,v,y):p.isSpriteMaterial?u(_,p):p.isShadowMaterial?(_.color.value.copy(p.color),_.opacity.value=p.opacity):p.isShaderMaterial&&(p.uniformsNeedUpdate=!1)}function s(_,p){_.opacity.value=p.opacity,p.color&&_.diffuse.value.copy(p.color),p.emissive&&_.emissive.value.copy(p.emissive).multiplyScalar(p.emissiveIntensity),p.map&&(_.map.value=p.map,t(p.map,_.mapTransform)),p.alphaMap&&(_.alphaMap.value=p.alphaMap,t(p.alphaMap,_.alphaMapTransform)),p.bumpMap&&(_.bumpMap.value=p.bumpMap,t(p.bumpMap,_.bumpMapTransform),_.bumpScale.value=p.bumpScale,p.side===Xt&&(_.bumpScale.value*=-1)),p.normalMap&&(_.normalMap.value=p.normalMap,t(p.normalMap,_.normalMapTransform),_.normalScale.value.copy(p.normalScale),p.side===Xt&&_.normalScale.value.negate()),p.displacementMap&&(_.displacementMap.value=p.displacementMap,t(p.displacementMap,_.displacementMapTransform),_.displacementScale.value=p.displacementScale,_.displacementBias.value=p.displacementBias),p.emissiveMap&&(_.emissiveMap.value=p.emissiveMap,t(p.emissiveMap,_.emissiveMapTransform)),p.specularMap&&(_.specularMap.value=p.specularMap,t(p.specularMap,_.specularMapTransform)),p.alphaTest>0&&(_.alphaTest.value=p.alphaTest);const v=e.get(p),y=v.envMap,x=v.envMapRotation;y&&(_.envMap.value=y,Il.copy(x),Il.x*=-1,Il.y*=-1,Il.z*=-1,y.isCubeTexture&&y.isRenderTargetTexture===!1&&(Il.y*=-1,Il.z*=-1),_.envMapRotation.value.setFromMatrix4(G4.makeRotationFromEuler(Il)),_.flipEnvMap.value=y.isCubeTexture&&y.isRenderTargetTexture===!1?-1:1,_.reflectivity.value=p.reflectivity,_.ior.value=p.ior,_.refractionRatio.value=p.refractionRatio),p.lightMap&&(_.lightMap.value=p.lightMap,_.lightMapIntensity.value=p.lightMapIntensity,t(p.lightMap,_.lightMapTransform)),p.aoMap&&(_.aoMap.value=p.aoMap,_.aoMapIntensity.value=p.aoMapIntensity,t(p.aoMap,_.aoMapTransform))}function o(_,p){_.diffuse.value.copy(p.color),_.opacity.value=p.opacity,p.map&&(_.map.value=p.map,t(p.map,_.mapTransform))}function a(_,p){_.dashSize.value=p.dashSize,_.totalSize.value=p.dashSize+p.gapSize,_.scale.value=p.scale}function l(_,p,v,y){_.diffuse.value.copy(p.color),_.opacity.value=p.opacity,_.size.value=p.size*v,_.scale.value=y*.5,p.map&&(_.map.value=p.map,t(p.map,_.uvTransform)),p.alphaMap&&(_.alphaMap.value=p.alphaMap,t(p.alphaMap,_.alphaMapTransform)),p.alphaTest>0&&(_.alphaTest.value=p.alphaTest)}function u(_,p){_.diffuse.value.copy(p.color),_.opacity.value=p.opacity,_.rotation.value=p.rotation,p.map&&(_.map.value=p.map,t(p.map,_.mapTransform)),p.alphaMap&&(_.alphaMap.value=p.alphaMap,t(p.alphaMap,_.alphaMapTransform)),p.alphaTest>0&&(_.alphaTest.value=p.alphaTest)}function c(_,p){_.specular.value.copy(p.specular),_.shininess.value=Math.max(p.shininess,1e-4)}function h(_,p){p.gradientMap&&(_.gradientMap.value=p.gradientMap)}function d(_,p){_.metalness.value=p.metalness,p.metalnessMap&&(_.metalnessMap.value=p.metalnessMap,t(p.metalnessMap,_.metalnessMapTransform)),_.roughness.value=p.roughness,p.roughnessMap&&(_.roughnessMap.value=p.roughnessMap,t(p.roughnessMap,_.roughnessMapTransform)),p.envMap&&(_.envMapIntensity.value=p.envMapIntensity)}function f(_,p,v){_.ior.value=p.ior,p.sheen>0&&(_.sheenColor.value.copy(p.sheenColor).multiplyScalar(p.sheen),_.sheenRoughness.value=p.sheenRoughness,p.sheenColorMap&&(_.sheenColorMap.value=p.sheenColorMap,t(p.sheenColorMap,_.sheenColorMapTransform)),p.sheenRoughnessMap&&(_.sheenRoughnessMap.value=p.sheenRoughnessMap,t(p.sheenRoughnessMap,_.sheenRoughnessMapTransform))),p.clearcoat>0&&(_.clearcoat.value=p.clearcoat,_.clearcoatRoughness.value=p.clearcoatRoughness,p.clearcoatMap&&(_.clearcoatMap.value=p.clearcoatMap,t(p.clearcoatMap,_.clearcoatMapTransform)),p.clearcoatRoughnessMap&&(_.clearcoatRoughnessMap.value=p.clearcoatRoughnessMap,t(p.clearcoatRoughnessMap,_.clearcoatRoughnessMapTransform)),p.clearcoatNormalMap&&(_.clearcoatNormalMap.value=p.clearcoatNormalMap,t(p.clearcoatNormalMap,_.clearcoatNormalMapTransform),_.clearcoatNormalScale.value.copy(p.clearcoatNormalScale),p.side===Xt&&_.clearcoatNormalScale.value.negate())),p.dispersion>0&&(_.dispersion.value=p.dispersion),p.iridescence>0&&(_.iridescence.value=p.iridescence,_.iridescenceIOR.value=p.iridescenceIOR,_.iridescenceThicknessMinimum.value=p.iridescenceThicknessRange[0],_.iridescenceThicknessMaximum.value=p.iridescenceThicknessRange[1],p.iridescenceMap&&(_.iridescenceMap.value=p.iridescenceMap,t(p.iridescenceMap,_.iridescenceMapTransform)),p.iridescenceThicknessMap&&(_.iridescenceThicknessMap.value=p.iridescenceThicknessMap,t(p.iridescenceThicknessMap,_.iridescenceThicknessMapTransform))),p.transmission>0&&(_.transmission.value=p.transmission,_.transmissionSamplerMap.value=v.texture,_.transmissionSamplerSize.value.set(v.width,v.height),p.transmissionMap&&(_.transmissionMap.value=p.transmissionMap,t(p.transmissionMap,_.transmissionMapTransform)),_.thickness.value=p.thickness,p.thicknessMap&&(_.thicknessMap.value=p.thicknessMap,t(p.thicknessMap,_.thicknessMapTransform)),_.attenuationDistance.value=p.attenuationDistance,_.attenuationColor.value.copy(p.attenuationColor)),p.anisotropy>0&&(_.anisotropyVector.value.set(p.anisotropy*Math.cos(p.anisotropyRotation),p.anisotropy*Math.sin(p.anisotropyRotation)),p.anisotropyMap&&(_.anisotropyMap.value=p.anisotropyMap,t(p.anisotropyMap,_.anisotropyMapTransform))),_.specularIntensity.value=p.specularIntensity,_.specularColor.value.copy(p.specularColor),p.specularColorMap&&(_.specularColorMap.value=p.specularColorMap,t(p.specularColorMap,_.specularColorMapTransform)),p.specularIntensityMap&&(_.specularIntensityMap.value=p.specularIntensityMap,t(p.specularIntensityMap,_.specularIntensityMapTransform))}function m(_,p){p.matcap&&(_.matcap.value=p.matcap)}function g(_,p){const v=e.get(p).light;_.referencePosition.value.setFromMatrixPosition(v.matrixWorld),_.nearDistance.value=v.shadow.camera.near,_.farDistance.value=v.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function H4(n,e,t,i){let r={},s={},o=[];const a=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function l(v,y){const x=y.program;i.uniformBlockBinding(v,x)}function u(v,y){let x=r[v.id];x===void 0&&(m(v),x=c(v),r[v.id]=x,v.addEventListener("dispose",_));const S=y.program;i.updateUBOMapping(v,S);const T=e.render.frame;s[v.id]!==T&&(d(v),s[v.id]=T)}function c(v){const y=h();v.__bindingPointIndex=y;const x=n.createBuffer(),S=v.__size,T=v.usage;return n.bindBuffer(n.UNIFORM_BUFFER,x),n.bufferData(n.UNIFORM_BUFFER,S,T),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,y,x),x}function h(){for(let v=0;v<a;v++)if(o.indexOf(v)===-1)return o.push(v),v;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(v){const y=r[v.id],x=v.uniforms,S=v.__cache;n.bindBuffer(n.UNIFORM_BUFFER,y);for(let T=0,w=x.length;T<w;T++){const E=Array.isArray(x[T])?x[T]:[x[T]];for(let M=0,b=E.length;M<b;M++){const C=E[M];if(f(C,T,M,S)===!0){const I=C.__offset,U=Array.isArray(C.value)?C.value:[C.value];let D=0;for(let L=0;L<U.length;L++){const F=U[L],Q=g(F);typeof F=="number"||typeof F=="boolean"?(C.__data[0]=F,n.bufferSubData(n.UNIFORM_BUFFER,I+D,C.__data)):F.isMatrix3?(C.__data[0]=F.elements[0],C.__data[1]=F.elements[1],C.__data[2]=F.elements[2],C.__data[3]=0,C.__data[4]=F.elements[3],C.__data[5]=F.elements[4],C.__data[6]=F.elements[5],C.__data[7]=0,C.__data[8]=F.elements[6],C.__data[9]=F.elements[7],C.__data[10]=F.elements[8],C.__data[11]=0):(F.toArray(C.__data,D),D+=Q.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,I,C.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function f(v,y,x,S){const T=v.value,w=y+"_"+x;if(S[w]===void 0)return typeof T=="number"||typeof T=="boolean"?S[w]=T:S[w]=T.clone(),!0;{const E=S[w];if(typeof T=="number"||typeof T=="boolean"){if(E!==T)return S[w]=T,!0}else if(E.equals(T)===!1)return E.copy(T),!0}return!1}function m(v){const y=v.uniforms;let x=0;const S=16;for(let w=0,E=y.length;w<E;w++){const M=Array.isArray(y[w])?y[w]:[y[w]];for(let b=0,C=M.length;b<C;b++){const I=M[b],U=Array.isArray(I.value)?I.value:[I.value];for(let D=0,L=U.length;D<L;D++){const F=U[D],Q=g(F),B=x%S,J=B%Q.boundary,H=B+J;x+=J,H!==0&&S-H<Q.storage&&(x+=S-H),I.__data=new Float32Array(Q.storage/Float32Array.BYTES_PER_ELEMENT),I.__offset=x,x+=Q.storage}}}const T=x%S;return T>0&&(x+=S-T),v.__size=x,v.__cache={},this}function g(v){const y={boundary:0,storage:0};return typeof v=="number"||typeof v=="boolean"?(y.boundary=4,y.storage=4):v.isVector2?(y.boundary=8,y.storage=8):v.isVector3||v.isColor?(y.boundary=16,y.storage=12):v.isVector4?(y.boundary=16,y.storage=16):v.isMatrix3?(y.boundary=48,y.storage=48):v.isMatrix4?(y.boundary=64,y.storage=64):v.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",v),y}function _(v){const y=v.target;y.removeEventListener("dispose",_);const x=o.indexOf(y.__bindingPointIndex);o.splice(x,1),n.deleteBuffer(r[y.id]),delete r[y.id],delete s[y.id]}function p(){for(const v in r)n.deleteBuffer(r[v]);o=[],r={},s={}}return{bind:l,update:u,dispose:p}}class W4{constructor(e={}){const{canvas:t=MA(),context:i=null,depth:r=!0,stencil:s=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:u=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:h=!1,reverseDepthBuffer:d=!1}=e;this.isWebGLRenderer=!0;let f;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");f=i.getContextAttributes().alpha}else f=o;const m=new Uint32Array(4),g=new Int32Array(4);let _=null,p=null;const v=[],y=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Be,this.toneMapping=Gi,this.toneMappingExposure=1;const x=this;let S=!1,T=0,w=0,E=null,M=-1,b=null;const C=new et,I=new et;let U=null;const D=new Ue(0);let L=0,F=t.width,Q=t.height,B=1,J=null,H=null;const K=new et(0,0,F,Q),le=new et(0,0,F,Q);let Pe=!1;const O=new hg;let j=!1,ae=!1;this.transmissionResolutionScale=1;const re=new pt,Ee=new pt,Re=new N,Fe=new et,gt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let ut=!1;function Rt(){return E===null?B:1}let z=i;function ln(R,W){return t.getContext(R,W)}try{const R={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:u,powerPreference:c,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Gu}`),t.addEventListener("webglcontextlost",ce,!1),t.addEventListener("webglcontextrestored",Me,!1),t.addEventListener("webglcontextcreationerror",we,!1),z===null){const W="webgl2";if(z=ln(W,R),z===null)throw ln(W)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(R){throw console.error("THREE.WebGLRenderer: "+R.message),R}let ct,dt,Ge,$t,ze,P,A,X,ue,de,se,ke,be,Ne,St,_e,De,$e,Ye,Le,_t,lt,kt,G;function Se(){ct=new Jz(z),ct.init(),lt=new U4(z,ct),dt=new Xz(z,ct,e,lt),Ge=new L4(z,ct),dt.reverseDepthBuffer&&d&&Ge.buffers.depth.setReversed(!0),$t=new nG(z),ze=new x4,P=new I4(z,ct,Ge,ze,dt,lt,$t),A=new Yz(x),X=new Zz(x),ue=new HB(z),kt=new $z(z,ue),de=new eG(z,ue,$t,kt),se=new rG(z,de,ue,$t),Ye=new iG(z,dt,P),_e=new qz(ze),ke=new y4(x,A,X,ct,dt,kt,_e),be=new V4(x,ze),Ne=new T4,St=new C4(ct),$e=new Wz(x,A,X,Ge,se,f,l),De=new P4(x,se,dt),G=new H4(z,$t,dt,Ge),Le=new jz(z,ct,$t),_t=new tG(z,ct,$t),$t.programs=ke.programs,x.capabilities=dt,x.extensions=ct,x.properties=ze,x.renderLists=Ne,x.shadowMap=De,x.state=Ge,x.info=$t}Se();const te=new z4(x,z);this.xr=te,this.getContext=function(){return z},this.getContextAttributes=function(){return z.getContextAttributes()},this.forceContextLoss=function(){const R=ct.get("WEBGL_lose_context");R&&R.loseContext()},this.forceContextRestore=function(){const R=ct.get("WEBGL_lose_context");R&&R.restoreContext()},this.getPixelRatio=function(){return B},this.setPixelRatio=function(R){R!==void 0&&(B=R,this.setSize(F,Q,!1))},this.getSize=function(R){return R.set(F,Q)},this.setSize=function(R,W,q=!0){if(te.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}F=R,Q=W,t.width=Math.floor(R*B),t.height=Math.floor(W*B),q===!0&&(t.style.width=R+"px",t.style.height=W+"px"),this.setViewport(0,0,R,W)},this.getDrawingBufferSize=function(R){return R.set(F*B,Q*B).floor()},this.setDrawingBufferSize=function(R,W,q){F=R,Q=W,B=q,t.width=Math.floor(R*q),t.height=Math.floor(W*q),this.setViewport(0,0,R,W)},this.getCurrentViewport=function(R){return R.copy(C)},this.getViewport=function(R){return R.copy(K)},this.setViewport=function(R,W,q,Y){R.isVector4?K.set(R.x,R.y,R.z,R.w):K.set(R,W,q,Y),Ge.viewport(C.copy(K).multiplyScalar(B).round())},this.getScissor=function(R){return R.copy(le)},this.setScissor=function(R,W,q,Y){R.isVector4?le.set(R.x,R.y,R.z,R.w):le.set(R,W,q,Y),Ge.scissor(I.copy(le).multiplyScalar(B).round())},this.getScissorTest=function(){return Pe},this.setScissorTest=function(R){Ge.setScissorTest(Pe=R)},this.setOpaqueSort=function(R){J=R},this.setTransparentSort=function(R){H=R},this.getClearColor=function(R){return R.copy($e.getClearColor())},this.setClearColor=function(){$e.setClearColor.apply($e,arguments)},this.getClearAlpha=function(){return $e.getClearAlpha()},this.setClearAlpha=function(){$e.setClearAlpha.apply($e,arguments)},this.clear=function(R=!0,W=!0,q=!0){let Y=0;if(R){let $=!1;if(E!==null){const ge=E.texture.format;$=ge===qu||ge===Xu||ge===ju}if($){const ge=E.texture.type,Te=ge===oi||ge===rn||ge===rs||ge===Cs||ge===Lm||ge===Im,Ce=$e.getClearColor(),Ie=$e.getClearAlpha(),Ke=Ce.r,Je=Ce.g,Ve=Ce.b;Te?(m[0]=Ke,m[1]=Je,m[2]=Ve,m[3]=Ie,z.clearBufferuiv(z.COLOR,0,m)):(g[0]=Ke,g[1]=Je,g[2]=Ve,g[3]=Ie,z.clearBufferiv(z.COLOR,0,g))}else Y|=z.COLOR_BUFFER_BIT}W&&(Y|=z.DEPTH_BUFFER_BIT),q&&(Y|=z.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),z.clear(Y)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ce,!1),t.removeEventListener("webglcontextrestored",Me,!1),t.removeEventListener("webglcontextcreationerror",we,!1),$e.dispose(),Ne.dispose(),St.dispose(),ze.dispose(),A.dispose(),X.dispose(),se.dispose(),kt.dispose(),G.dispose(),ke.dispose(),te.dispose(),te.removeEventListener("sessionstart",lU),te.removeEventListener("sessionend",uU),cu.stop()};function ce(R){R.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),S=!0}function Me(){console.log("THREE.WebGLRenderer: Context Restored."),S=!1;const R=$t.autoReset,W=De.enabled,q=De.autoUpdate,Y=De.needsUpdate,$=De.type;Se(),$t.autoReset=R,De.enabled=W,De.autoUpdate=q,De.needsUpdate=Y,De.type=$}function we(R){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",R.statusMessage)}function rt(R){const W=R.target;W.removeEventListener("dispose",rt),dn(W)}function dn(R){_i(R),ze.remove(R)}function _i(R){const W=ze.get(R).programs;W!==void 0&&(W.forEach(function(q){ke.releaseProgram(q)}),R.isShaderMaterial&&ke.releaseShaderCache(R))}this.renderBufferDirect=function(R,W,q,Y,$,ge){W===null&&(W=gt);const Te=$.isMesh&&$.matrixWorld.determinant()<0,Ce=wne(R,W,q,Y,$);Ge.setMaterial(Y,Te);let Ie=q.index,Ke=1;if(Y.wireframe===!0){if(Ie=de.getWireframeAttribute(q),Ie===void 0)return;Ke=2}const Je=q.drawRange,Ve=q.attributes.position;let Tt=Je.start*Ke,Nt=(Je.start+Je.count)*Ke;ge!==null&&(Tt=Math.max(Tt,ge.start*Ke),Nt=Math.min(Nt,(ge.start+ge.count)*Ke)),Ie!==null?(Tt=Math.max(Tt,0),Nt=Math.min(Nt,Ie.count)):Ve!=null&&(Tt=Math.max(Tt,0),Nt=Math.min(Nt,Ve.count));const Dn=Nt-Tt;if(Dn<0||Dn===1/0)return;kt.setup($,Y,Ce,q,Ie);let fn,wt=Le;if(Ie!==null&&(fn=ue.get(Ie),wt=_t,wt.setIndex(fn)),$.isMesh)Y.wireframe===!0?(Ge.setLineWidth(Y.wireframeLinewidth*Rt()),wt.setMode(z.LINES)):wt.setMode(z.TRIANGLES);else if($.isLine){let He=Y.linewidth;He===void 0&&(He=1),Ge.setLineWidth(He*Rt()),$.isLineSegments?wt.setMode(z.LINES):$.isLineLoop?wt.setMode(z.LINE_LOOP):wt.setMode(z.LINE_STRIP)}else $.isPoints?wt.setMode(z.POINTS):$.isSprite&&wt.setMode(z.TRIANGLES);if($.isBatchedMesh)if($._multiDrawInstances!==null)wt.renderMultiDrawInstances($._multiDrawStarts,$._multiDrawCounts,$._multiDrawCount,$._multiDrawInstances);else if(ct.get("WEBGL_multi_draw"))wt.renderMultiDraw($._multiDrawStarts,$._multiDrawCounts,$._multiDrawCount);else{const He=$._multiDrawStarts,ti=$._multiDrawCounts,Pt=$._multiDrawCount,xs=Ie?ue.get(Ie).bytesPerElement:1,Eh=ze.get(Y).currentProgram.getUniforms();for(let Nr=0;Nr<Pt;Nr++)Eh.setValue(z,"_gl_DrawID",Nr),wt.render(He[Nr]/xs,ti[Nr])}else if($.isInstancedMesh)wt.renderInstances(Tt,Dn,$.count);else if(q.isInstancedBufferGeometry){const He=q._maxInstanceCount!==void 0?q._maxInstanceCount:1/0,ti=Math.min(q.instanceCount,He);wt.renderInstances(Tt,Dn,ti)}else wt.render(Tt,Dn)};function It(R,W,q){R.transparent===!0&&R.side===Ti&&R.forceSinglePass===!1?(R.side=Xt,R.needsUpdate=!0,x0(R,W,q),R.side=is,R.needsUpdate=!0,x0(R,W,q),R.side=Ti):x0(R,W,q)}this.compile=function(R,W,q=null){q===null&&(q=R),p=St.get(q),p.init(W),y.push(p),q.traverseVisible(function($){$.isLight&&$.layers.test(W.layers)&&(p.pushLight($),$.castShadow&&p.pushShadow($))}),R!==q&&R.traverseVisible(function($){$.isLight&&$.layers.test(W.layers)&&(p.pushLight($),$.castShadow&&p.pushShadow($))}),p.setupLights();const Y=new Set;return R.traverse(function($){if(!($.isMesh||$.isPoints||$.isLine||$.isSprite))return;const ge=$.material;if(ge)if(Array.isArray(ge))for(let Te=0;Te<ge.length;Te++){const Ce=ge[Te];It(Ce,q,$),Y.add(Ce)}else It(ge,q,$),Y.add(ge)}),y.pop(),p=null,Y},this.compileAsync=function(R,W,q=null){const Y=this.compile(R,W,q);return new Promise($=>{function ge(){if(Y.forEach(function(Te){ze.get(Te).currentProgram.isReady()&&Y.delete(Te)}),Y.size===0){$(R);return}setTimeout(ge,10)}ct.get("KHR_parallel_shader_compile")!==null?ge():setTimeout(ge,10)})};let ys=null;function jo(R){ys&&ys(R)}function lU(){cu.stop()}function uU(){cu.start()}const cu=new xC;cu.setAnimationLoop(jo),typeof self<"u"&&cu.setContext(self),this.setAnimationLoop=function(R){ys=R,te.setAnimationLoop(R),R===null?cu.stop():cu.start()},te.addEventListener("sessionstart",lU),te.addEventListener("sessionend",uU),this.render=function(R,W){if(W!==void 0&&W.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(S===!0)return;if(R.matrixWorldAutoUpdate===!0&&R.updateMatrixWorld(),W.parent===null&&W.matrixWorldAutoUpdate===!0&&W.updateMatrixWorld(),te.enabled===!0&&te.isPresenting===!0&&(te.cameraAutoUpdate===!0&&te.updateCamera(W),W=te.getCamera()),R.isScene===!0&&R.onBeforeRender(x,R,W,E),p=St.get(R,y.length),p.init(W),y.push(p),Ee.multiplyMatrices(W.projectionMatrix,W.matrixWorldInverse),O.setFromProjectionMatrix(Ee),ae=this.localClippingEnabled,j=_e.init(this.clippingPlanes,ae),_=Ne.get(R,v.length),_.init(),v.push(_),te.enabled===!0&&te.isPresenting===!0){const ge=x.xr.getDepthSensingMesh();ge!==null&&kw(ge,W,-1/0,x.sortObjects)}kw(R,W,0,x.sortObjects),_.finish(),x.sortObjects===!0&&_.sort(J,H),ut=te.enabled===!1||te.isPresenting===!1||te.hasDepthSensing()===!1,ut&&$e.addToRenderList(_,R),this.info.render.frame++,j===!0&&_e.beginShadows();const q=p.state.shadowsArray;De.render(q,R,W),j===!0&&_e.endShadows(),this.info.autoReset===!0&&this.info.reset();const Y=_.opaque,$=_.transmissive;if(p.setupLights(),W.isArrayCamera){const ge=W.cameras;if($.length>0)for(let Te=0,Ce=ge.length;Te<Ce;Te++){const Ie=ge[Te];hU(Y,$,R,Ie)}ut&&$e.render(R);for(let Te=0,Ce=ge.length;Te<Ce;Te++){const Ie=ge[Te];cU(_,R,Ie,Ie.viewport)}}else $.length>0&&hU(Y,$,R,W),ut&&$e.render(R),cU(_,R,W);E!==null&&w===0&&(P.updateMultisampleRenderTarget(E),P.updateRenderTargetMipmap(E)),R.isScene===!0&&R.onAfterRender(x,R,W),kt.resetDefaultState(),M=-1,b=null,y.pop(),y.length>0?(p=y[y.length-1],j===!0&&_e.setGlobalState(x.clippingPlanes,p.state.camera)):p=null,v.pop(),v.length>0?_=v[v.length-1]:_=null};function kw(R,W,q,Y){if(R.visible===!1)return;if(R.layers.test(W.layers)){if(R.isGroup)q=R.renderOrder;else if(R.isLOD)R.autoUpdate===!0&&R.update(W);else if(R.isLight)p.pushLight(R),R.castShadow&&p.pushShadow(R);else if(R.isSprite){if(!R.frustumCulled||O.intersectsSprite(R)){Y&&Fe.setFromMatrixPosition(R.matrixWorld).applyMatrix4(Ee);const Te=se.update(R),Ce=R.material;Ce.visible&&_.push(R,Te,Ce,q,Fe.z,null)}}else if((R.isMesh||R.isLine||R.isPoints)&&(!R.frustumCulled||O.intersectsObject(R))){const Te=se.update(R),Ce=R.material;if(Y&&(R.boundingSphere!==void 0?(R.boundingSphere===null&&R.computeBoundingSphere(),Fe.copy(R.boundingSphere.center)):(Te.boundingSphere===null&&Te.computeBoundingSphere(),Fe.copy(Te.boundingSphere.center)),Fe.applyMatrix4(R.matrixWorld).applyMatrix4(Ee)),Array.isArray(Ce)){const Ie=Te.groups;for(let Ke=0,Je=Ie.length;Ke<Je;Ke++){const Ve=Ie[Ke],Tt=Ce[Ve.materialIndex];Tt&&Tt.visible&&_.push(R,Te,Tt,q,Fe.z,Ve)}}else Ce.visible&&_.push(R,Te,Ce,q,Fe.z,null)}}const ge=R.children;for(let Te=0,Ce=ge.length;Te<Ce;Te++)kw(ge[Te],W,q,Y)}function cU(R,W,q,Y){const $=R.opaque,ge=R.transmissive,Te=R.transparent;p.setupLightsView(q),j===!0&&_e.setGlobalState(x.clippingPlanes,q),Y&&Ge.viewport(C.copy(Y)),$.length>0&&y0($,W,q),ge.length>0&&y0(ge,W,q),Te.length>0&&y0(Te,W,q),Ge.buffers.depth.setTest(!0),Ge.buffers.depth.setMask(!0),Ge.buffers.color.setMask(!0),Ge.setPolygonOffset(!1)}function hU(R,W,q,Y){if((q.isScene===!0?q.overrideMaterial:null)!==null)return;p.state.transmissionRenderTarget[Y.id]===void 0&&(p.state.transmissionRenderTarget[Y.id]=new xa(1,1,{generateMipmaps:!0,type:ct.has("EXT_color_buffer_half_float")||ct.has("EXT_color_buffer_float")?wi:oi,minFilter:bi,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:st.workingColorSpace}));const ge=p.state.transmissionRenderTarget[Y.id],Te=Y.viewport||C;ge.setSize(Te.z*x.transmissionResolutionScale,Te.w*x.transmissionResolutionScale);const Ce=x.getRenderTarget();x.setRenderTarget(ge),x.getClearColor(D),L=x.getClearAlpha(),L<1&&x.setClearColor(16777215,.5),x.clear(),ut&&$e.render(q);const Ie=x.toneMapping;x.toneMapping=Gi;const Ke=Y.viewport;if(Y.viewport!==void 0&&(Y.viewport=void 0),p.setupLightsView(Y),j===!0&&_e.setGlobalState(x.clippingPlanes,Y),y0(R,q,Y),P.updateMultisampleRenderTarget(ge),P.updateRenderTargetMipmap(ge),ct.has("WEBGL_multisampled_render_to_texture")===!1){let Je=!1;for(let Ve=0,Tt=W.length;Ve<Tt;Ve++){const Nt=W[Ve],Dn=Nt.object,fn=Nt.geometry,wt=Nt.material,He=Nt.group;if(wt.side===Ti&&Dn.layers.test(Y.layers)){const ti=wt.side;wt.side=Xt,wt.needsUpdate=!0,dU(Dn,q,Y,fn,wt,He),wt.side=ti,wt.needsUpdate=!0,Je=!0}}Je===!0&&(P.updateMultisampleRenderTarget(ge),P.updateRenderTargetMipmap(ge))}x.setRenderTarget(Ce),x.setClearColor(D,L),Ke!==void 0&&(Y.viewport=Ke),x.toneMapping=Ie}function y0(R,W,q){const Y=W.isScene===!0?W.overrideMaterial:null;for(let $=0,ge=R.length;$<ge;$++){const Te=R[$],Ce=Te.object,Ie=Te.geometry,Ke=Y===null?Te.material:Y,Je=Te.group;Ce.layers.test(q.layers)&&dU(Ce,W,q,Ie,Ke,Je)}}function dU(R,W,q,Y,$,ge){R.onBeforeRender(x,W,q,Y,$,ge),R.modelViewMatrix.multiplyMatrices(q.matrixWorldInverse,R.matrixWorld),R.normalMatrix.getNormalMatrix(R.modelViewMatrix),$.onBeforeRender(x,W,q,Y,R,ge),$.transparent===!0&&$.side===Ti&&$.forceSinglePass===!1?($.side=Xt,$.needsUpdate=!0,x.renderBufferDirect(q,W,Y,$,R,ge),$.side=is,$.needsUpdate=!0,x.renderBufferDirect(q,W,Y,$,R,ge),$.side=Ti):x.renderBufferDirect(q,W,Y,$,R,ge),R.onAfterRender(x,W,q,Y,$,ge)}function x0(R,W,q){W.isScene!==!0&&(W=gt);const Y=ze.get(R),$=p.state.lights,ge=p.state.shadowsArray,Te=$.state.version,Ce=ke.getParameters(R,$.state,ge,W,q),Ie=ke.getProgramCacheKey(Ce);let Ke=Y.programs;Y.environment=R.isMeshStandardMaterial?W.environment:null,Y.fog=W.fog,Y.envMap=(R.isMeshStandardMaterial?X:A).get(R.envMap||Y.environment),Y.envMapRotation=Y.environment!==null&&R.envMap===null?W.environmentRotation:R.envMapRotation,Ke===void 0&&(R.addEventListener("dispose",rt),Ke=new Map,Y.programs=Ke);let Je=Ke.get(Ie);if(Je!==void 0){if(Y.currentProgram===Je&&Y.lightsStateVersion===Te)return pU(R,Ce),Je}else Ce.uniforms=ke.getUniforms(R),R.onBeforeCompile(Ce,x),Je=ke.acquireProgram(Ce,Ie),Ke.set(Ie,Je),Y.uniforms=Ce.uniforms;const Ve=Y.uniforms;return(!R.isShaderMaterial&&!R.isRawShaderMaterial||R.clipping===!0)&&(Ve.clippingPlanes=_e.uniform),pU(R,Ce),Y.needsLights=Ene(R),Y.lightsStateVersion=Te,Y.needsLights&&(Ve.ambientLightColor.value=$.state.ambient,Ve.lightProbe.value=$.state.probe,Ve.directionalLights.value=$.state.directional,Ve.directionalLightShadows.value=$.state.directionalShadow,Ve.spotLights.value=$.state.spot,Ve.spotLightShadows.value=$.state.spotShadow,Ve.rectAreaLights.value=$.state.rectArea,Ve.ltc_1.value=$.state.rectAreaLTC1,Ve.ltc_2.value=$.state.rectAreaLTC2,Ve.pointLights.value=$.state.point,Ve.pointLightShadows.value=$.state.pointShadow,Ve.hemisphereLights.value=$.state.hemi,Ve.directionalShadowMap.value=$.state.directionalShadowMap,Ve.directionalShadowMatrix.value=$.state.directionalShadowMatrix,Ve.spotShadowMap.value=$.state.spotShadowMap,Ve.spotLightMatrix.value=$.state.spotLightMatrix,Ve.spotLightMap.value=$.state.spotLightMap,Ve.pointShadowMap.value=$.state.pointShadowMap,Ve.pointShadowMatrix.value=$.state.pointShadowMatrix),Y.currentProgram=Je,Y.uniformsList=null,Je}function fU(R){if(R.uniformsList===null){const W=R.currentProgram.getUniforms();R.uniformsList=wg.seqWithValue(W.seq,R.uniforms)}return R.uniformsList}function pU(R,W){const q=ze.get(R);q.outputColorSpace=W.outputColorSpace,q.batching=W.batching,q.batchingColor=W.batchingColor,q.instancing=W.instancing,q.instancingColor=W.instancingColor,q.instancingMorph=W.instancingMorph,q.skinning=W.skinning,q.morphTargets=W.morphTargets,q.morphNormals=W.morphNormals,q.morphColors=W.morphColors,q.morphTargetsCount=W.morphTargetsCount,q.numClippingPlanes=W.numClippingPlanes,q.numIntersection=W.numClipIntersection,q.vertexAlphas=W.vertexAlphas,q.vertexTangents=W.vertexTangents,q.toneMapping=W.toneMapping}function wne(R,W,q,Y,$){W.isScene!==!0&&(W=gt),P.resetTextureUnits();const ge=W.fog,Te=Y.isMeshStandardMaterial?W.environment:null,Ce=E===null?x.outputColorSpace:E.isXRRenderTarget===!0?E.texture.colorSpace:zr,Ie=(Y.isMeshStandardMaterial?X:A).get(Y.envMap||Te),Ke=Y.vertexColors===!0&&!!q.attributes.color&&q.attributes.color.itemSize===4,Je=!!q.attributes.tangent&&(!!Y.normalMap||Y.anisotropy>0),Ve=!!q.morphAttributes.position,Tt=!!q.morphAttributes.normal,Nt=!!q.morphAttributes.color;let Dn=Gi;Y.toneMapped&&(E===null||E.isXRRenderTarget===!0)&&(Dn=x.toneMapping);const fn=q.morphAttributes.position||q.morphAttributes.normal||q.morphAttributes.color,wt=fn!==void 0?fn.length:0,He=ze.get(Y),ti=p.state.lights;if(j===!0&&(ae===!0||R!==b)){const Ii=R===b&&Y.id===M;_e.setState(Y,R,Ii)}let Pt=!1;Y.version===He.__version?(He.needsLights&&He.lightsStateVersion!==ti.state.version||He.outputColorSpace!==Ce||$.isBatchedMesh&&He.batching===!1||!$.isBatchedMesh&&He.batching===!0||$.isBatchedMesh&&He.batchingColor===!0&&$.colorTexture===null||$.isBatchedMesh&&He.batchingColor===!1&&$.colorTexture!==null||$.isInstancedMesh&&He.instancing===!1||!$.isInstancedMesh&&He.instancing===!0||$.isSkinnedMesh&&He.skinning===!1||!$.isSkinnedMesh&&He.skinning===!0||$.isInstancedMesh&&He.instancingColor===!0&&$.instanceColor===null||$.isInstancedMesh&&He.instancingColor===!1&&$.instanceColor!==null||$.isInstancedMesh&&He.instancingMorph===!0&&$.morphTexture===null||$.isInstancedMesh&&He.instancingMorph===!1&&$.morphTexture!==null||He.envMap!==Ie||Y.fog===!0&&He.fog!==ge||He.numClippingPlanes!==void 0&&(He.numClippingPlanes!==_e.numPlanes||He.numIntersection!==_e.numIntersection)||He.vertexAlphas!==Ke||He.vertexTangents!==Je||He.morphTargets!==Ve||He.morphNormals!==Tt||He.morphColors!==Nt||He.toneMapping!==Dn||He.morphTargetsCount!==wt)&&(Pt=!0):(Pt=!0,He.__version=Y.version);let xs=He.currentProgram;Pt===!0&&(xs=x0(Y,W,$));let Eh=!1,Nr=!1,gp=!1;const Jt=xs.getUniforms(),qr=He.uniforms;if(Ge.useProgram(xs.program)&&(Eh=!0,Nr=!0,gp=!0),Y.id!==M&&(M=Y.id,Nr=!0),Eh||b!==R){Ge.buffers.depth.getReversed()?(re.copy(R.projectionMatrix),C3(re),R3(re),Jt.setValue(z,"projectionMatrix",re)):Jt.setValue(z,"projectionMatrix",R.projectionMatrix),Jt.setValue(z,"viewMatrix",R.matrixWorldInverse);const sr=Jt.map.cameraPosition;sr!==void 0&&sr.setValue(z,Re.setFromMatrixPosition(R.matrixWorld)),dt.logarithmicDepthBuffer&&Jt.setValue(z,"logDepthBufFC",2/(Math.log(R.far+1)/Math.LN2)),(Y.isMeshPhongMaterial||Y.isMeshToonMaterial||Y.isMeshLambertMaterial||Y.isMeshBasicMaterial||Y.isMeshStandardMaterial||Y.isShaderMaterial)&&Jt.setValue(z,"isOrthographic",R.isOrthographicCamera===!0),b!==R&&(b=R,Nr=!0,gp=!0)}if($.isSkinnedMesh){Jt.setOptional(z,$,"bindMatrix"),Jt.setOptional(z,$,"bindMatrixInverse");const Ii=$.skeleton;Ii&&(Ii.boneTexture===null&&Ii.computeBoneTexture(),Jt.setValue(z,"boneTexture",Ii.boneTexture,P))}$.isBatchedMesh&&(Jt.setOptional(z,$,"batchingTexture"),Jt.setValue(z,"batchingTexture",$._matricesTexture,P),Jt.setOptional(z,$,"batchingIdTexture"),Jt.setValue(z,"batchingIdTexture",$._indirectTexture,P),Jt.setOptional(z,$,"batchingColorTexture"),$._colorsTexture!==null&&Jt.setValue(z,"batchingColorTexture",$._colorsTexture,P));const Yr=q.morphAttributes;if((Yr.position!==void 0||Yr.normal!==void 0||Yr.color!==void 0)&&Ye.update($,q,xs),(Nr||He.receiveShadow!==$.receiveShadow)&&(He.receiveShadow=$.receiveShadow,Jt.setValue(z,"receiveShadow",$.receiveShadow)),Y.isMeshGouraudMaterial&&Y.envMap!==null&&(qr.envMap.value=Ie,qr.flipEnvMap.value=Ie.isCubeTexture&&Ie.isRenderTargetTexture===!1?-1:1),Y.isMeshStandardMaterial&&Y.envMap===null&&W.environment!==null&&(qr.envMapIntensity.value=W.environmentIntensity),Nr&&(Jt.setValue(z,"toneMappingExposure",x.toneMappingExposure),He.needsLights&&Mne(qr,gp),ge&&Y.fog===!0&&be.refreshFogUniforms(qr,ge),be.refreshMaterialUniforms(qr,Y,B,Q,p.state.transmissionRenderTarget[R.id]),wg.upload(z,fU(He),qr,P)),Y.isShaderMaterial&&Y.uniformsNeedUpdate===!0&&(wg.upload(z,fU(He),qr,P),Y.uniformsNeedUpdate=!1),Y.isSpriteMaterial&&Jt.setValue(z,"center",$.center),Jt.setValue(z,"modelViewMatrix",$.modelViewMatrix),Jt.setValue(z,"normalMatrix",$.normalMatrix),Jt.setValue(z,"modelMatrix",$.matrixWorld),Y.isShaderMaterial||Y.isRawShaderMaterial){const Ii=Y.uniformsGroups;for(let sr=0,zw=Ii.length;sr<zw;sr++){const hu=Ii[sr];G.update(hu,xs),G.bind(hu,xs)}}return xs}function Mne(R,W){R.ambientLightColor.needsUpdate=W,R.lightProbe.needsUpdate=W,R.directionalLights.needsUpdate=W,R.directionalLightShadows.needsUpdate=W,R.pointLights.needsUpdate=W,R.pointLightShadows.needsUpdate=W,R.spotLights.needsUpdate=W,R.spotLightShadows.needsUpdate=W,R.rectAreaLights.needsUpdate=W,R.hemisphereLights.needsUpdate=W}function Ene(R){return R.isMeshLambertMaterial||R.isMeshToonMaterial||R.isMeshPhongMaterial||R.isMeshStandardMaterial||R.isShadowMaterial||R.isShaderMaterial&&R.lights===!0}this.getActiveCubeFace=function(){return T},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return E},this.setRenderTargetTextures=function(R,W,q){ze.get(R.texture).__webglTexture=W,ze.get(R.depthTexture).__webglTexture=q;const Y=ze.get(R);Y.__hasExternalTextures=!0,Y.__autoAllocateDepthBuffer=q===void 0,Y.__autoAllocateDepthBuffer||ct.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Y.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(R,W){const q=ze.get(R);q.__webglFramebuffer=W,q.__useDefaultFramebuffer=W===void 0};const Ane=z.createFramebuffer();this.setRenderTarget=function(R,W=0,q=0){E=R,T=W,w=q;let Y=!0,$=null,ge=!1,Te=!1;if(R){const Ie=ze.get(R);if(Ie.__useDefaultFramebuffer!==void 0)Ge.bindFramebuffer(z.FRAMEBUFFER,null),Y=!1;else if(Ie.__webglFramebuffer===void 0)P.setupRenderTarget(R);else if(Ie.__hasExternalTextures)P.rebindTextures(R,ze.get(R.texture).__webglTexture,ze.get(R.depthTexture).__webglTexture);else if(R.depthBuffer){const Ve=R.depthTexture;if(Ie.__boundDepthTexture!==Ve){if(Ve!==null&&ze.has(Ve)&&(R.width!==Ve.image.width||R.height!==Ve.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");P.setupDepthRenderbuffer(R)}}const Ke=R.texture;(Ke.isData3DTexture||Ke.isDataArrayTexture||Ke.isCompressedArrayTexture)&&(Te=!0);const Je=ze.get(R).__webglFramebuffer;R.isWebGLCubeRenderTarget?(Array.isArray(Je[W])?$=Je[W][q]:$=Je[W],ge=!0):R.samples>0&&P.useMultisampledRTT(R)===!1?$=ze.get(R).__webglMultisampledFramebuffer:Array.isArray(Je)?$=Je[q]:$=Je,C.copy(R.viewport),I.copy(R.scissor),U=R.scissorTest}else C.copy(K).multiplyScalar(B).floor(),I.copy(le).multiplyScalar(B).floor(),U=Pe;if(q!==0&&($=Ane),Ge.bindFramebuffer(z.FRAMEBUFFER,$)&&Y&&Ge.drawBuffers(R,$),Ge.viewport(C),Ge.scissor(I),Ge.setScissorTest(U),ge){const Ie=ze.get(R.texture);z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_CUBE_MAP_POSITIVE_X+W,Ie.__webglTexture,q)}else if(Te){const Ie=ze.get(R.texture),Ke=W;z.framebufferTextureLayer(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,Ie.__webglTexture,q,Ke)}else if(R!==null&&q!==0){const Ie=ze.get(R.texture);z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_2D,Ie.__webglTexture,q)}M=-1},this.readRenderTargetPixels=function(R,W,q,Y,$,ge,Te){if(!(R&&R.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ce=ze.get(R).__webglFramebuffer;if(R.isWebGLCubeRenderTarget&&Te!==void 0&&(Ce=Ce[Te]),Ce){Ge.bindFramebuffer(z.FRAMEBUFFER,Ce);try{const Ie=R.texture,Ke=Ie.format,Je=Ie.type;if(!dt.textureFormatReadable(Ke)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!dt.textureTypeReadable(Je)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}W>=0&&W<=R.width-Y&&q>=0&&q<=R.height-$&&z.readPixels(W,q,Y,$,lt.convert(Ke),lt.convert(Je),ge)}finally{const Ie=E!==null?ze.get(E).__webglFramebuffer:null;Ge.bindFramebuffer(z.FRAMEBUFFER,Ie)}}},this.readRenderTargetPixelsAsync=async function(R,W,q,Y,$,ge,Te){if(!(R&&R.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Ce=ze.get(R).__webglFramebuffer;if(R.isWebGLCubeRenderTarget&&Te!==void 0&&(Ce=Ce[Te]),Ce){const Ie=R.texture,Ke=Ie.format,Je=Ie.type;if(!dt.textureFormatReadable(Ke))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!dt.textureTypeReadable(Je))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(W>=0&&W<=R.width-Y&&q>=0&&q<=R.height-$){Ge.bindFramebuffer(z.FRAMEBUFFER,Ce);const Ve=z.createBuffer();z.bindBuffer(z.PIXEL_PACK_BUFFER,Ve),z.bufferData(z.PIXEL_PACK_BUFFER,ge.byteLength,z.STREAM_READ),z.readPixels(W,q,Y,$,lt.convert(Ke),lt.convert(Je),0);const Tt=E!==null?ze.get(E).__webglFramebuffer:null;Ge.bindFramebuffer(z.FRAMEBUFFER,Tt);const Nt=z.fenceSync(z.SYNC_GPU_COMMANDS_COMPLETE,0);return z.flush(),await A3(z,Nt,4),z.bindBuffer(z.PIXEL_PACK_BUFFER,Ve),z.getBufferSubData(z.PIXEL_PACK_BUFFER,0,ge),z.deleteBuffer(Ve),z.deleteSync(Nt),ge}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(R,W=null,q=0){R.isTexture!==!0&&(bl("WebGLRenderer: copyFramebufferToTexture function signature has changed."),W=arguments[0]||null,R=arguments[1]);const Y=Math.pow(2,-q),$=Math.floor(R.image.width*Y),ge=Math.floor(R.image.height*Y),Te=W!==null?W.x:0,Ce=W!==null?W.y:0;P.setTexture2D(R,0),z.copyTexSubImage2D(z.TEXTURE_2D,q,0,0,Te,Ce,$,ge),Ge.unbindTexture()};const Cne=z.createFramebuffer(),Rne=z.createFramebuffer();this.copyTextureToTexture=function(R,W,q=null,Y=null,$=0,ge=null){R.isTexture!==!0&&(bl("WebGLRenderer: copyTextureToTexture function signature has changed."),Y=arguments[0]||null,R=arguments[1],W=arguments[2],ge=arguments[3]||0,q=null),ge===null&&($!==0?(bl("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),ge=$,$=0):ge=0);let Te,Ce,Ie,Ke,Je,Ve,Tt,Nt,Dn;const fn=R.isCompressedTexture?R.mipmaps[ge]:R.image;if(q!==null)Te=q.max.x-q.min.x,Ce=q.max.y-q.min.y,Ie=q.isBox3?q.max.z-q.min.z:1,Ke=q.min.x,Je=q.min.y,Ve=q.isBox3?q.min.z:0;else{const Yr=Math.pow(2,-$);Te=Math.floor(fn.width*Yr),Ce=Math.floor(fn.height*Yr),R.isDataArrayTexture?Ie=fn.depth:R.isData3DTexture?Ie=Math.floor(fn.depth*Yr):Ie=1,Ke=0,Je=0,Ve=0}Y!==null?(Tt=Y.x,Nt=Y.y,Dn=Y.z):(Tt=0,Nt=0,Dn=0);const wt=lt.convert(W.format),He=lt.convert(W.type);let ti;W.isData3DTexture?(P.setTexture3D(W,0),ti=z.TEXTURE_3D):W.isDataArrayTexture||W.isCompressedArrayTexture?(P.setTexture2DArray(W,0),ti=z.TEXTURE_2D_ARRAY):(P.setTexture2D(W,0),ti=z.TEXTURE_2D),z.pixelStorei(z.UNPACK_FLIP_Y_WEBGL,W.flipY),z.pixelStorei(z.UNPACK_PREMULTIPLY_ALPHA_WEBGL,W.premultiplyAlpha),z.pixelStorei(z.UNPACK_ALIGNMENT,W.unpackAlignment);const Pt=z.getParameter(z.UNPACK_ROW_LENGTH),xs=z.getParameter(z.UNPACK_IMAGE_HEIGHT),Eh=z.getParameter(z.UNPACK_SKIP_PIXELS),Nr=z.getParameter(z.UNPACK_SKIP_ROWS),gp=z.getParameter(z.UNPACK_SKIP_IMAGES);z.pixelStorei(z.UNPACK_ROW_LENGTH,fn.width),z.pixelStorei(z.UNPACK_IMAGE_HEIGHT,fn.height),z.pixelStorei(z.UNPACK_SKIP_PIXELS,Ke),z.pixelStorei(z.UNPACK_SKIP_ROWS,Je),z.pixelStorei(z.UNPACK_SKIP_IMAGES,Ve);const Jt=R.isDataArrayTexture||R.isData3DTexture,qr=W.isDataArrayTexture||W.isData3DTexture;if(R.isDepthTexture){const Yr=ze.get(R),Ii=ze.get(W),sr=ze.get(Yr.__renderTarget),zw=ze.get(Ii.__renderTarget);Ge.bindFramebuffer(z.READ_FRAMEBUFFER,sr.__webglFramebuffer),Ge.bindFramebuffer(z.DRAW_FRAMEBUFFER,zw.__webglFramebuffer);for(let hu=0;hu<Ie;hu++)Jt&&(z.framebufferTextureLayer(z.READ_FRAMEBUFFER,z.COLOR_ATTACHMENT0,ze.get(R).__webglTexture,$,Ve+hu),z.framebufferTextureLayer(z.DRAW_FRAMEBUFFER,z.COLOR_ATTACHMENT0,ze.get(W).__webglTexture,ge,Dn+hu)),z.blitFramebuffer(Ke,Je,Te,Ce,Tt,Nt,Te,Ce,z.DEPTH_BUFFER_BIT,z.NEAREST);Ge.bindFramebuffer(z.READ_FRAMEBUFFER,null),Ge.bindFramebuffer(z.DRAW_FRAMEBUFFER,null)}else if($!==0||R.isRenderTargetTexture||ze.has(R)){const Yr=ze.get(R),Ii=ze.get(W);Ge.bindFramebuffer(z.READ_FRAMEBUFFER,Cne),Ge.bindFramebuffer(z.DRAW_FRAMEBUFFER,Rne);for(let sr=0;sr<Ie;sr++)Jt?z.framebufferTextureLayer(z.READ_FRAMEBUFFER,z.COLOR_ATTACHMENT0,Yr.__webglTexture,$,Ve+sr):z.framebufferTexture2D(z.READ_FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_2D,Yr.__webglTexture,$),qr?z.framebufferTextureLayer(z.DRAW_FRAMEBUFFER,z.COLOR_ATTACHMENT0,Ii.__webglTexture,ge,Dn+sr):z.framebufferTexture2D(z.DRAW_FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_2D,Ii.__webglTexture,ge),$!==0?z.blitFramebuffer(Ke,Je,Te,Ce,Tt,Nt,Te,Ce,z.COLOR_BUFFER_BIT,z.NEAREST):qr?z.copyTexSubImage3D(ti,ge,Tt,Nt,Dn+sr,Ke,Je,Te,Ce):z.copyTexSubImage2D(ti,ge,Tt,Nt,Ke,Je,Te,Ce);Ge.bindFramebuffer(z.READ_FRAMEBUFFER,null),Ge.bindFramebuffer(z.DRAW_FRAMEBUFFER,null)}else qr?R.isDataTexture||R.isData3DTexture?z.texSubImage3D(ti,ge,Tt,Nt,Dn,Te,Ce,Ie,wt,He,fn.data):W.isCompressedArrayTexture?z.compressedTexSubImage3D(ti,ge,Tt,Nt,Dn,Te,Ce,Ie,wt,fn.data):z.texSubImage3D(ti,ge,Tt,Nt,Dn,Te,Ce,Ie,wt,He,fn):R.isDataTexture?z.texSubImage2D(z.TEXTURE_2D,ge,Tt,Nt,Te,Ce,wt,He,fn.data):R.isCompressedTexture?z.compressedTexSubImage2D(z.TEXTURE_2D,ge,Tt,Nt,fn.width,fn.height,wt,fn.data):z.texSubImage2D(z.TEXTURE_2D,ge,Tt,Nt,Te,Ce,wt,He,fn);z.pixelStorei(z.UNPACK_ROW_LENGTH,Pt),z.pixelStorei(z.UNPACK_IMAGE_HEIGHT,xs),z.pixelStorei(z.UNPACK_SKIP_PIXELS,Eh),z.pixelStorei(z.UNPACK_SKIP_ROWS,Nr),z.pixelStorei(z.UNPACK_SKIP_IMAGES,gp),ge===0&&W.generateMipmaps&&z.generateMipmap(ti),Ge.unbindTexture()},this.copyTextureToTexture3D=function(R,W,q=null,Y=null,$=0){return R.isTexture!==!0&&(bl("WebGLRenderer: copyTextureToTexture3D function signature has changed."),q=arguments[0]||null,Y=arguments[1]||null,R=arguments[2],W=arguments[3],$=arguments[4]||0),bl('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(R,W,q,Y,$)},this.initRenderTarget=function(R){ze.get(R).__webglFramebuffer===void 0&&P.setupRenderTarget(R)},this.initTexture=function(R){R.isCubeTexture?P.setTextureCube(R,0):R.isData3DTexture?P.setTexture3D(R,0):R.isDataArrayTexture||R.isCompressedArrayTexture?P.setTexture2DArray(R,0):P.setTexture2D(R,0),Ge.unbindTexture()},this.resetState=function(){T=0,w=0,E=null,Ge.reset(),kt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Vi}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorspace=st._getDrawingBufferColorSpace(e),t.unpackColorSpace=st._getUnpackColorSpace()}}const Fc=new us,So=new he,YC=new N,oS=new he,Eg=new he,Ag=new N,aS=new N,KC=new pt,QC=new N,ZC=new N;let Hi=null,Ls=null;const To=[],Ca={NONE:-1,PAN:0,ROTATE:1};class $4 extends xg{constructor(e,t,i=null){super(t,i),this.objects=e,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new _C,this.mouseButtons={LEFT:Vn.PAN,MIDDLE:Vn.PAN,RIGHT:Vn.ROTATE},this.touches={ONE:lo.PAN},this._onPointerMove=j4.bind(this),this._onPointerDown=X4.bind(this),this._onPointerCancel=q4.bind(this),this._onContextMenu=Y4.bind(this),i!==null&&this.connect()}connect(){this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(e){const t=this.domElement.getBoundingClientRect();So.x=(e.clientX-t.left)/t.width*2-1,So.y=-(e.clientY-t.top)/t.height*2+1}_updateState(e){let t;if(e.pointerType==="touch")t=this.touches.ONE;else switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=null}switch(t){case Vn.PAN:case lo.PAN:this.state=Ca.PAN;break;case Vn.ROTATE:case lo.ROTATE:this.state=Ca.ROTATE;break;default:this.state=Ca.NONE}}getRaycaster(){return console.warn("THREE.DragControls: getRaycaster() has been deprecated. Use controls.raycaster instead."),this.raycaster}setObjects(e){console.warn("THREE.DragControls: setObjects() has been deprecated. Use controls.objects instead."),this.objects=e}getObjects(){return console.warn("THREE.DragControls: getObjects() has been deprecated. Use controls.objects instead."),this.objects}activate(){console.warn("THREE.DragControls: activate() has been renamed to connect()."),this.connect()}deactivate(){console.warn("THREE.DragControls: deactivate() has been renamed to disconnect()."),this.disconnect()}set mode(e){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}get mode(){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}}function j4(n){const e=this.object,t=this.domElement,i=this.raycaster;if(this.enabled!==!1){if(this._updatePointer(n),i.setFromCamera(So,e),Hi)this.state===Ca.PAN?i.ray.intersectPlane(Fc,Ag)&&Hi.position.copy(Ag.sub(YC).applyMatrix4(KC)):this.state===Ca.ROTATE&&(oS.subVectors(So,Eg).multiplyScalar(this.rotateSpeed),Hi.rotateOnWorldAxis(QC,oS.x),Hi.rotateOnWorldAxis(ZC.normalize(),-oS.y)),this.dispatchEvent({type:"drag",object:Hi}),Eg.copy(So);else if(n.pointerType==="mouse"||n.pointerType==="pen")if(To.length=0,i.setFromCamera(So,e),i.intersectObjects(this.objects,this.recursive,To),To.length>0){const r=To[0].object;Fc.setFromNormalAndCoplanarPoint(e.getWorldDirection(Fc.normal),aS.setFromMatrixPosition(r.matrixWorld)),Ls!==r&&Ls!==null&&(this.dispatchEvent({type:"hoveroff",object:Ls}),t.style.cursor="auto",Ls=null),Ls!==r&&(this.dispatchEvent({type:"hoveron",object:r}),t.style.cursor="pointer",Ls=r)}else Ls!==null&&(this.dispatchEvent({type:"hoveroff",object:Ls}),t.style.cursor="auto",Ls=null);Eg.copy(So)}}function X4(n){const e=this.object,t=this.domElement,i=this.raycaster;this.enabled!==!1&&(this._updatePointer(n),this._updateState(n),To.length=0,i.setFromCamera(So,e),i.intersectObjects(this.objects,this.recursive,To),To.length>0&&(this.transformGroup===!0?Hi=JC(To[0].object):Hi=To[0].object,Fc.setFromNormalAndCoplanarPoint(e.getWorldDirection(Fc.normal),aS.setFromMatrixPosition(Hi.matrixWorld)),i.ray.intersectPlane(Fc,Ag)&&(this.state===Ca.PAN?(KC.copy(Hi.parent.matrixWorld).invert(),YC.copy(Ag).sub(aS.setFromMatrixPosition(Hi.matrixWorld))):this.state===Ca.ROTATE&&(QC.set(0,1,0).applyQuaternion(e.quaternion).normalize(),ZC.set(1,0,0).applyQuaternion(e.quaternion).normalize())),t.style.cursor="move",this.dispatchEvent({type:"dragstart",object:Hi})),Eg.copy(So))}function q4(){this.enabled!==!1&&(Hi&&(this.dispatchEvent({type:"dragend",object:Hi}),Hi=null),this.domElement.style.cursor=Ls?"pointer":"auto",this.state=Ca.NONE)}function Y4(n){this.enabled!==!1&&n.preventDefault()}function JC(n,e=null){return n.isGroup&&(e=n),n.parent===null?e:JC(n.parent,e)}function K4(n,e,t){var i,r=1;n==null&&(n=0),e==null&&(e=0),t==null&&(t=0);function s(){var o,a=i.length,l,u=0,c=0,h=0;for(o=0;o<a;++o)l=i[o],u+=l.x||0,c+=l.y||0,h+=l.z||0;for(u=(u/a-n)*r,c=(c/a-e)*r,h=(h/a-t)*r,o=0;o<a;++o)l=i[o],u&&(l.x-=u),c&&(l.y-=c),h&&(l.z-=h)}return s.initialize=function(o){i=o},s.x=function(o){return arguments.length?(n=+o,s):n},s.y=function(o){return arguments.length?(e=+o,s):e},s.z=function(o){return arguments.length?(t=+o,s):t},s.strength=function(o){return arguments.length?(r=+o,s):r},s}function Q4(n){const e=+this._x.call(null,n);return eR(this.cover(e),e,n)}function eR(n,e,t){if(isNaN(e))return n;var i,r=n._root,s={data:t},o=n._x0,a=n._x1,l,u,c,h,d;if(!r)return n._root=s,n;for(;r.length;)if((c=e>=(l=(o+a)/2))?o=l:a=l,i=r,!(r=r[h=+c]))return i[h]=s,n;if(u=+n._x.call(null,r.data),e===u)return s.next=r,i?i[h]=s:n._root=s,n;do i=i?i[h]=new Array(2):n._root=new Array(2),(c=e>=(l=(o+a)/2))?o=l:a=l;while((h=+c)==(d=+(u>=l)));return i[d]=r,i[h]=s,n}function Z4(n){Array.isArray(n)||(n=Array.from(n));const e=n.length,t=new Float64Array(e);let i=1/0,r=-1/0;for(let s=0,o;s<e;++s)isNaN(o=+this._x.call(null,n[s]))||(t[s]=o,o<i&&(i=o),o>r&&(r=o));if(i>r)return this;this.cover(i).cover(r);for(let s=0;s<e;++s)eR(this,t[s],n[s]);return this}function J4(n){if(isNaN(n=+n))return this;var e=this._x0,t=this._x1;if(isNaN(e))t=(e=Math.floor(n))+1;else{for(var i=t-e||1,r=this._root,s,o;e>n||n>=t;)switch(o=+(n<e),s=new Array(2),s[o]=r,r=s,i*=2,o){case 0:t=e+i;break;case 1:e=t-i;break}this._root&&this._root.length&&(this._root=r)}return this._x0=e,this._x1=t,this}function eV(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function tV(n){return arguments.length?this.cover(+n[0][0]).cover(+n[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]}function bo(n,e,t){this.node=n,this.x0=e,this.x1=t}function nV(n,e){var t,i=this._x0,r,s,o=this._x1,a=[],l=this._root,u,c;for(l&&a.push(new bo(l,i,o)),e==null?e=1/0:(i=n-e,o=n+e);u=a.pop();)if(!(!(l=u.node)||(r=u.x0)>o||(s=u.x1)<i))if(l.length){var h=(r+s)/2;a.push(new bo(l[1],h,s),new bo(l[0],r,h)),(c=+(n>=h))&&(u=a[a.length-1],a[a.length-1]=a[a.length-1-c],a[a.length-1-c]=u)}else{var d=Math.abs(n-+this._x.call(null,l.data));d<e&&(e=d,i=n-d,o=n+d,t=l.data)}return t}function iV(n){if(isNaN(l=+this._x.call(null,n)))return this;var e,t=this._root,i,r,s,o=this._x0,a=this._x1,l,u,c,h,d;if(!t)return this;if(t.length)for(;;){if((c=l>=(u=(o+a)/2))?o=u:a=u,e=t,!(t=t[h=+c]))return this;if(!t.length)break;e[h+1&1]&&(i=e,d=h)}for(;t.data!==n;)if(r=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,r?(s?r.next=s:delete r.next,this):e?(s?e[h]=s:delete e[h],(t=e[0]||e[1])&&t===(e[1]||e[0])&&!t.length&&(i?i[d]=t:this._root=t),this):(this._root=s,this)}function rV(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function sV(){return this._root}function oV(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function aV(n){var e=[],t,i=this._root,r,s,o;for(i&&e.push(new bo(i,this._x0,this._x1));t=e.pop();)if(!n(i=t.node,s=t.x0,o=t.x1)&&i.length){var a=(s+o)/2;(r=i[1])&&e.push(new bo(r,a,o)),(r=i[0])&&e.push(new bo(r,s,a))}return this}function lV(n){var e=[],t=[],i;for(this._root&&e.push(new bo(this._root,this._x0,this._x1));i=e.pop();){var r=i.node;if(r.length){var s,o=i.x0,a=i.x1,l=(o+a)/2;(s=r[0])&&e.push(new bo(s,o,l)),(s=r[1])&&e.push(new bo(s,l,a))}t.push(i)}for(;i=t.pop();)n(i.node,i.x0,i.x1);return this}function uV(n){return n[0]}function cV(n){return arguments.length?(this._x=n,this):this._x}function tR(n,e){var t=new lS(e??uV,NaN,NaN);return n==null?t:t.addAll(n)}function lS(n,e,t){this._x=n,this._x0=e,this._x1=t,this._root=void 0}function nR(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var Wi=tR.prototype=lS.prototype;Wi.copy=function(){var n=new lS(this._x,this._x0,this._x1),e=this._root,t,i;if(!e)return n;if(!e.length)return n._root=nR(e),n;for(t=[{source:e,target:n._root=new Array(2)}];e=t.pop();)for(var r=0;r<2;++r)(i=e.source[r])&&(i.length?t.push({source:i,target:e.target[r]=new Array(2)}):e.target[r]=nR(i));return n},Wi.add=Q4,Wi.addAll=Z4,Wi.cover=J4,Wi.data=eV,Wi.extent=tV,Wi.find=nV,Wi.remove=iV,Wi.removeAll=rV,Wi.root=sV,Wi.size=oV,Wi.visit=aV,Wi.visitAfter=lV,Wi.x=cV;function hV(n){const e=+this._x.call(null,n),t=+this._y.call(null,n);return iR(this.cover(e,t),e,t,n)}function iR(n,e,t,i){if(isNaN(e)||isNaN(t))return n;var r,s=n._root,o={data:i},a=n._x0,l=n._y0,u=n._x1,c=n._y1,h,d,f,m,g,_,p,v;if(!s)return n._root=o,n;for(;s.length;)if((g=e>=(h=(a+u)/2))?a=h:u=h,(_=t>=(d=(l+c)/2))?l=d:c=d,r=s,!(s=s[p=_<<1|g]))return r[p]=o,n;if(f=+n._x.call(null,s.data),m=+n._y.call(null,s.data),e===f&&t===m)return o.next=s,r?r[p]=o:n._root=o,n;do r=r?r[p]=new Array(4):n._root=new Array(4),(g=e>=(h=(a+u)/2))?a=h:u=h,(_=t>=(d=(l+c)/2))?l=d:c=d;while((p=_<<1|g)===(v=(m>=d)<<1|f>=h));return r[v]=s,r[p]=o,n}function dV(n){var e,t,i=n.length,r,s,o=new Array(i),a=new Array(i),l=1/0,u=1/0,c=-1/0,h=-1/0;for(t=0;t<i;++t)isNaN(r=+this._x.call(null,e=n[t]))||isNaN(s=+this._y.call(null,e))||(o[t]=r,a[t]=s,r<l&&(l=r),r>c&&(c=r),s<u&&(u=s),s>h&&(h=s));if(l>c||u>h)return this;for(this.cover(l,u).cover(c,h),t=0;t<i;++t)iR(this,o[t],a[t],n[t]);return this}function fV(n,e){if(isNaN(n=+n)||isNaN(e=+e))return this;var t=this._x0,i=this._y0,r=this._x1,s=this._y1;if(isNaN(t))r=(t=Math.floor(n))+1,s=(i=Math.floor(e))+1;else{for(var o=r-t||1,a=this._root,l,u;t>n||n>=r||i>e||e>=s;)switch(u=(e<i)<<1|n<t,l=new Array(4),l[u]=a,a=l,o*=2,u){case 0:r=t+o,s=i+o;break;case 1:t=r-o,s=i+o;break;case 2:r=t+o,i=s-o;break;case 3:t=r-o,i=s-o;break}this._root&&this._root.length&&(this._root=a)}return this._x0=t,this._y0=i,this._x1=r,this._y1=s,this}function pV(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function mV(n){return arguments.length?this.cover(+n[0][0],+n[0][1]).cover(+n[1][0],+n[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Ri(n,e,t,i,r){this.node=n,this.x0=e,this.y0=t,this.x1=i,this.y1=r}function gV(n,e,t){var i,r=this._x0,s=this._y0,o,a,l,u,c=this._x1,h=this._y1,d=[],f=this._root,m,g;for(f&&d.push(new Ri(f,r,s,c,h)),t==null?t=1/0:(r=n-t,s=e-t,c=n+t,h=e+t,t*=t);m=d.pop();)if(!(!(f=m.node)||(o=m.x0)>c||(a=m.y0)>h||(l=m.x1)<r||(u=m.y1)<s))if(f.length){var _=(o+l)/2,p=(a+u)/2;d.push(new Ri(f[3],_,p,l,u),new Ri(f[2],o,p,_,u),new Ri(f[1],_,a,l,p),new Ri(f[0],o,a,_,p)),(g=(e>=p)<<1|n>=_)&&(m=d[d.length-1],d[d.length-1]=d[d.length-1-g],d[d.length-1-g]=m)}else{var v=n-+this._x.call(null,f.data),y=e-+this._y.call(null,f.data),x=v*v+y*y;if(x<t){var S=Math.sqrt(t=x);r=n-S,s=e-S,c=n+S,h=e+S,i=f.data}}return i}function _V(n){if(isNaN(c=+this._x.call(null,n))||isNaN(h=+this._y.call(null,n)))return this;var e,t=this._root,i,r,s,o=this._x0,a=this._y0,l=this._x1,u=this._y1,c,h,d,f,m,g,_,p;if(!t)return this;if(t.length)for(;;){if((m=c>=(d=(o+l)/2))?o=d:l=d,(g=h>=(f=(a+u)/2))?a=f:u=f,e=t,!(t=t[_=g<<1|m]))return this;if(!t.length)break;(e[_+1&3]||e[_+2&3]||e[_+3&3])&&(i=e,p=_)}for(;t.data!==n;)if(r=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,r?(s?r.next=s:delete r.next,this):e?(s?e[_]=s:delete e[_],(t=e[0]||e[1]||e[2]||e[3])&&t===(e[3]||e[2]||e[1]||e[0])&&!t.length&&(i?i[p]=t:this._root=t),this):(this._root=s,this)}function vV(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function yV(){return this._root}function xV(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function SV(n){var e=[],t,i=this._root,r,s,o,a,l;for(i&&e.push(new Ri(i,this._x0,this._y0,this._x1,this._y1));t=e.pop();)if(!n(i=t.node,s=t.x0,o=t.y0,a=t.x1,l=t.y1)&&i.length){var u=(s+a)/2,c=(o+l)/2;(r=i[3])&&e.push(new Ri(r,u,c,a,l)),(r=i[2])&&e.push(new Ri(r,s,c,u,l)),(r=i[1])&&e.push(new Ri(r,u,o,a,c)),(r=i[0])&&e.push(new Ri(r,s,o,u,c))}return this}function TV(n){var e=[],t=[],i;for(this._root&&e.push(new Ri(this._root,this._x0,this._y0,this._x1,this._y1));i=e.pop();){var r=i.node;if(r.length){var s,o=i.x0,a=i.y0,l=i.x1,u=i.y1,c=(o+l)/2,h=(a+u)/2;(s=r[0])&&e.push(new Ri(s,o,a,c,h)),(s=r[1])&&e.push(new Ri(s,c,a,l,h)),(s=r[2])&&e.push(new Ri(s,o,h,c,u)),(s=r[3])&&e.push(new Ri(s,c,h,l,u))}t.push(i)}for(;i=t.pop();)n(i.node,i.x0,i.y0,i.x1,i.y1);return this}function bV(n){return n[0]}function wV(n){return arguments.length?(this._x=n,this):this._x}function MV(n){return n[1]}function EV(n){return arguments.length?(this._y=n,this):this._y}function Cg(n,e,t){var i=new uS(e??bV,t??MV,NaN,NaN,NaN,NaN);return n==null?i:i.addAll(n)}function uS(n,e,t,i,r,s){this._x=n,this._y=e,this._x0=t,this._y0=i,this._x1=r,this._y1=s,this._root=void 0}function rR(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var Ni=Cg.prototype=uS.prototype;Ni.copy=function(){var n=new uS(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,t,i;if(!e)return n;if(!e.length)return n._root=rR(e),n;for(t=[{source:e,target:n._root=new Array(4)}];e=t.pop();)for(var r=0;r<4;++r)(i=e.source[r])&&(i.length?t.push({source:i,target:e.target[r]=new Array(4)}):e.target[r]=rR(i));return n},Ni.add=hV,Ni.addAll=dV,Ni.cover=fV,Ni.data=pV,Ni.extent=mV,Ni.find=gV,Ni.remove=_V,Ni.removeAll=vV,Ni.root=yV,Ni.size=xV,Ni.visit=SV,Ni.visitAfter=TV,Ni.x=wV,Ni.y=EV;function AV(n){const e=+this._x.call(null,n),t=+this._y.call(null,n),i=+this._z.call(null,n);return sR(this.cover(e,t,i),e,t,i,n)}function sR(n,e,t,i,r){if(isNaN(e)||isNaN(t)||isNaN(i))return n;var s,o=n._root,a={data:r},l=n._x0,u=n._y0,c=n._z0,h=n._x1,d=n._y1,f=n._z1,m,g,_,p,v,y,x,S,T,w,E;if(!o)return n._root=a,n;for(;o.length;)if((x=e>=(m=(l+h)/2))?l=m:h=m,(S=t>=(g=(u+d)/2))?u=g:d=g,(T=i>=(_=(c+f)/2))?c=_:f=_,s=o,!(o=o[w=T<<2|S<<1|x]))return s[w]=a,n;if(p=+n._x.call(null,o.data),v=+n._y.call(null,o.data),y=+n._z.call(null,o.data),e===p&&t===v&&i===y)return a.next=o,s?s[w]=a:n._root=a,n;do s=s?s[w]=new Array(8):n._root=new Array(8),(x=e>=(m=(l+h)/2))?l=m:h=m,(S=t>=(g=(u+d)/2))?u=g:d=g,(T=i>=(_=(c+f)/2))?c=_:f=_;while((w=T<<2|S<<1|x)===(E=(y>=_)<<2|(v>=g)<<1|p>=m));return s[E]=o,s[w]=a,n}function CV(n){Array.isArray(n)||(n=Array.from(n));const e=n.length,t=new Float64Array(e),i=new Float64Array(e),r=new Float64Array(e);let s=1/0,o=1/0,a=1/0,l=-1/0,u=-1/0,c=-1/0;for(let h=0,d,f,m,g;h<e;++h)isNaN(f=+this._x.call(null,d=n[h]))||isNaN(m=+this._y.call(null,d))||isNaN(g=+this._z.call(null,d))||(t[h]=f,i[h]=m,r[h]=g,f<s&&(s=f),f>l&&(l=f),m<o&&(o=m),m>u&&(u=m),g<a&&(a=g),g>c&&(c=g));if(s>l||o>u||a>c)return this;this.cover(s,o,a).cover(l,u,c);for(let h=0;h<e;++h)sR(this,t[h],i[h],r[h],n[h]);return this}function RV(n,e,t){if(isNaN(n=+n)||isNaN(e=+e)||isNaN(t=+t))return this;var i=this._x0,r=this._y0,s=this._z0,o=this._x1,a=this._y1,l=this._z1;if(isNaN(i))o=(i=Math.floor(n))+1,a=(r=Math.floor(e))+1,l=(s=Math.floor(t))+1;else{for(var u=o-i||1,c=this._root,h,d;i>n||n>=o||r>e||e>=a||s>t||t>=l;)switch(d=(t<s)<<2|(e<r)<<1|n<i,h=new Array(8),h[d]=c,c=h,u*=2,d){case 0:o=i+u,a=r+u,l=s+u;break;case 1:i=o-u,a=r+u,l=s+u;break;case 2:o=i+u,r=a-u,l=s+u;break;case 3:i=o-u,r=a-u,l=s+u;break;case 4:o=i+u,a=r+u,s=l-u;break;case 5:i=o-u,a=r+u,s=l-u;break;case 6:o=i+u,r=a-u,s=l-u;break;case 7:i=o-u,r=a-u,s=l-u;break}this._root&&this._root.length&&(this._root=c)}return this._x0=i,this._y0=r,this._z0=s,this._x1=o,this._y1=a,this._z1=l,this}function NV(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function PV(n){return arguments.length?this.cover(+n[0][0],+n[0][1],+n[0][2]).cover(+n[1][0],+n[1][1],+n[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function Ft(n,e,t,i,r,s,o){this.node=n,this.x0=e,this.y0=t,this.z0=i,this.x1=r,this.y1=s,this.z1=o}function DV(n,e,t,i){var r,s=this._x0,o=this._y0,a=this._z0,l,u,c,h,d,f,m=this._x1,g=this._y1,_=this._z1,p=[],v=this._root,y,x;for(v&&p.push(new Ft(v,s,o,a,m,g,_)),i==null?i=1/0:(s=n-i,o=e-i,a=t-i,m=n+i,g=e+i,_=t+i,i*=i);y=p.pop();)if(!(!(v=y.node)||(l=y.x0)>m||(u=y.y0)>g||(c=y.z0)>_||(h=y.x1)<s||(d=y.y1)<o||(f=y.z1)<a))if(v.length){var S=(l+h)/2,T=(u+d)/2,w=(c+f)/2;p.push(new Ft(v[7],S,T,w,h,d,f),new Ft(v[6],l,T,w,S,d,f),new Ft(v[5],S,u,w,h,T,f),new Ft(v[4],l,u,w,S,T,f),new Ft(v[3],S,T,c,h,d,w),new Ft(v[2],l,T,c,S,d,w),new Ft(v[1],S,u,c,h,T,w),new Ft(v[0],l,u,c,S,T,w)),(x=(t>=w)<<2|(e>=T)<<1|n>=S)&&(y=p[p.length-1],p[p.length-1]=p[p.length-1-x],p[p.length-1-x]=y)}else{var E=n-+this._x.call(null,v.data),M=e-+this._y.call(null,v.data),b=t-+this._z.call(null,v.data),C=E*E+M*M+b*b;if(C<i){var I=Math.sqrt(i=C);s=n-I,o=e-I,a=t-I,m=n+I,g=e+I,_=t+I,r=v.data}}return r}const LV=(n,e,t,i,r,s)=>Math.sqrt((n-i)**2+(e-r)**2+(t-s)**2);function IV(n,e,t,i){const r=[],s=n-i,o=e-i,a=t-i,l=n+i,u=e+i,c=t+i;return this.visit((h,d,f,m,g,_,p)=>{if(!h.length)do{const v=h.data;LV(n,e,t,this._x(v),this._y(v),this._z(v))<=i&&r.push(v)}while(h=h.next);return d>l||f>u||m>c||g<s||_<o||p<a}),r}function UV(n){if(isNaN(d=+this._x.call(null,n))||isNaN(f=+this._y.call(null,n))||isNaN(m=+this._z.call(null,n)))return this;var e,t=this._root,i,r,s,o=this._x0,a=this._y0,l=this._z0,u=this._x1,c=this._y1,h=this._z1,d,f,m,g,_,p,v,y,x,S,T;if(!t)return this;if(t.length)for(;;){if((v=d>=(g=(o+u)/2))?o=g:u=g,(y=f>=(_=(a+c)/2))?a=_:c=_,(x=m>=(p=(l+h)/2))?l=p:h=p,e=t,!(t=t[S=x<<2|y<<1|v]))return this;if(!t.length)break;(e[S+1&7]||e[S+2&7]||e[S+3&7]||e[S+4&7]||e[S+5&7]||e[S+6&7]||e[S+7&7])&&(i=e,T=S)}for(;t.data!==n;)if(r=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,r?(s?r.next=s:delete r.next,this):e?(s?e[S]=s:delete e[S],(t=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&t===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!t.length&&(i?i[T]=t:this._root=t),this):(this._root=s,this)}function FV(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function OV(){return this._root}function BV(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function kV(n){var e=[],t,i=this._root,r,s,o,a,l,u,c;for(i&&e.push(new Ft(i,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));t=e.pop();)if(!n(i=t.node,s=t.x0,o=t.y0,a=t.z0,l=t.x1,u=t.y1,c=t.z1)&&i.length){var h=(s+l)/2,d=(o+u)/2,f=(a+c)/2;(r=i[7])&&e.push(new Ft(r,h,d,f,l,u,c)),(r=i[6])&&e.push(new Ft(r,s,d,f,h,u,c)),(r=i[5])&&e.push(new Ft(r,h,o,f,l,d,c)),(r=i[4])&&e.push(new Ft(r,s,o,f,h,d,c)),(r=i[3])&&e.push(new Ft(r,h,d,a,l,u,f)),(r=i[2])&&e.push(new Ft(r,s,d,a,h,u,f)),(r=i[1])&&e.push(new Ft(r,h,o,a,l,d,f)),(r=i[0])&&e.push(new Ft(r,s,o,a,h,d,f))}return this}function zV(n){var e=[],t=[],i;for(this._root&&e.push(new Ft(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));i=e.pop();){var r=i.node;if(r.length){var s,o=i.x0,a=i.y0,l=i.z0,u=i.x1,c=i.y1,h=i.z1,d=(o+u)/2,f=(a+c)/2,m=(l+h)/2;(s=r[0])&&e.push(new Ft(s,o,a,l,d,f,m)),(s=r[1])&&e.push(new Ft(s,d,a,l,u,f,m)),(s=r[2])&&e.push(new Ft(s,o,f,l,d,c,m)),(s=r[3])&&e.push(new Ft(s,d,f,l,u,c,m)),(s=r[4])&&e.push(new Ft(s,o,a,m,d,f,h)),(s=r[5])&&e.push(new Ft(s,d,a,m,u,f,h)),(s=r[6])&&e.push(new Ft(s,o,f,m,d,c,h)),(s=r[7])&&e.push(new Ft(s,d,f,m,u,c,h))}t.push(i)}for(;i=t.pop();)n(i.node,i.x0,i.y0,i.z0,i.x1,i.y1,i.z1);return this}function GV(n){return n[0]}function VV(n){return arguments.length?(this._x=n,this):this._x}function HV(n){return n[1]}function WV(n){return arguments.length?(this._y=n,this):this._y}function $V(n){return n[2]}function jV(n){return arguments.length?(this._z=n,this):this._z}function oR(n,e,t,i){var r=new cS(e??GV,t??HV,i??$V,NaN,NaN,NaN,NaN,NaN,NaN);return n==null?r:r.addAll(n)}function cS(n,e,t,i,r,s,o,a,l){this._x=n,this._y=e,this._z=t,this._x0=i,this._y0=r,this._z0=s,this._x1=o,this._y1=a,this._z1=l,this._root=void 0}function aR(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var Zn=oR.prototype=cS.prototype;Zn.copy=function(){var n=new cS(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),e=this._root,t,i;if(!e)return n;if(!e.length)return n._root=aR(e),n;for(t=[{source:e,target:n._root=new Array(8)}];e=t.pop();)for(var r=0;r<8;++r)(i=e.source[r])&&(i.length?t.push({source:i,target:e.target[r]=new Array(8)}):e.target[r]=aR(i));return n},Zn.add=AV,Zn.addAll=CV,Zn.cover=RV,Zn.data=NV,Zn.extent=PV,Zn.find=DV,Zn.findAllWithinRadius=IV,Zn.remove=UV,Zn.removeAll=FV,Zn.root=OV,Zn.size=BV,Zn.visit=kV,Zn.visitAfter=zV,Zn.x=VV,Zn.y=WV,Zn.z=jV;function wo(n){return function(){return n}}function Mo(n){return(n()-.5)*1e-6}function XV(n){return n.index}function lR(n,e){var t=n.get(e);if(!t)throw new Error("node not found: "+e);return t}function qV(n){var e=XV,t=d,i,r=wo(30),s,o,a,l,u,c,h=1;n==null&&(n=[]);function d(p){return 1/Math.min(l[p.source.index],l[p.target.index])}function f(p){for(var v=0,y=n.length;v<h;++v)for(var x=0,S,T,w,E=0,M=0,b=0,C,I;x<y;++x)S=n[x],T=S.source,w=S.target,E=w.x+w.vx-T.x-T.vx||Mo(c),a>1&&(M=w.y+w.vy-T.y-T.vy||Mo(c)),a>2&&(b=w.z+w.vz-T.z-T.vz||Mo(c)),C=Math.sqrt(E*E+M*M+b*b),C=(C-s[x])/C*p*i[x],E*=C,M*=C,b*=C,w.vx-=E*(I=u[x]),a>1&&(w.vy-=M*I),a>2&&(w.vz-=b*I),T.vx+=E*(I=1-I),a>1&&(T.vy+=M*I),a>2&&(T.vz+=b*I)}function m(){if(o){var p,v=o.length,y=n.length,x=new Map(o.map((T,w)=>[e(T,w,o),T])),S;for(p=0,l=new Array(v);p<y;++p)S=n[p],S.index=p,typeof S.source!="object"&&(S.source=lR(x,S.source)),typeof S.target!="object"&&(S.target=lR(x,S.target)),l[S.source.index]=(l[S.source.index]||0)+1,l[S.target.index]=(l[S.target.index]||0)+1;for(p=0,u=new Array(y);p<y;++p)S=n[p],u[p]=l[S.source.index]/(l[S.source.index]+l[S.target.index]);i=new Array(y),g(),s=new Array(y),_()}}function g(){if(o)for(var p=0,v=n.length;p<v;++p)i[p]=+t(n[p],p,n)}function _(){if(o)for(var p=0,v=n.length;p<v;++p)s[p]=+r(n[p],p,n)}return f.initialize=function(p,...v){o=p,c=v.find(y=>typeof y=="function")||Math.random,a=v.find(y=>[1,2,3].includes(y))||2,m()},f.links=function(p){return arguments.length?(n=p,m(),f):n},f.id=function(p){return arguments.length?(e=p,f):e},f.iterations=function(p){return arguments.length?(h=+p,f):h},f.strength=function(p){return arguments.length?(t=typeof p=="function"?p:wo(+p),g(),f):t},f.distance=function(p){return arguments.length?(r=typeof p=="function"?p:wo(+p),_(),f):r},f}var YV={value:()=>{}};function hS(){for(var n=0,e=arguments.length,t={},i;n<e;++n){if(!(i=arguments[n]+"")||i in t||/[\s.]/.test(i))throw new Error("illegal type: "+i);t[i]=[]}return new Rg(t)}function Rg(n){this._=n}function KV(n,e){return n.trim().split(/^|\s+/).map(function(t){var i="",r=t.indexOf(".");if(r>=0&&(i=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:i}})}Rg.prototype=hS.prototype={constructor:Rg,on:function(n,e){var t=this._,i=KV(n+"",t),r,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((r=(n=i[s]).type)&&(r=QV(t[r],n.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(r=(n=i[s]).type)t[r]=uR(t[r],n.name,e);else if(e==null)for(r in t)t[r]=uR(t[r],n.name,null);return this},copy:function(){var n={},e=this._;for(var t in e)n[t]=e[t].slice();return new Rg(n)},call:function(n,e){if((r=arguments.length-2)>0)for(var t=new Array(r),i=0,r,s;i<r;++i)t[i]=arguments[i+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(s=this._[n],i=0,r=s.length;i<r;++i)s[i].value.apply(e,t)},apply:function(n,e,t){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var i=this._[n],r=0,s=i.length;r<s;++r)i[r].value.apply(e,t)}};function QV(n,e){for(var t=0,i=n.length,r;t<i;++t)if((r=n[t]).name===e)return r.value}function uR(n,e,t){for(var i=0,r=n.length;i<r;++i)if(n[i].name===e){n[i]=YV,n=n.slice(0,i).concat(n.slice(i+1));break}return t!=null&&n.push({name:e,value:t}),n}var Oc=0,tf=0,nf=0,cR=1e3,Ng,rf,Pg=0,Ul=0,Dg=0,sf=typeof performance=="object"&&performance.now?performance:Date,hR=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function dS(){return Ul||(hR(ZV),Ul=sf.now()+Dg)}function ZV(){Ul=0}function Lg(){this._call=this._time=this._next=null}Lg.prototype=fS.prototype={constructor:Lg,restart:function(n,e,t){if(typeof n!="function")throw new TypeError("callback is not a function");t=(t==null?dS():+t)+(e==null?0:+e),!this._next&&rf!==this&&(rf?rf._next=this:Ng=this,rf=this),this._call=n,this._time=t,pS()},stop:function(){this._call&&(this._call=null,this._time=1/0,pS())}};function fS(n,e,t){var i=new Lg;return i.restart(n,e,t),i}function JV(){dS(),++Oc;for(var n=Ng,e;n;)(e=Ul-n._time)>=0&&n._call.call(void 0,e),n=n._next;--Oc}function dR(){Ul=(Pg=sf.now())+Dg,Oc=tf=0;try{JV()}finally{Oc=0,t5(),Ul=0}}function e5(){var n=sf.now(),e=n-Pg;e>cR&&(Dg-=e,Pg=n)}function t5(){for(var n,e=Ng,t,i=1/0;e;)e._call?(i>e._time&&(i=e._time),n=e,e=e._next):(t=e._next,e._next=null,e=n?n._next=t:Ng=t);rf=n,pS(i)}function pS(n){if(!Oc){tf&&(tf=clearTimeout(tf));var e=n-Ul;e>24?(n<1/0&&(tf=setTimeout(dR,n-sf.now()-Dg)),nf&&(nf=clearInterval(nf))):(nf||(Pg=sf.now(),nf=setInterval(e5,cR)),Oc=1,hR(dR))}}function fR(n,e,t){var i=new Lg;return e=e==null?0:+e,i.restart(r=>{i.stop(),n(r+e)},e,t),i}const n5=1664525,i5=1013904223,pR=4294967296;function r5(){let n=1;return()=>(n=(n5*n+i5)%pR)/pR}var mR=3;function mS(n){return n.x}function gR(n){return n.y}function s5(n){return n.z}var o5=10,a5=Math.PI*(3-Math.sqrt(5)),l5=Math.PI*20/(9+Math.sqrt(221));function u5(n,e){e=e||2;var t=Math.min(mR,Math.max(1,Math.round(e))),i,r=1,s=.001,o=1-Math.pow(s,1/300),a=0,l=.6,u=new Map,c=fS(f),h=hS("tick","end"),d=r5();n==null&&(n=[]);function f(){m(),h.call("tick",i),r<s&&(c.stop(),h.call("end",i))}function m(p){var v,y=n.length,x;p===void 0&&(p=1);for(var S=0;S<p;++S)for(r+=(a-r)*o,u.forEach(function(T){T(r)}),v=0;v<y;++v)x=n[v],x.fx==null?x.x+=x.vx*=l:(x.x=x.fx,x.vx=0),t>1&&(x.fy==null?x.y+=x.vy*=l:(x.y=x.fy,x.vy=0)),t>2&&(x.fz==null?x.z+=x.vz*=l:(x.z=x.fz,x.vz=0));return i}function g(){for(var p=0,v=n.length,y;p<v;++p){if(y=n[p],y.index=p,y.fx!=null&&(y.x=y.fx),y.fy!=null&&(y.y=y.fy),y.fz!=null&&(y.z=y.fz),isNaN(y.x)||t>1&&isNaN(y.y)||t>2&&isNaN(y.z)){var x=o5*(t>2?Math.cbrt(.5+p):t>1?Math.sqrt(.5+p):p),S=p*a5,T=p*l5;t===1?y.x=x:t===2?(y.x=x*Math.cos(S),y.y=x*Math.sin(S)):(y.x=x*Math.sin(S)*Math.cos(T),y.y=x*Math.cos(S),y.z=x*Math.sin(S)*Math.sin(T))}(isNaN(y.vx)||t>1&&isNaN(y.vy)||t>2&&isNaN(y.vz))&&(y.vx=0,t>1&&(y.vy=0),t>2&&(y.vz=0))}}function _(p){return p.initialize&&p.initialize(n,d,t),p}return g(),i={tick:m,restart:function(){return c.restart(f),i},stop:function(){return c.stop(),i},numDimensions:function(p){return arguments.length?(t=Math.min(mR,Math.max(1,Math.round(p))),u.forEach(_),i):t},nodes:function(p){return arguments.length?(n=p,g(),u.forEach(_),i):n},alpha:function(p){return arguments.length?(r=+p,i):r},alphaMin:function(p){return arguments.length?(s=+p,i):s},alphaDecay:function(p){return arguments.length?(o=+p,i):+o},alphaTarget:function(p){return arguments.length?(a=+p,i):a},velocityDecay:function(p){return arguments.length?(l=1-p,i):1-l},randomSource:function(p){return arguments.length?(d=p,u.forEach(_),i):d},force:function(p,v){return arguments.length>1?(v==null?u.delete(p):u.set(p,_(v)),i):u.get(p)},find:function(){var p=Array.prototype.slice.call(arguments),v=p.shift()||0,y=(t>1?p.shift():null)||0,x=(t>2?p.shift():null)||0,S=p.shift()||1/0,T=0,w=n.length,E,M,b,C,I,U;for(S*=S,T=0;T<w;++T)I=n[T],E=v-I.x,M=y-(I.y||0),b=x-(I.z||0),C=E*E+M*M+b*b,C<S&&(U=I,S=C);return U},on:function(p,v){return arguments.length>1?(h.on(p,v),i):h.on(p)}}}function c5(){var n,e,t,i,r,s=wo(-30),o,a=1,l=1/0,u=.81;function c(m){var g,_=n.length,p=(e===1?tR(n,mS):e===2?Cg(n,mS,gR):e===3?oR(n,mS,gR,s5):null).visitAfter(d);for(r=m,g=0;g<_;++g)t=n[g],p.visit(f)}function h(){if(n){var m,g=n.length,_;for(o=new Array(g),m=0;m<g;++m)_=n[m],o[_.index]=+s(_,m,n)}}function d(m){var g=0,_,p,v=0,y,x,S,T,w=m.length;if(w){for(y=x=S=T=0;T<w;++T)(_=m[T])&&(p=Math.abs(_.value))&&(g+=_.value,v+=p,y+=p*(_.x||0),x+=p*(_.y||0),S+=p*(_.z||0));g*=Math.sqrt(4/w),m.x=y/v,e>1&&(m.y=x/v),e>2&&(m.z=S/v)}else{_=m,_.x=_.data.x,e>1&&(_.y=_.data.y),e>2&&(_.z=_.data.z);do g+=o[_.data.index];while(_=_.next)}m.value=g}function f(m,g,_,p,v){if(!m.value)return!0;var y=[_,p,v][e-1],x=m.x-t.x,S=e>1?m.y-t.y:0,T=e>2?m.z-t.z:0,w=y-g,E=x*x+S*S+T*T;if(w*w/u<E)return E<l&&(x===0&&(x=Mo(i),E+=x*x),e>1&&S===0&&(S=Mo(i),E+=S*S),e>2&&T===0&&(T=Mo(i),E+=T*T),E<a&&(E=Math.sqrt(a*E)),t.vx+=x*m.value*r/E,e>1&&(t.vy+=S*m.value*r/E),e>2&&(t.vz+=T*m.value*r/E)),!0;if(m.length||E>=l)return;(m.data!==t||m.next)&&(x===0&&(x=Mo(i),E+=x*x),e>1&&S===0&&(S=Mo(i),E+=S*S),e>2&&T===0&&(T=Mo(i),E+=T*T),E<a&&(E=Math.sqrt(a*E)));do m.data!==t&&(w=o[m.data.index]*r/E,t.vx+=x*w,e>1&&(t.vy+=S*w),e>2&&(t.vz+=T*w));while(m=m.next)}return c.initialize=function(m,...g){n=m,i=g.find(_=>typeof _=="function")||Math.random,e=g.find(_=>[1,2,3].includes(_))||2,h()},c.strength=function(m){return arguments.length?(s=typeof m=="function"?m:wo(+m),h(),c):s},c.distanceMin=function(m){return arguments.length?(a=m*m,c):Math.sqrt(a)},c.distanceMax=function(m){return arguments.length?(l=m*m,c):Math.sqrt(l)},c.theta=function(m){return arguments.length?(u=m*m,c):Math.sqrt(u)},c}function h5(n,e,t,i){var r,s,o=wo(.1),a,l;typeof n!="function"&&(n=wo(+n)),e==null&&(e=0),t==null&&(t=0),i==null&&(i=0);function u(h){for(var d=0,f=r.length;d<f;++d){var m=r[d],g=m.x-e||1e-6,_=(m.y||0)-t||1e-6,p=(m.z||0)-i||1e-6,v=Math.sqrt(g*g+_*_+p*p),y=(l[d]-v)*a[d]*h/v;m.vx+=g*y,s>1&&(m.vy+=_*y),s>2&&(m.vz+=p*y)}}function c(){if(r){var h,d=r.length;for(a=new Array(d),l=new Array(d),h=0;h<d;++h)l[h]=+n(r[h],h,r),a[h]=isNaN(l[h])?0:+o(r[h],h,r)}}return u.initialize=function(h,...d){r=h,s=d.find(f=>[1,2,3].includes(f))||2,c()},u.strength=function(h){return arguments.length?(o=typeof h=="function"?h:wo(+h),c(),u):o},u.radius=function(h){return arguments.length?(n=typeof h=="function"?h:wo(+h),c(),u):n},u.x=function(h){return arguments.length?(e=+h,u):e},u.y=function(h){return arguments.length?(t=+h,u):t},u.z=function(h){return arguments.length?(i=+h,u):i},u}var gS=function(e){f5(e);var t=d5(e);return e.on=t.on,e.off=t.off,e.fire=t.fire,e};function d5(n){var e=Object.create(null);return{on:function(t,i,r){if(typeof i!="function")throw new Error("callback is expected to be a function");var s=e[t];return s||(s=e[t]=[]),s.push({callback:i,ctx:r}),n},off:function(t,i){var r=typeof t>"u";if(r)return e=Object.create(null),n;if(e[t]){var s=typeof i!="function";if(s)delete e[t];else for(var o=e[t],a=0;a<o.length;++a)o[a].callback===i&&o.splice(a,1)}return n},fire:function(t){var i=e[t];if(!i)return n;var r;arguments.length>1&&(r=Array.prototype.splice.call(arguments,1));for(var s=0;s<i.length;++s){var o=i[s];o.callback.apply(o.ctx,r)}return n}}}function f5(n){if(!n)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],t=0;t<e.length;++t)if(n.hasOwnProperty(e[t]))throw new Error("Subject cannot be eventified, since it already has property '"+e[t]+"'")}var p5=g5,m5=gS;function g5(n){if(n=n||{},"uniqueLinkId"in n&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n",`
`,`Note: there is also change in default behavior: From now on each graph
is considered to be not a multigraph by default (each edge is unique).`),n.multigraph=n.uniqueLinkId),n.multigraph===void 0&&(n.multigraph=!1),typeof Map!="function")throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var e=new Map,t=new Map,i={},r=0,s=n.multigraph?x:y,o=[],a=F,l=F,u=F,c=F,h={version:20,addNode:g,addLink:v,removeLink:E,removeNode:p,getNode:_,getNodeCount:S,getLinkCount:T,getEdgeCount:T,getLinksCount:T,getNodesCount:S,getLinks:w,forEachNode:J,forEachLinkedNode:U,forEachLink:I,beginUpdate:u,endUpdate:c,clear:C,hasLink:b,hasNode:_,getLink:b};return m5(h),d(),h;function d(){var H=h.on;h.on=K;function K(){return h.beginUpdate=u=Q,h.endUpdate=c=B,a=f,l=m,h.on=H,H.apply(h,arguments)}}function f(H,K){o.push({link:H,changeType:K})}function m(H,K){o.push({node:H,changeType:K})}function g(H,K){if(H===void 0)throw new Error("Invalid node identifier");u();var le=_(H);return le?(le.data=K,l(le,"update")):(le=new _5(H,K),l(le,"add")),e.set(H,le),c(),le}function _(H){return e.get(H)}function p(H){var K=_(H);if(!K)return!1;u();var le=K.links;return le&&(le.forEach(M),K.links=null),e.delete(H),l(K,"remove"),c(),!0}function v(H,K,le){u();var Pe=_(H)||g(H),O=_(K)||g(K),j=s(H,K,le),ae=t.has(j.id);return t.set(j.id,j),_R(Pe,j),H!==K&&_R(O,j),a(j,ae?"update":"add"),c(),j}function y(H,K,le){var Pe=Ig(H,K),O=t.get(Pe);return O?(O.data=le,O):new vR(H,K,le,Pe)}function x(H,K,le){var Pe=Ig(H,K),O=i.hasOwnProperty(Pe);if(O||b(H,K)){O||(i[Pe]=0);var j="@"+ ++i[Pe];Pe=Ig(H+j,K+j)}return new vR(H,K,le,Pe)}function S(){return e.size}function T(){return t.size}function w(H){var K=_(H);return K?K.links:null}function E(H,K){return K!==void 0&&(H=b(H,K)),M(H)}function M(H){if(!H||!t.get(H.id))return!1;u(),t.delete(H.id);var K=_(H.fromId),le=_(H.toId);return K&&K.links.delete(H),le&&le.links.delete(H),a(H,"remove"),c(),!0}function b(H,K){if(!(H===void 0||K===void 0))return t.get(Ig(H,K))}function C(){u(),J(function(H){p(H.id)}),c()}function I(H){if(typeof H=="function")for(var K=t.values(),le=K.next();!le.done;){if(H(le.value))return!0;le=K.next()}}function U(H,K,le){var Pe=_(H);if(Pe&&Pe.links&&typeof K=="function")return le?L(Pe.links,H,K):D(Pe.links,H,K)}function D(H,K,le){for(var Pe,O=H.values(),j=O.next();!j.done;){var ae=j.value,re=ae.fromId===K?ae.toId:ae.fromId;if(Pe=le(e.get(re),ae),Pe)return!0;j=O.next()}}function L(H,K,le){for(var Pe,O=H.values(),j=O.next();!j.done;){var ae=j.value;if(ae.fromId===K&&(Pe=le(e.get(ae.toId),ae),Pe))return!0;j=O.next()}}function F(){}function Q(){r+=1}function B(){r-=1,r===0&&o.length>0&&(h.fire("changed",o),o.length=0)}function J(H){if(typeof H!="function")throw new Error("Function is expected to iterate over graph nodes. You passed "+H);for(var K=e.values(),le=K.next();!le.done;){if(H(le.value))return!0;le=K.next()}}}function _5(n,e){this.id=n,this.links=null,this.data=e}function _R(n,e){n.links?n.links.add(e):n.links=new Set([e])}function vR(n,e,t,i){this.fromId=n,this.toId=e,this.data=t,this.id=i}function Ig(n,e){return n.toString()+" "+e.toString()}const v5=S0(p5);var _S={exports:{}},of={exports:{}},yR=function(e){return e===0?"x":e===1?"y":e===2?"z":"c"+(e+1)};const y5=yR;var Bc=function(e){return t;function t(i,r){let s=r&&r.indent||0,o=r&&r.join!==void 0?r.join:`
`,a=Array(s+1).join(" "),l=[];for(let u=0;u<e;++u){let c=y5(u),h=u===0?"":a;l.push(h+i.replace(/{var}/g,c))}return l.join(o)}};const xR=Bc;of.exports=x5,of.exports.generateCreateBodyFunctionBody=SR,of.exports.getVectorCode=bR,of.exports.getBodyCode=TR;function x5(n,e){let t=SR(n,e),{Body:i}=new Function(t)();return i}function SR(n,e){return`
${bR(n,e)}
${TR(n)}
return {Body: Body, Vector: Vector};
`}function TR(n){let e=xR(n),t=e("{var}",{join:", "});return`
function Body(${t}) {
  this.isPinned = false;
  this.pos = new Vector(${t});
  this.force = new Vector();
  this.velocity = new Vector();
  this.mass = 1;

  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.reset = function() {
  this.force.reset();
  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.setPosition = function (${t}) {
  ${e("this.pos.{var} = {var} || 0;",{indent:2})}
};`}function bR(n,e){let t=xR(n),i="";return e&&(i=`${t(`
   var v{var};
Object.defineProperty(this, '{var}', {
  set: function(v) { 
    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');
    v{var} = v; 
  },
  get: function() { return v{var}; }
});`)}`),`function Vector(${t("{var}",{join:", "})}) {
  ${i}
    if (typeof arguments[0] === 'object') {
      // could be another vector
      let v = arguments[0];
      ${t('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4})}
      ${t("this.{var} = v.{var};",{indent:4})}
    } else {
      ${t('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4})}
    }
  }
  
  Vector.prototype.reset = function () {
    ${t("this.{var} = ",{join:""})}0;
  };`}var S5=of.exports,Ra={exports:{}};const vS=Bc,Na=yR;Ra.exports=T5,Ra.exports.generateQuadTreeFunctionBody=wR,Ra.exports.getInsertStackCode=RR,Ra.exports.getQuadNodeCode=CR,Ra.exports.isSamePosition=MR,Ra.exports.getChildBodyCode=AR,Ra.exports.setChildBodyCode=ER;function T5(n){let e=wR(n);return new Function(e)()}function wR(n){let e=vS(n),t=Math.pow(2,n);return`
${RR()}
${CR(n)}
${MR(n)}
${AR(n)}
${ER(n)}

function createQuadTree(options, random) {
  options = options || {};
  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;
  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;

  var gravity = options.gravity;
  var updateQueue = [];
  var insertStack = new InsertStack();
  var theta = options.theta;

  var nodesCache = [];
  var currentInCache = 0;
  var root = newNode();

  return {
    insertBodies: insertBodies,

    /**
     * Gets root node if it is present
     */
    getRoot: function() {
      return root;
    },

    updateBodyForce: update,

    options: function(newOptions) {
      if (newOptions) {
        if (typeof newOptions.gravity === 'number') {
          gravity = newOptions.gravity;
        }
        if (typeof newOptions.theta === 'number') {
          theta = newOptions.theta;
        }

        return this;
      }

      return {
        gravity: gravity,
        theta: theta
      };
    }
  };

  function newNode() {
    // To avoid pressure on GC we reuse nodes.
    var node = nodesCache[currentInCache];
    if (node) {
${o("      node.")}
      node.body = null;
      node.mass = ${e("node.mass_{var} = ",{join:""})}0;
      ${e("node.min_{var} = node.max_{var} = ",{join:""})}0;
    } else {
      node = new QuadNode();
      nodesCache[currentInCache] = node;
    }

    ++currentInCache;
    return node;
  }

  function update(sourceBody) {
    var queue = updateQueue;
    var v;
    ${e("var d{var};",{indent:4})}
    var r; 
    ${e("var f{var} = 0;",{indent:4})}
    var queueLength = 1;
    var shiftIdx = 0;
    var pushIdx = 1;

    queue[0] = root;

    while (queueLength) {
      var node = queue[shiftIdx];
      var body = node.body;

      queueLength -= 1;
      shiftIdx += 1;
      var differentBody = (body !== sourceBody);
      if (body && differentBody) {
        // If the current node is a leaf node (and it is not source body),
        // calculate the force exerted by the current node on body, and add this
        // amount to body's net force.
        ${e("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Poor man's protection against zero distance.
          ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
        }

        // This is standard gravitation force calculation but we divide
        // by r^3 to save two operations when normalizing force vector.
        v = gravity * body.mass * sourceBody.mass / (r * r * r);
        ${e("f{var} += v * d{var};",{indent:8})}
      } else if (differentBody) {
        // Otherwise, calculate the ratio s / r,  where s is the width of the region
        // represented by the internal node, and r is the distance between the body
        // and the node's center-of-mass
        ${e("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Sorry about code duplication. I don't want to create many functions
          // right away. Just want to see performance first.
          ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
        }
        // If s / r < , treat this internal node as a single body, and calculate the
        // force it exerts on sourceBody, and add this amount to sourceBody's net force.
        if ((node.max_${Na(0)} - node.min_${Na(0)}) / r < theta) {
          // in the if statement above we consider node's width only
          // because the region was made into square during tree creation.
          // Thus there is no difference between using width or height.
          v = gravity * node.mass * sourceBody.mass / (r * r * r);
          ${e("f{var} += v * d{var};",{indent:10})}
        } else {
          // Otherwise, run the procedure recursively on each of the current node's children.

          // I intentionally unfolded this loop, to save several CPU cycles.
${s()}
        }
      }
    }

    ${e("sourceBody.force.{var} += f{var};",{indent:4})}
  }

  function insertBodies(bodies) {
    ${e("var {var}min = Number.MAX_VALUE;",{indent:4})}
    ${e("var {var}max = Number.MIN_VALUE;",{indent:4})}
    var i = bodies.length;

    // To reduce quad tree depth we are looking for exact bounding box of all particles.
    while (i--) {
      var pos = bodies[i].pos;
      ${e("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6})}
      ${e("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6})}
    }

    // Makes the bounds square.
    var maxSideLength = -Infinity;
    ${e("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4})}

    currentInCache = 0;
    root = newNode();
    ${e("root.min_{var} = {var}min;",{indent:4})}
    ${e("root.max_{var} = {var}min + maxSideLength;",{indent:4})}

    i = bodies.length - 1;
    if (i >= 0) {
      root.body = bodies[i];
    }
    while (i--) {
      insert(bodies[i], root);
    }
  }

  function insert(newBody) {
    insertStack.reset();
    insertStack.push(root, newBody);

    while (!insertStack.isEmpty()) {
      var stackItem = insertStack.pop();
      var node = stackItem.node;
      var body = stackItem.body;

      if (!node.body) {
        // This is internal node. Update the total mass of the node and center-of-mass.
        ${e("var {var} = body.pos.{var};",{indent:8})}
        node.mass += body.mass;
        ${e("node.mass_{var} += body.mass * {var};",{indent:8})}

        // Recursively insert the body in the appropriate quadrant.
        // But first find the appropriate quadrant.
        var quadIdx = 0; // Assume we are in the 0's quad.
        ${e("var min_{var} = node.min_{var};",{indent:8})}
        ${e("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8})}

${r(8)}

        var child = getChild(node, quadIdx);

        if (!child) {
          // The node is internal but this quadrant is not taken. Add
          // subnode to it.
          child = newNode();
          ${e("child.min_{var} = min_{var};",{indent:10})}
          ${e("child.max_{var} = max_{var};",{indent:10})}
          child.body = body;

          setChild(node, quadIdx, child);
        } else {
          // continue searching in this quadrant.
          insertStack.push(child, body);
        }
      } else {
        // We are trying to add to the leaf node.
        // We have to convert current leaf into internal node
        // and continue adding two nodes.
        var oldBody = node.body;
        node.body = null; // internal nodes do not cary bodies

        if (isSamePosition(oldBody.pos, body.pos)) {
          // Prevent infinite subdivision by bumping one node
          // anywhere in this quadrant
          var retriesCount = 3;
          do {
            var offset = random.nextDouble();
            ${e("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12})}

            ${e("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12})}
            retriesCount -= 1;
            // Make sure we don't bump it out of the box. If we do, next iteration should fix it
          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));

          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {
            // This is very bad, we ran out of precision.
            // if we do not return from the method we'll get into
            // infinite loop here. So we sacrifice correctness of layout, and keep the app running
            // Next layout iteration should get larger bounding box in the first step and fix this
            return;
          }
        }
        // Next iteration should subdivide node further.
        insertStack.push(node, oldBody);
        insertStack.push(node, body);
      }
    }
  }
}
return createQuadTree;

`;function r(a){let l=[],u=Array(a+1).join(" ");for(let c=0;c<n;++c)l.push(u+`if (${Na(c)} > max_${Na(c)}) {`),l.push(u+`  quadIdx = quadIdx + ${Math.pow(2,c)};`),l.push(u+`  min_${Na(c)} = max_${Na(c)};`),l.push(u+`  max_${Na(c)} = node.max_${Na(c)};`),l.push(u+"}");return l.join(`
`)}function s(){let a=Array(11).join(" "),l=[];for(let u=0;u<t;++u)l.push(a+`if (node.quad${u}) {`),l.push(a+`  queue[pushIdx] = node.quad${u};`),l.push(a+"  queueLength += 1;"),l.push(a+"  pushIdx += 1;"),l.push(a+"}");return l.join(`
`)}function o(a){let l=[];for(let u=0;u<t;++u)l.push(`${a}quad${u} = null;`);return l.join(`
`)}}function MR(n){let e=vS(n);return`
  function isSamePosition(point1, point2) {
    ${e("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2})}
  
    return ${e("d{var} < 1e-8",{join:" && "})};
  }  
`}function ER(n){var e=Math.pow(2,n);return`
function setChild(node, idx, child) {
  ${t()}
}`;function t(){let i=[];for(let r=0;r<e;++r){let s=r===0?"  ":"  else ";i.push(`${s}if (idx === ${r}) node.quad${r} = child;`)}return i.join(`
`)}}function AR(n){return`function getChild(node, idx) {
${e()}
  return null;
}`;function e(){let t=[],i=Math.pow(2,n);for(let r=0;r<i;++r)t.push(`  if (idx === ${r}) return node.quad${r};`);return t.join(`
`)}}function CR(n){let e=vS(n),t=Math.pow(2,n);var i=`
function QuadNode() {
  // body stored inside this node. In quad tree only leaf nodes (by construction)
  // contain bodies:
  this.body = null;

  // Child nodes are stored in quads. Each quad is presented by number:
  // 0 | 1
  // -----
  // 2 | 3
${r("  this.")}

  // Total mass of current node
  this.mass = 0;

  // Center of mass coordinates
  ${e("this.mass_{var} = 0;",{indent:2})}

  // bounding box coordinates
  ${e("this.min_{var} = 0;",{indent:2})}
  ${e("this.max_{var} = 0;",{indent:2})}
}
`;return i;function r(s){let o=[];for(let a=0;a<t;++a)o.push(`${s}quad${a} = null;`);return o.join(`
`)}}function RR(){return`
/**
 * Our implementation of QuadTree is non-recursive to avoid GC hit
 * This data structure represent stack of elements
 * which we are trying to insert into quad tree.
 */
function InsertStack () {
    this.stack = [];
    this.popIdx = 0;
}

InsertStack.prototype = {
    isEmpty: function() {
        return this.popIdx === 0;
    },
    push: function (node, body) {
        var item = this.stack[this.popIdx];
        if (!item) {
            // we are trying to avoid memory pressure: create new element
            // only when absolutely necessary
            this.stack[this.popIdx] = new InsertStackElement(node, body);
        } else {
            item.node = node;
            item.body = body;
        }
        ++this.popIdx;
    },
    pop: function () {
        if (this.popIdx > 0) {
            return this.stack[--this.popIdx];
        }
    },
    reset: function () {
        this.popIdx = 0;
    }
};

function InsertStackElement(node, body) {
    this.node = node; // QuadTree node
    this.body = body; // physical body which needs to be inserted to node
}
`}var b5=Ra.exports,yS={exports:{}};yS.exports=M5,yS.exports.generateFunctionBody=NR;const w5=Bc;function M5(n){let e=NR(n);return new Function("bodies","settings","random",e)}function NR(n){let e=w5(n);return`
  var boundingBox = {
    ${e("min_{var}: 0, max_{var}: 0,",{indent:4})}
  };

  return {
    box: boundingBox,

    update: updateBoundingBox,

    reset: resetBoundingBox,

    getBestNewPosition: function (neighbors) {
      var ${e("base_{var} = 0",{join:", "})};

      if (neighbors.length) {
        for (var i = 0; i < neighbors.length; ++i) {
          let neighborPos = neighbors[i].pos;
          ${e("base_{var} += neighborPos.{var};",{indent:10})}
        }

        ${e("base_{var} /= neighbors.length;",{indent:8})}
      } else {
        ${e("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8})}
      }

      var springLength = settings.springLength;
      return {
        ${e("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8})}
      };
    }
  };

  function updateBoundingBox() {
    var i = bodies.length;
    if (i === 0) return; // No bodies - no borders.

    ${e("var max_{var} = -Infinity;",{indent:4})}
    ${e("var min_{var} = Infinity;",{indent:4})}

    while(i--) {
      // this is O(n), it could be done faster with quadtree, if we check the root node bounds
      var bodyPos = bodies[i].pos;
      ${e("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6})}
      ${e("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6})}
    }

    ${e("boundingBox.min_{var} = min_{var};",{indent:4})}
    ${e("boundingBox.max_{var} = max_{var};",{indent:4})}
  }

  function resetBoundingBox() {
    ${e("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4})}
  }
`}var E5=yS.exports,xS={exports:{}};const A5=Bc;xS.exports=C5,xS.exports.generateCreateDragForceFunctionBody=PR;function C5(n){let e=PR(n);return new Function("options",e)}function PR(n){return`
  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');

  return {
    update: function(body) {
      ${A5(n)("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6})}
    }
  };
`}var R5=xS.exports,SS={exports:{}};const N5=Bc;SS.exports=P5,SS.exports.generateCreateSpringForceFunctionBody=DR;function P5(n){let e=DR(n);return new Function("options","random",e)}function DR(n){let e=N5(n);return`
  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');
  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');

  return {
    /**
     * Updates forces acting on a spring
     */
    update: function (spring) {
      var body1 = spring.from;
      var body2 = spring.to;
      var length = spring.length < 0 ? options.springLength : spring.length;
      ${e("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6})}
      var r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

      if (r === 0) {
        ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
      }

      var d = r - length;
      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;

      ${e("body1.force.{var} += coefficient * d{var}",{indent:6})};
      body1.springCount += 1;
      body1.springLength += r;

      ${e("body2.force.{var} -= coefficient * d{var}",{indent:6})};
      body2.springCount += 1;
      body2.springLength += r;
    }
  };
`}var D5=SS.exports,TS={exports:{}};const L5=Bc;TS.exports=I5,TS.exports.generateIntegratorFunctionBody=LR;function I5(n){let e=LR(n);return new Function("bodies","timeStep","adaptiveTimeStepWeight",e)}function LR(n){let e=L5(n);return`
  var length = bodies.length;
  if (length === 0) return 0;

  ${e("var d{var} = 0, t{var} = 0;",{indent:2})}

  for (var i = 0; i < length; ++i) {
    var body = bodies[i];
    if (body.isPinned) continue;

    if (adaptiveTimeStepWeight && body.springCount) {
      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);
    }

    var coeff = timeStep / body.mass;

    ${e("body.velocity.{var} += coeff * body.force.{var};",{indent:4})}
    ${e("var v{var} = body.velocity.{var};",{indent:4})}
    var v = Math.sqrt(${e("v{var} * v{var}",{join:" + "})});

    if (v > 1) {
      // We normalize it so that we move within timeStep range. 
      // for the case when v <= 1 - we let velocity to fade out.
      ${e("body.velocity.{var} = v{var} / v;",{indent:6})}
    }

    ${e("d{var} = timeStep * body.velocity.{var};",{indent:4})}

    ${e("body.pos.{var} += d{var};",{indent:4})}

    ${e("t{var} += Math.abs(d{var});",{indent:4})}
  }

  return (${e("t{var} * t{var}",{join:" + "})})/length;
`}var U5=TS.exports,bS,IR;function F5(){if(IR)return bS;IR=1,bS=n;function n(e,t,i,r){this.from=e,this.to=t,this.length=i,this.coefficient=r}return bS}var wS,UR;function O5(){if(UR)return wS;UR=1,wS=n;function n(e,t){var i;if(e||(e={}),t){for(i in t)if(t.hasOwnProperty(i)){var r=e.hasOwnProperty(i),s=typeof t[i],o=!r||typeof e[i]!==s;o?e[i]=t[i]:s==="object"&&(e[i]=n(e[i],t[i]))}}return e}return wS}var af={exports:{}},FR;function B5(){if(FR)return af.exports;FR=1,af.exports=n,af.exports.random=n,af.exports.randomIterator=a;function n(l){var u=typeof l=="number"?l:+new Date;return new e(u)}function e(l){this.seed=l}e.prototype.next=o,e.prototype.nextDouble=s,e.prototype.uniform=s,e.prototype.gaussian=t;function t(){var l,u,c;do u=this.nextDouble()*2-1,c=this.nextDouble()*2-1,l=u*u+c*c;while(l>=1||l===0);return u*Math.sqrt(-2*Math.log(l)/l)}e.prototype.levy=i;function i(){var l=1.5,u=Math.pow(r(1+l)*Math.sin(Math.PI*l/2)/(r((1+l)/2)*l*Math.pow(2,(l-1)/2)),1/l);return this.gaussian()*u/Math.pow(Math.abs(this.gaussian()),1/l)}function r(l){return Math.sqrt(2*Math.PI/l)*Math.pow(1/Math.E*(l+1/(12*l-1/(10*l))),l)}function s(){var l=this.seed;return l=l+2127912214+(l<<12)&4294967295,l=(l^3345072700^l>>>19)&4294967295,l=l+374761393+(l<<5)&4294967295,l=(l+3550635116^l<<9)&4294967295,l=l+4251993797+(l<<3)&4294967295,l=(l^3042594569^l>>>16)&4294967295,this.seed=l,(l&268435455)/268435456}function o(l){return Math.floor(this.nextDouble()*l)}function a(l,u){var c=u||n();if(typeof c.next!="function")throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:d,shuffle:h};function h(){var f,m,g;for(f=l.length-1;f>0;--f)m=c.next(f+1),g=l[m],l[m]=l[f],l[f]=g;return l}function d(f){var m,g,_;for(m=l.length-1;m>0;--m)g=c.next(m+1),_=l[g],l[g]=l[m],l[m]=_,f(_);l.length&&f(l[0])}}return af.exports}var OR=$5,k5=S5,z5=b5,G5=E5,V5=R5,H5=D5,W5=U5,BR={};function $5(n){var e=F5(),t=O5(),i=gS;if(n){if(n.springCoeff!==void 0)throw new Error("springCoeff was renamed to springCoefficient");if(n.dragCoeff!==void 0)throw new Error("dragCoeff was renamed to dragCoefficient")}n=t(n,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1});var r=BR[n.dimensions];if(!r){var s=n.dimensions;r={Body:k5(s,n.debug),createQuadTree:z5(s),createBounds:G5(s),createDragForce:V5(s),createSpringForce:H5(s),integrate:W5(s)},BR[s]=r}var o=r.Body,a=r.createQuadTree,l=r.createBounds,u=r.createDragForce,c=r.createSpringForce,h=r.integrate,d=L=>new o(L),f=B5().random(42),m=[],g=[],_=a(n,f),p=l(m,n,f),v=c(n,f),y=u(n),x=0,S=[],T=new Map,w=0;b("nbody",U),b("spring",D);var E={bodies:m,quadTree:_,springs:g,settings:n,addForce:b,removeForce:C,getForces:I,step:function(){for(var L=0;L<S.length;++L)S[L](w);var F=h(m,n.timeStep,n.adaptiveTimeStepWeight);return w+=1,F},addBody:function(L){if(!L)throw new Error("Body is required");return m.push(L),L},addBodyAt:function(L){if(!L)throw new Error("Body position is required");var F=d(L);return m.push(F),F},removeBody:function(L){if(L){var F=m.indexOf(L);if(!(F<0))return m.splice(F,1),m.length===0&&p.reset(),!0}},addSpring:function(L,F,Q,B){if(!L||!F)throw new Error("Cannot add null spring to force simulator");typeof Q!="number"&&(Q=-1);var J=new e(L,F,Q,B>=0?B:-1);return g.push(J),J},getTotalMovement:function(){return x},removeSpring:function(L){if(L){var F=g.indexOf(L);if(F>-1)return g.splice(F,1),!0}},getBestNewBodyPosition:function(L){return p.getBestNewPosition(L)},getBBox:M,getBoundingBox:M,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function(L){return L!==void 0?(n.gravity=L,_.options({gravity:L}),this):n.gravity},theta:function(L){return L!==void 0?(n.theta=L,_.options({theta:L}),this):n.theta},random:f};return j5(n,E),i(E),E;function M(){return p.update(),p.box}function b(L,F){if(T.has(L))throw new Error("Force "+L+" is already added");T.set(L,F),S.push(F)}function C(L){var F=S.indexOf(T.get(L));F<0||(S.splice(F,1),T.delete(L))}function I(){return T}function U(){if(m.length!==0){_.insertBodies(m);for(var L=m.length;L--;){var F=m[L];F.isPinned||(F.reset(),_.updateBodyForce(F),y.update(F))}}}function D(){for(var L=g.length;L--;)v.update(g[L])}}function j5(n,e){for(var t in n)X5(n,e,t)}function X5(n,e,t){if(n.hasOwnProperty(t)&&typeof e[t]!="function"){var i=Number.isFinite(n[t]);i?e[t]=function(r){if(r!==void 0){if(!Number.isFinite(r))throw new Error("Value of "+t+" should be a valid number.");return n[t]=r,e}return n[t]}:e[t]=function(r){return r!==void 0?(n[t]=r,e):n[t]}}}_S.exports=Y5,_S.exports.simulator=OR;var q5=gS;function Y5(n,e){if(!n)throw new Error("Graph structure cannot be undefined");var t=e&&e.createSimulator||OR,i=t(e);if(Array.isArray(e))throw new Error("Physics settings is expected to be an object");var r=n.version>19?U:I;e&&typeof e.nodeMass=="function"&&(r=e.nodeMass);var s=new Map,o={},a=0,l=i.settings.springTransform||K5;y(),_();var u=!1,c={step:function(){if(a===0)return h(!0),!0;var D=i.step();c.lastMove=D,c.fire("step");var L=D/a,F=L<=.01;return h(F),F},getNodePosition:function(D){return C(D).pos},setNodePosition:function(D){var L=C(D);L.setPosition.apply(L,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(D){var L=o[D];if(L)return{from:L.from.pos,to:L.to.pos}},getGraphRect:function(){return i.getBBox()},forEachBody:d,pinNode:function(D,L){var F=C(D.id);F.isPinned=!!L},isNodePinned:function(D){return C(D.id).isPinned},dispose:function(){n.off("changed",v),c.fire("disposed")},getBody:g,getSpring:m,getForceVectorLength:f,simulator:i,graph:n,lastMove:0};return q5(c),c;function h(D){u!==D&&(u=D,p(D))}function d(D){s.forEach(D)}function f(){var D=0,L=0;return d(function(F){D+=Math.abs(F.force.x),L+=Math.abs(F.force.y)}),Math.sqrt(D*D+L*L)}function m(D,L){var F;if(L===void 0)typeof D!="object"?F=D:F=D.id;else{var Q=n.hasLink(D,L);if(!Q)return;F=Q.id}return o[F]}function g(D){return s.get(D)}function _(){n.on("changed",v)}function p(D){c.fire("stable",D)}function v(D){for(var L=0;L<D.length;++L){var F=D[L];F.changeType==="add"?(F.node&&x(F.node.id),F.link&&T(F.link)):F.changeType==="remove"&&(F.node&&S(F.node),F.link&&w(F.link))}a=n.getNodesCount()}function y(){a=0,n.forEachNode(function(D){x(D.id),a+=1}),n.forEachLink(T)}function x(D){var L=s.get(D);if(!L){var F=n.getNode(D);if(!F)throw new Error("initBody() was called with unknown node id");var Q=F.position;if(!Q){var B=E(F);Q=i.getBestNewBodyPosition(B)}L=i.addBodyAt(Q),L.id=D,s.set(D,L),M(D),b(F)&&(L.isPinned=!0)}}function S(D){var L=D.id,F=s.get(L);F&&(s.delete(L),i.removeBody(F))}function T(D){M(D.fromId),M(D.toId);var L=s.get(D.fromId),F=s.get(D.toId),Q=i.addSpring(L,F,D.length);l(D,Q),o[D.id]=Q}function w(D){var L=o[D.id];if(L){var F=n.getNode(D.fromId),Q=n.getNode(D.toId);F&&M(F.id),Q&&M(Q.id),delete o[D.id],i.removeSpring(L)}}function E(D){var L=[];if(!D.links)return L;for(var F=Math.min(D.links.length,2),Q=0;Q<F;++Q){var B=D.links[Q],J=B.fromId!==D.id?s.get(B.fromId):s.get(B.toId);J&&J.pos&&L.push(J)}return L}function M(D){var L=s.get(D);if(L.mass=r(D),Number.isNaN(L.mass))throw new Error("Node mass should be a number")}function b(D){return D&&(D.isPinned||D.data&&D.data.isPinned)}function C(D){var L=s.get(D);return L||(x(D),L=s.get(D)),L}function I(D){var L=n.getLinks(D);return L?1+L.length/3:1}function U(D){var L=n.getLinks(D);return L?1+L.size/3:1}}function K5(){}var Q5=_S.exports;const Z5=S0(Q5);function MS(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var J5=typeof global=="object"&&global&&global.Object===Object&&global,eH=typeof self=="object"&&self&&self.Object===Object&&self,kR=J5||eH||Function("return this")(),ES=function(){return kR.Date.now()},tH=/\s/;function nH(n){for(var e=n.length;e--&&tH.test(n.charAt(e)););return e}var iH=/^\s+/;function rH(n){return n&&n.slice(0,nH(n)+1).replace(iH,"")}var Ug=kR.Symbol,zR=Object.prototype,sH=zR.hasOwnProperty,oH=zR.toString,lf=Ug?Ug.toStringTag:void 0;function aH(n){var e=sH.call(n,lf),t=n[lf];try{n[lf]=void 0;var i=!0}catch{}var r=oH.call(n);return i&&(e?n[lf]=t:delete n[lf]),r}var lH=Object.prototype,uH=lH.toString;function cH(n){return uH.call(n)}var hH="[object Null]",dH="[object Undefined]",GR=Ug?Ug.toStringTag:void 0;function fH(n){return n==null?n===void 0?dH:hH:GR&&GR in Object(n)?aH(n):cH(n)}function pH(n){return n!=null&&typeof n=="object"}var mH="[object Symbol]";function gH(n){return typeof n=="symbol"||pH(n)&&fH(n)==mH}var VR=NaN,_H=/^[-+]0x[0-9a-f]+$/i,vH=/^0b[01]+$/i,yH=/^0o[0-7]+$/i,xH=parseInt;function HR(n){if(typeof n=="number")return n;if(gH(n))return VR;if(MS(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=MS(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=rH(n);var t=vH.test(n);return t||yH.test(n)?xH(n.slice(2),t?2:8):_H.test(n)?VR:+n}var SH="Expected a function",TH=Math.max,bH=Math.min;function wH(n,e,t){var i,r,s,o,a,l,u=0,c=!1,h=!1,d=!0;if(typeof n!="function")throw new TypeError(SH);e=HR(e)||0,MS(t)&&(c=!!t.leading,h="maxWait"in t,s=h?TH(HR(t.maxWait)||0,e):s,d="trailing"in t?!!t.trailing:d);function f(T){var w=i,E=r;return i=r=void 0,u=T,o=n.apply(E,w),o}function m(T){return u=T,a=setTimeout(p,e),c?f(T):o}function g(T){var w=T-l,E=T-u,M=e-w;return h?bH(M,s-E):M}function _(T){var w=T-l,E=T-u;return l===void 0||w>=e||w<0||h&&E>=s}function p(){var T=ES();if(_(T))return v(T);a=setTimeout(p,g(T))}function v(T){return a=void 0,d&&i?f(T):(i=r=void 0,o)}function y(){a!==void 0&&clearTimeout(a),u=0,i=l=r=a=void 0}function x(){return a===void 0?o:v(ES())}function S(){var T=ES(),w=_(T);if(i=arguments,r=this,l=T,w){if(a===void 0)return m(l);if(h)return clearTimeout(a),a=setTimeout(p,e),f(l)}return a===void 0&&(a=setTimeout(p,e)),o}return S.cancel=y,S.flush=x,S}function WR(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function MH(n){if(Array.isArray(n))return n}function EH(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function AH(n,e,t){return Object.defineProperty(n,"prototype",{writable:!1}),n}function CH(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,r,s,o,a=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(i=s.call(t)).done)&&(a.push(i.value),a.length!==e);l=!0);}catch(c){u=!0,r=c}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(u)throw r}}return a}}function RH(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function NH(n,e){return MH(n)||CH(n,e)||PH(n,e)||RH()}function PH(n,e){if(n){if(typeof n=="string")return WR(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?WR(n,e):void 0}}var DH=AH(function n(e,t){var i=t.default,r=i===void 0?null:i,s=t.triggerUpdate,o=s===void 0?!0:s,a=t.onChange,l=a===void 0?function(u,c){}:a;EH(this,n),this.name=e,this.defaultVal=r,this.triggerUpdate=o,this.onChange=l});function Fg(n){var e=n.stateInit,t=e===void 0?function(){return{}}:e,i=n.props,r=i===void 0?{}:i,s=n.methods,o=s===void 0?{}:s,a=n.aliases,l=a===void 0?{}:a,u=n.init,c=u===void 0?function(){}:u,h=n.update,d=h===void 0?function(){}:h,f=Object.keys(r).map(function(m){return new DH(m,r[m])});return function m(){for(var g=arguments.length,_=new Array(g),p=0;p<g;p++)_[p]=arguments[p];var v=!!(this instanceof m&&this.constructor),y=v?_.shift():void 0,x=_[0],S=x===void 0?{}:x,T=Object.assign({},t instanceof Function?t(S):t,{initialised:!1}),w={};function E(C){return M(C,S),b(),E}var M=function(I,U){c.call(E,I,T,U),T.initialised=!0},b=wH(function(){T.initialised&&(d.call(E,T,w),w={})},1);return f.forEach(function(C){E[C.name]=I(C);function I(U){var D=U.name,L=U.triggerUpdate,F=L===void 0?!1:L,Q=U.onChange,B=Q===void 0?function(K,le){}:Q,J=U.defaultVal,H=J===void 0?null:J;return function(K){var le=T[D];if(!arguments.length)return le;var Pe=K===void 0?H:K;return T[D]=Pe,B.call(E,Pe,T,le),!w.hasOwnProperty(D)&&(w[D]=le),F&&b(),E}}}),Object.keys(o).forEach(function(C){E[C]=function(){for(var I,U=arguments.length,D=new Array(U),L=0;L<U;L++)D[L]=arguments[L];return(I=o[C]).call.apply(I,[E,T].concat(D))}}),Object.entries(l).forEach(function(C){var I=NH(C,2),U=I[0],D=I[1];return E[U]=E[D]}),E.resetProps=function(){return f.forEach(function(C){E[C.name](C.defaultVal)}),E},E.resetProps(),T._rerender=b,v&&y&&E(y),E}}var yt=function(n){return typeof n=="function"?n:typeof n=="string"?function(e){return e[n]}:function(e){return n}};class $R extends Map{constructor(e,t=UH){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),e!=null)for(const[i,r]of e)this.set(i,r)}get(e){return super.get(jR(this,e))}has(e){return super.has(jR(this,e))}set(e,t){return super.set(LH(this,e),t)}delete(e){return super.delete(IH(this,e))}}function jR({_intern:n,_key:e},t){const i=e(t);return n.has(i)?n.get(i):t}function LH({_intern:n,_key:e},t){const i=e(t);return n.has(i)?n.get(i):(n.set(i,t),t)}function IH({_intern:n,_key:e},t){const i=e(t);return n.has(i)&&(t=n.get(i),n.delete(i)),t}function UH(n){return n!==null&&typeof n=="object"?n.valueOf():n}function FH(n,e){let t;if(e===void 0)for(const i of n)i!=null&&(t<i||t===void 0&&i>=i)&&(t=i);else{let i=-1;for(let r of n)(r=e(r,++i,n))!=null&&(t<r||t===void 0&&r>=r)&&(t=r)}return t}function OH(n,e){let t;if(e===void 0)for(const i of n)i!=null&&(t>i||t===void 0&&i>=i)&&(t=i);else{let i=-1;for(let r of n)(r=e(r,++i,n))!=null&&(t>r||t===void 0&&r>=r)&&(t=r)}return t}function AS(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function BH(n){if(Array.isArray(n))return n}function kH(n){if(Array.isArray(n))return AS(n)}function XR(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function zH(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function GH(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function hi(n,e){return n.get(XR(n,e))}function kc(n,e,t){zH(n,e),e.set(n,t)}function Og(n,e,t){return n.set(XR(n,e),t),t}function VH(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,QH(i.key),i)}}function HH(n,e,t){return VH(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function WH(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function $H(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,r,s,o,a=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(i=s.call(t)).done)&&(a.push(i.value),a.length!==e);l=!0);}catch(c){u=!0,r=c}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(u)throw r}}return a}}function jH(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XH(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qH(n,e){return BH(n)||$H(n,e)||qR(n,e)||jH()}function YH(n){return kH(n)||WH(n)||qR(n)||XH()}function KH(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}function QH(n){var e=KH(n,"string");return typeof e=="symbol"?e:e+""}function qR(n,e){if(n){if(typeof n=="string")return AS(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?AS(n,e):void 0}}var zc=new WeakMap,uf=new WeakMap,Gc=new WeakMap,CS=new WeakMap,RS=new WeakMap,NS=new WeakMap,ZH=function(){function n(){GH(this,n),kc(this,zc,new Map),kc(this,uf,new Map),kc(this,Gc,function(e){return e}),kc(this,CS,function(){return{}}),kc(this,RS,function(){}),kc(this,NS,function(){})}return HH(n,[{key:"getObj",value:function(t){return hi(zc,this).get(hi(Gc,this).call(this,t))}},{key:"getData",value:function(t){return hi(uf,this).get(t)}},{key:"entries",value:function(){return YH(hi(uf,this).entries()).map(function(t){var i=qH(t,2),r=i[0],s=i[1];return[s,r]})}},{key:"id",value:function(t){return Og(Gc,this,yt(t)),this}},{key:"onCreateObj",value:function(t){return Og(CS,this,t),this}},{key:"onUpdateObj",value:function(t){return Og(RS,this,t),this}},{key:"onRemoveObj",value:function(t){return Og(NS,this,t),this}},{key:"digest",value:function(t){var i=this;t.filter(function(s){return!hi(zc,i).has(hi(Gc,i).call(i,s))}).forEach(function(s){var o=hi(CS,i).call(i,s);hi(zc,i).set(hi(Gc,i).call(i,s),o),hi(uf,i).set(o,s)});var r=new Map(t.map(function(s){return[hi(Gc,i).call(i,s),s]}));return hi(zc,this).forEach(function(s,o){r.has(o)?hi(RS,i).call(i,s,r.get(o)):(hi(NS,i).call(i,s,o),hi(zc,i).delete(o),hi(uf,i).delete(s))}),this}},{key:"clear",value:function(){return this.digest([]),this}}])}();function JH(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}const YR=Symbol("implicit");function KR(){var n=new $R,e=[],t=[],i=YR;function r(s){let o=n.get(s);if(o===void 0){if(i!==YR)return i;n.set(s,o=e.push(s)-1)}return t[o%t.length]}return r.domain=function(s){if(!arguments.length)return e.slice();e=[],n=new $R;for(const o of s)n.has(o)||n.set(o,e.push(o)-1);return r},r.range=function(s){return arguments.length?(t=Array.from(s),r):t.slice()},r.unknown=function(s){return arguments.length?(i=s,r):i},r.copy=function(){return KR(e,t).unknown(i)},JH.apply(r,arguments),r}function PS(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function QR(n,e){var t=Object.create(n.prototype);for(var i in e)t[i]=e[i];return t}function cf(){}var hf=.7,Bg=1/hf,Vc="\\s*([+-]?\\d+)\\s*",df="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Is="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",e8=/^#([0-9a-f]{3,8})$/,t8=new RegExp(`^rgb\\(${Vc},${Vc},${Vc}\\)$`),n8=new RegExp(`^rgb\\(${Is},${Is},${Is}\\)$`),i8=new RegExp(`^rgba\\(${Vc},${Vc},${Vc},${df}\\)$`),r8=new RegExp(`^rgba\\(${Is},${Is},${Is},${df}\\)$`),s8=new RegExp(`^hsl\\(${df},${Is},${Is}\\)$`),o8=new RegExp(`^hsla\\(${df},${Is},${Is},${df}\\)$`),ZR={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};PS(cf,ff,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:JR,formatHex:JR,formatHex8:a8,formatHsl:l8,formatRgb:eN,toString:eN});function JR(){return this.rgb().formatHex()}function a8(){return this.rgb().formatHex8()}function l8(){return sN(this).formatHsl()}function eN(){return this.rgb().formatRgb()}function ff(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=e8.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?tN(e):t===3?new $i(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?kg(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?kg(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=t8.exec(n))?new $i(e[1],e[2],e[3],1):(e=n8.exec(n))?new $i(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=i8.exec(n))?kg(e[1],e[2],e[3],e[4]):(e=r8.exec(n))?kg(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=s8.exec(n))?rN(e[1],e[2]/100,e[3]/100,1):(e=o8.exec(n))?rN(e[1],e[2]/100,e[3]/100,e[4]):ZR.hasOwnProperty(n)?tN(ZR[n]):n==="transparent"?new $i(NaN,NaN,NaN,0):null}function tN(n){return new $i(n>>16&255,n>>8&255,n&255,1)}function kg(n,e,t,i){return i<=0&&(n=e=t=NaN),new $i(n,e,t,i)}function u8(n){return n instanceof cf||(n=ff(n)),n?(n=n.rgb(),new $i(n.r,n.g,n.b,n.opacity)):new $i}function DS(n,e,t,i){return arguments.length===1?u8(n):new $i(n,e,t,i??1)}function $i(n,e,t,i){this.r=+n,this.g=+e,this.b=+t,this.opacity=+i}PS($i,DS,QR(cf,{brighter(n){return n=n==null?Bg:Math.pow(Bg,n),new $i(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?hf:Math.pow(hf,n),new $i(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new $i(Fl(this.r),Fl(this.g),Fl(this.b),zg(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:nN,formatHex:nN,formatHex8:c8,formatRgb:iN,toString:iN}));function nN(){return`#${Ol(this.r)}${Ol(this.g)}${Ol(this.b)}`}function c8(){return`#${Ol(this.r)}${Ol(this.g)}${Ol(this.b)}${Ol((isNaN(this.opacity)?1:this.opacity)*255)}`}function iN(){const n=zg(this.opacity);return`${n===1?"rgb(":"rgba("}${Fl(this.r)}, ${Fl(this.g)}, ${Fl(this.b)}${n===1?")":`, ${n})`}`}function zg(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Fl(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function Ol(n){return n=Fl(n),(n<16?"0":"")+n.toString(16)}function rN(n,e,t,i){return i<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new cs(n,e,t,i)}function sN(n){if(n instanceof cs)return new cs(n.h,n.s,n.l,n.opacity);if(n instanceof cf||(n=ff(n)),!n)return new cs;if(n instanceof cs)return n;n=n.rgb();var e=n.r/255,t=n.g/255,i=n.b/255,r=Math.min(e,t,i),s=Math.max(e,t,i),o=NaN,a=s-r,l=(s+r)/2;return a?(e===s?o=(t-i)/a+(t<i)*6:t===s?o=(i-e)/a+2:o=(e-t)/a+4,a/=l<.5?s+r:2-s-r,o*=60):a=l>0&&l<1?0:o,new cs(o,a,l,n.opacity)}function h8(n,e,t,i){return arguments.length===1?sN(n):new cs(n,e,t,i??1)}function cs(n,e,t,i){this.h=+n,this.s=+e,this.l=+t,this.opacity=+i}PS(cs,h8,QR(cf,{brighter(n){return n=n==null?Bg:Math.pow(Bg,n),new cs(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?hf:Math.pow(hf,n),new cs(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,i=t+(t<.5?t:1-t)*e,r=2*t-i;return new $i(LS(n>=240?n-240:n+120,r,i),LS(n,r,i),LS(n<120?n+240:n-120,r,i),this.opacity)},clamp(){return new cs(oN(this.h),Gg(this.s),Gg(this.l),zg(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=zg(this.opacity);return`${n===1?"hsl(":"hsla("}${oN(this.h)}, ${Gg(this.s)*100}%, ${Gg(this.l)*100}%${n===1?")":`, ${n})`}`}}));function oN(n){return n=(n||0)%360,n<0?n+360:n}function Gg(n){return Math.max(0,Math.min(1,n||0))}function LS(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}const aN=n=>()=>n;function d8(n,e){return function(t){return n+t*e}}function f8(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(i){return Math.pow(n+i*e,t)}}function p8(n){return(n=+n)==1?lN:function(e,t){return t-e?f8(e,t,n):aN(isNaN(e)?t:e)}}function lN(n,e){var t=e-n;return t?d8(n,t):aN(isNaN(n)?e:n)}const uN=function n(e){var t=p8(e);function i(r,s){var o=t((r=DS(r)).r,(s=DS(s)).r),a=t(r.g,s.g),l=t(r.b,s.b),u=lN(r.opacity,s.opacity);return function(c){return r.r=o(c),r.g=a(c),r.b=l(c),r.opacity=u(c),r+""}}return i.gamma=n,i}(1);function Pa(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}var IS=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,US=new RegExp(IS.source,"g");function m8(n){return function(){return n}}function g8(n){return function(e){return n(e)+""}}function _8(n,e){var t=IS.lastIndex=US.lastIndex=0,i,r,s,o=-1,a=[],l=[];for(n=n+"",e=e+"";(i=IS.exec(n))&&(r=US.exec(e));)(s=r.index)>t&&(s=e.slice(t,s),a[o]?a[o]+=s:a[++o]=s),(i=i[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,l.push({i:o,x:Pa(i,r)})),t=US.lastIndex;return t<e.length&&(s=e.slice(t),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?g8(l[0].x):m8(e):(e=l.length,function(u){for(var c=0,h;c<e;++c)a[(h=l[c]).i]=h.x(u);return a.join("")})}var cN=180/Math.PI,FS={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function hN(n,e,t,i,r,s){var o,a,l;return(o=Math.sqrt(n*n+e*e))&&(n/=o,e/=o),(l=n*t+e*i)&&(t-=n*l,i-=e*l),(a=Math.sqrt(t*t+i*i))&&(t/=a,i/=a,l/=a),n*i<e*t&&(n=-n,e=-e,l=-l,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(e,n)*cN,skewX:Math.atan(l)*cN,scaleX:o,scaleY:a}}var Vg;function v8(n){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return e.isIdentity?FS:hN(e.a,e.b,e.c,e.d,e.e,e.f)}function y8(n){return n==null||(Vg||(Vg=document.createElementNS("http://www.w3.org/2000/svg","g")),Vg.setAttribute("transform",n),!(n=Vg.transform.baseVal.consolidate()))?FS:(n=n.matrix,hN(n.a,n.b,n.c,n.d,n.e,n.f))}function dN(n,e,t,i){function r(u){return u.length?u.pop()+" ":""}function s(u,c,h,d,f,m){if(u!==h||c!==d){var g=f.push("translate(",null,e,null,t);m.push({i:g-4,x:Pa(u,h)},{i:g-2,x:Pa(c,d)})}else(h||d)&&f.push("translate("+h+e+d+t)}function o(u,c,h,d){u!==c?(u-c>180?c+=360:c-u>180&&(u+=360),d.push({i:h.push(r(h)+"rotate(",null,i)-2,x:Pa(u,c)})):c&&h.push(r(h)+"rotate("+c+i)}function a(u,c,h,d){u!==c?d.push({i:h.push(r(h)+"skewX(",null,i)-2,x:Pa(u,c)}):c&&h.push(r(h)+"skewX("+c+i)}function l(u,c,h,d,f,m){if(u!==h||c!==d){var g=f.push(r(f)+"scale(",null,",",null,")");m.push({i:g-4,x:Pa(u,h)},{i:g-2,x:Pa(c,d)})}else(h!==1||d!==1)&&f.push(r(f)+"scale("+h+","+d+")")}return function(u,c){var h=[],d=[];return u=n(u),c=n(c),s(u.translateX,u.translateY,c.translateX,c.translateY,h,d),o(u.rotate,c.rotate,h,d),a(u.skewX,c.skewX,h,d),l(u.scaleX,u.scaleY,c.scaleX,c.scaleY,h,d),u=c=null,function(f){for(var m=-1,g=d.length,_;++m<g;)h[(_=d[m]).i]=_.x(f);return h.join("")}}}var x8=dN(v8,"px, ","px)","deg)"),S8=dN(y8,", ",")",")");function T8(n){for(var e=n.length/6|0,t=new Array(e),i=0;i<e;)t[i]="#"+n.slice(i*6,++i*6);return t}const b8=T8("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");function Hg(n){"@babel/helpers - typeof";return Hg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hg(n)}var w8=/^\s+/,M8=/\s+$/;function Oe(n,e){if(n=n||"",e=e||{},n instanceof Oe)return n;if(!(this instanceof Oe))return new Oe(n,e);var t=E8(n);this._originalInput=n,this._r=t.r,this._g=t.g,this._b=t.b,this._a=t.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||t.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=t.ok}Oe.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},getLuminance:function(){var e=this.toRgb(),t,i,r,s,o,a;return t=e.r/255,i=e.g/255,r=e.b/255,t<=.03928?s=t/12.92:s=Math.pow((t+.055)/1.055,2.4),i<=.03928?o=i/12.92:o=Math.pow((i+.055)/1.055,2.4),r<=.03928?a=r/12.92:a=Math.pow((r+.055)/1.055,2.4),.2126*s+.7152*o+.0722*a},setAlpha:function(e){return this._a=vN(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=pN(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=pN(this._r,this._g,this._b),t=Math.round(e.h*360),i=Math.round(e.s*100),r=Math.round(e.v*100);return this._a==1?"hsv("+t+", "+i+"%, "+r+"%)":"hsva("+t+", "+i+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var e=fN(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=fN(this._r,this._g,this._b),t=Math.round(e.h*360),i=Math.round(e.s*100),r=Math.round(e.l*100);return this._a==1?"hsl("+t+", "+i+"%, "+r+"%)":"hsla("+t+", "+i+"%, "+r+"%, "+this._roundA+")"},toHex:function(e){return mN(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return N8(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(qt(this._r,255)*100)+"%",g:Math.round(qt(this._g,255)*100)+"%",b:Math.round(qt(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(qt(this._r,255)*100)+"%, "+Math.round(qt(this._g,255)*100)+"%, "+Math.round(qt(this._b,255)*100)+"%)":"rgba("+Math.round(qt(this._r,255)*100)+"%, "+Math.round(qt(this._g,255)*100)+"%, "+Math.round(qt(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:V8[mN(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var t="#"+gN(this._r,this._g,this._b,this._a),i=t,r=this._gradientType?"GradientType = 1, ":"";if(e){var s=Oe(e);i="#"+gN(s._r,s._g,s._b,s._a)}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+t+",endColorstr="+i+")"},toString:function(e){var t=!!e;e=e||this._format;var i=!1,r=this._a<1&&this._a>=0,s=!t&&r&&(e==="hex"||e==="hex6"||e==="hex3"||e==="hex4"||e==="hex8"||e==="name");return s?e==="name"&&this._a===0?this.toName():this.toRgbString():(e==="rgb"&&(i=this.toRgbString()),e==="prgb"&&(i=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(i=this.toHexString()),e==="hex3"&&(i=this.toHexString(!0)),e==="hex4"&&(i=this.toHex8String(!0)),e==="hex8"&&(i=this.toHex8String()),e==="name"&&(i=this.toName()),e==="hsl"&&(i=this.toHslString()),e==="hsv"&&(i=this.toHsvString()),i||this.toHexString())},clone:function(){return Oe(this.toString())},_applyModification:function(e,t){var i=e.apply(null,[this].concat([].slice.call(t)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(I8,arguments)},brighten:function(){return this._applyModification(U8,arguments)},darken:function(){return this._applyModification(F8,arguments)},desaturate:function(){return this._applyModification(P8,arguments)},saturate:function(){return this._applyModification(D8,arguments)},greyscale:function(){return this._applyModification(L8,arguments)},spin:function(){return this._applyModification(O8,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(z8,arguments)},complement:function(){return this._applyCombination(B8,arguments)},monochromatic:function(){return this._applyCombination(G8,arguments)},splitcomplement:function(){return this._applyCombination(k8,arguments)},triad:function(){return this._applyCombination(_N,[3])},tetrad:function(){return this._applyCombination(_N,[4])}},Oe.fromRatio=function(n,e){if(Hg(n)=="object"){var t={};for(var i in n)n.hasOwnProperty(i)&&(i==="a"?t[i]=n[i]:t[i]=pf(n[i]));n=t}return Oe(n,e)};function E8(n){var e={r:0,g:0,b:0},t=1,i=null,r=null,s=null,o=!1,a=!1;return typeof n=="string"&&(n=j8(n)),Hg(n)=="object"&&(Eo(n.r)&&Eo(n.g)&&Eo(n.b)?(e=A8(n.r,n.g,n.b),o=!0,a=String(n.r).substr(-1)==="%"?"prgb":"rgb"):Eo(n.h)&&Eo(n.s)&&Eo(n.v)?(i=pf(n.s),r=pf(n.v),e=R8(n.h,i,r),o=!0,a="hsv"):Eo(n.h)&&Eo(n.s)&&Eo(n.l)&&(i=pf(n.s),s=pf(n.l),e=C8(n.h,i,s),o=!0,a="hsl"),n.hasOwnProperty("a")&&(t=n.a)),t=vN(t),{ok:o,format:n.format||a,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:t}}function A8(n,e,t){return{r:qt(n,255)*255,g:qt(e,255)*255,b:qt(t,255)*255}}function fN(n,e,t){n=qt(n,255),e=qt(e,255),t=qt(t,255);var i=Math.max(n,e,t),r=Math.min(n,e,t),s,o,a=(i+r)/2;if(i==r)s=o=0;else{var l=i-r;switch(o=a>.5?l/(2-i-r):l/(i+r),i){case n:s=(e-t)/l+(e<t?6:0);break;case e:s=(t-n)/l+2;break;case t:s=(n-e)/l+4;break}s/=6}return{h:s,s:o,l:a}}function C8(n,e,t){var i,r,s;n=qt(n,360),e=qt(e,100),t=qt(t,100);function o(u,c,h){return h<0&&(h+=1),h>1&&(h-=1),h<1/6?u+(c-u)*6*h:h<1/2?c:h<2/3?u+(c-u)*(2/3-h)*6:u}if(e===0)i=r=s=t;else{var a=t<.5?t*(1+e):t+e-t*e,l=2*t-a;i=o(l,a,n+1/3),r=o(l,a,n),s=o(l,a,n-1/3)}return{r:i*255,g:r*255,b:s*255}}function pN(n,e,t){n=qt(n,255),e=qt(e,255),t=qt(t,255);var i=Math.max(n,e,t),r=Math.min(n,e,t),s,o,a=i,l=i-r;if(o=i===0?0:l/i,i==r)s=0;else{switch(i){case n:s=(e-t)/l+(e<t?6:0);break;case e:s=(t-n)/l+2;break;case t:s=(n-e)/l+4;break}s/=6}return{h:s,s:o,v:a}}function R8(n,e,t){n=qt(n,360)*6,e=qt(e,100),t=qt(t,100);var i=Math.floor(n),r=n-i,s=t*(1-e),o=t*(1-r*e),a=t*(1-(1-r)*e),l=i%6,u=[t,o,s,s,a,t][l],c=[a,t,t,o,s,s][l],h=[s,s,a,t,t,o][l];return{r:u*255,g:c*255,b:h*255}}function mN(n,e,t,i){var r=[hs(Math.round(n).toString(16)),hs(Math.round(e).toString(16)),hs(Math.round(t).toString(16))];return i&&r[0].charAt(0)==r[0].charAt(1)&&r[1].charAt(0)==r[1].charAt(1)&&r[2].charAt(0)==r[2].charAt(1)?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0):r.join("")}function N8(n,e,t,i,r){var s=[hs(Math.round(n).toString(16)),hs(Math.round(e).toString(16)),hs(Math.round(t).toString(16)),hs(yN(i))];return r&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)&&s[3].charAt(0)==s[3].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0):s.join("")}function gN(n,e,t,i){var r=[hs(yN(i)),hs(Math.round(n).toString(16)),hs(Math.round(e).toString(16)),hs(Math.round(t).toString(16))];return r.join("")}Oe.equals=function(n,e){return!n||!e?!1:Oe(n).toRgbString()==Oe(e).toRgbString()},Oe.random=function(){return Oe.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function P8(n,e){e=e===0?0:e||10;var t=Oe(n).toHsl();return t.s-=e/100,t.s=Wg(t.s),Oe(t)}function D8(n,e){e=e===0?0:e||10;var t=Oe(n).toHsl();return t.s+=e/100,t.s=Wg(t.s),Oe(t)}function L8(n){return Oe(n).desaturate(100)}function I8(n,e){e=e===0?0:e||10;var t=Oe(n).toHsl();return t.l+=e/100,t.l=Wg(t.l),Oe(t)}function U8(n,e){e=e===0?0:e||10;var t=Oe(n).toRgb();return t.r=Math.max(0,Math.min(255,t.r-Math.round(255*-(e/100)))),t.g=Math.max(0,Math.min(255,t.g-Math.round(255*-(e/100)))),t.b=Math.max(0,Math.min(255,t.b-Math.round(255*-(e/100)))),Oe(t)}function F8(n,e){e=e===0?0:e||10;var t=Oe(n).toHsl();return t.l-=e/100,t.l=Wg(t.l),Oe(t)}function O8(n,e){var t=Oe(n).toHsl(),i=(t.h+e)%360;return t.h=i<0?360+i:i,Oe(t)}function B8(n){var e=Oe(n).toHsl();return e.h=(e.h+180)%360,Oe(e)}function _N(n,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var t=Oe(n).toHsl(),i=[Oe(n)],r=360/e,s=1;s<e;s++)i.push(Oe({h:(t.h+s*r)%360,s:t.s,l:t.l}));return i}function k8(n){var e=Oe(n).toHsl(),t=e.h;return[Oe(n),Oe({h:(t+72)%360,s:e.s,l:e.l}),Oe({h:(t+216)%360,s:e.s,l:e.l})]}function z8(n,e,t){e=e||6,t=t||30;var i=Oe(n).toHsl(),r=360/t,s=[Oe(n)];for(i.h=(i.h-(r*e>>1)+720)%360;--e;)i.h=(i.h+r)%360,s.push(Oe(i));return s}function G8(n,e){e=e||6;for(var t=Oe(n).toHsv(),i=t.h,r=t.s,s=t.v,o=[],a=1/e;e--;)o.push(Oe({h:i,s:r,v:s})),s=(s+a)%1;return o}Oe.mix=function(n,e,t){t=t===0?0:t||50;var i=Oe(n).toRgb(),r=Oe(e).toRgb(),s=t/100,o={r:(r.r-i.r)*s+i.r,g:(r.g-i.g)*s+i.g,b:(r.b-i.b)*s+i.b,a:(r.a-i.a)*s+i.a};return Oe(o)},Oe.readability=function(n,e){var t=Oe(n),i=Oe(e);return(Math.max(t.getLuminance(),i.getLuminance())+.05)/(Math.min(t.getLuminance(),i.getLuminance())+.05)},Oe.isReadable=function(n,e,t){var i=Oe.readability(n,e),r,s;switch(s=!1,r=X8(t),r.level+r.size){case"AAsmall":case"AAAlarge":s=i>=4.5;break;case"AAlarge":s=i>=3;break;case"AAAsmall":s=i>=7;break}return s},Oe.mostReadable=function(n,e,t){var i=null,r=0,s,o,a,l;t=t||{},o=t.includeFallbackColors,a=t.level,l=t.size;for(var u=0;u<e.length;u++)s=Oe.readability(n,e[u]),s>r&&(r=s,i=Oe(e[u]));return Oe.isReadable(n,i,{level:a,size:l})||!o?i:(t.includeFallbackColors=!1,Oe.mostReadable(n,["#fff","#000"],t))};var OS=Oe.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},V8=Oe.hexNames=H8(OS);function H8(n){var e={};for(var t in n)n.hasOwnProperty(t)&&(e[n[t]]=t);return e}function vN(n){return n=parseFloat(n),(isNaN(n)||n<0||n>1)&&(n=1),n}function qt(n,e){W8(n)&&(n="100%");var t=$8(n);return n=Math.min(e,Math.max(0,parseFloat(n))),t&&(n=parseInt(n*e,10)/100),Math.abs(n-e)<1e-6?1:n%e/parseFloat(e)}function Wg(n){return Math.min(1,Math.max(0,n))}function yr(n){return parseInt(n,16)}function W8(n){return typeof n=="string"&&n.indexOf(".")!=-1&&parseFloat(n)===1}function $8(n){return typeof n=="string"&&n.indexOf("%")!=-1}function hs(n){return n.length==1?"0"+n:""+n}function pf(n){return n<=1&&(n=n*100+"%"),n}function yN(n){return Math.round(parseFloat(n)*255).toString(16)}function xN(n){return yr(n)/255}var ds=function(){var n="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",t="(?:"+e+")|(?:"+n+")",i="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?",r="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?";return{CSS_UNIT:new RegExp(t),rgb:new RegExp("rgb"+i),rgba:new RegExp("rgba"+r),hsl:new RegExp("hsl"+i),hsla:new RegExp("hsla"+r),hsv:new RegExp("hsv"+i),hsva:new RegExp("hsva"+r),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function Eo(n){return!!ds.CSS_UNIT.exec(n)}function j8(n){n=n.replace(w8,"").replace(M8,"").toLowerCase();var e=!1;if(OS[n])n=OS[n],e=!0;else if(n=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var t;return(t=ds.rgb.exec(n))?{r:t[1],g:t[2],b:t[3]}:(t=ds.rgba.exec(n))?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=ds.hsl.exec(n))?{h:t[1],s:t[2],l:t[3]}:(t=ds.hsla.exec(n))?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=ds.hsv.exec(n))?{h:t[1],s:t[2],v:t[3]}:(t=ds.hsva.exec(n))?{h:t[1],s:t[2],v:t[3],a:t[4]}:(t=ds.hex8.exec(n))?{r:yr(t[1]),g:yr(t[2]),b:yr(t[3]),a:xN(t[4]),format:e?"name":"hex8"}:(t=ds.hex6.exec(n))?{r:yr(t[1]),g:yr(t[2]),b:yr(t[3]),format:e?"name":"hex"}:(t=ds.hex4.exec(n))?{r:yr(t[1]+""+t[1]),g:yr(t[2]+""+t[2]),b:yr(t[3]+""+t[3]),a:xN(t[4]+""+t[4]),format:e?"name":"hex8"}:(t=ds.hex3.exec(n))?{r:yr(t[1]+""+t[1]),g:yr(t[2]+""+t[2]),b:yr(t[3]+""+t[3]),format:e?"name":"hex"}:!1}function X8(n){var e,t;return n=n||{level:"AA",size:"small"},e=(n.level||"AA").toUpperCase(),t=(n.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),t!=="small"&&t!=="large"&&(t="small"),{level:e,size:t}}function BS(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function q8(n){if(Array.isArray(n))return n}function Y8(n){if(Array.isArray(n))return BS(n)}function SN(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function K8(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function TN(n,e,t){return e=Hc(e),r6(n,GS()?Reflect.construct(e,t||[],Hc(n).constructor):e.apply(n,t))}function Q8(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function bN(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function kS(n,e){return n.get(SN(n,e))}function wN(n,e,t){Q8(n,e),e.set(n,t)}function MN(n,e,t){return n.set(SN(n,e),t),t}function EN(n,e,t){if(GS())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,e);var r=new(n.bind.apply(n,i));return r}function Z8(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,NN(i.key),i)}}function AN(n,e,t){return e&&Z8(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function $g(n,e,t){return(e=NN(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function zS(){return zS=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(n,e,t){var i=s6(n,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(arguments.length<3?n:t):r.value}},zS.apply(null,arguments)}function Hc(n){return Hc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Hc(n)}function CN(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&VS(n,e)}function GS(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(GS=function(){return!!n})()}function J8(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function e6(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,r,s,o,a=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(i=s.call(t)).done)&&(a.push(i.value),a.length!==e);l=!0);}catch(c){u=!0,r=c}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(u)throw r}}return a}}function t6(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function n6(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RN(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function i6(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?RN(Object(t),!0).forEach(function(i){$g(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):RN(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function r6(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return K8(n)}function VS(n,e){return VS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t},VS(n,e)}function mf(n,e){return q8(n)||e6(n,e)||PN(n,e)||t6()}function s6(n,e){for(;!{}.hasOwnProperty.call(n,e)&&(n=Hc(n))!==null;);return n}function HS(n,e,t,i){var r=zS(Hc(n.prototype),e,t);return typeof r=="function"?function(s){return r.apply(t,s)}:r}function fs(n){return Y8(n)||J8(n)||PN(n)||n6()}function o6(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function NN(n){var e=o6(n,"string");return typeof e=="symbol"?e:e+""}function WS(n){"@babel/helpers - typeof";return WS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},WS(n)}function PN(n,e){if(n){if(typeof n=="string")return BS(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?BS(n,e):void 0}}var DN=function(e){e instanceof Array?e.forEach(DN):(e.map&&e.map.dispose(),e.dispose())},LN=function(e){e.geometry&&e.geometry.dispose(),e.material&&DN(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(LN)},$S=function(e){for(;e.children.length;){var t=e.children[0];e.remove(t),LN(t)}},jS=new WeakMap,jg=new WeakMap,gf=function(n){function e(t){var i,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=r.dataBindAttr,o=s===void 0?"__data":s,a=r.objBindAttr,l=a===void 0?"__threeObj":a;return bN(this,e),i=TN(this,e),$g(i,"scene",void 0),wN(i,jS,void 0),wN(i,jg,void 0),i.scene=t,MN(jS,i,o),MN(jg,i,l),i.onRemoveObj(function(){}),i}return CN(e,n),AN(e,[{key:"onCreateObj",value:function(i){var r=this;return HS(e,"onCreateObj",this)([function(s){var o=i(s);return s[kS(jg,r)]=o,o[kS(jS,r)]=s,r.scene.add(o),o}]),this}},{key:"onRemoveObj",value:function(i){var r=this;return HS(e,"onRemoveObj",this)([function(s,o){var a=HS(e,"getData",r)([s]);i(s,o),r.scene.remove(s),$S(s),delete a[kS(jg,r)]}]),this}}])}(ZH),_f=function(e){return isNaN(e)?parseInt(Oe(e).toHex(),16):e},XS=function(e){return isNaN(e)?Oe(e).getAlpha():1},a6=KR(b8);function IN(n,e,t){!e||typeof t!="string"||n.filter(function(i){return!i[t]}).forEach(function(i){i[t]=a6(e(i))})}function l6(n,e){var t=n.nodes,i=n.links,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=r.nodeFilter,o=s===void 0?function(){return!0}:s,a=r.onLoopError,l=a===void 0?function(f){throw"Invalid DAG structure! Found cycle in node path: ".concat(f.join(" -> "),".")}:a,u={};t.forEach(function(f){return u[e(f)]={data:f,out:[],depth:-1,skip:!o(f)}}),i.forEach(function(f){var m=f.source,g=f.target,_=x(m),p=x(g);if(!u.hasOwnProperty(_))throw"Missing source node with id: ".concat(_);if(!u.hasOwnProperty(p))throw"Missing target node with id: ".concat(p);var v=u[_],y=u[p];v.out.push(y);function x(S){return WS(S)==="object"?e(S):S}});var c=[];d(Object.values(u));var h=Object.assign.apply(Object,[{}].concat(fs(Object.entries(u).filter(function(f){var m=mf(f,2),g=m[1];return!g.skip}).map(function(f){var m=mf(f,2),g=m[0],_=m[1];return $g({},g,_.depth)}))));return h;function d(f){for(var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,_=function(){var x=f[p];if(m.indexOf(x)!==-1){var S=[].concat(fs(m.slice(m.indexOf(x))),[x]).map(function(T){return e(T.data)});return c.some(function(T){return T.length===S.length&&T.every(function(w,E){return w===S[E]})})||(c.push(S),l(S)),1}g>x.depth&&(x.depth=g,d(x.out,[].concat(fs(m),[x]),g+(x.skip?0:1)))},p=0,v=f.length;p<v;p++)_()}}var We=window.THREE?window.THREE:{Group:Dc,Mesh:$n,MeshLambertMaterial:oC,Color:Ue,BufferGeometry:ci,BufferAttribute:Qn,Matrix4:pt,Vector3:N,SphereGeometry:Qd,CylinderGeometry:vg,TubeGeometry:Wx,ConeGeometry:Hx,Line:eB,LineBasicMaterial:dg,QuadraticBezierCurve3:Vx,CubicBezierCurve3:rC,Box3:wl},UN={graph:v5,forcelayout:Z5},u6=2,qS=new We.BufferGeometry().setAttribute?"setAttribute":"addAttribute",Xg=new We.BufferGeometry().applyMatrix4?"applyMatrix4":"applyMatrix",c6=Fg({props:{jsonUrl:{onChange:function(e,t){var i=this;e&&!t.fetchingJson&&(t.fetchingJson=!0,t.onLoading(),fetch(e).then(function(r){return r.json()}).then(function(r){t.fetchingJson=!1,t.onFinishLoading(r),i.graphData(r)}))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(e,t){t.engineRunning=!1}},numDimensions:{default:3,onChange:function(e,t){var i=t.d3ForceLayout.force("charge");i&&i.strength(e>2?-60:-30),e<3&&r(t.graphData.nodes,"z"),e<2&&r(t.graphData.nodes,"y");function r(s,o){s.forEach(function(a){delete a[o],delete a["v".concat(o)]})}}},dagMode:{onChange:function(e,t){!e&&t.forceEngine==="d3"&&(t.graphData.nodes||[]).forEach(function(i){return i.fx=i.fy=i.fz=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(e){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},nodePositionUpdate:{triggerUpdate:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaDecay(e)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaTarget(e)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.velocityDecay(e)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(e){return e._flushObjects=!0,e._rerender(),this},d3Force:function(e,t,i){return i===void 0?e.d3ForceLayout.force(t):(e.d3ForceLayout.force(t,i),this)},d3ReheatSimulation:function(e){return e.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(e){return e.cntTicks=0,e.startTickTime=new Date,e.engineRunning=!0,this},tickFrame:function(e){var t=e.forceEngine!=="ngraph";return e.engineRunning&&i(),r(),s(),this;function i(){++e.cntTicks>e.cooldownTicks||new Date-e.startTickTime>e.cooldownTime||t&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin?(e.engineRunning=!1,e.onEngineStop()):(e.layout[t?"tick":"step"](),e.onEngineTick());var o=yt(e.nodeThreeObjectExtend);e.nodeDataMapper.entries().forEach(function(d){var f=mf(d,2),m=f[0],g=f[1];if(g){var _=t?m:e.layout.getNodePosition(m[e.nodeId]),p=o(m);(!e.nodePositionUpdate||!e.nodePositionUpdate(p?g.children[0]:g,{x:_.x,y:_.y,z:_.z},m)||p)&&(g.position.x=_.x,g.position.y=_.y||0,g.position.z=_.z||0)}});var a=yt(e.linkWidth),l=yt(e.linkCurvature),u=yt(e.linkCurveRotation),c=yt(e.linkThreeObjectExtend);e.linkDataMapper.entries().forEach(function(d){var f=mf(d,2),m=f[0],g=f[1];if(g){var _=t?m:e.layout.getLinkPosition(e.layout.graph.getLink(m.source,m.target).id),p=_[t?"source":"from"],v=_[t?"target":"to"];if(!(!p||!v||!p.hasOwnProperty("x")||!v.hasOwnProperty("x"))){h(m);var y=c(m);if(!(e.linkPositionUpdate&&e.linkPositionUpdate(y?g.children[1]:g,{start:{x:p.x,y:p.y,z:p.z},end:{x:v.x,y:v.y,z:v.z}},m)&&!y)){var x=30,S=m.__curve,T=g.children.length?g.children[0]:g;if(T.type==="Line"){if(S){var E=S.getPoints(x);T.geometry.getAttribute("position").array.length!==E.length*3&&T.geometry[qS]("position",new We.BufferAttribute(new Float32Array(E.length*3),3)),T.geometry.setFromPoints(E)}else{var w=T.geometry.getAttribute("position");(!w||!w.array||w.array.length!==6)&&T.geometry[qS]("position",w=new We.BufferAttribute(new Float32Array(2*3),3)),w.array[0]=p.x,w.array[1]=p.y||0,w.array[2]=p.z||0,w.array[3]=v.x,w.array[4]=v.y||0,w.array[5]=v.z||0,w.needsUpdate=!0}T.geometry.computeBoundingSphere()}else if(T.type==="Mesh")if(S){T.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(T.position.set(0,0,0),T.rotation.set(0,0,0),T.scale.set(1,1,1));var L=Math.ceil(a(m)*10)/10,F=L/2,Q=new We.TubeGeometry(S,x,F,e.linkResolution,!1);T.geometry.dispose(),T.geometry=Q}else{if(!T.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var M=Math.ceil(a(m)*10)/10,b=M/2,C=new We.CylinderGeometry(b,b,1,e.linkResolution,1,!1);C[Xg](new We.Matrix4().makeTranslation(0,1/2,0)),C[Xg](new We.Matrix4().makeRotationX(Math.PI/2)),T.geometry.dispose(),T.geometry=C}var I=new We.Vector3(p.x,p.y||0,p.z||0),U=new We.Vector3(v.x,v.y||0,v.z||0),D=I.distanceTo(U);T.position.x=I.x,T.position.y=I.y,T.position.z=I.z,T.scale.z=D,T.parent.localToWorld(U),T.lookAt(U)}}}}});function h(d){var f=t?d:e.layout.getLinkPosition(e.layout.graph.getLink(d.source,d.target).id),m=f[t?"source":"from"],g=f[t?"target":"to"];if(!(!m||!g||!m.hasOwnProperty("x")||!g.hasOwnProperty("x"))){var _=l(d);if(!_)d.__curve=null;else{var p=new We.Vector3(m.x,m.y||0,m.z||0),v=new We.Vector3(g.x,g.y||0,g.z||0),y=p.distanceTo(v),x,S=u(d);if(y>0){var T=g.x-m.x,w=g.y-m.y||0,E=new We.Vector3().subVectors(v,p),M=E.clone().multiplyScalar(_).cross(T!==0||w!==0?new We.Vector3(0,0,1):new We.Vector3(0,1,0)).applyAxisAngle(E.normalize(),S).add(new We.Vector3().addVectors(p,v).divideScalar(2));x=new We.QuadraticBezierCurve3(p,M,v)}else{var b=_*70,C=-S,I=C+Math.PI/2;x=new We.CubicBezierCurve3(p,new We.Vector3(b*Math.cos(I),b*Math.sin(I),0).add(p),new We.Vector3(b*Math.cos(C),b*Math.sin(C),0).add(p),v)}d.__curve=x}}}}function r(){var o=yt(e.linkDirectionalArrowRelPos),a=yt(e.linkDirectionalArrowLength),l=yt(e.nodeVal);e.arrowDataMapper.entries().forEach(function(u){var c=mf(u,2),h=c[0],d=c[1];if(d){var f=t?h:e.layout.getLinkPosition(e.layout.graph.getLink(h.source,h.target).id),m=f[t?"source":"from"],g=f[t?"target":"to"];if(!(!m||!g||!m.hasOwnProperty("x")||!g.hasOwnProperty("x"))){var _=Math.cbrt(Math.max(0,l(m)||1))*e.nodeRelSize,p=Math.cbrt(Math.max(0,l(g)||1))*e.nodeRelSize,v=a(h),y=o(h),x=h.__curve?function(b){return h.__curve.getPoint(b)}:function(b){var C=function(U,D,L,F){return D[U]+(L[U]-D[U])*F||0};return{x:C("x",m,g,b),y:C("y",m,g,b),z:C("z",m,g,b)}},S=h.__curve?h.__curve.getLength():Math.sqrt(["x","y","z"].map(function(b){return Math.pow((g[b]||0)-(m[b]||0),2)}).reduce(function(b,C){return b+C},0)),T=_+v+(S-_-p-v)*y,w=x(T/S),E=x((T-v)/S);["x","y","z"].forEach(function(b){return d.position[b]=E[b]});var M=EN(We.Vector3,fs(["x","y","z"].map(function(b){return w[b]})));d.parent.localToWorld(M),d.lookAt(M)}}})}function s(){var o=yt(e.linkDirectionalParticleSpeed);e.graphData.links.forEach(function(a){var l=e.particlesDataMapper.getObj(a),u=l&&l.children,c=a.__singleHopPhotonsObj&&a.__singleHopPhotonsObj.children;if(!((!c||!c.length)&&(!u||!u.length))){var h=t?a:e.layout.getLinkPosition(e.layout.graph.getLink(a.source,a.target).id),d=h[t?"source":"from"],f=h[t?"target":"to"];if(!(!d||!f||!d.hasOwnProperty("x")||!f.hasOwnProperty("x"))){var m=o(a),g=a.__curve?function(p){return a.__curve.getPoint(p)}:function(p){var v=function(x,S,T,w){return S[x]+(T[x]-S[x])*w||0};return{x:v("x",d,f,p),y:v("y",d,f,p),z:v("z",d,f,p)}},_=[].concat(fs(u||[]),fs(c||[]));_.forEach(function(p,v){var y=p.parent.__linkThreeObjType==="singleHopPhotons";if(p.hasOwnProperty("__progressRatio")||(p.__progressRatio=y?0:v/u.length),p.__progressRatio+=m,p.__progressRatio>=1)if(!y)p.__progressRatio=p.__progressRatio%1;else{p.parent.remove(p),$S(p);return}var x=p.__progressRatio,S=g(x);["x","y","z"].forEach(function(T){return p.position[T]=S[T]})})}}})}},emitParticle:function(e,t){if(t&&e.graphData.links.includes(t)){if(!t.__singleHopPhotonsObj){var i=new We.Group;i.__linkThreeObjType="singleHopPhotons",t.__singleHopPhotonsObj=i,e.graphScene.add(i)}var r=yt(e.linkDirectionalParticleWidth),s=Math.ceil(r(t)*10)/10/2,o=e.linkDirectionalParticleResolution,a=new We.SphereGeometry(s,o,o),l=yt(e.linkColor),u=yt(e.linkDirectionalParticleColor),c=u(t)||l(t)||"#f0f0f0",h=new We.Color(_f(c)),d=e.linkOpacity*3,f=new We.MeshLambertMaterial({color:h,transparent:!0,opacity:d});t.__singleHopPhotonsObj.add(new We.Mesh(a,f))}return this},getGraphBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0};if(!e.initialised)return null;var i=function r(s){var o=[];if(s.geometry){s.geometry.computeBoundingBox();var a=new We.Box3;a.copy(s.geometry.boundingBox).applyMatrix4(s.matrixWorld),o.push(a)}return o.concat.apply(o,fs((s.children||[]).filter(function(l){return!l.hasOwnProperty("__graphObjType")||l.__graphObjType==="node"&&t(l.__data)}).map(r)))}(e.graphScene);return i.length?Object.assign.apply(Object,fs(["x","y","z"].map(function(r){return $g({},r,[OH(i,function(s){return s.min[r]}),FH(i,function(s){return s.max[r]})])}))):null}},stateInit:function(){return{d3ForceLayout:u5().force("link",qV()).force("charge",c5()).force("center",K4()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(e,t){t.graphScene=e,t.nodeDataMapper=new gf(e,{objBindAttr:"__threeObj"}),t.linkDataMapper=new gf(e,{objBindAttr:"__lineObj"}),t.arrowDataMapper=new gf(e,{objBindAttr:"__arrowObj"}),t.particlesDataMapper=new gf(e,{objBindAttr:"__photonsObj"})},update:function(e,t){var i=function(j){return j.some(function(ae){return t.hasOwnProperty(ae)})};if(e.engineRunning=!1,typeof e.onUpdate=="function"&&e.onUpdate(),e.nodeAutoColorBy!==null&&i(["nodeAutoColorBy","graphData","nodeColor"])&&IN(e.graphData.nodes,yt(e.nodeAutoColorBy),e.nodeColor),e.linkAutoColorBy!==null&&i(["linkAutoColorBy","graphData","linkColor"])&&IN(e.graphData.links,yt(e.linkAutoColorBy),e.linkColor),e._flushObjects||i(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var r=yt(e.nodeThreeObject),s=yt(e.nodeThreeObjectExtend),o=yt(e.nodeVal),a=yt(e.nodeColor),l=yt(e.nodeVisibility),u={},c={};(e._flushObjects||i(["nodeThreeObject","nodeThreeObjectExtend"]))&&e.nodeDataMapper.clear(),e.nodeDataMapper.onCreateObj(function(O){var j=r(O),ae=s(O);j&&e.nodeThreeObject===j&&(j=j.clone());var re;return j&&!ae?re=j:(re=new We.Mesh,re.__graphDefaultObj=!0,j&&ae&&re.add(j)),re.__graphObjType="node",re}).onUpdateObj(function(O,j){if(O.__graphDefaultObj){var ae=o(j)||1,re=Math.cbrt(ae)*e.nodeRelSize,Ee=e.nodeResolution;(!O.geometry.type.match(/^Sphere(Buffer)?Geometry$/)||O.geometry.parameters.radius!==re||O.geometry.parameters.widthSegments!==Ee)&&(u.hasOwnProperty(ae)||(u[ae]=new We.SphereGeometry(re,Ee,Ee)),O.geometry.dispose(),O.geometry=u[ae]);var Re=a(j),Fe=new We.Color(_f(Re||"#ffffaa")),gt=e.nodeOpacity*XS(Re);(O.material.type!=="MeshLambertMaterial"||!O.material.color.equals(Fe)||O.material.opacity!==gt)&&(c.hasOwnProperty(Re)||(c[Re]=new We.MeshLambertMaterial({color:Fe,transparent:!0,opacity:gt})),O.material.dispose(),O.material=c[Re])}}).digest(e.graphData.nodes.filter(l))}if(e._flushObjects||i(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution"])){var h=yt(e.linkThreeObject),d=yt(e.linkThreeObjectExtend),f=yt(e.linkMaterial),m=yt(e.linkVisibility),g=yt(e.linkColor),_=yt(e.linkWidth),p={},v={},y={},x=e.graphData.links.filter(m);if((e._flushObjects||i(["linkThreeObject","linkThreeObjectExtend","linkWidth"]))&&e.linkDataMapper.clear(),e.linkDataMapper.onRemoveObj(function(O){var j=O.__data&&O.__data.__singleHopPhotonsObj;j&&(j.parent.remove(j),$S(j),delete O.__data.__singleHopPhotonsObj)}).onCreateObj(function(O){var j=h(O),ae=d(O);j&&e.linkThreeObject===j&&(j=j.clone());var re;if(!j||ae){var Ee=!!_(O);if(Ee)re=new We.Mesh;else{var Re=new We.BufferGeometry;Re[qS]("position",new We.BufferAttribute(new Float32Array(2*3),3)),re=new We.Line(Re)}}var Fe;return j?ae?(Fe=new We.Group,Fe.__graphDefaultObj=!0,Fe.add(re),Fe.add(j)):Fe=j:(Fe=re,Fe.__graphDefaultObj=!0),Fe.renderOrder=10,Fe.__graphObjType="link",Fe}).onUpdateObj(function(O,j){if(O.__graphDefaultObj){var ae=O.children.length?O.children[0]:O,re=Math.ceil(_(j)*10)/10,Ee=!!re;if(Ee){var Re=re/2,Fe=e.linkResolution;if(!ae.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||ae.geometry.parameters.radiusTop!==Re||ae.geometry.parameters.radialSegments!==Fe){if(!p.hasOwnProperty(re)){var gt=new We.CylinderGeometry(Re,Re,1,Fe,1,!1);gt[Xg](new We.Matrix4().makeTranslation(0,1/2,0)),gt[Xg](new We.Matrix4().makeRotationX(Math.PI/2)),p[re]=gt}ae.geometry.dispose(),ae.geometry=p[re]}}var ut=f(j);if(ut)ae.material=ut;else{var Rt=g(j),z=new We.Color(_f(Rt||"#f0f0f0")),ln=e.linkOpacity*XS(Rt),ct=Ee?"MeshLambertMaterial":"LineBasicMaterial";if(ae.material.type!==ct||!ae.material.color.equals(z)||ae.material.opacity!==ln){var dt=Ee?v:y;dt.hasOwnProperty(Rt)||(dt[Rt]=new We[ct]({color:z,transparent:ln<1,opacity:ln,depthWrite:ln>=1})),ae.material.dispose(),ae.material=dt[Rt]}}}}).digest(x),e.linkDirectionalArrowLength||t.hasOwnProperty("linkDirectionalArrowLength")){var S=yt(e.linkDirectionalArrowLength),T=yt(e.linkDirectionalArrowColor);e.arrowDataMapper.onCreateObj(function(){var O=new We.Mesh(void 0,new We.MeshLambertMaterial({transparent:!0}));return O.__linkThreeObjType="arrow",O}).onUpdateObj(function(O,j){var ae=S(j),re=e.linkDirectionalArrowResolution;if(!O.geometry.type.match(/^Cone(Buffer)?Geometry$/)||O.geometry.parameters.height!==ae||O.geometry.parameters.radialSegments!==re){var Ee=new We.ConeGeometry(ae*.25,ae,re);Ee.translate(0,ae/2,0),Ee.rotateX(Math.PI/2),O.geometry.dispose(),O.geometry=Ee}var Re=T(j)||g(j)||"#f0f0f0";O.material.color=new We.Color(_f(Re)),O.material.opacity=e.linkOpacity*3*XS(Re)}).digest(x.filter(S))}if(e.linkDirectionalParticles||t.hasOwnProperty("linkDirectionalParticles")){var w=yt(e.linkDirectionalParticles),E=yt(e.linkDirectionalParticleWidth),M=yt(e.linkDirectionalParticleColor),b={},C={};e.particlesDataMapper.onCreateObj(function(){var O=new We.Group;return O.__linkThreeObjType="photons",O.__photonDataMapper=new gf(O),O}).onUpdateObj(function(O,j){var ae=Math.round(Math.abs(w(j))),re=!!O.children.length&&O.children[0],Ee=Math.ceil(E(j)*10)/10/2,Re=e.linkDirectionalParticleResolution,Fe;re&&re.geometry.parameters.radius===Ee&&re.geometry.parameters.widthSegments===Re?Fe=re.geometry:(C.hasOwnProperty(Ee)||(C[Ee]=new We.SphereGeometry(Ee,Re,Re)),Fe=C[Ee],re&&re.geometry.dispose());var gt=M(j)||g(j)||"#f0f0f0",ut=new We.Color(_f(gt)),Rt=e.linkOpacity*3,z;re&&re.material.color.equals(ut)&&re.material.opacity===Rt?z=re.material:(b.hasOwnProperty(gt)||(b[gt]=new We.MeshLambertMaterial({color:ut,transparent:!0,opacity:Rt})),z=b[gt],re&&re.material.dispose()),O.__photonDataMapper.id(function(ln){return ln.idx}).onCreateObj(function(){return new We.Mesh(Fe,z)}).onUpdateObj(function(ln){ln.geometry=Fe,ln.material=z}).digest(fs(new Array(ae)).map(function(ln,ct){return{idx:ct}}))}).digest(x.filter(w))}}if(e._flushObjects=!1,i(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){e.engineRunning=!1,e.graphData.links.forEach(function(O){O.source=O[e.linkSource],O.target=O[e.linkTarget]});var I=e.forceEngine!=="ngraph",U;if(I){(U=e.d3ForceLayout).stop().alpha(1).numDimensions(e.numDimensions).nodes(e.graphData.nodes);var D=e.d3ForceLayout.force("link");D&&D.id(function(O){return O[e.nodeId]}).links(e.graphData.links);var L=e.dagMode&&l6(e.graphData,function(O){return O[e.nodeId]},{nodeFilter:e.dagNodeFilter,onLoopError:e.onDagError||void 0}),F=Math.max.apply(Math,fs(Object.values(L||[]))),Q=e.dagLevelDistance||e.graphData.nodes.length/(F||1)*u6*(["radialin","radialout"].indexOf(e.dagMode)!==-1?.7:1);if(["lr","rl","td","bu","zin","zout"].includes(t.dagMode)){var B=["lr","rl"].includes(t.dagMode)?"fx":["td","bu"].includes(t.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(O){return delete O[B]})}if(["lr","rl","td","bu","zin","zout"].includes(e.dagMode)){var J=["rl","td","zout"].includes(e.dagMode),H=function(j){return(L[j[e.nodeId]]-F/2)*Q*(J?-1:1)},K=["lr","rl"].includes(e.dagMode)?"fx":["td","bu"].includes(e.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(O){return O[K]=H(O)})}e.d3ForceLayout.force("dagRadial",["radialin","radialout"].indexOf(e.dagMode)!==-1?h5(function(O){var j=L[O[e.nodeId]]||-1;return(e.dagMode==="radialin"?F-j:j)*Q}).strength(function(O){return e.dagNodeFilter(O)?1:0}):null)}else{var le=UN.graph();e.graphData.nodes.forEach(function(O){le.addNode(O[e.nodeId])}),e.graphData.links.forEach(function(O){le.addLink(O.source,O.target)}),U=UN.forcelayout(le,i6({dimensions:e.numDimensions},e.ngraphPhysics)),U.graph=le}for(var Pe=0;Pe<e.warmupTicks&&!(I&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin);Pe++)U[I?"tick":"step"]();e.layout=U,this.resetCountdown()}e.engineRunning=!0,e.onFinishUpdate()}});function h6(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Object,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=function(r){function s(){var o;bN(this,s);for(var a=arguments.length,l=new Array(a),u=0;u<a;u++)l[u]=arguments[u];return o=TN(this,s,[].concat(l)),o.__kapsuleInstance=EN(n,[].concat(fs(t?[o]:[]),l)),o}return CN(s,r),AN(s)}(e);return Object.keys(n()).forEach(function(r){return i.prototype[r]=function(){var s,o=(s=this.__kapsuleInstance)[r].apply(s,arguments);return o===this.__kapsuleInstance?this:o}}),i}var d6=window.THREE?window.THREE:{Group:Dc},FN=h6(c6,d6.Group,!0);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const f6=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveMap","envMap","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class p6{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=f6,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:i,material:r,object:s}=e;if(t={material:this.getMaterialData(r),geometry:{attributes:this.getAttributesData(i.attributes),indexVersion:i.index?i.index.version:null,drawRange:{start:i.drawRange.start,count:i.drawRange.count}},worldMatrix:s.matrixWorld.clone()},s.center&&(t.center=s.center.clone()),s.morphTargetInfluences&&(t.morphTargetInfluences=s.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:o,height:a}=e.context;t.bufferWidth=o,t.bufferHeight=a}this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const i in e){const r=e[i];t[i]={version:r.version}}return t}containsNode(e){const t=e.material;for(const i in t)if(t[i]&&t[i].isNode)return!0;return e.renderer.nodes.modelViewMatrix!==null||e.renderer.nodes.modelNormalViewMatrix!==null}getMaterialData(e){const t={};for(const i of this.refreshUniforms){const r=e[i];r!=null&&(typeof r=="object"&&r.clone!==void 0?r.isTexture===!0?t[i]={id:r.id,version:r.version}:t[i]=r.clone():t[i]=r)}return t}equals(e){const{object:t,material:i,geometry:r}=e,s=this.getRenderObjectData(e);if(s.worldMatrix.equals(t.matrixWorld)!==!0)return s.worldMatrix.copy(t.matrixWorld),!1;const o=s.material;for(const g in o){const _=o[g],p=i[g];if(_.equals!==void 0){if(_.equals(p)===!1)return _.copy(p),!1}else if(p.isTexture===!0){if(_.id!==p.id||_.version!==p.version)return _.id=p.id,_.version=p.version,!1}else if(_!==p)return o[g]=p,!1}if(o.transmission>0){const{width:g,height:_}=e.context;if(s.bufferWidth!==g||s.bufferHeight!==_)return s.bufferWidth=g,s.bufferHeight=_,!1}const a=s.geometry,l=r.attributes,u=a.attributes,c=Object.keys(u),h=Object.keys(l);if(c.length!==h.length)return s.geometry.attributes=this.getAttributesData(l),!1;for(const g of c){const _=u[g],p=l[g];if(p===void 0)return delete u[g],!1;if(_.version!==p.version)return _.version=p.version,!1}const d=r.index,f=a.indexVersion,m=d?d.version:null;if(f!==m)return a.indexVersion=m,!1;if(a.drawRange.start!==r.drawRange.start||a.drawRange.count!==r.drawRange.count)return a.drawRange.start=r.drawRange.start,a.drawRange.count=r.drawRange.count,!1;if(s.morphTargetInfluences){let g=!1;for(let _=0;_<s.morphTargetInfluences.length;_++)s.morphTargetInfluences[_]!==t.morphTargetInfluences[_]&&(g=!0);if(g)return!0}return s.center&&s.center.equals(t.center)===!1?(s.center.copy(t.center),!0):(e.bundle!==null&&(s.version=e.bundle.version),!0)}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e))return!0;const{renderId:i}=t;if(this.renderId!==i)return this.renderId=i,!0;const r=e.object.static===!0,s=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;return r||s?!1:this.equals(e)!==!0}}function vf(n,e=0){let t=3735928559^e,i=1103547991^e;if(n instanceof Array)for(let r=0,s;r<n.length;r++)s=n[r],t=Math.imul(t^s,2654435761),i=Math.imul(i^s,1597334677);else for(let r=0,s;r<n.length;r++)s=n.charCodeAt(r),t=Math.imul(t^s,2654435761),i=Math.imul(i^s,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(i^i>>>13,3266489909),i=Math.imul(i^i>>>16,2246822507),i^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&i)+(t>>>0)}const m6=n=>vf(n),YS=n=>vf(n),KS=(...n)=>vf(n);function ON(n,e=!1){const t=[];n.isNode===!0&&(t.push(n.id),n=n.getSelf());for(const{property:i,childNode:r}of qg(n))t.push(t,vf(i.slice(0,-4)),r.getCacheKey(e));return vf(t)}function*qg(n,e=!1){for(const t in n){if(t.startsWith("_")===!0)continue;const i=n[t];if(Array.isArray(i)===!0)for(let r=0;r<i.length;r++){const s=i[r];s&&(s.isNode===!0||e&&typeof s.toJSON=="function")&&(yield{property:t,index:r,childNode:s})}else if(i&&i.isNode===!0)yield{property:t,childNode:i};else if(typeof i=="object")for(const r in i){const s=i[r];s&&(s.isNode===!0||e&&typeof s.toJSON=="function")&&(yield{property:t,index:r,childNode:s})}}}const g6=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),BN=new WeakMap;function _6(n){return g6.get(n)}function Yg(n){if(n==null)return null;const e=typeof n;return n.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":n.isVector2===!0?"vec2":n.isVector3===!0?"vec3":n.isVector4===!0?"vec4":n.isMatrix3===!0?"mat3":n.isMatrix4===!0?"mat4":n.isColor===!0?"color":n instanceof ArrayBuffer?"ArrayBuffer":null}function kN(n,...e){const t=n?n.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),n==="color"?new Ue(...e):t==="vec2"?new he(...e):t==="vec3"?new N(...e):t==="vec4"?new et(...e):t==="mat3"?new je(...e):t==="mat4"?new pt(...e):n==="bool"?e[0]||!1:n==="float"||n==="int"||n==="uint"?e[0]||0:n==="string"?e[0]||"":n==="ArrayBuffer"?y6(e[0]):null}function zN(n){let e=BN.get(n);return e===void 0&&(e={},BN.set(n,e)),e}function v6(n){let e="";const t=new Uint8Array(n);for(let i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return btoa(e)}function y6(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0)).buffer}const GN={VERTEX:"vertex",FRAGMENT:"fragment"},at={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},Ao={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},x6=["fragment","vertex"],VN=["setup","analyze","generate"],HN=[...x6,"compute"],Wc=["x","y","z","w"];let S6=0;class tt extends co{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=at.NONE,this.updateBeforeType=at.NONE,this.updateAfterType=at.NONE,this.uuid=zm.generateUUID(),this.version=0,this.global=!1,this.isNode=!0,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:S6++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this.getSelf()),this}onFrameUpdate(e){return this.onUpdate(e,at.FRAME)}onRenderUpdate(e){return this.onUpdate(e,at.RENDER)}onObjectUpdate(e){return this.onUpdate(e,at.OBJECT)}onReference(e){return this.updateReference=e.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of qg(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(e=!1){return e=e||this.version!==this._cacheKeyVersion,(e===!0||this._cacheKey===null)&&(this._cacheKey=KS(ON(this,e),this.customCacheKey()),this._cacheKeyVersion=this.version),this._cacheKey}customCacheKey(){return 0}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){const t=e.getNodeProperties(this);let i=0;for(const r of this.getChildren())t["node"+i++]=r;return t.outputNode||null}analyze(e){if(e.increaseUsage(this)===1){const i=e.getNodeProperties(this);for(const r of Object.values(i))r&&r.isNode===!0&&r.build(e)}}generate(e,t){const{outputNode:i}=e.getNodeProperties(this);if(i&&i.isNode===!0)return i.build(e,t)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){const i=this.getShared(e);if(this!==i)return i.build(e,t);e.addNode(this),e.addChain(this);let r=null;const s=e.getBuildStage();if(s==="setup"){this.updateReference(e);const o=e.getNodeProperties(this);if(o.initialized!==!0){o.initialized=!0;const a=this.setup(e),l=a&&a.isNode===!0;for(const u of Object.values(o))u&&u.isNode===!0&&u.build(e);l&&a.build(e),o.outputNode=a}}else if(s==="analyze")this.analyze(e);else if(s==="generate")if(this.generate.length===1){const a=this.getNodeType(e),l=e.getDataFromNode(this);r=l.snippet,r===void 0?(r=this.generate(e)||"",l.snippet=r):l.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),r=e.format(r,a,t)}else r=this.generate(e,t)||"";return e.removeChain(this),e.addSequentialNode(this),r}getSerializeChildren(){return qg(this)}serialize(e){const t=this.getSerializeChildren(),i={};for(const{property:r,index:s,childNode:o}of t)s!==void 0?(i[r]===void 0&&(i[r]=Number.isInteger(s)?[]:{}),i[r][s]=o.toJSON(e.meta).uuid):i[r]=o.toJSON(e.meta).uuid;Object.keys(i).length>0&&(e.inputNodes=i)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const i in e.inputNodes)if(Array.isArray(e.inputNodes[i])){const r=[];for(const s of e.inputNodes[i])r.push(t[s]);this[i]=r}else if(typeof e.inputNodes[i]=="object"){const r={};for(const s in e.inputNodes[i]){const o=e.inputNodes[i][s];r[s]=t[o]}this[i]=r}else{const r=e.inputNodes[i];this[i]=t[r]}}}toJSON(e){const{uuid:t,type:i}=this,r=e===void 0||typeof e=="string";r&&(e={textures:{},images:{},nodes:{}});let s=e.nodes[t];s===void 0&&(s={uuid:t,type:i,meta:e,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},r!==!0&&(e.nodes[s.uuid]=s),this.serialize(s),delete s.meta);function o(a){const l=[];for(const u in a){const c=a[u];delete c.metadata,l.push(c)}return l}if(r){const a=o(e.textures),l=o(e.images),u=o(e.nodes);a.length>0&&(s.textures=a),l.length>0&&(s.images=l),u.length>0&&(s.nodes=u)}return s}}class yf extends tt{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=this.node.build(e),i=this.indexNode.build(e,"uint");return`${t}[ ${i} ]`}}class WN extends tt{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let i=null;for(const r of this.convertTo.split("|"))(i===null||e.getTypeLength(t)===e.getTypeLength(r))&&(i=r);return i}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const i=this.node,r=this.getNodeType(e),s=i.build(e,r);return e.format(s,r,t)}}class On extends tt{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const r=e.getVectorType(this.getNodeType(e,t)),s=e.getDataFromNode(this);if(s.propertyName!==void 0)return e.format(s.propertyName,r,t);if(r!=="void"&&t!=="void"&&this.hasDependencies(e)){const o=super.build(e,r),a=e.getVarFromNode(this,null,r),l=e.getPropertyName(a);return e.addLineFlowCode(`${l} = ${o}`,this),s.snippet=o,s.propertyName=l,e.format(s.propertyName,r,t)}}return super.build(e,t)}}class T6 extends On{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,i)=>t+e.getTypeLength(i.getNodeType(e)),0))}generate(e,t){const i=this.getNodeType(e),r=this.nodes,s=e.getComponentType(i),o=[];for(const l of r){let u=l.build(e);const c=e.getComponentType(l.getNodeType(e));c!==s&&(u=e.format(u,c,s)),o.push(u)}const a=`${e.getType(i)}( ${o.join(", ")} )`;return e.format(a,i,t)}}const b6=Wc.join("");class $N extends tt{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(Wc.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,t){const i=this.node,r=e.getTypeLength(i.getNodeType(e));let s=null;if(r>1){let o=null;this.getVectorLength()>=r&&(o=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const l=i.build(e,o);this.components.length===r&&this.components===b6.slice(0,this.components.length)?s=e.format(l,o,t):s=e.format(`${l}.${this.components}`,this.getNodeType(e),t)}else s=i.build(e,t);return s}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class w6 extends On{static get type(){return"SetNode"}constructor(e,t,i){super(),this.sourceNode=e,this.components=t,this.targetNode=i}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:i,targetNode:r}=this,s=this.getNodeType(e),o=e.getComponentType(r.getNodeType(e)),a=e.getTypeFromLength(i.length,o),l=r.build(e,a),u=t.build(e,s),c=e.getTypeLength(s),h=[];for(let d=0;d<c;d++){const f=Wc[d];f===i[0]?(h.push(l),d+=i.length-1):h.push(u+"."+f)}return`${e.getType(s)}( ${h.join(", ")} )`}}class M6 extends On{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:i}=this,r=this.getNodeType(e),s=i.build(e),o=e.getVarFromNode(this),a=e.getPropertyName(o);e.addLineFlowCode(a+" = "+s,this);const l=e.getTypeLength(r),u=[];let c=0;for(let h=0;h<l;h++){const d=Wc[h];d===t[c]?(u.push("1.0 - "+(a+"."+d)),c++):u.push(a+"."+d)}return`${e.getType(r)}( ${u.join(", ")} )`}}class QS extends tt{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?Yg(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=Yg(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=v6(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?kN(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}class Co extends QS{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const i=this.getNodeType(e);return e.format(this.generateConst(e),i,t)}}let $c=null;const jc=new Map;function ee(n,e){if(jc.has(n)){console.warn(`Redefinition of method chaining ${n}`);return}if(typeof e!="function")throw new Error(`Node element ${n} is not a function`);jc.set(n,e)}const jN=n=>n.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),XN=n=>jN(n).split("").sort().join(""),qN={setup(n,e){const t=e.shift();return n(Jg(t),...e)},get(n,e,t){if(typeof e=="string"&&n[e]===void 0){if(n.isStackNode!==!0&&e==="assign")return(...i)=>($c.assign(t,...i),t);if(jc.has(e)){const i=jc.get(e);return n.isStackNode?(...r)=>t.add(i(...r)):(...r)=>i(t,...r)}else{if(e==="self")return n;if(e.endsWith("Assign")&&jc.has(e.slice(0,e.length-6))){const i=jc.get(e.slice(0,e.length-6));return n.isStackNode?(...r)=>t.assign(r[0],i(...r)):(...r)=>t.assign(i(t,...r))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=jN(e),pe(new $N(t,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=XN(e.slice(3).toLowerCase()),i=>pe(new w6(n,e,i));if(/^flip[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=XN(e.slice(4).toLowerCase()),()=>pe(new M6(pe(n),e));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),pe(new $N(n,e));if(/^\d+$/.test(e)===!0)return pe(new yf(t,new Co(Number(e),"uint")))}}}return Reflect.get(n,e,t)},set(n,e,t,i){return typeof e=="string"&&n[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(i[e].assign(t),!0):Reflect.set(n,e,t,i)}},ZS=new WeakMap,YN=new WeakMap,E6=function(n,e=null){const t=Yg(n);if(t==="node"){let i=ZS.get(n);return i===void 0&&(i=new Proxy(n,qN),ZS.set(n,i),ZS.set(i,i)),i}else{if(e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string")return pe(nT(n,e));if(t==="shader")return me(n)}return n},A6=function(n,e=null){for(const t in n)n[t]=pe(n[t],e);return n},C6=function(n,e=null){const t=n.length;for(let i=0;i<t;i++)n[i]=pe(n[i],e);return n},R6=function(n,e=null,t=null,i=null){const r=s=>pe(i!==null?Object.assign(s,i):s);return e===null?(...s)=>r(new n(...Xc(s))):t!==null?(t=pe(t),(...s)=>r(new n(e,...Xc(s),t))):(...s)=>r(new n(e,...Xc(s)))},N6=function(n,...e){return pe(new n(...Xc(e)))};class P6 extends tt{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}call(e){const{shaderNode:t,inputNodes:i}=this,r=e.getNodeProperties(t);if(r.onceOutput)return r.onceOutput;let s=null;if(t.layout){let o=YN.get(e.constructor);o===void 0&&(o=new WeakMap,YN.set(e.constructor,o));let a=o.get(t);a===void 0&&(a=pe(e.buildFunctionNode(t)),o.set(t,a)),e.currentFunctionNode!==null&&e.currentFunctionNode.includes.push(a),s=pe(a.call(i))}else{const o=t.jsFunc,a=i!==null?o(i,e):o(e);s=pe(a)}return t.once&&(r.onceOutput=s),s}getOutputNode(e){const t=e.getNodeProperties(this);return t.outputNode===null&&(t.outputNode=this.setupOutput(e)),t.outputNode}setup(e){return this.getOutputNode(e)}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,t){return this.getOutputNode(e).build(e,t)}}class D6 extends tt{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}call(e=null){return Jg(e),pe(new P6(this,e))}setup(){return this.call()}}const L6=[!1,!0],I6=[0,1,2,3],U6=[-1,-2],KN=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],JS=new Map;for(const n of L6)JS.set(n,new Co(n));const eT=new Map;for(const n of I6)eT.set(n,new Co(n,"uint"));const tT=new Map([...eT].map(n=>new Co(n.value,"int")));for(const n of U6)tT.set(n,new Co(n,"int"));const Kg=new Map([...tT].map(n=>new Co(n.value)));for(const n of KN)Kg.set(n,new Co(n));for(const n of KN)Kg.set(-n,new Co(-n));const Qg={bool:JS,uint:eT,ints:tT,float:Kg},QN=new Map([...JS,...Kg]),nT=(n,e)=>QN.has(n)?QN.get(n):n.isNode===!0?n:new Co(n,e),F6=n=>{try{return n.getNodeType()}catch{return}},wn=function(n,e=null){return(...t)=>{if((t.length===0||!["bool","float","int","uint"].includes(n)&&t.every(r=>typeof r!="object"))&&(t=[kN(n,...t)]),t.length===1&&e!==null&&e.has(t[0]))return pe(e.get(t[0]));if(t.length===1){const r=nT(t[0],n);return F6(r)===n?pe(r):pe(new WN(r,n))}const i=t.map(r=>nT(r));return pe(new T6(i,n))}},ZN=n=>typeof n=="object"&&n!==null?n.value:n,O6=n=>n!=null?n.nodeType||n.convertTo||(typeof n=="string"?n:null):null;function Zg(n,e){return new Proxy(new D6(n,e),qN)}const pe=(n,e=null)=>E6(n,e),Jg=(n,e=null)=>new A6(n,e),Xc=(n,e=null)=>new C6(n,e),oe=(...n)=>new R6(...n),ve=(...n)=>new N6(...n),me=(n,e)=>{const t=new Zg(n,e),i=(...r)=>{let s;return Jg(r),r[0]&&r[0].isNode?s=[...r]:s=r[0],t.call(s)};return i.shaderNode=t,i.setLayout=r=>(t.setLayout(r),i),i.once=()=>(t.once=!0,i),i};ee("toGlobal",n=>(n.global=!0,n));const e_=n=>{$c=n},JN=()=>$c,Mn=(...n)=>$c.If(...n);function B6(n){return $c&&$c.add(n),n}ee("append",B6);const k6=new wn("color"),ne=new wn("float",Qg.float),cn=new wn("int",Qg.ints),z6=new wn("uint",Qg.uint),eP=new wn("bool",Qg.bool),ye=new wn("vec2"),Ro=new wn("ivec2"),G6=new wn("uvec2"),V6=new wn("bvec2"),ie=new wn("vec3"),H6=new wn("ivec3"),W6=new wn("uvec3"),$6=new wn("bvec3"),Qe=new wn("vec4"),j6=new wn("ivec4"),X6=new wn("uvec4"),q6=new wn("bvec4"),iT=new wn("mat2"),Pi=new wn("mat3"),qc=new wn("mat4");ee("toColor",k6),ee("toFloat",ne),ee("toInt",cn),ee("toUint",z6),ee("toBool",eP),ee("toVec2",ye),ee("toIVec2",Ro),ee("toUVec2",G6),ee("toBVec2",V6),ee("toVec3",ie),ee("toIVec3",H6),ee("toUVec3",W6),ee("toBVec3",$6),ee("toVec4",Qe),ee("toIVec4",j6),ee("toUVec4",X6),ee("toBVec4",q6),ee("toMat2",iT),ee("toMat3",Pi),ee("toMat4",qc);const Y6=oe(yf),K6=(n,e)=>pe(new WN(pe(n),e));ee("element",Y6),ee("convert",K6);class tP extends tt{static get type(){return"UniformGroupNode"}constructor(e,t=!1,i=1){super("string"),this.name=e,this.shared=t,this.order=i,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const Q6=n=>new tP(n),nP=(n,e=0)=>new tP(n,!0,e),Z6=nP("frame"),Xe=nP("render"),iP=Q6("object");class xf extends QS{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=iP}label(e){return this.name=e,this}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){const i=this.getSelf();return e=e.bind(i),super.onUpdate(r=>{const s=e(r,i);s!==void 0&&(this.value=s)},t)}generate(e,t){const i=this.getNodeType(e),r=this.getUniformHash(e);let s=e.getNodeFromHash(r);s===void 0&&(e.setHashNode(this,r),s=this);const o=s.getInputType(e),a=e.getUniformFromNode(s,o,e.shaderStage,this.name||e.context.label),l=e.getPropertyName(a);return e.context.label!==void 0&&delete e.context.label,e.format(l,i,t)}}const Ze=(n,e)=>{const t=O6(e||n),i=n&&n.isNode===!0?n.node&&n.node.value||n.value:n;return pe(new xf(i,t))};class Ct extends tt{static get type(){return"PropertyNode"}constructor(e,t=null,i=!1){super(e),this.name=t,this.varying=i,this.isPropertyNode=!0}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const J6=(n,e)=>pe(new Ct(n,e)),t_=(n,e)=>pe(new Ct(n,e,!0)),Mt=ve(Ct,"vec4","DiffuseColor"),rP=ve(Ct,"vec3","EmissiveColor"),No=ve(Ct,"float","Roughness"),n_=ve(Ct,"float","Metalness"),rT=ve(Ct,"float","Clearcoat"),i_=ve(Ct,"float","ClearcoatRoughness"),Yc=ve(Ct,"vec3","Sheen"),sT=ve(Ct,"float","SheenRoughness"),oT=ve(Ct,"float","Iridescence"),sP=ve(Ct,"float","IridescenceIOR"),oP=ve(Ct,"float","IridescenceThickness"),aT=ve(Ct,"float","AlphaT"),Bl=ve(Ct,"float","Anisotropy"),r_=ve(Ct,"vec3","AnisotropyT"),Kc=ve(Ct,"vec3","AnisotropyB"),xr=ve(Ct,"color","SpecularColor"),s_=ve(Ct,"float","SpecularF90"),lT=ve(Ct,"float","Shininess"),o_=ve(Ct,"vec4","Output"),uT=ve(Ct,"float","dashSize"),aP=ve(Ct,"float","gapSize"),a_=ve(Ct,"float","IOR"),cT=ve(Ct,"float","Transmission"),lP=ve(Ct,"float","Thickness"),uP=ve(Ct,"float","AttenuationDistance"),cP=ve(Ct,"color","AttenuationColor"),hP=ve(Ct,"float","Dispersion");class eW extends On{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const i=e.getTypeLength(t.node.getNodeType(e));return Wc.join("").slice(0,i)!==t.components}return!1}generate(e,t){const{targetNode:i,sourceNode:r}=this,s=this.needsSplitAssign(e),o=i.getNodeType(e),a=i.context({assign:!0}).build(e),l=r.build(e,o),u=r.getNodeType(e),c=e.getDataFromNode(this);let h;if(c.initialized===!0)t!=="void"&&(h=a);else if(s){const d=e.getVarFromNode(this,null,o),f=e.getPropertyName(d);e.addLineFlowCode(`${f} = ${l}`,this);const m=i.node.context({assign:!0}).build(e);for(let g=0;g<i.components.length;g++){const _=i.components[g];e.addLineFlowCode(`${m}.${_} = ${f}[ ${g} ]`,this)}t!=="void"&&(h=a)}else h=`${a} = ${l}`,(t==="void"||u==="void")&&(e.addLineFlowCode(h,this),t!=="void"&&(h=a));return c.initialized=!0,e.format(h,o,t)}}ee("assign",oe(eW));class tW extends On{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const t=[],i=this.functionNode,r=i.getInputs(e),s=this.parameters,o=(l,u)=>{const c=u.type,h=c==="pointer";let d;return h?d="&"+l.build(e):d=l.build(e,c),d};if(Array.isArray(s))for(let l=0;l<s.length;l++)t.push(o(s[l],r[l]));else for(const l of r){const u=s[l.name];if(u!==void 0)t.push(o(u,l));else throw new Error(`FunctionCallNode: Input '${l.name}' not found in FunctionNode.`)}return`${i.build(e,"property")}( ${t.join(", ")} )`}}ee("call",(n,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?Xc(e):Jg(e[0]),pe(new tW(pe(n),e))));class Yt extends On{static get type(){return"OperatorNode"}constructor(e,t,i,...r){if(super(),r.length>0){let s=new Yt(e,t,i);for(let o=0;o<r.length-1;o++)s=new Yt(e,s,r[o]);t=s,i=r[r.length-1]}this.op=e,this.aNode=t,this.bNode=i}getNodeType(e,t){const i=this.op,r=this.aNode,s=this.bNode,o=r.getNodeType(e),a=typeof s<"u"?s.getNodeType(e):null;if(o==="void"||a==="void")return"void";if(i==="%")return o;if(i==="~"||i==="&"||i==="|"||i==="^"||i===">>"||i==="<<")return e.getIntegerType(o);if(i==="!"||i==="=="||i==="&&"||i==="||"||i==="^^")return"bool";if(i==="<"||i===">"||i==="<="||i===">="){const l=t?e.getTypeLength(t):Math.max(e.getTypeLength(o),e.getTypeLength(a));return l>1?`bvec${l}`:"bool"}else return o==="float"&&e.isMatrix(a)?a:e.isMatrix(o)&&e.isVector(a)?e.getVectorFromMatrix(o):e.isVector(o)&&e.isMatrix(a)?e.getVectorFromMatrix(a):e.getTypeLength(a)>e.getTypeLength(o)?a:o}generate(e,t){const i=this.op,r=this.aNode,s=this.bNode,o=this.getNodeType(e,t);let a=null,l=null;o!=="void"?(a=r.getNodeType(e),l=typeof s<"u"?s.getNodeType(e):null,i==="<"||i===">"||i==="<="||i===">="||i==="=="?e.isVector(a)?l=a:a!==l&&(a=l="float"):i===">>"||i==="<<"?(a=o,l=e.changeComponentType(l,"uint")):e.isMatrix(a)&&e.isVector(l)?l=e.getVectorFromMatrix(a):e.isVector(a)&&e.isMatrix(l)?a=e.getVectorFromMatrix(l):a=l=o):a=l=o;const u=r.build(e,a),c=typeof s<"u"?s.build(e,l):null,h=e.getTypeLength(t),d=e.getFunctionOperator(i);if(t!=="void")return i==="<"&&h>1?e.useComparisonMethod?e.format(`${e.getMethod("lessThan",t)}( ${u}, ${c} )`,o,t):e.format(`( ${u} < ${c} )`,o,t):i==="<="&&h>1?e.useComparisonMethod?e.format(`${e.getMethod("lessThanEqual",t)}( ${u}, ${c} )`,o,t):e.format(`( ${u} <= ${c} )`,o,t):i===">"&&h>1?e.useComparisonMethod?e.format(`${e.getMethod("greaterThan",t)}( ${u}, ${c} )`,o,t):e.format(`( ${u} > ${c} )`,o,t):i===">="&&h>1?e.useComparisonMethod?e.format(`${e.getMethod("greaterThanEqual",t)}( ${u}, ${c} )`,o,t):e.format(`( ${u} >= ${c} )`,o,t):i==="!"||i==="~"?e.format(`(${i}${u})`,a,t):d?e.format(`${d}( ${u}, ${c} )`,o,t):e.format(`( ${u} ${i} ${c} )`,o,t);if(a!=="void")return d?e.format(`${d}( ${u}, ${c} )`,o,t):e.format(`${u} ${i} ${c}`,o,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const Di=oe(Yt,"+"),ji=oe(Yt,"-"),ht=oe(Yt,"*"),Po=oe(Yt,"/"),dP=oe(Yt,"%"),nW=oe(Yt,"=="),iW=oe(Yt,"!="),rW=oe(Yt,"<"),sW=oe(Yt,">"),oW=oe(Yt,"<="),aW=oe(Yt,">="),lW=oe(Yt,"&&"),uW=oe(Yt,"||"),cW=oe(Yt,"!"),hW=oe(Yt,"^^"),dW=oe(Yt,"&"),fW=oe(Yt,"~"),pW=oe(Yt,"|"),mW=oe(Yt,"^"),gW=oe(Yt,"<<"),_W=oe(Yt,">>");ee("add",Di),ee("sub",ji),ee("mul",ht),ee("div",Po),ee("modInt",dP),ee("equal",nW),ee("notEqual",iW),ee("lessThan",rW),ee("greaterThan",sW),ee("lessThanEqual",oW),ee("greaterThanEqual",aW),ee("and",lW),ee("or",uW),ee("not",cW),ee("xor",hW),ee("bitAnd",dW),ee("bitNot",fW),ee("bitOr",pW),ee("bitXor",mW),ee("shiftLeft",gW),ee("shiftRight",_W),ee("remainder",(...n)=>(console.warn("TSL.OperatorNode: .remainder() has been renamed to .modInt()."),dP(...n)));class V extends On{static get type(){return"MathNode"}constructor(e,t,i=null,r=null){super(),this.method=e,this.aNode=t,this.bNode=i,this.cNode=r}getInputType(e){const t=this.aNode.getNodeType(e),i=this.bNode?this.bNode.getNodeType(e):null,r=this.cNode?this.cNode.getNodeType(e):null,s=e.isMatrix(t)?0:e.getTypeLength(t),o=e.isMatrix(i)?0:e.getTypeLength(i),a=e.isMatrix(r)?0:e.getTypeLength(r);return s>o&&s>a?t:o>a?i:a>s?r:t}getNodeType(e){const t=this.method;return t===V.LENGTH||t===V.DISTANCE||t===V.DOT?"float":t===V.CROSS?"vec3":t===V.ALL?"bool":t===V.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):t===V.MOD?this.aNode.getNodeType(e):this.getInputType(e)}generate(e,t){let i=this.method;const r=this.getNodeType(e),s=this.getInputType(e),o=this.aNode,a=this.bNode,l=this.cNode,u=e.renderer.coordinateSystem;if(i===V.TRANSFORM_DIRECTION){let c=o,h=a;e.isMatrix(c.getNodeType(e))?h=Qe(ie(h),0):c=Qe(ie(c),0);const d=ht(c,h).xyz;return Tf(d).build(e,t)}else{if(i===V.NEGATE)return e.format("( - "+o.build(e,s)+" )",r,t);if(i===V.ONE_MINUS)return ji(1,o).build(e,t);if(i===V.RECIPROCAL)return Po(1,o).build(e,t);if(i===V.DIFFERENCE)return Hr(ji(o,a)).build(e,t);{const c=[];return i===V.CROSS||i===V.MOD?c.push(o.build(e,r),a.build(e,r)):u===Vi&&i===V.STEP?c.push(o.build(e,e.getTypeLength(o.getNodeType(e))===1?"float":s),a.build(e,s)):u===Vi&&(i===V.MIN||i===V.MAX)||i===V.MOD?c.push(o.build(e,s),a.build(e,e.getTypeLength(a.getNodeType(e))===1?"float":s)):i===V.REFRACT?c.push(o.build(e,s),a.build(e,s),l.build(e,"float")):i===V.MIX?c.push(o.build(e,s),a.build(e,s),l.build(e,e.getTypeLength(l.getNodeType(e))===1?"float":s)):(u===ya&&i===V.ATAN&&a!==null&&(i="atan2"),c.push(o.build(e,s)),a!==null&&c.push(a.build(e,s)),l!==null&&c.push(l.build(e,s))),e.format(`${e.getMethod(i,r)}( ${c.join(", ")} )`,r,t)}}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}V.ALL="all",V.ANY="any",V.RADIANS="radians",V.DEGREES="degrees",V.EXP="exp",V.EXP2="exp2",V.LOG="log",V.LOG2="log2",V.SQRT="sqrt",V.INVERSE_SQRT="inversesqrt",V.FLOOR="floor",V.CEIL="ceil",V.NORMALIZE="normalize",V.FRACT="fract",V.SIN="sin",V.COS="cos",V.TAN="tan",V.ASIN="asin",V.ACOS="acos",V.ATAN="atan",V.ABS="abs",V.SIGN="sign",V.LENGTH="length",V.NEGATE="negate",V.ONE_MINUS="oneMinus",V.DFDX="dFdx",V.DFDY="dFdy",V.ROUND="round",V.RECIPROCAL="reciprocal",V.TRUNC="trunc",V.FWIDTH="fwidth",V.TRANSPOSE="transpose",V.BITCAST="bitcast",V.EQUALS="equals",V.MIN="min",V.MAX="max",V.MOD="mod",V.STEP="step",V.REFLECT="reflect",V.DISTANCE="distance",V.DIFFERENCE="difference",V.DOT="dot",V.CROSS="cross",V.POW="pow",V.TRANSFORM_DIRECTION="transformDirection",V.MIX="mix",V.CLAMP="clamp",V.REFRACT="refract",V.SMOOTHSTEP="smoothstep",V.FACEFORWARD="faceforward";const vW=ne(1e-6),yW=ne(Math.PI),fP=oe(V,V.ALL),xW=oe(V,V.ANY),SW=oe(V,V.RADIANS),TW=oe(V,V.DEGREES),pP=oe(V,V.EXP),Sf=oe(V,V.EXP2),mP=oe(V,V.LOG),Do=oe(V,V.LOG2),hT=oe(V,V.SQRT),bW=oe(V,V.INVERSE_SQRT),kl=oe(V,V.FLOOR),dT=oe(V,V.CEIL),Tf=oe(V,V.NORMALIZE),Da=oe(V,V.FRACT),ps=oe(V,V.SIN),La=oe(V,V.COS),wW=oe(V,V.TAN),MW=oe(V,V.ASIN),EW=oe(V,V.ACOS),gP=oe(V,V.ATAN),Hr=oe(V,V.ABS),l_=oe(V,V.SIGN),Ia=oe(V,V.LENGTH),AW=oe(V,V.NEGATE),CW=oe(V,V.ONE_MINUS),_P=oe(V,V.DFDX),vP=oe(V,V.DFDY),RW=oe(V,V.ROUND),NW=oe(V,V.RECIPROCAL),PW=oe(V,V.TRUNC),DW=oe(V,V.FWIDTH),LW=oe(V,V.TRANSPOSE);V.BITCAST;const IW=oe(V,V.EQUALS),bf=oe(V,V.MIN),Xi=oe(V,V.MAX),yP=oe(V,V.MOD),xP=oe(V,V.STEP),UW=oe(V,V.REFLECT),FW=oe(V,V.DISTANCE),OW=oe(V,V.DIFFERENCE),fT=oe(V,V.DOT),SP=oe(V,V.CROSS),u_=oe(V,V.POW),TP=oe(V,V.POW,2),BW=oe(V,V.POW,3),kW=oe(V,V.POW,4),zW=oe(V,V.TRANSFORM_DIRECTION),GW=n=>ht(l_(n),u_(Hr(n),1/3)),VW=n=>fT(n,n),Ht=oe(V,V.MIX),Lo=(n,e=0,t=1)=>pe(new V(V.CLAMP,pe(n),pe(e),pe(t))),HW=n=>Lo(n),bP=oe(V,V.REFRACT),zl=oe(V,V.SMOOTHSTEP),WW=oe(V,V.FACEFORWARD),$W=me(([n])=>{const i=43758.5453,r=fT(n.xy,ye(12.9898,78.233)),s=yP(r,yW);return Da(ps(s).mul(i))}),jW=(n,e,t)=>Ht(e,t,n),XW=(n,e,t)=>zl(e,t,n),qW=(n,e)=>(console.warn('THREE.TSL: "atan2" is overloaded. Use "atan" instead.'),gP(n,e));ee("all",fP),ee("any",xW),ee("equals",IW),ee("radians",SW),ee("degrees",TW),ee("exp",pP),ee("exp2",Sf),ee("log",mP),ee("log2",Do),ee("sqrt",hT),ee("inverseSqrt",bW),ee("floor",kl),ee("ceil",dT),ee("normalize",Tf),ee("fract",Da),ee("sin",ps),ee("cos",La),ee("tan",wW),ee("asin",MW),ee("acos",EW),ee("atan",gP),ee("abs",Hr),ee("sign",l_),ee("length",Ia),ee("lengthSq",VW),ee("negate",AW),ee("oneMinus",CW),ee("dFdx",_P),ee("dFdy",vP),ee("round",RW),ee("reciprocal",NW),ee("trunc",PW),ee("fwidth",DW),ee("atan2",qW),ee("min",bf),ee("max",Xi),ee("mod",yP),ee("step",xP),ee("reflect",UW),ee("distance",FW),ee("dot",fT),ee("cross",SP),ee("pow",u_),ee("pow2",TP),ee("pow3",BW),ee("pow4",kW),ee("transformDirection",zW),ee("mix",jW),ee("clamp",Lo),ee("refract",bP),ee("smoothstep",XW),ee("faceForward",WW),ee("difference",OW),ee("saturate",HW),ee("cbrt",GW),ee("transpose",LW),ee("rand",$W);class YW extends tt{static get type(){return"ConditionalNode"}constructor(e,t,i=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=i}getNodeType(e){const{ifNode:t,elseNode:i}=e.getNodeProperties(this);if(t===void 0)return this.setup(e),this.getNodeType(e);const r=t.getNodeType(e);if(i!==null){const s=i.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(r))return s}return r}setup(e){const t=this.condNode.cache(),i=this.ifNode.cache(),r=this.elseNode?this.elseNode.cache():null,s=e.context.nodeBlock;e.getDataFromNode(i).parentNodeBlock=s,r!==null&&(e.getDataFromNode(r).parentNodeBlock=s);const o=e.getNodeProperties(this);o.condNode=t,o.ifNode=i.context({nodeBlock:i}),o.elseNode=r?r.context({nodeBlock:r}):null}generate(e,t){const i=this.getNodeType(e),r=e.getDataFromNode(this);if(r.nodeProperty!==void 0)return r.nodeProperty;const{condNode:s,ifNode:o,elseNode:a}=e.getNodeProperties(this),l=t!=="void",u=l?J6(i).build(e):"";r.nodeProperty=u;const c=s.build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${c} ) {

`).addFlowTab();let h=o.build(e,i);if(h&&(l?h=u+" = "+h+";":h="return "+h+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+h+`

`+e.tab+"}"),a!==null){e.addFlowCode(` else {

`).addFlowTab();let d=a.build(e,i);d&&(l?d=u+" = "+d+";":d="return "+d+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+d+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(u,i,t)}}const qi=oe(YW);ee("select",qi),ee("cond",(...n)=>(console.warn("TSL.ConditionalNode: cond() has been renamed to select()."),qi(...n)));class wP extends tt{static get type(){return"ContextNode"}constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}analyze(e){this.node.build(e)}setup(e){const t=e.getContext();e.setContext({...e.context,...this.value});const i=this.node.build(e);return e.setContext(t),i}generate(e,t){const i=e.getContext();e.setContext({...e.context,...this.value});const r=this.node.build(e,t);return e.setContext(i),r}}const pT=oe(wP),KW=(n,e)=>pT(n,{label:e});ee("context",pT),ee("label",KW);class c_ extends tt{static get type(){return"VarNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:t,name:i}=this,r=e.getVarFromNode(this,i,e.getVectorType(this.getNodeType(e))),s=e.getPropertyName(r),o=t.build(e,r.type);return e.addLineFlowCode(`${s} = ${o}`,this),s}}const MP=oe(c_);ee("toVar",(...n)=>MP(...n).append()),ee("temp",n=>(console.warn('TSL: "temp" is deprecated. Use ".toVar()" instead.'),MP(n)));class QW extends tt{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let i=t.varying;if(i===void 0){const r=this.name,s=this.getNodeType(e);t.varying=i=e.getVaryingFromNode(this,r,s),t.node=this.node}return i.needsInterpolation||(i.needsInterpolation=e.shaderStage==="fragment"),i}setup(e){this.setupVarying(e)}analyze(e){return this.setupVarying(e),this.node.analyze(e)}generate(e){const t=e.getNodeProperties(this),i=this.setupVarying(e),r=e.shaderStage==="fragment"&&t.reassignPosition===!0&&e.context.needsPositionReassign;if(t.propertyName===void 0||r){const s=this.getNodeType(e),o=e.getPropertyName(i,GN.VERTEX);e.flowNodeFromShaderStage(GN.VERTEX,this.node,s,o),t.propertyName=o,r?t.reassignPosition=!1:t.reassignPosition===void 0&&e.context.isPositionNodeInput&&(t.reassignPosition=!0)}return e.getPropertyName(i)}}const Io=oe(QW),ZW=n=>Io(n);ee("varying",Io),ee("vertexStage",ZW);const JW=me(([n])=>{const e=n.mul(.9478672986).add(.0521327014).pow(2.4),t=n.mul(.0773993808),i=n.lessThanEqual(.04045);return Ht(e,t,i)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),e$=me(([n])=>{const e=n.pow(.41666).mul(1.055).sub(.055),t=n.mul(12.92),i=n.lessThanEqual(.0031308);return Ht(e,t,i)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),wf="WorkingColorSpace",mT="OutputColorSpace";class h_ extends On{static get type(){return"ColorSpaceNode"}constructor(e,t,i){super("vec4"),this.colorNode=e,this.source=t,this.target=i}resolveColorSpace(e,t){return t===wf?st.workingColorSpace:t===mT?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,i=this.resolveColorSpace(e,this.source),r=this.resolveColorSpace(e,this.target);let s=t;return st.enabled===!1||i===r||!i||!r||(st.getTransfer(i)===At&&(s=Qe(JW(s.rgb),s.a)),st.getPrimaries(i)!==st.getPrimaries(r)&&(s=Qe(Pi(st._getMatrix(new je,i,r)).mul(s.rgb),s.a)),st.getTransfer(r)===At&&(s=Qe(e$(s.rgb),s.a))),s}}const t$=n=>pe(new h_(pe(n),wf,mT)),n$=n=>pe(new h_(pe(n),mT,wf)),i$=(n,e)=>pe(new h_(pe(n),wf,e)),EP=(n,e)=>pe(new h_(pe(n),e,wf));ee("toOutputColorSpace",t$),ee("toWorkingColorSpace",n$),ee("workingToColorSpace",i$),ee("colorSpaceToWorking",EP);let r$=class extends yf{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),i=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,i,r)}};class AP extends tt{static get type(){return"ReferenceBaseNode"}constructor(e,t,i=null,r=null){super(),this.property=e,this.uniformType=t,this.object=i,this.count=r,this.properties=e.split("."),this.reference=i,this.node=null,this.group=null,this.updateType=at.OBJECT}setGroup(e){return this.group=e,this}element(e){return pe(new r$(this,pe(e)))}setNodeType(e){const t=Ze(null,e).getSelf();this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let i=e[t[0]];for(let r=1;r<t.length;r++)i=i[t[r]];return i}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const s$=(n,e,t)=>pe(new AP(n,e,t));class o$ extends AP{static get type(){return"RendererReferenceNode"}constructor(e,t,i=null){super(e,t,i),this.renderer=i,this.setGroup(Xe)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const a$=(n,e,t=null)=>pe(new o$(n,e,t));class l$ extends On{static get type(){return"ToneMappingNode"}constructor(e,t=c$,i=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=i}customCacheKey(){return KS(this.toneMapping)}setup(e){const t=this.colorNode||e.context.color,i=this.toneMapping;if(i===Gi)return t;let r=null;const s=e.renderer.library.getToneMappingFunction(i);return s!==null?r=Qe(s(t.rgb,this.exposureNode),t.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",i),r=t),r}}const u$=(n,e,t)=>pe(new l$(n,pe(e),pe(t))),c$=a$("toneMappingExposure","float");ee("toneMapping",(n,e,t)=>u$(e,t,n));class h$ extends QS{static get type(){return"BufferAttributeNode"}constructor(e,t=null,i=0,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=i,this.bufferOffset=r,this.usage=km,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),i=this.value,r=e.getTypeLength(t),s=this.bufferStride||r,o=this.bufferOffset,a=i.isInterleavedBuffer===!0?i:new Lx(i,s),l=new Wd(a,r,o);a.setUsage(this.usage),this.attribute=l,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),i=e.getBufferAttributeFromNode(this,t),r=e.getPropertyName(i);let s=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=r,s=r):s=Io(this).build(e,t),s}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const gT=(n,e=null,t=0,i=0)=>pe(new h$(n,e,t,i)),d$=(n,e=null,t=0,i=0)=>gT(n,e,t,i).setUsage(hc),CP=(n,e=null,t=0,i=0)=>gT(n,e,t,i).setInstanced(!0),RP=(n,e=null,t=0,i=0)=>d$(n,e,t,i).setInstanced(!0);ee("toAttribute",n=>gT(n.value));class f$ extends tt{static get type(){return"ComputeNode"}constructor(e,t,i=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=i,this.dispatchCount=0,this.version=1,this.name="",this.updateBeforeType=at.OBJECT,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}label(e){return this.name=e,this}updateDispatchCount(){const{count:e,workgroupSize:t}=this;let i=t[0];for(let r=1;r<t.length;r++)i*=t[r];this.dispatchCount=Math.ceil(e/i)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}generate(e){const{shaderStage:t}=e;if(t==="compute"){const i=this.computeNode.build(e,"void");i!==""&&e.addLineFlowCode(i,this)}}}ee("compute",(n,e,t)=>pe(new f$(pe(n),e,t)));class p$ extends tt{static get type(){return"CacheNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isCacheNode=!0}getNodeType(e){const t=e.getCache(),i=e.getCacheFromNode(this,this.parent);e.setCache(i);const r=this.node.getNodeType(e);return e.setCache(t),r}build(e,...t){const i=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);const s=this.node.build(e,...t);return e.setCache(i),s}}const d_=(n,e)=>pe(new p$(pe(n),e));ee("cache",d_);class m$ extends tt{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}ee("bypass",oe(m$));class NP extends tt{static get type(){return"RemapNode"}constructor(e,t,i,r=ne(0),s=ne(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=i,this.outLowNode=r,this.outHighNode=s,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:i,outLowNode:r,outHighNode:s,doClamp:o}=this;let a=e.sub(t).div(i.sub(t));return o===!0&&(a=a.clamp()),a.mul(s.sub(r)).add(r)}}const g$=oe(NP,null,null,{doClamp:!1}),_$=oe(NP);ee("remap",g$),ee("remapClamp",_$);class f_ extends tt{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const i=this.getNodeType(e),r=this.snippet;if(i==="void")e.addLineFlowCode(r,this);else return e.format(`( ${r} )`,i,t)}}const Mf=oe(f_);ee("discard",n=>(n?qi(n,Mf("discard")):Mf("discard")).append());class v$ extends On{static get type(){return"RenderOutputNode"}constructor(e,t,i){super("vec4"),this.colorNode=e,this.toneMapping=t,this.outputColorSpace=i,this.isRenderOutputNode=!0}setup({context:e}){let t=this.colorNode||e.color;const i=(this.toneMapping!==null?this.toneMapping:e.toneMapping)||Gi,r=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||pr;return i!==Gi&&(t=t.toneMapping(i)),r!==pr&&r!==st.workingColorSpace&&(t=t.workingToColorSpace(r)),t}}ee("renderOutput",(n,e=null,t=null)=>pe(new v$(pe(n),e,t)));class y$ extends tt{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const i=this.getAttributeName(e);if(e.hasGeometryAttribute(i)){const r=e.geometry.getAttribute(i);t=e.getTypeFromAttribute(r)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),i=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const s=e.geometry.getAttribute(t),o=e.getTypeFromAttribute(s),a=e.getAttribute(t,o);return e.shaderStage==="vertex"?e.format(a.name,o,i):Io(this).build(e,i)}else return console.warn(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(i)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const Uo=(n,e)=>pe(new y$(n,e)),p_=(n=0)=>Uo("uv"+(n>0?n:""),"vec2");class x$ extends tt{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const i=this.textureNode.build(e,"property"),r=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${i}, ${r} )`,this.getNodeType(e),t)}}const Ef=oe(x$);class S$ extends xf{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=at.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,i=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(i&&i.width!==void 0){const{width:r,height:s}=i;this.value=Math.log2(Math.max(r,s))}}}const T$=oe(S$);class Af extends xf{static get type(){return"TextureNode"}constructor(e,t=null,i=null,r=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=i,this.biasNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=at.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===rn?"uvec4":this.value.type===Hn?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return p_(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=Ze(this.value.matrix)),this._matrixUniform.mul(ie(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?at.RENDER:at.NONE,this}setupUV(e,t){const i=this.value;return e.isFlipY()&&(i.image instanceof ImageBitmap&&i.flipY===!0||i.isRenderTargetTexture===!0||i.isFramebufferTexture===!0||i.isDepthTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(cn(Ef(this,this.levelNode).y).sub(t.y).sub(1))),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const i=this.value;if(!i||i.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");let r=this.uvNode;(r===null||e.context.forceUVContext===!0)&&e.context.getUV&&(r=e.context.getUV(this)),r||(r=this.getDefaultUV()),this.updateMatrix===!0&&(r=this.getTransformedUV(r)),r=this.setupUV(e,r);let s=this.levelNode;s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),t.uvNode=r,t.levelNode=s,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateSnippet(e,t,i,r,s,o,a,l){const u=this.value;let c;return r?c=e.generateTextureLevel(u,t,i,r,o):s?c=e.generateTextureBias(u,t,i,s,o):l?c=e.generateTextureGrad(u,t,i,l,o):a?c=e.generateTextureCompare(u,t,i,a,o):this.sampler===!1?c=e.generateTextureLoad(u,t,i,o):c=e.generateTexture(u,t,i,o),c}generate(e,t){const i=this.value,r=e.getNodeProperties(this),s=super.generate(e,"property");if(t==="sampler")return s+"_sampler";if(e.isReference(t))return s;{const o=e.getDataFromNode(this);let a=o.propertyName;if(a===void 0){const{uvNode:c,levelNode:h,biasNode:d,compareNode:f,depthNode:m,gradNode:g}=r,_=this.generateUV(e,c),p=h?h.build(e,"float"):null,v=d?d.build(e,"float"):null,y=m?m.build(e,"int"):null,x=f?f.build(e,"float"):null,S=g?[g[0].build(e,"vec2"),g[1].build(e,"vec2")]:null,T=e.getVarFromNode(this);a=e.getPropertyName(T);const w=this.generateSnippet(e,s,_,p,v,y,x,S);e.addLineFlowCode(`${a} = ${w}`,this),o.snippet=w,o.propertyName=a}let l=a;const u=this.getNodeType(e);return e.needsToWorkingColorSpace(i)&&(l=EP(Mf(l,u),i.colorSpace).setup(e).build(e,u)),e.format(l,u,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return console.warn("THREE.TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=pe(e),t.referenceNode=this.getSelf(),pe(t)}blur(e){const t=this.clone();return t.biasNode=pe(e).mul(T$(t)),t.referenceNode=this.getSelf(),pe(t)}level(e){const t=this.clone();return t.levelNode=pe(e),t.referenceNode=this.getSelf(),pe(t)}size(e){return Ef(this,e)}bias(e){const t=this.clone();return t.biasNode=pe(e),t.referenceNode=this.getSelf(),pe(t)}compare(e){const t=this.clone();return t.compareNode=pe(e),t.referenceNode=this.getSelf(),pe(t)}grad(e,t){const i=this.clone();return i.gradNode=[pe(e),pe(t)],i.referenceNode=this.getSelf(),pe(i)}depth(e){const t=this.clone();return t.depthNode=pe(e),t.referenceNode=this.getSelf(),pe(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e}}const xt=oe(Af),ms=(...n)=>xt(...n).setSampler(!1),Gl=Ze("float").label("cameraNear").setGroup(Xe).onRenderUpdate(({camera:n})=>n.near),Vl=Ze("float").label("cameraFar").setGroup(Xe).onRenderUpdate(({camera:n})=>n.far),_T=Ze("mat4").label("cameraProjectionMatrix").setGroup(Xe).onRenderUpdate(({camera:n})=>n.projectionMatrix),Fo=Ze("mat4").label("cameraViewMatrix").setGroup(Xe).onRenderUpdate(({camera:n})=>n.matrixWorldInverse),b$=Ze(new N).label("cameraPosition").setGroup(Xe).onRenderUpdate(({camera:n},e)=>e.value.setFromMatrixPosition(n.matrixWorld));class bt extends tt{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=at.OBJECT,this._uniformNode=new xf(null)}getNodeType(){const e=this.scope;if(e===bt.WORLD_MATRIX)return"mat4";if(e===bt.POSITION||e===bt.VIEW_POSITION||e===bt.DIRECTION||e===bt.SCALE)return"vec3"}update(e){const t=this.object3d,i=this._uniformNode,r=this.scope;if(r===bt.WORLD_MATRIX)i.value=t.matrixWorld;else if(r===bt.POSITION)i.value=i.value||new N,i.value.setFromMatrixPosition(t.matrixWorld);else if(r===bt.SCALE)i.value=i.value||new N,i.value.setFromMatrixScale(t.matrixWorld);else if(r===bt.DIRECTION)i.value=i.value||new N,t.getWorldDirection(i.value);else if(r===bt.VIEW_POSITION){const s=e.camera;i.value=i.value||new N,i.value.setFromMatrixPosition(t.matrixWorld),i.value.applyMatrix4(s.matrixWorldInverse)}}generate(e){const t=this.scope;return t===bt.WORLD_MATRIX?this._uniformNode.nodeType="mat4":(t===bt.POSITION||t===bt.VIEW_POSITION||t===bt.DIRECTION||t===bt.SCALE)&&(this._uniformNode.nodeType="vec3"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}bt.WORLD_MATRIX="worldMatrix",bt.POSITION="position",bt.SCALE="scale",bt.VIEW_POSITION="viewPosition",bt.DIRECTION="direction",bt.DIRECTION,bt.WORLD_MATRIX;const w$=oe(bt,bt.POSITION);bt.SCALE,bt.VIEW_POSITION;class Us extends bt{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}Us.DIRECTION;const Hl=ve(Us,Us.WORLD_MATRIX);Us.POSITION,Us.SCALE,Us.VIEW_POSITION;const M$=Ze(new je).onObjectUpdate(({object:n},e)=>e.value.getNormalMatrix(n.matrixWorld)),vT=me(n=>n.renderer.nodes.modelViewMatrix||E$).once()().toVar("modelViewMatrix"),E$=Fo.mul(Hl),yT=Uo("position","vec3"),di=yT.varying("positionLocal"),PP=yT.varying("positionPrevious"),Cf=Hl.mul(di).xyz.varying("v_positionWorld").context({needsPositionReassign:!0}),DP=di.transformDirection(Hl).varying("v_positionWorldDirection").normalize().toVar("positionWorldDirection").context({needsPositionReassign:!0}),En=me(n=>n.context.setupPositionView(),"vec3").once()().varying("v_positionView").context({needsPositionReassign:!0}),sn=En.negate().varying("v_positionViewDirection").normalize().toVar("positionViewDirection");class A$ extends tt{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){const{renderer:t,material:i}=e;return t.coordinateSystem===Vi&&i.side===Xt?"false":e.getFrontFacing()}}const m_=ne(ve(A$)).mul(2).sub(1),LP=Uo("normal","vec3"),Fs=me(n=>n.geometry.hasAttribute("normal")===!1?(console.warn('TSL.NormalNode: Vertex attribute "normal" not found on geometry.'),ie(0,1,0)):LP,"vec3").once()().toVar("normalLocal"),C$=En.dFdx().cross(En.dFdy()).normalize().toVar("normalFlat"),gs=me(n=>{let e;return n.material.flatShading===!0?e=C$:e=Io(UP(Fs),"v_normalView").normalize(),e},"vec3").once()().toVar("normalView"),IP=Io(gs.transformDirection(Fo),"v_normalWorld").normalize().toVar("normalWorld"),An=me(n=>n.context.setupNormal(),"vec3").once()().mul(m_).toVar("transformedNormalView"),xT=An.transformDirection(Fo).toVar("transformedNormalWorld"),Rf=me(n=>n.context.setupClearcoatNormal(),"vec3").once()().mul(m_).toVar("transformedClearcoatNormalView"),R$=me(([n,e=Hl])=>{const t=Pi(e),i=n.div(ie(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(i).xyz}),UP=me(([n],e)=>{const t=e.renderer.nodes.modelNormalViewMatrix;if(t!==null)return t.transformDirection(n);const i=M$.mul(n);return Fo.transformDirection(i)}),N$=Ze(0).onReference(({material:n})=>n).onRenderUpdate(({material:n})=>n.refractionRatio),P$=sn.negate().reflect(An),D$=sn.negate().refract(An,N$),L$=P$.transformDirection(Fo).toVar("reflectVector"),I$=D$.transformDirection(Fo).toVar("reflectVector");class U$ extends Af{static get type(){return"CubeTextureNode"}constructor(e,t=null,i=null,r=null){super(e,t,i,r),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===Br?L$:e.mapping===kr?I$:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',e.mapping),ie(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const i=this.value;return e.renderer.coordinateSystem===ya||!i.isRenderTargetTexture?ie(t.x.negate(),t.yz):t}generateUV(e,t){return t.build(e,"vec3")}}const Nf=oe(U$);class FP extends xf{static get type(){return"BufferNode"}constructor(e,t,i=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=i}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const ST=(n,e,t)=>pe(new FP(n,e,t));class F$ extends yf{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),i=this.getNodeType(),r=this.node.getPaddedType();return e.format(t,r,i)}}class O$ extends FP{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?Yg(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=at.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,i=this.elementType;if(i==="float"||i==="int"||i==="uint")for(let r=0;r<e.length;r++){const s=r*4;t[s]=e[r]}else if(i==="color")for(let r=0;r<e.length;r++){const s=r*4,o=e[r];t[s]=o.r,t[s+1]=o.g,t[s+2]=o.b||0}else if(i==="mat2")for(let r=0;r<e.length;r++){const s=r*4,o=e[r];t[s]=o.elements[0],t[s+1]=o.elements[1],t[s+2]=o.elements[2],t[s+3]=o.elements[3]}else if(i==="mat3")for(let r=0;r<e.length;r++){const s=r*16,o=e[r];t[s]=o.elements[0],t[s+1]=o.elements[1],t[s+2]=o.elements[2],t[s+4]=o.elements[3],t[s+5]=o.elements[4],t[s+6]=o.elements[5],t[s+8]=o.elements[6],t[s+9]=o.elements[7],t[s+10]=o.elements[8],t[s+15]=1}else if(i==="mat4")for(let r=0;r<e.length;r++){const s=r*16,o=e[r];for(let a=0;a<o.elements.length;a++)t[s+a]=o.elements[a]}else for(let r=0;r<e.length;r++){const s=r*4,o=e[r];t[s]=o.x,t[s+1]=o.y,t[s+2]=o.z||0,t[s+3]=o.w||0}}setup(e){const t=this.array.length,i=this.elementType;let r=Float32Array;const s=this.paddedType,o=e.getTypeLength(s);return i.charAt(0)==="i"&&(r=Int32Array),i.charAt(0)==="u"&&(r=Uint32Array),this.value=new r(t*o),this.bufferCount=t,this.bufferType=s,super.setup(e)}element(e){return pe(new F$(this,pe(e)))}}const Ua=(n,e)=>pe(new O$(n,e));class B$ extends yf{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),i=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,i,r)}}class TT extends tt{static get type(){return"ReferenceNode"}constructor(e,t,i=null,r=null){super(),this.property=e,this.uniformType=t,this.object=i,this.count=r,this.properties=e.split("."),this.reference=i,this.node=null,this.group=null,this.name=null,this.updateType=at.OBJECT}element(e){return pe(new B$(this,pe(e)))}setGroup(e){return this.group=e,this}label(e){return this.name=e,this}setNodeType(e){let t=null;this.count!==null?t=ST(null,e,this.count):Array.isArray(this.getValueFromReference())?t=Ua(null,e):e==="texture"?t=xt(null):e==="cubeTexture"?t=Nf(null):t=Ze(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.label(this.name),this.node=t.getSelf()}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let i=e[t[0]];for(let r=1;r<t.length;r++)i=i[t[r]];return i}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const Lt=(n,e,t)=>pe(new TT(n,e,t)),OP=(n,e,t,i)=>pe(new TT(n,e,i,t));class k$ extends TT{static get type(){return"MaterialReferenceNode"}constructor(e,t,i=null){super(e,t,i),this.material=i,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const Fa=(n,e,t=null)=>pe(new k$(n,e,t)),BP=me(n=>(n.geometry.hasAttribute("tangent")===!1&&n.geometry.computeTangents(),Uo("tangent","vec4")))(),bT=BP.xyz.toVar("tangentLocal"),kP=vT.mul(Qe(bT,0)).xyz.varying("v_tangentView").normalize().toVar("tangentView"),Pf=Pi(kP,Io((n=>n.mul(BP.w).xyz)(gs.cross(kP)),"v_bitangentView").normalize().toVar("bitangentView"),gs),z$=(()=>{let n=Kc.cross(sn);return n=n.cross(Kc).normalize(),n=Ht(n,An,Bl.mul(No.oneMinus()).oneMinus().pow2().pow2()).normalize(),n})(),G$=me(n=>{const{eye_pos:e,surf_norm:t,mapN:i,uv:r}=n,s=e.dFdx(),o=e.dFdy(),a=r.dFdx(),l=r.dFdy(),u=t,c=o.cross(u),h=u.cross(s),d=c.mul(a.x).add(h.mul(l.x)),f=c.mul(a.y).add(h.mul(l.y)),m=d.dot(d).max(f.dot(f)),g=m_.mul(m.inverseSqrt());return Di(d.mul(i.x,g),f.mul(i.y,g),u.mul(i.z)).normalize()});class V$ extends On{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=uo}setup(e){const{normalMapType:t,scaleNode:i}=this;let r=this.node.mul(2).sub(1);i!==null&&(r=ie(r.xy.mul(i),r.z));let s=null;return t===SA?s=UP(r):t===uo&&(e.hasGeometryAttribute("tangent")===!0?s=Pf.mul(r).normalize():s=G$({eye_pos:En,surf_norm:gs,mapN:r,uv:p_()})),s}}const zP=oe(V$),H$=me(({textureNode:n,bumpScale:e})=>{const t=r=>n.cache().context({getUV:s=>r(s.uvNode||p_()),forceUVContext:!0}),i=ne(t(r=>r));return ye(ne(t(r=>r.add(r.dFdx()))).sub(i),ne(t(r=>r.add(r.dFdy()))).sub(i)).mul(e)}),W$=me(n=>{const{surf_pos:e,surf_norm:t,dHdxy:i}=n,r=e.dFdx().normalize(),s=e.dFdy().normalize(),o=t,a=s.cross(o),l=o.cross(r),u=r.dot(a).mul(m_),c=u.sign().mul(i.x.mul(a).add(i.y.mul(l)));return u.abs().mul(t).sub(c).normalize()});class $$ extends On{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=H$({textureNode:this.textureNode,bumpScale:e});return W$({surf_pos:En,surf_norm:gs,dHdxy:t})}}const j$=oe($$),GP=new Map;class Z extends tt{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let i=GP.get(e);return i===void 0&&(i=Fa(e,t),GP.set(e,i)),i}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,i=this.scope;let r=null;if(i===Z.COLOR){const s=t.color!==void 0?this.getColor(i):ie();t.map&&t.map.isTexture===!0?r=s.mul(this.getTexture("map")):r=s}else if(i===Z.OPACITY){const s=this.getFloat(i);t.alphaMap&&t.alphaMap.isTexture===!0?r=s.mul(this.getTexture("alpha")):r=s}else if(i===Z.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?r=this.getTexture("specular").r:r=ne(1);else if(i===Z.SPECULAR_INTENSITY){const s=this.getFloat(i);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?r=s.mul(this.getTexture(i).a):r=s}else if(i===Z.SPECULAR_COLOR){const s=this.getColor(i);t.specularColorMap&&t.specularColorMap.isTexture===!0?r=s.mul(this.getTexture(i).rgb):r=s}else if(i===Z.ROUGHNESS){const s=this.getFloat(i);t.roughnessMap&&t.roughnessMap.isTexture===!0?r=s.mul(this.getTexture(i).g):r=s}else if(i===Z.METALNESS){const s=this.getFloat(i);t.metalnessMap&&t.metalnessMap.isTexture===!0?r=s.mul(this.getTexture(i).b):r=s}else if(i===Z.EMISSIVE){const s=this.getFloat("emissiveIntensity"),o=this.getColor(i).mul(s);t.emissiveMap&&t.emissiveMap.isTexture===!0?r=o.mul(this.getTexture(i)):r=o}else if(i===Z.NORMAL)t.normalMap?(r=zP(this.getTexture("normal"),this.getCache("normalScale","vec2")),r.normalMapType=t.normalMapType):t.bumpMap?r=j$(this.getTexture("bump").r,this.getFloat("bumpScale")):r=gs;else if(i===Z.CLEARCOAT){const s=this.getFloat(i);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?r=s.mul(this.getTexture(i).r):r=s}else if(i===Z.CLEARCOAT_ROUGHNESS){const s=this.getFloat(i);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?r=s.mul(this.getTexture(i).r):r=s}else if(i===Z.CLEARCOAT_NORMAL)t.clearcoatNormalMap?r=zP(this.getTexture(i),this.getCache(i+"Scale","vec2")):r=gs;else if(i===Z.SHEEN){const s=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?r=s.mul(this.getTexture("sheenColor").rgb):r=s}else if(i===Z.SHEEN_ROUGHNESS){const s=this.getFloat(i);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?r=s.mul(this.getTexture(i).a):r=s,r=r.clamp(.07,1)}else if(i===Z.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const s=this.getTexture(i);r=iT(Df.x,Df.y,Df.y.negate(),Df.x).mul(s.rg.mul(2).sub(ye(1)).normalize().mul(s.b))}else r=Df;else if(i===Z.IRIDESCENCE_THICKNESS){const s=Lt("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const o=Lt("0","float",t.iridescenceThicknessRange);r=s.sub(o).mul(this.getTexture(i).g).add(o)}else r=s}else if(i===Z.TRANSMISSION){const s=this.getFloat(i);t.transmissionMap?r=s.mul(this.getTexture(i).r):r=s}else if(i===Z.THICKNESS){const s=this.getFloat(i);t.thicknessMap?r=s.mul(this.getTexture(i).g):r=s}else if(i===Z.IOR)r=this.getFloat(i);else if(i===Z.LIGHT_MAP)r=this.getTexture(i).rgb.mul(this.getFloat("lightMapIntensity"));else if(i===Z.AO)r=this.getTexture(i).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else{const s=this.getNodeType(e);r=this.getCache(i,s)}return r}}Z.ALPHA_TEST="alphaTest",Z.COLOR="color",Z.OPACITY="opacity",Z.SHININESS="shininess",Z.SPECULAR="specular",Z.SPECULAR_STRENGTH="specularStrength",Z.SPECULAR_INTENSITY="specularIntensity",Z.SPECULAR_COLOR="specularColor",Z.REFLECTIVITY="reflectivity",Z.ROUGHNESS="roughness",Z.METALNESS="metalness",Z.NORMAL="normal",Z.CLEARCOAT="clearcoat",Z.CLEARCOAT_ROUGHNESS="clearcoatRoughness",Z.CLEARCOAT_NORMAL="clearcoatNormal",Z.EMISSIVE="emissive",Z.ROTATION="rotation",Z.SHEEN="sheen",Z.SHEEN_ROUGHNESS="sheenRoughness",Z.ANISOTROPY="anisotropy",Z.IRIDESCENCE="iridescence",Z.IRIDESCENCE_IOR="iridescenceIOR",Z.IRIDESCENCE_THICKNESS="iridescenceThickness",Z.IOR="ior",Z.TRANSMISSION="transmission",Z.THICKNESS="thickness",Z.ATTENUATION_DISTANCE="attenuationDistance",Z.ATTENUATION_COLOR="attenuationColor",Z.LINE_SCALE="scale",Z.LINE_DASH_SIZE="dashSize",Z.LINE_GAP_SIZE="gapSize",Z.LINE_WIDTH="linewidth",Z.LINE_DASH_OFFSET="dashOffset",Z.POINT_WIDTH="pointWidth",Z.DISPERSION="dispersion",Z.LIGHT_MAP="light",Z.AO="ao";const X$=ve(Z,Z.ALPHA_TEST),q$=ve(Z,Z.COLOR),Y$=ve(Z,Z.SHININESS),K$=ve(Z,Z.EMISSIVE),VP=ve(Z,Z.OPACITY),Q$=ve(Z,Z.SPECULAR),HP=ve(Z,Z.SPECULAR_INTENSITY),Z$=ve(Z,Z.SPECULAR_COLOR),g_=ve(Z,Z.SPECULAR_STRENGTH),wT=ve(Z,Z.REFLECTIVITY),J$=ve(Z,Z.ROUGHNESS),e9=ve(Z,Z.METALNESS),t9=ve(Z,Z.NORMAL).context({getUV:null}),n9=ve(Z,Z.CLEARCOAT),i9=ve(Z,Z.CLEARCOAT_ROUGHNESS),r9=ve(Z,Z.CLEARCOAT_NORMAL).context({getUV:null}),s9=ve(Z,Z.ROTATION),o9=ve(Z,Z.SHEEN),a9=ve(Z,Z.SHEEN_ROUGHNESS),l9=ve(Z,Z.ANISOTROPY),u9=ve(Z,Z.IRIDESCENCE),c9=ve(Z,Z.IRIDESCENCE_IOR),h9=ve(Z,Z.IRIDESCENCE_THICKNESS),d9=ve(Z,Z.TRANSMISSION),f9=ve(Z,Z.THICKNESS),p9=ve(Z,Z.IOR),m9=ve(Z,Z.ATTENUATION_DISTANCE),g9=ve(Z,Z.ATTENUATION_COLOR),_9=ve(Z,Z.LINE_SCALE),v9=ve(Z,Z.LINE_DASH_SIZE),y9=ve(Z,Z.LINE_GAP_SIZE);Z.LINE_WIDTH;const x9=ve(Z,Z.LINE_DASH_OFFSET);Z.POINT_WIDTH;const S9=ve(Z,Z.DISPERSION),WP=ve(Z,Z.LIGHT_MAP),T9=ve(Z,Z.AO),Df=Ze(new he).onReference(function(n){return n.material}).onRenderUpdate(function({material:n}){this.value.set(n.anisotropy*Math.cos(n.anisotropyRotation),n.anisotropy*Math.sin(n.anisotropyRotation))}),$P=me(n=>n.context.setupModelViewProjection(),"vec4").once()().varying("v_modelViewProjection");class Wt extends tt{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),i=this.scope;let r;if(i===Wt.VERTEX)r=e.getVertexIndex();else if(i===Wt.INSTANCE)r=e.getInstanceIndex();else if(i===Wt.DRAW)r=e.getDrawIndex();else if(i===Wt.INVOCATION_LOCAL)r=e.getInvocationLocalIndex();else if(i===Wt.INVOCATION_SUBGROUP)r=e.getInvocationSubgroupIndex();else if(i===Wt.SUBGROUP)r=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+i);let s;return e.shaderStage==="vertex"||e.shaderStage==="compute"?s=r:s=Io(this).build(e,t),s}}Wt.VERTEX="vertex",Wt.INSTANCE="instance",Wt.SUBGROUP="subgroup",Wt.INVOCATION_LOCAL="invocationLocal",Wt.INVOCATION_SUBGROUP="invocationSubgroup",Wt.DRAW="draw";const b9=ve(Wt,Wt.VERTEX),MT=ve(Wt,Wt.INSTANCE);Wt.SUBGROUP,Wt.INVOCATION_SUBGROUP,Wt.INVOCATION_LOCAL;const w9=ve(Wt,Wt.DRAW);class M9 extends tt{static get type(){return"InstanceNode"}constructor(e,t,i){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=i,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=at.FRAME,this.buffer=null,this.bufferColor=null}setup(e){const{count:t,instanceMatrix:i,instanceColor:r}=this;let{instanceMatrixNode:s,instanceColorNode:o}=this;if(s===null){if(t<=1e3)s=ST(i.array,"mat4",Math.max(t,1)).element(MT);else{const l=new GB(i.array,16,1);this.buffer=l;const u=i.usage===hc?RP:CP,c=[u(l,"vec4",16,0),u(l,"vec4",16,4),u(l,"vec4",16,8),u(l,"vec4",16,12)];s=qc(...c)}this.instanceMatrixNode=s}if(r&&o===null){const l=new Q3(r.array,3),u=r.usage===hc?RP:CP;this.bufferColor=l,o=ie(u(l,"vec3",3,0)),this.instanceColorNode=o}const a=s.mul(di).xyz;if(di.assign(a),e.hasGeometryAttribute("normal")){const l=R$(Fs,s);Fs.assign(l)}this.instanceColorNode!==null&&t_("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMatrix.usage!==hc&&this.buffer!==null&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version),this.instanceColor&&this.instanceColor.usage!==hc&&this.bufferColor!==null&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)}}class E9 extends M9{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:i,instanceColor:r}=e;super(t,i,r),this.instancedMesh=e}}const A9=oe(E9);class C9 extends tt{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=MT:this.batchingIdNode=w9);const i=me(([m])=>{const g=Ef(ms(this.batchMesh._indirectTexture),0),_=cn(m).modInt(cn(g)),p=cn(m).div(cn(g));return ms(this.batchMesh._indirectTexture,Ro(_,p)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(cn(this.batchingIdNode)),r=this.batchMesh._matricesTexture,s=Ef(ms(r),0),o=ne(i).mul(4).toInt().toVar(),a=o.modInt(s),l=o.div(cn(s)),u=qc(ms(r,Ro(a,l)),ms(r,Ro(a.add(1),l)),ms(r,Ro(a.add(2),l)),ms(r,Ro(a.add(3),l))),c=this.batchMesh._colorsTexture;if(c!==null){const g=me(([_])=>{const p=Ef(ms(c),0).x,v=_,y=v.modInt(p),x=v.div(p);return ms(c,Ro(y,x)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(i);t_("vec3","vBatchColor").assign(g)}const h=Pi(u);di.assign(u.mul(di));const d=Fs.div(ie(h[0].dot(h[0]),h[1].dot(h[1]),h[2].dot(h[2]))),f=h.mul(d).xyz;Fs.assign(f),e.hasGeometryAttribute("tangent")&&bT.mulAssign(h)}}const R9=oe(C9),jP=new WeakMap;class N9 extends tt{static get type(){return"SkinningNode"}constructor(e,t=!1){super("void"),this.skinnedMesh=e,this.useReference=t,this.updateType=at.OBJECT,this.skinIndexNode=Uo("skinIndex","uvec4"),this.skinWeightNode=Uo("skinWeight","vec4");let i,r,s;t?(i=Lt("bindMatrix","mat4"),r=Lt("bindMatrixInverse","mat4"),s=OP("skeleton.boneMatrices","mat4",e.skeleton.bones.length)):(i=Ze(e.bindMatrix,"mat4"),r=Ze(e.bindMatrixInverse,"mat4"),s=ST(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)),this.bindMatrixNode=i,this.bindMatrixInverseNode=r,this.boneMatricesNode=s,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=di){const{skinIndexNode:i,skinWeightNode:r,bindMatrixNode:s,bindMatrixInverseNode:o}=this,a=e.element(i.x),l=e.element(i.y),u=e.element(i.z),c=e.element(i.w),h=s.mul(t),d=Di(a.mul(r.x).mul(h),l.mul(r.y).mul(h),u.mul(r.z).mul(h),c.mul(r.w).mul(h));return o.mul(d).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=Fs){const{skinIndexNode:i,skinWeightNode:r,bindMatrixNode:s,bindMatrixInverseNode:o}=this,a=e.element(i.x),l=e.element(i.y),u=e.element(i.z),c=e.element(i.w);let h=Di(r.x.mul(a),r.y.mul(l),r.z.mul(u),r.w.mul(c));return h=o.mul(h).mul(s),h.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=OP("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,PP)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||zN(e.object).useVelocity===!0}setup(e){this.needsPreviousBoneMatrices(e)&&PP.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(di.assign(t),e.hasGeometryAttribute("normal")){const i=this.getSkinnedNormal();Fs.assign(i),e.hasGeometryAttribute("tangent")&&bT.assign(i)}}generate(e,t){if(t!=="void")return di.build(e,t)}update(e){const i=(this.useReference?e.object:this.skinnedMesh).skeleton;jP.get(i)!==e.frameId&&(jP.set(i,e.frameId),this.previousBoneMatricesNode!==null&&i.previousBoneMatrices.set(i.boneMatrices),i.update())}}const P9=n=>pe(new N9(n,!0));class D9 extends tt{static get type(){return"LoopNode"}constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const i={};for(let s=0,o=this.params.length-1;s<o;s++){const a=this.params[s],l=a.isNode!==!0&&a.name||this.getVarName(s),u=a.isNode!==!0&&a.type||"int";i[l]=Mf(l,u)}const r=e.addStack();return t.returnsNode=this.params[this.params.length-1](i,r,e),t.stackNode=r,e.removeStack(),t}getNodeType(e){const{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const t=this.getProperties(e),i=this.params,r=t.stackNode;for(let a=0,l=i.length-1;a<l;a++){const u=i[a];let c=null,h=null,d=null,f=null,m=null,g=null;u.isNode?(f="int",d=this.getVarName(a),c="0",h=u.build(e,f),m="<"):(f=u.type||"int",d=u.name||this.getVarName(a),c=u.start,h=u.end,m=u.condition,g=u.update,typeof c=="number"?c=e.generateConst(f,c):c&&c.isNode&&(c=c.build(e,f)),typeof h=="number"?h=e.generateConst(f,h):h&&h.isNode&&(h=h.build(e,f)),c!==void 0&&h===void 0?(c=c+" - 1",h="0",m=">="):h!==void 0&&c===void 0&&(c="0",m="<"),m===void 0&&(Number(c)>Number(h)?m=">=":m="<"));const _={start:c,end:h,condition:m},p=_.start,v=_.end;let y="",x="",S="";g||(f==="int"||f==="uint"?m.includes("<")?g="++":g="--":m.includes("<")?g="+= 1.":g="-= 1."),y+=e.getVar(f,d)+" = "+p,x+=d+" "+m+" "+v,S+=d+" "+g;const T=`for ( ${y}; ${x}; ${S} )`;e.addFlowCode((a===0?`
`:"")+e.tab+T+` {

`).addFlowTab()}const s=r.build(e,"void"),o=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode(`
`+e.tab+s);for(let a=0,l=this.params.length-1;a<l;a++)e.addFlowCode((a===0?"":e.tab)+`}

`).removeFlowTab();return e.addFlowTab(),o}}const _s=(...n)=>pe(new D9(Xc(n,"int"))).append(),L9=()=>Mf("break").append(),ET=new WeakMap,Sr=new et,XP=me(({bufferMap:n,influence:e,stride:t,width:i,depth:r,offset:s})=>{const o=cn(b9).mul(t).add(s),a=o.div(i),l=o.sub(a.mul(i));return ms(n,Ro(l,a)).depth(r).mul(e)});function I9(n){const e=n.morphAttributes.position!==void 0,t=n.morphAttributes.normal!==void 0,i=n.morphAttributes.color!==void 0,r=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,s=r!==void 0?r.length:0;let o=ET.get(n);if(o===void 0||o.count!==s){let p=function(){g.dispose(),ET.delete(n),n.removeEventListener("dispose",p)};o!==void 0&&o.texture.dispose();const a=n.morphAttributes.position||[],l=n.morphAttributes.normal||[],u=n.morphAttributes.color||[];let c=0;e===!0&&(c=1),t===!0&&(c=2),i===!0&&(c=3);let h=n.attributes.position.count*c,d=1;const f=4096;h>f&&(d=Math.ceil(h/f),h=f);const m=new Float32Array(h*d*4*s),g=new hx(m,h,d,s);g.type=mn,g.needsUpdate=!0;const _=c*4;for(let v=0;v<s;v++){const y=a[v],x=l[v],S=u[v],T=h*d*4*v;for(let w=0;w<y.count;w++){const E=w*_;e===!0&&(Sr.fromBufferAttribute(y,w),m[T+E+0]=Sr.x,m[T+E+1]=Sr.y,m[T+E+2]=Sr.z,m[T+E+3]=0),t===!0&&(Sr.fromBufferAttribute(x,w),m[T+E+4]=Sr.x,m[T+E+5]=Sr.y,m[T+E+6]=Sr.z,m[T+E+7]=0),i===!0&&(Sr.fromBufferAttribute(S,w),m[T+E+8]=Sr.x,m[T+E+9]=Sr.y,m[T+E+10]=Sr.z,m[T+E+11]=S.itemSize===4?Sr.w:1)}}o={count:s,texture:g,stride:c,size:new he(h,d)},ET.set(n,o),n.addEventListener("dispose",p)}return o}class U9 extends tt{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=Ze(1),this.updateType=at.OBJECT}setup(e){const{geometry:t}=e,i=t.morphAttributes.position!==void 0,r=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,s=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,o=s!==void 0?s.length:0,{texture:a,stride:l,size:u}=I9(t);i===!0&&di.mulAssign(this.morphBaseInfluence),r===!0&&Fs.mulAssign(this.morphBaseInfluence);const c=cn(u.width);_s(o,({i:h})=>{const d=ne(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?d.assign(ms(this.mesh.morphTexture,Ro(cn(h).add(1),cn(MT))).r):d.assign(Lt("morphTargetInfluences","float").element(h).toVar()),i===!0&&di.addAssign(XP({bufferMap:a,influence:d,stride:l,width:c,depth:h,offset:cn(0)})),r===!0&&Fs.addAssign(XP({bufferMap:a,influence:d,stride:l,width:c,depth:h,offset:cn(1)}))})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,i)=>t+i,0)}}const F9=oe(U9);class Qc extends tt{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class O9 extends Qc{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class B9 extends wP{static get type(){return"LightingContextNode"}constructor(e,t=null,i=null,r=null){super(e),this.lightingModel=t,this.backdropNode=i,this.backdropAlphaNode=r,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,i=ie().toVar("directDiffuse"),r=ie().toVar("directSpecular"),s=ie().toVar("indirectDiffuse"),o=ie().toVar("indirectSpecular"),a={directDiffuse:i,directSpecular:r,indirectDiffuse:s,indirectSpecular:o};return{radiance:ie().toVar("radiance"),irradiance:ie().toVar("irradiance"),iblIrradiance:ie().toVar("iblIrradiance"),ambientOcclusion:ne(1).toVar("ambientOcclusion"),reflectedLight:a,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const k9=oe(B9);class z9 extends Qc{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}let Lf,If;class Cn extends tt{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===Cn.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=at.NONE;return(this.scope===Cn.SIZE||this.scope===Cn.VIEWPORT)&&(e=at.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===Cn.VIEWPORT?t!==null?If.copy(t.viewport):(e.getViewport(If),If.multiplyScalar(e.getPixelRatio())):t!==null?(Lf.width=t.width,Lf.height=t.height):e.getDrawingBufferSize(Lf)}setup(){const e=this.scope;let t=null;return e===Cn.SIZE?t=Ze(Lf||(Lf=new he)):e===Cn.VIEWPORT?t=Ze(If||(If=new et)):t=ye(__.div(AT)),t}generate(e){if(this.scope===Cn.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const i=e.getNodeProperties(AT).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${i}.y - ${t}.y )`}return t}return super.generate(e)}}Cn.COORDINATE="coordinate",Cn.VIEWPORT="viewport",Cn.SIZE="size",Cn.UV="uv";const Uf=ve(Cn,Cn.UV),AT=ve(Cn,Cn.SIZE),__=ve(Cn,Cn.COORDINATE),qP=ve(Cn,Cn.VIEWPORT);qP.zw,qP.xy;const Ff=new he;class YP extends Af{static get type(){return"ViewportTextureNode"}constructor(e=Uf,t=null,i=null){i===null&&(i=new nB,i.minFilter=bi),super(i,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=at.FRAME}updateBefore(e){const t=e.renderer;t.getDrawingBufferSize(Ff);const i=this.value;(i.image.width!==Ff.width||i.image.height!==Ff.height)&&(i.image.width=Ff.width,i.image.height=Ff.height,i.needsUpdate=!0);const r=i.generateMipmaps;i.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(i),i.generateMipmaps=r}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const KP=oe(YP,null,null,{generateMipmaps:!0});let CT=null;class G9 extends YP{static get type(){return"ViewportDepthTextureNode"}constructor(e=Uf,t=null){CT===null&&(CT=new Aa),super(e,t,CT)}}const V9=oe(G9);class Yi extends tt{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===Yi.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,i=this.valueNode;let r=null;if(t===Yi.DEPTH_BASE)i!==null&&(r=JP().assign(i));else if(t===Yi.DEPTH)e.isPerspectiveCamera?r=H9(En.z,Gl,Vl):r=Of(En.z,Gl,Vl);else if(t===Yi.LINEAR_DEPTH)if(i!==null)if(e.isPerspectiveCamera){const s=QP(i,Gl,Vl);r=Of(s,Gl,Vl)}else r=i;else r=Of(En.z,Gl,Vl);return r}}Yi.DEPTH_BASE="depthBase",Yi.DEPTH="depth",Yi.LINEAR_DEPTH="linearDepth";const Of=(n,e,t)=>n.add(e).div(e.sub(t)),H9=(n,e,t)=>e.add(n).mul(t).div(t.sub(e).mul(n)),QP=(n,e,t)=>e.mul(t).div(t.sub(e).mul(n).sub(t)),ZP=(n,e,t)=>{e=e.max(1e-6).toVar();const i=Do(n.negate().div(e)),r=Do(t.div(e));return i.div(r)},JP=oe(Yi,Yi.DEPTH_BASE),e2=ve(Yi,Yi.DEPTH),W9=oe(Yi,Yi.LINEAR_DEPTH);V9(),e2.assign=n=>JP(n);class $9 extends tt{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const j9=oe($9);class Wr extends tt{static get type(){return"ClippingNode"}constructor(e=Wr.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:i,unionPlanes:r}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===Wr.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(i,r):this.scope===Wr.HARDWARE?this.setupHardwareClipping(r,e):this.setupDefault(i,r)}setupAlphaToCoverage(e,t){return me(()=>{const i=ne().toVar("distanceToPlane"),r=ne().toVar("distanceToGradient"),s=ne(1).toVar("clipOpacity"),o=t.length;if(this.hardwareClipping===!1&&o>0){const l=Ua(t);_s(o,({i:u})=>{const c=l.element(u);i.assign(En.dot(c.xyz).negate().add(c.w)),r.assign(i.fwidth().div(2)),s.mulAssign(zl(r.negate(),r,i))})}const a=e.length;if(a>0){const l=Ua(e),u=ne(1).toVar("intersectionClipOpacity");_s(a,({i:c})=>{const h=l.element(c);i.assign(En.dot(h.xyz).negate().add(h.w)),r.assign(i.fwidth().div(2)),u.mulAssign(zl(r.negate(),r,i).oneMinus())}),s.mulAssign(u.oneMinus())}Mt.a.mulAssign(s),Mt.a.equal(0).discard()})()}setupDefault(e,t){return me(()=>{const i=t.length;if(this.hardwareClipping===!1&&i>0){const s=Ua(t);_s(i,({i:o})=>{const a=s.element(o);En.dot(a.xyz).greaterThan(a.w).discard()})}const r=e.length;if(r>0){const s=Ua(e),o=eP(!0).toVar("clipped");_s(r,({i:a})=>{const l=s.element(a);o.assign(En.dot(l.xyz).greaterThan(l.w).and(o))}),o.discard()}})()}setupHardwareClipping(e,t){const i=e.length;return t.enableHardwareClipping(i),me(()=>{const r=Ua(e),s=j9(t.getClipDistance());_s(i,({i:o})=>{const a=r.element(o),l=En.dot(a.xyz).sub(a.w).negate();s.element(o).assign(l)})})()}}Wr.ALPHA_TO_COVERAGE="alphaToCoverage",Wr.DEFAULT="default",Wr.HARDWARE="hardware";const X9=()=>pe(new Wr),q9=()=>pe(new Wr(Wr.ALPHA_TO_COVERAGE)),Y9=()=>pe(new Wr(Wr.HARDWARE)),K9=.05,t2=me(([n])=>Da(ht(1e4,ps(ht(17,n.x).add(ht(.1,n.y)))).mul(Di(.1,Hr(ps(ht(13,n.y).add(n.x))))))),n2=me(([n])=>t2(ye(t2(n.xy),n.z))),Q9=me(([n])=>{const e=Xi(Ia(_P(n.xyz)),Ia(vP(n.xyz))),t=ne(1).div(ne(K9).mul(e)).toVar("pixScale"),i=ye(Sf(kl(Do(t))),Sf(dT(Do(t)))),r=ye(n2(kl(i.x.mul(n.xyz))),n2(kl(i.y.mul(n.xyz)))),s=Da(Do(t)),o=Di(ht(s.oneMinus(),r.x),ht(s,r.y)),a=bf(s,s.oneMinus()),l=ie(o.mul(o).div(ht(2,a).mul(ji(1,a))),o.sub(ht(.5,a)).div(ji(1,a)),ji(1,ji(1,o).mul(ji(1,o)).div(ht(2,a).mul(ji(1,a))))),u=o.lessThan(a.oneMinus()).select(o.lessThan(a).select(l.x,l.y),l.z);return Lo(u,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class Rn extends ui{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.shadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+ON(this)}build(e){this.setup(e)}setupObserver(e){return new p6(e)}setup(e){e.context.setupNormal=()=>this.setupNormal(e),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,i=t.getRenderTarget();e.addStack();const r=this.vertexNode||this.setupVertex(e);e.stack.outputNode=r,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let s;const o=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(i!==null?i.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const a=this.setupLighting(e);o!==null&&e.stack.add(o);const l=Qe(a,Mt.a).max(0);if(s=this.setupOutput(e,l),o_.assign(s),this.outputNode!==null&&(s=this.outputNode),i!==null){const u=t.getMRT(),c=this.mrtNode;u!==null?(s=u,c!==null&&(s=u.merge(c))):c!==null&&(s=c)}}else{let a=this.fragmentNode;a.isOutputStructNode!==!0&&(a=Qe(a)),s=this.setupOutput(e,a)}e.stack.outputNode=s,e.addFlow("fragment",e.removeStack()),e.monitor=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:i}=e.clippingContext;let r=null;if(t.length>0||i.length>0){const s=e.renderer.samples;this.alphaToCoverage&&s>1?r=q9():e.stack.add(X9())}return r}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.add(Y9()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:i}=e;let r=this.depthNode;if(r===null){const s=t.getMRT();s&&s.has("depth")?r=s.get("depth"):t.logarithmicDepthBuffer===!0&&(i.isPerspectiveCamera?r=ZP(En.z,Gl,Vl):r=Of(En.z,Gl,Vl))}r!==null&&e2.assign(r).append()}setupPositionView(){return vT.mul(di).xyz}setupModelViewProjection(){return _T.mul(En)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),$P}setupPosition(e){const{object:t,geometry:i}=e;if((i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color)&&F9(t).append(),t.isSkinnedMesh===!0&&P9(t).append(),this.displacementMap){const r=Fa("displacementMap","texture"),s=Fa("displacementScale","float"),o=Fa("displacementBias","float");di.addAssign(Fs.normalize().mul(r.x.mul(s).add(o)))}return t.isBatchedMesh&&R9(t).append(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&A9(t).append(),this.positionNode!==null&&di.assign(this.positionNode.context({isPositionNodeInput:!0})),di}setupDiffuseColor({object:e,geometry:t}){let i=this.colorNode?Qe(this.colorNode):q$;this.vertexColors===!0&&t.hasAttribute("color")&&(i=Qe(i.xyz.mul(Uo("color","vec3")),i.a)),e.instanceColor&&(i=t_("vec3","vInstanceColor").mul(i)),e.isBatchedMesh&&e._colorsTexture&&(i=t_("vec3","vBatchColor").mul(i)),Mt.assign(i);const r=this.opacityNode?ne(this.opacityNode):VP;if(Mt.a.assign(Mt.a.mul(r)),this.alphaTestNode!==null||this.alphaTest>0){const s=this.alphaTestNode!==null?ne(this.alphaTestNode):X$;Mt.a.lessThanEqual(s).discard()}this.alphaHash===!0&&Mt.a.lessThan(Q9(di)).discard(),this.transparent===!1&&this.blending===Or&&this.alphaToCoverage===!1&&Mt.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?ie(0):Mt.rgb}setupNormal(){return this.normalNode?ie(this.normalNode):t9}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?Fa("envMap","cubeTexture"):Fa("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new z9(WP)),t}setupLights(e){const t=[],i=this.setupEnvironment(e);i&&i.isLightingNode&&t.push(i);const r=this.setupLightMap(e);if(r&&r.isLightingNode&&t.push(r),this.aoNode!==null||e.material.aoMap){const o=this.aoNode!==null?this.aoNode:T9;t.push(new O9(o))}let s=this.lightsNode||e.lightsNode;return t.length>0&&(s=e.renderer.lighting.createNode([...s.getLights(),...t])),s}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:i,backdropAlphaNode:r,emissiveNode:s}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let l=this.setupOutgoingLight(e);if(a&&a.getScope().hasLights){const u=this.setupLightingModel(e);l=k9(a,u,i,r)}else i!==null&&(l=ie(r!==null?Ht(l,i,r):i));return(s&&s.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(rP.assign(ie(s||K$)),l=l.add(rP)),l}setupOutput(e,t){if(this.fog===!0){const i=e.fogNode;i&&(o_.assign(t),t=Qe(i))}return t}setDefaultValues(e){for(const i in e){const r=e[i];this[i]===void 0&&(this[i]=r,r&&r.clone&&(this[i]=r.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const i in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,i)===void 0&&t[i].get!==void 0&&Object.defineProperty(this.constructor.prototype,i,t[i])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const i=ui.prototype.toJSON.call(this,e),r=qg(this);i.inputNodes={};for(const{property:o,childNode:a}of r)i.inputNodes[o]=a.toJSON(e).uuid;function s(o){const a=[];for(const l in o){const u=o[l];delete u.metadata,a.push(u)}return a}if(t){const o=s(e.textures),a=s(e.images),l=s(e.nodes);o.length>0&&(i.textures=o),a.length>0&&(i.images=a),l.length>0&&(i.nodes=l)}return i}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.shadowPositionNode=e.shadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}const Z9=new dg;class J9 extends Rn{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(Z9),this.setValues(e)}}const ej=new AB;class tj extends Rn{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(ej),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?ne(this.offsetNode):x9,t=this.dashScaleNode?ne(this.dashScaleNode):_9,i=this.dashSizeNode?ne(this.dashSizeNode):v9,r=this.gapSizeNode?ne(this.gapSizeNode):y9;uT.assign(i),aP.assign(r);const s=Io(Uo("lineDistance").mul(t));(e?s.add(e):s).mod(uT.add(aP)).greaterThan(uT).discard()}}const nj=n=>pe(n).mul(.5).add(.5),ij=new bB;class rj extends Rn{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(ij),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?ne(this.opacityNode):VP;Mt.assign(Qe(nj(An),e))}}class sj extends On{static get type(){return"EquirectUVNode"}constructor(e=DP){super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,t=e.z.atan(e.x).mul(1/(Math.PI*2)).add(.5),i=e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return ye(t,i)}}const i2=oe(sj);class r2 extends KA{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const i=t.minFilter,r=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const s=new Cl(5,5,5),o=i2(DP),a=new Rn;a.colorNode=xt(t,o,0),a.side=Xt,a.blending=zi;const l=new $n(s,a),u=new Dx;u.add(l),t.minFilter===bi&&(t.minFilter=Sn);const c=new YA(1,10,this),h=e.getMRT();return e.setMRT(null),c.update(e,u),e.setMRT(h),t.minFilter=i,t.currentGenerateMipmaps=r,l.geometry.dispose(),l.material.dispose(),this}}const Bf=new WeakMap;class oj extends On{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=Nf();const t=new og;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=at.RENDER}updateBefore(e){const{renderer:t,material:i}=e,r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const s=r.isTextureNode?r.value:i[r.property];if(s&&s.isTexture){const o=s.mapping;if(o===pa||o===ma){if(Bf.has(s)){const a=Bf.get(s);o2(a,s.mapping),this._cubeTexture=a}else{const a=s.image;if(aj(a)){const l=new r2(a.height);l.fromEquirectangularTexture(t,s),o2(l.texture,s.mapping),this._cubeTexture=l.texture,Bf.set(s,l.texture),s.addEventListener("dispose",s2)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function aj(n){return n==null?!1:n.height>0}function s2(n){const e=n.target;e.removeEventListener("dispose",s2);const t=Bf.get(e);t!==void 0&&(Bf.delete(e),t.dispose())}function o2(n,e){e===pa?n.mapping=Br:e===ma&&(n.mapping=kr)}const a2=oe(oj);class RT extends Qc{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=a2(this.envNode)}}class lj extends Qc{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=ne(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class v_{start(){}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class l2 extends v_{constructor(){super()}indirect(e,t,i){const r=e.ambientOcclusion,s=e.reflectedLight,o=i.context.irradianceLightMap;s.indirectDiffuse.assign(Qe(0)),o?s.indirectDiffuse.addAssign(o):s.indirectDiffuse.addAssign(Qe(1,1,1,0)),s.indirectDiffuse.mulAssign(r),s.indirectDiffuse.mulAssign(Mt.rgb)}finish(e,t,i){const r=i.material,s=e.outgoingLight,o=i.context.environment;if(o)switch(r.combine){case Md:s.rgb.assign(Ht(s.rgb,s.rgb.mul(o.rgb),g_.mul(wT)));break;case fA:s.rgb.assign(Ht(s.rgb,o.rgb,g_.mul(wT)));break;case pA:s.rgb.addAssign(o.rgb.mul(g_.mul(wT)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",r.combine);break}}}const uj=new Vd;class cj extends Rn{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(uj),this.setValues(e)}setupNormal(){return gs}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new RT(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new lj(WP)),t}setupOutgoingLight(){return Mt.rgb}setupLightingModel(){return new l2}}const kf=me(({f0:n,f90:e,dotVH:t})=>{const i=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return n.mul(i.oneMinus()).add(e.mul(i))}),Zc=me(n=>n.diffuseColor.mul(1/Math.PI)),hj=()=>ne(.25),dj=me(({dotNH:n})=>lT.mul(ne(.5)).add(1).mul(ne(1/Math.PI)).mul(n.pow(lT))),fj=me(({lightDirection:n})=>{const e=n.add(sn).normalize(),t=An.dot(e).clamp(),i=sn.dot(e).clamp(),r=kf({f0:xr,f90:1,dotVH:i}),s=hj(),o=dj({dotNH:t});return r.mul(s).mul(o)});class u2 extends l2{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:i}){const s=An.dot(e).clamp().mul(t);i.directDiffuse.addAssign(s.mul(Zc({diffuseColor:Mt.rgb}))),this.specular===!0&&i.directSpecular.addAssign(s.mul(fj({lightDirection:e})).mul(g_))}indirect({ambientOcclusion:e,irradiance:t,reflectedLight:i}){i.indirectDiffuse.addAssign(t.mul(Zc({diffuseColor:Mt}))),i.indirectDiffuse.mulAssign(e)}}const pj=new oC;class mj extends Rn{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(pj),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new RT(t):null}setupLightingModel(){return new u2(!1)}}const gj=new SB;class _j extends Rn{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(gj),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new RT(t):null}setupLightingModel(){return new u2}setupVariants(){const e=(this.shininessNode?ne(this.shininessNode):Y$).max(1e-4);lT.assign(e);const t=this.specularNode||Q$;xr.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const vj=me(n=>{if(n.geometry.hasAttribute("normal")===!1)return ne(0);const e=gs.dFdx().abs().max(gs.dFdy().abs());return e.x.max(e.y).max(e.z)}),c2=me(n=>{const{roughness:e}=n,t=vj();let i=e.max(.0525);return i=i.add(t),i=i.min(1),i}),yj=me(({alpha:n,dotNL:e,dotNV:t})=>{const i=n.pow2(),r=e.mul(i.add(i.oneMinus().mul(t.pow2())).sqrt()),s=t.mul(i.add(i.oneMinus().mul(e.pow2())).sqrt());return Po(.5,r.add(s).max(vW))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),xj=me(({alphaT:n,alphaB:e,dotTV:t,dotBV:i,dotTL:r,dotBL:s,dotNV:o,dotNL:a})=>{const l=a.mul(ie(n.mul(t),e.mul(i),o).length()),u=o.mul(ie(n.mul(r),e.mul(s),a).length());return Po(.5,l.add(u)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),Sj=me(({alpha:n,dotNH:e})=>{const t=n.pow2(),i=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(i.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),Tj=ne(1/Math.PI),bj=me(({alphaT:n,alphaB:e,dotNH:t,dotTH:i,dotBH:r})=>{const s=n.mul(e),o=ie(e.mul(i),n.mul(r),s.mul(t)),a=o.dot(o),l=s.div(a);return Tj.mul(s.mul(l.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),h2=me(n=>{const{lightDirection:e,f0:t,f90:i,roughness:r,f:s,USE_IRIDESCENCE:o,USE_ANISOTROPY:a}=n,l=n.normalView||An,u=r.pow2(),c=e.add(sn).normalize(),h=l.dot(e).clamp(),d=l.dot(sn).clamp(),f=l.dot(c).clamp(),m=sn.dot(c).clamp();let g=kf({f0:t,f90:i,dotVH:m}),_,p;if(ZN(o)&&(g=oT.mix(g,s)),ZN(a)){const v=r_.dot(e),y=r_.dot(sn),x=r_.dot(c),S=Kc.dot(e),T=Kc.dot(sn),w=Kc.dot(c);_=xj({alphaT:aT,alphaB:u,dotTV:y,dotBV:T,dotTL:v,dotBL:S,dotNV:d,dotNL:h}),p=bj({alphaT:aT,alphaB:u,dotNH:f,dotTH:x,dotBH:w})}else _=yj({alpha:u,dotNL:h,dotNV:d}),p=Sj({alpha:u,dotNH:f});return g.mul(_).mul(p)}),d2=me(({roughness:n,dotNV:e})=>{const t=Qe(-1,-.0275,-.572,.022),i=Qe(1,.0425,1.04,-.04),r=n.mul(t).add(i),s=r.x.mul(r.x).min(e.mul(-9.28).exp2()).mul(r.x).add(r.y);return ye(-1.04,1.04).mul(s).add(r.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),f2=me(n=>{const{dotNV:e,specularColor:t,specularF90:i,roughness:r}=n,s=d2({dotNV:e,roughness:r});return t.mul(s.x).add(i.mul(s.y))}),wj=me(({f:n,f90:e,dotVH:t})=>{const i=t.oneMinus().saturate(),r=i.mul(i),s=i.mul(r,r).clamp(0,.9999);return n.sub(ie(e).mul(s)).div(s.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),Mj=me(({roughness:n,dotNH:e})=>{const t=n.pow2(),i=ne(1).div(t),s=e.pow2().oneMinus().max(.0078125);return ne(2).add(i).mul(s.pow(i.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),Ej=me(({dotNV:n,dotNL:e})=>ne(1).div(ne(4).mul(e.add(n).sub(e.mul(n))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),Aj=me(({lightDirection:n})=>{const e=n.add(sn).normalize(),t=An.dot(n).clamp(),i=An.dot(sn).clamp(),r=An.dot(e).clamp(),s=Mj({roughness:sT,dotNH:r}),o=Ej({dotNV:i,dotNL:t});return Yc.mul(s).mul(o)}),Cj=me(({N:n,V:e,roughness:t})=>{const s=.0078125,o=n.dot(e).saturate(),a=ye(t,o.oneMinus().sqrt());return a.assign(a.mul(.984375).add(s)),a}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),Rj=me(({f:n})=>{const e=n.length();return Xi(e.mul(e).add(n.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),y_=me(({v1:n,v2:e})=>{const t=n.dot(e),i=t.abs().toVar(),r=i.mul(.0145206).add(.4965155).mul(i).add(.8543985).toVar(),s=i.add(4.1616724).mul(i).add(3.417594).toVar(),o=r.div(s),a=t.greaterThan(0).select(o,Xi(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(o));return n.cross(e).mul(a)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),p2=me(({N:n,V:e,P:t,mInv:i,p0:r,p1:s,p2:o,p3:a})=>{const l=s.sub(r).toVar(),u=a.sub(r).toVar(),c=l.cross(u),h=ie().toVar();return Mn(c.dot(t.sub(r)).greaterThanEqual(0),()=>{const d=e.sub(n.mul(e.dot(n))).normalize(),f=n.cross(d).negate(),m=i.mul(Pi(d,f,n).transpose()).toVar(),g=m.mul(r.sub(t)).normalize().toVar(),_=m.mul(s.sub(t)).normalize().toVar(),p=m.mul(o.sub(t)).normalize().toVar(),v=m.mul(a.sub(t)).normalize().toVar(),y=ie(0).toVar();y.addAssign(y_({v1:g,v2:_})),y.addAssign(y_({v1:_,v2:p})),y.addAssign(y_({v1:p,v2:v})),y.addAssign(y_({v1:v,v2:g})),h.assign(ie(Rj({f:y})))}),h}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),x_=1/6,m2=n=>ht(x_,ht(n,ht(n,n.negate().add(3)).sub(3)).add(1)),NT=n=>ht(x_,ht(n,ht(n,ht(3,n).sub(6))).add(4)),g2=n=>ht(x_,ht(n,ht(n,ht(-3,n).add(3)).add(3)).add(1)),PT=n=>ht(x_,u_(n,3)),_2=n=>m2(n).add(NT(n)),v2=n=>g2(n).add(PT(n)),y2=n=>Di(-1,NT(n).div(m2(n).add(NT(n)))),x2=n=>Di(1,PT(n).div(g2(n).add(PT(n)))),S2=(n,e,t)=>{const i=n.uvNode,r=ht(i,e.zw).add(.5),s=kl(r),o=Da(r),a=_2(o.x),l=v2(o.x),u=y2(o.x),c=x2(o.x),h=y2(o.y),d=x2(o.y),f=ye(s.x.add(u),s.y.add(h)).sub(.5).mul(e.xy),m=ye(s.x.add(c),s.y.add(h)).sub(.5).mul(e.xy),g=ye(s.x.add(u),s.y.add(d)).sub(.5).mul(e.xy),_=ye(s.x.add(c),s.y.add(d)).sub(.5).mul(e.xy),p=_2(o.y).mul(Di(a.mul(n.sample(f).level(t)),l.mul(n.sample(m).level(t)))),v=v2(o.y).mul(Di(a.mul(n.sample(g).level(t)),l.mul(n.sample(_).level(t))));return p.add(v)},Nj=me(([n,e=ne(3)])=>{const t=ye(n.size(cn(e))),i=ye(n.size(cn(e.add(1)))),r=Po(1,t),s=Po(1,i),o=S2(n,Qe(r,t),kl(e)),a=S2(n,Qe(s,i),dT(e));return Da(e).mix(o,a)}),T2=me(([n,e,t,i,r])=>{const s=ie(bP(e.negate(),Tf(n),Po(1,i))),o=ie(Ia(r[0].xyz),Ia(r[1].xyz),Ia(r[2].xyz));return Tf(s).mul(t.mul(o))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),Pj=me(([n,e])=>n.mul(Lo(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),Dj=KP(),Lj=KP(),b2=me(([n,e,t],{material:i})=>{const s=(i.side===Xt?Dj:Lj).sample(n),o=Do(AT.x).mul(Pj(e,t));return Nj(s,o)}),w2=me(([n,e,t])=>(Mn(t.notEqual(0),()=>{const i=mP(e).negate().div(t);return pP(i.negate().mul(n))}),ie(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),Ij=me(([n,e,t,i,r,s,o,a,l,u,c,h,d,f,m])=>{let g,_;if(m){g=Qe().toVar(),_=ie().toVar();const S=c.sub(1).mul(m.mul(.025)),T=ie(c.sub(S),c,c.add(S));_s({start:0,end:3},({i:w})=>{const E=T.element(w),M=T2(n,e,h,E,a),b=o.add(M),C=u.mul(l.mul(Qe(b,1))),I=ye(C.xy.div(C.w)).toVar();I.addAssign(1),I.divAssign(2),I.assign(ye(I.x,I.y.oneMinus()));const U=b2(I,t,E);g.element(w).assign(U.element(w)),g.a.addAssign(U.a),_.element(w).assign(i.element(w).mul(w2(Ia(M),d,f).element(w)))}),g.a.divAssign(3)}else{const S=T2(n,e,h,c,a),T=o.add(S),w=u.mul(l.mul(Qe(T,1))),E=ye(w.xy.div(w.w)).toVar();E.addAssign(1),E.divAssign(2),E.assign(ye(E.x,E.y.oneMinus())),g=b2(E,t,c),_=i.mul(w2(Ia(S),d,f))}const p=_.rgb.mul(g.rgb),v=n.dot(e).clamp(),y=ie(f2({dotNV:v,specularColor:r,specularF90:s,roughness:t})),x=_.r.add(_.g,_.b).div(3);return Qe(y.oneMinus().mul(p),g.a.oneMinus().mul(x).oneMinus())}),Uj=Pi(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),Fj=n=>{const e=n.sqrt();return ie(1).add(e).div(ie(1).sub(e))},M2=(n,e)=>n.sub(e).div(n.add(e)).pow2(),Oj=(n,e)=>{const t=n.mul(2*Math.PI*1e-9),i=ie(54856e-17,44201e-17,52481e-17),r=ie(1681e3,1795300,2208400),s=ie(43278e5,93046e5,66121e5),o=ne(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let a=i.mul(s.mul(2*Math.PI).sqrt()).mul(r.mul(t).add(e).cos()).mul(t.pow2().negate().mul(s).exp());return a=ie(a.x.add(o),a.y,a.z).div(10685e-11),Uj.mul(a)},Bj=me(({outsideIOR:n,eta2:e,cosTheta1:t,thinFilmThickness:i,baseF0:r})=>{const s=Ht(n,e,zl(0,.03,i)),a=n.div(s).pow2().mul(t.pow2().oneMinus()).oneMinus();Mn(a.lessThan(0),()=>ie(1));const l=a.sqrt(),u=M2(s,n),c=kf({f0:u,f90:1,dotVH:t}),h=c.oneMinus(),d=s.lessThan(n).select(Math.PI,0),f=ne(Math.PI).sub(d),m=Fj(r.clamp(0,.9999)),g=M2(m,s.toVec3()),_=kf({f0:g,f90:1,dotVH:l}),p=ie(m.x.lessThan(s).select(Math.PI,0),m.y.lessThan(s).select(Math.PI,0),m.z.lessThan(s).select(Math.PI,0)),v=s.mul(i,l,2),y=ie(f).add(p),x=c.mul(_).clamp(1e-5,.9999),S=x.sqrt(),T=h.pow2().mul(_).div(ie(1).sub(x)),E=c.add(T).toVar(),M=T.sub(h).toVar();return _s({start:1,end:2,condition:"<=",name:"m"},({m:b})=>{M.mulAssign(S);const C=Oj(ne(b).mul(v),ne(b).mul(y)).mul(2);E.addAssign(M.mul(C))}),E.max(ie(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),kj=me(({normal:n,viewDir:e,roughness:t})=>{const i=n.dot(e).saturate(),r=t.pow2(),s=qi(t.lessThan(.25),ne(-339.2).mul(r).add(ne(161.4).mul(t)).sub(25.9),ne(-8.48).mul(r).add(ne(14.3).mul(t)).sub(9.95)),o=qi(t.lessThan(.25),ne(44).mul(r).sub(ne(23.7).mul(t)).add(3.26),ne(1.97).mul(r).sub(ne(3.27).mul(t)).add(.72));return qi(t.lessThan(.25),0,ne(.1).mul(t).sub(.025)).add(s.mul(i).add(o).exp()).mul(1/Math.PI).saturate()}),DT=ie(.04),LT=ne(1);class E2 extends v_{constructor(e=!1,t=!1,i=!1,r=!1,s=!1,o=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=i,this.anisotropy=r,this.transmission=s,this.dispersion=o,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=ie().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=ie().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=ie().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=ie().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=ie().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=An.dot(sn).clamp();this.iridescenceFresnel=Bj({outsideIOR:ne(1),eta2:sP,cosTheta1:t,thinFilmThickness:oP,baseF0:xr}),this.iridescenceF0=wj({f:this.iridescenceFresnel,f90:1,dotVH:t})}if(this.transmission===!0){const t=Cf,i=b$.sub(Cf).normalize(),r=xT;e.backdrop=Ij(r,i,No,Mt,xr,s_,t,Hl,Fo,_T,a_,lP,cP,uP,this.dispersion?hP:null),e.backdropAlpha=cT,Mt.a.mulAssign(Ht(1,e.backdrop.a,cT))}}computeMultiscattering(e,t,i){const r=An.dot(sn).clamp(),s=d2({roughness:No,dotNV:r}),a=(this.iridescenceF0?oT.mix(xr,this.iridescenceF0):xr).mul(s.x).add(i.mul(s.y)),u=s.x.add(s.y).oneMinus(),c=xr.add(xr.oneMinus().mul(.047619)),h=a.mul(c).div(u.mul(c).oneMinus());e.addAssign(a),t.addAssign(h.mul(u))}direct({lightDirection:e,lightColor:t,reflectedLight:i}){const s=An.dot(e).clamp().mul(t);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(s.mul(Aj({lightDirection:e}))),this.clearcoat===!0){const a=Rf.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(a.mul(h2({lightDirection:e,f0:DT,f90:LT,roughness:i_,normalView:Rf})))}i.directDiffuse.addAssign(s.mul(Zc({diffuseColor:Mt.rgb}))),i.directSpecular.addAssign(s.mul(h2({lightDirection:e,f0:xr,f90:1,roughness:No,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:i,halfHeight:r,reflectedLight:s,ltc_1:o,ltc_2:a}){const l=t.add(i).sub(r),u=t.sub(i).sub(r),c=t.sub(i).add(r),h=t.add(i).add(r),d=An,f=sn,m=En.toVar(),g=Cj({N:d,V:f,roughness:No}),_=o.sample(g).toVar(),p=a.sample(g).toVar(),v=Pi(ie(_.x,0,_.y),ie(0,1,0),ie(_.z,0,_.w)).toVar(),y=xr.mul(p.x).add(xr.oneMinus().mul(p.y)).toVar();s.directSpecular.addAssign(e.mul(y).mul(p2({N:d,V:f,P:m,mInv:v,p0:l,p1:u,p2:c,p3:h}))),s.directDiffuse.addAssign(e.mul(Mt).mul(p2({N:d,V:f,P:m,mInv:Pi(1,0,0,0,1,0,0,0,1),p0:l,p1:u,p2:c,p3:h})))}indirect(e,t,i){this.indirectDiffuse(e,t,i),this.indirectSpecular(e,t,i),this.ambientOcclusion(e,t,i)}indirectDiffuse({irradiance:e,reflectedLight:t}){t.indirectDiffuse.addAssign(e.mul(Zc({diffuseColor:Mt})))}indirectSpecular({radiance:e,iblIrradiance:t,reflectedLight:i}){if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(t.mul(Yc,kj({normal:An,viewDir:sn,roughness:sT}))),this.clearcoat===!0){const u=Rf.dot(sn).clamp(),c=f2({dotNV:u,specularColor:DT,specularF90:LT,roughness:i_});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(c))}const r=ie().toVar("singleScattering"),s=ie().toVar("multiScattering"),o=t.mul(1/Math.PI);this.computeMultiscattering(r,s,s_);const a=r.add(s),l=Mt.mul(a.r.max(a.g).max(a.b).oneMinus());i.indirectSpecular.addAssign(e.mul(r)),i.indirectSpecular.addAssign(s.mul(o)),i.indirectDiffuse.addAssign(l.mul(o))}ambientOcclusion({ambientOcclusion:e,reflectedLight:t}){const r=An.dot(sn).clamp().add(e),s=No.mul(-16).oneMinus().negate().exp2(),o=e.sub(r.pow(s).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(e),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(e),t.indirectDiffuse.mulAssign(e),t.indirectSpecular.mulAssign(o)}finish(e){const{outgoingLight:t}=e;if(this.clearcoat===!0){const i=Rf.dot(sn).clamp(),r=kf({dotVH:i,f0:DT,f90:LT}),s=t.mul(rT.mul(r).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(rT));t.assign(s)}if(this.sheen===!0){const i=Yc.r.max(Yc.g).max(Yc.b).mul(.157).oneMinus(),r=t.mul(i).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(r)}}}const A2=ne(1),IT=ne(-2),S_=ne(.8),UT=ne(-1),T_=ne(.4),FT=ne(2),b_=ne(.305),OT=ne(3),C2=ne(.21),zj=ne(4),R2=ne(4),Gj=ne(16),Vj=me(([n])=>{const e=ie(Hr(n)).toVar(),t=ne(-1).toVar();return Mn(e.x.greaterThan(e.z),()=>{Mn(e.x.greaterThan(e.y),()=>{t.assign(qi(n.x.greaterThan(0),0,3))}).Else(()=>{t.assign(qi(n.y.greaterThan(0),1,4))})}).Else(()=>{Mn(e.z.greaterThan(e.y),()=>{t.assign(qi(n.z.greaterThan(0),2,5))}).Else(()=>{t.assign(qi(n.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),Hj=me(([n,e])=>{const t=ye().toVar();return Mn(e.equal(0),()=>{t.assign(ye(n.z,n.y).div(Hr(n.x)))}).ElseIf(e.equal(1),()=>{t.assign(ye(n.x.negate(),n.z.negate()).div(Hr(n.y)))}).ElseIf(e.equal(2),()=>{t.assign(ye(n.x.negate(),n.y).div(Hr(n.z)))}).ElseIf(e.equal(3),()=>{t.assign(ye(n.z.negate(),n.y).div(Hr(n.x)))}).ElseIf(e.equal(4),()=>{t.assign(ye(n.x.negate(),n.z).div(Hr(n.y)))}).Else(()=>{t.assign(ye(n.x,n.y).div(Hr(n.z)))}),ht(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),Wj=me(([n])=>{const e=ne(0).toVar();return Mn(n.greaterThanEqual(S_),()=>{e.assign(A2.sub(n).mul(UT.sub(IT)).div(A2.sub(S_)).add(IT))}).ElseIf(n.greaterThanEqual(T_),()=>{e.assign(S_.sub(n).mul(FT.sub(UT)).div(S_.sub(T_)).add(UT))}).ElseIf(n.greaterThanEqual(b_),()=>{e.assign(T_.sub(n).mul(OT.sub(FT)).div(T_.sub(b_)).add(FT))}).ElseIf(n.greaterThanEqual(C2),()=>{e.assign(b_.sub(n).mul(zj.sub(OT)).div(b_.sub(C2)).add(OT))}).Else(()=>{e.assign(ne(-2).mul(Do(ht(1.16,n))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),$j=me(([n,e])=>{const t=n.toVar();t.assign(ht(2,t).sub(1));const i=ie(t,1).toVar();return Mn(e.equal(0),()=>{i.assign(i.zyx)}).ElseIf(e.equal(1),()=>{i.assign(i.xzy),i.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{i.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{i.assign(i.zyx),i.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{i.assign(i.xzy),i.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{i.z.mulAssign(-1)}),i}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),jj=me(([n,e,t,i,r,s])=>{const o=ne(t),a=ie(e),l=Lo(Wj(o),IT,s),u=Da(l),c=kl(l),h=ie(BT(n,a,c,i,r,s)).toVar();return Mn(u.notEqual(0),()=>{const d=ie(BT(n,a,c.add(1),i,r,s)).toVar();h.assign(Ht(h,d,u))}),h}),BT=me(([n,e,t,i,r,s])=>{const o=ne(t).toVar(),a=ie(e),l=ne(Vj(a)).toVar(),u=ne(Xi(R2.sub(o),0)).toVar();o.assign(Xi(o,R2));const c=ne(Sf(o)).toVar(),h=ye(Hj(a,l).mul(c.sub(2)).add(1)).toVar();return Mn(l.greaterThan(2),()=>{h.y.addAssign(c),l.subAssign(3)}),h.x.addAssign(l.mul(c)),h.x.addAssign(u.mul(ht(3,Gj))),h.y.addAssign(ht(4,Sf(s).sub(c))),h.x.mulAssign(i),h.y.mulAssign(r),n.sample(h).grad(ye(),ye())}),kT=me(({envMap:n,mipInt:e,outputDirection:t,theta:i,axis:r,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:a})=>{const l=La(i),u=t.mul(l).add(r.cross(t).mul(ps(i))).add(r.mul(r.dot(t).mul(l.oneMinus())));return BT(n,u,e,s,o,a)}),Xj=me(({n,latitudinal:e,poleAxis:t,outputDirection:i,weights:r,samples:s,dTheta:o,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:h})=>{const d=ie(qi(e,t,SP(t,i))).toVar();Mn(fP(d.equals(ie(0))),()=>{d.assign(ie(i.z,0,i.x.negate()))}),d.assign(Tf(d));const f=ie().toVar();return f.addAssign(r.element(cn(0)).mul(kT({theta:0,axis:d,outputDirection:i,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:h}))),_s({start:cn(1),end:n},({i:m})=>{Mn(m.greaterThanEqual(s),()=>{L9()});const g=ne(o.mul(ne(m))).toVar();f.addAssign(r.element(m).mul(kT({theta:g.mul(-1),axis:d,outputDirection:i,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:h}))),f.addAssign(r.element(m).mul(kT({theta:g,axis:d,outputDirection:i,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:h})))}),Qe(f,1)});let w_=null;const N2=new WeakMap;function qj(n){const e=Math.log2(n)-2,t=1/n;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:t,maxMip:e}}function Yj(n){let e=N2.get(n);if((e!==void 0?e.pmremVersion:-1)!==n.pmremVersion){const i=n.image;if(n.isCubeTexture)if(Qj(i))e=w_.fromCubemap(n,e);else return null;else if(Zj(i))e=w_.fromEquirectangular(n,e);else return null;e.pmremVersion=n.pmremVersion,N2.set(n,e)}return e.texture}class Kj extends On{static get type(){return"PMREMNode"}constructor(e,t=null,i=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=i,this._generator=null;const r=new Tn;r.isRenderTargetTexture=!0,this._texture=xt(r),this._width=Ze(0),this._height=Ze(0),this._maxMip=Ze(0),this.updateBeforeType=at.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=qj(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(){let e=this._pmrem;const t=e?e.pmremVersion:-1,i=this._value;t!==i.pmremVersion&&(i.isPMREMTexture===!0?e=i:e=Yj(i),e!==null&&(this._pmrem=e,this.updateFromTexture(e)))}setup(e){w_===null&&(w_=e.createPMREMGenerator()),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this));const i=this.value;e.renderer.coordinateSystem===Vi&&i.isPMREMTexture!==!0&&i.isRenderTargetTexture===!0&&(t=ie(t.x.negate(),t.yz)),t=ie(t.x,t.y.negate(),t.z);let r=this.levelNode;return r===null&&e.context.getTextureLevel&&(r=e.context.getTextureLevel(this)),jj(this._texture,t,r,this._width,this._height,this._maxMip)}}function Qj(n){if(n==null)return!1;let e=0;const t=6;for(let i=0;i<t;i++)n[i]!==void 0&&e++;return e===t}function Zj(n){return n==null?!1:n.height>0}const P2=oe(Kj),D2=new WeakMap;class Jj extends Qc{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let i=this.envNode;if(i.isTextureNode||i.isMaterialReferenceNode){const f=i.isTextureNode?i.value:t[i.property];let m=D2.get(f);m===void 0&&(m=P2(f),D2.set(f,m)),i=m}const s=t.envMap?Lt("envMapIntensity","float",e.material):Lt("environmentIntensity","float",e.scene),a=t.useAnisotropy===!0||t.anisotropy>0?z$:An,l=i.context(L2(No,a)).mul(s),u=i.context(e7(xT)).mul(Math.PI).mul(s),c=d_(l),h=d_(u);e.context.radiance.addAssign(c),e.context.iblIrradiance.addAssign(h);const d=e.context.lightingModel.clearcoatRadiance;if(d){const f=i.context(L2(i_,Rf)).mul(s),m=d_(f);d.addAssign(m)}}}const L2=(n,e)=>{let t=null;return{getUV:()=>(t===null&&(t=sn.negate().reflect(e),t=n.mul(n).mix(t,e).normalize(),t=t.transformDirection(Fo)),t),getTextureLevel:()=>n}},e7=n=>({getUV:()=>n,getTextureLevel:()=>ne(1)}),t7=new sC;class I2 extends Rn{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(t7),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new Jj(t):null}setupLightingModel(){return new E2}setupSpecular(){const e=Ht(ie(.04),Mt.rgb,n_);xr.assign(e),s_.assign(1)}setupVariants(){const e=this.metalnessNode?ne(this.metalnessNode):e9;n_.assign(e);let t=this.roughnessNode?ne(this.roughnessNode):J$;t=c2({roughness:t}),No.assign(t),this.setupSpecular(),Mt.assign(Qe(Mt.rgb.mul(e.oneMinus()),Mt.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const n7=new xB;class i7 extends I2{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(n7),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?ne(this.iorNode):p9;a_.assign(e),xr.assign(Ht(bf(TP(a_.sub(1).div(a_.add(1))).mul(Z$),ie(1)).mul(HP),Mt.rgb,n_)),s_.assign(Ht(HP,1,n_))}setupLightingModel(){return new E2(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?ne(this.clearcoatNode):n9,i=this.clearcoatRoughnessNode?ne(this.clearcoatRoughnessNode):i9;rT.assign(t),i_.assign(c2({roughness:i}))}if(this.useSheen){const t=this.sheenNode?ie(this.sheenNode):o9,i=this.sheenRoughnessNode?ne(this.sheenRoughnessNode):a9;Yc.assign(t),sT.assign(i)}if(this.useIridescence){const t=this.iridescenceNode?ne(this.iridescenceNode):u9,i=this.iridescenceIORNode?ne(this.iridescenceIORNode):c9,r=this.iridescenceThicknessNode?ne(this.iridescenceThicknessNode):h9;oT.assign(t),sP.assign(i),oP.assign(r)}if(this.useAnisotropy){const t=(this.anisotropyNode?ye(this.anisotropyNode):l9).toVar();Bl.assign(t.length()),Mn(Bl.equal(0),()=>{t.assign(ye(1,0))}).Else(()=>{t.divAssign(ye(Bl)),Bl.assign(Bl.saturate())}),aT.assign(Bl.pow2().mix(No.pow2(),1)),r_.assign(Pf[0].mul(t.x).add(Pf[1].mul(t.y))),Kc.assign(Pf[1].mul(t.x).sub(Pf[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?ne(this.transmissionNode):d9,i=this.thicknessNode?ne(this.thicknessNode):f9,r=this.attenuationDistanceNode?ne(this.attenuationDistanceNode):m9,s=this.attenuationColorNode?ie(this.attenuationColorNode):g9;if(cT.assign(t),lP.assign(i),uP.assign(r),cP.assign(s),this.useDispersion){const o=this.dispersionNode?ne(this.dispersionNode):S9;hP.assign(o)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?ie(this.clearcoatNormalNode):r9}setup(e){e.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(e),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const r7=me(({normal:n,lightDirection:e,builder:t})=>{const i=n.dot(e),r=ye(i.mul(.5).add(.5),0);if(t.material.gradientMap){const s=Fa("gradientMap","texture").context({getUV:()=>r});return ie(s.r)}else{const s=r.fwidth().mul(.5);return Ht(ie(.7),ie(1),zl(ne(.7).sub(s.x),ne(.7).add(s.x),r.x))}});class s7 extends v_{direct({lightDirection:e,lightColor:t,reflectedLight:i},r,s){const o=r7({normal:LP,lightDirection:e,builder:s}).mul(t);i.directDiffuse.addAssign(o.mul(Zc({diffuseColor:Mt.rgb})))}indirect({ambientOcclusion:e,irradiance:t,reflectedLight:i}){i.indirectDiffuse.addAssign(t.mul(Zc({diffuseColor:Mt}))),i.indirectDiffuse.mulAssign(e)}}const o7=new TB;class a7 extends Rn{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(o7),this.setValues(e)}setupLightingModel(){return new s7}}class l7 extends On{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){const e=ie(sn.z,0,sn.x.negate()).normalize(),t=sn.cross(e);return ye(e.dot(An),t.dot(An)).mul(.495).add(.5)}}const u7=ve(l7),c7=new EB;class h7 extends Rn{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(c7),this.setValues(e)}setupVariants(e){const t=u7;let i;e.material.matcap?i=Fa("matcap","texture").context({getUV:()=>t}):i=ie(Ht(.2,.8,t.y)),Mt.rgb.mulAssign(i.rgb)}}const d7=new tB;class f7 extends Rn{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.isPointsNodeMaterial=!0,this.setDefaultValues(d7),this.setValues(e)}}class p7 extends On{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:i}=this;if(this.getNodeType(e)==="vec2"){const s=t.cos(),o=t.sin();return iT(s,o,o.negate(),s).mul(i)}else{const s=t,o=qc(Qe(1,0,0,0),Qe(0,La(s.x),ps(s.x).negate(),0),Qe(0,ps(s.x),La(s.x),0),Qe(0,0,0,1)),a=qc(Qe(La(s.y),0,ps(s.y),0),Qe(0,1,0,0),Qe(ps(s.y).negate(),0,La(s.y),0),Qe(0,0,0,1)),l=qc(Qe(La(s.z),ps(s.z).negate(),0,0),Qe(ps(s.z),La(s.z),0,0),Qe(0,0,1,0),Qe(0,0,0,1));return o.mul(a).mul(l).mul(Qe(i,1)).xyz}}}const m7=oe(p7),g7=new Ix;class _7 extends Rn{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(g7),this.setValues(e)}setupPositionView(e){const{object:t,camera:i}=e,r=this.sizeAttenuation,{positionNode:s,rotationNode:o,scaleNode:a}=this,l=vT.mul(ie(s||0));let u=ye(Hl[0].xyz.length(),Hl[1].xyz.length());if(a!==null&&(u=u.mul(a)),r===!1)if(i.isPerspectiveCamera)u=u.mul(l.z.negate());else{const f=ne(2).div(_T.element(1).element(1));u=u.mul(f.mul(2))}let c=yT.xy;if(t.center&&t.center.isVector2===!0){const f=s$("center","vec2",t);c=c.sub(f.sub(.5))}c=c.mul(u);const h=ne(o||s9),d=m7(c,h);return Qe(l.xy.add(d),l.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}class v7 extends v_{constructor(){super(),this.shadowNode=ne(1).toVar("shadowMask")}direct({shadowMask:e}){this.shadowNode.mulAssign(e)}finish(e){Mt.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(Mt.rgb)}}const y7=new yB;class x7 extends Rn{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.setDefaultValues(y7),this.setValues(e)}setupLightingModel(){return new v7}}me(({texture:n,uv:e})=>{const i=ie().toVar();return Mn(e.x.lessThan(1e-4),()=>{i.assign(ie(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{i.assign(ie(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{i.assign(ie(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{i.assign(ie(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{i.assign(ie(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{i.assign(ie(0,0,-1))}).Else(()=>{const s=n.sample(e.add(ie(-.01,0,0))).r.sub(n.sample(e.add(ie(.01,0,0))).r),o=n.sample(e.add(ie(0,-.01,0))).r.sub(n.sample(e.add(ie(0,.01,0))).r),a=n.sample(e.add(ie(0,0,-.01))).r.sub(n.sample(e.add(ie(0,0,.01))).r);i.assign(ie(s,o,a))}),i.normalize()});let S7=class{constructor(e,t){this.nodes=e,this.info=t,this._context=self,this._animationLoop=null,this._requestId=null}start(){const e=(t,i)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this._animationLoop!==null&&this._animationLoop(t,i)};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}setAnimationLoop(e){this._animationLoop=e}setContext(e){this._context=e}dispose(){this.stop()}};class Os{constructor(){this.weakMap=new WeakMap}get(e){let t=this.weakMap;for(let i=0;i<e.length;i++)if(t=t.get(e[i]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let i=this.weakMap;for(let r=0;r<e.length;r++){const s=e[r];i.has(s)===!1&&i.set(s,new WeakMap),i=i.get(s)}return i.set(e[e.length-1],t),this}delete(e){let t=this.weakMap;for(let i=0;i<e.length;i++)if(t=t.get(e[i]),t===void 0)return!1;return t.delete(e[e.length-1])}}let T7=0;function b7(n){const e=Object.keys(n);let t=Object.getPrototypeOf(n);for(;t;){const i=Object.getOwnPropertyDescriptors(t);for(const r in i)if(i[r]!==void 0){const s=i[r];s&&typeof s.get=="function"&&e.push(r)}t=Object.getPrototypeOf(t)}return e}class w7{constructor(e,t,i,r,s,o,a,l,u,c){this.id=T7++,this._nodes=e,this._geometries=t,this.renderer=i,this.object=r,this.material=s,this.scene=o,this.camera=a,this.lightsNode=l,this.context=u,this.geometry=r.geometry,this.version=s.version,this.drawRange=null,this.attributes=null,this.pipeline=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=c,this.clippingContextCacheKey=c!==null?c.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.material.addEventListener("dispose",this.onMaterialDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().monitor)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,i=[],r=new Set;for(const s of e){const o=s.node&&s.node.attribute?s.node.attribute:t.getAttribute(s.name);if(o===void 0)continue;i.push(o);const a=o.isInterleavedBufferAttribute?o.data:o;r.add(a)}return this.attributes=i,this.vertexBuffers=Array.from(r.values()),i}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:i,group:r,drawRange:s}=this,o=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),a=this.getIndex(),l=a!==null,u=i.isInstancedBufferGeometry?i.instanceCount:e.count>1?e.count:1;if(u===0)return null;if(o.instanceCount=u,e.isBatchedMesh===!0)return o;let c=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(c=2);let h=s.start*c,d=(s.start+s.count)*c;r!==null&&(h=Math.max(h,r.start*c),d=Math.min(d,(r.start+r.count)*c));const f=i.attributes.position;let m=1/0;l?m=a.count:f!=null&&(m=f.count),h=Math.max(h,0),d=Math.min(d,m);const g=d-h;return g<0||g===1/0?null:(o.vertexCount=g,o.firstVertex=h,o)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const i of Object.keys(e.attributes).sort()){const r=e.attributes[i];t+=i+",",r.data&&(t+=r.data.stride+","),r.offset&&(t+=r.offset+","),r.itemSize&&(t+=r.itemSize+","),r.normalized&&(t+="n,")}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t}=this;let i=t.customProgramCacheKey();for(const r of b7(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(r))continue;const s=t[r];let o;if(s!==null){const a=typeof s;a==="number"?o=s!==0?"1":"0":a==="object"?(o="{",s.isTexture&&(o+=s.mapping),o+="}"):o=String(s)}else o=String(s);i+=o+","}return i+=this.clippingContextCacheKey+",",e.geometry&&(i+=this.getGeometryCacheKey()),e.skeleton&&(i+=e.skeleton.bones.length+","),e.morphTargetInfluences&&(i+=e.morphTargetInfluences.length+","),e.isBatchedMesh&&(i+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(i+=e._colorsTexture.uuid+",")),e.count>1&&(i+=e.uuid+","),i+=e.receiveShadow+",",m6(i)}get needsGeometryUpdate(){return this.geometry.id!==this.object.geometry.id}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=this._nodes.getCacheKey(this.scene,this.lightsNode);return this.object.receiveShadow&&(e+=1),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.onDispose()}}const Jc=[];class M7{constructor(e,t,i,r,s,o){this.renderer=e,this.nodes=t,this.geometries=i,this.pipelines=r,this.bindings=s,this.info=o,this.chainMaps={}}get(e,t,i,r,s,o,a,l){const u=this.getChainMap(l);Jc[0]=e,Jc[1]=t,Jc[2]=o,Jc[3]=s;let c=u.get(Jc);return c===void 0?(c=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,i,r,s,o,a,l),u.set(Jc,c)):(c.updateClipping(a),c.needsGeometryUpdate&&c.setGeometry(e.geometry),(c.version!==t.version||c.needsUpdate)&&(c.initialCacheKey!==c.getCacheKey()?(c.dispose(),c=this.get(e,t,i,r,s,o,a,l)):c.version=t.version)),c}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new Os)}dispose(){this.chainMaps={}}createRenderObject(e,t,i,r,s,o,a,l,u,c,h){const d=this.getChainMap(h),f=new w7(e,t,i,r,s,o,a,l,u,c);return f.onDispose=()=>{this.pipelines.delete(f),this.bindings.delete(f),this.nodes.delete(f),d.delete(f.getChainArray())},f}}class Oa{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const Bs={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},Ba=16,E7=211,A7=212;class C7 extends Oa{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==void 0&&this.backend.destroyAttribute(e),t}update(e,t){const i=this.get(e);if(i.version===void 0)t===Bs.VERTEX?this.backend.createAttribute(e):t===Bs.INDEX?this.backend.createIndexAttribute(e):t===Bs.STORAGE?this.backend.createStorageAttribute(e):t===Bs.INDIRECT&&this.backend.createIndirectStorageAttribute(e),i.version=this._getBufferAttribute(e).version;else{const r=this._getBufferAttribute(e);(i.version<r.version||r.usage===hc)&&(this.backend.updateAttribute(e),i.version=r.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function R7(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function U2(n){return n.index!==null?n.index.version:n.attributes.position.version}function F2(n){const e=[],t=n.index,i=n.attributes.position;if(t!==null){const s=t.array;for(let o=0,a=s.length;o<a;o+=3){const l=s[o+0],u=s[o+1],c=s[o+2];e.push(l,u,u,c,c,l)}}else{const s=i.array;for(let o=0,a=s.length/3-1;o<a;o+=3){const l=o+0,u=o+1,c=o+2;e.push(l,u,u,c,c,l)}}const r=new(R7(e)?Rx:Cx)(e,1);return r.version=U2(n),r}class N7 extends Oa{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,i=this.get(t);i.initialized=!0,this.info.memory.geometries++;const r=()=>{this.info.memory.geometries--;const s=t.index,o=e.getAttributes();s!==null&&this.attributes.delete(s);for(const l of o)this.attributes.delete(l);const a=this.wireframes.get(t);a!==void 0&&this.attributes.delete(a),t.removeEventListener("dispose",r)};t.addEventListener("dispose",r)}updateAttributes(e){const t=e.getAttributes();for(const s of t)s.isStorageBufferAttribute||s.isStorageInstancedBufferAttribute?this.updateAttribute(s,Bs.STORAGE):this.updateAttribute(s,Bs.VERTEX);const i=this.getIndex(e);i!==null&&this.updateAttribute(i,Bs.INDEX);const r=e.geometry.indirect;r!==null&&this.updateAttribute(r,Bs.INDIRECT)}updateAttribute(e,t){const i=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,i)):this.attributeCall.get(e.data)!==i&&(this.attributes.update(e,t),this.attributeCall.set(e.data,i),this.attributeCall.set(e,i)):this.attributeCall.get(e)!==i&&(this.attributes.update(e,t),this.attributeCall.set(e,i))}getIndirect(e){return e.geometry.indirect}getIndex(e){const{geometry:t,material:i}=e;let r=t.index;if(i.wireframe===!0){const s=this.wireframes;let o=s.get(t);o===void 0?(o=F2(t),s.set(t,o)):o.version!==U2(t)&&(this.attributes.delete(o),o=F2(t),s.set(t,o)),r=o}return r}}class P7{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0,previousFrameCalls:0,timestampCalls:0},this.compute={calls:0,frameCalls:0,timestamp:0,previousFrameCalls:0,timestampCalls:0},this.memory={geometries:0,textures:0}}update(e,t,i){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=i*(t/3):e.isPoints?this.render.points+=i*t:e.isLineSegments?this.render.lines+=i*(t/2):e.isLine?this.render.lines+=i*(t-1):console.error("THREE.WebGPUInfo: Unknown object type.")}updateTimestamp(e,t){this[e].timestampCalls===0&&(this[e].timestamp=0),this[e].timestamp+=t,this[e].timestampCalls++,this[e].timestampCalls>=this[e].previousFrameCalls&&(this[e].timestampCalls=0)}reset(){const e=this.render.frameCalls;this.render.previousFrameCalls=e;const t=this.compute.frameCalls;this.compute.previousFrameCalls=t,this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class O2{constructor(e){this.cacheKey=e,this.usedTimes=0}}class D7 extends O2{constructor(e,t,i){super(e),this.vertexProgram=t,this.fragmentProgram=i}}class L7 extends O2{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let I7=0;class zT{constructor(e,t,i,r=null,s=null){this.id=I7++,this.code=e,this.stage=t,this.name=i,this.transforms=r,this.attributes=s,this.usedTimes=0}}class U7 extends Oa{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:i}=this,r=this.get(e);if(this._needsComputeUpdate(e)){const s=r.pipeline;s&&(s.usedTimes--,s.computeProgram.usedTimes--);const o=this.nodes.getForCompute(e);let a=this.programs.compute.get(o.computeShader);a===void 0&&(s&&s.computeProgram.usedTimes===0&&this._releaseProgram(s.computeProgram),a=new zT(o.computeShader,"compute",e.name,o.transforms,o.nodeAttributes),this.programs.compute.set(o.computeShader,a),i.createProgram(a));const l=this._getComputeCacheKey(e,a);let u=this.caches.get(l);u===void 0&&(s&&s.usedTimes===0&&this._releasePipeline(s),u=this._getComputePipeline(e,a,l,t)),u.usedTimes++,a.usedTimes++,r.version=e.version,r.pipeline=u}return r.pipeline}getForRender(e,t=null){const{backend:i}=this,r=this.get(e);if(this._needsRenderUpdate(e)){const s=r.pipeline;s&&(s.usedTimes--,s.vertexProgram.usedTimes--,s.fragmentProgram.usedTimes--);const o=e.getNodeBuilderState(),a=e.material?e.material.name:"";let l=this.programs.vertex.get(o.vertexShader);l===void 0&&(s&&s.vertexProgram.usedTimes===0&&this._releaseProgram(s.vertexProgram),l=new zT(o.vertexShader,"vertex",a),this.programs.vertex.set(o.vertexShader,l),i.createProgram(l));let u=this.programs.fragment.get(o.fragmentShader);u===void 0&&(s&&s.fragmentProgram.usedTimes===0&&this._releaseProgram(s.fragmentProgram),u=new zT(o.fragmentShader,"fragment",a),this.programs.fragment.set(o.fragmentShader,u),i.createProgram(u));const c=this._getRenderCacheKey(e,l,u);let h=this.caches.get(c);h===void 0?(s&&s.usedTimes===0&&this._releasePipeline(s),h=this._getRenderPipeline(e,l,u,c,t)):e.pipeline=h,h.usedTimes++,l.usedTimes++,u.usedTimes++,r.pipeline=h}return r.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,i,r){i=i||this._getComputeCacheKey(e,t);let s=this.caches.get(i);return s===void 0&&(s=new L7(i,t),this.caches.set(i,s),this.backend.createComputePipeline(s,r)),s}_getRenderPipeline(e,t,i,r,s){r=r||this._getRenderCacheKey(e,t,i);let o=this.caches.get(r);return o===void 0&&(o=new D7(r,t,i),this.caches.set(r,o),e.pipeline=o,this.backend.createRenderPipeline(e,s)),o}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,i){return t.id+","+i.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,i=e.stage;this.programs[i].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class F7 extends Oa{constructor(e,t,i,r,s,o){super(),this.backend=e,this.textures=i,this.pipelines=s,this.attributes=r,this.nodes=t,this.info=o,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const i of t){const r=this.get(i);r.bindGroup===void 0&&(this._init(i),this.backend.createBindings(i,t,0),r.bindGroup=i)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const i of t){const r=this.get(i);r.bindGroup===void 0&&(this._init(i),this.backend.createBindings(i,t,0),r.bindGroup=i)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isStorageBuffer){const i=t.attribute,r=i.isIndirectStorageBufferAttribute?Bs.INDIRECT:Bs.STORAGE;this.attributes.update(i,r)}}_update(e,t){const{backend:i}=this;let r=!1,s=!0,o=0,a=0;for(const l of e.bindings)if(!(l.isNodeUniformsGroup&&this.nodes.updateGroup(l)===!1)){if(l.isUniformBuffer)l.update()&&i.updateBinding(l);else if(l.isSampler)l.update();else if(l.isSampledTexture){const u=this.textures.get(l.texture);l.needsBindingsUpdate(u.generation)&&(r=!0);const c=l.update(),h=l.texture;c&&this.textures.updateTexture(h);const d=i.get(h);if(d.externalTexture!==void 0||u.isDefaultTexture?s=!1:(o=o*10+h.id,a+=h.version),i.isWebGPUBackend===!0&&d.texture===void 0&&d.externalTexture===void 0&&(console.error("Bindings._update: binding should be available:",l,c,h,l.textureNode.value,r),this.textures.updateTexture(h),r=!0),h.isStorageTexture===!0){const f=this.get(h);l.store===!0?f.needsMipmap=!0:this.textures.needsMipmaps(h)&&f.needsMipmap===!0&&(this.backend.generateMipmaps(h),f.needsMipmap=!1)}}}r===!0&&this.backend.updateBindings(e,t,s?o:0,a)}}function O7(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function B2(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function k2(n){return(n.transmission>0||n.transmissionNode)&&n.side===Ti&&n.forceSinglePass===!1}class B7{constructor(e,t,i){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,i),this.lightsArray=[],this.scene=t,this.camera=i,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,i,r,s,o,a){let l=this.renderItems[this.renderItemsIndex];return l===void 0?(l={id:e.id,object:e,geometry:t,material:i,groupOrder:r,renderOrder:e.renderOrder,z:s,group:o,clippingContext:a},this.renderItems[this.renderItemsIndex]=l):(l.id=e.id,l.object=e,l.geometry=t,l.material=i,l.groupOrder=r,l.renderOrder=e.renderOrder,l.z=s,l.group=o,l.clippingContext=a),this.renderItemsIndex++,l}push(e,t,i,r,s,o,a){const l=this.getNextRenderItem(e,t,i,r,s,o,a);e.occlusionTest===!0&&this.occlusionQueryCount++,i.transparent===!0||i.transmission>0?(k2(i)&&this.transparentDoublePass.push(l),this.transparent.push(l)):this.opaque.push(l)}unshift(e,t,i,r,s,o,a){const l=this.getNextRenderItem(e,t,i,r,s,o,a);i.transparent===!0||i.transmission>0?(k2(i)&&this.transparentDoublePass.unshift(l),this.transparent.unshift(l)):this.opaque.unshift(l)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||O7),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||B2),this.transparent.length>1&&this.transparent.sort(t||B2)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const i=this.renderItems[e];if(i.id===null)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.groupOrder=null,i.renderOrder=null,i.z=null,i.group=null,i.clippingContext=null}}}class k7{constructor(e){this.lighting=e,this.lists=new Os}get(e,t){const i=this.lists,r=[e,t];let s=i.get(r);return s===void 0&&(s=new B7(this.lighting,e,t),i.set(r,s)),s}dispose(){this.lists=new Os}}let z7=0;class G7{constructor(){this.id=z7++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new et,this.scissor=!1,this.scissorValue=new et,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.sampleCount=1,this.width=0,this.height=0,this.isRenderContext=!0}getCacheKey(){return z2(this)}}function z2(n){const{textures:e,activeCubeFace:t}=n,i=[t];for(const r of e)i.push(r.id);return YS(i)}class V7{constructor(){this.chainMaps={}}get(e=null,t=null,i=null){const r=[];e!==null&&r.push(e),t!==null&&r.push(t),r.length===0&&r.push({id:"default"});let s;if(i===null)s="default";else{const l=i.texture.format;s=`${i.textures.length}:${l}:${i.samples}:${i.depthBuffer}:${i.stencilBuffer}`}const o=this.getChainMap(s);let a=o.get(r);return a===void 0&&(a=new G7,o.set(r,a)),i!==null&&(a.sampleCount=i.samples===0?1:i.samples),a}getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new Os)}dispose(){this.chainMaps={}}}const H7=new N;class W7 extends Oa{constructor(e,t,i){super(),this.renderer=e,this.backend=t,this.info=i}updateRenderTarget(e,t=0){const i=this.get(e),r=e.samples===0?1:e.samples,s=i.depthTextureMips||(i.depthTextureMips={}),o=e.textures,a=this.getSize(o[0]),l=a.width>>t,u=a.height>>t;let c=e.depthTexture||s[t];const h=e.depthBuffer===!0||e.stencilBuffer===!0;let d=!1;c===void 0&&h&&(c=new Aa,c.format=e.stencilBuffer?Ns:Rs,c.type=e.stencilBuffer?Cs:rn,c.image.width=l,c.image.height=u,s[t]=c),(i.width!==a.width||a.height!==i.height)&&(d=!0,c&&(c.needsUpdate=!0,c.image.width=l,c.image.height=u)),i.width=a.width,i.height=a.height,i.textures=o,i.depthTexture=c||null,i.depth=e.depthBuffer,i.stencil=e.stencilBuffer,i.renderTarget=e,i.sampleCount!==r&&(d=!0,c&&(c.needsUpdate=!0),i.sampleCount=r);const f={sampleCount:r};for(let m=0;m<o.length;m++){const g=o[m];d&&(g.needsUpdate=!0),this.updateTexture(g,f)}if(c&&this.updateTexture(c,f),i.initialized!==!0){i.initialized=!0;const m=()=>{e.removeEventListener("dispose",m);for(let g=0;g<o.length;g++)this._destroyTexture(o[g]);c&&this._destroyTexture(c),this.delete(e)};e.addEventListener("dispose",m)}}updateTexture(e,t={}){const i=this.get(e);if(i.initialized===!0&&i.version===e.version)return;const r=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,s=this.backend;if(r&&i.initialized===!0&&(s.destroySampler(e),s.destroyTexture(e)),e.isFramebufferTexture){const u=this.renderer.getRenderTarget();u?e.type=u.texture.type:e.type=oi}const{width:o,height:a,depth:l}=this.getSize(e);if(t.width=o,t.height=a,t.depth=l,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,o,a):1,r||e.isStorageTexture===!0)s.createSampler(e),s.createTexture(e,t),i.generation=e.version;else if(i.initialized!==!0&&s.createSampler(e),e.version>0){const c=e.image;if(c===void 0)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(c.complete===!1)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const h=[];for(const d of e.images)h.push(d);t.images=h}else t.image=c;(i.isDefaultTexture===void 0||i.isDefaultTexture===!0)&&(s.createTexture(e,t),i.isDefaultTexture=!1,i.generation=e.version),e.source.dataReady===!0&&s.updateTexture(e,t),t.needsMipmaps&&e.mipmaps.length===0&&s.generateMipmaps(e)}}else s.createDefaultTexture(e),i.isDefaultTexture=!0,i.generation=e.version;if(i.initialized!==!0){i.initialized=!0,i.generation=e.version,this.info.memory.textures++;const u=()=>{e.removeEventListener("dispose",u),this._destroyTexture(e),this.info.memory.textures--};e.addEventListener("dispose",u)}i.version=e.version}getSize(e,t=H7){let i=e.images?e.images[0]:e.image;return i?(i.image!==void 0&&(i=i.image),t.width=i.width||1,t.height=i.height||1,t.depth=e.isCubeTexture?6:i.depth||1):t.width=t.height=t.depth=1,t}getMipLevels(e,t,i){let r;return e.isCompressedTexture?e.mipmaps?r=e.mipmaps.length:r=1:r=Math.floor(Math.log2(Math.max(t,i)))+1,r}needsMipmaps(e){return this.isEnvironmentTexture(e)||e.isCompressedTexture===!0||e.generateMipmaps}isEnvironmentTexture(e){const t=e.mapping;return t===pa||t===ma||t===Br||t===kr}_destroyTexture(e){this.backend.destroySampler(e),this.backend.destroyTexture(e),this.delete(e)}}class GT extends Ue{constructor(e,t,i,r=1){super(e,t,i),this.a=r}set(e,t,i,r=1){return this.a=r,super.set(e,t,i)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class $7 extends Ct{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}class j7 extends tt{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}add(e){return this.nodes.push(e),this}If(e,t){const i=new Zg(t);return this._currentCond=qi(e,i),this.add(this._currentCond)}ElseIf(e,t){const i=new Zg(t),r=qi(e,i);return this._currentCond.elseNode=r,this._currentCond=r,this}Else(e){return this._currentCond.elseNode=new Zg(e),this}build(e,...t){const i=JN();e_(this);for(const r of this.nodes)r.build(e,"void");return e_(i),this.outputNode?this.outputNode.build(e,...t):super.build(e,...t)}else(...e){return console.warn("TSL.StackNode: .else() has been renamed to .Else()."),this.Else(...e)}elseif(...e){return console.warn("TSL.StackNode: .elseif() has been renamed to .ElseIf()."),this.ElseIf(...e)}}const VT=oe(j7);new us,new N,new N,new N,new pt,new N(0,0,-1),new et,new N,new N,new et,new he;const X7=new mc;Uf.flipX(),X7.depthTexture=new Aa(1,1);const HT=new Jd(-1,1,1,-1,0,1);class q7 extends ci{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new _n([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new _n(t,2))}}const Y7=new q7;class G2 extends $n{constructor(e=null){super(Y7,e),this.camera=HT,this.isQuadMesh=!0}async renderAsync(e){return e.renderAsync(this,HT)}render(e){e.render(this,HT)}}const zf=new gr,WT=new pt;class Ki extends tt{static get type(){return"SceneNode"}constructor(e=Ki.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,i=this.scene!==null?this.scene:e.scene;let r;return t===Ki.BACKGROUND_BLURRINESS?r=Lt("backgroundBlurriness","float",i):t===Ki.BACKGROUND_INTENSITY?r=Lt("backgroundIntensity","float",i):t===Ki.BACKGROUND_ROTATION?r=Ze("mat4").label("backgroundRotation").setGroup(Xe).onRenderUpdate(()=>{const s=i.background;return s!==null&&s.isTexture&&s.mapping!==qy?(zf.copy(i.backgroundRotation),zf.x*=-1,zf.y*=-1,zf.z*=-1,WT.makeRotationFromEuler(zf)):WT.identity(),WT}):console.error("THREE.SceneNode: Unknown scope:",t),r}}Ki.BACKGROUND_BLURRINESS="backgroundBlurriness",Ki.BACKGROUND_INTENSITY="backgroundIntensity",Ki.BACKGROUND_ROTATION="backgroundRotation";const K7=ve(Ki,Ki.BACKGROUND_BLURRINESS),V2=ve(Ki,Ki.BACKGROUND_INTENSITY),Q7=ve(Ki,Ki.BACKGROUND_ROTATION),Z7=new he;class J7 extends Af{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return e.object.isQuadMesh&&this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class H2 extends J7{static get type(){return"PassMultipleTextureNode"}constructor(e,t,i=!1){super(e,null),this.textureName=t,this.previousTexture=i}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class M_ extends On{static get type(){return"PassNode"}constructor(e,t,i,r={}){super("vec4"),this.scope=e,this.scene=t,this.camera=i,this.options=r,this._pixelRatio=1,this._width=1,this._height=1;const s=new Aa;s.isRenderTargetTexture=!0,s.name="depth";const o=new mc(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:wi,...r});o.texture.name="output",o.depthTexture=s,this.renderTarget=o,this._textures={output:o.texture,depth:s},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=Ze(0),this._cameraFar=Ze(0),this._mrt=null,this.isPassNode=!0,this.updateBeforeType=at.FRAME}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}isGlobal(){return!0}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const i=this._textures[e],r=this.renderTarget.textures.indexOf(i);this.renderTarget.textures[r]=t,this._textures[e]=t,this._previousTextures[e]=i,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=pe(new H2(this,e)),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=pe(new H2(this,e,!0)),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const i=this._cameraNear,r=this._cameraFar;this._viewZNodes[e]=t=QP(this.getTextureNode(e),i,r)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const i=this._cameraNear,r=this._cameraFar,s=this.getViewZNode(e);this._linearDepthNodes[e]=t=Of(s,i,r)}return t}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,e.backend.isWebGLBackend===!0&&(this.renderTarget.samples=0),this.scope===M_.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:i,camera:r}=this;this._pixelRatio=t.getPixelRatio();const s=t.getSize(Z7);this.setSize(s.width,s.height);const o=t.getRenderTarget(),a=t.getMRT();this._cameraNear.value=r.near,this._cameraFar.value=r.far;for(const l in this._previousTextures)this.toggleTexture(l);t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.render(i,r),t.setRenderTarget(o),t.setMRT(a)}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget.setSize(i,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}M_.COLOR="color",M_.DEPTH="depth";const eX=me(([n,e])=>n.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),tX=me(([n,e])=>(n=n.mul(e),n.div(n.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),nX=me(([n,e])=>{n=n.mul(e),n=n.sub(.004).max(0);const t=n.mul(n.mul(6.2).add(.5)),i=n.mul(n.mul(6.2).add(1.7)).add(.06);return t.div(i).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),iX=me(([n])=>{const e=n.mul(n.add(.0245786)).sub(90537e-9),t=n.mul(n.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),rX=me(([n,e])=>{const t=Pi(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),i=Pi(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return n=n.mul(e).div(.6),n=t.mul(n),n=iX(n),n=i.mul(n),n.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),sX=Pi(ie(1.6605,-.1246,-.0182),ie(-.5876,1.1329,-.1006),ie(-.0728,-.0083,1.1187)),oX=Pi(ie(.6274,.0691,.0164),ie(.3293,.9195,.088),ie(.0433,.0113,.8956)),aX=me(([n])=>{const e=ie(n).toVar(),t=ie(e.mul(e)).toVar(),i=ie(t.mul(t)).toVar();return ne(15.5).mul(i.mul(t)).sub(ht(40.14,i.mul(e))).add(ht(31.96,i).sub(ht(6.868,t.mul(e))).add(ht(.4298,t).add(ht(.1191,e).sub(.00232))))}),lX=me(([n,e])=>{const t=ie(n).toVar(),i=Pi(ie(.856627153315983,.137318972929847,.11189821299995),ie(.0951212405381588,.761241990602591,.0767994186031903),ie(.0482516061458583,.101439036467562,.811302368396859)),r=Pi(ie(1.1271005818144368,-.1413297634984383,-.14132976349843826),ie(-.11060664309660323,1.157823702216272,-.11060664309660294),ie(-.016493938717834573,-.016493938717834257,1.2519364065950405)),s=ne(-12.47393),o=ne(4.026069);return t.mulAssign(e),t.assign(oX.mul(t)),t.assign(i.mul(t)),t.assign(Xi(t,1e-10)),t.assign(Do(t)),t.assign(t.sub(s).div(o.sub(s))),t.assign(Lo(t,0,1)),t.assign(aX(t)),t.assign(r.mul(t)),t.assign(u_(Xi(ie(0),t),ie(2.2))),t.assign(sX.mul(t)),t.assign(Lo(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),uX=me(([n,e])=>{const t=ne(.76),i=ne(.15);n=n.mul(e);const r=bf(n.r,bf(n.g,n.b)),s=qi(r.lessThan(.08),r.sub(ht(6.25,r.mul(r))),.04);n.subAssign(s);const o=Xi(n.r,Xi(n.g,n.b));Mn(o.lessThan(t),()=>n);const a=ji(1,t),l=ji(1,a.mul(a).div(o.add(a.sub(t))));n.mulAssign(l.div(o));const u=ji(1,Po(1,i.mul(o.sub(l)).add(1)));return Ht(n,ie(l),u)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class Bn extends tt{static get type(){return"CodeNode"}constructor(e="",t=[],i=""){super("code"),this.isCodeNode=!0,this.code=e,this.includes=t,this.language=i}isGlobal(){return!0}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const r of t)r.build(e);const i=e.getCodeFromNode(this,this.getNodeType(e));return i.code=this.code,i.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}class cX extends Bn{static get type(){return"FunctionNode"}constructor(e="",t=[],i=""){super(e,t,i)}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let i=t.nodeFunction;return i===void 0&&(i=e.parser.parseFunction(this.code),t.nodeFunction=i),i}generate(e,t){super.generate(e);const i=this.getNodeFunction(e),r=i.name,s=i.type,o=e.getCodeFromNode(this,s);r!==""&&(o.name=r);const a=e.getPropertyName(o),l=this.getNodeFunction(e).getCode(a);return o.code=l+`
`,t==="property"?a:e.format(`${a}()`,s,t)}}function W2(n){let e;const t=n.context.getViewZ;return t!==void 0&&(e=t(this)),(e||En.z).negate()}const hX=me(([n,e],t)=>{const i=W2(t);return zl(n,e,i)}),dX=me(([n],e)=>{const t=W2(e);return n.mul(n,t,t).negate().exp().oneMinus()}),$2=me(([n,e])=>Qe(e.toFloat().mix(o_.rgb,n.toVec3()),o_.a));class fX extends tt{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:i}=e;i.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}oe(fX);class ks extends On{static get type(){return"AtomicFunctionNode"}constructor(e,t,i,r=null){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=i,this.storeNode=r}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=this.method,i=this.getNodeType(e),r=this.getInputType(e),s=this.pointerNode,o=this.valueNode,a=[];a.push(`&${s.build(e,r)}`),a.push(o.build(e,r));const l=`${e.getMethod(t,i)}( ${a.join(", ")} )`;if(this.storeNode!==null){const u=this.storeNode.build(e,r);e.addLineFlowCode(`${u} = ${l}`,this)}else e.addLineFlowCode(l,this)}}ks.ATOMIC_LOAD="atomicLoad",ks.ATOMIC_STORE="atomicStore",ks.ATOMIC_ADD="atomicAdd",ks.ATOMIC_SUB="atomicSub",ks.ATOMIC_MAX="atomicMax",ks.ATOMIC_MIN="atomicMin",ks.ATOMIC_AND="atomicAnd",ks.ATOMIC_OR="atomicOr",ks.ATOMIC_XOR="atomicXor",oe(ks);let E_;function Gf(n){E_=E_||new WeakMap;let e=E_.get(n);return e===void 0&&E_.set(n,e={}),e}function j2(n){const e=Gf(n);return e.shadowMatrix||(e.shadowMatrix=Ze("mat4").setGroup(Xe).onRenderUpdate(()=>(n.castShadow!==!0&&n.shadow.updateMatrices(n),n.shadow.matrix)))}function pX(n){const e=Gf(n);if(e.projectionUV===void 0){const t=j2(n).mul(Cf);e.projectionUV=t.xyz.div(t.w)}return e.projectionUV}function X2(n){const e=Gf(n);return e.position||(e.position=Ze(new N).setGroup(Xe).onRenderUpdate((t,i)=>i.value.setFromMatrixPosition(n.matrixWorld)))}function mX(n){const e=Gf(n);return e.targetPosition||(e.targetPosition=Ze(new N).setGroup(Xe).onRenderUpdate((t,i)=>i.value.setFromMatrixPosition(n.target.matrixWorld)))}function $T(n){const e=Gf(n);return e.viewPosition||(e.viewPosition=Ze(new N).setGroup(Xe).onRenderUpdate(({camera:t},i)=>{i.value=i.value||new N,i.value.setFromMatrixPosition(n.matrixWorld),i.value.applyMatrix4(t.matrixWorldInverse)}))}const q2=n=>Fo.transformDirection(X2(n).sub(mX(n))),gX=n=>n.sort((e,t)=>e.id-t.id),_X=(n,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===n)return t;return null},jT=new WeakMap;class Y2 extends tt{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=ie().toVar("totalDiffuse"),this.totalSpecularNode=ie().toVar("totalSpecular"),this.outgoingLightNode=ie().toVar("outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=[],t=this._lights;for(let i=0;i<t.length;i++)e.push(t[i].id);return YS(e)}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const i of this._lightNodes)t.push(i.getSelf().getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getDataFromNode(this);for(const i of t.nodes)i.build(e)}setupLightsNode(e){const t=[],i=this._lightNodes,r=gX(this._lights),s=e.renderer.library;for(const o of r)if(o.isNode)t.push(pe(o));else{let a=null;if(i!==null&&(a=_X(o.id,i)),a===null){const l=s.getLightNodeClass(o.constructor);if(l===null){console.warn(`LightsNode.setupNodeLights: Light node not found for ${o.constructor.name}`);continue}let u=null;jT.has(o)?u=jT.get(o):(u=pe(new l(o)),jT.set(o,u)),t.push(u)}}this._lightNodes=t}setupLights(e,t){for(const i of t)i.build(e)}setup(e){this._lightNodes===null&&this.setupLightsNode(e);const t=e.context,i=t.lightingModel;let r=this.outgoingLightNode;if(i){const{_lightNodes:s,totalDiffuseNode:o,totalSpecularNode:a}=this;t.outgoingLight=r;const l=e.addStack(),u=e.getDataFromNode(this);u.nodes=l.nodes,i.start(t,l,e),this.setupLights(e,s),i.indirect(t,l,e);const{backdrop:c,backdropAlpha:h}=t,{directDiffuse:d,directSpecular:f,indirectDiffuse:m,indirectSpecular:g}=t.reflectedLight;let _=d.add(m);c!==null&&(h!==null?_=ie(h.mix(_,c)):_=ie(c),t.material.transparent=!0),o.assign(_),a.assign(f.add(g)),r.assign(o.add(a)),i.finish(t,l,e),r=r.bypass(e.removeStack())}return r}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}class vX extends tt{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=at.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({material:e}){K2.assign(e.shadowPositionNode||Cf)}dispose(){this.updateBeforeType=at.NONE}}const K2=ie().toVar("shadowPositionWorld");function yX(n,e={}){return e.toneMapping=n.toneMapping,e.toneMappingExposure=n.toneMappingExposure,e.outputColorSpace=n.outputColorSpace,e.renderTarget=n.getRenderTarget(),e.activeCubeFace=n.getActiveCubeFace(),e.activeMipmapLevel=n.getActiveMipmapLevel(),e.renderObjectFunction=n.getRenderObjectFunction(),e.pixelRatio=n.getPixelRatio(),e.mrt=n.getMRT(),e.clearColor=n.getClearColor(e.clearColor||new Ue),e.clearAlpha=n.getClearAlpha(),e.autoClear=n.autoClear,e.scissorTest=n.getScissorTest(),e}function xX(n,e){return e=yX(n,e),n.setMRT(null),n.setRenderObjectFunction(null),n.setClearColor(0,1),n.autoClear=!0,e}function SX(n,e){n.toneMapping=e.toneMapping,n.toneMappingExposure=e.toneMappingExposure,n.outputColorSpace=e.outputColorSpace,n.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),n.setRenderObjectFunction(e.renderObjectFunction),n.setPixelRatio(e.pixelRatio),n.setMRT(e.mrt),n.setClearColor(e.clearColor,e.clearAlpha),n.autoClear=e.autoClear,n.setScissorTest(e.scissorTest)}function TX(n,e={}){return e.background=n.background,e.backgroundNode=n.backgroundNode,e.overrideMaterial=n.overrideMaterial,e}function bX(n,e){return e=TX(n,e),n.background=null,n.backgroundNode=null,n.overrideMaterial=null,e}function wX(n,e){n.background=e.background,n.backgroundNode=e.backgroundNode,n.overrideMaterial=e.overrideMaterial}function MX(n,e,t){return t=xX(n,t),t=bX(e,t),t}function EX(n,e,t){SX(n,t),wX(e,t)}const Q2=new WeakMap,AX=me(([n,e,t])=>{let i=Cf.sub(n).length();return i=i.sub(e).div(t.sub(e)),i=i.saturate(),i}),CX=n=>{const e=n.shadow.camera,t=Lt("near","float",e).setGroup(Xe),i=Lt("far","float",e).setGroup(Xe),r=w$(n);return AX(r,t,i)},RX=n=>{let e=Q2.get(n);if(e===void 0){const t=n.isPointLight?CX(n):null;e=new Rn,e.colorNode=Qe(0,0,0,1),e.depthNode=t,e.isShadowNodeMaterial=!0,e.name="ShadowMaterial",e.fog=!1,Q2.set(n,e)}return e},NX=me(({depthTexture:n,shadowCoord:e})=>xt(n,e.xy).compare(e.z)),PX=me(({depthTexture:n,shadowCoord:e,shadow:t})=>{const i=(g,_)=>xt(n,g).compare(_),r=Lt("mapSize","vec2",t).setGroup(Xe),s=Lt("radius","float",t).setGroup(Xe),o=ye(1).div(r),a=o.x.negate().mul(s),l=o.y.negate().mul(s),u=o.x.mul(s),c=o.y.mul(s),h=a.div(2),d=l.div(2),f=u.div(2),m=c.div(2);return Di(i(e.xy.add(ye(a,l)),e.z),i(e.xy.add(ye(0,l)),e.z),i(e.xy.add(ye(u,l)),e.z),i(e.xy.add(ye(h,d)),e.z),i(e.xy.add(ye(0,d)),e.z),i(e.xy.add(ye(f,d)),e.z),i(e.xy.add(ye(a,0)),e.z),i(e.xy.add(ye(h,0)),e.z),i(e.xy,e.z),i(e.xy.add(ye(f,0)),e.z),i(e.xy.add(ye(u,0)),e.z),i(e.xy.add(ye(h,m)),e.z),i(e.xy.add(ye(0,m)),e.z),i(e.xy.add(ye(f,m)),e.z),i(e.xy.add(ye(a,c)),e.z),i(e.xy.add(ye(0,c)),e.z),i(e.xy.add(ye(u,c)),e.z)).mul(1/17)}),DX=me(({depthTexture:n,shadowCoord:e,shadow:t})=>{const i=(c,h)=>xt(n,c).compare(h),r=Lt("mapSize","vec2",t).setGroup(Xe),s=ye(1).div(r),o=s.x,a=s.y,l=e.xy,u=Da(l.mul(r).add(.5));return l.subAssign(u.mul(s)),Di(i(l,e.z),i(l.add(ye(o,0)),e.z),i(l.add(ye(0,a)),e.z),i(l.add(s),e.z),Ht(i(l.add(ye(o.negate(),0)),e.z),i(l.add(ye(o.mul(2),0)),e.z),u.x),Ht(i(l.add(ye(o.negate(),a)),e.z),i(l.add(ye(o.mul(2),a)),e.z),u.x),Ht(i(l.add(ye(0,a.negate())),e.z),i(l.add(ye(0,a.mul(2))),e.z),u.y),Ht(i(l.add(ye(o,a.negate())),e.z),i(l.add(ye(o,a.mul(2))),e.z),u.y),Ht(Ht(i(l.add(ye(o.negate(),a.negate())),e.z),i(l.add(ye(o.mul(2),a.negate())),e.z),u.x),Ht(i(l.add(ye(o.negate(),a.mul(2))),e.z),i(l.add(ye(o.mul(2),a.mul(2))),e.z),u.x),u.y)).mul(1/9)}),LX=me(({depthTexture:n,shadowCoord:e})=>{const t=ne(1).toVar(),i=xt(n).sample(e.xy).rg,r=xP(e.z,i.x);return Mn(r.notEqual(ne(1)),()=>{const s=e.z.sub(i.x),o=Xi(0,i.y.mul(i.y));let a=o.div(o.add(s.mul(s)));a=Lo(ji(a,.3).div(.95-.3)),t.assign(Lo(Xi(r,a)))}),t}),IX=me(({samples:n,radius:e,size:t,shadowPass:i})=>{const r=ne(0).toVar(),s=ne(0).toVar(),o=n.lessThanEqual(ne(1)).select(ne(0),ne(2).div(n.sub(1))),a=n.lessThanEqual(ne(1)).select(ne(0),ne(-1));_s({start:cn(0),end:cn(n),type:"int",condition:"<"},({i:u})=>{const c=a.add(ne(u).mul(o)),h=i.sample(Di(__.xy,ye(0,c).mul(e)).div(t)).x;r.addAssign(h),s.addAssign(h.mul(h))}),r.divAssign(n),s.divAssign(n);const l=hT(s.sub(r.mul(r)));return ye(r,l)}),UX=me(({samples:n,radius:e,size:t,shadowPass:i})=>{const r=ne(0).toVar(),s=ne(0).toVar(),o=n.lessThanEqual(ne(1)).select(ne(0),ne(2).div(n.sub(1))),a=n.lessThanEqual(ne(1)).select(ne(0),ne(-1));_s({start:cn(0),end:cn(n),type:"int",condition:"<"},({i:u})=>{const c=a.add(ne(u).mul(o)),h=i.sample(Di(__.xy,ye(c,0).mul(e)).div(t));r.addAssign(h.x),s.addAssign(Di(h.y.mul(h.y),h.x.mul(h.x)))}),r.divAssign(n),s.divAssign(n);const l=hT(s.sub(r.mul(r)));return ye(r,l)}),FX=[NX,PX,DX,LX];let XT;const A_=new G2;class Z2 extends vX{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this.isShadowNode=!0}setupShadowFilter(e,{filterFn:t,depthTexture:i,shadowCoord:r,shadow:s}){const o=r.x.greaterThanEqual(0).and(r.x.lessThanEqual(1)).and(r.y.greaterThanEqual(0)).and(r.y.lessThanEqual(1)).and(r.z.lessThanEqual(1)),a=t({depthTexture:i,shadowCoord:r,shadow:s});return o.select(a,ne(1))}setupShadowCoord(e,t){const{shadow:i}=this,{renderer:r}=e,s=Lt("bias","float",i).setGroup(Xe);let o=t,a;if(i.camera.isOrthographicCamera||r.logarithmicDepthBuffer!==!0)o=o.xyz.div(o.w),a=o.z,r.coordinateSystem===ya&&(a=a.mul(2).sub(1));else{const l=o.w;o=o.xy.div(l);const u=Lt("near","float",i.camera).setGroup(Xe),c=Lt("far","float",i.camera).setGroup(Xe);a=ZP(l.negate(),u,c)}return o=ie(o.x,o.y.oneMinus(),a.add(s)),o}getShadowFilterFn(e){return FX[e]}setupShadow(e){const{renderer:t}=e,{light:i,shadow:r}=this,s=t.shadowMap.type,o=new Aa(r.mapSize.width,r.mapSize.height);o.compareFunction=Om;const a=e.createRenderTarget(r.mapSize.width,r.mapSize.height);if(a.depthTexture=o,r.camera.updateProjectionMatrix(),s===dr){o.compareFunction=null,this.vsmShadowMapVertical=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:yl,type:wi}),this.vsmShadowMapHorizontal=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:yl,type:wi});const p=xt(o),v=xt(this.vsmShadowMapVertical.texture),y=Lt("blurSamples","float",r).setGroup(Xe),x=Lt("radius","float",r).setGroup(Xe),S=Lt("mapSize","vec2",r).setGroup(Xe);let T=this.vsmMaterialVertical||(this.vsmMaterialVertical=new Rn);T.fragmentNode=IX({samples:y,radius:x,size:S,shadowPass:p}).context(e.getSharedContext()),T.name="VSMVertical",T=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new Rn),T.fragmentNode=UX({samples:y,radius:x,size:S,shadowPass:v}).context(e.getSharedContext()),T.name="VSMHorizontal"}const l=Lt("intensity","float",r).setGroup(Xe),u=Lt("normalBias","float",r).setGroup(Xe),c=j2(i).mul(K2.add(xT.mul(u))),h=this.setupShadowCoord(e,c),d=r.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(d===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const f=s===dr?this.vsmShadowMapHorizontal.texture:o,m=this.setupShadowFilter(e,{filterFn:d,shadowTexture:a.texture,depthTexture:f,shadowCoord:h,shadow:r}),g=xt(a.texture,h),_=Ht(1,m.rgb.mix(g,1),l.mul(g.a)).toVar();return this.shadowMap=a,this.shadow.map=a,_}setup(e){if(e.renderer.shadowMap.enabled!==!1)return me(()=>{let t=this._node;return this.setupShadowPosition(e),t===null&&(this._node=t=this.setupShadow(e)),e.material.shadowNode&&console.warn('THREE.NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(t=e.material.receivedShadowNode(t)),t})()}renderShadow(e){const{shadow:t,shadowMap:i,light:r}=this,{renderer:s,scene:o}=e;t.updateMatrices(r),i.setSize(t.mapSize.width,t.mapSize.height),s.render(o,t.camera)}updateShadow(e){const{shadowMap:t,light:i,shadow:r}=this,{renderer:s,scene:o,camera:a}=e,l=s.shadowMap.type,u=t.depthTexture.version;this._depthVersionCached=u,r.camera.layers.mask=a.layers.mask;const c=s.getRenderObjectFunction(),h=s.getMRT(),d=h?h.has("velocity"):!1;XT=MX(s,o,XT),o.overrideMaterial=RX(i),s.setRenderObjectFunction((f,m,g,_,p,v,...y)=>{(f.castShadow===!0||f.receiveShadow&&l===dr)&&(d&&(zN(f).useVelocity=!0),f.onBeforeShadow(s,f,a,r.camera,_,m.overrideMaterial,v),s.renderObject(f,m,g,_,p,v,...y),f.onAfterShadow(s,f,a,r.camera,_,m.overrideMaterial,v))}),s.setRenderTarget(t),this.renderShadow(e),s.setRenderObjectFunction(c),i.isPointLight!==!0&&l===dr&&this.vsmPass(s),EX(s,o,XT)}vsmPass(e){const{shadow:t}=this;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height),e.setRenderTarget(this.vsmShadowMapVertical),A_.material=this.vsmMaterialVertical,A_.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),A_.material=this.vsmMaterialHorizontal,A_.render(e)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),super.dispose()}updateBefore(e){const{shadow:t}=this;(t.needsUpdate||t.autoUpdate)&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const OX=(n,e)=>pe(new Z2(n,e));class Wl extends Qc{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new Ue,this.colorNode=e&&e.colorNode||Ze(this.color).setGroup(Xe),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=at.FRAME}customCacheKey(){return KS(this.light.id,this.light.castShadow?1:0)}getHash(){return this.light.uuid}setupShadowNode(){return OX(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let i=this.shadowColorNode;if(i===null){const r=this.light.shadow.shadowNode;let s;r!==void 0?s=pe(r):s=this.setupShadowNode(e),this.shadowNode=s,this.shadowColorNode=i=this.colorNode.mul(s),this.baseColorNode=this.colorNode}this.colorNode=i}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const J2=me(n=>{const{lightDistance:e,cutoffDistance:t,decayExponent:i}=n,r=e.pow(i).max(.01).reciprocal();return t.greaterThan(0).select(r.mul(e.div(t).pow4().oneMinus().clamp().pow2()),r)}),BX=new Ue,zs=me(([n,e])=>{const t=n.toVar(),i=Hr(t),r=Po(1,Xi(i.x,Xi(i.y,i.z)));i.mulAssign(r),t.mulAssign(r.mul(e.mul(2).oneMinus()));const s=ye(t.xy).toVar(),a=e.mul(1.5).oneMinus();return Mn(i.z.greaterThanEqual(a),()=>{Mn(t.z.greaterThan(0),()=>{s.x.assign(ji(4,t.x))})}).ElseIf(i.x.greaterThanEqual(a),()=>{const l=l_(t.x);s.x.assign(t.z.mul(l).add(l.mul(2)))}).ElseIf(i.y.greaterThanEqual(a),()=>{const l=l_(t.y);s.x.assign(t.x.add(l.mul(2)).add(2)),s.y.assign(t.z.mul(l).sub(2))}),ye(.125,.25).mul(s).add(ye(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),kX=me(({depthTexture:n,bd3D:e,dp:t,texelSize:i})=>xt(n,zs(e,i.y)).compare(t)),zX=me(({depthTexture:n,bd3D:e,dp:t,texelSize:i,shadow:r})=>{const s=Lt("radius","float",r).setGroup(Xe),o=ye(-1,1).mul(s).mul(i.y);return xt(n,zs(e.add(o.xyy),i.y)).compare(t).add(xt(n,zs(e.add(o.yyy),i.y)).compare(t)).add(xt(n,zs(e.add(o.xyx),i.y)).compare(t)).add(xt(n,zs(e.add(o.yyx),i.y)).compare(t)).add(xt(n,zs(e,i.y)).compare(t)).add(xt(n,zs(e.add(o.xxy),i.y)).compare(t)).add(xt(n,zs(e.add(o.yxy),i.y)).compare(t)).add(xt(n,zs(e.add(o.xxx),i.y)).compare(t)).add(xt(n,zs(e.add(o.yxx),i.y)).compare(t)).mul(1/9)}),GX=me(({filterFn:n,depthTexture:e,shadowCoord:t,shadow:i})=>{const r=t.xyz.toVar(),s=r.length(),o=Ze("float").setGroup(Xe).onRenderUpdate(()=>i.camera.near),a=Ze("float").setGroup(Xe).onRenderUpdate(()=>i.camera.far),l=Lt("bias","float",i).setGroup(Xe),u=Ze(i.mapSize).setGroup(Xe),c=ne(1).toVar();return Mn(s.sub(a).lessThanEqual(0).and(s.sub(o).greaterThanEqual(0)),()=>{const h=s.sub(o).div(a.sub(o)).toVar();h.addAssign(l);const d=r.normalize(),f=ye(1).div(u.mul(ye(4,2)));c.assign(n({depthTexture:e,bd3D:d,dp:h,texelSize:f,shadow:i}))}),c}),eD=new et,eh=new he,Vf=new he;class VX extends Z2{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===GO?kX:zX}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,shadowTexture:i,depthTexture:r,shadowCoord:s,shadow:o}){return GX({filterFn:t,shadowTexture:i,depthTexture:r,shadowCoord:s,shadow:o})}renderShadow(e){const{shadow:t,shadowMap:i,light:r}=this,{renderer:s,scene:o}=e,a=t.getFrameExtents();Vf.copy(t.mapSize),Vf.multiply(a),i.setSize(Vf.width,Vf.height),eh.copy(t.mapSize);const l=s.autoClear,u=s.getClearColor(BX),c=s.getClearAlpha();s.autoClear=!1,s.setClearColor(t.clearColor,t.clearAlpha),s.clear();const h=t.getViewportCount();for(let d=0;d<h;d++){const f=t.getViewport(d),m=eh.x*f.x,g=Vf.y-eh.y-eh.y*f.y;eD.set(m,g,eh.x*f.z,eh.y*f.w),i.viewport.copy(eD),t.updateMatrices(r,d),s.render(o,t.camera)}s.autoClear=l,s.setClearColor(u,c)}}const HX=(n,e)=>pe(new VX(n,e)),WX=me(({color:n,lightViewPosition:e,cutoffDistance:t,decayExponent:i},r)=>{const s=r.context.lightingModel,o=e.sub(En),a=o.normalize(),l=o.length(),u=J2({lightDistance:l,cutoffDistance:t,decayExponent:i}),c=n.mul(u),h=r.context.reflectedLight;s.direct({lightDirection:a,lightColor:c,reflectedLight:h},r.stack,r)});class $X extends Wl{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=Ze(0).setGroup(Xe),this.decayExponentNode=Ze(2).setGroup(Xe)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return HX(this.light)}setup(e){super.setup(e),WX({color:this.colorNode,lightViewPosition:$T(this.light),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode}).append()}}const jX=me(([n,e])=>{const t=n.x,i=n.y,r=n.z;let s=e.element(0).mul(.886227);return s=s.add(e.element(1).mul(2*.511664).mul(i)),s=s.add(e.element(2).mul(2*.511664).mul(r)),s=s.add(e.element(3).mul(2*.511664).mul(t)),s=s.add(e.element(4).mul(2*.429043).mul(t).mul(i)),s=s.add(e.element(5).mul(2*.429043).mul(i).mul(r)),s=s.add(e.element(6).mul(r.mul(r).mul(.743125).sub(.247708))),s=s.add(e.element(7).mul(2*.429043).mul(t).mul(r)),s=s.add(e.element(8).mul(.429043).mul(ht(t,t).sub(ht(i,i)))),s}),Oo=new GT;class XX extends Oa{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,i){const r=this.renderer,s=this.nodes.getBackgroundNode(e)||e.background;let o=!1;if(s===null)r._clearColor.getRGB(Oo,zr),Oo.a=r._clearColor.a;else if(s.isColor===!0)s.getRGB(Oo,zr),Oo.a=1,o=!0;else if(s.isNode===!0){const a=this.get(e),l=s;Oo.copy(r._clearColor);let u=a.backgroundMesh;if(u===void 0){const h=pT(Qe(l).mul(V2),{getUV:()=>Q7.mul(IP),getTextureLevel:()=>K7});let d=$P;d=d.setZ(d.w);const f=new Rn;f.name="Background.material",f.side=Xt,f.depthTest=!1,f.depthWrite=!1,f.fog=!1,f.lights=!1,f.vertexNode=d,f.colorNode=h,a.backgroundMeshNode=h,a.backgroundMesh=u=new $n(new Qd(1,32,32),f),u.frustumCulled=!1,u.name="Background.mesh",u.onBeforeRender=function(m,g,_){this.matrixWorld.copyPosition(_.matrixWorld)}}const c=l.getCacheKey();a.backgroundCacheKey!==c&&(a.backgroundMeshNode.node=Qe(l).mul(V2),a.backgroundMeshNode.needsUpdate=!0,u.material.needsUpdate=!0,a.backgroundCacheKey=c),t.unshift(u,u.geometry,u.material,0,0,null,null)}else console.error("THREE.Renderer: Unsupported background configuration.",s);if(r.autoClear===!0||o===!0){const a=i.clearColorValue;a.r=Oo.r,a.g=Oo.g,a.b=Oo.b,a.a=Oo.a,(r.backend.isWebGLBackend===!0||r.alpha===!0)&&(a.r*=a.a,a.g*=a.a,a.b*=a.a),i.depthClearValue=r._clearDepth,i.stencilClearValue=r._clearStencil,i.clearColor=r.autoClearColor===!0,i.clearDepth=r.autoClearDepth===!0,i.clearStencil=r.autoClearStencil===!0}else i.clearColor=!1,i.clearDepth=!1,i.clearStencil=!1}}let qX=0;class qT{constructor(e="",t=[],i=0,r=[]){this.name=e,this.bindings=t,this.index=i,this.bindingsReference=r,this.id=qX++}}class YX{constructor(e,t,i,r,s,o,a,l,u,c=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=i,this.transforms=c,this.nodeAttributes=r,this.bindings=s,this.updateNodes=o,this.updateBeforeNodes=a,this.updateAfterNodes=l,this.monitor=u,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const r=new qT(t.name,[],t.index,t);e.push(r);for(const s of t.bindings)r.bindings.push(s.clone())}else e.push(t);return e}}class tD{constructor(e,t,i=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=i}}class KX{constructor(e,t,i){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=i.getSelf()}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class nD{constructor(e,t){this.isNodeVar=!0,this.name=e,this.type=t}}class QX extends nD{constructor(e,t){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0}}class ZX{constructor(e,t,i=""){this.name=e,this.type=t,this.code=i,Object.defineProperty(this,"isNodeCode",{value:!0})}}let JX=0;class YT{constructor(e=null){this.id=JX++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class eq extends tt{static get type(){return"StructTypeNode"}constructor(e,t){super(),this.name=e,this.types=t,this.isStructTypeNode=!0}getMemberTypes(){return this.types}}class $l{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class tq extends $l{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class nq extends $l{constructor(e,t=new he){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class iq extends $l{constructor(e,t=new N){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class rq extends $l{constructor(e,t=new et){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class sq extends $l{constructor(e,t=new Ue){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class oq extends $l{constructor(e,t=new je){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class aq extends $l{constructor(e,t=new pt){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class lq extends tq{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class uq extends nq{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class cq extends iq{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class hq extends rq{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class dq extends sq{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class fq extends oq{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class pq extends aq{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}const th=4,iD=[.125,.215,.35,.446,.526,.582],jl=20,KT=new Jd(-1,1,1,-1,0,1),mq=new Ai(90,1),rD=new Ue;let QT=null,ZT=0,JT=0;const Xl=(1+Math.sqrt(5))/2,nh=1/Xl,sD=[new N(-Xl,nh,0),new N(Xl,nh,0),new N(-nh,0,Xl),new N(nh,0,Xl),new N(0,Xl,-nh),new N(0,Xl,nh),new N(-1,1,-1),new N(1,1,-1),new N(-1,1,1),new N(1,1,1)],gq=[3,1,5,0,4,2],eb=$j(p_(),Uo("faceIndex")).normalize(),tb=ie(eb.x,eb.y,eb.z);class _q{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,i=.1,r=100,s=null){if(this._setSize(256),this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromScene() called before the backend is initialized. Try using .fromSceneAsync() instead.");const a=s||this._allocateTargets();return this.fromSceneAsync(e,t,i,r,a),a}QT=this._renderer.getRenderTarget(),ZT=this._renderer.getActiveCubeFace(),JT=this._renderer.getActiveMipmapLevel();const o=s||this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,i,r,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}async fromSceneAsync(e,t=0,i=.1,r=100,s=null){return this._hasInitialized===!1&&await this._renderer.init(),this.fromScene(e,t,i,r,s)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using .fromEquirectangularAsync() instead."),this._setSizeFromTexture(e);const i=t||this._allocateTargets();return this.fromEquirectangularAsync(e,i),i}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const i=t||this._allocateTargets();return this.fromCubemapAsync(e,t),i}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=aD(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=lD(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===Br||e.mapping===kr?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(QT,ZT,JT),e.scissorTest=!1,C_(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),QT=this._renderer.getRenderTarget(),ZT=this._renderer.getActiveCubeFace(),JT=this._renderer.getActiveMipmapLevel();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Sn,minFilter:Sn,generateMipmaps:!1,type:wi,format:Kn,colorSpace:zr},r=oD(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=oD(e,t,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=vq(s)),this._blurMaterial=yq(s,e,t)}return r}async _compileMaterial(e){const t=new $n(this._lodPlanes[0],e);await this._renderer.compile(t,KT)}_sceneToCubeUV(e,t,i,r){const s=mq;s.near=t,s.far=i;const o=[1,1,1,1,-1,1],a=[1,-1,1,-1,1,-1],l=this._renderer,u=l.autoClear;l.getClearColor(rD),l.autoClear=!1;let c=this._backgroundBox;if(c===null){const f=new Vd({name:"PMREM.Background",side:Xt,depthWrite:!1,depthTest:!1});c=new $n(new Cl,f)}let h=!1;const d=e.background;d?d.isColor&&(c.material.color.copy(d),e.background=null,h=!0):(c.material.color.copy(rD),h=!0),l.setRenderTarget(r),l.clear(),h&&l.render(c,s);for(let f=0;f<6;f++){const m=f%3;m===0?(s.up.set(0,o[f],0),s.lookAt(a[f],0,0)):m===1?(s.up.set(0,0,o[f]),s.lookAt(0,a[f],0)):(s.up.set(0,o[f],0),s.lookAt(0,0,a[f]));const g=this._cubeSize;C_(r,m*g,f>2?g:0,g,g),l.render(e,s)}l.autoClear=u,e.background=d}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===Br||e.mapping===kr;r?this._cubemapMaterial===null&&(this._cubemapMaterial=aD(e)):this._equirectMaterial===null&&(this._equirectMaterial=lD(e));const s=r?this._cubemapMaterial:this._equirectMaterial;s.fragmentNode.value=e;const o=this._lodMeshes[0];o.material=s;const a=this._cubeSize;C_(t,0,0,3*a,2*a),i.setRenderTarget(t),i.render(o,KT)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let s=1;s<r;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=sD[(r-s-1)%sD.length];this._blur(e,s-1,s,o,a)}t.autoClear=i}_blur(e,t,i,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,r,"latitudinal",s),this._halfBlur(o,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,o,a){const l=this._renderer,u=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const c=3,h=this._lodMeshes[r];h.material=u;const d=u.uniforms,f=this._sizeLods[i]-1,m=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*jl-1),g=s/m,_=isFinite(s)?1+Math.floor(c*g):jl;_>jl&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${_} samples when the maximum is set to ${jl}`);const p=[];let v=0;for(let w=0;w<jl;++w){const E=w/g,M=Math.exp(-E*E/2);p.push(M),w===0?v+=M:w<_&&(v+=2*M)}for(let w=0;w<p.length;w++)p[w]=p[w]/v;e.texture.frame=(e.texture.frame||0)+1,d.envMap.value=e.texture,d.samples.value=_,d.weights.array=p,d.latitudinal.value=o==="latitudinal"?1:0,a&&(d.poleAxis.value=a);const{_lodMax:y}=this;d.dTheta.value=m,d.mipInt.value=y-i;const x=this._sizeLods[r],S=3*x*(r>y-th?r-y+th:0),T=4*(this._cubeSize-x);C_(t,S,T,3*x,2*x),l.setRenderTarget(t),l.render(h,KT)}}function vq(n){const e=[],t=[],i=[],r=[];let s=n;const o=n-th+1+iD.length;for(let a=0;a<o;a++){const l=Math.pow(2,s);t.push(l);let u=1/l;a>n-th?u=iD[a-n+th-1]:a===0&&(u=0),i.push(u);const c=1/(l-2),h=-c,d=1+c,f=[h,h,d,h,d,d,h,h,d,d,h,d],m=6,g=6,_=3,p=2,v=1,y=new Float32Array(_*g*m),x=new Float32Array(p*g*m),S=new Float32Array(v*g*m);for(let w=0;w<m;w++){const E=w%3*2/3-1,M=w>2?0:-1,b=[E,M,0,E+2/3,M,0,E+2/3,M+1,0,E,M,0,E+2/3,M+1,0,E,M+1,0],C=gq[w];y.set(b,_*g*C),x.set(f,p*g*C);const I=[C,C,C,C,C,C];S.set(I,v*g*C)}const T=new ci;T.setAttribute("position",new Qn(y,_)),T.setAttribute("uv",new Qn(x,p)),T.setAttribute("faceIndex",new Qn(S,v)),e.push(T),r.push(new $n(T,null)),s>th&&s--}return{lodPlanes:e,sizeLods:t,sigmas:i,lodMeshes:r}}function oD(n,e,t){const i=new mc(n,e,t);return i.texture.mapping=pl,i.texture.name="PMREM.cubeUv",i.texture.isPMREMTexture=!0,i.scissorTest=!0,i}function C_(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function nb(n){const e=new Rn;return e.depthTest=!1,e.depthWrite=!1,e.blending=zi,e.name=`PMREM_${n}`,e}function yq(n,e,t){const i=Ua(new Array(jl).fill(0)),r=Ze(new N(0,1,0)),s=Ze(0),o=ne(jl),a=Ze(0),l=Ze(1),u=xt(null),c=Ze(0),h=ne(1/e),d=ne(1/t),f=ne(n),m={n:o,latitudinal:a,weights:i,poleAxis:r,outputDirection:tb,dTheta:s,samples:l,envMap:u,mipInt:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:f},g=nb("blur");return g.uniforms=m,g.fragmentNode=Xj({...m,latitudinal:a.equal(1)}),g}function aD(n){const e=nb("cubemap");return e.fragmentNode=Nf(n,tb),e}function lD(n){const e=nb("equirect");return e.fragmentNode=xt(n,i2(tb),0),e}const uD=new WeakMap,xq=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),R_=n=>/e/g.test(n)?String(n).replace(/\+/g,""):(n=Number(n),n+(n%1?"":".0"));class cD{constructor(e,t,i){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=i,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.monitor=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.flow={code:""},this.chaining=[],this.stack=VT(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new YT,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.useComparisonMethod=!1}getBindGroupsCache(){let e=uD.get(this.renderer);return e===void 0&&(e=new Os,uD.set(this.renderer,e)),e}createRenderTarget(e,t,i){return new mc(e,t,i)}createCubeRenderTarget(e,t){return new r2(e,t)}createPMREMGenerator(){return new _q(this.renderer)}includes(e){return this.nodes.includes(e)}_getBindGroup(e,t){const i=this.getBindGroupsCache(),r=[];let s=!0;for(const a of t)r.push(a),s=s&&a.groupNode.shared!==!0;let o;return s?(o=i.get(r),o===void 0&&(o=new qT(e,r,this.bindingsIndexes[e].group,r),i.set(r,o))):o=new qT(e,r,this.bindingsIndexes[e].group,r),o}getBindGroupArray(e,t){const i=this.bindings[t];let r=i[e];return r===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),i[e]=r=[]),r}getBindings(){let e=this.bindGroups;if(e===null){const t={},i=this.bindings;for(const r of HN)for(const s in i[r]){const o=i[r][s];(t[s]||(t[s]=[])).push(...o)}e=[];for(const r in t){const s=t[r],o=this._getBindGroup(r,s);e.push(o)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,i)=>t.bindings[0].groupNode.order-i.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const i=e[t];this.bindingsIndexes[i.name].group=t,i.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==at.NONE&&this.updateNodes.push(e.getSelf());for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),i=e.getUpdateAfterType();t!==at.NONE&&this.updateBeforeNodes.push(e.getSelf()),i!==at.NONE&&this.updateAfterNodes.push(e.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===Sn||e.magFilter===$u||e.magFilter===As||e.magFilter===bi||e.minFilter===Sn||e.minFilter===$u||e.minFilter===As||e.minFilter===bi}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}getSharedContext(){return{...this.context},this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const i=this.getDataFromNode(e);return i.cache===void 0&&(i.cache=new YT(t?this.getCache():null)),i.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new Ue:e==="vec2"?t=new he:e==="vec3"?t=new N:e==="vec4"&&(t=new et)),e==="float")return R_(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${R_(t.r)}, ${R_(t.g)}, ${R_(t.b)} )`;const i=this.getTypeLength(e),r=this.getComponentType(e),s=o=>this.generateConst(r,o);if(i===2)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)} )`;if(i===3)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)} )`;if(i===4)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)}, ${s(t.w)} )`;if(i>4&&t&&(t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(s).join(", ")} )`;if(i>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const i=this.attributes;for(const s of i)if(s.name===e)return s;const r=new tD(e,t);return i.push(r),r}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===Hn)return"int";if(t===rn)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;const i=_6(e);return(t==="float"?"":t[0])+i}getTypeFromArray(e){return xq.get(e.constructor)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const i=t.array,r=e.itemSize,s=e.normalized;let o;return!(e instanceof zA)&&s!==!0&&(o=this.getTypeFromArray(i)),this.getTypeFromLength(r,o)}getTypeLength(e){const t=this.getVectorType(e),i=/vec([2-4])/.exec(t);return i!==null?Number(i[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}addStack(){return this.stack=VT(this.stack),this.stacks.push(JN()||this.stack),e_(this.stack),this.stack}removeStack(){const e=this.stack;return this.stack=e.parent,e_(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,i=null){i=i===null?e.isGlobal(this)?this.globalCache:this.cache:i;let r=i.getData(e);return r===void 0&&(r={},i.setData(e,r)),r[t]===void 0&&(r[t]={}),r[t]}getNodeProperties(e,t="any"){const i=this.getDataFromNode(e,t);return i.properties||(i.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const i=this.getDataFromNode(e);let r=i.bufferAttribute;if(r===void 0){const s=this.uniforms.index++;r=new tD("nodeAttribute"+s,t,e),this.bufferAttributes.push(r),i.bufferAttribute=r}return r}getStructTypeFromNode(e,t,i=this.shaderStage){const r=this.getDataFromNode(e,i);let s=r.structType;if(s===void 0){const o=this.structs.index++;s=new eq("StructType"+o,t),this.structs[i].push(s),r.structType=s}return s}getUniformFromNode(e,t,i=this.shaderStage,r=null){const s=this.getDataFromNode(e,i,this.globalCache);let o=s.uniform;if(o===void 0){const a=this.uniforms.index++;o=new KX(r||"nodeUniform"+a,t,e),this.uniforms[i].push(o),s.uniform=o}return o}getVarFromNode(e,t=null,i=e.getNodeType(this),r=this.shaderStage){const s=this.getDataFromNode(e,r);let o=s.variable;if(o===void 0){const a=this.vars[r]||(this.vars[r]=[]);t===null&&(t="nodeVar"+a.length),o=new nD(t,i),a.push(o),s.variable=o}return o}getVaryingFromNode(e,t=null,i=e.getNodeType(this)){const r=this.getDataFromNode(e,"any");let s=r.varying;if(s===void 0){const o=this.varyings,a=o.length;t===null&&(t="nodeVarying"+a),s=new QX(t,i),o.push(s),r.varying=s}return s}getCodeFromNode(e,t,i=this.shaderStage){const r=this.getDataFromNode(e);let s=r.code;if(s===void 0){const o=this.codes[i]||(this.codes[i]=[]),a=o.length;s=new ZX("nodeCode"+a,t),o.push(s),r.code=s}return s}addFlowCodeHierarchy(e,t){const{flowCodes:i,flowCodeBlock:r}=this.getDataFromNode(e);let s=!0,o=t;for(;o;){if(r.get(o)===!0){s=!1;break}o=this.getDataFromNode(o).parentNodeBlock}if(s)for(const a of i)this.addLineFlowCode(a)}addLineFlowCodeBlock(e,t,i){const r=this.getDataFromNode(e),s=r.flowCodes||(r.flowCodes=[]),o=r.flowCodeBlock||(r.flowCodeBlock=new WeakMap);s.push(t),o.set(i,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),i=this.flowChildNode(e,t);return this.flowsData.set(e,i),i}buildFunctionNode(e){const t=new cX,i=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=i,t}flowShaderNode(e){const t=e.layout,i={[Symbol.iterator](){let o=0;const a=Object.values(this);return{next:()=>({value:a[o],done:o++>=a.length})}}};for(const o of t.inputs)i[o.name]=new $7(o.type,o.name);e.layout=null;const r=e.call(i),s=this.flowStagesNode(r,t.type);return e.layout=t,s}flowStagesNode(e,t=null){const i=this.flow,r=this.vars,s=this.cache,o=this.buildStage,a=this.stack,l={code:""};this.flow=l,this.vars={},this.cache=new YT,this.stack=VT();for(const u of VN)this.setBuildStage(u),l.result=e.build(this,t);return l.vars=this.getVars(this.shaderStage),this.flow=i,this.vars=r,this.cache=s,this.stack=a,this.setBuildStage(o),l}getFunctionOperator(){return null}flowChildNode(e,t=null){const i=this.flow,r={code:""};return this.flow=r,r.result=e.build(this,t),this.flow=i,r}flowNodeFromShaderStage(e,t,i=null,r=null){const s=this.shaderStage;this.setShaderStage(e);const o=this.flowChildNode(t,i);return r!==null&&(o.code+=`${this.tab+r} = ${o.result};
`),this.flowCode[e]=this.flowCode[e]+o.code,this.setShaderStage(s),o}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(e,t){return`${this.getType(e)} ${t}`}getVars(e){let t="";const i=this.vars[e];if(i!==void 0)for(const r of i)t+=`${this.getVar(r.type,r.name)}; `;return t}getUniforms(){console.warn("Abstract function.")}getCodes(e){const t=this.codes[e];let i="";if(t!==void 0)for(const r of t)i+=r.code+`
`;return i}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){const{object:e,material:t,renderer:i}=this;if(t!==null){let r=i.library.fromMaterial(t);r===null&&(console.error(`NodeMaterial: Material "${t.type}" is not compatible.`),r=new Rn),r.build(this)}else this.addFlow("compute",e);for(const r of VN){this.setBuildStage(r),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const s of HN){this.setShaderStage(s);const o=this.flowNodes[s];for(const a of o)r==="generate"?this.flowNode(a):a.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,t){if(t==="float"||t==="int"||t==="uint")return new lq(e);if(t==="vec2"||t==="ivec2"||t==="uvec2")return new uq(e);if(t==="vec3"||t==="ivec3"||t==="uvec3")return new cq(e);if(t==="vec4"||t==="ivec4"||t==="uvec4")return new hq(e);if(t==="color")return new dq(e);if(t==="mat3")return new fq(e);if(t==="mat4")return new pq(e);throw new Error(`Uniform "${t}" not declared.`)}format(e,t,i){if(t=this.getVectorType(t),i=this.getVectorType(i),t===i||i===null||this.isReference(i))return e;const r=this.getTypeLength(t),s=this.getTypeLength(i);return r===16&&s===9?`${this.getType(i)}(${e}[0].xyz, ${e}[1].xyz, ${e}[2].xyz)`:r===9&&s===4?`${this.getType(i)}(${e}[0].xy, ${e}[1].xy)`:r>4||s>4||s===0?e:r===s?`${this.getType(i)}( ${e} )`:r>s?this.format(`${e}.${"xyz".slice(0,s)}`,this.getTypeFromLength(s,this.getComponentType(t)),i):s===4&&r>1?`${this.getType(i)}( ${this.format(e,t,"vec3")}, 1.0 )`:r===2?`${this.getType(i)}( ${this.format(e,t,"vec2")}, 0.0 )`:(r===1&&s>1&&t!==this.getComponentType(i)&&(e=`${this.getType(this.getComponentType(i))}( ${e} )`),`${this.getType(i)}( ${e} )`)}getSignature(){return`// Three.js r${Gu} - Node System
`}createNodeMaterial(e="NodeMaterial"){throw new Error(`THREE.NodeBuilder: createNodeMaterial() was deprecated. Use new ${e}() instead.`)}}class hD{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let i=e.get(t);return i===void 0&&(i={renderMap:new WeakMap,frameMap:new WeakMap},e.set(t,i)),i}updateBeforeNode(e){const t=e.getUpdateBeforeType(),i=e.updateReference(this);if(t===at.FRAME){const{frameMap:r}=this._getMaps(this.updateBeforeMap,i);r.get(i)!==this.frameId&&e.updateBefore(this)!==!1&&r.set(i,this.frameId)}else if(t===at.RENDER){const{renderMap:r}=this._getMaps(this.updateBeforeMap,i);r.get(i)!==this.renderId&&e.updateBefore(this)!==!1&&r.set(i,this.renderId)}else t===at.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),i=e.updateReference(this);if(t===at.FRAME){const{frameMap:r}=this._getMaps(this.updateAfterMap,i);r.get(i)!==this.frameId&&e.updateAfter(this)!==!1&&r.set(i,this.frameId)}else if(t===at.RENDER){const{renderMap:r}=this._getMaps(this.updateAfterMap,i);r.get(i)!==this.renderId&&e.updateAfter(this)!==!1&&r.set(i,this.renderId)}else t===at.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),i=e.updateReference(this);if(t===at.FRAME){const{frameMap:r}=this._getMaps(this.updateMap,i);r.get(i)!==this.frameId&&e.update(this)!==!1&&r.set(i,this.frameId)}else if(t===at.RENDER){const{renderMap:r}=this._getMaps(this.updateMap,i);r.get(i)!==this.renderId&&e.update(this)!==!1&&r.set(i,this.renderId)}else t===at.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class ib{constructor(e,t,i=null,r="",s=!1){this.type=e,this.name=t,this.count=i,this.qualifier=r,this.isConst=s}}ib.isNodeFunctionInput=!0;class Sq extends Wl{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setup(e){super.setup(e);const t=e.context.lightingModel,i=this.colorNode,r=q2(this.light),s=e.context.reflectedLight;t.direct({lightDirection:r,lightColor:i,reflectedLight:s},e.stack,e)}}const rb=new pt,N_=new pt;let Hf=null;class Tq extends Wl{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=Ze(new N).setGroup(Xe),this.halfWidth=Ze(new N).setGroup(Xe),this.updateType=at.RENDER}update(e){super.update(e);const{light:t}=this,i=e.camera.matrixWorldInverse;N_.identity(),rb.copy(t.matrixWorld),rb.premultiply(i),N_.extractRotation(rb),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(N_),this.halfHeight.value.applyMatrix4(N_)}setup(e){super.setup(e);let t,i;e.isAvailable("float32Filterable")?(t=xt(Hf.LTC_FLOAT_1),i=xt(Hf.LTC_FLOAT_2)):(t=xt(Hf.LTC_HALF_1),i=xt(Hf.LTC_HALF_2));const{colorNode:r,light:s}=this,o=e.context.lightingModel,a=$T(s),l=e.context.reflectedLight;o.directRectArea({lightColor:r,lightPosition:a,halfWidth:this.halfWidth,halfHeight:this.halfHeight,reflectedLight:l,ltc_1:t,ltc_2:i},e.stack,e)}static setLTC(e){Hf=e}}class dD extends Wl{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=Ze(0).setGroup(Xe),this.penumbraCosNode=Ze(0).setGroup(Xe),this.cutoffDistanceNode=Ze(0).setGroup(Xe),this.decayExponentNode=Ze(0).setGroup(Xe)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e){const{coneCosNode:t,penumbraCosNode:i}=this;return zl(t,i,e)}setup(e){super.setup(e);const t=e.context.lightingModel,{colorNode:i,cutoffDistanceNode:r,decayExponentNode:s,light:o}=this,a=$T(o).sub(En),l=a.normalize(),u=l.dot(q2(o)),c=this.getSpotAttenuation(u),h=a.length(),d=J2({lightDistance:h,cutoffDistance:r,decayExponent:s});let f=i.mul(c).mul(d);if(o.map){const g=pX(o),_=xt(o.map,g.xy).onRenderUpdate(()=>o.map);f=g.mul(2).sub(1).abs().lessThan(1).all().select(f.mul(_),f)}const m=e.context.reflectedLight;t.direct({lightDirection:l,lightColor:f,reflectedLight:m},e.stack,e)}}class bq extends dD{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e){const t=this.light.iesMap;let i=null;if(t&&t.isTexture===!0){const r=e.acos().mul(1/Math.PI);i=xt(t,ye(r,0),0).r}else i=super.getSpotAttenuation(e);return i}}class wq extends Wl{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class Mq extends Wl{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=X2(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Ze(new Ue).setGroup(Xe)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:i,lightDirectionNode:r}=this,o=gs.dot(r).mul(.5).add(.5),a=Ht(i,t,o);e.context.irradiance.addAssign(a)}}class Eq extends Wl{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let i=0;i<9;i++)t.push(new N);this.lightProbe=Ua(t)}update(e){const{light:t}=this;super.update(e);for(let i=0;i<9;i++)this.lightProbe.array[i].copy(t.sh.coefficients[i]).multiplyScalar(t.intensity)}setup(e){const t=jX(IP,this.lightProbe);e.context.irradiance.addAssign(t)}}class fD{parseFunction(){console.warn("Abstract function.")}}class sb{constructor(e,t,i="",r=""){this.type=e,this.inputs=t,this.name=i,this.precision=r}getCode(){console.warn("Abstract function.")}}sb.isNodeFunction=!0;const Aq=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,Cq=/[a-z_0-9]+/ig,pD="#pragma main",Rq=n=>{n=n.trim();const e=n.indexOf(pD),t=e!==-1?n.slice(e+pD.length):n,i=t.match(Aq);if(i!==null&&i.length===5){const r=i[4],s=[];let o=null;for(;(o=Cq.exec(r))!==null;)s.push(o);const a=[];let l=0;for(;l<s.length;){const m=s[l][0]==="const";m===!0&&l++;let g=s[l][0];g==="in"||g==="out"||g==="inout"?l++:g="";const _=s[l++][0];let p=Number.parseInt(s[l][0]);Number.isNaN(p)===!1?l++:p=null;const v=s[l++][0];a.push(new ib(_,v,p,g,m))}const u=t.substring(i[0].length),c=i[3]!==void 0?i[3]:"",h=i[2],d=i[1]!==void 0?i[1]:"",f=e!==-1?n.slice(0,e):"";return{type:h,inputs:a,name:c,precision:d,inputsCode:r,blockCode:u,headerCode:f}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class Nq extends sb{constructor(e){const{type:t,inputs:i,name:r,precision:s,inputsCode:o,blockCode:a,headerCode:l}=Rq(e);super(t,i,r,s),this.inputsCode=o,this.blockCode=a,this.headerCode=l}getCode(e=this.name){let t;const i=this.blockCode;if(i!==""){const{type:r,inputsCode:s,headerCode:o,precision:a}=this;let l=`${r} ${e} ( ${s.trim()} )`;a!==""&&(l=`${a} ${l}`),t=o+l+i}else t="";return t}}class Pq extends fD{parseFunction(e){return new Nq(e)}}const mD=new WeakMap;class Dq extends Oa{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new hD,this.nodeBuilderCache=new Map,this.callHashCache=new Os,this.groupsData=new Os,this.cacheLib={}}updateGroup(e){const t=e.groupNode,i=t.name;if(i===iP.name)return!0;if(i===Xe.name){const o=this.get(e),a=this.nodeFrame.renderId;return o.renderId!==a?(o.renderId=a,!0):!1}if(i===Z6.name){const o=this.get(e),a=this.nodeFrame.frameId;return o.frameId!==a?(o.frameId=a,!0):!1}const r=[t,e];let s=this.groupsData.get(r);return s===void 0&&this.groupsData.set(r,s={}),s.version!==t.version?(s.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let i=t.nodeBuilderState;if(i===void 0){const{nodeBuilderCache:r}=this,s=this.getForRenderCacheKey(e);if(i=r.get(s),i===void 0){const o=this.backend.createNodeBuilder(e.object,this.renderer);o.scene=e.scene,o.material=e.material,o.camera=e.camera,o.context.material=e.material,o.lightsNode=e.lightsNode,o.environmentNode=this.getEnvironmentNode(e.scene),o.fogNode=this.getFogNode(e.scene),o.clippingContext=e.clippingContext,o.build(),i=this._createNodeBuilderState(o),r.set(s,i)}i.usedTimes++,t.nodeBuilderState=i}return i}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let i=t.nodeBuilderState;if(i===void 0){const r=this.backend.createNodeBuilder(e,this.renderer);r.build(),i=this._createNodeBuilderState(r),t.nodeBuilderState=i}return i}_createNodeBuilderState(e){return new YX(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.monitor,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const i=this.get(e);i.environmentNode&&(t=i.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const i=this.get(e);i.backgroundNode&&(t=i.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){const i=[e,t],r=this.renderer.info.calls;let s=this.callHashCache.get(i);if(s===void 0||s.callId!==r){const o=this.getEnvironmentNode(e),a=this.getFogNode(e),l=[];t&&l.push(t.getCacheKey(!0)),o&&l.push(o.getCacheKey()),a&&l.push(a.getCacheKey()),l.push(this.renderer.shadowMap.enabled?1:0),s={callId:r,cacheKey:YS(l)},this.callHashCache.set(i,s)}return s.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),i=e.background;if(i){const r=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==i||r){const s=this.getCacheNode("background",i,()=>{if(i.isCubeTexture===!0||i.mapping===pa||i.mapping===ma||i.mapping===pl){if(e.backgroundBlurriness>0||i.mapping===pl)return P2(i);{let o;return i.isCubeTexture===!0?o=Nf(i):o=xt(i),a2(o)}}else{if(i.isTexture===!0)return xt(i,Uf.flipY()).setUpdateMatrix(!0);i.isColor!==!0&&console.error("WebGPUNodes: Unsupported background configuration.",i)}},r);t.backgroundNode=s,t.background=i,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,i,r=!1){const s=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let o=s.get(t);return(o===void 0||r)&&(o=i(),s.set(t,o)),o}updateFog(e){const t=this.get(e),i=e.fog;if(i){if(t.fog!==i){const r=this.getCacheNode("fog",i,()=>{if(i.isFogExp2){const s=Lt("color","color",i).setGroup(Xe),o=Lt("density","float",i).setGroup(Xe);return $2(s,dX(o))}else if(i.isFog){const s=Lt("color","color",i).setGroup(Xe),o=Lt("near","float",i).setGroup(Xe),a=Lt("far","float",i).setGroup(Xe);return $2(s,hX(o,a))}else console.error("THREE.Renderer: Unsupported fog configuration.",i)});t.fogNode=r,t.fog=i}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),i=e.environment;if(i){if(t.environment!==i){const r=this.getCacheNode("environment",i,()=>{if(i.isCubeTexture===!0)return Nf(i);if(i.isTexture===!0)return xt(i);console.error("Nodes: Unsupported environment configuration.",i)});t.environmentNode=r,t.environment=i}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,i=null,r=null,s=null){const o=this.nodeFrame;return o.renderer=e,o.scene=t,o.object=i,o.camera=r,o.material=s,o}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace}hasOutputChange(e){return mD.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,i=this.getOutputCacheKey(),r=xt(e,Uf).renderOutput(t.toneMapping,t.currentColorSpace);return mD.set(e,i),r}updateBefore(e){const t=e.getNodeBuilderState();for(const i of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(i)}updateAfter(e){const t=e.getNodeBuilderState();for(const i of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(i)}updateForCompute(e){const t=this.getNodeFrame(),i=this.getForCompute(e);for(const r of i.updateNodes)t.updateNode(r)}updateForRender(e){const t=this.getNodeFrameForRender(e),i=e.getNodeBuilderState();for(const r of i.updateNodes)t.updateNode(r)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new hD,this.nodeBuilderCache=new Map,this.cacheLib={}}}const ob=new us;class P_{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new je,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,i){const r=e.length;for(let s=0;s<r;s++){ob.copy(e[s]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const o=t[i+s],a=ob.normal;o.x=-a.x,o.y=-a.y,o.z=-a.z,o.w=ob.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowNodeMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let i=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const r=t.clippingPlanes,s=r.length;let o,a;if(this.clipIntersection?(o=this.intersectionPlanes,a=e.intersectionPlanes.length):(o=this.unionPlanes,a=e.unionPlanes.length),o.length!==a+s){o.length=a+s;for(let l=0;l<s;l++)o[a+l]=new et;i=!0}this.projectPlanes(r,o,a),i&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new P_(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class Lq{constructor(e,t){this.bundleGroup=e,this.camera=t}}class Iq{constructor(){this.bundles=new Os}get(e,t){const i=this.bundles,r=[e,t];let s=i.get(r);return s===void 0&&(s=new Lq(e,t),i.set(r,s)),s}dispose(){this.bundles=new Os}}class gD{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const i=this.getMaterialNodeClass(e.type);if(i!==null){t=new i;for(const r in e)t[r]=e[r]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,i){if(i.has(t)){console.warn(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);i.set(t,e)}addClass(e,t,i){if(i.has(t)){console.warn(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);i.set(t,e)}}const Uq=new Y2;class Fq extends Os{constructor(){super()}createNode(e=[]){return new Y2().setLights(e)}getNode(e,t){if(e.isQuadMesh)return Uq;const i=[e,t];let r=this.get(i);return r===void 0&&(r=this.createNode(),this.set(i,r)),r}}const _D=new Dx,D_=new he,ab=new et,lb=new hg,L_=new pt,ka=new et;class Oq{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:i=!1,alpha:r=!0,depth:s=!0,stencil:o=!1,antialias:a=!1,samples:l=0,getFallback:u=null}=t;this.domElement=e.getDomElement(),this.backend=e,this.samples=l||a===!0?4:0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=r,this.logarithmicDepthBuffer=i,this.outputColorSpace=Be,this.toneMapping=Gi,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=s,this.stencil=o,this.info=new P7,this.nodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new gD,this.lighting=new Fq,this._getFallback=u,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new et(0,0,this._width,this._height),this._scissor=new et(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new G2(new Rn),this._quad.material.name="Renderer_output",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const c=this.alpha===!0?0:1;this._clearColor=new GT(0,0,0,c),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:Uy},this.xr={enabled:!1},this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(h,d,f)=>{await this.compileAsync(h,d);const m=this._renderLists.get(h,d),g=this._renderContexts.get(h,d,this._renderTarget),_=h.overrideMaterial||f.material,p=this._objects.get(f,_,h,d,m.lightsNode,g,g.clippingContext),{fragmentShader:v,vertexShader:y}=p.getNodeBuilderState();return{fragmentShader:v,vertexShader:y}}}}async init(){if(this._initialized)throw new Error("Renderer: Backend has already been initialized.");return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let i=this.backend;try{await i.init(this)}catch(r){if(this._getFallback!==null)try{this.backend=i=this._getFallback(r),await i.init(this)}catch(s){t(s);return}else{t(r);return}}this._nodes=new Dq(this,i),this._animation=new S7(this._nodes,this.info),this._attributes=new C7(i),this._background=new XX(this,this._nodes),this._geometries=new N7(this._attributes,this.info),this._textures=new W7(this,i,this.info),this._pipelines=new U7(i,this._nodes),this._bindings=new F7(i,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new M7(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new k7(this.lighting),this._bundles=new Iq,this._renderContexts=new V7,this._animation.start(),this._initialized=!0,e()}),this._initPromise)}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,i=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const r=this._nodes.nodeFrame,s=r.renderId,o=this._currentRenderContext,a=this._currentRenderObjectFunction,l=this._compilationPromises,u=e.isScene===!0?e:_D;i===null&&(i=e);const c=this._renderTarget,h=this._renderContexts.get(i,t,c),d=this._activeMipmapLevel,f=[];this._currentRenderContext=h,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=f,r.renderId++,r.update(),h.depth=this.depth,h.stencil=this.stencil,h.clippingContext||(h.clippingContext=new P_),h.clippingContext.updateGlobal(u,t),u.onBeforeRender(this,e,t,c);const m=this._renderLists.get(e,t);if(m.begin(),this._projectObject(e,t,0,m,h.clippingContext),i!==e&&i.traverseVisible(function(y){y.isLight&&y.layers.test(t.layers)&&m.pushLight(y)}),m.finish(),c!==null){this._textures.updateRenderTarget(c,d);const y=this._textures.get(c);h.textures=y.textures,h.depthTexture=y.depthTexture}else h.textures=null,h.depthTexture=null;this._background.update(u,m,h);const g=m.opaque,_=m.transparent,p=m.transparentDoublePass,v=m.lightsNode;this.opaque===!0&&g.length>0&&this._renderObjects(g,t,u,v),this.transparent===!0&&_.length>0&&this._renderTransparents(_,p,t,u,v),r.renderId=s,this._currentRenderContext=o,this._currentRenderObjectFunction=a,this._compilationPromises=l,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(f)}async renderAsync(e,t){this._initialized===!1&&await this.init();const i=this._renderScene(e,t);await this.backend.resolveTimestampAsync(i,"render")}async waitForGPU(){await this.backend.waitForGPU()}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),console.error(t),this._isDeviceLost=!0}_renderBundle(e,t,i){const{bundleGroup:r,camera:s,renderList:o}=e,a=this._currentRenderContext,l=this._bundles.get(r,s),u=this.backend.get(l);u.renderContexts===void 0&&(u.renderContexts=new Set);const c=r.version!==u.version,h=u.renderContexts.has(a)===!1||c;if(u.renderContexts.add(a),h){this.backend.beginBundle(a),(u.renderObjects===void 0||c)&&(u.renderObjects=[]),this._currentRenderBundle=l;const d=o.opaque;this.opaque===!0&&d.length>0&&this._renderObjects(d,s,t,i),this._currentRenderBundle=null,this.backend.finishBundle(a,l),u.version=r.version}else{const{renderObjects:d}=u;for(let f=0,m=d.length;f<m;f++){const g=d[f];this._nodes.needsRefresh(g)&&(this._nodes.updateBefore(g),this._nodes.updateForRender(g),this._bindings.updateForRender(g),this._nodes.updateAfter(g))}}this.backend.addBundle(a,l)}render(e,t){if(this._initialized===!1)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(e,t);this._renderScene(e,t)}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this;if(e!==Gi===!1&&t!==zr===!1)return null;const{width:s,height:o}=this.getDrawingBufferSize(D_),{depth:a,stencil:l}=this;let u=this._frameBufferTarget;return u===null&&(u=new mc(s,o,{depthBuffer:a,stencilBuffer:l,type:wi,format:Kn,colorSpace:zr,generateMipmaps:!1,minFilter:Sn,magFilter:Sn,samples:this.samples}),u.isPostProcessingRenderTarget=!0,this._frameBufferTarget=u),u.depthBuffer=a,u.stencilBuffer=l,u.setSize(s,o),u.viewport.copy(this._viewport),u.scissor.copy(this._scissor),u.viewport.multiplyScalar(this._pixelRatio),u.scissor.multiplyScalar(this._pixelRatio),u.scissorTest=this._scissorTest,u}_renderScene(e,t,i=!0){if(this._isDeviceLost===!0)return;const r=i?this._getFrameBufferTarget():null,s=this._nodes.nodeFrame,o=s.renderId,a=this._currentRenderContext,l=this._currentRenderObjectFunction,u=e.isScene===!0?e:_D,c=this._renderTarget,h=this._activeCubeFace,d=this._activeMipmapLevel;let f;r!==null?(f=r,this.setRenderTarget(f)):f=c;const m=this._renderContexts.get(e,t,f);this._currentRenderContext=m,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,s.renderId=this.info.calls;const g=this.coordinateSystem;t.coordinateSystem!==g&&(t.coordinateSystem=g,t.updateProjectionMatrix()),e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld();let _=this._viewport,p=this._scissor,v=this._pixelRatio;f!==null&&(_=f.viewport,p=f.scissor,v=1),this.getDrawingBufferSize(D_),ab.set(0,0,D_.width,D_.height);const y=_.minDepth===void 0?0:_.minDepth,x=_.maxDepth===void 0?1:_.maxDepth;m.viewportValue.copy(_).multiplyScalar(v).floor(),m.viewportValue.width>>=d,m.viewportValue.height>>=d,m.viewportValue.minDepth=y,m.viewportValue.maxDepth=x,m.viewport=m.viewportValue.equals(ab)===!1,m.scissorValue.copy(p).multiplyScalar(v).floor(),m.scissor=this._scissorTest&&m.scissorValue.equals(ab)===!1,m.scissorValue.width>>=d,m.scissorValue.height>>=d,m.clippingContext||(m.clippingContext=new P_),m.clippingContext.updateGlobal(u,t),u.onBeforeRender(this,e,t,f),L_.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),lb.setFromProjectionMatrix(L_,g);const S=this._renderLists.get(e,t);if(S.begin(),this._projectObject(e,t,0,S,m.clippingContext),S.finish(),this.sortObjects===!0&&S.sort(this._opaqueSort,this._transparentSort),f!==null){this._textures.updateRenderTarget(f,d);const C=this._textures.get(f);m.textures=C.textures,m.depthTexture=C.depthTexture,m.width=C.width,m.height=C.height,m.renderTarget=f,m.depth=f.depthBuffer,m.stencil=f.stencilBuffer}else m.textures=null,m.depthTexture=null,m.width=this.domElement.width,m.height=this.domElement.height,m.depth=this.depth,m.stencil=this.stencil;m.width>>=d,m.height>>=d,m.activeCubeFace=h,m.activeMipmapLevel=d,m.occlusionQueryCount=S.occlusionQueryCount,this._background.update(u,S,m),this.backend.beginRender(m);const{bundles:T,lightsNode:w,transparentDoublePass:E,transparent:M,opaque:b}=S;if(T.length>0&&this._renderBundles(T,u,w),this.opaque===!0&&b.length>0&&this._renderObjects(b,t,u,w),this.transparent===!0&&M.length>0&&this._renderTransparents(M,E,t,u,w),this.backend.finishRender(m),s.renderId=o,this._currentRenderContext=a,this._currentRenderObjectFunction=l,r!==null){this.setRenderTarget(c,h,d);const C=this._quad;this._nodes.hasOutputChange(f.texture)&&(C.material.fragmentNode=this._nodes.getOutputNode(f.texture),C.material.needsUpdate=!0),this._renderScene(C,C.camera,!1)}return u.onAfterRender(this,e,t,f),m}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,i){this._width=e,this._height=t,this._pixelRatio=i,this.domElement.width=Math.floor(e*i),this.domElement.height=Math.floor(t*i),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize()}setSize(e,t,i=!0){this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),i===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize()}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,i,r){const s=this._scissor;e.isVector4?s.copy(e):s.set(e,t,i,r)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e,this.backend.setScissorTest(e)}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,i,r,s=0,o=1){const a=this._viewport;e.isVector4?a.copy(e):a.set(e,t,i,r),a.minDepth=s,a.maxDepth=o}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,i=!0){if(this._initialized===!1)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(e,t,i);const r=this._renderTarget||this._getFrameBufferTarget();let s=null;if(r!==null){this._textures.updateRenderTarget(r);const o=this._textures.get(r);s=this._renderContexts.get(null,null,r),s.textures=o.textures,s.depthTexture=o.depthTexture,s.width=o.width,s.height=o.height,s.renderTarget=r,s.depth=r.depthBuffer,s.stencil=r.stencilBuffer}if(this.backend.clear(e,t,i,s),r!==null&&this._renderTarget===null){const o=this._quad;this._nodes.hasOutputChange(r.texture)&&(o.material.fragmentNode=this._nodes.getOutputNode(r.texture),o.material.needsUpdate=!0),this._renderScene(o,o.camera,!1)}}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,i=!0){this._initialized===!1&&await this.init(),this.clear(e,t,i)}async clearColorAsync(){this.clearAsync(!0,!1,!1)}async clearDepthAsync(){this.clearAsync(!1,!0,!1)}async clearStencilAsync(){this.clearAsync(!1,!1,!0)}get currentToneMapping(){return this._renderTarget!==null?Gi:this.toneMapping}get currentColorSpace(){return this._renderTarget!==null?zr:this.outputColorSpace}dispose(){this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,i=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=i}getRenderTarget(){return this._renderTarget}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e){if(this.isDeviceLost===!0)return;if(this._initialized===!1)return console.warn("THREE.Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e);const t=this._nodes.nodeFrame,i=t.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,t.renderId=this.info.calls;const r=this.backend,s=this._pipelines,o=this._bindings,a=this._nodes,l=Array.isArray(e)?e:[e];if(l[0]===void 0||l[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");r.beginCompute(e);for(const u of l){if(s.has(u)===!1){const d=()=>{u.removeEventListener("dispose",d),s.delete(u),o.delete(u),a.delete(u)};u.addEventListener("dispose",d);const f=u.onInitFunction;f!==null&&f.call(u,{renderer:this})}a.updateForCompute(u),o.updateForCompute(u);const c=o.getForCompute(u),h=s.getForCompute(u,c);r.compute(e,u,c,h)}r.finishCompute(e),t.renderId=i}async computeAsync(e){this._initialized===!1&&await this.init(),this.compute(e),await this.backend.resolveTimestampAsync(e,"compute")}async hasFeatureAsync(e){return this._initialized===!1&&await this.init(),this.backend.hasFeature(e)}hasFeature(e){return this._initialized===!1?(console.warn("THREE.Renderer: .hasFeature() called before the backend is initialized. Try using .hasFeatureAsync() instead."),!1):this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){this._initialized===!1&&await this.init(),this._textures.updateTexture(e)}initTexture(e){this._initialized===!1&&console.warn("THREE.Renderer: .initTexture() called before the backend is initialized. Try using .initTextureAsync() instead."),this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=ka.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=ka.copy(t).floor();else{console.error("THREE.Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=ka.set(0,0,e.image.width,e.image.height);let i=this._currentRenderContext,r;i!==null?r=i.renderTarget:(r=this._renderTarget||this._getFrameBufferTarget(),r!==null&&(this._textures.updateRenderTarget(r),i=this._textures.get(r))),this._textures.updateTexture(e,{renderTarget:r}),this.backend.copyFramebufferToTexture(e,i,t)}copyTextureToTexture(e,t,i=null,r=null,s=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,i,r,s)}async readRenderTargetPixelsAsync(e,t,i,r,s,o=0,a=0){return this.backend.copyTextureToBuffer(e.textures[o],t,i,r,s,a)}_projectObject(e,t,i,r,s){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)i=e.renderOrder,e.isClippingGroup&&e.enabled&&(s=s.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)r.pushLight(e);else if(e.isSprite){if(!e.frustumCulled||lb.intersectsSprite(e)){this.sortObjects===!0&&ka.setFromMatrixPosition(e.matrixWorld).applyMatrix4(L_);const{geometry:l,material:u}=e;u.visible&&r.push(e,l,u,i,ka.z,null,s)}}else if(e.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||lb.intersectsObject(e))){const{geometry:l,material:u}=e;if(this.sortObjects===!0&&(l.boundingSphere===null&&l.computeBoundingSphere(),ka.copy(l.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(L_)),Array.isArray(u)){const c=l.groups;for(let h=0,d=c.length;h<d;h++){const f=c[h],m=u[f.materialIndex];m&&m.visible&&r.push(e,l,m,i,ka.z,f,s)}}else u.visible&&r.push(e,l,u,i,ka.z,null,s)}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const l=r;r=this._renderLists.get(e,t),r.begin(),l.pushBundle({bundleGroup:e,camera:t,renderList:r}),r.finish()}const a=e.children;for(let l=0,u=a.length;l<u;l++)this._projectObject(a[l],t,i,r,s)}_renderBundles(e,t,i){for(const r of e)this._renderBundle(r,t,i)}_renderTransparents(e,t,i,r,s){if(t.length>0){for(const{material:o}of t)o.side=Xt;this._renderObjects(t,i,r,s,"backSide");for(const{material:o}of t)o.side=is;this._renderObjects(e,i,r,s);for(const{material:o}of t)o.side=Ti}else this._renderObjects(e,i,r,s)}_renderObjects(e,t,i,r,s=null){for(let o=0,a=e.length;o<a;o++){const l=e[o],{object:u,geometry:c,material:h,group:d,clippingContext:f}=l;if(t.isArrayCamera){const m=t.cameras;for(let g=0,_=m.length;g<_;g++){const p=m[g];if(u.layers.test(p.layers)){const v=p.viewport,y=v.minDepth===void 0?0:v.minDepth,x=v.maxDepth===void 0?1:v.maxDepth,S=this._currentRenderContext.viewportValue;S.copy(v).multiplyScalar(this._pixelRatio).floor(),S.minDepth=y,S.maxDepth=x,this.backend.updateViewport(this._currentRenderContext),this._currentRenderObjectFunction(u,i,p,c,h,d,r,f,s)}}}else this._currentRenderObjectFunction(u,i,t,c,h,d,r,f,s)}}renderObject(e,t,i,r,s,o,a,l=null,u=null){let c,h,d;if(e.onBeforeRender(this,t,i,r,s,o),t.overrideMaterial!==null){const f=t.overrideMaterial;s.positionNode&&s.positionNode.isNode&&(c=f.positionNode,f.positionNode=s.positionNode),f.alphaTest=s.alphaTest,f.alphaMap=s.alphaMap,f.transparent=s.transparent||s.transmission>0,f.isShadowNodeMaterial&&(f.side=s.shadowSide===null?s.side:s.shadowSide,s.depthNode&&s.depthNode.isNode&&(d=f.depthNode,f.depthNode=s.depthNode),s.castShadowNode&&s.castShadowNode.isNode&&(h=f.colorNode,f.colorNode=s.castShadowNode)),s=f}s.transparent===!0&&s.side===Ti&&s.forceSinglePass===!1?(s.side=Xt,this._handleObjectFunction(e,s,t,i,a,o,l,"backSide"),s.side=is,this._handleObjectFunction(e,s,t,i,a,o,l,u),s.side=Ti):this._handleObjectFunction(e,s,t,i,a,o,l,u),c!==void 0&&(t.overrideMaterial.positionNode=c),d!==void 0&&(t.overrideMaterial.depthNode=d),h!==void 0&&(t.overrideMaterial.colorNode=h),e.onAfterRender(this,t,i,r,s,o)}_renderObjectDirect(e,t,i,r,s,o,a,l){const u=this._objects.get(e,t,i,r,s,this._currentRenderContext,a,l);u.drawRange=e.geometry.drawRange,u.group=o;const c=this._nodes.needsRefresh(u);c&&(this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u)),this._pipelines.updateForRender(u),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(u),u.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(u,this.info),c&&this._nodes.updateAfter(u)}_createObjectPipeline(e,t,i,r,s,o,a,l){const u=this._objects.get(e,t,i,r,s,this._currentRenderContext,a,l);u.drawRange=e.geometry.drawRange,u.group=o,this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u),this._pipelines.getForRender(u,this._compilationPromises),this._nodes.updateAfter(u)}get compile(){return this.compileAsync}}class ub{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}}function Bq(n){return n+(Ba-n%Ba)%Ba}class vD extends ub{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t}get byteLength(){return Bq(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class yD extends vD{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let kq=0;class xD extends yD{constructor(e,t){super("UniformBuffer_"+kq++,e?e.value:null),this.nodeUniform=e,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class zq extends yD{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){let e=0;for(let t=0,i=this.uniforms.length;t<i;t++){const r=this.uniforms[t],{boundary:s,itemSize:o}=r,a=e%Ba,l=Ba-a;a!==0&&l-s<0?e+=Ba-a:a%s!==0&&(e+=a%s),r.offset=e/this.bytesPerElement,e+=o*this.bytesPerElement}return Math.ceil(e/Ba)*Ba}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const i=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(i[s]!==r){const a=this._getBufferForType(o);a[s]=i[s]=r,t=!0}return t}updateVector2(e){let t=!1;const i=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(i[s+0]!==r.x||i[s+1]!==r.y){const a=this._getBufferForType(o);a[s+0]=i[s+0]=r.x,a[s+1]=i[s+1]=r.y,t=!0}return t}updateVector3(e){let t=!1;const i=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(i[s+0]!==r.x||i[s+1]!==r.y||i[s+2]!==r.z){const a=this._getBufferForType(o);a[s+0]=i[s+0]=r.x,a[s+1]=i[s+1]=r.y,a[s+2]=i[s+2]=r.z,t=!0}return t}updateVector4(e){let t=!1;const i=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(i[s+0]!==r.x||i[s+1]!==r.y||i[s+2]!==r.z||i[s+4]!==r.w){const a=this._getBufferForType(o);a[s+0]=i[s+0]=r.x,a[s+1]=i[s+1]=r.y,a[s+2]=i[s+2]=r.z,a[s+3]=i[s+3]=r.w,t=!0}return t}updateColor(e){let t=!1;const i=this.values,r=e.getValue(),s=e.offset;if(i[s+0]!==r.r||i[s+1]!==r.g||i[s+2]!==r.b){const o=this.buffer;o[s+0]=i[s+0]=r.r,o[s+1]=i[s+1]=r.g,o[s+2]=i[s+2]=r.b,t=!0}return t}updateMatrix3(e){let t=!1;const i=this.values,r=e.getValue().elements,s=e.offset;if(i[s+0]!==r[0]||i[s+1]!==r[1]||i[s+2]!==r[2]||i[s+4]!==r[3]||i[s+5]!==r[4]||i[s+6]!==r[5]||i[s+8]!==r[6]||i[s+9]!==r[7]||i[s+10]!==r[8]){const o=this.buffer;o[s+0]=i[s+0]=r[0],o[s+1]=i[s+1]=r[1],o[s+2]=i[s+2]=r[2],o[s+4]=i[s+4]=r[3],o[s+5]=i[s+5]=r[4],o[s+6]=i[s+6]=r[5],o[s+8]=i[s+8]=r[6],o[s+9]=i[s+9]=r[7],o[s+10]=i[s+10]=r[8],t=!0}return t}updateMatrix4(e){let t=!1;const i=this.values,r=e.getValue().elements,s=e.offset;return Vq(i,r,s)===!1&&(this.buffer.set(r,s),Gq(i,r,s),t=!0),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function Gq(n,e,t){for(let i=0,r=e.length;i<r;i++)n[t+i]=e[i]}function Vq(n,e,t){for(let i=0,r=e.length;i<r;i++)if(n[t+i]!==e[i])return!1;return!0}let Hq=0;class SD extends zq{constructor(e,t){super(e),this.id=Hq++,this.groupNode=t,this.isNodeUniformsGroup=!0}}let Wq=0;class $q extends ub{constructor(e,t){super(e),this.id=Wq++,this.texture=t,this.version=t?t.version:0,this.store=!1,this.generation=null,this.isSampledTexture=!0}needsBindingsUpdate(e){const{texture:t}=this;return e!==this.generation?(this.generation=e,!0):t.isVideoTexture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}}class I_ extends $q{constructor(e,t,i,r=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=i,this.access=r}needsBindingsUpdate(e){return this.textureNode.value!==this.texture||super.needsBindingsUpdate(e)}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class TD extends I_{constructor(e,t,i,r=null){super(e,t,i,r),this.isSampledCubeTexture=!0}}class bD extends I_{constructor(e,t,i,r=null){super(e,t,i,r),this.isSampledTexture3D=!0}}const jq={textureDimensions:"textureSize",equals:"equal"},Xq={low:"lowp",medium:"mediump",high:"highp"},wD={swizzleAssign:!0,storageBuffer:!1},MD=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
`;class qq extends cD{constructor(e,t){super(e,t,new Pq),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]},this.useComparisonMethod=!0}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==pr}getMethod(e){return jq[e]||e}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,i=this.flowShaderNode(e),r=[];for(const o of t.inputs)r.push(this.getType(o.type)+" "+o.name);return`${this.getType(t.type)} ${t.name}( ${r.join(", ")} ) {

	${i.vars}

${i.code}
	return ${i.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const i=t.array,r=t.count*t.itemSize,{itemSize:s}=t,o=t.array.constructor.name.toLowerCase().includes("int");let a=o?ju:Ad;s===2?a=o?Xu:yl:s===3?a=o?qO:Ed:s===4&&(a=o?qu:Kn);const l={Float32Array:mn,Uint8Array:oi,Uint16Array:rs,Uint32Array:rn,Int8Array:_l,Int16Array:vl,Int32Array:Hn,Uint8ClampedArray:oi},u=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(r/s))));let c=Math.ceil(r/s/u);u*c*s<r&&c++;const h=u*c*s,d=new i.constructor(h);d.set(i,0),t.array=d;const f=new K3(t.array,u,c,a,l[t.array.constructor.name]||mn);f.needsUpdate=!0,f.isPBOTexture=!0;const m=new Af(f,null,null);m.setPrecision("high"),t.pboNode=m,t.pbo=m.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.label)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:i}=e,r=t.value;if(this.renderer.backend.has(r)){const c=this.renderer.backend.get(r);c.pbo=r.pbo}const s=this.getUniformFromNode(r.pboNode,"texture",this.shaderStage,this.context.label),o=this.getPropertyName(s);this.increaseUsage(i);const a=i.build(this,"uint"),l=this.getDataFromNode(e);let u=l.propertyName;if(u===void 0){const c=this.getVarFromNode(e);u=this.getPropertyName(c);const h=this.getDataFromNode(t);let d=h.propertySizeName;d===void 0&&(d=u+"Size",this.getVarFromNode(t,d,"uint"),this.addLineFlowCode(`${d} = uint( textureSize( ${o}, 0 ).x )`,e),h.propertySizeName=d);const{itemSize:f}=r,m="."+Wc.join("").slice(0,f),g=`ivec2(${a} % ${d}, ${a} / ${d})`,_=this.generateTextureLoad(null,o,g,null,"0");let p="vec4";r.pbo.type===rn?p="uvec4":r.pbo.type===Hn&&(p="ivec4"),this.addLineFlowCode(`${u} = ${p}(${_})${m}`,e),l.propertyName=u}return u}generateTextureLoad(e,t,i,r,s="0"){return r?`texelFetch( ${t}, ivec3( ${i}, ${r} ), ${s} )`:`texelFetch( ${t}, ${i}, ${s} )`}generateTexture(e,t,i,r){return e.isDepthTexture?`texture( ${t}, ${i} ).x`:(r&&(i=`vec3( ${i}, ${r} )`),`texture( ${t}, ${i} )`)}generateTextureLevel(e,t,i,r){return`textureLod( ${t}, ${i}, ${r} )`}generateTextureBias(e,t,i,r){return`texture( ${t}, ${i}, ${r} )`}generateTextureGrad(e,t,i,r){return`textureGrad( ${t}, ${i}, ${r[0]}, ${r[1]} )`}generateTextureCompare(e,t,i,r,s,o=this.shaderStage){if(o==="fragment")return`texture( ${t}, vec3( ${i}, ${r} ) )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}getVars(e){const t=[],i=this.vars[e];if(i!==void 0)for(const r of i)t.push(`${this.getVar(r.type,r.name)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],i=[],r={};for(const o of t){let a=null,l=!1;if(o.type==="texture"){const c=o.node.value;let h="";c.isDataTexture===!0&&(c.type===rn?h="u":c.type===Hn&&(h="i")),c.compareFunction?a=`sampler2DShadow ${o.name};`:c.isDataArrayTexture===!0||c.isCompressedArrayTexture===!0?a=`${h}sampler2DArray ${o.name};`:a=`${h}sampler2D ${o.name};`}else if(o.type==="cubeTexture")a=`samplerCube ${o.name};`;else if(o.type==="texture3D")a=`sampler3D ${o.name};`;else if(o.type==="buffer"){const c=o.node,h=this.getType(c.bufferType),d=c.bufferCount,f=d>0?d:"";a=`${c.name} {
	${h} ${o.name}[${f}];
};
`}else a=`${this.getVectorType(o.type)} ${this.getPropertyName(o,e)};`,l=!0;const u=o.node.precision;if(u!==null&&(a=Xq[u]+" "+a),l){a="	"+a;const c=o.groupNode.name;(r[c]||(r[c]=[])).push(a)}else a="uniform "+a,i.push(a)}let s="";for(const o in r){const a=r[o];s+=this._getGLSLUniformStruct(e+"_"+o,a.join(`
`))+`
`}return s+=i.join(`
`),s}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==Hn){let i=e;e.isInterleavedBufferAttribute&&(i=e.data);const r=i.array;r instanceof Uint32Array||r instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const i=this.getAttributesArray();let r=0;for(const s of i)t+=`layout( location = ${r++} ) in ${s.type} ${s.name};
`}return t}getStructMembers(e){const t=[],i=e.getMemberTypes();for(let r=0;r<i.length;r++){const s=i[r];t.push(`layout( location = ${r} ) out ${s} m${r};`)}return t.join(`
`)}getStructs(e){const t=[],i=this.structs[e];if(i.length===0)return`layout( location = 0 ) out vec4 fragColor;
`;for(let r=0,s=i.length;r<s;r++){const o=i[r];let a=`
`;a+=this.getStructMembers(o),a+=`
`,t.push(a)}return t.join(`

`)}getVaryings(e){let t="";const i=this.varyings;if(e==="vertex"||e==="compute")for(const r of i){e==="compute"&&(r.needsInterpolation=!0);const s=this.getType(r.type),o=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${o}${r.needsInterpolation?"out":"/*out*/"} ${s} ${r.name};
`}else if(e==="fragment"){for(const r of i)if(r.needsInterpolation){const s=this.getType(r.type),o=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${o}in ${s} ${r.name};
`}}for(const r of this.builtins[e])t+=`${r};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((i,r)=>i*r,1)}u`}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,i=this.shaderStage){const r=this.extensions[i]||(this.extensions[i]=new Map);r.has(e)===!1&&r.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const r=this.renderer.backend.extensions;this.object.isBatchedMesh&&r.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const i=this.extensions[e];if(i!==void 0)for(const{name:r,behavior:s}of i.values())t.push(`#extension ${r} : ${s}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=wD[e];if(t===void 0){let i;switch(t=!1,e){case"float32Filterable":i="OES_texture_float_linear";break;case"clipDistance":i="WEBGL_clip_cull_distance";break}if(i!==void 0){const r=this.renderer.backend.extensions;r.has(i)&&(r.get(i),t=!0)}wD[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let i=0;i<e.length;i++){const r=e[i],s=this.getPropertyName(r.attributeNode);t+=`${r.varyingName} = ${s};
	`}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions 
${e.extensions}

// precision
${MD}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// precision
${MD}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

${e.structs}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let i=`// code

`;i+=this.flowCode[t];const r=this.flowNodes[t],s=r[r.length-1];for(const a of r){const l=this.getFlowData(a),u=a.name;u&&(i.length>0&&(i+=`
`),i+=`	// flow -> ${u}
	`),i+=`${l.code}
	`,a===s&&t!=="compute"&&(i+=`// result
	`,t==="vertex"?(i+="gl_Position = ",i+=`${l.result};`):t==="fragment"&&(a.outputNode.isOutputStructNode||(i+="fragColor = ",i+=`${l.result};`)))}const o=e[t];o.extensions=this.getExtensions(t),o.uniforms=this.getUniforms(t),o.attributes=this.getAttributes(t),o.varyings=this.getVaryings(t),o.vars=this.getVars(t),o.structs=this.getStructs(t),o.codes=this.getCodes(t),o.transforms=this.getTransforms(t),o.flow=i}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,i,r=null){const s=super.getUniformFromNode(e,t,i,r),o=this.getDataFromNode(e,i,this.globalCache);let a=o.uniformGPU;if(a===void 0){const l=e.groupNode,u=l.name,c=this.getBindGroupArray(u,i);if(t==="texture")a=new I_(s.name,s.node,l),c.push(a);else if(t==="cubeTexture")a=new TD(s.name,s.node,l),c.push(a);else if(t==="texture3D")a=new bD(s.name,s.node,l),c.push(a);else if(t==="buffer"){e.name=`NodeBuffer_${e.id}`,s.name=`buffer${e.id}`;const h=new xD(e,l);h.name=e.name,c.push(h),a=h}else{const h=this.uniformGroups[i]||(this.uniformGroups[i]={});let d=h[u];d===void 0&&(d=new SD(i+"_"+u,l),h[u]=d,c.push(d)),a=this.getNodeUniform(s,t),d.addUniform(a)}o.uniformGPU=a}return s}}let cb=null,ih=null;class ED{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}createSampler(){}destroySampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}isOccluded(){}async resolveTimestampAsync(){}async waitForGPU(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return cb=cb||new he,this.renderer.getDrawingBufferSize(cb)}setScissorTest(){}getClearColor(){const e=this.renderer;return ih=ih||new GT,e.getClearColor(ih),ih.getRGB(ih,this.renderer.currentColorSpace),ih}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:MA(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Gu} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}}let Yq=0;class Kq{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class Qq{constructor(e){this.backend=e}createAttribute(e,t){const i=this.backend,{gl:r}=i,s=e.array,o=e.usage||r.STATIC_DRAW,a=e.isInterleavedBufferAttribute?e.data:e,l=i.get(a);let u=l.bufferGPU;u===void 0&&(u=this._createBuffer(r,t,s,o),l.bufferGPU=u,l.bufferType=t,l.version=a.version);let c;if(s instanceof Float32Array)c=r.FLOAT;else if(s instanceof Uint16Array)e.isFloat16BufferAttribute?c=r.HALF_FLOAT:c=r.UNSIGNED_SHORT;else if(s instanceof Int16Array)c=r.SHORT;else if(s instanceof Uint32Array)c=r.UNSIGNED_INT;else if(s instanceof Int32Array)c=r.INT;else if(s instanceof Int8Array)c=r.BYTE;else if(s instanceof Uint8Array)c=r.UNSIGNED_BYTE;else if(s instanceof Uint8ClampedArray)c=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+s);let h={bufferGPU:u,bufferType:t,type:c,byteLength:s.byteLength,bytesPerElement:s.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:c===r.INT||c===r.UNSIGNED_INT||e.gpuType===Hn,id:Yq++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const d=this._createBuffer(r,t,s,o);h=new Kq(h,d)}i.set(e,h)}updateAttribute(e){const t=this.backend,{gl:i}=t,r=e.array,s=e.isInterleavedBufferAttribute?e.data:e,o=t.get(s),a=o.bufferType,l=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(i.bindBuffer(a,o.bufferGPU),l.length===0)i.bufferSubData(a,0,r);else{for(let u=0,c=l.length;u<c;u++){const h=l[u];i.bufferSubData(a,h.start*r.BYTES_PER_ELEMENT,r,h.start,h.count)}s.clearUpdateRanges()}i.bindBuffer(a,null),o.version=s.version}destroyAttribute(e){const t=this.backend,{gl:i}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const r=t.get(e);i.deleteBuffer(r.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:i}=t,r=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:s}=t.get(r),o=e.array,a=o.byteLength;i.bindBuffer(i.COPY_READ_BUFFER,s);const l=i.createBuffer();i.bindBuffer(i.COPY_WRITE_BUFFER,l),i.bufferData(i.COPY_WRITE_BUFFER,a,i.STREAM_READ),i.copyBufferSubData(i.COPY_READ_BUFFER,i.COPY_WRITE_BUFFER,0,0,a),await t.utils._clientWaitAsync();const u=new e.array.constructor(o.length);return i.bindBuffer(i.COPY_WRITE_BUFFER,l),i.getBufferSubData(i.COPY_WRITE_BUFFER,0,u),i.deleteBuffer(l),i.bindBuffer(i.COPY_READ_BUFFER,null),i.bindBuffer(i.COPY_WRITE_BUFFER,null),u.buffer}_createBuffer(e,t,i,r){const s=e.createBuffer();return e.bindBuffer(t,s),e.bufferData(t,i,r),e.bindBuffer(t,null),s}}let AD=!1,hb,Wf;class Zq{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},AD===!1&&(this._init(this.gl),AD=!0)}_init(e){hb={[fr]:e.FUNC_ADD,[Oy]:e.FUNC_SUBTRACT,[By]:e.FUNC_REVERSE_SUBTRACT},Wf={[ky]:e.ZERO,[zy]:e.ONE,[Gy]:e.SRC_COLOR,[gd]:e.SRC_ALPHA,[Xy]:e.SRC_ALPHA_SATURATE,[$y]:e.DST_COLOR,[Hy]:e.DST_ALPHA,[Vy]:e.ONE_MINUS_SRC_COLOR,[_d]:e.ONE_MINUS_SRC_ALPHA,[jy]:e.ONE_MINUS_DST_COLOR,[Wy]:e.ONE_MINUS_DST_ALPHA}}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==uA?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===Iy?t.cullFace(t.BACK):e===cA?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:i}=this;e!==t&&(i.lineWidth(e),this.currentLineWidth=e)}setBlending(e,t,i,r,s,o,a,l){const{gl:u}=this;if(e===zi){this.currentBlendingEnabled===!0&&(this.disable(u.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(u.BLEND),this.currentBlendingEnabled=!0),e!==Fy){if(e!==this.currentBlending||l!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==fr||this.currentBlendEquationAlpha!==fr)&&(u.blendEquation(u.FUNC_ADD),this.currentBlendEquation=fr,this.currentBlendEquationAlpha=fr),l)switch(e){case Or:u.blendFuncSeparate(u.ONE,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case Vu:u.blendFunc(u.ONE,u.ONE);break;case Hu:u.blendFuncSeparate(u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ZERO,u.ONE);break;case Wu:u.blendFuncSeparate(u.ZERO,u.SRC_COLOR,u.ZERO,u.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}else switch(e){case Or:u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case Vu:u.blendFunc(u.SRC_ALPHA,u.ONE);break;case Hu:u.blendFuncSeparate(u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ZERO,u.ONE);break;case Wu:u.blendFunc(u.ZERO,u.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=l}return}s=s||t,o=o||i,a=a||r,(t!==this.currentBlendEquation||s!==this.currentBlendEquationAlpha)&&(u.blendEquationSeparate(hb[t],hb[s]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=s),(i!==this.currentBlendSrc||r!==this.currentBlendDst||o!==this.currentBlendSrcAlpha||a!==this.currentBlendDstAlpha)&&(u.blendFuncSeparate(Wf[i],Wf[r],Wf[o],Wf[a]),this.currentBlendSrc=i,this.currentBlendDst=r,this.currentBlendSrcAlpha=o,this.currentBlendDstAlpha=a),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case vd:t.depthFunc(t.NEVER);break;case yd:t.depthFunc(t.ALWAYS);break;case xd:t.depthFunc(t.LESS);break;case fa:t.depthFunc(t.LEQUAL);break;case Sd:t.depthFunc(t.EQUAL);break;case Td:t.depthFunc(t.GEQUAL);break;case bd:t.depthFunc(t.GREATER);break;case wd:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,i){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==i)&&(this.gl.stencilFunc(e,t,i),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=i)}setStencilOp(e,t,i){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==i)&&(this.gl.stencilOp(e,t,i),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=i)}setMaterial(e,t,i){const{gl:r}=this;e.side===Ti?this.disable(r.CULL_FACE):this.enable(r.CULL_FACE);let s=e.side===Xt;t&&(s=!s),this.setFlipSided(s),e.blending===Or&&e.transparent===!1?this.setBlending(zi):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const o=e.stencilWrite;if(this.setStencilTest(o),o&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.samples>1?this.enable(r.SAMPLE_ALPHA_TO_COVERAGE):this.disable(r.SAMPLE_ALPHA_TO_COVERAGE),i>0&&this.currentClippingPlanes!==i)for(let l=0;l<8;l++)l<i?this.enable(12288+l):this.disable(12288+l)}setPolygonOffset(e,t,i){const{gl:r}=this;e?(this.enable(r.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==i)&&(r.polygonOffset(t,i),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=i)):this.disable(r.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}bindFramebuffer(e,t){const{gl:i,currentBoundFramebuffers:r}=this;return r[e]!==t?(i.bindFramebuffer(e,t),r[e]=t,e===i.DRAW_FRAMEBUFFER&&(r[i.FRAMEBUFFER]=t),e===i.FRAMEBUFFER&&(r[i.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:i}=this;let r=[],s=!1;if(e.textures!==null){r=this.currentDrawbuffers.get(t),r===void 0&&(r=[],this.currentDrawbuffers.set(t,r));const o=e.textures;if(r.length!==o.length||r[0]!==i.COLOR_ATTACHMENT0){for(let a=0,l=o.length;a<l;a++)r[a]=i.COLOR_ATTACHMENT0+a;r.length=o.length,s=!0}}else r[0]!==i.BACK&&(r[0]=i.BACK,s=!0);s&&i.drawBuffers(r)}activeTexture(e){const{gl:t,currentTextureSlot:i,maxTextures:r}=this;e===void 0&&(e=t.TEXTURE0+r-1),i!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,i){const{gl:r,currentTextureSlot:s,currentBoundTextures:o,maxTextures:a}=this;i===void 0&&(s===null?i=r.TEXTURE0+a-1:i=s);let l=o[i];l===void 0&&(l={type:void 0,texture:void 0},o[i]=l),(l.type!==e||l.texture!==t)&&(s!==i&&(r.activeTexture(i),this.currentTextureSlot=i),r.bindTexture(e,t),l.type=e,l.texture=t)}bindBufferBase(e,t,i){const{gl:r}=this,s=`${e}-${t}`;return this.currentBoundBufferBases[s]!==i?(r.bindBufferBase(e,t,i),this.currentBoundBufferBases[s]=i,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:i}=this,r=i[t];r!==void 0&&r.type!==void 0&&(e.bindTexture(r.type,null),r.type=void 0,r.texture=void 0)}}class Jq{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=pr){const{gl:i,extensions:r}=this;let s;if(e===oi)return i.UNSIGNED_BYTE;if(e===Lm)return i.UNSIGNED_SHORT_4_4_4_4;if(e===Im)return i.UNSIGNED_SHORT_5_5_5_1;if(e===Um)return i.UNSIGNED_INT_5_9_9_9_REV;if(e===_l)return i.BYTE;if(e===vl)return i.SHORT;if(e===rs)return i.UNSIGNED_SHORT;if(e===Hn)return i.INT;if(e===rn)return i.UNSIGNED_INT;if(e===mn)return i.FLOAT;if(e===wi)return i.HALF_FLOAT;if(e===Yy)return i.ALPHA;if(e===Ed)return i.RGB;if(e===Kn)return i.RGBA;if(e===Ky)return i.LUMINANCE;if(e===Qy)return i.LUMINANCE_ALPHA;if(e===Rs)return i.DEPTH_COMPONENT;if(e===Ns)return i.DEPTH_STENCIL;if(e===Ad)return i.RED;if(e===ju)return i.RED_INTEGER;if(e===yl)return i.RG;if(e===Xu)return i.RG_INTEGER;if(e===qu)return i.RGBA_INTEGER;if(e===xl||e===ga||e===_a||e===va)if(t===Be)if(s=r.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(e===xl)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===ga)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===_a)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===va)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=r.get("WEBGL_compressed_texture_s3tc"),s!==null){if(e===xl)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===ga)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===_a)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===va)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===Cd||e===Rd||e===Nd||e===Pd)if(s=r.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(e===Cd)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===Rd)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===Nd)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Pd)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===Dd||e===Yu||e===Ku)if(s=r.get("WEBGL_compressed_texture_etc"),s!==null){if(e===Dd||e===Yu)return t===Be?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(e===Ku)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(e===Qu||e===Zu||e===Ju||e===ec||e===tc||e===nc||e===ic||e===rc||e===sc||e===oc||e===ac||e===lc||e===uc||e===cc)if(s=r.get("WEBGL_compressed_texture_astc"),s!==null){if(e===Qu)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===Zu)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===Ju)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===ec)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===tc)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===nc)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===ic)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===rc)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===sc)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===oc)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===ac)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===lc)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===uc)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===cc)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===Sl)if(s=r.get("EXT_texture_compression_bptc"),s!==null){if(e===Sl)return t===Be?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===ex||e===Ld||e===Id||e===Ud)if(s=r.get("EXT_texture_compression_rgtc"),s!==null){if(e===Sl)return s.COMPRESSED_RED_RGTC1_EXT;if(e===Ld)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===Id)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===Ud)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===Cs?i.UNSIGNED_INT_24_8:i[e]!==void 0?i[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((i,r)=>{function s(){const o=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(o===e.WAIT_FAILED){e.deleteSync(t),r();return}if(o===e.TIMEOUT_EXPIRED){requestAnimationFrame(s);return}e.deleteSync(t),i()}s()})}}let CD=!1,U_,db,RD;class eY{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},CD===!1&&(this._init(this.gl),CD=!0)}_init(e){U_={[ml]:e.REPEAT,[Es]:e.CLAMP_TO_EDGE,[gl]:e.MIRRORED_REPEAT},db={[Vt]:e.NEAREST,[Dm]:e.NEAREST_MIPMAP_NEAREST,[As]:e.NEAREST_MIPMAP_LINEAR,[Sn]:e.LINEAR,[$u]:e.LINEAR_MIPMAP_NEAREST,[bi]:e.LINEAR_MIPMAP_LINEAR},RD={[nx]:e.NEVER,[ax]:e.ALWAYS,[Om]:e.LESS,[Bm]:e.LEQUAL,[ix]:e.EQUAL,[ox]:e.GEQUAL,[rx]:e.GREATER,[sx]:e.NOTEQUAL}}filterFallback(e){const{gl:t}=this;return e===Vt||e===Dm||e===As?t.NEAREST:t.LINEAR}getGLTextureType(e){const{gl:t}=this;let i;return e.isCubeTexture===!0?i=t.TEXTURE_CUBE_MAP:e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?i=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?i=t.TEXTURE_3D:i=t.TEXTURE_2D,i}getInternalFormat(e,t,i,r,s=!1){const{gl:o,extensions:a}=this;if(e!==null){if(o[e]!==void 0)return o[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let l=t;return t===o.RED&&(i===o.FLOAT&&(l=o.R32F),i===o.HALF_FLOAT&&(l=o.R16F),i===o.UNSIGNED_BYTE&&(l=o.R8),i===o.UNSIGNED_SHORT&&(l=o.R16),i===o.UNSIGNED_INT&&(l=o.R32UI),i===o.BYTE&&(l=o.R8I),i===o.SHORT&&(l=o.R16I),i===o.INT&&(l=o.R32I)),t===o.RED_INTEGER&&(i===o.UNSIGNED_BYTE&&(l=o.R8UI),i===o.UNSIGNED_SHORT&&(l=o.R16UI),i===o.UNSIGNED_INT&&(l=o.R32UI),i===o.BYTE&&(l=o.R8I),i===o.SHORT&&(l=o.R16I),i===o.INT&&(l=o.R32I)),t===o.RG&&(i===o.FLOAT&&(l=o.RG32F),i===o.HALF_FLOAT&&(l=o.RG16F),i===o.UNSIGNED_BYTE&&(l=o.RG8),i===o.UNSIGNED_SHORT&&(l=o.RG16),i===o.UNSIGNED_INT&&(l=o.RG32UI),i===o.BYTE&&(l=o.RG8I),i===o.SHORT&&(l=o.RG16I),i===o.INT&&(l=o.RG32I)),t===o.RG_INTEGER&&(i===o.UNSIGNED_BYTE&&(l=o.RG8UI),i===o.UNSIGNED_SHORT&&(l=o.RG16UI),i===o.UNSIGNED_INT&&(l=o.RG32UI),i===o.BYTE&&(l=o.RG8I),i===o.SHORT&&(l=o.RG16I),i===o.INT&&(l=o.RG32I)),t===o.RGB&&(i===o.FLOAT&&(l=o.RGB32F),i===o.HALF_FLOAT&&(l=o.RGB16F),i===o.UNSIGNED_BYTE&&(l=o.RGB8),i===o.UNSIGNED_SHORT&&(l=o.RGB16),i===o.UNSIGNED_INT&&(l=o.RGB32UI),i===o.BYTE&&(l=o.RGB8I),i===o.SHORT&&(l=o.RGB16I),i===o.INT&&(l=o.RGB32I),i===o.UNSIGNED_BYTE&&(l=r===Be&&s===!1?o.SRGB8:o.RGB8),i===o.UNSIGNED_SHORT_5_6_5&&(l=o.RGB565),i===o.UNSIGNED_SHORT_5_5_5_1&&(l=o.RGB5_A1),i===o.UNSIGNED_SHORT_4_4_4_4&&(l=o.RGB4),i===o.UNSIGNED_INT_5_9_9_9_REV&&(l=o.RGB9_E5)),t===o.RGB_INTEGER&&(i===o.UNSIGNED_BYTE&&(l=o.RGB8UI),i===o.UNSIGNED_SHORT&&(l=o.RGB16UI),i===o.UNSIGNED_INT&&(l=o.RGB32UI),i===o.BYTE&&(l=o.RGB8I),i===o.SHORT&&(l=o.RGB16I),i===o.INT&&(l=o.RGB32I)),t===o.RGBA&&(i===o.FLOAT&&(l=o.RGBA32F),i===o.HALF_FLOAT&&(l=o.RGBA16F),i===o.UNSIGNED_BYTE&&(l=o.RGBA8),i===o.UNSIGNED_SHORT&&(l=o.RGBA16),i===o.UNSIGNED_INT&&(l=o.RGBA32UI),i===o.BYTE&&(l=o.RGBA8I),i===o.SHORT&&(l=o.RGBA16I),i===o.INT&&(l=o.RGBA32I),i===o.UNSIGNED_BYTE&&(l=r===Be&&s===!1?o.SRGB8_ALPHA8:o.RGBA8),i===o.UNSIGNED_SHORT_4_4_4_4&&(l=o.RGBA4),i===o.UNSIGNED_SHORT_5_5_5_1&&(l=o.RGB5_A1)),t===o.RGBA_INTEGER&&(i===o.UNSIGNED_BYTE&&(l=o.RGBA8UI),i===o.UNSIGNED_SHORT&&(l=o.RGBA16UI),i===o.UNSIGNED_INT&&(l=o.RGBA32UI),i===o.BYTE&&(l=o.RGBA8I),i===o.SHORT&&(l=o.RGBA16I),i===o.INT&&(l=o.RGBA32I)),t===o.DEPTH_COMPONENT&&(i===o.UNSIGNED_INT&&(l=o.DEPTH24_STENCIL8),i===o.FLOAT&&(l=o.DEPTH_COMPONENT32F)),t===o.DEPTH_STENCIL&&i===o.UNSIGNED_INT_24_8&&(l=o.DEPTH24_STENCIL8),(l===o.R16F||l===o.R32F||l===o.RG16F||l===o.RG32F||l===o.RGBA16F||l===o.RGBA32F)&&a.get("EXT_color_buffer_float"),l}setTextureParameters(e,t){const{gl:i,extensions:r,backend:s}=this;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,t.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,t.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE),i.texParameteri(e,i.TEXTURE_WRAP_S,U_[t.wrapS]),i.texParameteri(e,i.TEXTURE_WRAP_T,U_[t.wrapT]),(e===i.TEXTURE_3D||e===i.TEXTURE_2D_ARRAY)&&i.texParameteri(e,i.TEXTURE_WRAP_R,U_[t.wrapR]),i.texParameteri(e,i.TEXTURE_MAG_FILTER,db[t.magFilter]);const o=t.mipmaps!==void 0&&t.mipmaps.length>0,a=t.minFilter===Sn&&o?bi:t.minFilter;if(i.texParameteri(e,i.TEXTURE_MIN_FILTER,db[a]),t.compareFunction&&(i.texParameteri(e,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(e,i.TEXTURE_COMPARE_FUNC,RD[t.compareFunction])),r.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===Vt||t.minFilter!==As&&t.minFilter!==bi||t.type===mn&&r.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const l=r.get("EXT_texture_filter_anisotropic");i.texParameterf(e,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,s.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:i,defaultTextures:r}=this,s=this.getGLTextureType(e);let o=r[s];o===void 0&&(o=t.createTexture(),i.state.bindTexture(s,o),t.texParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(s,t.TEXTURE_MAG_FILTER,t.NEAREST),r[s]=o),i.set(e,{textureGPU:o,glTextureType:s,isDefault:!0})}createTexture(e,t){const{gl:i,backend:r}=this,{levels:s,width:o,height:a,depth:l}=t,u=r.utils.convert(e.format,e.colorSpace),c=r.utils.convert(e.type),h=this.getInternalFormat(e.internalFormat,u,c,e.colorSpace,e.isVideoTexture),d=i.createTexture(),f=this.getGLTextureType(e);r.state.bindTexture(f,d),this.setTextureParameters(f,e),e.isDataArrayTexture||e.isCompressedArrayTexture?i.texStorage3D(i.TEXTURE_2D_ARRAY,s,h,o,a,l):e.isData3DTexture?i.texStorage3D(i.TEXTURE_3D,s,h,o,a,l):e.isVideoTexture||i.texStorage2D(f,s,h,o,a),r.set(e,{textureGPU:d,glTextureType:f,glFormat:u,glType:c,glInternalFormat:h})}copyBufferToTexture(e,t){const{gl:i,backend:r}=this,{textureGPU:s,glTextureType:o,glFormat:a,glType:l}=r.get(t),{width:u,height:c}=t.source.data;i.bindBuffer(i.PIXEL_UNPACK_BUFFER,e),r.state.bindTexture(o,s),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.texSubImage2D(o,0,0,0,u,c,a,l,0),i.bindBuffer(i.PIXEL_UNPACK_BUFFER,null),r.state.unbindTexture()}updateTexture(e,t){const{gl:i}=this,{width:r,height:s}=t,{textureGPU:o,glTextureType:a,glFormat:l,glType:u,glInternalFormat:c}=this.backend.get(e);if(e.isRenderTargetTexture||o===void 0)return;const h=d=>d.isDataTexture?d.image.data:typeof HTMLImageElement<"u"&&d instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&d instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&d instanceof ImageBitmap||d instanceof OffscreenCanvas?d:d.data;if(this.backend.state.bindTexture(a,o),this.setTextureParameters(a,e),e.isCompressedTexture){const d=e.mipmaps,f=t.image;for(let m=0;m<d.length;m++){const g=d[m];e.isCompressedArrayTexture?e.format!==i.RGBA?l!==null?i.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,m,0,0,0,g.width,g.height,f.depth,l,g.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texSubImage3D(i.TEXTURE_2D_ARRAY,m,0,0,0,g.width,g.height,f.depth,l,u,g.data):l!==null?i.compressedTexSubImage2D(i.TEXTURE_2D,m,0,0,g.width,g.height,l,g.data):console.warn("Unsupported compressed texture format")}}else if(e.isCubeTexture){const d=t.images;for(let f=0;f<6;f++){const m=h(d[f]);i.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,0,0,r,s,l,u,m)}}else if(e.isDataArrayTexture){const d=t.image;i.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,d.width,d.height,d.depth,l,u,d.data)}else if(e.isData3DTexture){const d=t.image;i.texSubImage3D(i.TEXTURE_3D,0,0,0,0,d.width,d.height,d.depth,l,u,d.data)}else if(e.isVideoTexture)e.update(),i.texImage2D(a,0,c,l,u,t.image);else{const d=h(t.image);i.texSubImage2D(a,0,0,0,r,s,l,u,d)}}generateMipmaps(e){const{gl:t,backend:i}=this,{textureGPU:r,glTextureType:s}=i.get(e);i.state.bindTexture(s,r),t.generateMipmap(s)}deallocateRenderBuffers(e){const{gl:t,backend:i}=this;if(e){const r=i.get(e);if(r.renderBufferStorageSetup=void 0,r.framebuffers){for(const s in r.framebuffers)t.deleteFramebuffer(r.framebuffers[s]);delete r.framebuffers}if(r.depthRenderbuffer&&(t.deleteRenderbuffer(r.depthRenderbuffer),delete r.depthRenderbuffer),r.stencilRenderbuffer&&(t.deleteRenderbuffer(r.stencilRenderbuffer),delete r.stencilRenderbuffer),r.msaaFrameBuffer&&(t.deleteFramebuffer(r.msaaFrameBuffer),delete r.msaaFrameBuffer),r.msaaRenderbuffers){for(let s=0;s<r.msaaRenderbuffers.length;s++)t.deleteRenderbuffer(r.msaaRenderbuffers[s]);delete r.msaaRenderbuffers}}}destroyTexture(e){const{gl:t,backend:i}=this,{textureGPU:r,renderTarget:s}=i.get(e);this.deallocateRenderBuffers(s),t.deleteTexture(r),i.delete(e)}copyTextureToTexture(e,t,i=null,r=null,s=0){const{gl:o,backend:a}=this,{state:l}=this.backend,{textureGPU:u,glTextureType:c,glType:h,glFormat:d}=a.get(t);let f,m,g,_,p,v;i!==null?(f=i.max.x-i.min.x,m=i.max.y-i.min.y,g=i.min.x,_=i.min.y):(f=e.image.width,m=e.image.height,g=0,_=0),r!==null?(p=r.x,v=r.y):(p=0,v=0),l.bindTexture(c,u),o.pixelStorei(o.UNPACK_ALIGNMENT,t.unpackAlignment),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,t.unpackAlignment);const y=o.getParameter(o.UNPACK_ROW_LENGTH),x=o.getParameter(o.UNPACK_IMAGE_HEIGHT),S=o.getParameter(o.UNPACK_SKIP_PIXELS),T=o.getParameter(o.UNPACK_SKIP_ROWS),w=o.getParameter(o.UNPACK_SKIP_IMAGES),E=e.isCompressedTexture?e.mipmaps[s]:e.image;if(o.pixelStorei(o.UNPACK_ROW_LENGTH,E.width),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,E.height),o.pixelStorei(o.UNPACK_SKIP_PIXELS,g),o.pixelStorei(o.UNPACK_SKIP_ROWS,_),e.isRenderTargetTexture||e.isDepthTexture){const M=a.get(e),b=a.get(t),C=a.get(M.renderTarget),I=a.get(b.renderTarget),U=C.framebuffers[M.cacheKey],D=I.framebuffers[b.cacheKey];l.bindFramebuffer(o.READ_FRAMEBUFFER,U),l.bindFramebuffer(o.DRAW_FRAMEBUFFER,D);let L=o.COLOR_BUFFER_BIT;e.isDepthTexture&&(L=o.DEPTH_BUFFER_BIT),o.blitFramebuffer(g,_,f,m,p,v,f,m,L,o.NEAREST),l.bindFramebuffer(o.READ_FRAMEBUFFER,null),l.bindFramebuffer(o.DRAW_FRAMEBUFFER,null)}else e.isDataTexture?o.texSubImage2D(o.TEXTURE_2D,s,p,v,f,m,d,h,E.data):e.isCompressedTexture?o.compressedTexSubImage2D(o.TEXTURE_2D,s,p,v,E.width,E.height,d,E.data):o.texSubImage2D(o.TEXTURE_2D,s,p,v,f,m,d,h,E);o.pixelStorei(o.UNPACK_ROW_LENGTH,y),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,x),o.pixelStorei(o.UNPACK_SKIP_PIXELS,S),o.pixelStorei(o.UNPACK_SKIP_ROWS,T),o.pixelStorei(o.UNPACK_SKIP_IMAGES,w),s===0&&t.generateMipmaps&&o.generateMipmap(o.TEXTURE_2D),l.unbindTexture()}copyFramebufferToTexture(e,t,i){const{gl:r}=this,{state:s}=this.backend,{textureGPU:o}=this.backend.get(e),{x:a,y:l,z:u,w:c}=i,h=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,d=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(h){const f=a!==0||l!==0;let m,g;if(e.isDepthTexture===!0?(m=r.DEPTH_BUFFER_BIT,g=r.DEPTH_ATTACHMENT,t.stencil&&(m|=r.STENCIL_BUFFER_BIT)):(m=r.COLOR_BUFFER_BIT,g=r.COLOR_ATTACHMENT0),f){const _=this.backend.get(t.renderTarget),p=_.framebuffers[t.getCacheKey()],v=_.msaaFrameBuffer;s.bindFramebuffer(r.DRAW_FRAMEBUFFER,p),s.bindFramebuffer(r.READ_FRAMEBUFFER,v);const y=d-l-c;r.blitFramebuffer(a,y,a+u,y+c,a,y,a+u,y+c,m,r.NEAREST),s.bindFramebuffer(r.READ_FRAMEBUFFER,p),s.bindTexture(r.TEXTURE_2D,o),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,a,y,u,c),s.unbindTexture()}else{const _=r.createFramebuffer();s.bindFramebuffer(r.DRAW_FRAMEBUFFER,_),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,g,r.TEXTURE_2D,o,0),r.blitFramebuffer(0,0,u,c,0,0,u,c,m,r.NEAREST),r.deleteFramebuffer(_)}}else s.bindTexture(r.TEXTURE_2D,o),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,a,d-c-l,u,c),s.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t){const{gl:i}=this,r=t.renderTarget,{samples:s,depthTexture:o,depthBuffer:a,stencilBuffer:l,width:u,height:c}=r;if(i.bindRenderbuffer(i.RENDERBUFFER,e),a&&!l){let h=i.DEPTH_COMPONENT24;s>0?(o&&o.isDepthTexture&&o.type===i.FLOAT&&(h=i.DEPTH_COMPONENT32F),i.renderbufferStorageMultisample(i.RENDERBUFFER,s,h,u,c)):i.renderbufferStorage(i.RENDERBUFFER,h,u,c),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e)}else a&&l&&(s>0?i.renderbufferStorageMultisample(i.RENDERBUFFER,s,i.DEPTH24_STENCIL8,u,c):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,u,c),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e))}async copyTextureToBuffer(e,t,i,r,s,o){const{backend:a,gl:l}=this,{textureGPU:u,glFormat:c,glType:h}=this.backend.get(e),d=l.createFramebuffer();l.bindFramebuffer(l.READ_FRAMEBUFFER,d);const f=e.isCubeTexture?l.TEXTURE_CUBE_MAP_POSITIVE_X+o:l.TEXTURE_2D;l.framebufferTexture2D(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,f,u,0);const m=this._getTypedArrayType(h),g=this._getBytesPerTexel(h,c),p=r*s*g,v=l.createBuffer();l.bindBuffer(l.PIXEL_PACK_BUFFER,v),l.bufferData(l.PIXEL_PACK_BUFFER,p,l.STREAM_READ),l.readPixels(t,i,r,s,c,h,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),await a.utils._clientWaitAsync();const y=new m(p/m.BYTES_PER_ELEMENT);return l.bindBuffer(l.PIXEL_PACK_BUFFER,v),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,y),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),l.deleteFramebuffer(d),y}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:i}=this;let r=0;if(e===i.UNSIGNED_BYTE&&(r=1),(e===i.UNSIGNED_SHORT_4_4_4_4||e===i.UNSIGNED_SHORT_5_5_5_1||e===i.UNSIGNED_SHORT_5_6_5||e===i.UNSIGNED_SHORT||e===i.HALF_FLOAT)&&(r=2),(e===i.UNSIGNED_INT||e===i.FLOAT)&&(r=4),t===i.RGBA)return r*4;if(t===i.RGB)return r*3;if(t===i.ALPHA)return r}}class tY{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class nY{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const i=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const ND={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query"};class iY{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:i,mode:r,object:s,type:o,info:a,index:l}=this;l!==0?i.drawElements(r,t,o,e):i.drawArrays(r,e,t),a.update(s,t,r,1)}renderInstances(e,t,i){const{gl:r,mode:s,type:o,index:a,object:l,info:u}=this;i!==0&&(a!==0?r.drawElementsInstanced(s,t,o,e,i):r.drawArraysInstanced(s,e,t,i),u.update(l,t,s,i))}renderMultiDraw(e,t,i){const{extensions:r,mode:s,object:o,info:a}=this;if(i===0)return;const l=r.get("WEBGL_multi_draw");if(l===null)for(let u=0;u<i;u++)this.render(e[u],t[u]);else{this.index!==0?l.multiDrawElementsWEBGL(s,t,0,this.type,e,0,i):l.multiDrawArraysWEBGL(s,e,0,t,0,i);let u=0;for(let c=0;c<i;c++)u+=t[c];a.update(o,u,s,1)}}renderMultiDrawInstances(e,t,i,r){const{extensions:s,mode:o,object:a,info:l}=this;if(i===0)return;const u=s.get("WEBGL_multi_draw");if(u===null)for(let c=0;c<i;c++)this.renderInstances(e[c],t[c],r[c]);else{this.index!==0?u.multiDrawElementsInstancedWEBGL(o,t,0,this.type,e,0,r,0,i):u.multiDrawArraysInstancedWEBGL(o,e,0,t,0,r,0,i);let c=0;for(let h=0;h<i;h++)c+=t[h]*r[h];l.update(a,c,o,1)}}}class PD extends ED{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this.trackTimestamp=e.trackTimestamp===!0,this._currentContext=null,this._knownBindings=new WeakSet}init(e){super.init(e);const t=this.parameters,i=t.context!==void 0?t.context:e.domElement.getContext("webgl2");function r(s){s.preventDefault();const o={api:"WebGL",message:s.statusMessage||"Unknown reason",reason:null,originalEvent:s};e.onDeviceLost(o)}this._onContextLost=r,e.domElement.addEventListener("webglcontextlost",r,!1),this.gl=i,this.extensions=new tY(this),this.capabilities=new nY(this),this.attributeUtils=new Qq(this),this.textureUtils=new eY(this),this.bufferRenderer=new iY(this),this.state=new Zq(this),this.utils=new Jq(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile")}get coordinateSystem(){return Vi}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async waitForGPU(){await this.utils._clientWaitAsync()}initTimestampQuery(e){if(!this.disjoint||!this.trackTimestamp)return;const t=this.get(e);if(this.queryRunning){t.queryQueue||(t.queryQueue=[]),t.queryQueue.push(e);return}t.activeQuery&&(this.gl.endQuery(this.disjoint.TIME_ELAPSED_EXT),t.activeQuery=null),t.activeQuery=this.gl.createQuery(),t.activeQuery!==null&&(this.gl.beginQuery(this.disjoint.TIME_ELAPSED_EXT,t.activeQuery),this.queryRunning=!0)}prepareTimestampBuffer(e){if(!this.disjoint||!this.trackTimestamp)return;const t=this.get(e);if(t.activeQuery&&(this.gl.endQuery(this.disjoint.TIME_ELAPSED_EXT),t.gpuQueries||(t.gpuQueries=[]),t.gpuQueries.push({query:t.activeQuery}),t.activeQuery=null,this.queryRunning=!1,t.queryQueue&&t.queryQueue.length>0)){const i=t.queryQueue.shift();this.initTimestampQuery(i)}}async resolveTimestampAsync(e,t="render"){if(!this.disjoint||!this.trackTimestamp)return;const i=this.get(e);i.gpuQueries||(i.gpuQueries=[]);for(let r=0;r<i.gpuQueries.length;r++){const s=i.gpuQueries[r],o=this.gl.getQueryParameter(s.query,this.gl.QUERY_RESULT_AVAILABLE),a=this.gl.getParameter(this.disjoint.GPU_DISJOINT_EXT);if(o&&!a){const l=this.gl.getQueryParameter(s.query,this.gl.QUERY_RESULT),u=Number(l)/1e6;this.gl.deleteQuery(s.query),i.gpuQueries.splice(r,1),r--,this.renderer.info.updateTimestamp(t,u)}}}getContext(){return this.gl}beginRender(e){const{gl:t}=this,i=this.get(e);if(this.initTimestampQuery(e),i.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1),e.viewport?this.updateViewport(e):t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),e.scissor){const{x:s,y:o,width:a,height:l}=e.scissorValue;t.scissor(s,e.height-l-o,a,l)}const r=e.occlusionQueryCount;r>0&&(i.currentOcclusionQueries=i.occlusionQueries,i.currentOcclusionQueryObjects=i.occlusionQueryObjects,i.lastOcclusionObject=null,i.occlusionQueries=new Array(r),i.occlusionQueryObjects=new Array(r),i.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:i}=this,r=this.get(e),s=r.previousContext,o=e.occlusionQueryCount;o>0&&(o>r.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const a=e.textures;if(a!==null)for(let l=0;l<a.length;l++){const u=a[l];u.generateMipmaps&&this.generateMipmaps(u)}if(this._currentContext=s,e.textures!==null&&e.renderTarget){const l=this.get(e.renderTarget),{samples:u}=e.renderTarget;if(u>0){const c=l.framebuffers[e.getCacheKey()],h=t.COLOR_BUFFER_BIT,d=l.msaaFrameBuffer,f=e.textures;i.bindFramebuffer(t.READ_FRAMEBUFFER,d),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,c);for(let m=0;m<f.length;m++)if(e.scissor){const{x:g,y:_,width:p,height:v}=e.scissorValue,y=e.height-v-_;t.blitFramebuffer(g,y,g+p,y+v,g,y,g+p,y+v,h,t.NEAREST),t.invalidateSubFramebuffer(t.READ_FRAMEBUFFER,l.invalidationArray,g,y,p,v)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,h,t.NEAREST),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,l.invalidationArray)}}s!==null&&(this._setFramebuffer(s),s.viewport?this.updateViewport(s):t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight)),this.prepareTimestampBuffer(e)}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:i,currentOcclusionQueryObjects:r}=t;if(i&&r){const s=new WeakSet,{gl:o}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const a=()=>{let l=0;for(let u=0;u<i.length;u++){const c=i[u];c!==null&&o.getQueryParameter(c,o.QUERY_RESULT_AVAILABLE)&&(o.getQueryParameter(c,o.QUERY_RESULT)>0&&s.add(r[u]),i[u]=null,o.deleteQuery(c),l++)}l<i.length?requestAnimationFrame(a):t.occluded=s};a()}}isOccluded(e,t){const i=this.get(e);return i.occluded&&i.occluded.has(t)}updateViewport(e){const t=this.gl,{x:i,y:r,width:s,height:o}=e.viewportValue;t.viewport(i,e.height-o-r,s,o)}setScissorTest(e){const t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)}clear(e,t,i,r=null,s=!0){const{gl:o}=this;if(r===null){const l=this.getClearColor();l.r*=l.a,l.g*=l.a,l.b*=l.a,r={textures:null,clearColorValue:l}}let a=0;if(e&&(a|=o.COLOR_BUFFER_BIT),t&&(a|=o.DEPTH_BUFFER_BIT),i&&(a|=o.STENCIL_BUFFER_BIT),a!==0){let l;if(r.clearColorValue?l=r.clearColorValue:(l=this.getClearColor(),l.r*=l.a,l.g*=l.a,l.b*=l.a),t&&this.state.setDepthMask(!0),r.textures===null)o.clearColor(l.r,l.g,l.b,l.a),o.clear(a);else{if(s&&this._setFramebuffer(r),e)for(let u=0;u<r.textures.length;u++)o.clearBufferfv(o.COLOR,u,[l.r,l.g,l.b,l.a]);t&&i?o.clearBufferfi(o.DEPTH_STENCIL,0,1,0):t?o.clearBufferfv(o.DEPTH,0,[1]):i&&o.clearBufferiv(o.STENCIL,0,[0])}}}beginCompute(e){const{state:t,gl:i}=this;t.bindFramebuffer(i.FRAMEBUFFER,null),this.initTimestampQuery(e)}compute(e,t,i,r){const{state:s,gl:o}=this;this.discard===!1&&(o.enable(o.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:a,transformBuffers:l,attributes:u}=this.get(r),c=this._getVaoKey(null,u),h=this.vaoCache[c];h===void 0?this._createVao(null,u):o.bindVertexArray(h),s.useProgram(a),this._bindUniforms(i);const d=this._getTransformFeedback(l);o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,d),o.beginTransformFeedback(o.POINTS),u[0].isStorageInstancedBufferAttribute?o.drawArraysInstanced(o.POINTS,0,1,t.count):o.drawArrays(o.POINTS,0,t.count),o.endTransformFeedback(),o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,null);for(let f=0;f<l.length;f++){const m=l[f];m.pbo&&this.textureUtils.copyBufferToTexture(m.transformBuffer,m.pbo),m.switchBuffers()}}finishCompute(e){const t=this.gl;this.discard=!1,t.disable(t.RASTERIZER_DISCARD),this.prepareTimestampBuffer(e),this._currentContext&&this._setFramebuffer(this._currentContext)}draw(e){const{object:t,pipeline:i,material:r,context:s,hardwareClippingPlanes:o}=e,{programGPU:a}=this.get(i),{gl:l,state:u}=this,c=this.get(s),h=e.getDrawParameters();if(h===null)return;this._bindUniforms(e.getBindings());const d=t.isMesh&&t.matrixWorld.determinant()<0;u.setMaterial(r,d,o),u.useProgram(a);const f=this.get(e);let m=f.staticVao;if(m===void 0||f.geometryId!==e.geometry.id){const S=this._getVaoKey(e.getIndex(),e.getAttributes());if(m=this.vaoCache[S],m===void 0){let T;({vaoGPU:m,staticVao:T}=this._createVao(e.getIndex(),e.getAttributes())),T&&(f.staticVao=m,f.geometryId=e.geometry.id)}}l.bindVertexArray(m);const g=e.getIndex(),_=c.lastOcclusionObject;if(_!==t&&_!==void 0){if(_!==null&&_.occlusionTest===!0&&(l.endQuery(l.ANY_SAMPLES_PASSED),c.occlusionQueryIndex++),t.occlusionTest===!0){const S=l.createQuery();l.beginQuery(l.ANY_SAMPLES_PASSED,S),c.occlusionQueries[c.occlusionQueryIndex]=S,c.occlusionQueryObjects[c.occlusionQueryIndex]=t}c.lastOcclusionObject=t}const p=this.bufferRenderer;t.isPoints?p.mode=l.POINTS:t.isLineSegments?p.mode=l.LINES:t.isLine?p.mode=l.LINE_STRIP:t.isLineLoop?p.mode=l.LINE_LOOP:r.wireframe===!0?(u.setLineWidth(r.wireframeLinewidth*this.renderer.getPixelRatio()),p.mode=l.LINES):p.mode=l.TRIANGLES;const{vertexCount:v,instanceCount:y}=h;let{firstVertex:x}=h;if(p.object=t,g!==null){x*=g.array.BYTES_PER_ELEMENT;const S=this.get(g);p.index=g.count,p.type=S.type}else p.index=0;t.isBatchedMesh?t._multiDrawInstances!==null?p.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances):this.hasFeature("WEBGL_multi_draw")?p.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):bl("THREE.WebGLRenderer: WEBGL_multi_draw not supported."):y>1?p.renderInstances(x,v,y):p.render(x,v),l.bindVertexArray(null)}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}copyTextureToBuffer(e,t,i,r,s,o){return this.textureUtils.copyTextureToBuffer(e,t,i,r,s,o)}createSampler(){}destroySampler(){}createNodeBuilder(e,t){return new qq(e,t)}createProgram(e){const t=this.gl,{stage:i,code:r}=e,s=i==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(s,r),t.compileShader(s),this.set(e,{shaderGPU:s})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const i=this.gl,r=e.pipeline,{fragmentProgram:s,vertexProgram:o}=r,a=i.createProgram(),l=this.get(s).shaderGPU,u=this.get(o).shaderGPU;if(i.attachShader(a,l),i.attachShader(a,u),i.linkProgram(a),this.set(r,{programGPU:a,fragmentShader:l,vertexShader:u}),t!==null&&this.parallel){const c=new Promise(h=>{const d=this.parallel,f=()=>{i.getProgramParameter(a,d.COMPLETION_STATUS_KHR)?(this._completeCompile(e,r),h()):requestAnimationFrame(f)};f()});t.push(c);return}this._completeCompile(e,r)}_handleSource(e,t){const i=e.split(`
`),r=[],s=Math.max(t-6,0),o=Math.min(t+6,i.length);for(let a=s;a<o;a++){const l=a+1;r.push(`${l===t?">":" "} ${l}: ${i[a]}`)}return r.join(`
`)}_getShaderErrors(e,t,i){const r=e.getShaderParameter(t,e.COMPILE_STATUS),s=e.getShaderInfoLog(t).trim();if(r&&s==="")return"";const o=/ERROR: 0:(\d+)/.exec(s);if(o){const a=parseInt(o[1]);return i.toUpperCase()+`

`+s+`

`+this._handleSource(e.getShaderSource(t),a)}else return s}_logProgramError(e,t,i){if(this.renderer.debug.checkShaderErrors){const r=this.gl,s=r.getProgramInfoLog(e).trim();if(r.getProgramParameter(e,r.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(r,e,i,t);else{const o=this._getShaderErrors(r,i,"vertex"),a=this._getShaderErrors(r,t,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(e,r.VALIDATE_STATUS)+`

Program Info Log: `+s+`
`+o+`
`+a)}else s!==""&&console.warn("THREE.WebGLProgram: Program Info Log:",s)}}_completeCompile(e,t){const{state:i,gl:r}=this,s=this.get(t),{programGPU:o,fragmentShader:a,vertexShader:l}=s;r.getProgramParameter(o,r.LINK_STATUS)===!1&&this._logProgramError(o,a,l),i.useProgram(o);const u=e.getBindings();this._setupBindings(u,o),this.set(t,{programGPU:o})}createComputePipeline(e,t){const{state:i,gl:r}=this,s={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(s);const{computeProgram:o}=e,a=r.createProgram(),l=this.get(s).shaderGPU,u=this.get(o).shaderGPU,c=o.transforms,h=[],d=[];for(let _=0;_<c.length;_++){const p=c[_];h.push(p.varyingName),d.push(p.attributeNode)}r.attachShader(a,l),r.attachShader(a,u),r.transformFeedbackVaryings(a,h,r.SEPARATE_ATTRIBS),r.linkProgram(a),r.getProgramParameter(a,r.LINK_STATUS)===!1&&this._logProgramError(a,l,u),i.useProgram(a),this._setupBindings(t,a);const f=o.attributes,m=[],g=[];for(let _=0;_<f.length;_++){const p=f[_].node.attribute;m.push(p),this.has(p)||this.attributeUtils.createAttribute(p,r.ARRAY_BUFFER)}for(let _=0;_<d.length;_++){const p=d[_].attribute;this.has(p)||this.attributeUtils.createAttribute(p,r.ARRAY_BUFFER);const v=this.get(p);g.push(v)}this.set(e,{programGPU:a,transformBuffers:g,attributes:m})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let i=0,r=0;for(const s of t){this.set(s,{textures:r,uniformBuffers:i});for(const o of s.bindings)o.isUniformBuffer&&i++,o.isSampledTexture&&r++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,i=this.get(e);let r=i.uniformBuffers,s=i.textures;for(const o of e.bindings)if(o.isUniformsGroup||o.isUniformBuffer){const a=o.buffer,l=t.createBuffer();t.bindBuffer(t.UNIFORM_BUFFER,l),t.bufferData(t.UNIFORM_BUFFER,a,t.DYNAMIC_DRAW),this.set(o,{index:r++,bufferGPU:l})}else if(o.isSampledTexture){const{textureGPU:a,glTextureType:l}=this.get(o.texture);this.set(o,{index:s++,textureGPU:a,glTextureType:l})}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const r=this.get(e).bufferGPU,s=e.buffer;t.bindBuffer(t.UNIFORM_BUFFER,r),t.bufferData(t.UNIFORM_BUFFER,s,t.DYNAMIC_DRAW)}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(ND).filter(r=>ND[r]===e),i=this.extensions;for(let r=0;r<t.length;r++)if(i.has(t[r]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,i=null,r=null,s=0){this.textureUtils.copyTextureToTexture(e,t,i,r,s)}copyFramebufferToTexture(e,t,i){this.textureUtils.copyFramebufferToTexture(e,t,i)}_setFramebuffer(e){const{gl:t,state:i}=this;let r=null;if(e.textures!==null){const s=e.renderTarget,o=this.get(s),{samples:a,depthBuffer:l,stencilBuffer:u}=s,c=s.isWebGLCubeRenderTarget===!0,h=s.isRenderTarget3D===!0,d=s.isRenderTargetArray===!0;let f=o.msaaFrameBuffer,m=o.depthRenderbuffer;const g=z2(e);let _;if(c?(o.cubeFramebuffers||(o.cubeFramebuffers={}),_=o.cubeFramebuffers[g]):(o.framebuffers||(o.framebuffers={}),_=o.framebuffers[g]),_===void 0){_=t.createFramebuffer(),i.bindFramebuffer(t.FRAMEBUFFER,_);const p=e.textures;if(c){o.cubeFramebuffers[g]=_;const{textureGPU:v}=this.get(p[0]),y=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+y,v,0)}else{o.framebuffers[g]=_;for(let v=0;v<p.length;v++){const y=p[v],x=this.get(y);x.renderTarget=e.renderTarget,x.cacheKey=g;const S=t.COLOR_ATTACHMENT0+v;if(h||d){const T=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,S,x.textureGPU,0,T)}else t.framebufferTexture2D(t.FRAMEBUFFER,S,t.TEXTURE_2D,x.textureGPU,0)}i.drawBuffers(e,_)}if(e.depthTexture!==null){const v=this.get(e.depthTexture),y=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;v.renderTarget=e.renderTarget,v.cacheKey=g,t.framebufferTexture2D(t.FRAMEBUFFER,y,t.TEXTURE_2D,v.textureGPU,0)}}if(a>0){if(f===void 0){const p=[];f=t.createFramebuffer(),i.bindFramebuffer(t.FRAMEBUFFER,f);const v=[],y=e.textures;for(let x=0;x<y.length;x++){if(v[x]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,v[x]),p.push(t.COLOR_ATTACHMENT0+x),l){const w=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;p.push(w)}const S=e.textures[x],T=this.get(S);t.renderbufferStorageMultisample(t.RENDERBUFFER,a,T.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+x,t.RENDERBUFFER,v[x])}if(o.msaaFrameBuffer=f,o.msaaRenderbuffers=v,m===void 0){m=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(m,e),o.depthRenderbuffer=m;const x=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;p.push(x)}o.invalidationArray=p}r=o.msaaFrameBuffer}else r=_}i.bindFramebuffer(t.FRAMEBUFFER,r)}_getVaoKey(e,t){let i="";if(e!==null){const r=this.get(e);i+=":"+r.id}for(let r=0;r<t.length;r++){const s=this.get(t[r]);i+=":"+s.id}return i}_createVao(e,t){const{gl:i}=this,r=i.createVertexArray();let s="",o=!0;if(i.bindVertexArray(r),e!==null){const a=this.get(e);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,a.bufferGPU),s+=":"+a.id}for(let a=0;a<t.length;a++){const l=t[a],u=this.get(l);s+=":"+u.id,i.bindBuffer(i.ARRAY_BUFFER,u.bufferGPU),i.enableVertexAttribArray(a),(l.isStorageBufferAttribute||l.isStorageInstancedBufferAttribute)&&(o=!1);let c,h;l.isInterleavedBufferAttribute===!0?(c=l.data.stride*u.bytesPerElement,h=l.offset*u.bytesPerElement):(c=0,h=0),u.isInteger?i.vertexAttribIPointer(a,l.itemSize,u.type,c,h):i.vertexAttribPointer(a,l.itemSize,u.type,l.normalized,c,h),l.isInstancedBufferAttribute&&!l.isInterleavedBufferAttribute?i.vertexAttribDivisor(a,l.meshPerAttribute):l.isInterleavedBufferAttribute&&l.data.isInstancedInterleavedBuffer&&i.vertexAttribDivisor(a,l.data.meshPerAttribute)}return i.bindBuffer(i.ARRAY_BUFFER,null),this.vaoCache[s]=r,{vaoGPU:r,staticVao:o}}_getTransformFeedback(e){let t="";for(let s=0;s<e.length;s++)t+=":"+e[s].id;let i=this.transformFeedbackCache[t];if(i!==void 0)return i;const{gl:r}=this;i=r.createTransformFeedback(),r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,i);for(let s=0;s<e.length;s++){const o=e[s];r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,s,o.transformBuffer)}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=i,i}_setupBindings(e,t){const i=this.gl;for(const r of e)for(const s of r.bindings){const a=this.get(s).index;if(s.isUniformsGroup||s.isUniformBuffer){const l=i.getUniformBlockIndex(t,s.name);i.uniformBlockBinding(t,l,a)}else if(s.isSampledTexture){const l=i.getUniformLocation(t,s.name);i.uniform1i(l,a)}}}_bindUniforms(e){const{gl:t,state:i}=this;for(const r of e)for(const s of r.bindings){const o=this.get(s),a=o.index;s.isUniformsGroup||s.isUniformBuffer?i.bindBufferBase(t.UNIFORM_BUFFER,a,o.bufferGPU):s.isSampledTexture&&i.bindTexture(o.glTextureType,o.textureGPU,t.TEXTURE0+a)}}dispose(){this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const rh={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},Jn={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},fi={Store:"store",Discard:"discard"},vn={Load:"load",Clear:"clear"},fb={CCW:"ccw",CW:"cw"},pb={None:"none",Front:"front",Back:"back"},sh={Uint16:"uint16",Uint32:"uint32"},k={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10uFloat:"rgb10a2unorm",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Stencil8:"stencil8",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},mb={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},ql={Linear:"linear",Nearest:"nearest"},qe={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDstColor:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},Yl={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},DD={None:0,Red:1,Green:2,Blue:4,Alpha:8,All:15},za={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},gb={Uniform:"uniform",Storage:"storage",ReadOnlyStorage:"read-only-storage"},_b={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},oh={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},LD={OneD:"1d",TwoD:"2d",ThreeD:"3d"},Qi={OneD:"1d",TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",CubeArray:"cube-array",ThreeD:"3d"},rY={All:"all",StencilOnly:"stencil-only",DepthOnly:"depth-only"},F_={Vertex:"vertex",Instance:"instance"},vb={DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups"};class sY extends ub{constructor(e,t){super(e),this.texture=t,this.version=t?t.version:0,this.isSampler=!0}}class oY extends sY{constructor(e,t,i){super(e,t?t.value:null),this.textureNode=t,this.groupNode=i}update(){this.texture=this.textureNode.value}}class aY extends vD{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let lY=0;class uY extends aY{constructor(e,t){super("StorageBuffer_"+lY++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:Ao.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class cY extends Oa{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,i=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,r=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:ql.Linear}),this.flipYSampler=e.createSampler({minFilter:ql.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:t}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:i}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:r})}getTransferPipeline(e){let t=this.transferPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:rh.TriangleStrip,stripIndexFormat:sh.Uint32},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:rh.TriangleStrip,stripIndexFormat:sh.Uint32},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,i=0){const r=t.format,{width:s,height:o}=t.size,a=this.getTransferPipeline(r),l=this.getFlipYPipeline(r),u=this.device.createTexture({size:{width:s,height:o,depthOrArrayLayers:1},format:r,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),c=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Qi.TwoD,baseArrayLayer:i}),h=u.createView({baseMipLevel:0,mipLevelCount:1,dimension:Qi.TwoD,baseArrayLayer:0}),d=this.device.createCommandEncoder({}),f=(m,g,_)=>{const p=m.getBindGroupLayout(0),v=this.device.createBindGroup({layout:p,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:g}]}),y=d.beginRenderPass({colorAttachments:[{view:_,loadOp:vn.Clear,storeOp:fi.Store,clearValue:[0,0,0,0]}]});y.setPipeline(m),y.setBindGroup(0,v),y.draw(4,1,0,0),y.end()};f(a,c,h),f(l,h,c),this.device.queue.submit([d.finish()]),u.destroy()}generateMipmaps(e,t,i=0){const r=this.get(e);r.useCount===void 0&&(r.useCount=0,r.layers=[]);const s=r.layers[i]||this._mipmapCreateBundles(e,t,i),o=this.device.createCommandEncoder({});this._mipmapRunBundles(o,s),this.device.queue.submit([o.finish()]),r.useCount!==0&&(r.layers[i]=s),r.useCount++}_mipmapCreateBundles(e,t,i){const r=this.getTransferPipeline(t.format),s=r.getBindGroupLayout(0);let o=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Qi.TwoD,baseArrayLayer:i});const a=[];for(let l=1;l<t.mipLevelCount;l++){const u=this.device.createBindGroup({layout:s,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:o}]}),c=e.createView({baseMipLevel:l,mipLevelCount:1,dimension:Qi.TwoD,baseArrayLayer:i}),h={colorAttachments:[{view:c,loadOp:vn.Clear,storeOp:fi.Store,clearValue:[0,0,0,0]}]},d=this.device.createRenderBundleEncoder({colorFormats:[t.format]});d.setPipeline(r),d.setBindGroup(0,u),d.draw(4,1,0,0),a.push({renderBundles:[d.finish()],passDescriptor:h}),o=c}return a}_mipmapRunBundles(e,t){const i=t.length;for(let r=0;r<i;r++){const s=t[r],o=e.beginRenderPass(s.passDescriptor);o.executeBundles(s.renderBundles),o.end()}}}const hY={[nx]:"never",[Om]:"less",[ix]:"equal",[Bm]:"less-equal",[rx]:"greater",[ox]:"greater-equal",[ax]:"always",[sx]:"not-equal"},dY=[0,1,3,2,4,5];class fY{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new Aa,this.depthTexture.name="depthBuffer"}createSampler(e){const t=this.backend,i=t.device,r=t.get(e),s={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};s.magFilter===ql.Linear&&s.minFilter===ql.Linear&&s.mipmapFilter===ql.Linear&&(s.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(s.compare=hY[e.compareFunction]),r.sampler=i.createSampler(s)}createDefaultTexture(e){let t;const i=yb(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(i):e.isVideoTexture?this.backend.get(e).externalTexture=this._getDefaultVideoFrame():t=this._getDefaultTextureGPU(i),this.backend.get(e).texture=t}createTexture(e,t={}){const i=this.backend,r=i.get(e);if(r.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:s,height:o,depth:a,levels:l}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const u=this._getDimension(e),c=e.internalFormat||t.format||yb(e,i.device);r.format=c;const{samples:h,primarySamples:d,isMSAA:f}=i.utils.getTextureSampleData(e);let m=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(m|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&(m|=GPUTextureUsage.RENDER_ATTACHMENT);const g={label:e.name,size:{width:s,height:o,depthOrArrayLayers:a},mipLevelCount:l,sampleCount:d,dimension:u,format:c,usage:m};if(e.isVideoTexture){const _=e.source.data,p=new VideoFrame(_);g.size.width=p.displayWidth,g.size.height=p.displayHeight,p.close(),r.externalTexture=_}else{if(c===void 0)return console.warn("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);r.texture=i.device.createTexture(g)}if(f){const _=Object.assign({},g);_.label=_.label+"-msaa",_.sampleCount=h,r.msaaTexture=i.device.createTexture(_)}r.initialized=!0,r.textureDescriptorGPU=g}destroyTexture(e){const t=this.backend,i=t.get(e);i.texture!==void 0&&i.texture.destroy(),i.msaaTexture!==void 0&&i.msaaTexture.destroy(),t.delete(e)}destroySampler(e){const i=this.backend.get(e);delete i.sampler}generateMipmaps(e){const t=this.backend.get(e);if(e.isCubeTexture)for(let i=0;i<6;i++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,i);else{const i=e.image.depth||1;for(let r=0;r<i;r++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,r)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const e=this.backend,{width:t,height:i}=e.getDrawingBufferSize();return this.colorBuffer=e.device.createTexture({label:"colorBuffer",size:{width:t,height:i,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.samples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(e=!0,t=!1){const i=this.backend,{width:r,height:s}=i.getDrawingBufferSize(),o=this.depthTexture,a=i.get(o).texture;let l,u;if(t?(l=Ns,u=Cs):e&&(l=Rs,u=rn),a!==void 0){if(o.image.width===r&&o.image.height===s&&o.format===l&&o.type===u)return a;this.destroyTexture(o)}return o.name="depthBuffer",o.format=l,o.type=u,o.image.width=r,o.image.height=s,this.createTexture(o,{width:r,height:s}),i.get(o).texture}updateTexture(e,t){const i=this.backend.get(e),{textureDescriptorGPU:r}=i;if(!(e.isRenderTargetTexture||r===void 0)){if(e.isDataTexture)this._copyBufferToTexture(t.image,i.texture,r,0,e.flipY);else if(e.isDataArrayTexture||e.isData3DTexture)for(let s=0;s<t.image.depth;s++)this._copyBufferToTexture(t.image,i.texture,r,s,e.flipY,s);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,i.texture,r);else if(e.isCubeTexture)this._copyCubeMapToTexture(t.images,i.texture,r,e.flipY);else if(e.isVideoTexture){const s=e.source.data;i.externalTexture=s}else this._copyImageToTexture(t.image,i.texture,r,0,e.flipY);i.version=e.version,e.onUpdate&&e.onUpdate(e)}}async copyTextureToBuffer(e,t,i,r,s,o){const a=this.backend.device,l=this.backend.get(e),u=l.texture,c=l.textureDescriptorGPU.format,h=this._getBytesPerTexel(c);let d=r*h;d=Math.ceil(d/256)*256;const f=a.createBuffer({size:r*s*h,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),m=a.createCommandEncoder();m.copyTextureToBuffer({texture:u,origin:{x:t,y:i,z:o}},{buffer:f,bytesPerRow:d},{width:r,height:s});const g=this._getTypedArrayType(c);a.queue.submit([m.finish()]),await f.mapAsync(GPUMapMode.READ);const _=f.getMappedRange();return new g(_)}_isEnvironmentTexture(e){const t=e.mapping;return t===pa||t===ma||t===Br||t===kr}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const i=new Tn;i.minFilter=Vt,i.magFilter=Vt,this.createTexture(i,{width:1,height:1,format:e}),this.defaultTexture[e]=t=i}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const i=new og;i.minFilter=Vt,i.magFilter=Vt,this.createTexture(i,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=i}return this.backend.get(t).texture}_getDefaultVideoFrame(){let e=this.defaultVideoFrame;if(e===null){const t={timestamp:0,codedWidth:1,codedHeight:1,format:"RGBA"};this.defaultVideoFrame=e=new VideoFrame(new Uint8Array([0,0,0,255]),t)}return e}_copyCubeMapToTexture(e,t,i,r){for(let s=0;s<6;s++){const o=e[s],a=r===!0?dY[s]:s;o.isDataTexture?this._copyBufferToTexture(o.image,t,i,a,r):this._copyImageToTexture(o,t,i,a,r)}}_copyImageToTexture(e,t,i,r,s){this.backend.device.queue.copyExternalImageToTexture({source:e},{texture:t,mipLevel:0,origin:{x:0,y:0,z:r}},{width:e.width,height:e.height,depthOrArrayLayers:1}),s===!0&&this._flipY(t,i,r)}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new cY(this.backend.device)),e}_generateMipmaps(e,t,i=0){this._getPassUtils().generateMipmaps(e,t,i)}_flipY(e,t,i=0){this._getPassUtils().flipY(e,t,i)}_copyBufferToTexture(e,t,i,r,s,o=0){const a=this.backend.device,l=e.data,u=this._getBytesPerTexel(i.format),c=e.width*u;a.queue.writeTexture({texture:t,mipLevel:0,origin:{x:0,y:0,z:r}},l,{offset:e.width*e.height*u*o,bytesPerRow:c},{width:e.width,height:e.height,depthOrArrayLayers:1}),s===!0&&this._flipY(t,i,r)}_copyCompressedBufferToTexture(e,t,i){const r=this.backend.device,s=this._getBlockData(i.format),o=i.size.depthOrArrayLayers>1;for(let a=0;a<e.length;a++){const l=e[a],u=l.width,c=l.height,h=o?i.size.depthOrArrayLayers:1,d=Math.ceil(u/s.width)*s.byteLength,f=d*Math.ceil(c/s.height);for(let m=0;m<h;m++)r.queue.writeTexture({texture:t,mipLevel:a,origin:{x:0,y:0,z:m}},l.data,{offset:m*f,bytesPerRow:d,rowsPerImage:Math.ceil(c/s.height)},{width:Math.ceil(u/s.width)*s.width,height:Math.ceil(c/s.height)*s.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===k.BC1RGBAUnorm||e===k.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===k.BC2RGBAUnorm||e===k.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===k.BC3RGBAUnorm||e===k.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===k.BC4RUnorm||e===k.BC4RSNorm)return{byteLength:8,width:4,height:4};if(e===k.BC5RGUnorm||e===k.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===k.BC6HRGBUFloat||e===k.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===k.BC7RGBAUnorm||e===k.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===k.ETC2RGB8Unorm||e===k.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===k.ETC2RGB8A1Unorm||e===k.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===k.ETC2RGBA8Unorm||e===k.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===k.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===k.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===k.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===k.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===k.ASTC4x4Unorm||e===k.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===k.ASTC5x4Unorm||e===k.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===k.ASTC5x5Unorm||e===k.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===k.ASTC6x5Unorm||e===k.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===k.ASTC6x6Unorm||e===k.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===k.ASTC8x5Unorm||e===k.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===k.ASTC8x6Unorm||e===k.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===k.ASTC8x8Unorm||e===k.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===k.ASTC10x5Unorm||e===k.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===k.ASTC10x6Unorm||e===k.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===k.ASTC10x8Unorm||e===k.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===k.ASTC10x10Unorm||e===k.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===k.ASTC12x10Unorm||e===k.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===k.ASTC12x12Unorm||e===k.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=mb.ClampToEdge;return e===ml?t=mb.Repeat:e===gl&&(t=mb.MirrorRepeat),t}_convertFilterMode(e){let t=ql.Linear;return(e===Vt||e===Dm||e===As)&&(t=ql.Nearest),t}_getBytesPerTexel(e){if(e===k.R8Unorm||e===k.R8Snorm||e===k.R8Uint||e===k.R8Sint)return 1;if(e===k.R16Uint||e===k.R16Sint||e===k.R16Float||e===k.RG8Unorm||e===k.RG8Snorm||e===k.RG8Uint||e===k.RG8Sint)return 2;if(e===k.R32Uint||e===k.R32Sint||e===k.R32Float||e===k.RG16Uint||e===k.RG16Sint||e===k.RG16Float||e===k.RGBA8Unorm||e===k.RGBA8UnormSRGB||e===k.RGBA8Snorm||e===k.RGBA8Uint||e===k.RGBA8Sint||e===k.BGRA8Unorm||e===k.BGRA8UnormSRGB||e===k.RGB9E5UFloat||e===k.RGB10A2Unorm||e===k.RG11B10UFloat||e===k.Depth32Float||e===k.Depth24Plus||e===k.Depth24PlusStencil8||e===k.Depth32FloatStencil8)return 4;if(e===k.RG32Uint||e===k.RG32Sint||e===k.RG32Float||e===k.RGBA16Uint||e===k.RGBA16Sint||e===k.RGBA16Float)return 8;if(e===k.RGBA32Uint||e===k.RGBA32Sint||e===k.RGBA32Float)return 16}_getTypedArrayType(e){if(e===k.R8Uint)return Uint8Array;if(e===k.R8Sint)return Int8Array;if(e===k.R8Unorm)return Uint8Array;if(e===k.R8Snorm)return Int8Array;if(e===k.RG8Uint)return Uint8Array;if(e===k.RG8Sint)return Int8Array;if(e===k.RG8Unorm)return Uint8Array;if(e===k.RG8Snorm)return Int8Array;if(e===k.RGBA8Uint)return Uint8Array;if(e===k.RGBA8Sint)return Int8Array;if(e===k.RGBA8Unorm)return Uint8Array;if(e===k.RGBA8Snorm)return Int8Array;if(e===k.R16Uint)return Uint16Array;if(e===k.R16Sint)return Int16Array;if(e===k.RG16Uint)return Uint16Array;if(e===k.RG16Sint)return Int16Array;if(e===k.RGBA16Uint)return Uint16Array;if(e===k.RGBA16Sint)return Int16Array;if(e===k.R16Float||e===k.RG16Float||e===k.RGBA16Float)return Uint16Array;if(e===k.R32Uint)return Uint32Array;if(e===k.R32Sint)return Int32Array;if(e===k.R32Float)return Float32Array;if(e===k.RG32Uint)return Uint32Array;if(e===k.RG32Sint)return Int32Array;if(e===k.RG32Float)return Float32Array;if(e===k.RGBA32Uint)return Uint32Array;if(e===k.RGBA32Sint)return Int32Array;if(e===k.RGBA32Float)return Float32Array;if(e===k.BGRA8Unorm||e===k.BGRA8UnormSRGB)return Uint8Array;if(e===k.RGB10A2Unorm||e===k.RGB9E5UFloat||e===k.RG11B10UFloat)return Uint32Array;if(e===k.Depth32Float)return Float32Array;if(e===k.Depth24Plus||e===k.Depth24PlusStencil8)return Uint32Array;if(e===k.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.isData3DTexture?t=LD.ThreeD:t=LD.TwoD,t}}function yb(n,e=null){const t=n.format,i=n.type,r=n.colorSpace;let s;if(n.isCompressedTexture===!0||n.isCompressedArrayTexture===!0)switch(t){case ga:s=r===Be?k.BC1RGBAUnormSRGB:k.BC1RGBAUnorm;break;case _a:s=r===Be?k.BC2RGBAUnormSRGB:k.BC2RGBAUnorm;break;case va:s=r===Be?k.BC3RGBAUnormSRGB:k.BC3RGBAUnorm;break;case Yu:s=r===Be?k.ETC2RGB8UnormSRGB:k.ETC2RGB8Unorm;break;case Ku:s=r===Be?k.ETC2RGBA8UnormSRGB:k.ETC2RGBA8Unorm;break;case Qu:s=r===Be?k.ASTC4x4UnormSRGB:k.ASTC4x4Unorm;break;case Zu:s=r===Be?k.ASTC5x4UnormSRGB:k.ASTC5x4Unorm;break;case Ju:s=r===Be?k.ASTC5x5UnormSRGB:k.ASTC5x5Unorm;break;case ec:s=r===Be?k.ASTC6x5UnormSRGB:k.ASTC6x5Unorm;break;case tc:s=r===Be?k.ASTC6x6UnormSRGB:k.ASTC6x6Unorm;break;case nc:s=r===Be?k.ASTC8x5UnormSRGB:k.ASTC8x5Unorm;break;case ic:s=r===Be?k.ASTC8x6UnormSRGB:k.ASTC8x6Unorm;break;case rc:s=r===Be?k.ASTC8x8UnormSRGB:k.ASTC8x8Unorm;break;case sc:s=r===Be?k.ASTC10x5UnormSRGB:k.ASTC10x5Unorm;break;case oc:s=r===Be?k.ASTC10x6UnormSRGB:k.ASTC10x6Unorm;break;case ac:s=r===Be?k.ASTC10x8UnormSRGB:k.ASTC10x8Unorm;break;case lc:s=r===Be?k.ASTC10x10UnormSRGB:k.ASTC10x10Unorm;break;case uc:s=r===Be?k.ASTC12x10UnormSRGB:k.ASTC12x10Unorm;break;case cc:s=r===Be?k.ASTC12x12UnormSRGB:k.ASTC12x12Unorm;break;case Kn:s=r===Be?k.RGBA8UnormSRGB:k.RGBA8Unorm;break;default:console.error("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case Kn:switch(i){case _l:s=k.RGBA8Snorm;break;case vl:s=k.RGBA16Sint;break;case rs:s=k.RGBA16Uint;break;case rn:s=k.RGBA32Uint;break;case Hn:s=k.RGBA32Sint;break;case oi:s=r===Be?k.RGBA8UnormSRGB:k.RGBA8Unorm;break;case wi:s=k.RGBA16Float;break;case mn:s=k.RGBA32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",i)}break;case Ed:switch(i){case Um:s=k.RGB9E5UFloat;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",i)}break;case Ad:switch(i){case _l:s=k.R8Snorm;break;case vl:s=k.R16Sint;break;case rs:s=k.R16Uint;break;case rn:s=k.R32Uint;break;case Hn:s=k.R32Sint;break;case oi:s=k.R8Unorm;break;case wi:s=k.R16Float;break;case mn:s=k.R32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",i)}break;case yl:switch(i){case _l:s=k.RG8Snorm;break;case vl:s=k.RG16Sint;break;case rs:s=k.RG16Uint;break;case rn:s=k.RG32Uint;break;case Hn:s=k.RG32Sint;break;case oi:s=k.RG8Unorm;break;case wi:s=k.RG16Float;break;case mn:s=k.RG32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",i)}break;case Rs:switch(i){case rs:s=k.Depth16Unorm;break;case rn:s=k.Depth24Plus;break;case mn:s=k.Depth32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",i)}break;case Ns:switch(i){case Cs:s=k.Depth24PlusStencil8;break;case mn:e&&e.features.has(vb.Depth32FloatStencil8)===!1&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),s=k.Depth32FloatStencil8;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",i)}break;case ju:switch(i){case Hn:s=k.R32Sint;break;case rn:s=k.R32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",i)}break;case Xu:switch(i){case Hn:s=k.RG32Sint;break;case rn:s=k.RG32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",i)}break;case qu:switch(i){case Hn:s=k.RGBA32Sint;break;case rn:s=k.RGBA32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",i)}break;default:console.error("WebGPURenderer: Unsupported texture format.",t)}return s}const pY=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,mY=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,ID={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},gY=n=>{n=n.trim();const e=n.match(pY);if(e!==null&&e.length===4){const t=e[2],i=[];let r=null;for(;(r=mY.exec(t))!==null;)i.push({name:r[1],type:r[2]});const s=[];for(let c=0;c<i.length;c++){const{name:h,type:d}=i[c];let f=d;f.startsWith("ptr")?f="pointer":(f.startsWith("texture")&&(f=d.split("<")[0]),f=ID[f]),s.push(new ib(f,h))}const o=n.substring(e[0].length),a=e[3]||"void",l=e[1]!==void 0?e[1]:"";return{type:ID[a]||a,inputs:s,name:l,inputsCode:t,blockCode:o,outputType:a}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class _Y extends sb{constructor(e){const{type:t,inputs:i,name:r,inputsCode:s,blockCode:o,outputType:a}=gY(e);super(t,i,r),this.inputsCode=s,this.blockCode=o,this.outputType=a}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class vY extends fD{parseFunction(e){return new _Y(e)}}const ah=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},yY={[Ao.READ_ONLY]:"read",[Ao.WRITE_ONLY]:"write",[Ao.READ_WRITE]:"read_write"},UD={[ml]:"repeat",[Es]:"clamp",[gl]:"mirror"},O_={vertex:ah?ah.VERTEX:1,fragment:ah?ah.FRAGMENT:2,compute:ah?ah.COMPUTE:4},FD={instance:!0,swizzleAssign:!1,storageBuffer:!0},xY={"^^":"tsl_xor"},SY={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},OD={},$r={tsl_xor:new Bn("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new Bn("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new Bn("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new Bn("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new Bn("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new Bn("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new Bn("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new Bn("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new Bn("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new Bn("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new Bn("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new Bn("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new Bn(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},$f={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};typeof navigator<"u"&&/Windows/g.test(navigator.userAgent)&&($r.pow_float=new Bn("fn tsl_pow_float( a : f32, b : f32 ) -> f32 { return select( -pow( -a, b ), pow( a, b ), a > 0.0 ); }"),$r.pow_vec2=new Bn("fn tsl_pow_vec2( a : vec2f, b : vec2f ) -> vec2f { return vec2f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ) ); }",[$r.pow_float]),$r.pow_vec3=new Bn("fn tsl_pow_vec3( a : vec3f, b : vec3f ) -> vec3f { return vec3f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ) ); }",[$r.pow_float]),$r.pow_vec4=new Bn("fn tsl_pow_vec4( a : vec4f, b : vec4f ) -> vec4f { return vec4f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ), tsl_pow_float( a.w, b.w ) ); }",[$r.pow_float]),$f.pow_float="tsl_pow_float",$f.pow_vec2="tsl_pow_vec2",$f.pow_vec3="tsl_pow_vec3",$f.pow_vec4="tsl_pow_vec4");let BD="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(BD+=`diagnostic( off, derivative_uniformity );
`);class TY extends cD{constructor(e,t){super(e,t,new vY),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==pr}_generateTextureSample(e,t,i,r,s=this.shaderStage){return s==="fragment"?r?`textureSample( ${t}, ${t}_sampler, ${i}, ${r} )`:`textureSample( ${t}, ${t}_sampler, ${i} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,i):this.generateTextureLod(e,t,i,r,"0")}_generateVideoSample(e,t,i=this.shaderStage){if(i==="fragment")return`textureSampleBaseClampToEdge( ${e}, ${e}_sampler, vec2<f32>( ${t}.x, 1.0 - ${t}.y ) )`;console.error(`WebGPURenderer: THREE.VideoTexture does not support ${i} shader.`)}_generateTextureSampleLevel(e,t,i,r,s,o=this.shaderStage){return(o==="fragment"||o==="compute")&&this.isUnfilterable(e)===!1?`textureSampleLevel( ${t}, ${t}_sampler, ${i}, ${r} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,i,r):this.generateTextureLod(e,t,i,s,r)}generateWrapFunction(e){const t=`tsl_coord_${UD[e.wrapS]}S_${UD[e.wrapT]}_${e.isData3DTexture?"3d":"2d"}T`;let i=OD[t];if(i===void 0){const r=[],s=e.isData3DTexture?"vec3f":"vec2f";let o=`fn ${t}( coord : ${s} ) -> ${s} {

	return ${s}(
`;const a=(l,u)=>{l===ml?(r.push($r.repeatWrapping_float),o+=`		tsl_repeatWrapping_float( coord.${u} )`):l===Es?(r.push($r.clampWrapping_float),o+=`		tsl_clampWrapping_float( coord.${u} )`):l===gl?(r.push($r.mirrorWrapping_float),o+=`		tsl_mirrorWrapping_float( coord.${u} )`):(o+=`		coord.${u}`,console.warn(`WebGPURenderer: Unsupported texture wrap type "${l}" for vertex shader.`))};a(e.wrapS,"x"),o+=`,
`,a(e.wrapT,"y"),e.isData3DTexture&&(o+=`,
`,a(e.wrapR,"z")),o+=`
	);

}
`,OD[t]=i=new Bn(o,r)}return i.build(this),t}generateTextureDimension(e,t,i){const r=this.getDataFromNode(e,this.shaderStage,this.globalCache);r.dimensionsSnippet===void 0&&(r.dimensionsSnippet={});let s=r.dimensionsSnippet[i];if(r.dimensionsSnippet[i]===void 0){let o,a;const{primarySamples:l}=this.renderer.backend.utils.getTextureSampleData(e),u=l>1;e.isData3DTexture?a="vec3<u32>":a="vec2<u32>",u||e.isVideoTexture||e.isStorageTexture?o=t:o=`${t}${i?`, u32( ${i} )`:""}`,s=new c_(new f_(`textureDimensions( ${o} )`,a)),r.dimensionsSnippet[i]=s,(e.isDataArrayTexture||e.isData3DTexture)&&(r.arrayLayerCount=new c_(new f_(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(r.cubeFaceCount=new c_(new f_("6u","u32")))}return s.build(this)}generateFilteredTexture(e,t,i,r="0u"){this._include("biquadraticTexture");const s=this.generateWrapFunction(e),o=this.generateTextureDimension(e,t,r);return`tsl_biquadraticTexture( ${t}, ${s}( ${i} ), ${o}, u32( ${r} ) )`}generateTextureLod(e,t,i,r,s="0u"){const o=this.generateWrapFunction(e),a=this.generateTextureDimension(e,t,s),l=e.isData3DTexture?"vec3":"vec2",u=`${l}<u32>(${o}(${i}) * ${l}<f32>(${a}))`;return this.generateTextureLoad(e,t,u,r,s)}generateTextureLoad(e,t,i,r,s="0u"){return e.isVideoTexture===!0||e.isStorageTexture===!0?`textureLoad( ${t}, ${i} )`:r?`textureLoad( ${t}, ${i}, ${r}, u32( ${s} ) )`:`textureLoad( ${t}, ${i}, u32( ${s} ) )`}generateTextureStore(e,t,i,r){return`textureStore( ${t}, ${i}, ${r} )`}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===mn||this.isSampleCompare(e)===!1&&e.minFilter===Vt&&e.magFilter===Vt||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,i,r,s=this.shaderStage){let o=null;return e.isVideoTexture===!0?o=this._generateVideoSample(t,i,s):this.isUnfilterable(e)?o=this.generateTextureLod(e,t,i,r,"0",s):o=this._generateTextureSample(e,t,i,r,s),o}generateTextureGrad(e,t,i,r,s,o=this.shaderStage){if(o==="fragment")return`textureSampleGrad( ${t}, ${t}_sampler, ${i},  ${r[0]}, ${r[1]} )`;console.error(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${o} shader.`)}generateTextureCompare(e,t,i,r,s,o=this.shaderStage){if(o==="fragment")return`textureSampleCompare( ${t}, ${t}_sampler, ${i}, ${r} )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}generateTextureLevel(e,t,i,r,s,o=this.shaderStage){let a=null;return e.isVideoTexture===!0?a=this._generateVideoSample(t,i,o):a=this._generateTextureSampleLevel(e,t,i,r,s,o),a}generateTextureBias(e,t,i,r,s,o=this.shaderStage){if(o==="fragment")return`textureSampleBias( ${t}, ${t}_sampler, ${i}, ${r} )`;console.error(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${o} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const i=e.name,r=e.type;return r==="texture"||r==="cubeTexture"||r==="storageTexture"||r==="texture3D"?i:r==="buffer"||r==="storageBuffer"||r==="indirectStorageBuffer"?`NodeBuffer_${e.id}.${i}`:e.groupNode.name+"."+i}return super.getPropertyName(e)}getOutputStructName(){return"output"}_getUniformGroupCount(e){return Object.keys(this.uniforms[e]).length}getFunctionOperator(e){const t=xY[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?Ao.READ_ONLY:e.access}getStorageAccess(e,t){return yY[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,i,r=null){const s=super.getUniformFromNode(e,t,i,r),o=this.getDataFromNode(e,i,this.globalCache);if(o.uniformGPU===void 0){let a;const l=e.groupNode,u=l.name,c=this.getBindGroupArray(u,i);if(t==="texture"||t==="cubeTexture"||t==="storageTexture"||t==="texture3D"){let h=null;const d=this.getNodeAccess(e,i);if(t==="texture"||t==="storageTexture"?h=new I_(s.name,s.node,l,d):t==="cubeTexture"?h=new TD(s.name,s.node,l,d):t==="texture3D"&&(h=new bD(s.name,s.node,l,d)),h.store=e.isStorageTextureNode===!0,h.setVisibility(O_[i]),(i==="fragment"||i==="compute")&&this.isUnfilterable(e.value)===!1&&h.store===!1){const f=new oY(`${s.name}_sampler`,s.node,l);f.setVisibility(O_[i]),c.push(f,h),a=[f,h]}else c.push(h),a=[h]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const h=t==="buffer"?xD:uY,d=new h(e,l);d.setVisibility(O_[i]),c.push(d),a=d}else{const h=this.uniformGroups[i]||(this.uniformGroups[i]={});let d=h[u];d===void 0&&(d=new SD(u,l),d.setVisibility(O_[i]),h[u]=d,c.push(d)),a=this.getNodeUniform(s,t),d.addUniform(a)}o.uniformGPU=a}return s}getBuiltin(e,t,i,r=this.shaderStage){const s=this.builtins[r]||(this.builtins[r]=new Map);return s.has(e)===!1&&s.set(e,{name:e,property:t,type:i}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,i=this.flowShaderNode(e),r=[];for(const o of t.inputs)r.push(o.name+" : "+this.getType(o.type));let s=`fn ${t.name}( ${r.join(", ")} ) -> ${this.getType(t.type)} {
${i.vars}
${i.code}
`;return i.result&&(s+=`	return ${i.result};
`),s+=`
}
`,s}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],i=this.directives[e];if(i!==void 0)for(const r of i)t.push(`enable ${r};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],i=this.builtins[e];if(i!==void 0)for(const{name:r,property:s,type:o}of i.values())t.push(`@builtin( ${r} ) ${s} : ${o}`);return t.join(`,
	`)}getScopedArray(e,t,i,r){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:i,bufferCount:r}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:i,scope:r,bufferType:s,bufferCount:o}of this.scopedArrays.values()){const a=this.getType(s);t.push(`var<${r}> ${i}: array< ${a}, ${o} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","id","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const i=this.getBuiltins("attribute");i&&t.push(i);const r=this.getAttributesArray();for(let s=0,o=r.length;s<o;s++){const a=r[s],l=a.name,u=this.getType(a.type);t.push(`@location( ${s} ) ${l} : ${u}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[],i=e.getMemberTypes();for(let s=0;s<i.length;s++){const o=i[s];t.push(`	@location( ${s} ) m${s} : ${o}<f32>`)}const r=this.getBuiltins("output");return r&&t.push("	"+r),t.join(`,
`)}getStructs(e){const t=[],i=this.structs[e];for(let r=0,s=i.length;r<s;r++){const o=i[r],a=o.name;let l=`struct ${a} {
`;l+=this.getStructMembers(o),l+=`
}`,t.push(l),t.push(`
var<private> output : ${a};

`)}return t.join(`

`)}getVar(e,t){return`var ${t} : ${this.getType(e)}`}getVars(e){const t=[],i=this.vars[e];if(i!==void 0)for(const r of i)t.push(`	${this.getVar(r.type,r.name)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const s=this.varyings,o=this.vars[e];for(let a=0;a<s.length;a++){const l=s[a];if(l.needsInterpolation){let u=`@location( ${a} )`;/^(int|uint|ivec|uvec)/.test(l.type)&&(u+=" @interpolate( flat )"),t.push(`${u} ${l.name} : ${this.getType(l.type)}`)}else e==="vertex"&&o.includes(l)===!1&&o.push(l)}}const i=this.getBuiltins(e);i&&t.push(i);const r=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+r):r}getUniforms(e){const t=this.uniforms[e],i=[],r=[],s=[],o={};for(const l of t){const u=l.groupNode.name,c=this.bindingsIndexes[u];if(l.type==="texture"||l.type==="cubeTexture"||l.type==="storageTexture"||l.type==="texture3D"){const h=l.node.value;(e==="fragment"||e==="compute")&&this.isUnfilterable(h)===!1&&l.node.isStorageTextureNode!==!0&&(this.isSampleCompare(h)?i.push(`@binding( ${c.binding++} ) @group( ${c.group} ) var ${l.name}_sampler : sampler_comparison;`):i.push(`@binding( ${c.binding++} ) @group( ${c.group} ) var ${l.name}_sampler : sampler;`));let d,f="";const{primarySamples:m}=this.renderer.backend.utils.getTextureSampleData(h);if(m>1&&(f="_multisampled"),h.isCubeTexture===!0)d="texture_cube<f32>";else if(h.isDataArrayTexture===!0||h.isCompressedArrayTexture===!0)d="texture_2d_array<f32>";else if(h.isDepthTexture===!0)d=`texture_depth${f}_2d`;else if(h.isVideoTexture===!0)d="texture_external";else if(h.isData3DTexture===!0)d="texture_3d<f32>";else if(l.node.isStorageTextureNode===!0){const g=yb(h),_=this.getStorageAccess(l.node,e);d=`texture_storage_2d<${g}, ${_}>`}else{const g=this.getComponentTypeFromTexture(h).charAt(0);d=`texture${f}_2d<${g}32>`}i.push(`@binding( ${c.binding++} ) @group( ${c.group} ) var ${l.name} : ${d};`)}else if(l.type==="buffer"||l.type==="storageBuffer"||l.type==="indirectStorageBuffer"){const h=l.node,d=this.getType(h.bufferType),f=h.bufferCount,m=f>0&&l.type==="buffer"?", "+f:"",g=h.isAtomic?`atomic<${d}>`:`${d}`,_=`	${l.name} : array< ${g}${m} >
`,p=h.isStorageBufferNode?`storage, ${this.getStorageAccess(h,e)}`:"uniform";r.push(this._getWGSLStructBinding("NodeBuffer_"+h.id,_,p,c.binding++,c.group))}else{const h=this.getType(this.getVectorType(l.type)),d=l.groupNode.name;(o[d]||(o[d]={index:c.binding++,id:c.group,snippets:[]})).snippets.push(`	${l.name} : ${h}`)}}for(const l in o){const u=o[l];s.push(this._getWGSLStructBinding(l,u.snippets.join(`,
`),"uniform",u.index,u.id))}let a=i.join(`
`);return a+=r.join(`
`),a+=s.join(`
`),a}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){const i=e[t];i.uniforms=this.getUniforms(t),i.attributes=this.getAttributes(t),i.varyings=this.getVaryings(t),i.structs=this.getStructs(t),i.vars=this.getVars(t),i.codes=this.getCodes(t),i.directives=this.getDirectives(t),i.scopedArrays=this.getScopedArrays(t);let r=`// code

`;r+=this.flowCode[t];const s=this.flowNodes[t],o=s[s.length-1],a=o.outputNode,l=a!==void 0&&a.isOutputStructNode===!0;for(const u of s){const c=this.getFlowData(u),h=u.name;if(h&&(r.length>0&&(r+=`
`),r+=`	// flow -> ${h}
	`),r+=`${c.code}
	`,u===o&&t!=="compute"){if(r+=`// result

	`,t==="vertex")r+=`varyings.Vertex = ${c.result};`;else if(t==="fragment")if(l)i.returnType=a.nodeType,r+=`return ${c.result};`;else{let d="	@location(0) color: vec4<f32>";const f=this.getBuiltins("output");f&&(d+=`,
	`+f),i.returnType="OutputStruct",i.structs+=this._getWGSLStruct("OutputStruct",d),i.structs+=`
var<private> output : OutputStruct;

`,r+=`output.color = ${c.result};

	return output;`}}}i.flow=r}this.material!==null?(this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment)):this.computeShader=this._getWGSLComputeCode(e.compute,(this.object.workgroupSize||[64]).join(", "))}getMethod(e,t=null){let i;return t!==null&&(i=this._getWGSLMethod(e+"_"+t)),i===void 0&&(i=this._getWGSLMethod(e)),i||e}getType(e){return SY[e]||e}isAvailable(e){let t=FD[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),FD[e]=t),t}_getWGSLMethod(e){return $r[e]!==void 0&&this._include(e),$f[e]}_include(e){const t=$r[e];return t.build(this),this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${BD}

// uniforms
${e.uniforms}

// structs
${e.structs}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${t} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = id.x + id.y * numWorkgroups.x * u32(${t}) + id.z * numWorkgroups.x * numWorkgroups.y * u32(${t});

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,i,r=0,s=0){const o=e+"Struct";return`${this._getWGSLStruct(o,t)}
@binding( ${r} ) @group( ${s} )
var<${i}> ${e} : ${o};`}}class bY{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=k.Depth24PlusStencil8:e.depth&&(t=k.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const s=this.backend.renderer,o=s.getRenderTarget();t=o?o.samples:s.samples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const i=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:i?1:t,isMSAA:i}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return rh.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return rh.LineList;if(e.isLine)return rh.LineStrip;if(e.isMesh)return rh.TriangleList}getSampleCount(e){let t=1;return e>1&&(t=Math.pow(2,Math.floor(Math.log2(e))),t===2&&(t=4)),t}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.samples)}getPreferredCanvasFormat(){return navigator.userAgent.includes("Quest")?k.BGRA8Unorm:navigator.gpu.getPreferredCanvasFormat()}}const wY=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),MY=new Map([[zA,["float16"]]]),EY=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class AY{constructor(e){this.backend=e}createAttribute(e,t){const i=this._getBufferAttribute(e),r=this.backend,s=r.get(i);let o=s.buffer;if(o===void 0){const a=r.device;let l=i.array;if(e.normalized===!1&&(l.constructor===Int16Array||l.constructor===Uint16Array)){const c=new Uint32Array(l.length);for(let h=0;h<l.length;h++)c[h]=l[h];l=c}if(i.array=l,(i.isStorageBufferAttribute||i.isStorageInstancedBufferAttribute)&&i.itemSize===3){l=new l.constructor(i.count*4);for(let c=0;c<i.count;c++)l.set(i.array.subarray(c*3,c*3+3),c*4);i.itemSize=4,i.array=l}const u=l.byteLength+(4-l.byteLength%4)%4;o=a.createBuffer({label:i.name,size:u,usage:t,mappedAtCreation:!0}),new l.constructor(o.getMappedRange()).set(l),o.unmap(),s.buffer=o}}updateAttribute(e){const t=this._getBufferAttribute(e),i=this.backend,r=i.device,s=i.get(t).buffer,o=t.array,a=this._isTypedArray(o),l=t.updateRanges;if(l.length===0)r.queue.writeBuffer(s,0,o,0);else{const u=a?1:o.BYTES_PER_ELEMENT;for(let c=0,h=l.length;c<h;c++){const d=l[c],f=d.start*u,m=d.count*u;r.queue.writeBuffer(s,0,o,f,m)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),i=new Map;for(let r=0;r<t.length;r++){const s=t[r],o=s.array.BYTES_PER_ELEMENT,a=this._getBufferAttribute(s);let l=i.get(a);if(l===void 0){let h,d;s.isInterleavedBufferAttribute===!0?(h=s.data.stride*o,d=s.data.isInstancedInterleavedBuffer?F_.Instance:F_.Vertex):(h=s.itemSize*o,d=s.isInstancedBufferAttribute?F_.Instance:F_.Vertex),s.normalized===!1&&(s.array.constructor===Int16Array||s.array.constructor===Uint16Array)&&(h=4),l={arrayStride:h,attributes:[],stepMode:d},i.set(a,l)}const u=this._getVertexFormat(s),c=s.isInterleavedBufferAttribute===!0?s.offset*o:0;l.attributes.push({shaderLocation:r,offset:c,format:u})}return Array.from(i.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,i=t.device,s=t.get(this._getBufferAttribute(e)).buffer,o=s.size,a=i.createBuffer({label:`${e.name}_readback`,size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),l=i.createCommandEncoder({label:`readback_encoder_${e.name}`});l.copyBufferToBuffer(s,0,a,0,o);const u=l.finish();i.queue.submit([u]),await a.mapAsync(GPUMapMode.READ);const c=a.getMappedRange(),h=new e.array.constructor(c.slice(0));return a.unmap(),h.buffer}_getVertexFormat(e){const{itemSize:t,normalized:i}=e,r=e.array.constructor,s=e.constructor;let o;if(t===1)o=EY.get(r);else{const l=(MY.get(s)||wY.get(r))[i?1:0];if(l){const u=r.BYTES_PER_ELEMENT*t,h=Math.floor((u+3)/4)*4/r.BYTES_PER_ELEMENT;if(h%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");o=`${l}x${h}`}}return o||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),o}_isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class CY{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){const t=this.backend,i=t.device,r=[];let s=0;for(const o of e.bindings){const a={binding:s++,visibility:o.visibility};if(o.isUniformBuffer||o.isStorageBuffer){const l={};o.isStorageBuffer&&(o.visibility&4&&(o.access===Ao.READ_WRITE||o.access===Ao.WRITE_ONLY)?l.type=gb.Storage:l.type=gb.ReadOnlyStorage),a.buffer=l}else if(o.isSampler){const l={};o.texture.isDepthTexture&&o.texture.compareFunction!==null&&(l.type="comparison"),a.sampler=l}else if(o.isSampledTexture&&o.texture.isVideoTexture)a.externalTexture={};else if(o.isSampledTexture&&o.store){const l={};l.format=this.backend.get(o.texture).texture.format;const u=o.access;u===Ao.READ_WRITE?l.access=_b.ReadWrite:u===Ao.WRITE_ONLY?l.access=_b.WriteOnly:l.access=_b.ReadOnly,a.storageTexture=l}else if(o.isSampledTexture){const l={},{primarySamples:u}=t.utils.getTextureSampleData(o.texture);if(u>1&&(l.multisampled=!0,o.texture.isDepthTexture||(l.sampleType=oh.UnfilterableFloat)),o.texture.isDepthTexture)l.sampleType=oh.Depth;else if(o.texture.isDataTexture||o.texture.isDataArrayTexture||o.texture.isData3DTexture){const c=o.texture.type;c===Hn?l.sampleType=oh.SInt:c===rn?l.sampleType=oh.UInt:c===mn&&(this.backend.hasFeature("float32-filterable")?l.sampleType=oh.Float:l.sampleType=oh.UnfilterableFloat)}o.isSampledCubeTexture?l.viewDimension=Qi.Cube:o.texture.isDataArrayTexture||o.texture.isCompressedArrayTexture?l.viewDimension=Qi.TwoDArray:o.isSampledTexture3D&&(l.viewDimension=Qi.ThreeD),a.texture=l}else console.error(`WebGPUBindingUtils: Unsupported binding "${o}".`);r.push(a)}return i.createBindGroupLayout({entries:r})}createBindings(e,t,i,r=0){const{backend:s,bindGroupLayoutCache:o}=this,a=s.get(e);let l=o.get(e.bindingsReference);l===void 0&&(l=this.createBindingsLayout(e),o.set(e.bindingsReference,l));let u;i>0&&(a.groups===void 0&&(a.groups=[],a.versions=[]),a.versions[i]===r&&(u=a.groups[i])),u===void 0&&(u=this.createBindGroup(e,l),i>0&&(a.groups[i]=u,a.versions[i]=r)),a.group=u,a.layout=l}updateBinding(e){const t=this.backend,i=t.device,r=e.buffer,s=t.get(e).buffer;i.queue.writeBuffer(s,0,r,0)}createBindGroup(e,t){const i=this.backend,r=i.device;let s=0;const o=[];for(const a of e.bindings){if(a.isUniformBuffer){const l=i.get(a);if(l.buffer===void 0){const u=a.byteLength,c=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,h=r.createBuffer({label:"bindingBuffer_"+a.name,size:u,usage:c});l.buffer=h}o.push({binding:s,resource:{buffer:l.buffer}})}else if(a.isStorageBuffer){const l=i.get(a);if(l.buffer===void 0){const u=a.attribute;l.buffer=i.get(u).buffer}o.push({binding:s,resource:{buffer:l.buffer}})}else if(a.isSampler){const l=i.get(a.texture);o.push({binding:s,resource:l.sampler})}else if(a.isSampledTexture){const l=i.get(a.texture);let u;if(l.externalTexture!==void 0)u=r.importExternalTexture({source:l.externalTexture});else{const c=a.store?1:l.texture.mipLevelCount,h=`view-${l.texture.width}-${l.texture.height}-${c}`;if(u=l[h],u===void 0){const d=rY.All;let f;a.isSampledCubeTexture?f=Qi.Cube:a.isSampledTexture3D?f=Qi.ThreeD:a.texture.isDataArrayTexture||a.texture.isCompressedArrayTexture?f=Qi.TwoDArray:f=Qi.TwoD,u=l[h]=l.texture.createView({aspect:d,dimension:f,mipLevelCount:c})}}o.push({binding:s,resource:u})}s++}return r.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:o})}}class RY{constructor(e){this.backend=e}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:i,material:r,geometry:s,pipeline:o}=e,{vertexProgram:a,fragmentProgram:l}=o,u=this.backend,c=u.device,h=u.utils,d=u.get(o),f=[];for(const U of e.getBindings()){const D=u.get(U);f.push(D.layout)}const m=u.attributeUtils.createShaderVertexBuffers(e);let g;r.transparent===!0&&r.blending!==zi&&(g=this._getBlending(r));let _={};r.stencilWrite===!0&&(_={compare:this._getStencilCompare(r),failOp:this._getStencilOperation(r.stencilFail),depthFailOp:this._getStencilOperation(r.stencilZFail),passOp:this._getStencilOperation(r.stencilZPass)});const p=this._getColorWriteMask(r),v=[];if(e.context.textures!==null){const U=e.context.textures;for(let D=0;D<U.length;D++){const L=h.getTextureFormatGPU(U[D]);v.push({format:L,blend:g,writeMask:p})}}else{const U=h.getCurrentColorFormat(e.context);v.push({format:U,blend:g,writeMask:p})}const y=u.get(a).module,x=u.get(l).module,S=this._getPrimitiveState(i,s,r),T=this._getDepthCompare(r),w=h.getCurrentDepthStencilFormat(e.context),E=this._getSampleCount(e.context),M={label:`renderPipeline_${r.name||r.type}_${r.id}`,vertex:Object.assign({},y,{buffers:m}),fragment:Object.assign({},x,{targets:v}),primitive:S,multisample:{count:E,alphaToCoverageEnabled:r.alphaToCoverage&&E>1},layout:c.createPipelineLayout({bindGroupLayouts:f})},b={},C=e.context.depth,I=e.context.stencil;if((C===!0||I===!0)&&(C===!0&&(b.format=w,b.depthWriteEnabled=r.depthWrite,b.depthCompare=T),I===!0&&(b.stencilFront=_,b.stencilBack={},b.stencilReadMask=r.stencilFuncMask,b.stencilWriteMask=r.stencilWriteMask),M.depthStencil=b),t===null)d.pipeline=c.createRenderPipeline(M);else{const U=new Promise(D=>{c.createRenderPipelineAsync(M).then(L=>{d.pipeline=L,D()})});t.push(U)}}createBundleEncoder(e){const t=this.backend,{utils:i,device:r}=t,s=i.getCurrentDepthStencilFormat(e),o=i.getCurrentColorFormat(e),a=this._getSampleCount(e),l={label:"renderBundleEncoder",colorFormats:[o],depthStencilFormat:s,sampleCount:a};return r.createRenderBundleEncoder(l)}createComputePipeline(e,t){const i=this.backend,r=i.device,s=i.get(e.computeProgram).module,o=i.get(e),a=[];for(const l of t){const u=i.get(l);a.push(u.layout)}o.pipeline=r.createComputePipeline({compute:s,layout:r.createPipelineLayout({bindGroupLayouts:a})})}_getBlending(e){let t,i;const r=e.blending,s=e.blendSrc,o=e.blendDst,a=e.blendEquation;if(r===Fy){const l=e.blendSrcAlpha!==null?e.blendSrcAlpha:s,u=e.blendDstAlpha!==null?e.blendDstAlpha:o,c=e.blendEquationAlpha!==null?e.blendEquationAlpha:a;t={srcFactor:this._getBlendFactor(s),dstFactor:this._getBlendFactor(o),operation:this._getBlendOperation(a)},i={srcFactor:this._getBlendFactor(l),dstFactor:this._getBlendFactor(u),operation:this._getBlendOperation(c)}}else{const l=e.premultipliedAlpha,u=(c,h,d,f)=>{t={srcFactor:c,dstFactor:h,operation:Yl.Add},i={srcFactor:d,dstFactor:f,operation:Yl.Add}};if(l)switch(r){case Or:u(qe.One,qe.OneMinusSrcAlpha,qe.One,qe.OneMinusSrcAlpha);break;case Vu:u(qe.One,qe.One,qe.One,qe.One);break;case Hu:u(qe.Zero,qe.OneMinusSrc,qe.Zero,qe.One);break;case Wu:u(qe.Zero,qe.Src,qe.Zero,qe.SrcAlpha);break}else switch(r){case Or:u(qe.SrcAlpha,qe.OneMinusSrcAlpha,qe.One,qe.OneMinusSrcAlpha);break;case Vu:u(qe.SrcAlpha,qe.One,qe.SrcAlpha,qe.One);break;case Hu:u(qe.Zero,qe.OneMinusSrc,qe.Zero,qe.One);break;case Wu:u(qe.Zero,qe.Src,qe.Zero,qe.Src);break}}if(t!==void 0&&i!==void 0)return{color:t,alpha:i};console.error("THREE.WebGPURenderer: Invalid blending: ",r)}_getBlendFactor(e){let t;switch(e){case ky:t=qe.Zero;break;case zy:t=qe.One;break;case Gy:t=qe.Src;break;case Vy:t=qe.OneMinusSrc;break;case gd:t=qe.SrcAlpha;break;case _d:t=qe.OneMinusSrcAlpha;break;case $y:t=qe.Dst;break;case jy:t=qe.OneMinusDstColor;break;case Hy:t=qe.DstAlpha;break;case Wy:t=qe.OneMinusDstAlpha;break;case Xy:t=qe.SrcAlphaSaturated;break;case E7:t=qe.Constant;break;case A7:t=qe.OneMinusConstant;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const i=e.stencilFunc;switch(i){case r3:t=Jn.Never;break;case tx:t=Jn.Always;break;case s3:t=Jn.Less;break;case a3:t=Jn.LessEqual;break;case o3:t=Jn.Equal;break;case c3:t=Jn.GreaterEqual;break;case l3:t=Jn.Greater;break;case u3:t=Jn.NotEqual;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",i)}return t}_getStencilOperation(e){let t;switch(e){case Tl:t=za.Keep;break;case QO:t=za.Zero;break;case ZO:t=za.Replace;break;case i3:t=za.Invert;break;case JO:t=za.IncrementClamp;break;case e3:t=za.DecrementClamp;break;case t3:t=za.IncrementWrap;break;case n3:t=za.DecrementWrap;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case fr:t=Yl.Add;break;case Oy:t=Yl.Subtract;break;case By:t=Yl.ReverseSubtract;break;case hA:t=Yl.Min;break;case dA:t=Yl.Max;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,i){const r={},s=this.backend.utils;switch(r.topology=s.getPrimitiveTopology(e,i),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(r.stripIndexFormat=t.index.array instanceof Uint16Array?sh.Uint16:sh.Uint32),i.side){case is:r.frontFace=fb.CCW,r.cullMode=pb.Back;break;case Xt:r.frontFace=fb.CCW,r.cullMode=pb.Front;break;case Ti:r.frontFace=fb.CCW,r.cullMode=pb.None;break;default:console.error("THREE.WebGPUPipelineUtils: Unknown material.side value.",i.side);break}return r}_getColorWriteMask(e){return e.colorWrite===!0?DD.All:DD.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=Jn.Always;else{const i=e.depthFunc;switch(i){case vd:t=Jn.Never;break;case yd:t=Jn.Always;break;case xd:t=Jn.Less;break;case fa:t=Jn.LessEqual;break;case Sd:t=Jn.Equal;break;case Td:t=Jn.GreaterEqual;break;case bd:t=Jn.Greater;break;case wd:t=Jn.NotEqual;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",i)}}return t}}class NY extends ED{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.trackTimestamp=e.trackTimestamp===!0,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new bY(this),this.attributeUtils=new AY(this),this.bindingUtils=new CY(this),this.pipelineUtils=new RY(this),this.textureUtils=new fY(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let i;if(t.device===void 0){const o={powerPreference:t.powerPreference},a=typeof navigator<"u"?await navigator.gpu.requestAdapter(o):null;if(a===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const l=Object.values(vb),u=[];for(const h of l)a.features.has(h)&&u.push(h);const c={requiredFeatures:u,requiredLimits:t.requiredLimits};i=await a.requestDevice(c)}else i=t.device;i.lost.then(o=>{const a={api:"WebGPU",message:o.message||"Unknown reason",reason:o.reason||null,originalEvent:o};e.onDeviceLost(a)});const r=t.context!==void 0?t.context:e.domElement.getContext("webgpu");this.device=i,this.context=r;const s=t.alpha?"premultiplied":"opaque";this.trackTimestamp=this.trackTimestamp&&this.hasFeature(vb.TimestampQuery),this.context.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:s}),this.updateSize()}get coordinateSystem(){return ya}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let e=this.defaultRenderPassdescriptor;if(e===null){const i=this.renderer;e={colorAttachments:[{view:null}]},(this.renderer.depth===!0||this.renderer.stencil===!0)&&(e.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(i.depth,i.stencil).createView()});const r=e.colorAttachments[0];this.renderer.samples>0?r.view=this.colorBuffer.createView():r.resolveTarget=void 0,this.defaultRenderPassdescriptor=e}const t=e.colorAttachments[0];return this.renderer.samples>0?t.resolveTarget=this.context.getCurrentTexture().createView():t.view=this.context.getCurrentTexture().createView(),e}_getRenderPassDescriptor(e,t={}){const i=e.renderTarget,r=this.get(i);let s=r.descriptors;if(s===void 0||r.width!==i.width||r.height!==i.height||r.dimensions!==i.dimensions||r.activeMipmapLevel!==i.activeMipmapLevel||r.activeCubeFace!==e.activeCubeFace||r.samples!==i.samples||r.loadOp!==t.loadOp){s={},r.descriptors=s;const l=()=>{i.removeEventListener("dispose",l),this.delete(i)};i.addEventListener("dispose",l)}const o=e.getCacheKey();let a=s[o];if(a===void 0){const l=e.textures,u=[];let c;for(let h=0;h<l.length;h++){const d=this.get(l[h]),f={label:`colorAttachment_${h}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:Qi.TwoD};i.isRenderTarget3D?(c=e.activeCubeFace,f.baseArrayLayer=0,f.dimension=Qi.ThreeD,f.depthOrArrayLayers=l[h].image.depth):i.isRenderTargetArray&&(f.dimension=Qi.TwoDArray,f.depthOrArrayLayers=l[h].image.depth);const m=d.texture.createView(f);let g,_;d.msaaTexture!==void 0?(g=d.msaaTexture.createView(),_=m):(g=m,_=void 0),u.push({view:g,depthSlice:c,resolveTarget:_,loadOp:vn.Load,storeOp:fi.Store,...t})}if(a={colorAttachments:u},e.depth){const d={view:this.get(e.depthTexture).texture.createView()};a.depthStencilAttachment=d}s[o]=a,r.width=i.width,r.height=i.height,r.samples=i.samples,r.activeMipmapLevel=e.activeMipmapLevel,r.activeCubeFace=e.activeCubeFace,r.dimensions=i.dimensions,r.depthSlice=c,r.loadOp=u[0].loadOp}return a}beginRender(e){const t=this.get(e),i=this.device,r=e.occlusionQueryCount;let s;r>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,s=i.createQuerySet({type:"occlusion",count:r,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=s,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(r),t.lastOcclusionObject=null);let o;e.textures===null?o=this._getDefaultRenderPassDescriptor():o=this._getRenderPassDescriptor(e,{loadOp:vn.Load}),this.initTimestampQuery(e,o),o.occlusionQuerySet=s;const a=o.depthStencilAttachment;if(e.textures!==null){const c=o.colorAttachments;for(let h=0;h<c.length;h++){const d=c[h];e.clearColor?(d.clearValue=h===0?e.clearColorValue:{r:0,g:0,b:0,a:1},d.loadOp=vn.Clear,d.storeOp=fi.Store):(d.loadOp=vn.Load,d.storeOp=fi.Store)}}else{const c=o.colorAttachments[0];e.clearColor?(c.clearValue=e.clearColorValue,c.loadOp=vn.Clear,c.storeOp=fi.Store):(c.loadOp=vn.Load,c.storeOp=fi.Store)}e.depth&&(e.clearDepth?(a.depthClearValue=e.clearDepthValue,a.depthLoadOp=vn.Clear,a.depthStoreOp=fi.Store):(a.depthLoadOp=vn.Load,a.depthStoreOp=fi.Store)),e.stencil&&(e.clearStencil?(a.stencilClearValue=e.clearStencilValue,a.stencilLoadOp=vn.Clear,a.stencilStoreOp=fi.Store):(a.stencilLoadOp=vn.Load,a.stencilStoreOp=fi.Store));const l=i.createCommandEncoder({label:"renderContext_"+e.id}),u=l.beginRenderPass(o);if(t.descriptor=o,t.encoder=l,t.currentPass=u,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[],e.viewport&&this.updateViewport(e),e.scissor){const{x:c,y:h,width:d,height:f}=e.scissorValue;u.setScissorRect(c,h,d,f)}}finishRender(e){const t=this.get(e),i=e.occlusionQueryCount;if(t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),i>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery(),t.currentPass.end(),i>0){const r=i*8;let s=this.occludedResolveCache.get(r);s===void 0&&(s=this.device.createBuffer({size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(r,s));const o=this.device.createBuffer({size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,i,s,0),t.encoder.copyBufferToBuffer(s,0,o,0,r),t.occlusionQueryBuffer=o,this.resolveOccludedAsync(e)}if(this.prepareTimestampBuffer(e,t.encoder),this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const r=e.textures;for(let s=0;s<r.length;s++){const o=r[s];o.generateMipmaps===!0&&this.textureUtils.generateMipmaps(o)}}}isOccluded(e,t){const i=this.get(e);return i.occluded&&i.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:i,currentOcclusionQueryObjects:r}=t;if(i&&r){const s=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await i.mapAsync(GPUMapMode.READ);const o=i.getMappedRange(),a=new BigUint64Array(o);for(let l=0;l<r.length;l++)a[l]!==BigInt(0)&&s.add(r[l]);i.destroy(),t.occluded=s}}updateViewport(e){const{currentPass:t}=this.get(e),{x:i,y:r,width:s,height:o,minDepth:a,maxDepth:l}=e.viewportValue;t.setViewport(i,r,s,o,a,l)}clear(e,t,i,r=null){const s=this.device,o=this.renderer;let a=[],l,u,c,h;if(e){const m=this.getClearColor();if(this.renderer.alpha===!0){const g=m.a;u={r:m.r*g,g:m.g*g,b:m.b*g,a:g}}else u={r:m.r,g:m.g,b:m.b,a:m.a}}if(r===null){c=o.depth,h=o.stencil;const m=this._getDefaultRenderPassDescriptor();if(e){a=m.colorAttachments;const g=a[0];g.clearValue=u,g.loadOp=vn.Clear,g.storeOp=fi.Store}(c||h)&&(l=m.depthStencilAttachment)}else c=r.depth,h=r.stencil,e&&(a=this._getRenderPassDescriptor(r,{loadOp:vn.Clear}).colorAttachments),(c||h)&&(l={view:this.get(r.depthTexture).texture.createView()});c&&(t?(l.depthLoadOp=vn.Clear,l.depthClearValue=o.getClearDepth(),l.depthStoreOp=fi.Store):(l.depthLoadOp=vn.Load,l.depthStoreOp=fi.Store)),h&&(i?(l.stencilLoadOp=vn.Clear,l.stencilClearValue=o.getClearStencil(),l.stencilStoreOp=fi.Store):(l.stencilLoadOp=vn.Load,l.stencilStoreOp=fi.Store));const d=s.createCommandEncoder({});d.beginRenderPass({colorAttachments:a,depthStencilAttachment:l}).end(),s.queue.submit([d.finish()])}beginCompute(e){const t=this.get(e),i={};this.initTimestampQuery(e,i),t.cmdEncoderGPU=this.device.createCommandEncoder(),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(i)}compute(e,t,i,r){const{passEncoderGPU:s}=this.get(e),o=this.get(r).pipeline;s.setPipeline(o);for(let c=0,h=i.length;c<h;c++){const d=i[c],f=this.get(d);s.setBindGroup(c,f.group)}const a=this.device.limits.maxComputeWorkgroupsPerDimension,l=this.get(t);l.dispatchSize===void 0&&(l.dispatchSize={x:0,y:1,z:1});const{dispatchSize:u}=l;t.dispatchCount>a?(u.x=Math.min(t.dispatchCount,a),u.y=Math.ceil(t.dispatchCount/a)):u.x=t.dispatchCount,s.dispatchWorkgroups(u.x,u.y,u.z)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.prepareTimestampBuffer(e,t.cmdEncoderGPU),this.device.queue.submit([t.cmdEncoderGPU.finish()])}async waitForGPU(){await this.device.queue.onSubmittedWorkDone()}draw(e,t){const{object:i,context:r,pipeline:s}=e,o=e.getBindings(),a=this.get(r),l=this.get(s).pipeline,u=a.currentSets,c=a.currentPass,h=e.getDrawParameters();if(h===null)return;u.pipeline!==l&&(c.setPipeline(l),u.pipeline=l);const d=u.bindingGroups;for(let _=0,p=o.length;_<p;_++){const v=o[_],y=this.get(v);d[v.index]!==v.id&&(c.setBindGroup(v.index,y.group),d[v.index]=v.id)}const f=e.getIndex(),m=f!==null;if(m===!0&&u.index!==f){const _=this.get(f).buffer,p=f.array instanceof Uint16Array?sh.Uint16:sh.Uint32;c.setIndexBuffer(_,p),u.index=f}const g=e.getVertexBuffers();for(let _=0,p=g.length;_<p;_++){const v=g[_];if(u.attributes[_]!==v){const y=this.get(v).buffer;c.setVertexBuffer(_,y),u.attributes[_]=v}}if(a.occlusionQuerySet!==void 0){const _=a.lastOcclusionObject;_!==i&&(_!==null&&_.occlusionTest===!0&&(c.endOcclusionQuery(),a.occlusionQueryIndex++),i.occlusionTest===!0&&(c.beginOcclusionQuery(a.occlusionQueryIndex),a.occlusionQueryObjects[a.occlusionQueryIndex]=i),a.lastOcclusionObject=i)}if(i.isBatchedMesh===!0){const _=i._multiDrawStarts,p=i._multiDrawCounts,v=i._multiDrawCount,y=i._multiDrawInstances;for(let x=0;x<v;x++){const S=y?y[x]:1,T=S>1?0:x;m===!0?c.drawIndexed(p[x],S,_[x]/f.array.BYTES_PER_ELEMENT,0,T):c.draw(p[x],S,_[x],T)}}else if(m===!0){const{vertexCount:_,instanceCount:p,firstVertex:v}=h,y=e.getIndirect();if(y!==null){const x=this.get(y).buffer;c.drawIndexedIndirect(x,0)}else c.drawIndexed(_,p,v,0,0);t.update(i,_,p)}else{const{vertexCount:_,instanceCount:p,firstVertex:v}=h,y=e.getIndirect();if(y!==null){const x=this.get(y).buffer;c.drawIndirect(x,0)}else c.draw(_,p,v,0);t.update(i,_,p)}}needsRenderUpdate(e){const t=this.get(e),{object:i,material:r}=e,s=this.utils,o=s.getSampleCountRenderContext(e.context),a=s.getCurrentColorSpace(e.context),l=s.getCurrentColorFormat(e.context),u=s.getCurrentDepthStencilFormat(e.context),c=s.getPrimitiveTopology(i,r);let h=!1;return(t.material!==r||t.materialVersion!==r.version||t.transparent!==r.transparent||t.blending!==r.blending||t.premultipliedAlpha!==r.premultipliedAlpha||t.blendSrc!==r.blendSrc||t.blendDst!==r.blendDst||t.blendEquation!==r.blendEquation||t.blendSrcAlpha!==r.blendSrcAlpha||t.blendDstAlpha!==r.blendDstAlpha||t.blendEquationAlpha!==r.blendEquationAlpha||t.colorWrite!==r.colorWrite||t.depthWrite!==r.depthWrite||t.depthTest!==r.depthTest||t.depthFunc!==r.depthFunc||t.stencilWrite!==r.stencilWrite||t.stencilFunc!==r.stencilFunc||t.stencilFail!==r.stencilFail||t.stencilZFail!==r.stencilZFail||t.stencilZPass!==r.stencilZPass||t.stencilFuncMask!==r.stencilFuncMask||t.stencilWriteMask!==r.stencilWriteMask||t.side!==r.side||t.alphaToCoverage!==r.alphaToCoverage||t.sampleCount!==o||t.colorSpace!==a||t.colorFormat!==l||t.depthStencilFormat!==u||t.primitiveTopology!==c||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=r,t.materialVersion=r.version,t.transparent=r.transparent,t.blending=r.blending,t.premultipliedAlpha=r.premultipliedAlpha,t.blendSrc=r.blendSrc,t.blendDst=r.blendDst,t.blendEquation=r.blendEquation,t.blendSrcAlpha=r.blendSrcAlpha,t.blendDstAlpha=r.blendDstAlpha,t.blendEquationAlpha=r.blendEquationAlpha,t.colorWrite=r.colorWrite,t.depthWrite=r.depthWrite,t.depthTest=r.depthTest,t.depthFunc=r.depthFunc,t.stencilWrite=r.stencilWrite,t.stencilFunc=r.stencilFunc,t.stencilFail=r.stencilFail,t.stencilZFail=r.stencilZFail,t.stencilZPass=r.stencilZPass,t.stencilFuncMask=r.stencilFuncMask,t.stencilWriteMask=r.stencilWriteMask,t.side=r.side,t.alphaToCoverage=r.alphaToCoverage,t.sampleCount=o,t.colorSpace=a,t.colorFormat=l,t.depthStencilFormat=u,t.primitiveTopology=c,t.clippingContextCacheKey=e.clippingContextCacheKey,h=!0),h}getRenderCacheKey(e){const{object:t,material:i}=e,r=this.utils,s=e.context;return[i.transparent,i.blending,i.premultipliedAlpha,i.blendSrc,i.blendDst,i.blendEquation,i.blendSrcAlpha,i.blendDstAlpha,i.blendEquationAlpha,i.colorWrite,i.depthWrite,i.depthTest,i.depthFunc,i.stencilWrite,i.stencilFunc,i.stencilFail,i.stencilZFail,i.stencilZPass,i.stencilFuncMask,i.stencilWriteMask,i.side,r.getSampleCountRenderContext(s),r.getCurrentColorSpace(s),r.getCurrentColorFormat(s),r.getCurrentDepthStencilFormat(s),r.getPrimitiveTopology(t,i),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}createSampler(e){this.textureUtils.createSampler(e)}destroySampler(e){this.textureUtils.destroySampler(e)}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}copyTextureToBuffer(e,t,i,r,s,o){return this.textureUtils.copyTextureToBuffer(e,t,i,r,s,o)}initTimestampQuery(e,t){if(!this.trackTimestamp)return;const i=this.get(e);if(!i.timeStampQuerySet){const r=e.isComputeNode?"compute":"render",s=this.device.createQuerySet({type:"timestamp",count:2,label:`timestamp_${r}_${e.id}`});Object.assign(t,{timestampWrites:{querySet:s,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1}}),i.timeStampQuerySet=s}}prepareTimestampBuffer(e,t){if(!this.trackTimestamp)return;const i=this.get(e),r=2*BigInt64Array.BYTES_PER_ELEMENT;i.currentTimestampQueryBuffers===void 0&&(i.currentTimestampQueryBuffers={resolveBuffer:this.device.createBuffer({label:"timestamp resolve buffer",size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),resultBuffer:this.device.createBuffer({label:"timestamp result buffer",size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})});const{resolveBuffer:s,resultBuffer:o}=i.currentTimestampQueryBuffers;t.resolveQuerySet(i.timeStampQuerySet,0,2,s,0),o.mapState==="unmapped"&&t.copyBufferToBuffer(s,0,o,0,r)}async resolveTimestampAsync(e,t="render"){if(!this.trackTimestamp)return;const i=this.get(e);if(i.currentTimestampQueryBuffers===void 0)return;const{resultBuffer:r}=i.currentTimestampQueryBuffers;r.mapState==="unmapped"&&r.mapAsync(GPUMapMode.READ).then(()=>{const s=new BigUint64Array(r.getMappedRange()),o=Number(s[1]-s[0])/1e6;this.renderer.info.updateTimestamp(t,o),r.unmap()})}createNodeBuilder(e,t){return new TY(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const i=this.get(e),s=i.currentPass.finish();this.get(t).bundleGPU=s,i.currentSets=i._currentSets,i.currentPass=i._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,i,r){this.bindingUtils.createBindings(e,t,i,r)}updateBindings(e,t,i,r){this.bindingUtils.createBindings(e,t,i,r)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(e){return this.device.features.has(e)}copyTextureToTexture(e,t,i=null,r=null,s=0){let o=0,a=0,l=0,u=0,c=0,h=0,d=e.image.width,f=e.image.height;i!==null&&(u=i.x,c=i.y,h=i.z||0,d=i.width,f=i.height),r!==null&&(o=r.x,a=r.y,l=r.z||0);const m=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),g=this.get(e).texture,_=this.get(t).texture;m.copyTextureToTexture({texture:g,mipLevel:s,origin:{x:u,y:c,z:h}},{texture:_,mipLevel:s,origin:{x:o,y:a,z:l}},[d,f,1]),this.device.queue.submit([m.finish()])}copyFramebufferToTexture(e,t,i){const r=this.get(t);let s=null;t.renderTarget?e.isDepthTexture?s=this.get(t.depthTexture).texture:s=this.get(t.textures[0]).texture:e.isDepthTexture?s=this.textureUtils.getDepthBuffer(t.depth,t.stencil):s=this.context.getCurrentTexture();const o=this.get(e).texture;if(s.format!==o.format){console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",s.format,o.format);return}let a;if(r.currentPass?(r.currentPass.end(),a=r.encoder):a=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),a.copyTextureToTexture({texture:s,origin:[i.x,i.y,0]},{texture:o},[i.z,i.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e),r.currentPass){const{descriptor:l}=r;for(let u=0;u<l.colorAttachments.length;u++)l.colorAttachments[u].loadOp=vn.Load;if(t.depth&&(l.depthStencilAttachment.depthLoadOp=vn.Load),t.stencil&&(l.depthStencilAttachment.stencilLoadOp=vn.Load),r.currentPass=a.beginRenderPass(l),r.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor){const{x:u,y:c,width:h,height:d}=t.scissorValue;r.currentPass.setScissorRect(u,c,h,d)}}else this.device.queue.submit([a.finish()])}}class PY extends cC{constructor(e,t,i,r,s,o){super(e,t,i,r,s,o),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class DY extends gD{constructor(){super(),this.addMaterial(_j,"MeshPhongMaterial"),this.addMaterial(I2,"MeshStandardMaterial"),this.addMaterial(i7,"MeshPhysicalMaterial"),this.addMaterial(a7,"MeshToonMaterial"),this.addMaterial(cj,"MeshBasicMaterial"),this.addMaterial(mj,"MeshLambertMaterial"),this.addMaterial(rj,"MeshNormalMaterial"),this.addMaterial(h7,"MeshMatcapMaterial"),this.addMaterial(J9,"LineBasicMaterial"),this.addMaterial(tj,"LineDashedMaterial"),this.addMaterial(f7,"PointsMaterial"),this.addMaterial(_7,"SpriteMaterial"),this.addMaterial(x7,"ShadowMaterial"),this.addLight($X,UB),this.addLight(Sq,dC),this.addLight(Tq,OB),this.addLight(dD,cC),this.addLight(wq,fC),this.addLight(Mq,DB),this.addLight(Eq,kB),this.addLight(bq,PY),this.addToneMapping(eX,mA),this.addToneMapping(tX,gA),this.addToneMapping(nX,_A),this.addToneMapping(rX,vA),this.addToneMapping(lX,yA),this.addToneMapping(uX,xA)}}class LY extends Oq{constructor(e={}){let t;e.forceWebGL?t=PD:(t=NY,e.getFallback=()=>(console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new PD(e)));const i=new t(e);super(i,e),this.library=new DY,this.isWebGPURenderer=!0}}const xb={type:"change"},Sb={type:"start"},Tb={type:"end"},kD=1e-6,Et={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},B_=new he,Ga=new he,IY=new N,k_=new N,bb=new N,lh=new ss,zD=new N,z_=new N,wb=new N,G_=new N;class UY extends xg{constructor(e,t=null){super(e,t),this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:Vn.ROTATE,MIDDLE:Vn.DOLLY,RIGHT:Vn.PAN},this.state=Et.NONE,this.keyState=Et.NONE,this.target=new N,this._lastPosition=new N,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new N,this._movePrev=new he,this._moveCurr=new he,this._lastAxis=new N,this._zoomStart=new he,this._zoomEnd=new he,this._panStart=new he,this._panEnd=new he,this._pointers=[],this._pointerPositions={},this._onPointerMove=OY.bind(this),this._onPointerDown=FY.bind(this),this._onPointerUp=BY.bind(this),this._onPointerCancel=kY.bind(this),this._onContextMenu=jY.bind(this),this._onMouseWheel=$Y.bind(this),this._onKeyDown=GY.bind(this),this._onKeyUp=zY.bind(this),this._onTouchStart=XY.bind(this),this._onTouchMove=qY.bind(this),this._onTouchEnd=YY.bind(this),this._onMouseDown=VY.bind(this),this._onMouseMove=HY.bind(this),this._onMouseUp=WY.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,t!==null&&(this.connect(),this.handleResize()),this.update()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>kD&&(this.dispatchEvent(xb),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>kD||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(xb),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=Et.NONE,this.keyState=Et.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(xb),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(Ga.copy(this._panEnd).sub(this._panStart),Ga.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,t=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;Ga.x*=e,Ga.y*=t}Ga.multiplyScalar(this._eye.length()*this.panSpeed),k_.copy(this._eye).cross(this.object.up).setLength(Ga.x),k_.add(IY.copy(this.object.up).setLength(Ga.y)),this.object.position.add(k_),this.target.add(k_),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(Ga.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){G_.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=G_.length();e?(this._eye.copy(this.object.position).sub(this.target),zD.copy(this._eye).normalize(),z_.copy(this.object.up).normalize(),wb.crossVectors(z_,zD).normalize(),z_.setLength(this._moveCurr.y-this._movePrev.y),wb.setLength(this._moveCurr.x-this._movePrev.x),G_.copy(z_.add(wb)),bb.crossVectors(G_,this._eye).normalize(),e*=this.rotateSpeed,lh.setFromAxisAngle(bb,e),this._eye.applyQuaternion(lh),this.object.up.applyQuaternion(lh),this._lastAxis.copy(bb),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),lh.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(lh),this.object.up.applyQuaternion(lh)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===Et.TOUCH_ZOOM_PAN?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=zm.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,e!==1&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=zm.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,t){return B_.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),B_}_getMouseOnCircle(e,t){return B_.set((e-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-t))/this.screen.width),B_}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId==e.pointerId){this._pointers.splice(t,1);return}}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new he,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[t.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function FY(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n))}function OY(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function BY(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchEnd(n):this._onMouseUp(),this._removePointer(n),this._pointers.length===0&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function kY(n){this._removePointer(n)}function zY(){this.enabled!==!1&&(this.keyState=Et.NONE,window.addEventListener("keydown",this._onKeyDown))}function GY(n){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===Et.NONE&&(n.code===this.keys[Et.ROTATE]&&!this.noRotate?this.keyState=Et.ROTATE:n.code===this.keys[Et.ZOOM]&&!this.noZoom?this.keyState=Et.ZOOM:n.code===this.keys[Et.PAN]&&!this.noPan&&(this.keyState=Et.PAN)))}function VY(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Vn.DOLLY:this.state=Et.ZOOM;break;case Vn.ROTATE:this.state=Et.ROTATE;break;case Vn.PAN:this.state=Et.PAN;break;default:this.state=Et.NONE}const t=this.keyState!==Et.NONE?this.keyState:this.state;t===Et.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr)):t===Et.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(n.pageX,n.pageY)),this._zoomEnd.copy(this._zoomStart)):t===Et.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(n.pageX,n.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(Sb)}function HY(n){const e=this.keyState!==Et.NONE?this.keyState:this.state;e===Et.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY))):e===Et.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(n.pageX,n.pageY)):e===Et.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(n.pageX,n.pageY))}function WY(){this.state=Et.NONE,this.dispatchEvent(Tb)}function $Y(n){if(this.enabled!==!1&&this.noZoom!==!0){switch(n.preventDefault(),n.deltaMode){case 2:this._zoomStart.y-=n.deltaY*.025;break;case 1:this._zoomStart.y-=n.deltaY*.01;break;default:this._zoomStart.y-=n.deltaY*25e-5;break}this.dispatchEvent(Sb),this.dispatchEvent(Tb)}}function jY(n){this.enabled!==!1&&n.preventDefault()}function XY(n){switch(this._trackPointer(n),this._pointers.length){case 1:this.state=Et.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this.state=Et.TOUCH_ZOOM_PAN;const e=this._pointers[0].pageX-this._pointers[1].pageX,t=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+t*t);const i=(this._pointers[0].pageX+this._pointers[1].pageX)/2,r=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(i,r)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(Sb)}function qY(n){switch(this._trackPointer(n),this._pointers.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY));break;default:const e=this._getSecondPointerPosition(n),t=n.pageX-e.x,i=n.pageY-e.y;this._touchZoomDistanceEnd=Math.sqrt(t*t+i*i);const r=(n.pageX+e.x)/2,s=(n.pageY+e.y)/2;this._panEnd.copy(this._getMouseOnScreen(r,s));break}}function YY(n){switch(this._pointers.length){case 0:this.state=Et.NONE;break;case 1:this.state=Et.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=Et.TOUCH_ZOOM_PAN;for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId!==n.pointerId){const t=this._pointerPositions[this._pointers[e].pointerId];this._moveCurr.copy(this._getMouseOnCircle(t.x,t.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent(Tb)}const GD={type:"change"},Mb={type:"start"},VD={type:"end"},V_=new Xm,HD=new us,KY=Math.cos(70*zm.DEG2RAD),kn=new N,Zi=2*Math.PI,Ut={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},Eb=1e-6;class QY extends xg{constructor(e,t=null){super(e,t),this.state=Ut.NONE,this.enabled=!0,this.target=new N,this.cursor=new N,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Vn.ROTATE,MIDDLE:Vn.DOLLY,RIGHT:Vn.PAN},this.touches={ONE:lo.ROTATE,TWO:lo.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new N,this._lastQuaternion=new ss,this._lastTargetPosition=new N,this._quat=new ss().setFromUnitVectors(e.up,new N(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Kx,this._sphericalDelta=new Kx,this._scale=1,this._panOffset=new N,this._rotateStart=new he,this._rotateEnd=new he,this._rotateDelta=new he,this._panStart=new he,this._panEnd=new he,this._panDelta=new he,this._dollyStart=new he,this._dollyEnd=new he,this._dollyDelta=new he,this._dollyDirection=new N,this._mouse=new he,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=JY.bind(this),this._onPointerDown=ZY.bind(this),this._onPointerUp=eK.bind(this),this._onContextMenu=aK.bind(this),this._onMouseWheel=iK.bind(this),this._onKeyDown=rK.bind(this),this._onTouchStart=sK.bind(this),this._onTouchMove=oK.bind(this),this._onMouseDown=tK.bind(this),this._onMouseMove=nK.bind(this),this._interceptControlDown=lK.bind(this),this._interceptControlUp=uK.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(GD),this.update(),this.state=Ut.NONE}update(e=null){const t=this.object.position;kn.copy(t).sub(this.target),kn.applyQuaternion(this._quat),this._spherical.setFromVector3(kn),this.autoRotate&&this.state===Ut.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let i=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(i)&&isFinite(r)&&(i<-Math.PI?i+=Zi:i>Math.PI&&(i-=Zi),r<-Math.PI?r+=Zi:r>Math.PI&&(r-=Zi),i<=r?this._spherical.theta=Math.max(i,Math.min(r,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(i+r)/2?Math.max(i,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=o!=this._spherical.radius}if(kn.setFromSpherical(this._spherical),kn.applyQuaternion(this._quatInverse),t.copy(this.target).add(kn),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const a=kn.length();o=this._clampDistance(a*this._scale);const l=a-o;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),s=!!l}else if(this.object.isOrthographicCamera){const a=new N(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=l!==this.object.zoom;const u=new N(this._mouse.x,this._mouse.y,0);u.unproject(this.object),this.object.position.sub(u).add(a),this.object.updateMatrixWorld(),o=kn.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(V_.origin.copy(this.object.position),V_.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(V_.direction))<KY?this.object.lookAt(this.target):(HD.setFromNormalAndCoplanarPoint(this.object.up,this.target),V_.intersectPlane(HD,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,s||this._lastPosition.distanceToSquared(this.object.position)>Eb||8*(1-this._lastQuaternion.dot(this.object.quaternion))>Eb||this._lastTargetPosition.distanceToSquared(this.target)>Eb?(this.dispatchEvent(GD),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Zi/60*this.autoRotateSpeed*e:Zi/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){kn.setFromMatrixColumn(t,0),kn.multiplyScalar(-e),this._panOffset.add(kn)}_panUp(e,t){this.screenSpacePanning===!0?kn.setFromMatrixColumn(t,1):(kn.setFromMatrixColumn(t,0),kn.crossVectors(this.object.up,kn)),kn.multiplyScalar(e),this._panOffset.add(kn)}_pan(e,t){const i=this.domElement;if(this.object.isPerspectiveCamera){const r=this.object.position;kn.copy(r).sub(this.target);let s=kn.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*s/i.clientHeight,this.object.matrix),this._panUp(2*t*s/i.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const i=this.domElement.getBoundingClientRect(),r=e-i.left,s=t-i.top,o=i.width,a=i.height;this._mouse.x=r/o*2-1,this._mouse.y=-(s/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Zi*this._rotateDelta.x/t.clientHeight),this._rotateUp(Zi*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(Zi*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-Zi*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(Zi*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-Zi*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._rotateStart.set(i,r)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panStart.set(i,r)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(i*i+r*r);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),r=.5*(e.pageX+i.x),s=.5*(e.pageY+i.y);this._rotateEnd.set(r,s)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Zi*this._rotateDelta.x/t.clientHeight),this._rotateUp(Zi*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panEnd.set(i,r)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(i*i+r*r);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(e.pageX+t.x)*.5,a=(e.pageY+t.y)*.5;this._updateZoomParameters(o,a)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new he,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,i={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(i.deltaY*=10),i}}function ZY(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(n)&&(this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n)))}function JY(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function eK(n){switch(this._removePointer(n),this._pointers.length){case 0:this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(VD),this.state=Ut.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function tK(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Vn.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(n),this.state=Ut.DOLLY;break;case Vn.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=Ut.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=Ut.ROTATE}break;case Vn.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=Ut.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=Ut.PAN}break;default:this.state=Ut.NONE}this.state!==Ut.NONE&&this.dispatchEvent(Mb)}function nK(n){switch(this.state){case Ut.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(n);break;case Ut.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(n);break;case Ut.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(n);break}}function iK(n){this.enabled===!1||this.enableZoom===!1||this.state!==Ut.NONE||(n.preventDefault(),this.dispatchEvent(Mb),this._handleMouseWheel(this._customWheelEvent(n)),this.dispatchEvent(VD))}function rK(n){this.enabled!==!1&&this._handleKeyDown(n)}function sK(n){switch(this._trackPointer(n),this._pointers.length){case 1:switch(this.touches.ONE){case lo.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(n),this.state=Ut.TOUCH_ROTATE;break;case lo.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(n),this.state=Ut.TOUCH_PAN;break;default:this.state=Ut.NONE}break;case 2:switch(this.touches.TWO){case lo.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(n),this.state=Ut.TOUCH_DOLLY_PAN;break;case lo.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(n),this.state=Ut.TOUCH_DOLLY_ROTATE;break;default:this.state=Ut.NONE}break;default:this.state=Ut.NONE}this.state!==Ut.NONE&&this.dispatchEvent(Mb)}function oK(n){switch(this._trackPointer(n),this.state){case Ut.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(n),this.update();break;case Ut.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(n),this.update();break;case Ut.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(n),this.update();break;case Ut.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(n),this.update();break;default:this.state=Ut.NONE}}function aK(n){this.enabled!==!1&&n.preventDefault()}function lK(n){n.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function uK(n){n.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const cK={type:"change"},WD=1e-6,$D=new ss;class hK extends xg{constructor(e,t=null){super(e,t),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new N(0,0,0),this._rotationVector=new N(0,0,0),this._lastQuaternion=new ss,this._lastPosition=new N,this._status=0,this._onKeyDown=dK.bind(this),this._onKeyUp=fK.bind(this),this._onPointerMove=mK.bind(this),this._onPointerDown=pK.bind(this),this._onPointerUp=gK.bind(this),this._onPointerCancel=_K.bind(this),this._onContextMenu=vK.bind(this),t!==null&&this.connect()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(this.enabled===!1)return;const t=this.object,i=e*this.movementSpeed,r=e*this.rollSpeed;t.translateX(this._moveVector.x*i),t.translateY(this._moveVector.y*i),t.translateZ(this._moveVector.z*i),$D.set(this._rotationVector.x*r,this._rotationVector.y*r,this._rotationVector.z*r,1).normalize(),t.quaternion.multiply($D),(this._lastPosition.distanceToSquared(t.position)>WD||8*(1-this._lastQuaternion.dot(t.quaternion))>WD)&&(this.dispatchEvent(cK),this._lastQuaternion.copy(t.quaternion),this._lastPosition.copy(t.position))}_updateMovementVector(){const e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function dK(n){if(!(n.altKey||this.enabled===!1)){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1;break}this._updateMovementVector(),this._updateRotationVector()}}function fK(n){if(this.enabled!==!1){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0;break}this._updateMovementVector(),this._updateRotationVector()}}function pK(n){if(this.enabled!==!1)if(this.dragToLook)this._status++;else{switch(n.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1;break}this._updateMovementVector()}}function mK(n){if(this.enabled!==!1&&(!this.dragToLook||this._status>0)){const e=this._getContainerDimensions(),t=e.size[0]/2,i=e.size[1]/2;this._moveState.yawLeft=-(n.pageX-e.offset[0]-t)/t,this._moveState.pitchDown=(n.pageY-e.offset[1]-i)/i,this._updateRotationVector()}}function gK(n){if(this.enabled!==!1){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(n.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0;break}this._updateMovementVector()}this._updateRotationVector()}}function _K(){this.enabled!==!1&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function vK(n){this.enabled!==!1&&n.preventDefault()}const yK={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class H_{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const xK=new Jd(-1,1,1,-1,0,1);class SK extends ci{constructor(){super(),this.setAttribute("position",new _n([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new _n([0,2,0,0,2,0],2))}}const TK=new SK;class bK{constructor(e){this._mesh=new $n(TK,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,xK)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class wK extends H_{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof Ps?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=$A.clone(e.uniforms),this.material=new Ps({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new bK(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class jD extends H_{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const r=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let o,a;this.inverse?(o=0,a=1):(o=1,a=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),s.buffers.stencil.setFunc(r.ALWAYS,o,4294967295),s.buffers.stencil.setClear(a),s.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.color.setMask(!0),s.buffers.depth.setMask(!0),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(r.EQUAL,1,4294967295),s.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),s.buffers.stencil.setLocked(!0)}}class MK extends H_{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class EK{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const i=e.getSize(new he);this._width=i.width,this._height=i.height,t=new xa(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:wi}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new wK(yK),this.copyPass.material.blending=zi,this.clock=new pC}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let r=0,s=this.passes.length;r<s;r++){const o=this.passes[r];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),o.needsSwap){if(i){const a=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}jD!==void 0&&(o instanceof jD?i=!0:o instanceof MK&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new he);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(i,r),this.renderTarget2.setSize(i,r);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(i,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class AK extends H_{constructor(e,t,i=null,r=null,s=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=r,this.clearAlpha=s,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Ue}render(e,t,i){const r=e.autoClear;e.autoClear=!1;let s,o;this.overrideMaterial!==null&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(s=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(s),this.overrideMaterial!==null&&(this.scene.overrideMaterial=o),e.autoClear=r}}function Ji(){return Ji=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Ji.apply(null,arguments)}function CK(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function jf(n,e){return jf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t},jf(n,e)}function RK(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,jf(n,e)}function Ab(n){return Ab=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ab(n)}function NK(n){try{return Function.toString.call(n).indexOf("[native code]")!==-1}catch{return typeof n=="function"}}function XD(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(XD=function(){return!!n})()}function PK(n,e,t){if(XD())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,e);var r=new(n.bind.apply(n,i));return t&&jf(r,t.prototype),r}function Cb(n){var e=typeof Map=="function"?new Map:void 0;return Cb=function(i){if(i===null||!NK(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(i))return e.get(i);e.set(i,r)}function r(){return PK(i,arguments,Ab(this).constructor)}return r.prototype=Object.create(i.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),jf(r,i)},Cb(n)}var Gs=function(n){RK(e,n);function e(t){var i;return i=n.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+t+" for more information.")||this,CK(i)}return e}(Cb(Error));function Rb(n){return Math.round(n*255)}function DK(n,e,t){return Rb(n)+","+Rb(e)+","+Rb(t)}function W_(n,e,t,i){if(i===void 0&&(i=DK),e===0)return i(t,t,t);var r=(n%360+360)%360/60,s=(1-Math.abs(2*t-1))*e,o=s*(1-Math.abs(r%2-1)),a=0,l=0,u=0;r>=0&&r<1?(a=s,l=o):r>=1&&r<2?(a=o,l=s):r>=2&&r<3?(l=s,u=o):r>=3&&r<4?(l=o,u=s):r>=4&&r<5?(a=o,u=s):r>=5&&r<6&&(a=s,u=o);var c=t-s/2,h=a+c,d=l+c,f=u+c;return i(h,d,f)}var qD={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};function LK(n){if(typeof n!="string")return n;var e=n.toLowerCase();return qD[e]?"#"+qD[e]:n}var IK=/^#[a-fA-F0-9]{6}$/,UK=/^#[a-fA-F0-9]{8}$/,FK=/^#[a-fA-F0-9]{3}$/,OK=/^#[a-fA-F0-9]{4}$/,Nb=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,BK=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,kK=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,zK=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function uh(n){if(typeof n!="string")throw new Gs(3);var e=LK(n);if(e.match(IK))return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16)};if(e.match(UK)){var t=parseFloat((parseInt(""+e[7]+e[8],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16),alpha:t}}if(e.match(FK))return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16)};if(e.match(OK)){var i=parseFloat((parseInt(""+e[4]+e[4],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16),alpha:i}}var r=Nb.exec(e);if(r)return{red:parseInt(""+r[1],10),green:parseInt(""+r[2],10),blue:parseInt(""+r[3],10)};var s=BK.exec(e.substring(0,50));if(s)return{red:parseInt(""+s[1],10),green:parseInt(""+s[2],10),blue:parseInt(""+s[3],10),alpha:parseFloat(""+s[4])>1?parseFloat(""+s[4])/100:parseFloat(""+s[4])};var o=kK.exec(e);if(o){var a=parseInt(""+o[1],10),l=parseInt(""+o[2],10)/100,u=parseInt(""+o[3],10)/100,c="rgb("+W_(a,l,u)+")",h=Nb.exec(c);if(!h)throw new Gs(4,e,c);return{red:parseInt(""+h[1],10),green:parseInt(""+h[2],10),blue:parseInt(""+h[3],10)}}var d=zK.exec(e.substring(0,50));if(d){var f=parseInt(""+d[1],10),m=parseInt(""+d[2],10)/100,g=parseInt(""+d[3],10)/100,_="rgb("+W_(f,m,g)+")",p=Nb.exec(_);if(!p)throw new Gs(4,e,_);return{red:parseInt(""+p[1],10),green:parseInt(""+p[2],10),blue:parseInt(""+p[3],10),alpha:parseFloat(""+d[4])>1?parseFloat(""+d[4])/100:parseFloat(""+d[4])}}throw new Gs(5)}function GK(n){var e=n.red/255,t=n.green/255,i=n.blue/255,r=Math.max(e,t,i),s=Math.min(e,t,i),o=(r+s)/2;if(r===s)return n.alpha!==void 0?{hue:0,saturation:0,lightness:o,alpha:n.alpha}:{hue:0,saturation:0,lightness:o};var a,l=r-s,u=o>.5?l/(2-r-s):l/(r+s);switch(r){case e:a=(t-i)/l+(t<i?6:0);break;case t:a=(i-e)/l+2;break;default:a=(e-t)/l+4;break}return a*=60,n.alpha!==void 0?{hue:a,saturation:u,lightness:o,alpha:n.alpha}:{hue:a,saturation:u,lightness:o}}function Va(n){return GK(uh(n))}var VK=function(e){return e.length===7&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e},Pb=VK;function Kl(n){var e=n.toString(16);return e.length===1?"0"+e:e}function Db(n){return Kl(Math.round(n*255))}function HK(n,e,t){return Pb("#"+Db(n)+Db(e)+Db(t))}function YD(n,e,t){return W_(n,e,t,HK)}function WK(n,e,t){if(typeof n=="object"&&e===void 0&&t===void 0)return YD(n.hue,n.saturation,n.lightness);throw new Gs(1)}function $K(n,e,t,i){if(typeof n=="object"&&e===void 0&&t===void 0&&i===void 0)return n.alpha>=1?YD(n.hue,n.saturation,n.lightness):"rgba("+W_(n.hue,n.saturation,n.lightness)+","+n.alpha+")";throw new Gs(2)}function KD(n,e,t){if(typeof n=="number"&&typeof e=="number"&&typeof t=="number")return Pb("#"+Kl(n)+Kl(e)+Kl(t));if(typeof n=="object"&&e===void 0&&t===void 0)return Pb("#"+Kl(n.red)+Kl(n.green)+Kl(n.blue));throw new Gs(6)}function $_(n,e,t,i){if(typeof n=="object"&&e===void 0&&t===void 0&&i===void 0)return n.alpha>=1?KD(n.red,n.green,n.blue):"rgba("+n.red+","+n.green+","+n.blue+","+n.alpha+")";throw new Gs(7)}var jK=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},XK=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&typeof e.alpha=="number"},qK=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},YK=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&typeof e.alpha=="number"};function Ha(n){if(typeof n!="object")throw new Gs(8);if(XK(n))return $_(n);if(jK(n))return KD(n);if(YK(n))return $K(n);if(qK(n))return WK(n);throw new Gs(8)}function QD(n,e,t){return function(){var r=t.concat(Array.prototype.slice.call(arguments));return r.length>=e?n.apply(this,r):QD(n,e,r)}}function Tr(n){return QD(n,n.length,[])}function KK(n,e){if(e==="transparent")return e;var t=Va(e);return Ha(Ji({},t,{hue:t.hue+parseFloat(n)}))}Tr(KK);function ch(n,e,t){return Math.max(n,Math.min(e,t))}function QK(n,e){if(e==="transparent")return e;var t=Va(e);return Ha(Ji({},t,{lightness:ch(0,1,t.lightness-parseFloat(n))}))}Tr(QK);function ZK(n,e){if(e==="transparent")return e;var t=Va(e);return Ha(Ji({},t,{saturation:ch(0,1,t.saturation-parseFloat(n))}))}Tr(ZK);function JK(n,e){if(e==="transparent")return e;var t=Va(e);return Ha(Ji({},t,{lightness:ch(0,1,t.lightness+parseFloat(n))}))}Tr(JK);function eQ(n,e,t){if(e==="transparent")return t;if(t==="transparent")return e;if(n===0)return t;var i=uh(e),r=Ji({},i,{alpha:typeof i.alpha=="number"?i.alpha:1}),s=uh(t),o=Ji({},s,{alpha:typeof s.alpha=="number"?s.alpha:1}),a=r.alpha-o.alpha,l=parseFloat(n)*2-1,u=l*a===-1?l:l+a,c=1+l*a,h=(u/c+1)/2,d=1-h,f={red:Math.floor(r.red*h+o.red*d),green:Math.floor(r.green*h+o.green*d),blue:Math.floor(r.blue*h+o.blue*d),alpha:r.alpha*parseFloat(n)+o.alpha*(1-parseFloat(n))};return $_(f)}var tQ=Tr(eQ),ZD=tQ;function nQ(n,e){if(e==="transparent")return e;var t=uh(e),i=typeof t.alpha=="number"?t.alpha:1,r=Ji({},t,{alpha:ch(0,1,(i*100+parseFloat(n)*100)/100)});return $_(r)}var iQ=Tr(nQ),rQ=iQ;function sQ(n,e){if(e==="transparent")return e;var t=Va(e);return Ha(Ji({},t,{saturation:ch(0,1,t.saturation+parseFloat(n))}))}Tr(sQ);function oQ(n,e){return e==="transparent"?e:Ha(Ji({},Va(e),{hue:parseFloat(n)}))}Tr(oQ);function aQ(n,e){return e==="transparent"?e:Ha(Ji({},Va(e),{lightness:parseFloat(n)}))}Tr(aQ);function lQ(n,e){return e==="transparent"?e:Ha(Ji({},Va(e),{saturation:parseFloat(n)}))}Tr(lQ);function uQ(n,e){return e==="transparent"?e:ZD(parseFloat(n),"rgb(0, 0, 0)",e)}Tr(uQ);function cQ(n,e){return e==="transparent"?e:ZD(parseFloat(n),"rgb(255, 255, 255)",e)}Tr(cQ);function hQ(n,e){if(e==="transparent")return e;var t=uh(e),i=typeof t.alpha=="number"?t.alpha:1,r=Ji({},t,{alpha:ch(0,1,+(i*100-parseFloat(n)*100).toFixed(2)/100)});return $_(r)}Tr(hQ);var Ql=Object.freeze({Linear:Object.freeze({None:function(n){return n},In:function(n){return n},Out:function(n){return n},InOut:function(n){return n}}),Quadratic:Object.freeze({In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}}),Cubic:Object.freeze({In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}}),Quartic:Object.freeze({In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}}),Quintic:Object.freeze({In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}}),Sinusoidal:Object.freeze({In:function(n){return 1-Math.sin((1-n)*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return .5*(1-Math.sin(Math.PI*(.5-n)))}}),Exponential:Object.freeze({In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}}),Circular:Object.freeze({In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}}),Elastic:Object.freeze({In:function(n){return n===0?0:n===1?1:-Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI)},Out:function(n){return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n-.1)*5*Math.PI)+1},InOut:function(n){return n===0?0:n===1?1:(n*=2,n<1?-.5*Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI):.5*Math.pow(2,-10*(n-1))*Math.sin((n-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(n){var e=1.70158;return n===1?1:n*n*((e+1)*n-e)},Out:function(n){var e=1.70158;return n===0?0:--n*n*((e+1)*n+e)+1},InOut:function(n){var e=2.5949095;return(n*=2)<1?.5*(n*n*((e+1)*n-e)):.5*((n-=2)*n*((e+1)*n+e)+2)}}),Bounce:Object.freeze({In:function(n){return 1-Ql.Bounce.Out(1-n)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(n){return n<.5?Ql.Bounce.In(n*2)*.5:Ql.Bounce.Out(n*2-1)*.5+.5}}),generatePow:function(n){return n===void 0&&(n=4),n=n<Number.EPSILON?Number.EPSILON:n,n=n>1e4?1e4:n,{In:function(e){return Math.pow(e,n)},Out:function(e){return 1-Math.pow(1-e,n)},InOut:function(e){return e<.5?Math.pow(e*2,n)/2:(1-Math.pow(2-e*2,n))/2+.5}}}}),Xf=function(){return performance.now()},JD=function(){function n(){this._tweens={},this._tweensAddedDuringUpdate={}}return n.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},n.prototype.removeAll=function(){this._tweens={}},n.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},n.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},n.prototype.update=function(e,t){e===void 0&&(e=Xf()),t===void 0&&(t=!1);var i=Object.keys(this._tweens);if(i.length===0)return!1;for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<i.length;r++){var s=this._tweens[i[r]],o=!t;s&&s.update(e,o)===!1&&!t&&delete this._tweens[i[r]]}i=Object.keys(this._tweensAddedDuringUpdate)}return!0},n}(),hh={Linear:function(n,e){var t=n.length-1,i=t*e,r=Math.floor(i),s=hh.Utils.Linear;return e<0?s(n[0],n[1],i):e>1?s(n[t],n[t-1],t-i):s(n[r],n[r+1>t?t:r+1],i-r)},Bezier:function(n,e){for(var t=0,i=n.length-1,r=Math.pow,s=hh.Utils.Bernstein,o=0;o<=i;o++)t+=r(1-e,i-o)*r(e,o)*n[o]*s(i,o);return t},CatmullRom:function(n,e){var t=n.length-1,i=t*e,r=Math.floor(i),s=hh.Utils.CatmullRom;return n[0]===n[t]?(e<0&&(r=Math.floor(i=t*(1+e))),s(n[(r-1+t)%t],n[r],n[(r+1)%t],n[(r+2)%t],i-r)):e<0?n[0]-(s(n[0],n[0],n[1],n[1],-i)-n[0]):e>1?n[t]-(s(n[t],n[t],n[t-1],n[t-1],i-t)-n[t]):s(n[r?r-1:0],n[r],n[t<r+1?t:r+1],n[t<r+2?t:r+2],i-r)},Utils:{Linear:function(n,e,t){return(e-n)*t+n},Bernstein:function(n,e){var t=hh.Utils.Factorial;return t(n)/t(e)/t(n-e)},Factorial:function(){var n=[1];return function(e){var t=1;if(n[e])return n[e];for(var i=e;i>1;i--)t*=i;return n[e]=t,t}}(),CatmullRom:function(n,e,t,i,r){var s=(t-n)*.5,o=(i-e)*.5,a=r*r,l=r*a;return(2*e-2*t+s+o)*l+(-3*e+3*t-2*s-o)*a+s*r+e}}},dQ=function(){function n(){}return n.nextId=function(){return n._nextId++},n._nextId=0,n}(),Lb=new JD,eL=function(){function n(e,t){t===void 0&&(t=Lb),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=Ql.Linear.None,this._interpolationFunction=hh.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=dQ.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return n.prototype.getId=function(){return this._id},n.prototype.isPlaying=function(){return this._isPlaying},n.prototype.isPaused=function(){return this._isPaused},n.prototype.getDuration=function(){return this._duration},n.prototype.to=function(e,t){if(t===void 0&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},n.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},n.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},n.prototype.start=function(e,t){if(e===void 0&&(e=Xf()),t===void 0&&(t=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var i in this._valuesStartRepeat)this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var r={};for(var s in this._valuesEnd)r[s]=this._valuesEnd[s];this._valuesEnd=r}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},n.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},n.prototype._setupProperties=function(e,t,i,r,s){for(var o in i){var a=e[o],l=Array.isArray(a),u=l?"array":typeof a,c=!l&&Array.isArray(i[o]);if(!(u==="undefined"||u==="function")){if(c){var h=i[o];if(h.length===0)continue;for(var d=[a],f=0,m=h.length;f<m;f+=1){var g=this._handleRelativeValue(a,h[f]);if(isNaN(g)){c=!1,console.warn("Found invalid interpolation list. Skipping.");break}d.push(g)}c&&(i[o]=d)}if((u==="object"||l)&&a&&!c){t[o]=l?[]:{};var _=a;for(var p in _)t[o][p]=_[p];r[o]=l?[]:{};var h=i[o];if(!this._isDynamic){var v={};for(var p in h)v[p]=h[p];i[o]=h=v}this._setupProperties(_,t[o],h,r[o],s)}else(typeof t[o]>"u"||s)&&(t[o]=a),l||(t[o]*=1),c?r[o]=i[o].slice().reverse():r[o]=t[o]||0}}},n.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},n.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},n.prototype.pause=function(e){return e===void 0&&(e=Xf()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this),this)},n.prototype.resume=function(e){return e===void 0&&(e=Xf()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},n.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},n.prototype.group=function(e){return e===void 0&&(e=Lb),this._group=e,this},n.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},n.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},n.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},n.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},n.prototype.easing=function(e){return e===void 0&&(e=Ql.Linear.None),this._easingFunction=e,this},n.prototype.interpolation=function(e){return e===void 0&&(e=hh.Linear),this._interpolationFunction=e,this},n.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},n.prototype.onStart=function(e){return this._onStartCallback=e,this},n.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},n.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},n.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},n.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},n.prototype.onStop=function(e){return this._onStopCallback=e,this},n.prototype.update=function(e,t){var i=this,r;if(e===void 0&&(e=Xf()),t===void 0&&(t=!0),this._isPaused)return!0;var s,o=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>o)return!1;t&&this.start(e,!0)}if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var a=e-this._startTime,l=this._duration+((r=this._repeatDelayTime)!==null&&r!==void 0?r:this._delayTime),u=this._duration+this._repeat*l,c=function(){if(i._duration===0||a>u)return 1;var _=Math.trunc(a/l),p=a-_*l,v=Math.min(p/i._duration,1);return v===0&&a===i._duration?1:v},h=c(),d=this._easingFunction(h);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,d),this._onUpdateCallback&&this._onUpdateCallback(this._object,h),this._duration===0||a>=this._duration)if(this._repeat>0){var f=Math.min(Math.trunc((a-this._duration)/l)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=f);for(s in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[s]=="string"&&(this._valuesStartRepeat[s]=this._valuesStartRepeat[s]+parseFloat(this._valuesEnd[s])),this._yoyo&&this._swapEndStartRepeatValues(s),this._valuesStart[s]=this._valuesStartRepeat[s];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=l*f,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var m=0,g=this._chainedTweens.length;m<g;m++)this._chainedTweens[m].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},n.prototype._updateProperties=function(e,t,i,r){for(var s in i)if(t[s]!==void 0){var o=t[s]||0,a=i[s],l=Array.isArray(e[s]),u=Array.isArray(a),c=!l&&u;c?e[s]=this._interpolationFunction(a,r):typeof a=="object"&&a?this._updateProperties(e[s],o,a,r):(a=this._handleRelativeValue(o,a),typeof a=="number"&&(e[s]=o+(a-o)*r))}},n.prototype._handleRelativeValue=function(e,t){return typeof t!="string"?t:t.charAt(0)==="+"||t.charAt(0)==="-"?e+parseFloat(t):parseFloat(t)},n.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],i=this._valuesEnd[e];typeof i=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(i):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},n}(),Vs=Lb;Vs.getAll.bind(Vs),Vs.removeAll.bind(Vs),Vs.add.bind(Vs),Vs.remove.bind(Vs),Vs.update.bind(Vs);var Ib="http://www.w3.org/1999/xhtml";const tL={svg:"http://www.w3.org/2000/svg",xhtml:Ib,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function j_(n){var e=n+="",t=e.indexOf(":");return t>=0&&(e=n.slice(0,t))!=="xmlns"&&(n=n.slice(t+1)),tL.hasOwnProperty(e)?{space:tL[e],local:n}:n}function fQ(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===Ib&&e.documentElement.namespaceURI===Ib?e.createElement(n):e.createElementNS(t,n)}}function pQ(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function nL(n){var e=j_(n);return(e.local?pQ:fQ)(e)}function mQ(){}function Ub(n){return n==null?mQ:function(){return this.querySelector(n)}}function gQ(n){typeof n!="function"&&(n=Ub(n));for(var e=this._groups,t=e.length,i=new Array(t),r=0;r<t;++r)for(var s=e[r],o=s.length,a=i[r]=new Array(o),l,u,c=0;c<o;++c)(l=s[c])&&(u=n.call(l,l.__data__,c,s))&&("__data__"in l&&(u.__data__=l.__data__),a[c]=u);return new br(i,this._parents)}function _Q(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function vQ(){return[]}function iL(n){return n==null?vQ:function(){return this.querySelectorAll(n)}}function yQ(n){return function(){return _Q(n.apply(this,arguments))}}function xQ(n){typeof n=="function"?n=yQ(n):n=iL(n);for(var e=this._groups,t=e.length,i=[],r=[],s=0;s<t;++s)for(var o=e[s],a=o.length,l,u=0;u<a;++u)(l=o[u])&&(i.push(n.call(l,l.__data__,u,o)),r.push(l));return new br(i,r)}function rL(n){return function(){return this.matches(n)}}function sL(n){return function(e){return e.matches(n)}}var SQ=Array.prototype.find;function TQ(n){return function(){return SQ.call(this.children,n)}}function bQ(){return this.firstElementChild}function wQ(n){return this.select(n==null?bQ:TQ(typeof n=="function"?n:sL(n)))}var MQ=Array.prototype.filter;function EQ(){return Array.from(this.children)}function AQ(n){return function(){return MQ.call(this.children,n)}}function CQ(n){return this.selectAll(n==null?EQ:AQ(typeof n=="function"?n:sL(n)))}function RQ(n){typeof n!="function"&&(n=rL(n));for(var e=this._groups,t=e.length,i=new Array(t),r=0;r<t;++r)for(var s=e[r],o=s.length,a=i[r]=[],l,u=0;u<o;++u)(l=s[u])&&n.call(l,l.__data__,u,s)&&a.push(l);return new br(i,this._parents)}function oL(n){return new Array(n.length)}function NQ(){return new br(this._enter||this._groups.map(oL),this._parents)}function X_(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}X_.prototype={constructor:X_,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function PQ(n){return function(){return n}}function DQ(n,e,t,i,r,s){for(var o=0,a,l=e.length,u=s.length;o<u;++o)(a=e[o])?(a.__data__=s[o],i[o]=a):t[o]=new X_(n,s[o]);for(;o<l;++o)(a=e[o])&&(r[o]=a)}function LQ(n,e,t,i,r,s,o){var a,l,u=new Map,c=e.length,h=s.length,d=new Array(c),f;for(a=0;a<c;++a)(l=e[a])&&(d[a]=f=o.call(l,l.__data__,a,e)+"",u.has(f)?r[a]=l:u.set(f,l));for(a=0;a<h;++a)f=o.call(n,s[a],a,s)+"",(l=u.get(f))?(i[a]=l,l.__data__=s[a],u.delete(f)):t[a]=new X_(n,s[a]);for(a=0;a<c;++a)(l=e[a])&&u.get(d[a])===l&&(r[a]=l)}function IQ(n){return n.__data__}function UQ(n,e){if(!arguments.length)return Array.from(this,IQ);var t=e?LQ:DQ,i=this._parents,r=this._groups;typeof n!="function"&&(n=PQ(n));for(var s=r.length,o=new Array(s),a=new Array(s),l=new Array(s),u=0;u<s;++u){var c=i[u],h=r[u],d=h.length,f=FQ(n.call(c,c&&c.__data__,u,i)),m=f.length,g=a[u]=new Array(m),_=o[u]=new Array(m),p=l[u]=new Array(d);t(c,h,g,_,p,f,e);for(var v=0,y=0,x,S;v<m;++v)if(x=g[v]){for(v>=y&&(y=v+1);!(S=_[y])&&++y<m;);x._next=S||null}}return o=new br(o,i),o._enter=a,o._exit=l,o}function FQ(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function OQ(){return new br(this._exit||this._groups.map(oL),this._parents)}function BQ(n,e,t){var i=this.enter(),r=this,s=this.exit();return typeof n=="function"?(i=n(i),i&&(i=i.selection())):i=i.append(n+""),e!=null&&(r=e(r),r&&(r=r.selection())),t==null?s.remove():t(s),i&&r?i.merge(r).order():r}function kQ(n){for(var e=n.selection?n.selection():n,t=this._groups,i=e._groups,r=t.length,s=i.length,o=Math.min(r,s),a=new Array(r),l=0;l<o;++l)for(var u=t[l],c=i[l],h=u.length,d=a[l]=new Array(h),f,m=0;m<h;++m)(f=u[m]||c[m])&&(d[m]=f);for(;l<r;++l)a[l]=t[l];return new br(a,this._parents)}function zQ(){for(var n=this._groups,e=-1,t=n.length;++e<t;)for(var i=n[e],r=i.length-1,s=i[r],o;--r>=0;)(o=i[r])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function GQ(n){n||(n=VQ);function e(h,d){return h&&d?n(h.__data__,d.__data__):!h-!d}for(var t=this._groups,i=t.length,r=new Array(i),s=0;s<i;++s){for(var o=t[s],a=o.length,l=r[s]=new Array(a),u,c=0;c<a;++c)(u=o[c])&&(l[c]=u);l.sort(e)}return new br(r,this._parents).order()}function VQ(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function HQ(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function WQ(){return Array.from(this)}function $Q(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var i=n[e],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null}function jQ(){let n=0;for(const e of this)++n;return n}function XQ(){return!this.node()}function qQ(n){for(var e=this._groups,t=0,i=e.length;t<i;++t)for(var r=e[t],s=0,o=r.length,a;s<o;++s)(a=r[s])&&n.call(a,a.__data__,s,r);return this}function YQ(n){return function(){this.removeAttribute(n)}}function KQ(n){return function(){this.removeAttributeNS(n.space,n.local)}}function QQ(n,e){return function(){this.setAttribute(n,e)}}function ZQ(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function JQ(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(n):this.setAttribute(n,t)}}function eZ(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}}function tZ(n,e){var t=j_(n);if(arguments.length<2){var i=this.node();return t.local?i.getAttributeNS(t.space,t.local):i.getAttribute(t)}return this.each((e==null?t.local?KQ:YQ:typeof e=="function"?t.local?eZ:JQ:t.local?ZQ:QQ)(t,e))}function aL(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function nZ(n){return function(){this.style.removeProperty(n)}}function iZ(n,e,t){return function(){this.style.setProperty(n,e,t)}}function rZ(n,e,t){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(n):this.style.setProperty(n,i,t)}}function sZ(n,e,t){return arguments.length>1?this.each((e==null?nZ:typeof e=="function"?rZ:iZ)(n,e,t??"")):dh(this.node(),n)}function dh(n,e){return n.style.getPropertyValue(e)||aL(n).getComputedStyle(n,null).getPropertyValue(e)}function oZ(n){return function(){delete this[n]}}function aZ(n,e){return function(){this[n]=e}}function lZ(n,e){return function(){var t=e.apply(this,arguments);t==null?delete this[n]:this[n]=t}}function uZ(n,e){return arguments.length>1?this.each((e==null?oZ:typeof e=="function"?lZ:aZ)(n,e)):this.node()[n]}function lL(n){return n.trim().split(/^|\s+/)}function Fb(n){return n.classList||new uL(n)}function uL(n){this._node=n,this._names=lL(n.getAttribute("class")||"")}uL.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function cL(n,e){for(var t=Fb(n),i=-1,r=e.length;++i<r;)t.add(e[i])}function hL(n,e){for(var t=Fb(n),i=-1,r=e.length;++i<r;)t.remove(e[i])}function cZ(n){return function(){cL(this,n)}}function hZ(n){return function(){hL(this,n)}}function dZ(n,e){return function(){(e.apply(this,arguments)?cL:hL)(this,n)}}function fZ(n,e){var t=lL(n+"");if(arguments.length<2){for(var i=Fb(this.node()),r=-1,s=t.length;++r<s;)if(!i.contains(t[r]))return!1;return!0}return this.each((typeof e=="function"?dZ:e?cZ:hZ)(t,e))}function pZ(){this.textContent=""}function mZ(n){return function(){this.textContent=n}}function gZ(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function _Z(n){return arguments.length?this.each(n==null?pZ:(typeof n=="function"?gZ:mZ)(n)):this.node().textContent}function vZ(){this.innerHTML=""}function yZ(n){return function(){this.innerHTML=n}}function xZ(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function SZ(n){return arguments.length?this.each(n==null?vZ:(typeof n=="function"?xZ:yZ)(n)):this.node().innerHTML}function TZ(){this.nextSibling&&this.parentNode.appendChild(this)}function bZ(){return this.each(TZ)}function wZ(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function MZ(){return this.each(wZ)}function EZ(n){var e=typeof n=="function"?n:nL(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function AZ(){return null}function CZ(n,e){var t=typeof n=="function"?n:nL(n),i=e==null?AZ:typeof e=="function"?e:Ub(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),i.apply(this,arguments)||null)})}function RZ(){var n=this.parentNode;n&&n.removeChild(this)}function NZ(){return this.each(RZ)}function PZ(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function DZ(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function LZ(n){return this.select(n?DZ:PZ)}function IZ(n){return arguments.length?this.property("__data__",n):this.node().__data__}function UZ(n){return function(e){n.call(this,e,this.__data__)}}function FZ(n){return n.trim().split(/^|\s+/).map(function(e){var t="",i=e.indexOf(".");return i>=0&&(t=e.slice(i+1),e=e.slice(0,i)),{type:e,name:t}})}function OZ(n){return function(){var e=this.__on;if(e){for(var t=0,i=-1,r=e.length,s;t<r;++t)s=e[t],(!n.type||s.type===n.type)&&s.name===n.name?this.removeEventListener(s.type,s.listener,s.options):e[++i]=s;++i?e.length=i:delete this.__on}}}function BZ(n,e,t){return function(){var i=this.__on,r,s=UZ(e);if(i){for(var o=0,a=i.length;o<a;++o)if((r=i[o]).type===n.type&&r.name===n.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=t),r.value=e;return}}this.addEventListener(n.type,s,t),r={type:n.type,name:n.name,value:e,listener:s,options:t},i?i.push(r):this.__on=[r]}}function kZ(n,e,t){var i=FZ(n+""),r,s=i.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,u=a.length,c;l<u;++l)for(r=0,c=a[l];r<s;++r)if((o=i[r]).type===c.type&&o.name===c.name)return c.value}return}for(a=e?BZ:OZ,r=0;r<s;++r)this.each(a(i[r],e,t));return this}function dL(n,e,t){var i=aL(n),r=i.CustomEvent;typeof r=="function"?r=new r(e,t):(r=i.document.createEvent("Event"),t?(r.initEvent(e,t.bubbles,t.cancelable),r.detail=t.detail):r.initEvent(e,!1,!1)),n.dispatchEvent(r)}function zZ(n,e){return function(){return dL(this,n,e)}}function GZ(n,e){return function(){return dL(this,n,e.apply(this,arguments))}}function VZ(n,e){return this.each((typeof e=="function"?GZ:zZ)(n,e))}function*HZ(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var i=n[e],r=0,s=i.length,o;r<s;++r)(o=i[r])&&(yield o)}var fL=[null];function br(n,e){this._groups=n,this._parents=e}function qf(){return new br([[document.documentElement]],fL)}function WZ(){return this}br.prototype=qf.prototype={constructor:br,select:gQ,selectAll:xQ,selectChild:wQ,selectChildren:CQ,filter:RQ,data:UQ,enter:NQ,exit:OQ,join:BQ,merge:kQ,selection:WZ,order:zQ,sort:GQ,call:HQ,nodes:WQ,node:$Q,size:jQ,empty:XQ,each:qQ,attr:tZ,style:sZ,property:uZ,classed:fZ,text:_Z,html:SZ,raise:bZ,lower:MZ,append:EZ,insert:CZ,remove:NZ,clone:LZ,datum:IZ,on:kZ,dispatch:VZ,[Symbol.iterator]:HZ};function $Z(n){return typeof n=="string"?new br([[document.querySelector(n)]],[document.documentElement]):new br([[n]],fL)}function jZ(n){let e;for(;e=n.sourceEvent;)n=e;return n}function XZ(n,e){if(n=jZ(n),e===void 0&&(e=n.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var i=t.createSVGPoint();return i.x=n.clientX,i.y=n.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[n.clientX-r.left-e.clientLeft,n.clientY-r.top-e.clientTop]}}return[n.pageX,n.pageY]}var Yf,Kt,pL,mL,Zl,gL,_L,Ob,vL,Bb,kb,zb,Kf={},yL=[],qZ=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Gb=Array.isArray;function Bo(n,e){for(var t in e)n[t]=e[t];return n}function Vb(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function YZ(n,e,t){var i,r,s,o={};for(s in e)s=="key"?i=e[s]:s=="ref"?r=e[s]:o[s]=e[s];if(arguments.length>2&&(o.children=arguments.length>3?Yf.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(s in n.defaultProps)o[s]===void 0&&(o[s]=n.defaultProps[s]);return Qf(n,o,i,r,null)}function Qf(n,e,t,i,r){var s={type:n,props:e,key:t,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r??++pL,__i:-1,__u:0};return r==null&&Kt.vnode!=null&&Kt.vnode(s),s}function q_(n){return n.children}function Y_(n,e){this.props=n,this.context=e}function fh(n,e){if(e==null)return n.__?fh(n.__,n.__i+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?fh(n):null}function xL(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return xL(n)}}function SL(n){(!n.__d&&(n.__d=!0)&&Zl.push(n)&&!K_.__r++||gL!==Kt.debounceRendering)&&((gL=Kt.debounceRendering)||_L)(K_)}function K_(){var n,e,t,i,r,s,o,a;for(Zl.sort(Ob);n=Zl.shift();)n.__d&&(e=Zl.length,i=void 0,s=(r=(t=n).__v).__e,o=[],a=[],t.__P&&((i=Bo({},r)).__v=r.__v+1,Kt.vnode&&Kt.vnode(i),Hb(t.__P,i,r,t.__n,t.__P.namespaceURI,32&r.__u?[s]:null,o,s??fh(r),!!(32&r.__u),a),i.__v=r.__v,i.__.__k[i.__i]=i,EL(o,i,a),i.__e!=s&&xL(i)),Zl.length>e&&Zl.sort(Ob));K_.__r=0}function TL(n,e,t,i,r,s,o,a,l,u,c){var h,d,f,m,g,_,p=i&&i.__k||yL,v=e.length;for(l=KZ(t,e,p,l,v),h=0;h<v;h++)(f=t.__k[h])!=null&&(d=f.__i===-1?Kf:p[f.__i]||Kf,f.__i=h,_=Hb(n,f,d,r,s,o,a,l,u,c),m=f.__e,f.ref&&d.ref!=f.ref&&(d.ref&&Wb(d.ref,null,f),c.push(f.ref,f.__c||m,f)),g==null&&m!=null&&(g=m),4&f.__u||d.__k===f.__k?l=bL(f,l,n):typeof f.type=="function"&&_!==void 0?l=_:m&&(l=m.nextSibling),f.__u&=-7);return t.__e=g,l}function KZ(n,e,t,i,r){var s,o,a,l,u,c=t.length,h=c,d=0;for(n.__k=new Array(r),s=0;s<r;s++)(o=e[s])!=null&&typeof o!="boolean"&&typeof o!="function"?(l=s+d,(o=n.__k[s]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?Qf(null,o,null,null,null):Gb(o)?Qf(q_,{children:o},null,null,null):o.constructor===void 0&&o.__b>0?Qf(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=n,o.__b=n.__b+1,a=null,(u=o.__i=QZ(o,t,l,h))!==-1&&(h--,(a=t[u])&&(a.__u|=2)),a==null||a.__v===null?(u==-1&&d--,typeof o.type!="function"&&(o.__u|=4)):u!=l&&(u==l-1?d--:u==l+1?d++:(u>l?d--:d++,o.__u|=4))):n.__k[s]=null;if(h)for(s=0;s<c;s++)(a=t[s])!=null&&!(2&a.__u)&&(a.__e==i&&(i=fh(a)),AL(a,a));return i}function bL(n,e,t){var i,r;if(typeof n.type=="function"){for(i=n.__k,r=0;i&&r<i.length;r++)i[r]&&(i[r].__=n,e=bL(i[r],e,t));return e}n.__e!=e&&(e&&n.type&&!t.contains(e)&&(e=fh(n)),t.insertBefore(n.__e,e||null),e=n.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function QZ(n,e,t,i){var r,s,o=n.key,a=n.type,l=e[t];if(l===null||l&&o==l.key&&a===l.type&&!(2&l.__u))return t;if(i>(l!=null&&!(2&l.__u)?1:0))for(r=t-1,s=t+1;r>=0||s<e.length;){if(r>=0){if((l=e[r])&&!(2&l.__u)&&o==l.key&&a===l.type)return r;r--}if(s<e.length){if((l=e[s])&&!(2&l.__u)&&o==l.key&&a===l.type)return s;s++}}return-1}function wL(n,e,t){e[0]=="-"?n.setProperty(e,t??""):n[e]=t==null?"":typeof t!="number"||qZ.test(e)?t:t+"px"}function Q_(n,e,t,i,r){var s;e:if(e=="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof i=="string"&&(n.style.cssText=i=""),i)for(e in i)t&&e in t||wL(n.style,e,"");if(t)for(e in t)i&&t[e]===i[e]||wL(n.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(vL,"$1")),e=e.toLowerCase()in n||e=="onFocusOut"||e=="onFocusIn"?e.toLowerCase().slice(2):e.slice(2),n.l||(n.l={}),n.l[e+s]=t,t?i?t.u=i.u:(t.u=Bb,n.addEventListener(e,s?zb:kb,s)):n.removeEventListener(e,s?zb:kb,s);else{if(r=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in n)try{n[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?n.removeAttribute(e):n.setAttribute(e,e=="popover"&&t==1?"":t))}}function ML(n){return function(e){if(this.l){var t=this.l[e.type+n];if(e.t==null)e.t=Bb++;else if(e.t<t.u)return;return t(Kt.event?Kt.event(e):e)}}}function Hb(n,e,t,i,r,s,o,a,l,u){var c,h,d,f,m,g,_,p,v,y,x,S,T,w,E,M,b,C=e.type;if(e.constructor!==void 0)return null;128&t.__u&&(l=!!(32&t.__u),s=[a=e.__e=t.__e]),(c=Kt.__b)&&c(e);e:if(typeof C=="function")try{if(p=e.props,v="prototype"in C&&C.prototype.render,y=(c=C.contextType)&&i[c.__c],x=c?y?y.props.value:c.__:i,t.__c?_=(h=e.__c=t.__c).__=h.__E:(v?e.__c=h=new C(p,x):(e.__c=h=new Y_(p,x),h.constructor=C,h.render=JZ),y&&y.sub(h),h.props=p,h.state||(h.state={}),h.context=x,h.__n=i,d=h.__d=!0,h.__h=[],h._sb=[]),v&&h.__s==null&&(h.__s=h.state),v&&C.getDerivedStateFromProps!=null&&(h.__s==h.state&&(h.__s=Bo({},h.__s)),Bo(h.__s,C.getDerivedStateFromProps(p,h.__s))),f=h.props,m=h.state,h.__v=e,d)v&&C.getDerivedStateFromProps==null&&h.componentWillMount!=null&&h.componentWillMount(),v&&h.componentDidMount!=null&&h.__h.push(h.componentDidMount);else{if(v&&C.getDerivedStateFromProps==null&&p!==f&&h.componentWillReceiveProps!=null&&h.componentWillReceiveProps(p,x),!h.__e&&(h.shouldComponentUpdate!=null&&h.shouldComponentUpdate(p,h.__s,x)===!1||e.__v==t.__v)){for(e.__v!=t.__v&&(h.props=p,h.state=h.__s,h.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(I){I&&(I.__=e)}),S=0;S<h._sb.length;S++)h.__h.push(h._sb[S]);h._sb=[],h.__h.length&&o.push(h);break e}h.componentWillUpdate!=null&&h.componentWillUpdate(p,h.__s,x),v&&h.componentDidUpdate!=null&&h.__h.push(function(){h.componentDidUpdate(f,m,g)})}if(h.context=x,h.props=p,h.__P=n,h.__e=!1,T=Kt.__r,w=0,v){for(h.state=h.__s,h.__d=!1,T&&T(e),c=h.render(h.props,h.state,h.context),E=0;E<h._sb.length;E++)h.__h.push(h._sb[E]);h._sb=[]}else do h.__d=!1,T&&T(e),c=h.render(h.props,h.state,h.context),h.state=h.__s;while(h.__d&&++w<25);h.state=h.__s,h.getChildContext!=null&&(i=Bo(Bo({},i),h.getChildContext())),v&&!d&&h.getSnapshotBeforeUpdate!=null&&(g=h.getSnapshotBeforeUpdate(f,m)),a=TL(n,Gb(M=c!=null&&c.type===q_&&c.key==null?c.props.children:c)?M:[M],e,t,i,r,s,o,a,l,u),h.base=e.__e,e.__u&=-161,h.__h.length&&o.push(h),_&&(h.__E=h.__=null)}catch(I){if(e.__v=null,l||s!=null)if(I.then){for(e.__u|=l?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;s[s.indexOf(a)]=null,e.__e=a}else for(b=s.length;b--;)Vb(s[b]);else e.__e=t.__e,e.__k=t.__k;Kt.__e(I,e,t)}else s==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):a=e.__e=ZZ(t.__e,e,t,i,r,s,o,l,u);return(c=Kt.diffed)&&c(e),128&e.__u?void 0:a}function EL(n,e,t){for(var i=0;i<t.length;i++)Wb(t[i],t[++i],t[++i]);Kt.__c&&Kt.__c(e,n),n.some(function(r){try{n=r.__h,r.__h=[],n.some(function(s){s.call(r)})}catch(s){Kt.__e(s,r.__v)}})}function ZZ(n,e,t,i,r,s,o,a,l){var u,c,h,d,f,m,g,_=t.props,p=e.props,v=e.type;if(v=="svg"?r="http://www.w3.org/2000/svg":v=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),s!=null){for(u=0;u<s.length;u++)if((f=s[u])&&"setAttribute"in f==!!v&&(v?f.localName==v:f.nodeType==3)){n=f,s[u]=null;break}}if(n==null){if(v==null)return document.createTextNode(p);n=document.createElementNS(r,v,p.is&&p),a&&(Kt.__m&&Kt.__m(e,s),a=!1),s=null}if(v===null)_===p||a&&n.data===p||(n.data=p);else{if(s=s&&Yf.call(n.childNodes),_=t.props||Kf,!a&&s!=null)for(_={},u=0;u<n.attributes.length;u++)_[(f=n.attributes[u]).name]=f.value;for(u in _)if(f=_[u],u!="children"){if(u=="dangerouslySetInnerHTML")h=f;else if(!(u in p)){if(u=="value"&&"defaultValue"in p||u=="checked"&&"defaultChecked"in p)continue;Q_(n,u,null,f,r)}}for(u in p)f=p[u],u=="children"?d=f:u=="dangerouslySetInnerHTML"?c=f:u=="value"?m=f:u=="checked"?g=f:a&&typeof f!="function"||_[u]===f||Q_(n,u,f,_[u],r);if(c)a||h&&(c.__html===h.__html||c.__html===n.innerHTML)||(n.innerHTML=c.__html),e.__k=[];else if(h&&(n.innerHTML=""),TL(n,Gb(d)?d:[d],e,t,i,v=="foreignObject"?"http://www.w3.org/1999/xhtml":r,s,o,s?s[0]:t.__k&&fh(t,0),a,l),s!=null)for(u=s.length;u--;)Vb(s[u]);a||(u="value",v=="progress"&&m==null?n.removeAttribute("value"):m!==void 0&&(m!==n[u]||v=="progress"&&!m||v=="option"&&m!==_[u])&&Q_(n,u,m,_[u],r),u="checked",g!==void 0&&g!==n[u]&&Q_(n,u,g,_[u],r))}return n}function Wb(n,e,t){try{if(typeof n=="function"){var i=typeof n.__u=="function";i&&n.__u(),i&&e==null||(n.__u=n(e))}else n.current=e}catch(r){Kt.__e(r,t)}}function AL(n,e,t){var i,r;if(Kt.unmount&&Kt.unmount(n),(i=n.ref)&&(i.current&&i.current!==n.__e||Wb(i,null,e)),(i=n.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(s){Kt.__e(s,e)}i.base=i.__P=null}if(i=n.__k)for(r=0;r<i.length;r++)i[r]&&AL(i[r],e,t||typeof n.type!="function");t||Vb(n.__e),n.__c=n.__=n.__e=void 0}function JZ(n,e,t){return this.constructor(n,t)}function eJ(n,e,t){var i,r,s,o;e==document&&(e=document.documentElement),Kt.__&&Kt.__(n,e),r=(i=!1)?null:e.__k,s=[],o=[],Hb(e,n=e.__k=YZ(q_,null,[n]),r||Kf,Kf,e.namespaceURI,r?null:e.firstChild?Yf.call(e.childNodes):null,s,r?r.__e:e.firstChild,i,o),EL(s,n,o)}function CL(n,e,t){var i,r,s,o,a=Bo({},n.props);for(s in n.type&&n.type.defaultProps&&(o=n.type.defaultProps),e)s=="key"?i=e[s]:s=="ref"?r=e[s]:a[s]=e[s]===void 0&&o!==void 0?o[s]:e[s];return arguments.length>2&&(a.children=arguments.length>3?Yf.call(arguments,2):t),Qf(n.type,a,i||n.key,r||n.ref,null)}Yf=yL.slice,Kt={__e:function(n,e,t,i){for(var r,s,o;e=e.__;)if((r=e.__c)&&!r.__)try{if((s=r.constructor)&&s.getDerivedStateFromError!=null&&(r.setState(s.getDerivedStateFromError(n)),o=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(n,i||{}),o=r.__d),o)return r.__E=r}catch(a){n=a}throw n}},pL=0,mL=function(n){return n!=null&&n.constructor==null},Y_.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=Bo({},this.state),typeof n=="function"&&(n=n(Bo({},t),this.props)),n&&Bo(t,n),n!=null&&this.__v&&(e&&this._sb.push(e),SL(this))},Y_.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),SL(this))},Y_.prototype.render=q_,Zl=[],_L=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Ob=function(n,e){return n.__v.__b-e.__v.__b},K_.__r=0,vL=/(PointerCapture)$|Capture$/i,Bb=0,kb=ML(!1),zb=ML(!0);function RL(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function tJ(n){if(Array.isArray(n))return n}function nJ(n,e,t){return(e=lJ(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function iJ(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,r,s,o,a=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(i=s.call(t)).done)&&(a.push(i.value),a.length!==e);l=!0);}catch(c){u=!0,r=c}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(u)throw r}}return a}}function rJ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function NL(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function sJ(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?NL(Object(t),!0).forEach(function(i){nJ(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):NL(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function oJ(n,e){return tJ(n)||iJ(n,e)||uJ(n,e)||rJ()}function aJ(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function lJ(n){var e=aJ(n,"string");return typeof e=="symbol"?e:e+""}function Z_(n){"@babel/helpers - typeof";return Z_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Z_(n)}function uJ(n,e){if(n){if(typeof n=="string")return RL(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?RL(n,e):void 0}}var $b=function(e){if(Z_(e)!=="object")return e;var t=CL(e);if(t.props){var i;t.props=sJ({},t.props),t!=null&&(i=t.props)!==null&&i!==void 0&&i.children&&(t.props.children=Array.isArray(t.props.children)?t.props.children.map($b):$b(t.props.children))}return t},cJ=function(e){return mL(CL(e))},hJ=function(e,t){delete t.__k,eJ($b(e),t)};function dJ(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}}var fJ=`.float-tooltip-kap {
  position: absolute;
  width: max-content; /* prevent shrinking near right edge */
  max-width: max(50%, 150px);
  padding: 3px 5px;
  border-radius: 3px;
  font: 12px sans-serif;
  color: #eee;
  background: rgba(0,0,0,0.6);
  pointer-events: none;
}
`;dJ(fJ);var pJ=Fg({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=i.style,s=r===void 0?{}:r,o=!!e&&Z_(e)==="object"&&!!e.node&&typeof e.node=="function",a=$Z(o?e.node():e);a.style("position")==="static"&&a.style("position","relative"),t.tooltipEl=a.append("div").attr("class","float-tooltip-kap"),Object.entries(s).forEach(function(u){var c=oJ(u,2),h=c[0],d=c[1];return t.tooltipEl.style(h,d)}),t.tooltipEl.style("left","-10000px").style("display","none");var l="tooltip-".concat(Math.round(Math.random()*1e12));t.mouseInside=!1,a.on("mousemove.".concat(l),function(u){t.mouseInside=!0;var c=XZ(u),h=a.node(),d=h.offsetWidth,f=h.offsetHeight,m=[t.offsetX===null||t.offsetX===void 0?"-".concat(c[0]/d*100,"%"):typeof t.offsetX=="number"?"calc(-50% + ".concat(t.offsetX,"px)"):t.offsetX,t.offsetY===null||t.offsetY===void 0?f>130&&f-c[1]<100?"calc(-100% - 6px)":"21px":typeof t.offsetY=="number"?t.offsetY<0?"calc(-100% - ".concat(Math.abs(t.offsetY),"px)"):"".concat(t.offsetY,"px"):t.offsetY];t.tooltipEl.style("left",c[0]+"px").style("top",c[1]+"px").style("transform","translate(".concat(m.join(","),")")),t.content&&t.tooltipEl.style("display","inline")}),a.on("mouseover.".concat(l),function(){t.mouseInside=!0,t.content&&t.tooltipEl.style("display","inline")}),a.on("mouseout.".concat(l),function(){t.mouseInside=!1,t.tooltipEl.style("display","none")})},update:function(e){e.tooltipEl.style("display",e.content&&e.mouseInside?"inline":"none"),e.content?e.content instanceof HTMLElement?(e.tooltipEl.text(""),e.tooltipEl.append(function(){return e.content})):typeof e.content=="string"?e.tooltipEl.html(e.content):cJ(e.content)?(e.tooltipEl.text(""),hJ(e.content,e.tooltipEl.node())):(e.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",e.content,e.content.toString())):e.tooltipEl.text("")}});function mJ(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}}var gJ=`.scene-nav-info {
  position: absolute;
  bottom: 5px;
  width: 100%;
  text-align: center;
  color: slategrey;
  opacity: 0.7;
  font-size: 10px;
  font-family: sans-serif;
  pointer-events: none;
  user-select: none;
}

.scene-container canvas:focus {
  outline: none;
}`;mJ(gJ);function jb(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function _J(n){if(Array.isArray(n))return n}function vJ(n){if(Array.isArray(n))return jb(n)}function yJ(n,e,t){return(e=EJ(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function xJ(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function SJ(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,r,s,o,a=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(i=s.call(t)).done)&&(a.push(i.value),a.length!==e);l=!0);}catch(c){u=!0,r=c}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(u)throw r}}return a}}function TJ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bJ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wJ(n,e){return _J(n)||SJ(n,e)||PL(n,e)||TJ()}function Zf(n){return vJ(n)||xJ(n)||PL(n)||bJ()}function MJ(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function EJ(n){var e=MJ(n,"string");return typeof e=="symbol"?e:e+""}function PL(n,e){if(n){if(typeof n=="string")return jb(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?jb(n,e):void 0}}var Qt=window.THREE?window.THREE:{WebGLRenderer:W4,Scene:Dx,PerspectiveCamera:Ai,Raycaster:_C,SRGBColorSpace:Be,TextureLoader:PB,Vector2:he,Vector3:N,Box3:wl,Color:Ue,Mesh:$n,SphereGeometry:Qd,MeshBasicMaterial:Vd,BackSide:Xt,EventDispatcher:co,MOUSE:Vn,Quaternion:ss,Spherical:Kx,Clock:pC},DL=Fg({props:{width:{default:window.innerWidth,onChange:function(e,t,i){isNaN(e)&&(t.width=i)}},height:{default:window.innerHeight,onChange:function(e,t,i){isNaN(e)&&(t.height=i)}},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(e,t){t.hoverObj=null,t.tooltip&&t.tooltip.content(null)},triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},pointsHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(e){if(e.initialised){if(e.controls.update&&e.controls.update(Math.min(1,e.clock.getDelta())),e.postProcessingComposer?e.postProcessingComposer.render():e.renderer.render(e.scene,e.camera),e.extraRenderers.forEach(function(s){return s.render(e.scene,e.camera)}),e.enablePointerInteraction){var t=null;if(e.hoverDuringDrag||!e.isPointerDragging){var i=this.intersectingObjects(e.pointerPos.x,e.pointerPos.y);e.hoverOrderComparator&&i.sort(function(s,o){return e.hoverOrderComparator(s.object,o.object)});var r=i.find(function(s){return e.hoverFilter(s.object)})||null;t=r?r.object:null,e.intersection=r||null}t!==e.hoverObj&&(e.onHover(t,e.hoverObj,e.intersection),e.tooltip.content(t&&yt(e.tooltipContent)(t,e.intersection)||null),e.hoverObj=t)}e.tweenGroup.update()}return this},getPointerPos:function(e){var t=e.pointerPos,i=t.x,r=t.y;return{x:i,y:r}},cameraPosition:function(e,t,i,r){var s=e.camera;if(t&&e.initialised){var o=t,a=i||{x:0,y:0,z:0};if(!r)c(o),h(a);else{var l=Object.assign({},s.position),u=d();e.tweenGroup.add(new eL(l).to(o,r).easing(Ql.Quadratic.Out).onUpdate(c).start()),e.tweenGroup.add(new eL(u).to(a,r/3).easing(Ql.Quadratic.Out).onUpdate(h).start())}return this}return Object.assign({},s.position,{lookAt:d()});function c(f){var m=f.x,g=f.y,_=f.z;m!==void 0&&(s.position.x=m),g!==void 0&&(s.position.y=g),_!==void 0&&(s.position.z=_)}function h(f){var m=new Qt.Vector3(f.x,f.y,f.z);e.controls.target?e.controls.target=m:s.lookAt(m)}function d(){return Object.assign(new Qt.Vector3(0,0,-1e3).applyQuaternion(s.quaternion).add(s.position))}},zoomToFit:function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,r=arguments.length,s=new Array(r>3?r-3:0),o=3;o<r;o++)s[o-3]=arguments[o];return this.fitToBbox(this.getBbox.apply(this,s),t,i)},fitToBbox:function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:10,s=e.camera;if(t){var o=new Qt.Vector3(0,0,0),a=Math.max.apply(Math,Zf(Object.entries(t).map(function(f){var m=wJ(f,2),g=m[0],_=m[1];return Math.max.apply(Math,Zf(_.map(function(p){return Math.abs(o[g]-p)})))})))*2,l=(1-r*2/e.height)*s.fov,u=a/Math.atan(l*Math.PI/180),c=u/s.aspect,h=Math.max(u,c);if(h>0){var d=o.clone().sub(s.position).normalize().multiplyScalar(-h);this.cameraPosition(d,o,i)}}return this},getBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},i=new Qt.Box3(new Qt.Vector3(0,0,0),new Qt.Vector3(0,0,0)),r=e.objects.filter(t);return r.length?(r.forEach(function(s){return i.expandByObject(s)}),Object.assign.apply(Object,Zf(["x","y","z"].map(function(s){return yJ({},s,[i.min[s],i.max[s]])})))):null},getScreenCoords:function(e,t,i,r){var s=new Qt.Vector3(t,i,r);return s.project(this.camera()),{x:(s.x+1)*e.width/2,y:-(s.y-1)*e.height/2}},getSceneCoords:function(e,t,i){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=new Qt.Vector2(t/e.width*2-1,-(i/e.height)*2+1),o=new Qt.Raycaster;return o.setFromCamera(s,e.camera),Object.assign({},o.ray.at(r,new Qt.Vector3))},intersectingObjects:function(e,t,i){var r=new Qt.Vector2(t/e.width*2-1,-(i/e.height)*2+1),s=new Qt.Raycaster;return s.params.Line.threshold=e.lineHoverPrecision,s.params.Points.threshold=e.pointsHoverPrecision,s.setFromCamera(r,e.camera),s.intersectObjects(e.objects,!0)},renderer:function(e){return e.renderer},scene:function(e){return e.scene},camera:function(e){return e.camera},postProcessingComposer:function(e){return e.postProcessingComposer},controls:function(e){return e.controls},tbControls:function(e){return e.controls}},stateInit:function(){return{scene:new Qt.Scene,camera:new Qt.PerspectiveCamera,clock:new Qt.Clock,tweenGroup:new JD}},init:function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=i.controlType,s=r===void 0?"trackball":r,o=i.useWebGPU,a=o===void 0?!1:o,l=i.rendererConfig,u=l===void 0?{}:l,c=i.extraRenderers,h=c===void 0?[]:c,d=i.waitForLoadComplete,f=d===void 0?!0:d;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.className="scene-container",t.container.style.position="relative",t.container.appendChild(t.navInfo=document.createElement("div")),t.navInfo.className="scene-nav-info",t.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[s]||"",t.navInfo.style.display=t.showNavInfo?null:"none",t.tooltip=new pJ(t.container),t.pointerPos=new Qt.Vector2,t.pointerPos.x=-2,t.pointerPos.y=-2,["pointermove","pointerdown"].forEach(function(m){return t.container.addEventListener(m,function(g){if(m==="pointerdown"&&(t.isPointerPressed=!0),!t.isPointerDragging&&g.type==="pointermove"&&(g.pressure>0||t.isPointerPressed)&&(g.pointerType!=="touch"||g.movementX===void 0||[g.movementX,g.movementY].some(function(v){return Math.abs(v)>1}))&&(t.isPointerDragging=!0),t.enablePointerInteraction){var _=p(t.container);t.pointerPos.x=g.pageX-_.left,t.pointerPos.y=g.pageY-_.top}function p(v){var y=v.getBoundingClientRect(),x=window.pageXOffset||document.documentElement.scrollLeft,S=window.pageYOffset||document.documentElement.scrollTop;return{top:y.top+S,left:y.left+x}}},{passive:!0})}),t.container.addEventListener("pointerup",function(m){t.isPointerPressed=!1,!(t.isPointerDragging&&(t.isPointerDragging=!1,!t.clickAfterDrag))&&requestAnimationFrame(function(){m.button===0&&t.onClick(t.hoverObj||null,m,t.intersection),m.button===2&&t.onRightClick&&t.onRightClick(t.hoverObj||null,m,t.intersection)})},{passive:!0,capture:!0}),t.container.addEventListener("contextmenu",function(m){t.onRightClick&&m.preventDefault()}),t.renderer=new(a?LY:Qt.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},u)),t.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),t.container.appendChild(t.renderer.domElement),t.extraRenderers=h,t.extraRenderers.forEach(function(m){m.domElement.style.position="absolute",m.domElement.style.top="0px",m.domElement.style.pointerEvents="none",t.container.appendChild(m.domElement)}),t.postProcessingComposer=new EK(t.renderer),t.postProcessingComposer.addPass(new AK(t.scene,t.camera)),t.controls=new{trackball:UY,orbit:QY,fly:hK}[s](t.camera,t.renderer.domElement),s==="fly"&&(t.controls.movementSpeed=300,t.controls.rollSpeed=Math.PI/6,t.controls.dragToLook=!0),(s==="trackball"||s==="orbit")&&(t.controls.minDistance=.1,t.controls.maxDistance=t.skyRadius,t.controls.addEventListener("start",function(){t.controlsEngaged=!0}),t.controls.addEventListener("change",function(){t.controlsEngaged&&(t.controlsDragging=!0)}),t.controls.addEventListener("end",function(){t.controlsEngaged=!1,t.controlsDragging=!1})),[t.renderer,t.postProcessingComposer].concat(Zf(t.extraRenderers)).forEach(function(m){return m.setSize(t.width,t.height)}),t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),t.camera.position.z=1e3,t.scene.add(t.skysphere=new Qt.Mesh),t.skysphere.visible=!1,t.loadComplete=t.scene.visible=!f,window.scene=t.scene},update:function(e,t){if(e.width&&e.height&&(t.hasOwnProperty("width")||t.hasOwnProperty("height"))&&(e.container.style.width="".concat(e.width,"px"),e.container.style.height="".concat(e.height,"px"),[e.renderer,e.postProcessingComposer].concat(Zf(e.extraRenderers)).forEach(function(s){return s.setSize(e.width,e.height)}),e.camera.aspect=e.width/e.height,e.camera.updateProjectionMatrix()),t.hasOwnProperty("skyRadius")&&e.skyRadius&&(e.controls.hasOwnProperty("maxDistance")&&t.skyRadius&&(e.controls.maxDistance=Math.min(e.controls.maxDistance,e.skyRadius)),e.camera.far=e.skyRadius*2.5,e.camera.updateProjectionMatrix(),e.skysphere.geometry=new Qt.SphereGeometry(e.skyRadius)),t.hasOwnProperty("backgroundColor")){var i=uh(e.backgroundColor).alpha;i===void 0&&(i=1),e.renderer.setClearColor(new Qt.Color(rQ(1,e.backgroundColor)),i)}t.hasOwnProperty("backgroundImageUrl")&&(e.backgroundImageUrl?new Qt.TextureLoader().load(e.backgroundImageUrl,function(s){s.colorSpace=Qt.SRGBColorSpace,e.skysphere.material=new Qt.MeshBasicMaterial({map:s,side:Qt.BackSide}),e.skysphere.visible=!0,e.onBackgroundImageLoaded&&setTimeout(e.onBackgroundImageLoaded),!e.loadComplete&&r()}):(e.skysphere.visible=!1,e.skysphere.material.map=null,!e.loadComplete&&r())),t.hasOwnProperty("showNavInfo")&&(e.navInfo.style.display=e.showNavInfo?null:"none"),t.hasOwnProperty("lights")&&((t.lights||[]).forEach(function(s){return e.scene.remove(s)}),e.lights.forEach(function(s){return e.scene.add(s)})),t.hasOwnProperty("objects")&&((t.objects||[]).forEach(function(s){return e.scene.remove(s)}),e.objects.forEach(function(s){return e.scene.add(s)}));function r(){e.loadComplete=e.scene.visible=!0}}});function AJ(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}}var CJ=`.graph-info-msg {
  top: 50%;
  width: 100%;
  text-align: center;
  color: lavender;
  opacity: 0.7;
  font-size: 22px;
  position: absolute;
  font-family: Sans-serif;
}

.scene-container .clickable {
  cursor: pointer;
}

.scene-container .grabbable {
  cursor: move;
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

.scene-container .grabbable:active {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
}`;AJ(CJ);function Xb(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function RJ(n){if(Array.isArray(n))return Xb(n)}function Jf(n,e,t){return(e=LJ(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function NJ(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function PJ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LL(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function J_(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?LL(Object(t),!0).forEach(function(i){Jf(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):LL(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function e0(n){return RJ(n)||NJ(n)||IJ(n)||PJ()}function DJ(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function LJ(n){var e=DJ(n,"string");return typeof e=="symbol"?e:e+""}function IJ(n,e){if(n){if(typeof n=="string")return Xb(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Xb(n,e):void 0}}function IL(n,e){var t=new e;return t._destructor&&t._destructor(),{linkProp:function(r){return{default:t[r](),onChange:function(o,a){a[n][r](o)},triggerUpdate:!1}},linkMethod:function(r){return function(s){for(var o=s[n],a=arguments.length,l=new Array(a>1?a-1:0),u=1;u<a;u++)l[u-1]=arguments[u];var c=o[r].apply(o,l);return c===o?this:c}}}}var qb=window.THREE?window.THREE:{AmbientLight:fC,DirectionalLight:dC,Vector3:N,REVISION:Gu},UJ=170,UL=IL("forceGraph",FN),FJ=Object.assign.apply(Object,e0(["jsonUrl","graphData","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaDecay","d3VelocityDecay","d3AlphaMin","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map(function(n){return Jf({},n,UL.linkProp(n))}))),OJ=Object.assign.apply(Object,e0(["refresh","getGraphBbox","d3Force","d3ReheatSimulation","emitParticle"].map(function(n){return Jf({},n,UL.linkMethod(n))}))),t0=IL("renderObjs",DL),BJ=Object.assign.apply(Object,e0(["width","height","backgroundColor","showNavInfo","enablePointerInteraction"].map(function(n){return Jf({},n,t0.linkProp(n))}))),kJ=Object.assign.apply(Object,e0(["lights","cameraPosition","postProcessingComposer"].map(function(n){return Jf({},n,t0.linkMethod(n))})).concat([{graph2ScreenCoords:t0.linkMethod("getScreenCoords"),screen2GraphCoords:t0.linkMethod("getSceneCoords")}])),zJ=Fg({props:J_(J_({nodeLabel:{default:"name",triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:1,onChange:function(e,t){return t.renderObjs.lineHoverPrecision(e)},triggerUpdate:!1},enableNavigationControls:{default:!0,onChange:function(e,t){var i=t.renderObjs.controls();i&&(i.enabled=e,e&&i.domElement&&i.domElement.dispatchEvent(new PointerEvent("pointerup")))},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1}},FJ),BJ),methods:J_(J_({zoomToFit:function(e,t,i){for(var r,s=arguments.length,o=new Array(s>3?s-3:0),a=3;a<s;a++)o[a-3]=arguments[a];return e.renderObjs.fitToBbox((r=e.forceGraph).getGraphBbox.apply(r,o),t,i),this},pauseAnimation:function(e){return e.animationFrameRequestId!==null&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),this},resumeAnimation:function(e){return e.animationFrameRequestId===null&&this._animationCycle(),this},_animationCycle:function(e){e.enablePointerInteraction&&(this.renderer().domElement.style.cursor=null),e.forceGraph.tickFrame(),e.renderObjs.tick(),e.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},scene:function(e){return e.renderObjs.scene()},camera:function(e){return e.renderObjs.camera()},renderer:function(e){return e.renderObjs.renderer()},controls:function(e){return e.renderObjs.controls()},tbControls:function(e){return e.renderObjs.tbControls()},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},OJ),kJ),stateInit:function(e){var t=e.controlType,i=e.rendererConfig,r=e.extraRenderers,s=new FN;return{forceGraph:s,renderObjs:DL({controlType:t,rendererConfig:i,extraRenderers:r}).objects([s]).lights([new qb.AmbientLight(13421772,Math.PI),new qb.DirectionalLight(16777215,.6*Math.PI)])}},init:function(e,t){e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.style.position="relative";var i=document.createElement("div");t.container.appendChild(i),t.renderObjs(i);var r=t.renderObjs.camera(),s=t.renderObjs.renderer(),o=t.renderObjs.controls();o.enabled=!!t.enableNavigationControls,t.lastSetCameraZ=r.position.z;var a;t.container.appendChild(a=document.createElement("div")),a.className="graph-info-msg",a.textContent="",t.forceGraph.onLoading(function(){a.textContent="Loading..."}).onFinishLoading(function(){a.textContent=""}).onUpdate(function(){t.graphData=t.forceGraph.graphData(),r.position.x===0&&r.position.y===0&&r.position.z===t.lastSetCameraZ&&t.graphData.nodes.length&&(r.lookAt(t.forceGraph.position),t.lastSetCameraZ=r.position.z=Math.cbrt(t.graphData.nodes.length)*UJ)}).onFinishUpdate(function(){if(t._dragControls){var l=t.graphData.nodes.find(function(c){return c.__initialFixedPos&&!c.__disposeControlsAfterDrag});l?l.__disposeControlsAfterDrag=!0:t._dragControls.dispose(),t._dragControls=void 0}if(t.enableNodeDrag&&t.enablePointerInteraction&&t.forceEngine==="d3"){var u=t._dragControls=new $4(t.graphData.nodes.map(function(c){return c.__threeObj}).filter(function(c){return c}),r,s.domElement);u.addEventListener("dragstart",function(c){o.enabled=!1,c.object.__initialPos=c.object.position.clone(),c.object.__prevPos=c.object.position.clone();var h=ko(c.object).__data;!h.__initialFixedPos&&(h.__initialFixedPos={fx:h.fx,fy:h.fy,fz:h.fz}),!h.__initialPos&&(h.__initialPos={x:h.x,y:h.y,z:h.z}),["x","y","z"].forEach(function(d){return h["f".concat(d)]=h[d]}),s.domElement.classList.add("grabbable")}),u.addEventListener("drag",function(c){var h=ko(c.object);if(!c.object.hasOwnProperty("__graphObjType")){var d=c.object.__initialPos,f=c.object.__prevPos,m=c.object.position;h.position.add(m.clone().sub(f)),f.copy(m),m.copy(d)}var g=h.__data,_=h.position,p={x:_.x-g.x,y:_.y-g.y,z:_.z-g.z};["x","y","z"].forEach(function(v){return g["f".concat(v)]=g[v]=_[v]}),t.forceGraph.d3AlphaTarget(.3).resetCountdown(),g.__dragged=!0,t.onNodeDrag(g,p)}),u.addEventListener("dragend",function(c){delete c.object.__initialPos,delete c.object.__prevPos;var h=ko(c.object).__data;h.__disposeControlsAfterDrag&&(u.dispose(),delete h.__disposeControlsAfterDrag);var d=h.__initialFixedPos,f=h.__initialPos,m={x:f.x-h.x,y:f.y-h.y,z:f.z-h.z};d&&(["x","y","z"].forEach(function(g){var _="f".concat(g);d[_]===void 0&&delete h[_]}),delete h.__initialFixedPos,delete h.__initialPos,h.__dragged&&(delete h.__dragged,t.onNodeDragEnd(h,m))),t.forceGraph.d3AlphaTarget(0).resetCountdown(),t.enableNavigationControls&&(o.enabled=!0,o.domElement&&o.domElement.ownerDocument&&o.domElement.ownerDocument.dispatchEvent(new PointerEvent("pointerup",{pointerType:"touch"}))),s.domElement.classList.remove("grabbable")})}}),qb.REVISION<155&&(t.renderObjs.renderer().useLegacyLights=!1),t.renderObjs.hoverOrderComparator(function(l,u){var c=ko(l);if(!c)return 1;var h=ko(u);if(!h)return-1;var d=function(m){return m.__graphObjType==="node"};return d(h)-d(c)}).tooltipContent(function(l){var u=ko(l);return u&&yt(t["".concat(u.__graphObjType,"Label")])(u.__data)||""}).hoverDuringDrag(!1).onHover(function(l){var u=ko(l);if(u!==t.hoverObj){var c=t.hoverObj?t.hoverObj.__graphObjType:null,h=t.hoverObj?t.hoverObj.__data:null,d=u?u.__graphObjType:null,f=u?u.__data:null;if(c&&c!==d){var m=t["on".concat(c==="node"?"Node":"Link","Hover")];m&&m(null,h)}if(d){var g=t["on".concat(d==="node"?"Node":"Link","Hover")];g&&g(f,c===d?h:null)}s.domElement.classList[u&&t["on".concat(d==="node"?"Node":"Link","Click")]||!u&&t.onBackgroundClick?"add":"remove"]("clickable"),t.hoverObj=u}}).clickAfterDrag(!1).onClick(function(l,u){var c=ko(l);if(c){var h=t["on".concat(c.__graphObjType==="node"?"Node":"Link","Click")];h&&h(c.__data,u)}else t.onBackgroundClick&&t.onBackgroundClick(u)}).onRightClick(function(l,u){var c=ko(l);if(c){var h=t["on".concat(c.__graphObjType==="node"?"Node":"Link","RightClick")];h&&h(c.__data,u)}else t.onBackgroundRightClick&&t.onBackgroundRightClick(u)}),this._animationCycle()}});function ko(n){for(var e=n;e&&!e.hasOwnProperty("__graphObjType");)e=e.parent;return e}const Wa={type:{enabled:!1,strength:.1,distance:100},author:{enabled:!0,strength:.2,distance:40},issue:{enabled:!0,strength:1,distance:20},visual:{width:.1,opacity:0,color:"#D7D7D7"},physics:{repulsion:{strength:-400,maxDistance:220},collision:{radius:1,strength:.6},centerForce:!0}};Wa.physics.repulsion.strength,Wa.physics.repulsion.maxDistance,Wa.physics.collision.radius,Wa.physics.collision.strength,Wa.physics.centerForce;const FL=(n=Wa)=>({TYPE:{STRENGTH:n.type.enabled?n.type.strength:0,DISTANCE:n.type.distance},AUTHOR:{STRENGTH:n.author.enabled?n.author.strength:0,DISTANCE:n.author.distance},ISSUE:{STRENGTH:n.issue.enabled?n.issue.strength:0,DISTANCE:n.issue.distance}}),GJ=(n,e=Wa)=>{const t=[];FL(e);const i={};n.forEach(o=>{i[o.type]||(i[o.type]=[]),i[o.type].push(o)}),e.type.enabled&&Object.entries(i).forEach(([o,a])=>{for(let l=0;l<a.length;l++)for(let u=l+1;u<a.length;u++)t.push({source:a[l].id,target:a[u].id,type:"type-link",linkType:o})});const r={};n.forEach(o=>{o.author&&(r[o.author]||(r[o.author]=[]),r[o.author].push(o))}),e.author.enabled&&Object.entries(r).forEach(([o,a])=>{for(let l=0;l<a.length;l++)for(let u=l+1;u<a.length;u++)t.push({source:a[l].id,target:a[u].id,type:"author-link",authorGroup:o})});const s={};return n.forEach(o=>{o.issue&&(s[o.issue]||(s[o.issue]=[]),s[o.issue].push(o))}),e.issue.enabled&&Object.entries(s).forEach(([o,a])=>{for(let l=0;l<a.length;l++)for(let u=l+1;u<a.length;u++)t.push({source:a[l].id,target:a[u].id,type:"issue-link",issueGroup:o})}),t},OL=[{id:"crash-course",topic:'A crash course in "crash course',title:'A crash course in "crash course',descriptor:"The Too-Often-Untold Story of The Totally Uncloneable Hank Green",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/66c35b57bfb182b3b38b3727_66c35791cdd6ab918c5e69ed_Art_3_Splash.avif",author:"nick-gaudio",issue:"com-1-august-2024",tags:"youtube; creators; opinion",type:"article",x:0,y:0,z:0},{id:"like-worth",topic:"What's a like on Instagram 'worth' in 2024?",title:"What's a like on Instagram 'worth' in 2024?",descriptor:"Actually More Than You'd Think!",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/66c35b656b4ad8437c28b691_66c357918e37552c6623c6e7_Art_1_Splash.avif",author:"nick-gaudio",issue:"com-1-august-2024",tags:"instagram; influencers; marketers; creators",type:"article",x:50,y:0,z:0},{id:"speed-sells",topic:"Speed sells: Why it's important to respond lickety-split",title:"Speed sells: Why it's important to respond lickety-split",descriptor:"",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/66c35b883ba1d3f499457b0c_66c357b16fde1d8a9b5a02c5_Art_2_Splash.avif",author:"nick-gaudio",issue:"com-1-august-2024",tags:"marketers; creators; influencers",type:"article",x:-50,y:0,z:0},{id:"survey-creators-psychology",topic:"Survey: reators feeling stress, stress, and careful curations",title:"Survey: reators feeling stress, stress, and careful curations",descriptor:"",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/66f1629c34ce3b4fd720b973_Art_5_Feature.avif",author:"dustin-dooling",issue:"com-2-sep-2024",tags:"creators; survey; trends",type:"article",x:0,y:50,z:0},{id:"creators-in-the-headlights",topic:"Creators in the Headlights: When Big Media Shifts Gears",title:"Creators in the Headlights: When Big Media Shifts Gears",descriptor:"",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/66f162b83bf5eee0c536fc52_Art_6_Feature.avif",author:"robert-hilliard",issue:"com-2-sep-2024",tags:"creators; youtube; news",type:"article",x:50,y:50,z:0},{id:"will-post-for-food",topic:"Will Post for Food",title:"Will Post for Food",descriptor:"",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/66f186f8ea579be24ac2dff4_Art_4_Feature_1.avif",author:"nick-gaudio",issue:"com-2-sep-2024",tags:"opinion; creators; instagram; trends",type:"article",x:-50,y:50,z:0},{id:"robots-red-lace",topic:"Robots & Red Lace",title:"Robots & Red Lace",descriptor:"How OnlyFans Creators Are Using AI for 'Intimacy at Scale'",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/671fa6b106217cf3b311fe44_Feature_A2-3.avif",author:"nick-gaudio",issue:"com-3-edition",tags:"instagram; influencers; creators; bot-builders",type:"article",x:0,y:-50,z:0},{id:"mr-least",topic:"From Mr. Beast to Mr. Least?",title:"From Mr. Beast to Mr. Least?",descriptor:"Lessons from creator to CEO (and the collateral damage along the way)",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/671fa5604eacaedf503f2cd6_Feature_A2-2.avif",author:"ashley-sava",issue:"com-3-edition",tags:"youtube; creators; influencers; news",type:"article",x:50,y:-50,z:0},{id:"parental-discretion-advised",topic:"Parental Discretion (Still) Advised",title:"Parental Discretion (Still) Advised",descriptor:"Going undercover with Instagram's new Teen Accounts",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/671fa6caa89e547b3bd93e0e_Feature_A3.avif",author:"dustin-dooling",issue:"com-3-edition",tags:"instagram; news; marketers; influencers",type:"article",x:-50,y:-50,z:0},{id:"email-doesnt-suck",topic:"It's 2024 and  Wait, Email Doesn't Suck?",title:"It's 2024 and  Wait, Email Doesn't Suck?",descriptor:"Creators, fans, and the strikingly powerful sticking power of getting an email address.",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/671fa6e6883fde668bb72aea_Feature_A5-1.avif",author:"nick-gaudio",issue:"com-3-edition",tags:"opinion; marketers; agencies",type:"article",x:25,y:25,z:25},{id:"cardboard-pizza",topic:"Cardboard Pizza: The Deadly Art of Losing Your Social Media Credibility",title:"Cardboard Pizza: The Deadly Art of Losing Your Social Media Credibility",descriptor:"",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/671fa7127645f993bf2f0470_Feature_A2-4.avif",author:"robert-hilliard",issue:"com-3-edition",tags:"influencers; opinion; trends",type:"article",x:-25,y:25,z:25},{id:"fur-ever-famous",topic:"Fur-Ever Famous",title:"Fur-Ever Famous",descriptor:"When Internet Pets Never (Officially) Die",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/6745a6b288a0d4961d7ec2a9_4_Feature_A1.avif",author:"robert-hilliard",issue:"november-issue",tags:"",type:"article",x:25,y:-25,z:25},{id:"engagement-dread",topic:"Engagement Dread: It's Not Your Fault (But It Kinda Is?)",title:"Engagement Dread: It's Not Your Fault (But It Kinda Is?)",descriptor:"",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/6745a74615e706bbc37165f8_4_Feature_A5.avif",author:"nick-gaudio",issue:"november-issue",tags:"",type:"article",x:-25,y:-25,z:25},{id:"still-posting",topic:"Still Posting Post-Death",title:"Still Posting Post-Death",descriptor:"The future of social: Too many zombies, not enough brains",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/6746f84a23ad26938dddd3c8_Feature_A3.avif",author:"dustin-dooling",issue:"november-issue",tags:"",type:"article",x:25,y:25,z:-25},{id:"mercy-kill",topic:"Mercy Kill Your Online Persona",title:"Mercy Kill Your Online Persona",descriptor:"A Step-by-Step Guide to Euthanizing Your Brand",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/6745a77d1aa6309002cd2f80_4_Feature_A4.avif",author:"ashley-sava",issue:"november-issue",tags:"",type:"article",x:-25,y:25,z:-25},{id:"prove-youre-human",topic:"Prove You're Human",title:"Prove You're Human",descriptor:"",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/6745a7bfefbafc1c8e5fc26d_4_Feature_A2.avif",author:"nick-gaudio",issue:"november-issue",tags:"",type:"article",x:25,y:-25,z:-25},{id:"creator-fortune",topic:"What's Your Creator Fortune?",title:"What's Your Creator Fortune?",descriptor:"Understanding Your Tarot Card Future for 2025",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/676aea529861bfd54580285b_Feature_A3com5.jpg",author:"ashley-sava",issue:"december-issue",tags:"quiz; creators; influencers",type:"special_project",x:-25,y:-25,z:-25},{id:"2025-bingo",topic:"That's Not On My Bingo Card: 2025 edition",title:"That's Not On My Bingo Card: 2025 edition",descriptor:"2025 edition",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/676aea64f1ad8bf1a6a48f0e_Feature_A4com5.jpg",author:"nick-gaudio",issue:"december-issue",tags:"",type:"special_project",x:0,y:0,z:50},{id:"parasocial-paradox",topic:"The Parasocial Paradox",title:"The Parasocial Paradox",descriptor:"The Flipside of Instagram Fame",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/676aea780211dcaef8d6a5fd_Feature_A1com5.jpg",author:"maria-valaikaite",issue:"december-issue",tags:"",type:"article",x:0,y:0,z:-50},{id:"influencers-peaked",topic:"Have Influencers Peaked?",title:"Have Influencers Peaked?",descriptor:"The Glittering Rise and the Quiet Plateau",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/676aead53185ee11f9b23527_Feature_A2com5-1.jpg",author:"robert-hilliard",issue:"december-issue",tags:"",type:"article",x:50,y:0,z:50},{id:"reasons-to-expand",topic:"Right & Wrong Reasons to Expand",title:"Right & Wrong Reasons to Expand",descriptor:"So you want to expand your social media empire? Let's talk about it.",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/6797639025be2e8f0c27d2f7_Feature_A1.jpg",author:"ashley-sava",issue:"january-issue",tags:"",type:"article",x:-50,y:0,z:50}],VJ={nodes:OL,links:GJ(OL)},HJ=({onZoomIn:n,onZoomOut:e,onReset:t})=>Qs.jsxs("div",{className:"com-absolute com-bottom-6 com-left-6 com-flex com-gap-2",children:[Qs.jsx("button",{onClick:n,className:"com-bg-white/90 com-backdrop-blur-sm com-p-2 com-rounded-lg com-shadow-md hover:com-bg-white com-transition-colors","aria-label":"Zoom in",children:"+"}),Qs.jsx("button",{onClick:e,className:"com-bg-white/90 com-backdrop-blur-sm com-p-2 com-rounded-lg com-shadow-md hover:com-bg-white com-transition-colors","aria-label":"Zoom out",children:"-"}),Qs.jsx("button",{onClick:t,className:"com-bg-white/90 com-backdrop-blur-sm com-px-3 com-py-2 com-rounded-lg com-shadow-md hover:com-bg-white com-transition-colors",children:"Reset"})]});var WJ=hS("start","end","cancel","interrupt"),$J=[],BL=0,kL=1,Yb=2,n0=3,zL=4,Kb=5,i0=6;function r0(n,e,t,i,r,s){var o=n.__transition;if(!o)n.__transition={};else if(t in o)return;jJ(n,t,{name:e,index:i,group:r,on:WJ,tween:$J,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:BL})}function Qb(n,e){var t=vs(n,e);if(t.state>BL)throw new Error("too late; already scheduled");return t}function Hs(n,e){var t=vs(n,e);if(t.state>n0)throw new Error("too late; already running");return t}function vs(n,e){var t=n.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function jJ(n,e,t){var i=n.__transition,r;i[e]=t,t.timer=fS(s,0,t.time);function s(u){t.state=kL,t.timer.restart(o,t.delay,t.time),t.delay<=u&&o(u-t.delay)}function o(u){var c,h,d,f;if(t.state!==kL)return l();for(c in i)if(f=i[c],f.name===t.name){if(f.state===n0)return fR(o);f.state===zL?(f.state=i0,f.timer.stop(),f.on.call("interrupt",n,n.__data__,f.index,f.group),delete i[c]):+c<e&&(f.state=i0,f.timer.stop(),f.on.call("cancel",n,n.__data__,f.index,f.group),delete i[c])}if(fR(function(){t.state===n0&&(t.state=zL,t.timer.restart(a,t.delay,t.time),a(u))}),t.state=Yb,t.on.call("start",n,n.__data__,t.index,t.group),t.state===Yb){for(t.state=n0,r=new Array(d=t.tween.length),c=0,h=-1;c<d;++c)(f=t.tween[c].value.call(n,n.__data__,t.index,t.group))&&(r[++h]=f);r.length=h+1}}function a(u){for(var c=u<t.duration?t.ease.call(null,u/t.duration):(t.timer.restart(l),t.state=Kb,1),h=-1,d=r.length;++h<d;)r[h].call(n,c);t.state===Kb&&(t.on.call("end",n,n.__data__,t.index,t.group),l())}function l(){t.state=i0,t.timer.stop(),delete i[e];for(var u in i)return;delete n.__transition}}function XJ(n,e){var t=n.__transition,i,r,s=!0,o;if(t){e=e==null?null:e+"";for(o in t){if((i=t[o]).name!==e){s=!1;continue}r=i.state>Yb&&i.state<Kb,i.state=i0,i.timer.stop(),i.on.call(r?"interrupt":"cancel",n,n.__data__,i.index,i.group),delete t[o]}s&&delete n.__transition}}function qJ(n){return this.each(function(){XJ(this,n)})}function YJ(n,e){var t,i;return function(){var r=Hs(this,n),s=r.tween;if(s!==t){i=t=s;for(var o=0,a=i.length;o<a;++o)if(i[o].name===e){i=i.slice(),i.splice(o,1);break}}r.tween=i}}function KJ(n,e,t){var i,r;if(typeof t!="function")throw new Error;return function(){var s=Hs(this,n),o=s.tween;if(o!==i){r=(i=o).slice();for(var a={name:e,value:t},l=0,u=r.length;l<u;++l)if(r[l].name===e){r[l]=a;break}l===u&&r.push(a)}s.tween=r}}function QJ(n,e){var t=this._id;if(n+="",arguments.length<2){for(var i=vs(this.node(),t).tween,r=0,s=i.length,o;r<s;++r)if((o=i[r]).name===n)return o.value;return null}return this.each((e==null?YJ:KJ)(t,n,e))}function Zb(n,e,t){var i=n._id;return n.each(function(){var r=Hs(this,i);(r.value||(r.value={}))[e]=t.apply(this,arguments)}),function(r){return vs(r,i).value[e]}}function GL(n,e){var t;return(typeof e=="number"?Pa:e instanceof ff?uN:(t=ff(e))?(e=t,uN):_8)(n,e)}function ZJ(n){return function(){this.removeAttribute(n)}}function JJ(n){return function(){this.removeAttributeNS(n.space,n.local)}}function eee(n,e,t){var i,r=t+"",s;return function(){var o=this.getAttribute(n);return o===r?null:o===i?s:s=e(i=o,t)}}function tee(n,e,t){var i,r=t+"",s;return function(){var o=this.getAttributeNS(n.space,n.local);return o===r?null:o===i?s:s=e(i=o,t)}}function nee(n,e,t){var i,r,s;return function(){var o,a=t(this),l;return a==null?void this.removeAttribute(n):(o=this.getAttribute(n),l=a+"",o===l?null:o===i&&l===r?s:(r=l,s=e(i=o,a)))}}function iee(n,e,t){var i,r,s;return function(){var o,a=t(this),l;return a==null?void this.removeAttributeNS(n.space,n.local):(o=this.getAttributeNS(n.space,n.local),l=a+"",o===l?null:o===i&&l===r?s:(r=l,s=e(i=o,a)))}}function ree(n,e){var t=j_(n),i=t==="transform"?S8:GL;return this.attrTween(n,typeof e=="function"?(t.local?iee:nee)(t,i,Zb(this,"attr."+n,e)):e==null?(t.local?JJ:ZJ)(t):(t.local?tee:eee)(t,i,e))}function see(n,e){return function(t){this.setAttribute(n,e.call(this,t))}}function oee(n,e){return function(t){this.setAttributeNS(n.space,n.local,e.call(this,t))}}function aee(n,e){var t,i;function r(){var s=e.apply(this,arguments);return s!==i&&(t=(i=s)&&oee(n,s)),t}return r._value=e,r}function lee(n,e){var t,i;function r(){var s=e.apply(this,arguments);return s!==i&&(t=(i=s)&&see(n,s)),t}return r._value=e,r}function uee(n,e){var t="attr."+n;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var i=j_(n);return this.tween(t,(i.local?aee:lee)(i,e))}function cee(n,e){return function(){Qb(this,n).delay=+e.apply(this,arguments)}}function hee(n,e){return e=+e,function(){Qb(this,n).delay=e}}function dee(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?cee:hee)(e,n)):vs(this.node(),e).delay}function fee(n,e){return function(){Hs(this,n).duration=+e.apply(this,arguments)}}function pee(n,e){return e=+e,function(){Hs(this,n).duration=e}}function mee(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?fee:pee)(e,n)):vs(this.node(),e).duration}function gee(n,e){if(typeof e!="function")throw new Error;return function(){Hs(this,n).ease=e}}function _ee(n){var e=this._id;return arguments.length?this.each(gee(e,n)):vs(this.node(),e).ease}function vee(n,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;Hs(this,n).ease=t}}function yee(n){if(typeof n!="function")throw new Error;return this.each(vee(this._id,n))}function xee(n){typeof n!="function"&&(n=rL(n));for(var e=this._groups,t=e.length,i=new Array(t),r=0;r<t;++r)for(var s=e[r],o=s.length,a=i[r]=[],l,u=0;u<o;++u)(l=s[u])&&n.call(l,l.__data__,u,s)&&a.push(l);return new zo(i,this._parents,this._name,this._id)}function See(n){if(n._id!==this._id)throw new Error;for(var e=this._groups,t=n._groups,i=e.length,r=t.length,s=Math.min(i,r),o=new Array(i),a=0;a<s;++a)for(var l=e[a],u=t[a],c=l.length,h=o[a]=new Array(c),d,f=0;f<c;++f)(d=l[f]||u[f])&&(h[f]=d);for(;a<i;++a)o[a]=e[a];return new zo(o,this._parents,this._name,this._id)}function Tee(n){return(n+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function bee(n,e,t){var i,r,s=Tee(e)?Qb:Hs;return function(){var o=s(this,n),a=o.on;a!==i&&(r=(i=a).copy()).on(e,t),o.on=r}}function wee(n,e){var t=this._id;return arguments.length<2?vs(this.node(),t).on.on(n):this.each(bee(t,n,e))}function Mee(n){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==n)return;e&&e.removeChild(this)}}function Eee(){return this.on("end.remove",Mee(this._id))}function Aee(n){var e=this._name,t=this._id;typeof n!="function"&&(n=Ub(n));for(var i=this._groups,r=i.length,s=new Array(r),o=0;o<r;++o)for(var a=i[o],l=a.length,u=s[o]=new Array(l),c,h,d=0;d<l;++d)(c=a[d])&&(h=n.call(c,c.__data__,d,a))&&("__data__"in c&&(h.__data__=c.__data__),u[d]=h,r0(u[d],e,t,d,u,vs(c,t)));return new zo(s,this._parents,e,t)}function Cee(n){var e=this._name,t=this._id;typeof n!="function"&&(n=iL(n));for(var i=this._groups,r=i.length,s=[],o=[],a=0;a<r;++a)for(var l=i[a],u=l.length,c,h=0;h<u;++h)if(c=l[h]){for(var d=n.call(c,c.__data__,h,l),f,m=vs(c,t),g=0,_=d.length;g<_;++g)(f=d[g])&&r0(f,e,t,g,d,m);s.push(d),o.push(c)}return new zo(s,o,e,t)}var Ree=qf.prototype.constructor;function Nee(){return new Ree(this._groups,this._parents)}function Pee(n,e){var t,i,r;return function(){var s=dh(this,n),o=(this.style.removeProperty(n),dh(this,n));return s===o?null:s===t&&o===i?r:r=e(t=s,i=o)}}function VL(n){return function(){this.style.removeProperty(n)}}function Dee(n,e,t){var i,r=t+"",s;return function(){var o=dh(this,n);return o===r?null:o===i?s:s=e(i=o,t)}}function Lee(n,e,t){var i,r,s;return function(){var o=dh(this,n),a=t(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(n),dh(this,n))),o===l?null:o===i&&l===r?s:(r=l,s=e(i=o,a))}}function Iee(n,e){var t,i,r,s="style."+e,o="end."+s,a;return function(){var l=Hs(this,n),u=l.on,c=l.value[s]==null?a||(a=VL(e)):void 0;(u!==t||r!==c)&&(i=(t=u).copy()).on(o,r=c),l.on=i}}function Uee(n,e,t){var i=(n+="")=="transform"?x8:GL;return e==null?this.styleTween(n,Pee(n,i)).on("end.style."+n,VL(n)):typeof e=="function"?this.styleTween(n,Lee(n,i,Zb(this,"style."+n,e))).each(Iee(this._id,n)):this.styleTween(n,Dee(n,i,e),t).on("end.style."+n,null)}function Fee(n,e,t){return function(i){this.style.setProperty(n,e.call(this,i),t)}}function Oee(n,e,t){var i,r;function s(){var o=e.apply(this,arguments);return o!==r&&(i=(r=o)&&Fee(n,o,t)),i}return s._value=e,s}function Bee(n,e,t){var i="style."+(n+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,Oee(n,e,t??""))}function kee(n){return function(){this.textContent=n}}function zee(n){return function(){var e=n(this);this.textContent=e??""}}function Gee(n){return this.tween("text",typeof n=="function"?zee(Zb(this,"text",n)):kee(n==null?"":n+""))}function Vee(n){return function(e){this.textContent=n.call(this,e)}}function Hee(n){var e,t;function i(){var r=n.apply(this,arguments);return r!==t&&(e=(t=r)&&Vee(r)),e}return i._value=n,i}function Wee(n){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;return this.tween(e,Hee(n))}function $ee(){for(var n=this._name,e=this._id,t=HL(),i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],a=o.length,l,u=0;u<a;++u)if(l=o[u]){var c=vs(l,e);r0(l,n,t,u,o,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new zo(i,this._parents,n,t)}function jee(){var n,e,t=this,i=t._id,r=t.size();return new Promise(function(s,o){var a={value:o},l={value:function(){--r===0&&s()}};t.each(function(){var u=Hs(this,i),c=u.on;c!==n&&(e=(n=c).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),u.on=e}),r===0&&s()})}var Xee=0;function zo(n,e,t,i){this._groups=n,this._parents=e,this._name=t,this._id=i}function HL(){return++Xee}var Go=qf.prototype;zo.prototype={constructor:zo,select:Aee,selectAll:Cee,selectChild:Go.selectChild,selectChildren:Go.selectChildren,filter:xee,merge:See,selection:Nee,transition:$ee,call:Go.call,nodes:Go.nodes,node:Go.node,size:Go.size,empty:Go.empty,each:Go.each,on:wee,attr:ree,attrTween:uee,style:Uee,styleTween:Bee,text:Gee,textTween:Wee,remove:Eee,tween:QJ,delay:dee,duration:mee,ease:_ee,easeVarying:yee,end:jee,[Symbol.iterator]:Go[Symbol.iterator]};function qee(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var Yee={time:null,delay:0,duration:250,ease:qee};function Kee(n,e){for(var t;!(t=n.__transition)||!(t=t[e]);)if(!(n=n.parentNode))throw new Error(`transition ${e} not found`);return t}function Qee(n){var e,t;n instanceof zo?(e=n._id,n=n._name):(e=HL(),(t=Yee).time=dS(),n=n==null?null:n+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],a=o.length,l,u=0;u<a;++u)(l=o[u])&&r0(l,n,e,u,o,t||Kee(l,e));return new zo(i,this._parents,n,e)}qf.prototype.interrupt=qJ,qf.prototype.transition=Qee;function Zee(n,e){var t,i=1;n==null&&(n=0),e==null&&(e=0);function r(){var s,o=t.length,a,l=0,u=0;for(s=0;s<o;++s)a=t[s],l+=a.x,u+=a.y;for(l=(l/o-n)*i,u=(u/o-e)*i,s=0;s<o;++s)a=t[s],a.x-=l,a.y-=u}return r.initialize=function(s){t=s},r.x=function(s){return arguments.length?(n=+s,r):n},r.y=function(s){return arguments.length?(e=+s,r):e},r.strength=function(s){return arguments.length?(i=+s,r):i},r}function Jl(n){return function(){return n}}function $a(n){return(n()-.5)*1e-6}function Jee(n){return n.x+n.vx}function ete(n){return n.y+n.vy}function tte(n){var e,t,i,r=1,s=1;typeof n!="function"&&(n=Jl(n==null?1:+n));function o(){for(var u,c=e.length,h,d,f,m,g,_,p=0;p<s;++p)for(h=Cg(e,Jee,ete).visitAfter(a),u=0;u<c;++u)d=e[u],g=t[d.index],_=g*g,f=d.x+d.vx,m=d.y+d.vy,h.visit(v);function v(y,x,S,T,w){var E=y.data,M=y.r,b=g+M;if(E){if(E.index>d.index){var C=f-E.x-E.vx,I=m-E.y-E.vy,U=C*C+I*I;U<b*b&&(C===0&&(C=$a(i),U+=C*C),I===0&&(I=$a(i),U+=I*I),U=(b-(U=Math.sqrt(U)))/U*r,d.vx+=(C*=U)*(b=(M*=M)/(_+M)),d.vy+=(I*=U)*b,E.vx-=C*(b=1-b),E.vy-=I*b)}return}return x>f+b||T<f-b||S>m+b||w<m-b}}function a(u){if(u.data)return u.r=t[u.data.index];for(var c=u.r=0;c<4;++c)u[c]&&u[c].r>u.r&&(u.r=u[c].r)}function l(){if(e){var u,c=e.length,h;for(t=new Array(c),u=0;u<c;++u)h=e[u],t[h.index]=+n(h,u,e)}}return o.initialize=function(u,c){e=u,i=c,l()},o.iterations=function(u){return arguments.length?(s=+u,o):s},o.strength=function(u){return arguments.length?(r=+u,o):r},o.radius=function(u){return arguments.length?(n=typeof u=="function"?u:Jl(+u),l(),o):n},o}function nte(n){return n.index}function WL(n,e){var t=n.get(e);if(!t)throw new Error("node not found: "+e);return t}function ite(n){var e=nte,t=h,i,r=Jl(30),s,o,a,l,u,c=1;n==null&&(n=[]);function h(_){return 1/Math.min(a[_.source.index],a[_.target.index])}function d(_){for(var p=0,v=n.length;p<c;++p)for(var y=0,x,S,T,w,E,M,b;y<v;++y)x=n[y],S=x.source,T=x.target,w=T.x+T.vx-S.x-S.vx||$a(u),E=T.y+T.vy-S.y-S.vy||$a(u),M=Math.sqrt(w*w+E*E),M=(M-s[y])/M*_*i[y],w*=M,E*=M,T.vx-=w*(b=l[y]),T.vy-=E*b,S.vx+=w*(b=1-b),S.vy+=E*b}function f(){if(o){var _,p=o.length,v=n.length,y=new Map(o.map((S,T)=>[e(S,T,o),S])),x;for(_=0,a=new Array(p);_<v;++_)x=n[_],x.index=_,typeof x.source!="object"&&(x.source=WL(y,x.source)),typeof x.target!="object"&&(x.target=WL(y,x.target)),a[x.source.index]=(a[x.source.index]||0)+1,a[x.target.index]=(a[x.target.index]||0)+1;for(_=0,l=new Array(v);_<v;++_)x=n[_],l[_]=a[x.source.index]/(a[x.source.index]+a[x.target.index]);i=new Array(v),m(),s=new Array(v),g()}}function m(){if(o)for(var _=0,p=n.length;_<p;++_)i[_]=+t(n[_],_,n)}function g(){if(o)for(var _=0,p=n.length;_<p;++_)s[_]=+r(n[_],_,n)}return d.initialize=function(_,p){o=_,u=p,f()},d.links=function(_){return arguments.length?(n=_,f(),d):n},d.id=function(_){return arguments.length?(e=_,d):e},d.iterations=function(_){return arguments.length?(c=+_,d):c},d.strength=function(_){return arguments.length?(t=typeof _=="function"?_:Jl(+_),m(),d):t},d.distance=function(_){return arguments.length?(r=typeof _=="function"?_:Jl(+_),g(),d):r},d}function rte(n){return n.x}function ste(n){return n.y}function ote(){var n,e,t,i,r=Jl(-30),s,o=1,a=1/0,l=.81;function u(f){var m,g=n.length,_=Cg(n,rte,ste).visitAfter(h);for(i=f,m=0;m<g;++m)e=n[m],_.visit(d)}function c(){if(n){var f,m=n.length,g;for(s=new Array(m),f=0;f<m;++f)g=n[f],s[g.index]=+r(g,f,n)}}function h(f){var m=0,g,_,p=0,v,y,x;if(f.length){for(v=y=x=0;x<4;++x)(g=f[x])&&(_=Math.abs(g.value))&&(m+=g.value,p+=_,v+=_*g.x,y+=_*g.y);f.x=v/p,f.y=y/p}else{g=f,g.x=g.data.x,g.y=g.data.y;do m+=s[g.data.index];while(g=g.next)}f.value=m}function d(f,m,g,_){if(!f.value)return!0;var p=f.x-e.x,v=f.y-e.y,y=_-m,x=p*p+v*v;if(y*y/l<x)return x<a&&(p===0&&(p=$a(t),x+=p*p),v===0&&(v=$a(t),x+=v*v),x<o&&(x=Math.sqrt(o*x)),e.vx+=p*f.value*i/x,e.vy+=v*f.value*i/x),!0;if(f.length||x>=a)return;(f.data!==e||f.next)&&(p===0&&(p=$a(t),x+=p*p),v===0&&(v=$a(t),x+=v*v),x<o&&(x=Math.sqrt(o*x)));do f.data!==e&&(y=s[f.data.index]*i/x,e.vx+=p*y,e.vy+=v*y);while(f=f.next)}return u.initialize=function(f,m){n=f,t=m,c()},u.strength=function(f){return arguments.length?(r=typeof f=="function"?f:Jl(+f),c(),u):r},u.distanceMin=function(f){return arguments.length?(o=f*f,u):Math.sqrt(o)},u.distanceMax=function(f){return arguments.length?(a=f*f,u):Math.sqrt(a)},u.theta=function(f){return arguments.length?(l=f*f,u):Math.sqrt(l)},u}function ep(n,e,t){this.k=n,this.x=e,this.y=t}ep.prototype={constructor:ep,scale:function(n){return n===1?this:new ep(this.k*n,this.x,this.y)},translate:function(n,e){return n===0&e===0?this:new ep(this.k,this.x+this.k*n,this.y+this.k*e)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},ep.prototype;function Vo(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function $L(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}/*!
 * GSAP 3.12.7
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var wr={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},ph={duration:.5,overwrite:!1,delay:0},Jb,ei,Zt,Ws=1e8,pi=1/Ws,ew=Math.PI*2,ate=ew/4,lte=0,jL=Math.sqrt,ute=Math.cos,cte=Math.sin,jn=function(e){return typeof e=="string"},hn=function(e){return typeof e=="function"},Ho=function(e){return typeof e=="number"},tw=function(e){return typeof e>"u"},$s=function(e){return typeof e=="object"},er=function(e){return e!==!1},nw=function(){return typeof window<"u"},s0=function(e){return hn(e)||jn(e)},XL=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},mi=Array.isArray,iw=/(?:-?\.?\d|\.)+/gi,qL=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,mh=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,rw=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,YL=/[+-]=-?[.\d]+/,KL=/[^,'"\[\]\s]+/gi,hte=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,on,js,sw,ow,Mr={},o0={},QL,ZL=function(e){return(o0=_h(e,Mr))&&ir},aw=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},tp=function(e,t){return!t&&console.warn(e)},JL=function(e,t){return e&&(Mr[e]=t)&&o0&&(o0[e]=t)||Mr},np=function(){return 0},dte={suppressEvents:!0,isStart:!0,kill:!1},a0={suppressEvents:!0,kill:!1},fte={suppressEvents:!0},lw={},ja=[],uw={},eI,Er={},cw={},tI=30,l0=[],hw="",dw=function(e){var t=e[0],i,r;if($s(t)||hn(t)||(e=[e]),!(i=(t._gsap||{}).harness)){for(r=l0.length;r--&&!l0[r].targetTest(t););i=l0[r]}for(r=e.length;r--;)e[r]&&(e[r]._gsap||(e[r]._gsap=new NI(e[r],i)))||e.splice(r,1);return e},eu=function(e){return e._gsap||dw(Xr(e))[0]._gsap},nI=function(e,t,i){return(i=e[t])&&hn(i)?e[t]():tw(i)&&e.getAttribute&&e.getAttribute(t)||i},tr=function(e,t){return(e=e.split(",")).forEach(t)||e},yn=function(e){return Math.round(e*1e5)/1e5||0},Nn=function(e){return Math.round(e*1e7)/1e7||0},gh=function(e,t){var i=t.charAt(0),r=parseFloat(t.substr(2));return e=parseFloat(e),i==="+"?e+r:i==="-"?e-r:i==="*"?e*r:e/r},pte=function(e,t){for(var i=t.length,r=0;e.indexOf(t[r])<0&&++r<i;);return r<i},u0=function(){var e=ja.length,t=ja.slice(0),i,r;for(uw={},ja.length=0,i=0;i<e;i++)r=t[i],r&&r._lazy&&(r.render(r._lazy[0],r._lazy[1],!0)._lazy=0)},iI=function(e,t,i,r){ja.length&&!ei&&u0(),e.render(t,i,ei&&t<0&&(e._initted||e._startAt)),ja.length&&!ei&&u0()},rI=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(KL).length<2?t:jn(e)?e.trim():e},sI=function(e){return e},Ar=function(e,t){for(var i in t)i in e||(e[i]=t[i]);return e},mte=function(e){return function(t,i){for(var r in i)r in t||r==="duration"&&e||r==="ease"||(t[r]=i[r])}},_h=function(e,t){for(var i in t)e[i]=t[i];return e},oI=function n(e,t){for(var i in t)i!=="__proto__"&&i!=="constructor"&&i!=="prototype"&&(e[i]=$s(t[i])?n(e[i]||(e[i]={}),t[i]):t[i]);return e},c0=function(e,t){var i={},r;for(r in e)r in t||(i[r]=e[r]);return i},ip=function(e){var t=e.parent||on,i=e.keyframes?mte(mi(e.keyframes)):Ar;if(er(e.inherit))for(;t;)i(e,t.vars.defaults),t=t.parent||t._dp;return e},gte=function(e,t){for(var i=e.length,r=i===t.length;r&&i--&&e[i]===t[i];);return i<0},aI=function(e,t,i,r,s){var o=e[r],a;if(s)for(a=t[s];o&&o[s]>a;)o=o._prev;return o?(t._next=o._next,o._next=t):(t._next=e[i],e[i]=t),t._next?t._next._prev=t:e[r]=t,t._prev=o,t.parent=t._dp=e,t},h0=function(e,t,i,r){i===void 0&&(i="_first"),r===void 0&&(r="_last");var s=t._prev,o=t._next;s?s._next=o:e[i]===t&&(e[i]=o),o?o._prev=s:e[r]===t&&(e[r]=s),t._next=t._prev=t.parent=null},Xa=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},tu=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var i=e;i;)i._dirty=1,i=i.parent;return e},_te=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},fw=function(e,t,i,r){return e._startAt&&(ei?e._startAt.revert(a0):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,r))},vte=function n(e){return!e||e._ts&&n(e.parent)},lI=function(e){return e._repeat?vh(e._tTime,e=e.duration()+e._rDelay)*e:0},vh=function(e,t){var i=Math.floor(e=Nn(e/t));return e&&i===e?i-1:i},d0=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},f0=function(e){return e._end=Nn(e._start+(e._tDur/Math.abs(e._ts||e._rts||pi)||0))},p0=function(e,t){var i=e._dp;return i&&i.smoothChildTiming&&e._ts&&(e._start=Nn(i._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),f0(e),i._dirty||tu(i,e)),e},uI=function(e,t){var i;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(i=d0(e.rawTime(),t),(!t._dur||sp(0,t.totalDuration(),i)-t._tTime>pi)&&t.render(i,!0)),tu(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(i=e;i._dp;)i.rawTime()>=0&&i.totalTime(i._tTime),i=i._dp;e._zTime=-1e-8}},Xs=function(e,t,i,r){return t.parent&&Xa(t),t._start=Nn((Ho(i)?i:i||e!==on?jr(e,i,t):e._time)+t._delay),t._end=Nn(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),aI(e,t,"_first","_last",e._sort?"_start":0),pw(t)||(e._recent=t),r||uI(e,t),e._ts<0&&p0(e,e._tTime),e},cI=function(e,t){return(Mr.ScrollTrigger||aw("scrollTrigger",t))&&Mr.ScrollTrigger.create(t,e)},hI=function(e,t,i,r,s){if(bw(e,t,s),!e._initted)return 1;if(!i&&e._pt&&!ei&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&eI!==Rr.frame)return ja.push(e),e._lazy=[s,r],1},yte=function n(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||n(t))},pw=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},xte=function(e,t,i,r){var s=e.ratio,o=t<0||!t&&(!e._start&&yte(e)&&!(!e._initted&&pw(e))||(e._ts<0||e._dp._ts<0)&&!pw(e))?0:1,a=e._rDelay,l=0,u,c,h;if(a&&e._repeat&&(l=sp(0,e._tDur,t),c=vh(l,a),e._yoyo&&c&1&&(o=1-o),c!==vh(e._tTime,a)&&(s=1-o,e.vars.repeatRefresh&&e._initted&&e.invalidate())),o!==s||ei||r||e._zTime===pi||!t&&e._zTime){if(!e._initted&&hI(e,t,r,i,l))return;for(h=e._zTime,e._zTime=t||(i?pi:0),i||(i=t&&!h),e.ratio=o,e._from&&(o=1-o),e._time=0,e._tTime=l,u=e._pt;u;)u.r(o,u.d),u=u._next;t<0&&fw(e,t,i,!0),e._onUpdate&&!i&&Cr(e,"onUpdate"),l&&e._repeat&&!i&&e.parent&&Cr(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===o&&(o&&Xa(e,1),!i&&!ei&&(Cr(e,o?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},Ste=function(e,t,i){var r;if(i>t)for(r=e._first;r&&r._start<=i;){if(r.data==="isPause"&&r._start>t)return r;r=r._next}else for(r=e._last;r&&r._start>=i;){if(r.data==="isPause"&&r._start<t)return r;r=r._prev}},yh=function(e,t,i,r){var s=e._repeat,o=Nn(t)||0,a=e._tTime/e._tDur;return a&&!r&&(e._time*=o/e._dur),e._dur=o,e._tDur=s?s<0?1e10:Nn(o*(s+1)+e._rDelay*s):o,a>0&&!r&&p0(e,e._tTime=e._tDur*a),e.parent&&f0(e),i||tu(e.parent,e),e},dI=function(e){return e instanceof Li?tu(e):yh(e,e._dur)},Tte={_start:0,endTime:np,totalDuration:np},jr=function n(e,t,i){var r=e.labels,s=e._recent||Tte,o=e.duration()>=Ws?s.endTime(!1):e._dur,a,l,u;return jn(t)&&(isNaN(t)||t in r)?(l=t.charAt(0),u=t.substr(-1)==="%",a=t.indexOf("="),l==="<"||l===">"?(a>=0&&(t=t.replace(/=/,"")),(l==="<"?s._start:s.endTime(s._repeat>=0))+(parseFloat(t.substr(1))||0)*(u?(a<0?s:i).totalDuration()/100:1)):a<0?(t in r||(r[t]=o),r[t]):(l=parseFloat(t.charAt(a-1)+t.substr(a+1)),u&&i&&(l=l/100*(mi(i)?i[0]:i).totalDuration()),a>1?n(e,t.substr(0,a-1),i)+l:o+l)):t==null?o:+t},rp=function(e,t,i){var r=Ho(t[1]),s=(r?2:1)+(e<2?0:1),o=t[s],a,l;if(r&&(o.duration=t[1]),o.parent=i,e){for(a=o,l=i;l&&!("immediateRender"in a);)a=l.vars.defaults||{},l=er(l.vars.inherit)&&l.parent;o.immediateRender=er(a.immediateRender),e<2?o.runBackwards=1:o.startAt=t[s-1]}return new Pn(t[0],o,t[s+1])},qa=function(e,t){return e||e===0?t(e):t},sp=function(e,t,i){return i<e?e:i>t?t:i},gi=function(e,t){return!jn(e)||!(t=hte.exec(e))?"":t[1]},bte=function(e,t,i){return qa(i,function(r){return sp(e,t,r)})},mw=[].slice,fI=function(e,t){return e&&$s(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&$s(e[0]))&&!e.nodeType&&e!==js},wte=function(e,t,i){return i===void 0&&(i=[]),e.forEach(function(r){var s;return jn(r)&&!t||fI(r,1)?(s=i).push.apply(s,Xr(r)):i.push(r)})||i},Xr=function(e,t,i){return Zt&&!t&&Zt.selector?Zt.selector(e):jn(e)&&!i&&(sw||!Sh())?mw.call((t||ow).querySelectorAll(e),0):mi(e)?wte(e,i):fI(e)?mw.call(e,0):e?[e]:[]},gw=function(e){return e=Xr(e)[0]||tp("Invalid scope")||{},function(t){var i=e.current||e.nativeElement||e;return Xr(t,i.querySelectorAll?i:i===e?tp("Invalid scope")||ow.createElement("div"):e)}},pI=function(e){return e.sort(function(){return .5-Math.random()})},mI=function(e){if(hn(e))return e;var t=$s(e)?e:{each:e},i=nu(t.ease),r=t.from||0,s=parseFloat(t.base)||0,o={},a=r>0&&r<1,l=isNaN(r)||a,u=t.axis,c=r,h=r;return jn(r)?c=h={center:.5,edges:.5,end:1}[r]||0:!a&&l&&(c=r[0],h=r[1]),function(d,f,m){var g=(m||t).length,_=o[g],p,v,y,x,S,T,w,E,M;if(!_){if(M=t.grid==="auto"?0:(t.grid||[1,Ws])[1],!M){for(w=-1e8;w<(w=m[M++].getBoundingClientRect().left)&&M<g;);M<g&&M--}for(_=o[g]=[],p=l?Math.min(M,g)*c-.5:r%M,v=M===Ws?0:l?g*h/M-.5:r/M|0,w=0,E=Ws,T=0;T<g;T++)y=T%M-p,x=v-(T/M|0),_[T]=S=u?Math.abs(u==="y"?x:y):jL(y*y+x*x),S>w&&(w=S),S<E&&(E=S);r==="random"&&pI(_),_.max=w-E,_.min=E,_.v=g=(parseFloat(t.amount)||parseFloat(t.each)*(M>g?g-1:u?u==="y"?g/M:M:Math.max(M,g/M))||0)*(r==="edges"?-1:1),_.b=g<0?s-g:s,_.u=gi(t.amount||t.each)||0,i=i&&g<0?AI(i):i}return g=(_[d]-_.min)/_.max||0,Nn(_.b+(i?i(g):g)*_.v)+_.u}},_w=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(i){var r=Nn(Math.round(parseFloat(i)/e)*e*t);return(r-r%1)/t+(Ho(i)?0:gi(i))}},gI=function(e,t){var i=mi(e),r,s;return!i&&$s(e)&&(r=i=e.radius||Ws,e.values?(e=Xr(e.values),(s=!Ho(e[0]))&&(r*=r)):e=_w(e.increment)),qa(t,i?hn(e)?function(o){return s=e(o),Math.abs(s-o)<=r?s:o}:function(o){for(var a=parseFloat(s?o.x:o),l=parseFloat(s?o.y:0),u=Ws,c=0,h=e.length,d,f;h--;)s?(d=e[h].x-a,f=e[h].y-l,d=d*d+f*f):d=Math.abs(e[h]-a),d<u&&(u=d,c=h);return c=!r||u<=r?e[c]:o,s||c===o||Ho(o)?c:c+gi(o)}:_w(e))},_I=function(e,t,i,r){return qa(mi(e)?!t:i===!0?!!(i=0):!r,function(){return mi(e)?e[~~(Math.random()*e.length)]:(i=i||1e-5)&&(r=i<1?Math.pow(10,(i+"").length-2):1)&&Math.floor(Math.round((e-i/2+Math.random()*(t-e+i*.99))/i)*i*r)/r})},Mte=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(r){return t.reduce(function(s,o){return o(s)},r)}},Ete=function(e,t){return function(i){return e(parseFloat(i))+(t||gi(i))}},Ate=function(e,t,i){return yI(e,t,0,1,i)},vI=function(e,t,i){return qa(i,function(r){return e[~~t(r)]})},Cte=function n(e,t,i){var r=t-e;return mi(e)?vI(e,n(0,e.length),t):qa(i,function(s){return(r+(s-e)%r)%r+e})},Rte=function n(e,t,i){var r=t-e,s=r*2;return mi(e)?vI(e,n(0,e.length-1),t):qa(i,function(o){return o=(s+(o-e)%s)%s||0,e+(o>r?s-o:o)})},op=function(e){for(var t=0,i="",r,s,o,a;~(r=e.indexOf("random(",t));)o=e.indexOf(")",r),a=e.charAt(r+7)==="[",s=e.substr(r+7,o-r-7).match(a?KL:iw),i+=e.substr(t,r-t)+_I(a?s:+s[0],a?0:+s[1],+s[2]||1e-5),t=o+1;return i+e.substr(t,e.length-t)},yI=function(e,t,i,r,s){var o=t-e,a=r-i;return qa(s,function(l){return i+((l-e)/o*a||0)})},Nte=function n(e,t,i,r){var s=isNaN(e+t)?0:function(f){return(1-f)*e+f*t};if(!s){var o=jn(e),a={},l,u,c,h,d;if(i===!0&&(r=1)&&(i=null),o)e={p:e},t={p:t};else if(mi(e)&&!mi(t)){for(c=[],h=e.length,d=h-2,u=1;u<h;u++)c.push(n(e[u-1],e[u]));h--,s=function(m){m*=h;var g=Math.min(d,~~m);return c[g](m-g)},i=t}else r||(e=_h(mi(e)?[]:{},e));if(!c){for(l in t)Sw.call(a,e,l,"get",t[l]);s=function(m){return Ew(m,a)||(o?e.p:e)}}}return qa(i,s)},xI=function(e,t,i){var r=e.labels,s=Ws,o,a,l;for(o in r)a=r[o]-t,a<0==!!i&&a&&s>(a=Math.abs(a))&&(l=o,s=a);return l},Cr=function(e,t,i){var r=e.vars,s=r[t],o=Zt,a=e._ctx,l,u,c;if(s)return l=r[t+"Params"],u=r.callbackScope||e,i&&ja.length&&u0(),a&&(Zt=a),c=l?s.apply(u,l):s.call(u),Zt=o,c},ap=function(e){return Xa(e),e.scrollTrigger&&e.scrollTrigger.kill(!!ei),e.progress()<1&&Cr(e,"onInterrupt"),e},xh,SI=[],TI=function(e){if(e)if(e=!e.name&&e.default||e,nw()||e.headless){var t=e.name,i=hn(e),r=t&&!i&&e.init?function(){this._props=[]}:e,s={init:np,render:Ew,add:Sw,kill:jte,modifier:$te,rawVars:0},o={targetTest:0,get:0,getSetter:Mw,aliases:{},register:0};if(Sh(),e!==r){if(Er[t])return;Ar(r,Ar(c0(e,s),o)),_h(r.prototype,_h(s,c0(e,o))),Er[r.prop=t]=r,e.targetTest&&(l0.push(r),lw[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}JL(t,r),e.register&&e.register(ir,r,nr)}else SI.push(e)},Ot=255,lp={aqua:[0,Ot,Ot],lime:[0,Ot,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Ot],navy:[0,0,128],white:[Ot,Ot,Ot],olive:[128,128,0],yellow:[Ot,Ot,0],orange:[Ot,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Ot,0,0],pink:[Ot,192,203],cyan:[0,Ot,Ot],transparent:[Ot,Ot,Ot,0]},vw=function(e,t,i){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(i-t)*e*6:e<.5?i:e*3<2?t+(i-t)*(2/3-e)*6:t)*Ot+.5|0},bI=function(e,t,i){var r=e?Ho(e)?[e>>16,e>>8&Ot,e&Ot]:0:lp.black,s,o,a,l,u,c,h,d,f,m;if(!r){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),lp[e])r=lp[e];else if(e.charAt(0)==="#"){if(e.length<6&&(s=e.charAt(1),o=e.charAt(2),a=e.charAt(3),e="#"+s+s+o+o+a+a+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return r=parseInt(e.substr(1,6),16),[r>>16,r>>8&Ot,r&Ot,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),r=[e>>16,e>>8&Ot,e&Ot]}else if(e.substr(0,3)==="hsl"){if(r=m=e.match(iw),!t)l=+r[0]%360/360,u=+r[1]/100,c=+r[2]/100,o=c<=.5?c*(u+1):c+u-c*u,s=c*2-o,r.length>3&&(r[3]*=1),r[0]=vw(l+1/3,s,o),r[1]=vw(l,s,o),r[2]=vw(l-1/3,s,o);else if(~e.indexOf("="))return r=e.match(qL),i&&r.length<4&&(r[3]=1),r}else r=e.match(iw)||lp.transparent;r=r.map(Number)}return t&&!m&&(s=r[0]/Ot,o=r[1]/Ot,a=r[2]/Ot,h=Math.max(s,o,a),d=Math.min(s,o,a),c=(h+d)/2,h===d?l=u=0:(f=h-d,u=c>.5?f/(2-h-d):f/(h+d),l=h===s?(o-a)/f+(o<a?6:0):h===o?(a-s)/f+2:(s-o)/f+4,l*=60),r[0]=~~(l+.5),r[1]=~~(u*100+.5),r[2]=~~(c*100+.5)),i&&r.length<4&&(r[3]=1),r},wI=function(e){var t=[],i=[],r=-1;return e.split(Ya).forEach(function(s){var o=s.match(mh)||[];t.push.apply(t,o),i.push(r+=o.length+1)}),t.c=i,t},MI=function(e,t,i){var r="",s=(e+r).match(Ya),o=t?"hsla(":"rgba(",a=0,l,u,c,h;if(!s)return e;if(s=s.map(function(d){return(d=bI(d,t,1))&&o+(t?d[0]+","+d[1]+"%,"+d[2]+"%,"+d[3]:d.join(","))+")"}),i&&(c=wI(e),l=i.c,l.join(r)!==c.c.join(r)))for(u=e.replace(Ya,"1").split(mh),h=u.length-1;a<h;a++)r+=u[a]+(~l.indexOf(a)?s.shift()||o+"0,0,0,0)":(c.length?c:s.length?s:i).shift());if(!u)for(u=e.split(Ya),h=u.length-1;a<h;a++)r+=u[a]+s[a];return r+u[h]},Ya=function(){var n="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in lp)n+="|"+e+"\\b";return new RegExp(n+")","gi")}(),Pte=/hsl[a]?\(/,EI=function(e){var t=e.join(" "),i;if(Ya.lastIndex=0,Ya.test(t))return i=Pte.test(t),e[1]=MI(e[1],i),e[0]=MI(e[0],i,wI(e[1])),!0},up,Rr=function(){var n=Date.now,e=500,t=33,i=n(),r=i,s=1e3/240,o=s,a=[],l,u,c,h,d,f,m=function g(_){var p=n()-r,v=_===!0,y,x,S,T;if((p>e||p<0)&&(i+=p-t),r+=p,S=r-i,y=S-o,(y>0||v)&&(T=++h.frame,d=S-h.time*1e3,h.time=S=S/1e3,o+=y+(y>=s?4:s-y),x=1),v||(l=u(g)),x)for(f=0;f<a.length;f++)a[f](S,d,T,_)};return h={time:0,frame:0,tick:function(){m(!0)},deltaRatio:function(_){return d/(1e3/(_||60))},wake:function(){QL&&(!sw&&nw()&&(js=sw=window,ow=js.document||{},Mr.gsap=ir,(js.gsapVersions||(js.gsapVersions=[])).push(ir.version),ZL(o0||js.GreenSockGlobals||!js.gsap&&js||{}),SI.forEach(TI)),c=typeof requestAnimationFrame<"u"&&requestAnimationFrame,l&&h.sleep(),u=c||function(_){return setTimeout(_,o-h.time*1e3+1|0)},up=1,m(2))},sleep:function(){(c?cancelAnimationFrame:clearTimeout)(l),up=0,u=np},lagSmoothing:function(_,p){e=_||1/0,t=Math.min(p||33,e)},fps:function(_){s=1e3/(_||240),o=h.time*1e3+s},add:function(_,p,v){var y=p?function(x,S,T,w){_(x,S,T,w),h.remove(y)}:_;return h.remove(_),a[v?"unshift":"push"](y),Sh(),y},remove:function(_,p){~(p=a.indexOf(_))&&a.splice(p,1)&&f>=p&&f--},_listeners:a},h}(),Sh=function(){return!up&&Rr.wake()},mt={},Dte=/^[\d.\-M][\d.\-,\s]/,Lte=/["']/g,Ite=function(e){for(var t={},i=e.substr(1,e.length-3).split(":"),r=i[0],s=1,o=i.length,a,l,u;s<o;s++)l=i[s],a=s!==o-1?l.lastIndexOf(","):l.length,u=l.substr(0,a),t[r]=isNaN(u)?u.replace(Lte,"").trim():+u,r=l.substr(a+1).trim();return t},Ute=function(e){var t=e.indexOf("(")+1,i=e.indexOf(")"),r=e.indexOf("(",t);return e.substring(t,~r&&r<i?e.indexOf(")",i+1):i)},Fte=function(e){var t=(e+"").split("("),i=mt[t[0]];return i&&t.length>1&&i.config?i.config.apply(null,~e.indexOf("{")?[Ite(t[1])]:Ute(e).split(",").map(rI)):mt._CE&&Dte.test(e)?mt._CE("",e):i},AI=function(e){return function(t){return 1-e(1-t)}},CI=function n(e,t){for(var i=e._first,r;i;)i instanceof Li?n(i,t):i.vars.yoyoEase&&(!i._yoyo||!i._repeat)&&i._yoyo!==t&&(i.timeline?n(i.timeline,t):(r=i._ease,i._ease=i._yEase,i._yEase=r,i._yoyo=t)),i=i._next},nu=function(e,t){return e&&(hn(e)?e:mt[e]||Fte(e))||t},iu=function(e,t,i,r){i===void 0&&(i=function(l){return 1-t(1-l)}),r===void 0&&(r=function(l){return l<.5?t(l*2)/2:1-t((1-l)*2)/2});var s={easeIn:t,easeOut:i,easeInOut:r},o;return tr(e,function(a){mt[a]=Mr[a]=s,mt[o=a.toLowerCase()]=i;for(var l in s)mt[o+(l==="easeIn"?".in":l==="easeOut"?".out":".inOut")]=mt[a+"."+l]=s[l]}),s},RI=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},yw=function n(e,t,i){var r=t>=1?t:1,s=(i||(e?.3:.45))/(t<1?t:1),o=s/ew*(Math.asin(1/r)||0),a=function(c){return c===1?1:r*Math.pow(2,-10*c)*cte((c-o)*s)+1},l=e==="out"?a:e==="in"?function(u){return 1-a(1-u)}:RI(a);return s=ew/s,l.config=function(u,c){return n(e,u,c)},l},xw=function n(e,t){t===void 0&&(t=1.70158);var i=function(o){return o?--o*o*((t+1)*o+t)+1:0},r=e==="out"?i:e==="in"?function(s){return 1-i(1-s)}:RI(i);return r.config=function(s){return n(e,s)},r};tr("Linear,Quad,Cubic,Quart,Quint,Strong",function(n,e){var t=e<5?e+1:e;iu(n+",Power"+(t-1),e?function(i){return Math.pow(i,t)}:function(i){return i},function(i){return 1-Math.pow(1-i,t)},function(i){return i<.5?Math.pow(i*2,t)/2:1-Math.pow((1-i)*2,t)/2})}),mt.Linear.easeNone=mt.none=mt.Linear.easeIn,iu("Elastic",yw("in"),yw("out"),yw()),function(n,e){var t=1/e,i=2*t,r=2.5*t,s=function(a){return a<t?n*a*a:a<i?n*Math.pow(a-1.5/e,2)+.75:a<r?n*(a-=2.25/e)*a+.9375:n*Math.pow(a-2.625/e,2)+.984375};iu("Bounce",function(o){return 1-s(1-o)},s)}(7.5625,2.75),iu("Expo",function(n){return Math.pow(2,10*(n-1))*n+n*n*n*n*n*n*(1-n)}),iu("Circ",function(n){return-(jL(1-n*n)-1)}),iu("Sine",function(n){return n===1?1:-ute(n*ate)+1}),iu("Back",xw("in"),xw("out"),xw()),mt.SteppedEase=mt.steps=Mr.SteppedEase={config:function(e,t){e===void 0&&(e=1);var i=1/e,r=e+(t?0:1),s=t?1:0,o=1-pi;return function(a){return((r*sp(0,o,a)|0)+s)*i}}},ph.ease=mt["quad.out"],tr("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(n){return hw+=n+","+n+"Params,"});var NI=function(e,t){this.id=lte++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:nI,this.set=t?t.getSetter:Mw},cp=function(){function n(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,yh(this,+t.duration,1,1),this.data=t.data,Zt&&(this._ctx=Zt,Zt.data.push(this)),up||Rr.wake()}var e=n.prototype;return e.delay=function(i){return i||i===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+i-this._delay),this._delay=i,this):this._delay},e.duration=function(i){return arguments.length?this.totalDuration(this._repeat>0?i+(i+this._rDelay)*this._repeat:i):this.totalDuration()&&this._dur},e.totalDuration=function(i){return arguments.length?(this._dirty=0,yh(this,this._repeat<0?i:(i-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(i,r){if(Sh(),!arguments.length)return this._tTime;var s=this._dp;if(s&&s.smoothChildTiming&&this._ts){for(p0(this,i),!s._dp||s.parent||uI(s,this);s&&s.parent;)s.parent._time!==s._start+(s._ts>=0?s._tTime/s._ts:(s.totalDuration()-s._tTime)/-s._ts)&&s.totalTime(s._tTime,!0),s=s.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&i<this._tDur||this._ts<0&&i>0||!this._tDur&&!i)&&Xs(this._dp,this,this._start-this._delay)}return(this._tTime!==i||!this._dur&&!r||this._initted&&Math.abs(this._zTime)===pi||!i&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=i),iI(this,i,r)),this},e.time=function(i,r){return arguments.length?this.totalTime(Math.min(this.totalDuration(),i+lI(this))%(this._dur+this._rDelay)||(i?this._dur:0),r):this._time},e.totalProgress=function(i,r){return arguments.length?this.totalTime(this.totalDuration()*i,r):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},e.progress=function(i,r){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-i:i)+lI(this),r):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(i,r){var s=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(i-1)*s,r):this._repeat?vh(this._tTime,s)+1:1},e.timeScale=function(i,r){if(!arguments.length)return this._rts===-1e-8?0:this._rts;if(this._rts===i)return this;var s=this.parent&&this._ts?d0(this.parent._time,this):this._tTime;return this._rts=+i||0,this._ts=this._ps||i===-1e-8?0:this._rts,this.totalTime(sp(-Math.abs(this._delay),this._tDur,s),r!==!1),f0(this),_te(this)},e.paused=function(i){return arguments.length?(this._ps!==i&&(this._ps=i,i?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Sh(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==pi&&(this._tTime-=pi)))),this):this._ps},e.startTime=function(i){if(arguments.length){this._start=i;var r=this.parent||this._dp;return r&&(r._sort||!this.parent)&&Xs(r,this,i-this._delay),this}return this._start},e.endTime=function(i){return this._start+(er(i)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(i){var r=this.parent||this._dp;return r?i&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?d0(r.rawTime(i),this):this._tTime:this._tTime},e.revert=function(i){i===void 0&&(i=fte);var r=ei;return ei=i,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(i),this.totalTime(-.01,i.suppressEvents)),this.data!=="nested"&&i.kill!==!1&&this.kill(),ei=r,this},e.globalTime=function(i){for(var r=this,s=arguments.length?i:r.rawTime();r;)s=r._start+s/(Math.abs(r._ts)||1),r=r._dp;return!this.parent&&this._sat?this._sat.globalTime(i):s},e.repeat=function(i){return arguments.length?(this._repeat=i===1/0?-2:i,dI(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(i){if(arguments.length){var r=this._time;return this._rDelay=i,dI(this),r?this.time(r):this}return this._rDelay},e.yoyo=function(i){return arguments.length?(this._yoyo=i,this):this._yoyo},e.seek=function(i,r){return this.totalTime(jr(this,i),er(r))},e.restart=function(i,r){return this.play().totalTime(i?-this._delay:0,er(r)),this._dur||(this._zTime=-1e-8),this},e.play=function(i,r){return i!=null&&this.seek(i,r),this.reversed(!1).paused(!1)},e.reverse=function(i,r){return i!=null&&this.seek(i||this.totalDuration(),r),this.reversed(!0).paused(!1)},e.pause=function(i,r){return i!=null&&this.seek(i,r),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(i){return arguments.length?(!!i!==this.reversed()&&this.timeScale(-this._rts||(i?-1e-8:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},e.isActive=function(){var i=this.parent||this._dp,r=this._start,s;return!!(!i||this._ts&&this._initted&&i.isActive()&&(s=i.rawTime(!0))>=r&&s<this.endTime(!0)-pi)},e.eventCallback=function(i,r,s){var o=this.vars;return arguments.length>1?(r?(o[i]=r,s&&(o[i+"Params"]=s),i==="onUpdate"&&(this._onUpdate=r)):delete o[i],this):o[i]},e.then=function(i){var r=this;return new Promise(function(s){var o=hn(i)?i:sI,a=function(){var u=r.then;r.then=null,hn(o)&&(o=o(r))&&(o.then||o===r)&&(r.then=u),s(o),r.then=u};r._initted&&r.totalProgress()===1&&r._ts>=0||!r._tTime&&r._ts<0?a():r._prom=a})},e.kill=function(){ap(this)},n}();Ar(cp.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var Li=function(n){$L(e,n);function e(i,r){var s;return i===void 0&&(i={}),s=n.call(this,i)||this,s.labels={},s.smoothChildTiming=!!i.smoothChildTiming,s.autoRemoveChildren=!!i.autoRemoveChildren,s._sort=er(i.sortChildren),on&&Xs(i.parent||on,Vo(s),r),i.reversed&&s.reverse(),i.paused&&s.paused(!0),i.scrollTrigger&&cI(Vo(s),i.scrollTrigger),s}var t=e.prototype;return t.to=function(r,s,o){return rp(0,arguments,this),this},t.from=function(r,s,o){return rp(1,arguments,this),this},t.fromTo=function(r,s,o,a){return rp(2,arguments,this),this},t.set=function(r,s,o){return s.duration=0,s.parent=this,ip(s).repeatDelay||(s.repeat=0),s.immediateRender=!!s.immediateRender,new Pn(r,s,jr(this,o),1),this},t.call=function(r,s,o){return Xs(this,Pn.delayedCall(0,r,s),o)},t.staggerTo=function(r,s,o,a,l,u,c){return o.duration=s,o.stagger=o.stagger||a,o.onComplete=u,o.onCompleteParams=c,o.parent=this,new Pn(r,o,jr(this,l)),this},t.staggerFrom=function(r,s,o,a,l,u,c){return o.runBackwards=1,ip(o).immediateRender=er(o.immediateRender),this.staggerTo(r,s,o,a,l,u,c)},t.staggerFromTo=function(r,s,o,a,l,u,c,h){return a.startAt=o,ip(a).immediateRender=er(a.immediateRender),this.staggerTo(r,s,a,l,u,c,h)},t.render=function(r,s,o){var a=this._time,l=this._dirty?this.totalDuration():this._tDur,u=this._dur,c=r<=0?0:Nn(r),h=this._zTime<0!=r<0&&(this._initted||!u),d,f,m,g,_,p,v,y,x,S,T,w;if(this!==on&&c>l&&r>=0&&(c=l),c!==this._tTime||o||h){if(a!==this._time&&u&&(c+=this._time-a,r+=this._time-a),d=c,x=this._start,y=this._ts,p=!y,h&&(u||(a=this._zTime),(r||!s)&&(this._zTime=r)),this._repeat){if(T=this._yoyo,_=u+this._rDelay,this._repeat<-1&&r<0)return this.totalTime(_*100+r,s,o);if(d=Nn(c%_),c===l?(g=this._repeat,d=u):(S=Nn(c/_),g=~~S,g&&g===S&&(d=u,g--),d>u&&(d=u)),S=vh(this._tTime,_),!a&&this._tTime&&S!==g&&this._tTime-S*_-this._dur<=0&&(S=g),T&&g&1&&(d=u-d,w=1),g!==S&&!this._lock){var E=T&&S&1,M=E===(T&&g&1);if(g<S&&(E=!E),a=E?0:c%u?u:c,this._lock=1,this.render(a||(w?0:Nn(g*_)),s,!u)._lock=0,this._tTime=c,!s&&this.parent&&Cr(this,"onRepeat"),this.vars.repeatRefresh&&!w&&(this.invalidate()._lock=1),a&&a!==this._time||p!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(u=this._dur,l=this._tDur,M&&(this._lock=2,a=E?u:-1e-4,this.render(a,!0),this.vars.repeatRefresh&&!w&&this.invalidate()),this._lock=0,!this._ts&&!p)return this;CI(this,w)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(v=Ste(this,Nn(a),Nn(d)),v&&(c-=d-(d=v._start))),this._tTime=c,this._time=d,this._act=!y,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=r,a=0),!a&&d&&!s&&!g&&(Cr(this,"onStart"),this._tTime!==c))return this;if(d>=a&&r>=0)for(f=this._first;f;){if(m=f._next,(f._act||d>=f._start)&&f._ts&&v!==f){if(f.parent!==this)return this.render(r,s,o);if(f.render(f._ts>0?(d-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(d-f._start)*f._ts,s,o),d!==this._time||!this._ts&&!p){v=0,m&&(c+=this._zTime=-1e-8);break}}f=m}else{f=this._last;for(var b=r<0?r:d;f;){if(m=f._prev,(f._act||b<=f._end)&&f._ts&&v!==f){if(f.parent!==this)return this.render(r,s,o);if(f.render(f._ts>0?(b-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(b-f._start)*f._ts,s,o||ei&&(f._initted||f._startAt)),d!==this._time||!this._ts&&!p){v=0,m&&(c+=this._zTime=b?-1e-8:pi);break}}f=m}}if(v&&!s&&(this.pause(),v.render(d>=a?0:-1e-8)._zTime=d>=a?1:-1,this._ts))return this._start=x,f0(this),this.render(r,s,o);this._onUpdate&&!s&&Cr(this,"onUpdate",!0),(c===l&&this._tTime>=this.totalDuration()||!c&&a)&&(x===this._start||Math.abs(y)!==Math.abs(this._ts))&&(this._lock||((r||!u)&&(c===l&&this._ts>0||!c&&this._ts<0)&&Xa(this,1),!s&&!(r<0&&!a)&&(c||a||!l)&&(Cr(this,c===l&&r>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(c<l&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(r,s){var o=this;if(Ho(s)||(s=jr(this,s,r)),!(r instanceof cp)){if(mi(r))return r.forEach(function(a){return o.add(a,s)}),this;if(jn(r))return this.addLabel(r,s);if(hn(r))r=Pn.delayedCall(0,r);else return this}return this!==r?Xs(this,r,s):this},t.getChildren=function(r,s,o,a){r===void 0&&(r=!0),s===void 0&&(s=!0),o===void 0&&(o=!0),a===void 0&&(a=-1e8);for(var l=[],u=this._first;u;)u._start>=a&&(u instanceof Pn?s&&l.push(u):(o&&l.push(u),r&&l.push.apply(l,u.getChildren(!0,s,o)))),u=u._next;return l},t.getById=function(r){for(var s=this.getChildren(1,1,1),o=s.length;o--;)if(s[o].vars.id===r)return s[o]},t.remove=function(r){return jn(r)?this.removeLabel(r):hn(r)?this.killTweensOf(r):(r.parent===this&&h0(this,r),r===this._recent&&(this._recent=this._last),tu(this))},t.totalTime=function(r,s){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Nn(Rr.time-(this._ts>0?r/this._ts:(this.totalDuration()-r)/-this._ts))),n.prototype.totalTime.call(this,r,s),this._forcing=0,this):this._tTime},t.addLabel=function(r,s){return this.labels[r]=jr(this,s),this},t.removeLabel=function(r){return delete this.labels[r],this},t.addPause=function(r,s,o){var a=Pn.delayedCall(0,s||np,o);return a.data="isPause",this._hasPause=1,Xs(this,a,jr(this,r))},t.removePause=function(r){var s=this._first;for(r=jr(this,r);s;)s._start===r&&s.data==="isPause"&&Xa(s),s=s._next},t.killTweensOf=function(r,s,o){for(var a=this.getTweensOf(r,o),l=a.length;l--;)Ka!==a[l]&&a[l].kill(r,s);return this},t.getTweensOf=function(r,s){for(var o=[],a=Xr(r),l=this._first,u=Ho(s),c;l;)l instanceof Pn?pte(l._targets,a)&&(u?(!Ka||l._initted&&l._ts)&&l.globalTime(0)<=s&&l.globalTime(l.totalDuration())>s:!s||l.isActive())&&o.push(l):(c=l.getTweensOf(a,s)).length&&o.push.apply(o,c),l=l._next;return o},t.tweenTo=function(r,s){s=s||{};var o=this,a=jr(o,r),l=s,u=l.startAt,c=l.onStart,h=l.onStartParams,d=l.immediateRender,f,m=Pn.to(o,Ar({ease:s.ease||"none",lazy:!1,immediateRender:!1,time:a,overwrite:"auto",duration:s.duration||Math.abs((a-(u&&"time"in u?u.time:o._time))/o.timeScale())||pi,onStart:function(){if(o.pause(),!f){var _=s.duration||Math.abs((a-(u&&"time"in u?u.time:o._time))/o.timeScale());m._dur!==_&&yh(m,_,0,1).render(m._time,!0,!0),f=1}c&&c.apply(m,h||[])}},s));return d?m.render(0):m},t.tweenFromTo=function(r,s,o){return this.tweenTo(s,Ar({startAt:{time:jr(this,r)}},o))},t.recent=function(){return this._recent},t.nextLabel=function(r){return r===void 0&&(r=this._time),xI(this,jr(this,r))},t.previousLabel=function(r){return r===void 0&&(r=this._time),xI(this,jr(this,r),1)},t.currentLabel=function(r){return arguments.length?this.seek(r,!0):this.previousLabel(this._time+pi)},t.shiftChildren=function(r,s,o){o===void 0&&(o=0);for(var a=this._first,l=this.labels,u;a;)a._start>=o&&(a._start+=r,a._end+=r),a=a._next;if(s)for(u in l)l[u]>=o&&(l[u]+=r);return tu(this)},t.invalidate=function(r){var s=this._first;for(this._lock=0;s;)s.invalidate(r),s=s._next;return n.prototype.invalidate.call(this,r)},t.clear=function(r){r===void 0&&(r=!0);for(var s=this._first,o;s;)o=s._next,this.remove(s),s=o;return this._dp&&(this._time=this._tTime=this._pTime=0),r&&(this.labels={}),tu(this)},t.totalDuration=function(r){var s=0,o=this,a=o._last,l=Ws,u,c,h;if(arguments.length)return o.timeScale((o._repeat<0?o.duration():o.totalDuration())/(o.reversed()?-r:r));if(o._dirty){for(h=o.parent;a;)u=a._prev,a._dirty&&a.totalDuration(),c=a._start,c>l&&o._sort&&a._ts&&!o._lock?(o._lock=1,Xs(o,a,c-a._delay,1)._lock=0):l=c,c<0&&a._ts&&(s-=c,(!h&&!o._dp||h&&h.smoothChildTiming)&&(o._start+=c/o._ts,o._time-=c,o._tTime-=c),o.shiftChildren(-c,!1,-1/0),l=0),a._end>s&&a._ts&&(s=a._end),a=u;yh(o,o===on&&o._time>s?o._time:s,1,1),o._dirty=0}return o._tDur},e.updateRoot=function(r){if(on._ts&&(iI(on,d0(r,on)),eI=Rr.frame),Rr.frame>=tI){tI+=wr.autoSleep||120;var s=on._first;if((!s||!s._ts)&&wr.autoSleep&&Rr._listeners.length<2){for(;s&&!s._ts;)s=s._next;s||Rr.sleep()}}},e}(cp);Ar(Li.prototype,{_lock:0,_hasPause:0,_forcing:0});var Ote=function(e,t,i,r,s,o,a){var l=new nr(this._pt,e,t,0,1,FI,null,s),u=0,c=0,h,d,f,m,g,_,p,v;for(l.b=i,l.e=r,i+="",r+="",(p=~r.indexOf("random("))&&(r=op(r)),o&&(v=[i,r],o(v,e,t),i=v[0],r=v[1]),d=i.match(rw)||[];h=rw.exec(r);)m=h[0],g=r.substring(u,h.index),f?f=(f+1)%5:g.substr(-5)==="rgba("&&(f=1),m!==d[c++]&&(_=parseFloat(d[c-1])||0,l._pt={_next:l._pt,p:g||c===1?g:",",s:_,c:m.charAt(1)==="="?gh(_,m)-_:parseFloat(m)-_,m:f&&f<4?Math.round:0},u=rw.lastIndex);return l.c=u<r.length?r.substring(u,r.length):"",l.fp=a,(YL.test(r)||p)&&(l.e=0),this._pt=l,l},Sw=function(e,t,i,r,s,o,a,l,u,c){hn(r)&&(r=r(s||0,e,o));var h=e[t],d=i!=="get"?i:hn(h)?u?e[t.indexOf("set")||!hn(e["get"+t.substr(3)])?t:"get"+t.substr(3)](u):e[t]():h,f=hn(h)?u?Vte:II:ww,m;if(jn(r)&&(~r.indexOf("random(")&&(r=op(r)),r.charAt(1)==="="&&(m=gh(d,r)+(gi(d)||0),(m||m===0)&&(r=m))),!c||d!==r||Tw)return!isNaN(d*r)&&r!==""?(m=new nr(this._pt,e,t,+d||0,r-(d||0),typeof h=="boolean"?Wte:UI,0,f),u&&(m.fp=u),a&&m.modifier(a,this,e),this._pt=m):(!h&&!(t in e)&&aw(t,r),Ote.call(this,e,t,d,r,f,l||wr.stringFilter,u))},Bte=function(e,t,i,r,s){if(hn(e)&&(e=hp(e,s,t,i,r)),!$s(e)||e.style&&e.nodeType||mi(e)||XL(e))return jn(e)?hp(e,s,t,i,r):e;var o={},a;for(a in e)o[a]=hp(e[a],s,t,i,r);return o},PI=function(e,t,i,r,s,o){var a,l,u,c;if(Er[e]&&(a=new Er[e]).init(s,a.rawVars?t[e]:Bte(t[e],r,s,o,i),i,r,o)!==!1&&(i._pt=l=new nr(i._pt,s,e,0,1,a.render,a,0,a.priority),i!==xh))for(u=i._ptLookup[i._targets.indexOf(s)],c=a._props.length;c--;)u[a._props[c]]=l;return a},Ka,Tw,bw=function n(e,t,i){var r=e.vars,s=r.ease,o=r.startAt,a=r.immediateRender,l=r.lazy,u=r.onUpdate,c=r.runBackwards,h=r.yoyoEase,d=r.keyframes,f=r.autoRevert,m=e._dur,g=e._startAt,_=e._targets,p=e.parent,v=p&&p.data==="nested"?p.vars.targets:_,y=e._overwrite==="auto"&&!Jb,x=e.timeline,S,T,w,E,M,b,C,I,U,D,L,F,Q;if(x&&(!d||!s)&&(s="none"),e._ease=nu(s,ph.ease),e._yEase=h?AI(nu(h===!0?s:h,ph.ease)):0,h&&e._yoyo&&!e._repeat&&(h=e._yEase,e._yEase=e._ease,e._ease=h),e._from=!x&&!!r.runBackwards,!x||d&&!r.stagger){if(I=_[0]?eu(_[0]).harness:0,F=I&&r[I.prop],S=c0(r,lw),g&&(g._zTime<0&&g.progress(1),t<0&&c&&a&&!f?g.render(-1,!0):g.revert(c&&m?a0:dte),g._lazy=0),o){if(Xa(e._startAt=Pn.set(_,Ar({data:"isStart",overwrite:!1,parent:p,immediateRender:!0,lazy:!g&&er(l),startAt:null,delay:0,onUpdate:u&&function(){return Cr(e,"onUpdate")},stagger:0},o))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(ei||!a&&!f)&&e._startAt.revert(a0),a&&m&&t<=0&&i<=0){t&&(e._zTime=t);return}}else if(c&&m&&!g){if(t&&(a=!1),w=Ar({overwrite:!1,data:"isFromStart",lazy:a&&!g&&er(l),immediateRender:a,stagger:0,parent:p},S),F&&(w[I.prop]=F),Xa(e._startAt=Pn.set(_,w)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(ei?e._startAt.revert(a0):e._startAt.render(-1,!0)),e._zTime=t,!a)n(e._startAt,pi,pi);else if(!t)return}for(e._pt=e._ptCache=0,l=m&&er(l)||l&&!m,T=0;T<_.length;T++){if(M=_[T],C=M._gsap||dw(_)[T]._gsap,e._ptLookup[T]=D={},uw[C.id]&&ja.length&&u0(),L=v===_?T:v.indexOf(M),I&&(U=new I).init(M,F||S,e,L,v)!==!1&&(e._pt=E=new nr(e._pt,M,U.name,0,1,U.render,U,0,U.priority),U._props.forEach(function(B){D[B]=E}),U.priority&&(b=1)),!I||F)for(w in S)Er[w]&&(U=PI(w,S,e,L,M,v))?U.priority&&(b=1):D[w]=E=Sw.call(e,M,w,"get",S[w],L,v,0,r.stringFilter);e._op&&e._op[T]&&e.kill(M,e._op[T]),y&&e._pt&&(Ka=e,on.killTweensOf(M,D,e.globalTime(t)),Q=!e.parent,Ka=0),e._pt&&l&&(uw[C.id]=1)}b&&OI(e),e._onInit&&e._onInit(e)}e._onUpdate=u,e._initted=(!e._op||e._pt)&&!Q,d&&t<=0&&x.render(Ws,!0,!0)},kte=function(e,t,i,r,s,o,a,l){var u=(e._pt&&e._ptCache||(e._ptCache={}))[t],c,h,d,f;if(!u)for(u=e._ptCache[t]=[],d=e._ptLookup,f=e._targets.length;f--;){if(c=d[f][t],c&&c.d&&c.d._pt)for(c=c.d._pt;c&&c.p!==t&&c.fp!==t;)c=c._next;if(!c)return Tw=1,e.vars[t]="+=0",bw(e,a),Tw=0,l?tp(t+" not eligible for reset"):1;u.push(c)}for(f=u.length;f--;)h=u[f],c=h._pt||h,c.s=(r||r===0)&&!s?r:c.s+(r||0)+o*c.c,c.c=i-c.s,h.e&&(h.e=yn(i)+gi(h.e)),h.b&&(h.b=c.s+gi(h.b))},zte=function(e,t){var i=e[0]?eu(e[0]).harness:0,r=i&&i.aliases,s,o,a,l;if(!r)return t;s=_h({},t);for(o in r)if(o in s)for(l=r[o].split(","),a=l.length;a--;)s[l[a]]=s[o];return s},Gte=function(e,t,i,r){var s=t.ease||r||"power1.inOut",o,a;if(mi(t))a=i[e]||(i[e]=[]),t.forEach(function(l,u){return a.push({t:u/(t.length-1)*100,v:l,e:s})});else for(o in t)a=i[o]||(i[o]=[]),o==="ease"||a.push({t:parseFloat(e),v:t[o],e:s})},hp=function(e,t,i,r,s){return hn(e)?e.call(t,i,r,s):jn(e)&&~e.indexOf("random(")?op(e):e},DI=hw+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",LI={};tr(DI+",id,stagger,delay,duration,paused,scrollTrigger",function(n){return LI[n]=1});var Pn=function(n){$L(e,n);function e(i,r,s,o){var a;typeof r=="number"&&(s.duration=r,r=s,s=null),a=n.call(this,o?r:ip(r))||this;var l=a.vars,u=l.duration,c=l.delay,h=l.immediateRender,d=l.stagger,f=l.overwrite,m=l.keyframes,g=l.defaults,_=l.scrollTrigger,p=l.yoyoEase,v=r.parent||on,y=(mi(i)||XL(i)?Ho(i[0]):"length"in r)?[i]:Xr(i),x,S,T,w,E,M,b,C;if(a._targets=y.length?dw(y):tp("GSAP target "+i+" not found. https://gsap.com",!wr.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=f,m||d||s0(u)||s0(c)){if(r=a.vars,x=a.timeline=new Li({data:"nested",defaults:g||{},targets:v&&v.data==="nested"?v.vars.targets:y}),x.kill(),x.parent=x._dp=Vo(a),x._start=0,d||s0(u)||s0(c)){if(w=y.length,b=d&&mI(d),$s(d))for(E in d)~DI.indexOf(E)&&(C||(C={}),C[E]=d[E]);for(S=0;S<w;S++)T=c0(r,LI),T.stagger=0,p&&(T.yoyoEase=p),C&&_h(T,C),M=y[S],T.duration=+hp(u,Vo(a),S,M,y),T.delay=(+hp(c,Vo(a),S,M,y)||0)-a._delay,!d&&w===1&&T.delay&&(a._delay=c=T.delay,a._start+=c,T.delay=0),x.to(M,T,b?b(S,M,y):0),x._ease=mt.none;x.duration()?u=c=0:a.timeline=0}else if(m){ip(Ar(x.vars.defaults,{ease:"none"})),x._ease=nu(m.ease||r.ease||"none");var I=0,U,D,L;if(mi(m))m.forEach(function(F){return x.to(y,F,">")}),x.duration();else{T={};for(E in m)E==="ease"||E==="easeEach"||Gte(E,m[E],T,m.easeEach);for(E in T)for(U=T[E].sort(function(F,Q){return F.t-Q.t}),I=0,S=0;S<U.length;S++)D=U[S],L={ease:D.e,duration:(D.t-(S?U[S-1].t:0))/100*u},L[E]=D.v,x.to(y,L,I),I+=L.duration;x.duration()<u&&x.to({},{duration:u-x.duration()})}}u||a.duration(u=x.duration())}else a.timeline=0;return f===!0&&!Jb&&(Ka=Vo(a),on.killTweensOf(y),Ka=0),Xs(v,Vo(a),s),r.reversed&&a.reverse(),r.paused&&a.paused(!0),(h||!u&&!m&&a._start===Nn(v._time)&&er(h)&&vte(Vo(a))&&v.data!=="nested")&&(a._tTime=-1e-8,a.render(Math.max(0,-c)||0)),_&&cI(Vo(a),_),a}var t=e.prototype;return t.render=function(r,s,o){var a=this._time,l=this._tDur,u=this._dur,c=r<0,h=r>l-pi&&!c?l:r<pi?0:r,d,f,m,g,_,p,v,y,x;if(!u)xte(this,r,s,o);else if(h!==this._tTime||!r||o||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==c||this._lazy){if(d=h,y=this.timeline,this._repeat){if(g=u+this._rDelay,this._repeat<-1&&c)return this.totalTime(g*100+r,s,o);if(d=Nn(h%g),h===l?(m=this._repeat,d=u):(_=Nn(h/g),m=~~_,m&&m===_?(d=u,m--):d>u&&(d=u)),p=this._yoyo&&m&1,p&&(x=this._yEase,d=u-d),_=vh(this._tTime,g),d===a&&!o&&this._initted&&m===_)return this._tTime=h,this;m!==_&&(y&&this._yEase&&CI(y,p),this.vars.repeatRefresh&&!p&&!this._lock&&d!==g&&this._initted&&(this._lock=o=1,this.render(Nn(g*m),!0).invalidate()._lock=0))}if(!this._initted){if(hI(this,c?r:d,o,s,h))return this._tTime=0,this;if(a!==this._time&&!(o&&this.vars.repeatRefresh&&m!==_))return this;if(u!==this._dur)return this.render(r,s,o)}if(this._tTime=h,this._time=d,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=v=(x||this._ease)(d/u),this._from&&(this.ratio=v=1-v),d&&!a&&!s&&!m&&(Cr(this,"onStart"),this._tTime!==h))return this;for(f=this._pt;f;)f.r(v,f.d),f=f._next;y&&y.render(r<0?r:y._dur*y._ease(d/this._dur),s,o)||this._startAt&&(this._zTime=r),this._onUpdate&&!s&&(c&&fw(this,r,s,o),Cr(this,"onUpdate")),this._repeat&&m!==_&&this.vars.onRepeat&&!s&&this.parent&&Cr(this,"onRepeat"),(h===this._tDur||!h)&&this._tTime===h&&(c&&!this._onUpdate&&fw(this,r,!0,!0),(r||!u)&&(h===this._tDur&&this._ts>0||!h&&this._ts<0)&&Xa(this,1),!s&&!(c&&!a)&&(h||a||p)&&(Cr(this,h===l?"onComplete":"onReverseComplete",!0),this._prom&&!(h<l&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(r){return(!r||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(r),n.prototype.invalidate.call(this,r)},t.resetTo=function(r,s,o,a,l){up||Rr.wake(),this._ts||this.play();var u=Math.min(this._dur,(this._dp._time-this._start)*this._ts),c;return this._initted||bw(this,u),c=this._ease(u/this._dur),kte(this,r,s,o,a,c,u,l)?this.resetTo(r,s,o,a,1):(p0(this,0),this.parent||aI(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(r,s){if(s===void 0&&(s="all"),!r&&(!s||s==="all"))return this._lazy=this._pt=0,this.parent?ap(this):this.scrollTrigger&&this.scrollTrigger.kill(!!ei),this;if(this.timeline){var o=this.timeline.totalDuration();return this.timeline.killTweensOf(r,s,Ka&&Ka.vars.overwrite!==!0)._first||ap(this),this.parent&&o!==this.timeline.totalDuration()&&yh(this,this._dur*this.timeline._tDur/o,0,1),this}var a=this._targets,l=r?Xr(r):a,u=this._ptLookup,c=this._pt,h,d,f,m,g,_,p;if((!s||s==="all")&&gte(a,l))return s==="all"&&(this._pt=0),ap(this);for(h=this._op=this._op||[],s!=="all"&&(jn(s)&&(g={},tr(s,function(v){return g[v]=1}),s=g),s=zte(a,s)),p=a.length;p--;)if(~l.indexOf(a[p])){d=u[p],s==="all"?(h[p]=s,m=d,f={}):(f=h[p]=h[p]||{},m=s);for(g in m)_=d&&d[g],_&&((!("kill"in _.d)||_.d.kill(g)===!0)&&h0(this,_,"_pt"),delete d[g]),f!=="all"&&(f[g]=1)}return this._initted&&!this._pt&&c&&ap(this),this},e.to=function(r,s){return new e(r,s,arguments[2])},e.from=function(r,s){return rp(1,arguments)},e.delayedCall=function(r,s,o,a){return new e(s,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:r,onComplete:s,onReverseComplete:s,onCompleteParams:o,onReverseCompleteParams:o,callbackScope:a})},e.fromTo=function(r,s,o){return rp(2,arguments)},e.set=function(r,s){return s.duration=0,s.repeatDelay||(s.repeat=0),new e(r,s)},e.killTweensOf=function(r,s,o){return on.killTweensOf(r,s,o)},e}(cp);Ar(Pn.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),tr("staggerTo,staggerFrom,staggerFromTo",function(n){Pn[n]=function(){var e=new Li,t=mw.call(arguments,0);return t.splice(n==="staggerFromTo"?5:4,0,0),e[n].apply(e,t)}});var ww=function(e,t,i){return e[t]=i},II=function(e,t,i){return e[t](i)},Vte=function(e,t,i,r){return e[t](r.fp,i)},Hte=function(e,t,i){return e.setAttribute(t,i)},Mw=function(e,t){return hn(e[t])?II:tw(e[t])&&e.setAttribute?Hte:ww},UI=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},Wte=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},FI=function(e,t){var i=t._pt,r="";if(!e&&t.b)r=t.b;else if(e===1&&t.e)r=t.e;else{for(;i;)r=i.p+(i.m?i.m(i.s+i.c*e):Math.round((i.s+i.c*e)*1e4)/1e4)+r,i=i._next;r+=t.c}t.set(t.t,t.p,r,t)},Ew=function(e,t){for(var i=t._pt;i;)i.r(e,i.d),i=i._next},$te=function(e,t,i,r){for(var s=this._pt,o;s;)o=s._next,s.p===r&&s.modifier(e,t,i),s=o},jte=function(e){for(var t=this._pt,i,r;t;)r=t._next,t.p===e&&!t.op||t.op===e?h0(this,t,"_pt"):t.dep||(i=1),t=r;return!i},Xte=function(e,t,i,r){r.mSet(e,t,r.m.call(r.tween,i,r.mt),r)},OI=function(e){for(var t=e._pt,i,r,s,o;t;){for(i=t._next,r=s;r&&r.pr>t.pr;)r=r._next;(t._prev=r?r._prev:o)?t._prev._next=t:s=t,(t._next=r)?r._prev=t:o=t,t=i}e._pt=s},nr=function(){function n(t,i,r,s,o,a,l,u,c){this.t=i,this.s=s,this.c=o,this.p=r,this.r=a||UI,this.d=l||this,this.set=u||ww,this.pr=c||0,this._next=t,t&&(t._prev=this)}var e=n.prototype;return e.modifier=function(i,r,s){this.mSet=this.mSet||this.set,this.set=Xte,this.m=i,this.mt=s,this.tween=r},n}();tr(hw+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(n){return lw[n]=1}),Mr.TweenMax=Mr.TweenLite=Pn,Mr.TimelineLite=Mr.TimelineMax=Li,on=new Li({sortChildren:!1,defaults:ph,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),wr.stringFilter=EI;var ru=[],m0={},qte=[],BI=0,Yte=0,Aw=function(e){return(m0[e]||qte).map(function(t){return t()})},Cw=function(){var e=Date.now(),t=[];e-BI>2&&(Aw("matchMediaInit"),ru.forEach(function(i){var r=i.queries,s=i.conditions,o,a,l,u;for(a in r)o=js.matchMedia(r[a]).matches,o&&(l=1),o!==s[a]&&(s[a]=o,u=1);u&&(i.revert(),l&&t.push(i))}),Aw("matchMediaRevert"),t.forEach(function(i){return i.onMatch(i,function(r){return i.add(null,r)})}),BI=e,Aw("matchMedia"))},kI=function(){function n(t,i){this.selector=i&&gw(i),this.data=[],this._r=[],this.isReverted=!1,this.id=Yte++,t&&this.add(t)}var e=n.prototype;return e.add=function(i,r,s){hn(i)&&(s=r,r=i,i=hn);var o=this,a=function(){var u=Zt,c=o.selector,h;return u&&u!==o&&u.data.push(o),s&&(o.selector=gw(s)),Zt=o,h=r.apply(o,arguments),hn(h)&&o._r.push(h),Zt=u,o.selector=c,o.isReverted=!1,h};return o.last=a,i===hn?a(o,function(l){return o.add(null,l)}):i?o[i]=a:a},e.ignore=function(i){var r=Zt;Zt=null,i(this),Zt=r},e.getTweens=function(){var i=[];return this.data.forEach(function(r){return r instanceof n?i.push.apply(i,r.getTweens()):r instanceof Pn&&!(r.parent&&r.parent.data==="nested")&&i.push(r)}),i},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(i,r){var s=this;if(i?function(){for(var a=s.getTweens(),l=s.data.length,u;l--;)u=s.data[l],u.data==="isFlip"&&(u.revert(),u.getChildren(!0,!0,!1).forEach(function(c){return a.splice(a.indexOf(c),1)}));for(a.map(function(c){return{g:c._dur||c._delay||c._sat&&!c._sat.vars.immediateRender?c.globalTime(0):-1/0,t:c}}).sort(function(c,h){return h.g-c.g||-1/0}).forEach(function(c){return c.t.revert(i)}),l=s.data.length;l--;)u=s.data[l],u instanceof Li?u.data!=="nested"&&(u.scrollTrigger&&u.scrollTrigger.revert(),u.kill()):!(u instanceof Pn)&&u.revert&&u.revert(i);s._r.forEach(function(c){return c(i,s)}),s.isReverted=!0}():this.data.forEach(function(a){return a.kill&&a.kill()}),this.clear(),r)for(var o=ru.length;o--;)ru[o].id===this.id&&ru.splice(o,1)},e.revert=function(i){this.kill(i||{})},n}(),Kte=function(){function n(t){this.contexts=[],this.scope=t,Zt&&Zt.data.push(this)}var e=n.prototype;return e.add=function(i,r,s){$s(i)||(i={matches:i});var o=new kI(0,s||this.scope),a=o.conditions={},l,u,c;Zt&&!o.selector&&(o.selector=Zt.selector),this.contexts.push(o),r=o.add("onMatch",r),o.queries=i;for(u in i)u==="all"?c=1:(l=js.matchMedia(i[u]),l&&(ru.indexOf(o)<0&&ru.push(o),(a[u]=l.matches)&&(c=1),l.addListener?l.addListener(Cw):l.addEventListener("change",Cw)));return c&&r(o,function(h){return o.add(null,h)}),this},e.revert=function(i){this.kill(i||{})},e.kill=function(i){this.contexts.forEach(function(r){return r.kill(i,!0)})},n}(),g0={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach(function(r){return TI(r)})},timeline:function(e){return new Li(e)},getTweensOf:function(e,t){return on.getTweensOf(e,t)},getProperty:function(e,t,i,r){jn(e)&&(e=Xr(e)[0]);var s=eu(e||{}).get,o=i?sI:rI;return i==="native"&&(i=""),e&&(t?o((Er[t]&&Er[t].get||s)(e,t,i,r)):function(a,l,u){return o((Er[a]&&Er[a].get||s)(e,a,l,u))})},quickSetter:function(e,t,i){if(e=Xr(e),e.length>1){var r=e.map(function(c){return ir.quickSetter(c,t,i)}),s=r.length;return function(c){for(var h=s;h--;)r[h](c)}}e=e[0]||{};var o=Er[t],a=eu(e),l=a.harness&&(a.harness.aliases||{})[t]||t,u=o?function(c){var h=new o;xh._pt=0,h.init(e,i?c+i:c,xh,0,[e]),h.render(1,h),xh._pt&&Ew(1,xh)}:a.set(e,l);return o?u:function(c){return u(e,l,i?c+i:c,a,1)}},quickTo:function(e,t,i){var r,s=ir.to(e,Ar((r={},r[t]="+=0.1",r.paused=!0,r.stagger=0,r),i||{})),o=function(l,u,c){return s.resetTo(t,l,u,c)};return o.tween=s,o},isTweening:function(e){return on.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=nu(e.ease,ph.ease)),oI(ph,e||{})},config:function(e){return oI(wr,e||{})},registerEffect:function(e){var t=e.name,i=e.effect,r=e.plugins,s=e.defaults,o=e.extendTimeline;(r||"").split(",").forEach(function(a){return a&&!Er[a]&&!Mr[a]&&tp(t+" effect requires "+a+" plugin.")}),cw[t]=function(a,l,u){return i(Xr(a),Ar(l||{},s),u)},o&&(Li.prototype[t]=function(a,l,u){return this.add(cw[t](a,$s(l)?l:(u=l)&&{},this),u)})},registerEase:function(e,t){mt[e]=nu(t)},parseEase:function(e,t){return arguments.length?nu(e,t):mt},getById:function(e){return on.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var i=new Li(e),r,s;for(i.smoothChildTiming=er(e.smoothChildTiming),on.remove(i),i._dp=0,i._time=i._tTime=on._time,r=on._first;r;)s=r._next,(t||!(!r._dur&&r instanceof Pn&&r.vars.onComplete===r._targets[0]))&&Xs(i,r,r._start-r._delay),r=s;return Xs(on,i,0),i},context:function(e,t){return e?new kI(e,t):Zt},matchMedia:function(e){return new Kte(e)},matchMediaRefresh:function(){return ru.forEach(function(e){var t=e.conditions,i,r;for(r in t)t[r]&&(t[r]=!1,i=1);i&&e.revert()})||Cw()},addEventListener:function(e,t){var i=m0[e]||(m0[e]=[]);~i.indexOf(t)||i.push(t)},removeEventListener:function(e,t){var i=m0[e],r=i&&i.indexOf(t);r>=0&&i.splice(r,1)},utils:{wrap:Cte,wrapYoyo:Rte,distribute:mI,random:_I,snap:gI,normalize:Ate,getUnit:gi,clamp:bte,splitColor:bI,toArray:Xr,selector:gw,mapRange:yI,pipe:Mte,unitize:Ete,interpolate:Nte,shuffle:pI},install:ZL,effects:cw,ticker:Rr,updateRoot:Li.updateRoot,plugins:Er,globalTimeline:on,core:{PropTween:nr,globals:JL,Tween:Pn,Timeline:Li,Animation:cp,getCache:eu,_removeLinkedListItem:h0,reverting:function(){return ei},context:function(e){return e&&Zt&&(Zt.data.push(e),e._ctx=Zt),Zt},suppressOverwrites:function(e){return Jb=e}}};tr("to,from,fromTo,delayedCall,set,killTweensOf",function(n){return g0[n]=Pn[n]}),Rr.add(Li.updateRoot),xh=g0.to({},{duration:0});var Qte=function(e,t){for(var i=e._pt;i&&i.p!==t&&i.op!==t&&i.fp!==t;)i=i._next;return i},Zte=function(e,t){var i=e._targets,r,s,o;for(r in t)for(s=i.length;s--;)o=e._ptLookup[s][r],o&&(o=o.d)&&(o._pt&&(o=Qte(o,r)),o&&o.modifier&&o.modifier(t[r],e,i[s],r))},Rw=function(e,t){return{name:e,rawVars:1,init:function(r,s,o){o._onInit=function(a){var l,u;if(jn(s)&&(l={},tr(s,function(c){return l[c]=1}),s=l),t){l={};for(u in s)l[u]=t(s[u]);s=l}Zte(a,s)}}}},ir=g0.registerPlugin({name:"attr",init:function(e,t,i,r,s){var o,a,l;this.tween=i;for(o in t)l=e.getAttribute(o)||"",a=this.add(e,"setAttribute",(l||0)+"",t[o],r,s,0,0,o),a.op=o,a.b=l,this._props.push(o)},render:function(e,t){for(var i=t._pt;i;)ei?i.set(i.t,i.p,i.b,i):i.r(e,i.d),i=i._next}},{name:"endArray",init:function(e,t){for(var i=t.length;i--;)this.add(e,i,e[i]||0,t[i],0,0,0,0,0,1)}},Rw("roundProps",_w),Rw("modifiers"),Rw("snap",gI))||g0;Pn.version=Li.version=ir.version="3.12.7",QL=1,nw()&&Sh(),mt.Power0,mt.Power1,mt.Power2,mt.Power3,mt.Power4,mt.Linear,mt.Quad,mt.Cubic,mt.Quart,mt.Quint,mt.Strong,mt.Elastic,mt.Back,mt.SteppedEase,mt.Bounce,mt.Sine,mt.Expo,mt.Circ;/*!
 * CSSPlugin 3.12.7
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var zI,Qa,Th,Nw,su,GI,Pw,Jte=function(){return typeof window<"u"},Wo={},ou=180/Math.PI,bh=Math.PI/180,wh=Math.atan2,VI=1e8,Dw=/([A-Z])/g,ene=/(left|right|width|margin|padding|x)/i,tne=/[\s,\(]\S/,qs={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Lw=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},nne=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},ine=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},rne=function(e,t){var i=t.s+t.c*e;t.set(t.t,t.p,~~(i+(i<0?-.5:.5))+t.u,t)},HI=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},WI=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},sne=function(e,t,i){return e.style[t]=i},one=function(e,t,i){return e.style.setProperty(t,i)},ane=function(e,t,i){return e._gsap[t]=i},lne=function(e,t,i){return e._gsap.scaleX=e._gsap.scaleY=i},une=function(e,t,i,r,s){var o=e._gsap;o.scaleX=o.scaleY=i,o.renderTransform(s,o)},cne=function(e,t,i,r,s){var o=e._gsap;o[t]=i,o.renderTransform(s,o)},an="transform",rr=an+"Origin",hne=function n(e,t){var i=this,r=this.target,s=r.style,o=r._gsap;if(e in Wo&&s){if(this.tfm=this.tfm||{},e!=="transform")e=qs[e]||e,~e.indexOf(",")?e.split(",").forEach(function(a){return i.tfm[a]=$o(r,a)}):this.tfm[e]=o.x?o[e]:$o(r,e),e===rr&&(this.tfm.zOrigin=o.zOrigin);else return qs.transform.split(",").forEach(function(a){return n.call(i,a,t)});if(this.props.indexOf(an)>=0)return;o.svg&&(this.svgo=r.getAttribute("data-svg-origin"),this.props.push(rr,t,"")),e=an}(s||t)&&this.props.push(e,t,s[e])},$I=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},dne=function(){var e=this.props,t=this.target,i=t.style,r=t._gsap,s,o;for(s=0;s<e.length;s+=3)e[s+1]?e[s+1]===2?t[e[s]](e[s+2]):t[e[s]]=e[s+2]:e[s+2]?i[e[s]]=e[s+2]:i.removeProperty(e[s].substr(0,2)==="--"?e[s]:e[s].replace(Dw,"-$1").toLowerCase());if(this.tfm){for(o in this.tfm)r[o]=this.tfm[o];r.svg&&(r.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),s=Pw(),(!s||!s.isStart)&&!i[an]&&($I(i),r.zOrigin&&i[rr]&&(i[rr]+=" "+r.zOrigin+"px",r.zOrigin=0,r.renderTransform()),r.uncache=1)}},jI=function(e,t){var i={target:e,props:[],revert:dne,save:hne};return e._gsap||ir.core.getCache(e),t&&e.style&&e.nodeType&&t.split(",").forEach(function(r){return i.save(r)}),i},XI,Iw=function(e,t){var i=Qa.createElementNS?Qa.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Qa.createElement(e);return i&&i.style?i:Qa.createElement(e)},Ys=function n(e,t,i){var r=getComputedStyle(e);return r[t]||r.getPropertyValue(t.replace(Dw,"-$1").toLowerCase())||r.getPropertyValue(t)||!i&&n(e,Mh(t)||t,1)||""},qI="O,Moz,ms,Ms,Webkit".split(","),Mh=function(e,t,i){var r=t||su,s=r.style,o=5;if(e in s&&!i)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);o--&&!(qI[o]+e in s););return o<0?null:(o===3?"ms":o>=0?qI[o]:"")+e},Uw=function(){Jte()&&window.document&&(zI=window,Qa=zI.document,Th=Qa.documentElement,su=Iw("div")||{style:{}},Iw("div"),an=Mh(an),rr=an+"Origin",su.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",XI=!!Mh("perspective"),Pw=ir.core.reverting,Nw=1)},YI=function(e){var t=e.ownerSVGElement,i=Iw("svg",t&&t.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),r=e.cloneNode(!0),s;r.style.display="block",i.appendChild(r),Th.appendChild(i);try{s=r.getBBox()}catch{}return i.removeChild(r),Th.removeChild(i),s},KI=function(e,t){for(var i=t.length;i--;)if(e.hasAttribute(t[i]))return e.getAttribute(t[i])},QI=function(e){var t,i;try{t=e.getBBox()}catch{t=YI(e),i=1}return t&&(t.width||t.height)||i||(t=YI(e)),t&&!t.width&&!t.x&&!t.y?{x:+KI(e,["x","cx","x1"])||0,y:+KI(e,["y","cy","y1"])||0,width:0,height:0}:t},ZI=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&QI(e))},au=function(e,t){if(t){var i=e.style,r;t in Wo&&t!==rr&&(t=an),i.removeProperty?(r=t.substr(0,2),(r==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),i.removeProperty(r==="--"?t:t.replace(Dw,"-$1").toLowerCase())):i.removeAttribute(t)}},Za=function(e,t,i,r,s,o){var a=new nr(e._pt,t,i,0,1,o?WI:HI);return e._pt=a,a.b=r,a.e=s,e._props.push(i),a},JI={deg:1,rad:1,turn:1},fne={grid:1,flex:1},Ja=function n(e,t,i,r){var s=parseFloat(i)||0,o=(i+"").trim().substr((s+"").length)||"px",a=su.style,l=ene.test(t),u=e.tagName.toLowerCase()==="svg",c=(u?"client":"offset")+(l?"Width":"Height"),h=100,d=r==="px",f=r==="%",m,g,_,p;if(r===o||!s||JI[r]||JI[o])return s;if(o!=="px"&&!d&&(s=n(e,t,i,"px")),p=e.getCTM&&ZI(e),(f||o==="%")&&(Wo[t]||~t.indexOf("adius")))return m=p?e.getBBox()[l?"width":"height"]:e[c],yn(f?s/m*h:s/100*m);if(a[l?"width":"height"]=h+(d?o:r),g=r!=="rem"&&~t.indexOf("adius")||r==="em"&&e.appendChild&&!u?e:e.parentNode,p&&(g=(e.ownerSVGElement||{}).parentNode),(!g||g===Qa||!g.appendChild)&&(g=Qa.body),_=g._gsap,_&&f&&_.width&&l&&_.time===Rr.time&&!_.uncache)return yn(s/_.width*h);if(f&&(t==="height"||t==="width")){var v=e.style[t];e.style[t]=h+r,m=e[c],v?e.style[t]=v:au(e,t)}else(f||o==="%")&&!fne[Ys(g,"display")]&&(a.position=Ys(e,"position")),g===e&&(a.position="static"),g.appendChild(su),m=su[c],g.removeChild(su),a.position="absolute";return l&&f&&(_=eu(g),_.time=Rr.time,_.width=g[c]),yn(d?m*s/h:m&&s?h/m*s:0)},$o=function(e,t,i,r){var s;return Nw||Uw(),t in qs&&t!=="transform"&&(t=qs[t],~t.indexOf(",")&&(t=t.split(",")[0])),Wo[t]&&t!=="transform"?(s=fp(e,r),s=t!=="transformOrigin"?s[t]:s.svg?s.origin:v0(Ys(e,rr))+" "+s.zOrigin+"px"):(s=e.style[t],(!s||s==="auto"||r||~(s+"").indexOf("calc("))&&(s=_0[t]&&_0[t](e,t,i)||Ys(e,t)||nI(e,t)||(t==="opacity"?1:0))),i&&!~(s+"").trim().indexOf(" ")?Ja(e,t,s,i)+i:s},pne=function(e,t,i,r){if(!i||i==="none"){var s=Mh(t,e,1),o=s&&Ys(e,s,1);o&&o!==i?(t=s,i=o):t==="borderColor"&&(i=Ys(e,"borderTopColor"))}var a=new nr(this._pt,e.style,t,0,1,FI),l=0,u=0,c,h,d,f,m,g,_,p,v,y,x,S;if(a.b=i,a.e=r,i+="",r+="",r==="auto"&&(g=e.style[t],e.style[t]=r,r=Ys(e,t)||r,g?e.style[t]=g:au(e,t)),c=[i,r],EI(c),i=c[0],r=c[1],d=i.match(mh)||[],S=r.match(mh)||[],S.length){for(;h=mh.exec(r);)_=h[0],v=r.substring(l,h.index),m?m=(m+1)%5:(v.substr(-5)==="rgba("||v.substr(-5)==="hsla(")&&(m=1),_!==(g=d[u++]||"")&&(f=parseFloat(g)||0,x=g.substr((f+"").length),_.charAt(1)==="="&&(_=gh(f,_)+x),p=parseFloat(_),y=_.substr((p+"").length),l=mh.lastIndex-y.length,y||(y=y||wr.units[t]||x,l===r.length&&(r+=y,a.e+=y)),x!==y&&(f=Ja(e,t,g,y)||0),a._pt={_next:a._pt,p:v||u===1?v:",",s:f,c:p-f,m:m&&m<4||t==="zIndex"?Math.round:0});a.c=l<r.length?r.substring(l,r.length):""}else a.r=t==="display"&&r==="none"?WI:HI;return YL.test(r)&&(a.e=0),this._pt=a,a},eU={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},mne=function(e){var t=e.split(" "),i=t[0],r=t[1]||"50%";return(i==="top"||i==="bottom"||r==="left"||r==="right")&&(e=i,i=r,r=e),t[0]=eU[i]||i,t[1]=eU[r]||r,t.join(" ")},gne=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var i=t.t,r=i.style,s=t.u,o=i._gsap,a,l,u;if(s==="all"||s===!0)r.cssText="",l=1;else for(s=s.split(","),u=s.length;--u>-1;)a=s[u],Wo[a]&&(l=1,a=a==="transformOrigin"?rr:an),au(i,a);l&&(au(i,an),o&&(o.svg&&i.removeAttribute("transform"),r.scale=r.rotate=r.translate="none",fp(i,1),o.uncache=1,$I(r)))}},_0={clearProps:function(e,t,i,r,s){if(s.data!=="isFromStart"){var o=e._pt=new nr(e._pt,t,i,0,0,gne);return o.u=r,o.pr=-10,o.tween=s,e._props.push(i),1}}},dp=[1,0,0,1,0,0],tU={},nU=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},iU=function(e){var t=Ys(e,an);return nU(t)?dp:t.substr(7).match(qL).map(yn)},Fw=function(e,t){var i=e._gsap||eu(e),r=e.style,s=iU(e),o,a,l,u;return i.svg&&e.getAttribute("transform")?(l=e.transform.baseVal.consolidate().matrix,s=[l.a,l.b,l.c,l.d,l.e,l.f],s.join(",")==="1,0,0,1,0,0"?dp:s):(s===dp&&!e.offsetParent&&e!==Th&&!i.svg&&(l=r.display,r.display="block",o=e.parentNode,(!o||!e.offsetParent&&!e.getBoundingClientRect().width)&&(u=1,a=e.nextElementSibling,Th.appendChild(e)),s=iU(e),l?r.display=l:au(e,"display"),u&&(a?o.insertBefore(e,a):o?o.appendChild(e):Th.removeChild(e))),t&&s.length>6?[s[0],s[1],s[4],s[5],s[12],s[13]]:s)},Ow=function(e,t,i,r,s,o){var a=e._gsap,l=s||Fw(e,!0),u=a.xOrigin||0,c=a.yOrigin||0,h=a.xOffset||0,d=a.yOffset||0,f=l[0],m=l[1],g=l[2],_=l[3],p=l[4],v=l[5],y=t.split(" "),x=parseFloat(y[0])||0,S=parseFloat(y[1])||0,T,w,E,M;i?l!==dp&&(w=f*_-m*g)&&(E=x*(_/w)+S*(-g/w)+(g*v-_*p)/w,M=x*(-m/w)+S*(f/w)-(f*v-m*p)/w,x=E,S=M):(T=QI(e),x=T.x+(~y[0].indexOf("%")?x/100*T.width:x),S=T.y+(~(y[1]||y[0]).indexOf("%")?S/100*T.height:S)),r||r!==!1&&a.smooth?(p=x-u,v=S-c,a.xOffset=h+(p*f+v*g)-p,a.yOffset=d+(p*m+v*_)-v):a.xOffset=a.yOffset=0,a.xOrigin=x,a.yOrigin=S,a.smooth=!!r,a.origin=t,a.originIsAbsolute=!!i,e.style[rr]="0px 0px",o&&(Za(o,a,"xOrigin",u,x),Za(o,a,"yOrigin",c,S),Za(o,a,"xOffset",h,a.xOffset),Za(o,a,"yOffset",d,a.yOffset)),e.setAttribute("data-svg-origin",x+" "+S)},fp=function(e,t){var i=e._gsap||new NI(e);if("x"in i&&!t&&!i.uncache)return i;var r=e.style,s=i.scaleX<0,o="px",a="deg",l=getComputedStyle(e),u=Ys(e,rr)||"0",c,h,d,f,m,g,_,p,v,y,x,S,T,w,E,M,b,C,I,U,D,L,F,Q,B,J,H,K,le,Pe,O,j;return c=h=d=g=_=p=v=y=x=0,f=m=1,i.svg=!!(e.getCTM&&ZI(e)),l.translate&&((l.translate!=="none"||l.scale!=="none"||l.rotate!=="none")&&(r[an]=(l.translate!=="none"?"translate3d("+(l.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(l.rotate!=="none"?"rotate("+l.rotate+") ":"")+(l.scale!=="none"?"scale("+l.scale.split(" ").join(",")+") ":"")+(l[an]!=="none"?l[an]:"")),r.scale=r.rotate=r.translate="none"),w=Fw(e,i.svg),i.svg&&(i.uncache?(B=e.getBBox(),u=i.xOrigin-B.x+"px "+(i.yOrigin-B.y)+"px",Q=""):Q=!t&&e.getAttribute("data-svg-origin"),Ow(e,Q||u,!!Q||i.originIsAbsolute,i.smooth!==!1,w)),S=i.xOrigin||0,T=i.yOrigin||0,w!==dp&&(C=w[0],I=w[1],U=w[2],D=w[3],c=L=w[4],h=F=w[5],w.length===6?(f=Math.sqrt(C*C+I*I),m=Math.sqrt(D*D+U*U),g=C||I?wh(I,C)*ou:0,v=U||D?wh(U,D)*ou+g:0,v&&(m*=Math.abs(Math.cos(v*bh))),i.svg&&(c-=S-(S*C+T*U),h-=T-(S*I+T*D))):(j=w[6],Pe=w[7],H=w[8],K=w[9],le=w[10],O=w[11],c=w[12],h=w[13],d=w[14],E=wh(j,le),_=E*ou,E&&(M=Math.cos(-E),b=Math.sin(-E),Q=L*M+H*b,B=F*M+K*b,J=j*M+le*b,H=L*-b+H*M,K=F*-b+K*M,le=j*-b+le*M,O=Pe*-b+O*M,L=Q,F=B,j=J),E=wh(-U,le),p=E*ou,E&&(M=Math.cos(-E),b=Math.sin(-E),Q=C*M-H*b,B=I*M-K*b,J=U*M-le*b,O=D*b+O*M,C=Q,I=B,U=J),E=wh(I,C),g=E*ou,E&&(M=Math.cos(E),b=Math.sin(E),Q=C*M+I*b,B=L*M+F*b,I=I*M-C*b,F=F*M-L*b,C=Q,L=B),_&&Math.abs(_)+Math.abs(g)>359.9&&(_=g=0,p=180-p),f=yn(Math.sqrt(C*C+I*I+U*U)),m=yn(Math.sqrt(F*F+j*j)),E=wh(L,F),v=Math.abs(E)>2e-4?E*ou:0,x=O?1/(O<0?-O:O):0),i.svg&&(Q=e.getAttribute("transform"),i.forceCSS=e.setAttribute("transform","")||!nU(Ys(e,an)),Q&&e.setAttribute("transform",Q))),Math.abs(v)>90&&Math.abs(v)<270&&(s?(f*=-1,v+=g<=0?180:-180,g+=g<=0?180:-180):(m*=-1,v+=v<=0?180:-180)),t=t||i.uncache,i.x=c-((i.xPercent=c&&(!t&&i.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-c)?-50:0)))?e.offsetWidth*i.xPercent/100:0)+o,i.y=h-((i.yPercent=h&&(!t&&i.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-h)?-50:0)))?e.offsetHeight*i.yPercent/100:0)+o,i.z=d+o,i.scaleX=yn(f),i.scaleY=yn(m),i.rotation=yn(g)+a,i.rotationX=yn(_)+a,i.rotationY=yn(p)+a,i.skewX=v+a,i.skewY=y+a,i.transformPerspective=x+o,(i.zOrigin=parseFloat(u.split(" ")[2])||!t&&i.zOrigin||0)&&(r[rr]=v0(u)),i.xOffset=i.yOffset=0,i.force3D=wr.force3D,i.renderTransform=i.svg?vne:XI?rU:_ne,i.uncache=0,i},v0=function(e){return(e=e.split(" "))[0]+" "+e[1]},Bw=function(e,t,i){var r=gi(t);return yn(parseFloat(t)+parseFloat(Ja(e,"x",i+"px",r)))+r},_ne=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,rU(e,t)},lu="0deg",pp="0px",uu=") ",rU=function(e,t){var i=t||this,r=i.xPercent,s=i.yPercent,o=i.x,a=i.y,l=i.z,u=i.rotation,c=i.rotationY,h=i.rotationX,d=i.skewX,f=i.skewY,m=i.scaleX,g=i.scaleY,_=i.transformPerspective,p=i.force3D,v=i.target,y=i.zOrigin,x="",S=p==="auto"&&e&&e!==1||p===!0;if(y&&(h!==lu||c!==lu)){var T=parseFloat(c)*bh,w=Math.sin(T),E=Math.cos(T),M;T=parseFloat(h)*bh,M=Math.cos(T),o=Bw(v,o,w*M*-y),a=Bw(v,a,-Math.sin(T)*-y),l=Bw(v,l,E*M*-y+y)}_!==pp&&(x+="perspective("+_+uu),(r||s)&&(x+="translate("+r+"%, "+s+"%) "),(S||o!==pp||a!==pp||l!==pp)&&(x+=l!==pp||S?"translate3d("+o+", "+a+", "+l+") ":"translate("+o+", "+a+uu),u!==lu&&(x+="rotate("+u+uu),c!==lu&&(x+="rotateY("+c+uu),h!==lu&&(x+="rotateX("+h+uu),(d!==lu||f!==lu)&&(x+="skew("+d+", "+f+uu),(m!==1||g!==1)&&(x+="scale("+m+", "+g+uu),v.style[an]=x||"translate(0, 0)"},vne=function(e,t){var i=t||this,r=i.xPercent,s=i.yPercent,o=i.x,a=i.y,l=i.rotation,u=i.skewX,c=i.skewY,h=i.scaleX,d=i.scaleY,f=i.target,m=i.xOrigin,g=i.yOrigin,_=i.xOffset,p=i.yOffset,v=i.forceCSS,y=parseFloat(o),x=parseFloat(a),S,T,w,E,M;l=parseFloat(l),u=parseFloat(u),c=parseFloat(c),c&&(c=parseFloat(c),u+=c,l+=c),l||u?(l*=bh,u*=bh,S=Math.cos(l)*h,T=Math.sin(l)*h,w=Math.sin(l-u)*-d,E=Math.cos(l-u)*d,u&&(c*=bh,M=Math.tan(u-c),M=Math.sqrt(1+M*M),w*=M,E*=M,c&&(M=Math.tan(c),M=Math.sqrt(1+M*M),S*=M,T*=M)),S=yn(S),T=yn(T),w=yn(w),E=yn(E)):(S=h,E=d,T=w=0),(y&&!~(o+"").indexOf("px")||x&&!~(a+"").indexOf("px"))&&(y=Ja(f,"x",o,"px"),x=Ja(f,"y",a,"px")),(m||g||_||p)&&(y=yn(y+m-(m*S+g*w)+_),x=yn(x+g-(m*T+g*E)+p)),(r||s)&&(M=f.getBBox(),y=yn(y+r/100*M.width),x=yn(x+s/100*M.height)),M="matrix("+S+","+T+","+w+","+E+","+y+","+x+")",f.setAttribute("transform",M),v&&(f.style[an]=M)},yne=function(e,t,i,r,s){var o=360,a=jn(s),l=parseFloat(s)*(a&&~s.indexOf("rad")?ou:1),u=l-r,c=r+u+"deg",h,d;return a&&(h=s.split("_")[1],h==="short"&&(u%=o,u!==u%(o/2)&&(u+=u<0?o:-360)),h==="cw"&&u<0?u=(u+o*VI)%o-~~(u/o)*o:h==="ccw"&&u>0&&(u=(u-o*VI)%o-~~(u/o)*o)),e._pt=d=new nr(e._pt,t,i,r,u,nne),d.e=c,d.u="deg",e._props.push(i),d},sU=function(e,t){for(var i in t)e[i]=t[i];return e},xne=function(e,t,i){var r=sU({},i._gsap),s="perspective,force3D,transformOrigin,svgOrigin",o=i.style,a,l,u,c,h,d,f,m;r.svg?(u=i.getAttribute("transform"),i.setAttribute("transform",""),o[an]=t,a=fp(i,1),au(i,an),i.setAttribute("transform",u)):(u=getComputedStyle(i)[an],o[an]=t,a=fp(i,1),o[an]=u);for(l in Wo)u=r[l],c=a[l],u!==c&&s.indexOf(l)<0&&(f=gi(u),m=gi(c),h=f!==m?Ja(i,l,u,m):parseFloat(u),d=parseFloat(c),e._pt=new nr(e._pt,a,l,h,d-h,Lw),e._pt.u=m||0,e._props.push(l));sU(a,r)};tr("padding,margin,Width,Radius",function(n,e){var t="Top",i="Right",r="Bottom",s="Left",o=(e<3?[t,i,r,s]:[t+s,t+i,r+i,r+s]).map(function(a){return e<2?n+a:"border"+a+n});_0[e>1?"border"+n:n]=function(a,l,u,c,h){var d,f;if(arguments.length<4)return d=o.map(function(m){return $o(a,m,u)}),f=d.join(" "),f.split(d[0]).length===5?d[0]:f;d=(c+"").split(" "),f={},o.forEach(function(m,g){return f[m]=d[g]=d[g]||d[(g-1)/2|0]}),a.init(l,f,h)}});var oU={name:"css",register:Uw,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,i,r,s){var o=this._props,a=e.style,l=i.vars.startAt,u,c,h,d,f,m,g,_,p,v,y,x,S,T,w,E;Nw||Uw(),this.styles=this.styles||jI(e),E=this.styles.props,this.tween=i;for(g in t)if(g!=="autoRound"&&(c=t[g],!(Er[g]&&PI(g,t,i,r,e,s)))){if(f=typeof c,m=_0[g],f==="function"&&(c=c.call(i,r,e,s),f=typeof c),f==="string"&&~c.indexOf("random(")&&(c=op(c)),m)m(this,e,g,c,i)&&(w=1);else if(g.substr(0,2)==="--")u=(getComputedStyle(e).getPropertyValue(g)+"").trim(),c+="",Ya.lastIndex=0,Ya.test(u)||(_=gi(u),p=gi(c)),p?_!==p&&(u=Ja(e,g,u,p)+p):_&&(c+=_),this.add(a,"setProperty",u,c,r,s,0,0,g),o.push(g),E.push(g,0,a[g]);else if(f!=="undefined"){if(l&&g in l?(u=typeof l[g]=="function"?l[g].call(i,r,e,s):l[g],jn(u)&&~u.indexOf("random(")&&(u=op(u)),gi(u+"")||u==="auto"||(u+=wr.units[g]||gi($o(e,g))||""),(u+"").charAt(1)==="="&&(u=$o(e,g))):u=$o(e,g),d=parseFloat(u),v=f==="string"&&c.charAt(1)==="="&&c.substr(0,2),v&&(c=c.substr(2)),h=parseFloat(c),g in qs&&(g==="autoAlpha"&&(d===1&&$o(e,"visibility")==="hidden"&&h&&(d=0),E.push("visibility",0,a.visibility),Za(this,a,"visibility",d?"inherit":"hidden",h?"inherit":"hidden",!h)),g!=="scale"&&g!=="transform"&&(g=qs[g],~g.indexOf(",")&&(g=g.split(",")[0]))),y=g in Wo,y){if(this.styles.save(g),x||(S=e._gsap,S.renderTransform&&!t.parseTransform||fp(e,t.parseTransform),T=t.smoothOrigin!==!1&&S.smooth,x=this._pt=new nr(this._pt,a,an,0,1,S.renderTransform,S,0,-1),x.dep=1),g==="scale")this._pt=new nr(this._pt,S,"scaleY",S.scaleY,(v?gh(S.scaleY,v+h):h)-S.scaleY||0,Lw),this._pt.u=0,o.push("scaleY",g),g+="X";else if(g==="transformOrigin"){E.push(rr,0,a[rr]),c=mne(c),S.svg?Ow(e,c,0,T,0,this):(p=parseFloat(c.split(" ")[2])||0,p!==S.zOrigin&&Za(this,S,"zOrigin",S.zOrigin,p),Za(this,a,g,v0(u),v0(c)));continue}else if(g==="svgOrigin"){Ow(e,c,1,T,0,this);continue}else if(g in tU){yne(this,S,g,d,v?gh(d,v+c):c);continue}else if(g==="smoothOrigin"){Za(this,S,"smooth",S.smooth,c);continue}else if(g==="force3D"){S[g]=c;continue}else if(g==="transform"){xne(this,c,e);continue}}else g in a||(g=Mh(g)||g);if(y||(h||h===0)&&(d||d===0)&&!tne.test(c)&&g in a)_=(u+"").substr((d+"").length),h||(h=0),p=gi(c)||(g in wr.units?wr.units[g]:_),_!==p&&(d=Ja(e,g,u,p)),this._pt=new nr(this._pt,y?S:a,g,d,(v?gh(d,v+h):h)-d,!y&&(p==="px"||g==="zIndex")&&t.autoRound!==!1?rne:Lw),this._pt.u=p||0,_!==p&&p!=="%"&&(this._pt.b=u,this._pt.r=ine);else if(g in a)pne.call(this,e,g,u,v?v+c:c);else if(g in e)this.add(e,g,u||e[g],v?v+c:c,r,s);else if(g!=="parseTransform"){aw(g,c);continue}y||(g in a?E.push(g,0,a[g]):typeof e[g]=="function"?E.push(g,2,e[g]()):E.push(g,1,u||e[g])),o.push(g)}}w&&OI(this)},render:function(e,t){if(t.tween._time||!Pw())for(var i=t._pt;i;)i.r(e,i.d),i=i._next;else t.styles.revert()},get:$o,aliases:qs,getSetter:function(e,t,i){var r=qs[t];return r&&r.indexOf(",")<0&&(t=r),t in Wo&&t!==rr&&(e._gsap.x||$o(e,"x"))?i&&GI===i?t==="scale"?lne:ane:(GI=i||{})&&(t==="scale"?une:cne):e.style&&!tw(e.style[t])?sne:~t.indexOf("-")?one:Mw(e,t)},core:{_removeProperty:au,_getMatrix:Fw}};ir.utils.checkPrefix=Mh,ir.core.getStyleSaver=jI,function(n,e,t,i){var r=tr(n+","+e+","+t,function(s){Wo[s]=1});tr(e,function(s){wr.units[s]="deg",tU[s]=1}),qs[r[13]]=n+","+e,tr(i,function(s){var o=s.split(":");qs[o[1]]=r[o[0]]})}("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY"),tr("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(n){wr.units[n]="px"}),ir.registerPlugin(oU);var mp=ir.registerPlugin(oU)||ir;mp.core.Tween;const Sne=()=>{const n=Ks.useRef(null),e=Ks.useRef(null),t=Ks.useRef(null),[i,r]=Ks.useState(null),[s,o]=Ks.useState(Wa);Ks.useEffect(()=>{if(!n.current)return;const c=document.createElement("div");c.className="tooltip",document.body.appendChild(c),t.current=c;const h=FL(s),d=zJ()(n.current).backgroundColor("rgba(0,0,0,0)").graphData(VJ).nodeLabel(null).nodeColor(g=>{switch(g.type){case"article":return"#0057FF";case"youtube_video":return"#FD00FD";case"special_project":return"#FF4B00";default:return"#999"}}).d3Force("link",ite().id(g=>g.id).distance(g=>{switch(g.type){case"type-link":return h.TYPE.DISTANCE;case"author-link":return h.AUTHOR.DISTANCE;case"issue-link":return h.ISSUE.DISTANCE;default:return 80}}).strength(g=>{switch(g.type){case"type-link":return h.TYPE.STRENGTH;case"author-link":return h.AUTHOR.STRENGTH;case"issue-link":return h.ISSUE.STRENGTH;default:return .6}})).linkColor(()=>s.visual.color).linkWidth(()=>s.visual.width).linkOpacity(s.visual.opacity).d3Force("charge",ote().strength(s.physics.repulsion.strength).distanceMax(s.physics.repulsion.maxDistance)).d3Force("collision",tte().radius(s.physics.collision.radius).strength(s.physics.collision.strength)).d3Force("center",s.physics.centerForce?Zee():null).nodeRelSize(6).nodeThreeObject(g=>{const _=document.createElement("canvas"),p=_.getContext("2d"),v=new Image;_.width=1024,_.height=Math.round(1024*(9/16));const x=Math.round(_.width*.1),S=new iB(_);S.minFilter=bi,S.magFilter=Sn,S.anisotropy=16,S.colorSpace=Be,S.generateMipmaps=!0;const T=new Ix({map:S,transparent:!0,depthWrite:!0,sizeAttenuation:!0}),w=new Y3(T),E=24,M=E*(9/16);return w.scale.set(E,M,1),v.crossOrigin="Anonymous",v.onload=()=>{p&&(p.clearRect(0,0,_.width,_.height),p.imageSmoothingEnabled=!0,p.imageSmoothingQuality="high",p.beginPath(),p.roundRect(0,0,_.width,_.height,x),p.clip(),p.drawImage(v,0,0,_.width,_.height),S.needsUpdate=!0)},v.src=g.imageUrl,w}).onNodeClick(g=>{r(g);const _=document.querySelector("[data-w-popup]"),p=document.querySelector("[data-w-image]"),v=document.querySelector("[data-w-author]"),y=document.querySelector("[data-w-title]"),x=document.querySelector("[data-w-description]"),S=document.querySelector("[data-w-close]"),T=[p,v,y,x].filter(Boolean);mp.set(T,{autoAlpha:0,scale:.95,filter:"blur(10px) brightness(1.5)"}),p&&(p.src=g.imageUrl),v&&(v.textContent=g.author?g.author.split("-").map(M=>M.charAt(0).toUpperCase()+M.slice(1)).join(" "):""),y&&(y.textContent=g.title),x&&(x.textContent=g.descriptor||""),_&&(_.style.display="flex",mp.to(_,{y:"0%",duration:.5,ease:"power3.out"}),mp.to(T,{autoAlpha:1,scale:1,filter:"blur(0px) brightness(1)",duration:.3,ease:"power2.out"})),S&&S.addEventListener("click",()=>{if(_){const M=mp.timeline({onComplete:()=>{_.style.display="none",r(null)}});M.to([p,v,y,x],{autoAlpha:0,scale:.95,filter:"blur(10px) brightness(1.5)",duration:.2,ease:"power2.in"},0),M.to(_,{y:"100%",duration:.4,ease:"power3.inOut"},0)}});const E=1+40/Math.hypot(g.x,g.y,g.z);e.current.cameraPosition({x:g.x*E,y:g.y*E,z:g.z*E},g,3e3)}).onNodeHover(g=>{if(t.current)if(g){const _=d.graph2ScreenCoords(g.x,g.y,g.z);switch(t.current.style.display="block",t.current.style.left=`${_.x}px`,t.current.style.top=`${_.y-10}px`,t.current.textContent=g.title.toUpperCase(),g.type){case"article":t.current.style.backgroundColor="#0057FF";break;case"youtube_video":t.current.style.backgroundColor="#FD00FD";break;case"special_project":t.current.style.backgroundColor="#FF4B00";break;default:t.current.style.backgroundColor="#999"}t.current.style.color="#FFFFFF",t.current.style.padding="2px 6px",t.current.style.borderRadius="4px",t.current.style.fontSize="14px",t.current.style.fontWeight="500",t.current.style.whiteSpace="nowrap",t.current.style.zIndex="1000",t.current.style.transition="all 0.2s ease"}else t.current.style.display="none"}),f=d.renderer();f.setClearAlpha(0),f.setPixelRatio(window.devicePixelRatio),f.setClearColor(0,0),f.alpha=!0,d.controls().enableDamping=!0,d.controls().dampingFactor=.1,d.controls().rotateSpeed=.8,e.current=d;const m=()=>{var g,_;d.width(((g=n.current)==null?void 0:g.clientWidth)??window.innerWidth),d.height(((_=n.current)==null?void 0:_.clientHeight)??window.innerHeight)};return window.addEventListener("resize",m),()=>{window.removeEventListener("resize",m),t.current&&document.body.removeChild(t.current),d._destructor()}},[]);const a=()=>{if(e.current){const c=e.current.camera().position.z;e.current.cameraPosition({z:c*.8})}},l=()=>{if(e.current){const c=e.current.camera().position.z;e.current.cameraPosition({z:c*1.2})}},u=()=>{e.current&&e.current.cameraPosition({x:0,y:0,z:200},{x:0,y:0,z:0},1e3)};return Qs.jsxs("div",{className:"relative w-full h-screen",children:[Qs.jsx("div",{ref:n,className:"w-full h-full"}),Qs.jsx(HJ,{onZoomIn:a,onZoomOut:l,onReset:u})]})};function Tne(){document.querySelector("style[data-tailwind]")&&console.warn("Found existing Tailwind styles. Widget styles might conflict."),document.querySelector("style[data-mui]")&&console.warn("Found existing MUI styles. Widget styles might conflict.")}function bne(n){return n.classList.add("com-widget-root"),Tne(),()=>{n.classList.remove("com-widget-root")}}function aU(n="root"){const e=document.getElementById(n);if(!e){console.error(`Container with id "${n}" not found`);return}if(e.hasAttribute("data-widget-initialized")){console.warn(`Widget already initialized in container "${n}"`);return}try{const t=bne(e),i=aA(e);return i.render(Qs.jsx(NU.StrictMode,{children:Qs.jsx(Sne,{})})),e.setAttribute("data-widget-initialized","true"),{destroy:()=>{i.unmount(),t(),e.removeAttribute("data-widget-initialized")}}}catch(t){return console.error("Failed to initialize widget:",t),null}}window.ComWidget={init:aU},document.getElementById("root")&&aU()})();
//# sourceMappingURL=widget.js.map

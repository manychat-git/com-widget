(function(){"use strict";function Dg(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var dT={exports:{}},Gd={},fT={exports:{}},ft={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fc=Symbol.for("react.element"),w2=Symbol.for("react.portal"),M2=Symbol.for("react.fragment"),E2=Symbol.for("react.strict_mode"),A2=Symbol.for("react.profiler"),C2=Symbol.for("react.provider"),R2=Symbol.for("react.context"),N2=Symbol.for("react.forward_ref"),P2=Symbol.for("react.suspense"),D2=Symbol.for("react.memo"),L2=Symbol.for("react.lazy"),pT=Symbol.iterator;function I2(n){return n===null||typeof n!="object"?null:(n=pT&&n[pT]||n["@@iterator"],typeof n=="function"?n:null)}var mT={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},gT=Object.assign,_T={};function cl(n,e,t){this.props=n,this.context=e,this.refs=_T,this.updater=t||mT}cl.prototype.isReactComponent={},cl.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")},cl.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function vT(){}vT.prototype=cl.prototype;function Lg(n,e,t){this.props=n,this.context=e,this.refs=_T,this.updater=t||mT}var Ig=Lg.prototype=new vT;Ig.constructor=Lg,gT(Ig,cl.prototype),Ig.isPureReactComponent=!0;var yT=Array.isArray,xT=Object.prototype.hasOwnProperty,Ug={current:null},ST={key:!0,ref:!0,__self:!0,__source:!0};function TT(n,e,t){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)xT.call(e,i)&&!ST.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=t;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];r.children=l}if(n&&n.defaultProps)for(i in a=n.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:fc,type:n,key:s,ref:o,props:r,_owner:Ug.current}}function U2(n,e){return{$$typeof:fc,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Fg(n){return typeof n=="object"&&n!==null&&n.$$typeof===fc}function F2(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var bT=/\/+/g;function Og(n,e){return typeof n=="object"&&n!==null&&n.key!=null?F2(""+n.key):e.toString(36)}function Vd(n,e,t,i,r){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case fc:case w2:o=!0}}if(o)return o=n,r=r(o),n=i===""?"."+Og(o,0):i,yT(r)?(t="",n!=null&&(t=n.replace(bT,"$&/")+"/"),Vd(r,e,t,"",function(u){return u})):r!=null&&(Fg(r)&&(r=U2(r,t+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(bT,"$&/")+"/")+n)),e.push(r)),1;if(o=0,i=i===""?".":i+":",yT(n))for(var a=0;a<n.length;a++){s=n[a];var l=i+Og(s,a);o+=Vd(s,e,t,l,r)}else if(l=I2(n),typeof l=="function")for(n=l.call(n),a=0;!(s=n.next()).done;)s=s.value,l=i+Og(s,a++),o+=Vd(s,e,t,l,r);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Hd(n,e,t){if(n==null)return n;var i=[],r=0;return Vd(n,i,"","",function(s){return e.call(t,s,r++)}),i}function O2(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var si={current:null},Wd={transition:null},B2={ReactCurrentDispatcher:si,ReactCurrentBatchConfig:Wd,ReactCurrentOwner:Ug};function wT(){throw Error("act(...) is not supported in production builds of React.")}ft.Children={map:Hd,forEach:function(n,e,t){Hd(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Hd(n,function(){e++}),e},toArray:function(n){return Hd(n,function(e){return e})||[]},only:function(n){if(!Fg(n))throw Error("React.Children.only expected to receive a single React element child.");return n}},ft.Component=cl,ft.Fragment=M2,ft.Profiler=A2,ft.PureComponent=Lg,ft.StrictMode=E2,ft.Suspense=P2,ft.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B2,ft.act=wT,ft.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var i=gT({},n.props),r=n.key,s=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Ug.current),e.key!==void 0&&(r=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)xT.call(e,l)&&!ST.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=t;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];i.children=a}return{$$typeof:fc,type:n.type,key:r,ref:s,props:i,_owner:o}},ft.createContext=function(n){return n={$$typeof:R2,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:C2,_context:n},n.Consumer=n},ft.createElement=TT,ft.createFactory=function(n){var e=TT.bind(null,n);return e.type=n,e},ft.createRef=function(){return{current:null}},ft.forwardRef=function(n){return{$$typeof:N2,render:n}},ft.isValidElement=Fg,ft.lazy=function(n){return{$$typeof:L2,_payload:{_status:-1,_result:n},_init:O2}},ft.memo=function(n,e){return{$$typeof:D2,type:n,compare:e===void 0?null:e}},ft.startTransition=function(n){var e=Wd.transition;Wd.transition={};try{n()}finally{Wd.transition=e}},ft.unstable_act=wT,ft.useCallback=function(n,e){return si.current.useCallback(n,e)},ft.useContext=function(n){return si.current.useContext(n)},ft.useDebugValue=function(){},ft.useDeferredValue=function(n){return si.current.useDeferredValue(n)},ft.useEffect=function(n,e){return si.current.useEffect(n,e)},ft.useId=function(){return si.current.useId()},ft.useImperativeHandle=function(n,e,t){return si.current.useImperativeHandle(n,e,t)},ft.useInsertionEffect=function(n,e){return si.current.useInsertionEffect(n,e)},ft.useLayoutEffect=function(n,e){return si.current.useLayoutEffect(n,e)},ft.useMemo=function(n,e){return si.current.useMemo(n,e)},ft.useReducer=function(n,e,t){return si.current.useReducer(n,e,t)},ft.useRef=function(n){return si.current.useRef(n)},ft.useState=function(n){return si.current.useState(n)},ft.useSyncExternalStore=function(n,e,t){return si.current.useSyncExternalStore(n,e,t)},ft.useTransition=function(){return si.current.useTransition()},ft.version="18.3.1",fT.exports=ft;var _s=fT.exports;const k2=Dg(_s);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z2=_s,G2=Symbol.for("react.element"),V2=Symbol.for("react.fragment"),H2=Object.prototype.hasOwnProperty,W2=z2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,$2={key:!0,ref:!0,__self:!0,__source:!0};function MT(n,e,t){var i,r={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)H2.call(e,i)&&!$2.hasOwnProperty(i)&&(r[i]=e[i]);if(n&&n.defaultProps)for(i in e=n.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:G2,type:n,key:s,ref:o,props:r,_owner:W2.current}}Gd.Fragment=V2,Gd.jsx=MT,Gd.jsxs=MT,dT.exports=Gd;var rn=dT.exports,ET={exports:{}},Gi={},AT={exports:{}},CT={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(k,Z){var W=k.length;k.push(Z);e:for(;0<W;){var K=W-1>>>1,he=k[K];if(0<r(he,Z))k[K]=Z,k[W]=he,W=K;else break e}}function t(k){return k.length===0?null:k[0]}function i(k){if(k.length===0)return null;var Z=k[0],W=k.pop();if(W!==Z){k[0]=W;e:for(var K=0,he=k.length,Ie=he>>>1;K<Ie;){var O=2*(K+1)-1,X=k[O],ae=O+1,re=k[ae];if(0>r(X,W))ae<he&&0>r(re,X)?(k[K]=re,k[ae]=W,K=ae):(k[K]=X,k[O]=W,K=O);else if(ae<he&&0>r(re,W))k[K]=re,k[ae]=W,K=ae;else break e}}return Z}function r(k,Z){var W=k.sortIndex-Z.sortIndex;return W!==0?W:k.id-Z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],c=1,h=null,d=3,f=!1,m=!1,_=!1,g=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(k){for(var Z=t(u);Z!==null;){if(Z.callback===null)i(u);else if(Z.startTime<=k)i(u),Z.sortIndex=Z.expirationTime,e(l,Z);else break;Z=t(u)}}function x(k){if(_=!1,y(k),!m)if(t(l)!==null)m=!0,z(T);else{var Z=t(u);Z!==null&&ie(x,Z.startTime-k)}}function T(k,Z){m=!1,_&&(_=!1,p(E),E=-1),f=!0;var W=d;try{for(y(Z),h=t(l);h!==null&&(!(h.expirationTime>Z)||k&&!R());){var K=h.callback;if(typeof K=="function"){h.callback=null,d=h.priorityLevel;var he=K(h.expirationTime<=Z);Z=n.unstable_now(),typeof he=="function"?h.callback=he:h===t(l)&&i(l),y(Z)}else i(l);h=t(l)}if(h!==null)var Ie=!0;else{var O=t(u);O!==null&&ie(x,O.startTime-Z),Ie=!1}return Ie}finally{h=null,d=W,f=!1}}var S=!1,w=null,E=-1,M=5,b=-1;function R(){return!(n.unstable_now()-b<M)}function I(){if(w!==null){var k=n.unstable_now();b=k;var Z=!0;try{Z=w(!0,k)}finally{Z?B():(S=!1,w=null)}}else S=!1}var B;if(typeof v=="function")B=function(){v(I)};else if(typeof MessageChannel<"u"){var D=new MessageChannel,L=D.port2;D.port1.onmessage=I,B=function(){L.postMessage(null)}}else B=function(){g(I,0)};function z(k){w=k,S||(S=!0,B())}function ie(k,Z){E=g(function(){k(n.unstable_now())},Z)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(k){k.callback=null},n.unstable_continueExecution=function(){m||f||(m=!0,z(T))},n.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<k?Math.floor(1e3/k):5},n.unstable_getCurrentPriorityLevel=function(){return d},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(k){switch(d){case 1:case 2:case 3:var Z=3;break;default:Z=d}var W=d;d=Z;try{return k()}finally{d=W}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(k,Z){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var W=d;d=k;try{return Z()}finally{d=W}},n.unstable_scheduleCallback=function(k,Z,W){var K=n.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?K+W:K):W=K,k){case 1:var he=-1;break;case 2:he=250;break;case 5:he=1073741823;break;case 4:he=1e4;break;default:he=5e3}return he=W+he,k={id:c++,callback:Z,priorityLevel:k,startTime:W,expirationTime:he,sortIndex:-1},W>K?(k.sortIndex=W,e(u,k),t(l)===null&&k===t(u)&&(_?(p(E),E=-1):_=!0,ie(x,W-K))):(k.sortIndex=he,e(l,k),m||f||(m=!0,z(T))),k},n.unstable_shouldYield=R,n.unstable_wrapCallback=function(k){var Z=d;return function(){var W=d;d=Z;try{return k.apply(this,arguments)}finally{d=W}}}})(CT),AT.exports=CT;var j2=AT.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X2=_s,Vi=j2;function fe(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var RT=new Set,pc={};function la(n,e){hl(n,e),hl(n+"Capture",e)}function hl(n,e){for(pc[n]=e,n=0;n<e.length;n++)RT.add(e[n])}var vs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Bg=Object.prototype.hasOwnProperty,q2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,NT={},PT={};function Y2(n){return Bg.call(PT,n)?!0:Bg.call(NT,n)?!1:q2.test(n)?PT[n]=!0:(NT[n]=!0,!1)}function K2(n,e,t,i){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Q2(n,e,t,i){if(e===null||typeof e>"u"||K2(n,e,t,i))return!0;if(i)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function oi(n,e,t,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Bn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Bn[n]=new oi(n,0,!1,n,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Bn[e]=new oi(e,1,!1,n[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(n){Bn[n]=new oi(n,2,!1,n.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Bn[n]=new oi(n,2,!1,n,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Bn[n]=new oi(n,3,!1,n.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(n){Bn[n]=new oi(n,3,!0,n,null,!1,!1)}),["capture","download"].forEach(function(n){Bn[n]=new oi(n,4,!1,n,null,!1,!1)}),["cols","rows","size","span"].forEach(function(n){Bn[n]=new oi(n,6,!1,n,null,!1,!1)}),["rowSpan","start"].forEach(function(n){Bn[n]=new oi(n,5,!1,n.toLowerCase(),null,!1,!1)});var kg=/[\-:]([a-z])/g;function zg(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(kg,zg);Bn[e]=new oi(e,1,!1,n,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(kg,zg);Bn[e]=new oi(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(kg,zg);Bn[e]=new oi(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(n){Bn[n]=new oi(n,1,!1,n.toLowerCase(),null,!1,!1)}),Bn.xlinkHref=new oi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(n){Bn[n]=new oi(n,1,!1,n.toLowerCase(),null,!0,!0)});function Gg(n,e,t,i){var r=Bn.hasOwnProperty(e)?Bn[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Q2(e,t,r,i)&&(t=null),i||r===null?Y2(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):r.mustUseProperty?n[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,i=r.attributeNamespace,t===null?n.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,i?n.setAttributeNS(i,e,t):n.setAttribute(e,t))))}var ys=X2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,$d=Symbol.for("react.element"),dl=Symbol.for("react.portal"),fl=Symbol.for("react.fragment"),Vg=Symbol.for("react.strict_mode"),Hg=Symbol.for("react.profiler"),DT=Symbol.for("react.provider"),LT=Symbol.for("react.context"),Wg=Symbol.for("react.forward_ref"),$g=Symbol.for("react.suspense"),jg=Symbol.for("react.suspense_list"),Xg=Symbol.for("react.memo"),lo=Symbol.for("react.lazy"),IT=Symbol.for("react.offscreen"),UT=Symbol.iterator;function mc(n){return n===null||typeof n!="object"?null:(n=UT&&n[UT]||n["@@iterator"],typeof n=="function"?n:null)}var Qt=Object.assign,qg;function gc(n){if(qg===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);qg=e&&e[1]||""}return`
`+qg+n}var Yg=!1;function Kg(n,e){if(!n||Yg)return"";Yg=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var i=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){i=u}n.call(e.prototype)}else{try{throw Error()}catch(u){i=u}n()}}catch(u){if(u&&i&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var l=`
`+r[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{Yg=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?gc(n):""}function Z2(n){switch(n.tag){case 5:return gc(n.type);case 16:return gc("Lazy");case 13:return gc("Suspense");case 19:return gc("SuspenseList");case 0:case 2:case 15:return n=Kg(n.type,!1),n;case 11:return n=Kg(n.type.render,!1),n;case 1:return n=Kg(n.type,!0),n;default:return""}}function Qg(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case fl:return"Fragment";case dl:return"Portal";case Hg:return"Profiler";case Vg:return"StrictMode";case $g:return"Suspense";case jg:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case LT:return(n.displayName||"Context")+".Consumer";case DT:return(n._context.displayName||"Context")+".Provider";case Wg:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Xg:return e=n.displayName||null,e!==null?e:Qg(n.type)||"Memo";case lo:e=n._payload,n=n._init;try{return Qg(n(e))}catch{}}return null}function J2(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qg(e);case 8:return e===Vg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function uo(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function FT(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function eD(n){var e=FT(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),i=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function jd(n){n._valueTracker||(n._valueTracker=eD(n))}function OT(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return n&&(i=FT(n)?n.checked?"true":"false":n.value),n=i,n!==t?(e.setValue(n),!0):!1}function Xd(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Zg(n,e){var t=e.checked;return Qt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function BT(n,e){var t=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;t=uo(e.value!=null?e.value:t),n._wrapperState={initialChecked:i,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function kT(n,e){e=e.checked,e!=null&&Gg(n,"checked",e,!1)}function Jg(n,e){kT(n,e);var t=uo(e.value),i=e.type;if(t!=null)i==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(i==="submit"||i==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?e_(n,e.type,t):e.hasOwnProperty("defaultValue")&&e_(n,e.type,uo(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function zT(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function e_(n,e,t){(e!=="number"||Xd(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var _c=Array.isArray;function pl(n,e,t,i){if(n=n.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<n.length;t++)r=e.hasOwnProperty("$"+n[t].value),n[t].selected!==r&&(n[t].selected=r),r&&i&&(n[t].defaultSelected=!0)}else{for(t=""+uo(t),e=null,r=0;r<n.length;r++){if(n[r].value===t){n[r].selected=!0,i&&(n[r].defaultSelected=!0);return}e!==null||n[r].disabled||(e=n[r])}e!==null&&(e.selected=!0)}}function t_(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(fe(91));return Qt({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function GT(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(fe(92));if(_c(t)){if(1<t.length)throw Error(fe(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:uo(t)}}function VT(n,e){var t=uo(e.value),i=uo(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),i!=null&&(n.defaultValue=""+i)}function HT(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function WT(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function n_(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?WT(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var qd,$T=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,i,r){MSApp.execUnsafeLocalFunction(function(){return n(e,t,i,r)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(qd=qd||document.createElement("div"),qd.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=qd.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function vc(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var yc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},tD=["Webkit","ms","Moz","O"];Object.keys(yc).forEach(function(n){tD.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),yc[e]=yc[n]})});function jT(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||yc.hasOwnProperty(n)&&yc[n]?(""+e).trim():e+"px"}function XT(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var i=t.indexOf("--")===0,r=jT(t,e[t],i);t==="float"&&(t="cssFloat"),i?n.setProperty(t,r):n[t]=r}}var nD=Qt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function i_(n,e){if(e){if(nD[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(fe(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(fe(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(fe(61))}if(e.style!=null&&typeof e.style!="object")throw Error(fe(62))}}function r_(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var s_=null;function o_(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var a_=null,ml=null,gl=null;function qT(n){if(n=Gc(n)){if(typeof a_!="function")throw Error(fe(280));var e=n.stateNode;e&&(e=vf(e),a_(n.stateNode,n.type,e))}}function YT(n){ml?gl?gl.push(n):gl=[n]:ml=n}function KT(){if(ml){var n=ml,e=gl;if(gl=ml=null,qT(n),e)for(n=0;n<e.length;n++)qT(e[n])}}function QT(n,e){return n(e)}function ZT(){}var l_=!1;function JT(n,e,t){if(l_)return n(e,t);l_=!0;try{return QT(n,e,t)}finally{l_=!1,(ml!==null||gl!==null)&&(ZT(),KT())}}function xc(n,e){var t=n.stateNode;if(t===null)return null;var i=vf(t);if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(n=n.type,i=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!i;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(fe(231,e,typeof t));return t}var u_=!1;if(vs)try{var Sc={};Object.defineProperty(Sc,"passive",{get:function(){u_=!0}}),window.addEventListener("test",Sc,Sc),window.removeEventListener("test",Sc,Sc)}catch{u_=!1}function iD(n,e,t,i,r,s,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(c){this.onError(c)}}var Tc=!1,Yd=null,Kd=!1,c_=null,rD={onError:function(n){Tc=!0,Yd=n}};function sD(n,e,t,i,r,s,o,a,l){Tc=!1,Yd=null,iD.apply(rD,arguments)}function oD(n,e,t,i,r,s,o,a,l){if(sD.apply(this,arguments),Tc){if(Tc){var u=Yd;Tc=!1,Yd=null}else throw Error(fe(198));Kd||(Kd=!0,c_=u)}}function ua(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function eb(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function tb(n){if(ua(n)!==n)throw Error(fe(188))}function aD(n){var e=n.alternate;if(!e){if(e=ua(n),e===null)throw Error(fe(188));return e!==n?null:n}for(var t=n,i=e;;){var r=t.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){t=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===t)return tb(r),n;if(s===i)return tb(r),e;s=s.sibling}throw Error(fe(188))}if(t.return!==i.return)t=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===t){o=!0,t=r,i=s;break}if(a===i){o=!0,i=r,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,i=r;break}if(a===i){o=!0,i=s,t=r;break}a=a.sibling}if(!o)throw Error(fe(189))}}if(t.alternate!==i)throw Error(fe(190))}if(t.tag!==3)throw Error(fe(188));return t.stateNode.current===t?n:e}function nb(n){return n=aD(n),n!==null?ib(n):null}function ib(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=ib(n);if(e!==null)return e;n=n.sibling}return null}var rb=Vi.unstable_scheduleCallback,sb=Vi.unstable_cancelCallback,lD=Vi.unstable_shouldYield,uD=Vi.unstable_requestPaint,un=Vi.unstable_now,cD=Vi.unstable_getCurrentPriorityLevel,h_=Vi.unstable_ImmediatePriority,ob=Vi.unstable_UserBlockingPriority,Qd=Vi.unstable_NormalPriority,hD=Vi.unstable_LowPriority,ab=Vi.unstable_IdlePriority,Zd=null,qr=null;function dD(n){if(qr&&typeof qr.onCommitFiberRoot=="function")try{qr.onCommitFiberRoot(Zd,n,void 0,(n.current.flags&128)===128)}catch{}}var br=Math.clz32?Math.clz32:mD,fD=Math.log,pD=Math.LN2;function mD(n){return n>>>=0,n===0?32:31-(fD(n)/pD|0)|0}var Jd=64,ef=4194304;function bc(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function tf(n,e){var t=n.pendingLanes;if(t===0)return 0;var i=0,r=n.suspendedLanes,s=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~r;a!==0?i=bc(a):(s&=o,s!==0&&(i=bc(s)))}else o=t&~r,o!==0?i=bc(o):s!==0&&(i=bc(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=i;0<e;)t=31-br(e),r=1<<t,i|=n[t],e&=~r;return i}function gD(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function _D(n,e){for(var t=n.suspendedLanes,i=n.pingedLanes,r=n.expirationTimes,s=n.pendingLanes;0<s;){var o=31-br(s),a=1<<o,l=r[o];l===-1?(!(a&t)||a&i)&&(r[o]=gD(a,e)):l<=e&&(n.expiredLanes|=a),s&=~a}}function d_(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function lb(){var n=Jd;return Jd<<=1,!(Jd&4194240)&&(Jd=64),n}function f_(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function wc(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-br(e),n[e]=t}function vD(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var i=n.eventTimes;for(n=n.expirationTimes;0<t;){var r=31-br(t),s=1<<r;e[r]=0,i[r]=-1,n[r]=-1,t&=~s}}function p_(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var i=31-br(t),r=1<<i;r&e|n[i]&e&&(n[i]|=e),t&=~r}}var Pt=0;function ub(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var cb,m_,hb,db,fb,g_=!1,nf=[],co=null,ho=null,fo=null,Mc=new Map,Ec=new Map,po=[],yD="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function pb(n,e){switch(n){case"focusin":case"focusout":co=null;break;case"dragenter":case"dragleave":ho=null;break;case"mouseover":case"mouseout":fo=null;break;case"pointerover":case"pointerout":Mc.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ec.delete(e.pointerId)}}function Ac(n,e,t,i,r,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=Gc(e),e!==null&&m_(e)),n):(n.eventSystemFlags|=i,e=n.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),n)}function xD(n,e,t,i,r){switch(e){case"focusin":return co=Ac(co,n,e,t,i,r),!0;case"dragenter":return ho=Ac(ho,n,e,t,i,r),!0;case"mouseover":return fo=Ac(fo,n,e,t,i,r),!0;case"pointerover":var s=r.pointerId;return Mc.set(s,Ac(Mc.get(s)||null,n,e,t,i,r)),!0;case"gotpointercapture":return s=r.pointerId,Ec.set(s,Ac(Ec.get(s)||null,n,e,t,i,r)),!0}return!1}function mb(n){var e=ca(n.target);if(e!==null){var t=ua(e);if(t!==null){if(e=t.tag,e===13){if(e=eb(t),e!==null){n.blockedOn=e,fb(n.priority,function(){hb(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function rf(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=v_(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var i=new t.constructor(t.type,t);s_=i,t.target.dispatchEvent(i),s_=null}else return e=Gc(t),e!==null&&m_(e),n.blockedOn=t,!1;e.shift()}return!0}function gb(n,e,t){rf(n)&&t.delete(e)}function SD(){g_=!1,co!==null&&rf(co)&&(co=null),ho!==null&&rf(ho)&&(ho=null),fo!==null&&rf(fo)&&(fo=null),Mc.forEach(gb),Ec.forEach(gb)}function Cc(n,e){n.blockedOn===e&&(n.blockedOn=null,g_||(g_=!0,Vi.unstable_scheduleCallback(Vi.unstable_NormalPriority,SD)))}function Rc(n){function e(r){return Cc(r,n)}if(0<nf.length){Cc(nf[0],n);for(var t=1;t<nf.length;t++){var i=nf[t];i.blockedOn===n&&(i.blockedOn=null)}}for(co!==null&&Cc(co,n),ho!==null&&Cc(ho,n),fo!==null&&Cc(fo,n),Mc.forEach(e),Ec.forEach(e),t=0;t<po.length;t++)i=po[t],i.blockedOn===n&&(i.blockedOn=null);for(;0<po.length&&(t=po[0],t.blockedOn===null);)mb(t),t.blockedOn===null&&po.shift()}var _l=ys.ReactCurrentBatchConfig,sf=!0;function TD(n,e,t,i){var r=Pt,s=_l.transition;_l.transition=null;try{Pt=1,__(n,e,t,i)}finally{Pt=r,_l.transition=s}}function bD(n,e,t,i){var r=Pt,s=_l.transition;_l.transition=null;try{Pt=4,__(n,e,t,i)}finally{Pt=r,_l.transition=s}}function __(n,e,t,i){if(sf){var r=v_(n,e,t,i);if(r===null)U_(n,e,i,of,t),pb(n,i);else if(xD(r,n,e,t,i))i.stopPropagation();else if(pb(n,i),e&4&&-1<yD.indexOf(n)){for(;r!==null;){var s=Gc(r);if(s!==null&&cb(s),s=v_(n,e,t,i),s===null&&U_(n,e,i,of,t),s===r)break;r=s}r!==null&&i.stopPropagation()}else U_(n,e,i,null,t)}}var of=null;function v_(n,e,t,i){if(of=null,n=o_(i),n=ca(n),n!==null)if(e=ua(n),e===null)n=null;else if(t=e.tag,t===13){if(n=eb(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return of=n,null}function _b(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(cD()){case h_:return 1;case ob:return 4;case Qd:case hD:return 16;case ab:return 536870912;default:return 16}default:return 16}}var mo=null,y_=null,af=null;function vb(){if(af)return af;var n,e=y_,t=e.length,i,r="value"in mo?mo.value:mo.textContent,s=r.length;for(n=0;n<t&&e[n]===r[n];n++);var o=t-n;for(i=1;i<=o&&e[t-i]===r[s-i];i++);return af=r.slice(n,1<i?1-i:void 0)}function lf(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function uf(){return!0}function yb(){return!1}function Hi(n){function e(t,i,r,s,o){this._reactName=t,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?uf:yb,this.isPropagationStopped=yb,this}return Qt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=uf)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=uf)},persist:function(){},isPersistent:uf}),e}var vl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},x_=Hi(vl),Nc=Qt({},vl,{view:0,detail:0}),wD=Hi(Nc),S_,T_,Pc,cf=Qt({},Nc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:w_,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Pc&&(Pc&&n.type==="mousemove"?(S_=n.screenX-Pc.screenX,T_=n.screenY-Pc.screenY):T_=S_=0,Pc=n),S_)},movementY:function(n){return"movementY"in n?n.movementY:T_}}),xb=Hi(cf),MD=Qt({},cf,{dataTransfer:0}),ED=Hi(MD),AD=Qt({},Nc,{relatedTarget:0}),b_=Hi(AD),CD=Qt({},vl,{animationName:0,elapsedTime:0,pseudoElement:0}),RD=Hi(CD),ND=Qt({},vl,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),PD=Hi(ND),DD=Qt({},vl,{data:0}),Sb=Hi(DD),LD={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ID={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},UD={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function FD(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=UD[n])?!!e[n]:!1}function w_(){return FD}var OD=Qt({},Nc,{key:function(n){if(n.key){var e=LD[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=lf(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?ID[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:w_,charCode:function(n){return n.type==="keypress"?lf(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?lf(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),BD=Hi(OD),kD=Qt({},cf,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Tb=Hi(kD),zD=Qt({},Nc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:w_}),GD=Hi(zD),VD=Qt({},vl,{propertyName:0,elapsedTime:0,pseudoElement:0}),HD=Hi(VD),WD=Qt({},cf,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),$D=Hi(WD),jD=[9,13,27,32],M_=vs&&"CompositionEvent"in window,Dc=null;vs&&"documentMode"in document&&(Dc=document.documentMode);var XD=vs&&"TextEvent"in window&&!Dc,bb=vs&&(!M_||Dc&&8<Dc&&11>=Dc),wb=" ",Mb=!1;function Eb(n,e){switch(n){case"keyup":return jD.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ab(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var yl=!1;function qD(n,e){switch(n){case"compositionend":return Ab(e);case"keypress":return e.which!==32?null:(Mb=!0,wb);case"textInput":return n=e.data,n===wb&&Mb?null:n;default:return null}}function YD(n,e){if(yl)return n==="compositionend"||!M_&&Eb(n,e)?(n=vb(),af=y_=mo=null,yl=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return bb&&e.locale!=="ko"?null:e.data;default:return null}}var KD={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Cb(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!KD[n.type]:e==="textarea"}function Rb(n,e,t,i){YT(i),e=mf(e,"onChange"),0<e.length&&(t=new x_("onChange","change",null,t,i),n.push({event:t,listeners:e}))}var Lc=null,Ic=null;function QD(n){Xb(n,0)}function hf(n){var e=wl(n);if(OT(e))return n}function ZD(n,e){if(n==="change")return e}var Nb=!1;if(vs){var E_;if(vs){var A_="oninput"in document;if(!A_){var Pb=document.createElement("div");Pb.setAttribute("oninput","return;"),A_=typeof Pb.oninput=="function"}E_=A_}else E_=!1;Nb=E_&&(!document.documentMode||9<document.documentMode)}function Db(){Lc&&(Lc.detachEvent("onpropertychange",Lb),Ic=Lc=null)}function Lb(n){if(n.propertyName==="value"&&hf(Ic)){var e=[];Rb(e,Ic,n,o_(n)),JT(QD,e)}}function JD(n,e,t){n==="focusin"?(Db(),Lc=e,Ic=t,Lc.attachEvent("onpropertychange",Lb)):n==="focusout"&&Db()}function eL(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return hf(Ic)}function tL(n,e){if(n==="click")return hf(e)}function nL(n,e){if(n==="input"||n==="change")return hf(e)}function iL(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var wr=typeof Object.is=="function"?Object.is:iL;function Uc(n,e){if(wr(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var r=t[i];if(!Bg.call(e,r)||!wr(n[r],e[r]))return!1}return!0}function Ib(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Ub(n,e){var t=Ib(n);n=0;for(var i;t;){if(t.nodeType===3){if(i=n+t.textContent.length,n<=e&&i>=e)return{node:t,offset:e-n};n=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Ib(t)}}function Fb(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?Fb(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function Ob(){for(var n=window,e=Xd();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=Xd(n.document)}return e}function C_(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function rL(n){var e=Ob(),t=n.focusedElem,i=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&Fb(t.ownerDocument.documentElement,t)){if(i!==null&&C_(t)){if(e=i.start,n=i.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var r=t.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!n.extend&&s>i&&(r=i,i=s,s=r),r=Ub(t,s);var o=Ub(t,i);r&&o&&(n.rangeCount!==1||n.anchorNode!==r.node||n.anchorOffset!==r.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),n.removeAllRanges(),s>i?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var sL=vs&&"documentMode"in document&&11>=document.documentMode,xl=null,R_=null,Fc=null,N_=!1;function Bb(n,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;N_||xl==null||xl!==Xd(i)||(i=xl,"selectionStart"in i&&C_(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Fc&&Uc(Fc,i)||(Fc=i,i=mf(R_,"onSelect"),0<i.length&&(e=new x_("onSelect","select",null,e,t),n.push({event:e,listeners:i}),e.target=xl)))}function df(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Sl={animationend:df("Animation","AnimationEnd"),animationiteration:df("Animation","AnimationIteration"),animationstart:df("Animation","AnimationStart"),transitionend:df("Transition","TransitionEnd")},P_={},kb={};vs&&(kb=document.createElement("div").style,"AnimationEvent"in window||(delete Sl.animationend.animation,delete Sl.animationiteration.animation,delete Sl.animationstart.animation),"TransitionEvent"in window||delete Sl.transitionend.transition);function ff(n){if(P_[n])return P_[n];if(!Sl[n])return n;var e=Sl[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in kb)return P_[n]=e[t];return n}var zb=ff("animationend"),Gb=ff("animationiteration"),Vb=ff("animationstart"),Hb=ff("transitionend"),Wb=new Map,$b="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function go(n,e){Wb.set(n,e),la(e,[n])}for(var D_=0;D_<$b.length;D_++){var L_=$b[D_],oL=L_.toLowerCase(),aL=L_[0].toUpperCase()+L_.slice(1);go(oL,"on"+aL)}go(zb,"onAnimationEnd"),go(Gb,"onAnimationIteration"),go(Vb,"onAnimationStart"),go("dblclick","onDoubleClick"),go("focusin","onFocus"),go("focusout","onBlur"),go(Hb,"onTransitionEnd"),hl("onMouseEnter",["mouseout","mouseover"]),hl("onMouseLeave",["mouseout","mouseover"]),hl("onPointerEnter",["pointerout","pointerover"]),hl("onPointerLeave",["pointerout","pointerover"]),la("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),la("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),la("onBeforeInput",["compositionend","keypress","textInput","paste"]),la("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),la("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),la("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Oc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),lL=new Set("cancel close invalid load scroll toggle".split(" ").concat(Oc));function jb(n,e,t){var i=n.type||"unknown-event";n.currentTarget=t,oD(i,e,void 0,n),n.currentTarget=null}function Xb(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var i=n[t],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;jb(r,a,u),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;jb(r,a,u),s=l}}}if(Kd)throw n=c_,Kd=!1,c_=null,n}function Bt(n,e){var t=e[G_];t===void 0&&(t=e[G_]=new Set);var i=n+"__bubble";t.has(i)||(qb(e,n,2,!1),t.add(i))}function I_(n,e,t){var i=0;e&&(i|=4),qb(t,n,i,e)}var pf="_reactListening"+Math.random().toString(36).slice(2);function Bc(n){if(!n[pf]){n[pf]=!0,RT.forEach(function(t){t!=="selectionchange"&&(lL.has(t)||I_(t,!1,n),I_(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[pf]||(e[pf]=!0,I_("selectionchange",!1,e))}}function qb(n,e,t,i){switch(_b(e)){case 1:var r=TD;break;case 4:r=bD;break;default:r=__}t=r.bind(null,e,t,n),r=void 0,!u_||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?n.addEventListener(e,t,{capture:!0,passive:r}):n.addEventListener(e,t,!0):r!==void 0?n.addEventListener(e,t,{passive:r}):n.addEventListener(e,t,!1)}function U_(n,e,t,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=ca(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}JT(function(){var u=s,c=o_(t),h=[];e:{var d=Wb.get(n);if(d!==void 0){var f=x_,m=n;switch(n){case"keypress":if(lf(t)===0)break e;case"keydown":case"keyup":f=BD;break;case"focusin":m="focus",f=b_;break;case"focusout":m="blur",f=b_;break;case"beforeblur":case"afterblur":f=b_;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=xb;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=ED;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=GD;break;case zb:case Gb:case Vb:f=RD;break;case Hb:f=HD;break;case"scroll":f=wD;break;case"wheel":f=$D;break;case"copy":case"cut":case"paste":f=PD;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=Tb}var _=(e&4)!==0,g=!_&&n==="scroll",p=_?d!==null?d+"Capture":null:d;_=[];for(var v=u,y;v!==null;){y=v;var x=y.stateNode;if(y.tag===5&&x!==null&&(y=x,p!==null&&(x=xc(v,p),x!=null&&_.push(kc(v,x,y)))),g)break;v=v.return}0<_.length&&(d=new f(d,m,null,t,c),h.push({event:d,listeners:_}))}}if(!(e&7)){e:{if(d=n==="mouseover"||n==="pointerover",f=n==="mouseout"||n==="pointerout",d&&t!==s_&&(m=t.relatedTarget||t.fromElement)&&(ca(m)||m[xs]))break e;if((f||d)&&(d=c.window===c?c:(d=c.ownerDocument)?d.defaultView||d.parentWindow:window,f?(m=t.relatedTarget||t.toElement,f=u,m=m?ca(m):null,m!==null&&(g=ua(m),m!==g||m.tag!==5&&m.tag!==6)&&(m=null)):(f=null,m=u),f!==m)){if(_=xb,x="onMouseLeave",p="onMouseEnter",v="mouse",(n==="pointerout"||n==="pointerover")&&(_=Tb,x="onPointerLeave",p="onPointerEnter",v="pointer"),g=f==null?d:wl(f),y=m==null?d:wl(m),d=new _(x,v+"leave",f,t,c),d.target=g,d.relatedTarget=y,x=null,ca(c)===u&&(_=new _(p,v+"enter",m,t,c),_.target=y,_.relatedTarget=g,x=_),g=x,f&&m)t:{for(_=f,p=m,v=0,y=_;y;y=Tl(y))v++;for(y=0,x=p;x;x=Tl(x))y++;for(;0<v-y;)_=Tl(_),v--;for(;0<y-v;)p=Tl(p),y--;for(;v--;){if(_===p||p!==null&&_===p.alternate)break t;_=Tl(_),p=Tl(p)}_=null}else _=null;f!==null&&Yb(h,d,f,_,!1),m!==null&&g!==null&&Yb(h,g,m,_,!0)}}e:{if(d=u?wl(u):window,f=d.nodeName&&d.nodeName.toLowerCase(),f==="select"||f==="input"&&d.type==="file")var T=ZD;else if(Cb(d))if(Nb)T=nL;else{T=eL;var S=JD}else(f=d.nodeName)&&f.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(T=tL);if(T&&(T=T(n,u))){Rb(h,T,t,c);break e}S&&S(n,d,u),n==="focusout"&&(S=d._wrapperState)&&S.controlled&&d.type==="number"&&e_(d,"number",d.value)}switch(S=u?wl(u):window,n){case"focusin":(Cb(S)||S.contentEditable==="true")&&(xl=S,R_=u,Fc=null);break;case"focusout":Fc=R_=xl=null;break;case"mousedown":N_=!0;break;case"contextmenu":case"mouseup":case"dragend":N_=!1,Bb(h,t,c);break;case"selectionchange":if(sL)break;case"keydown":case"keyup":Bb(h,t,c)}var w;if(M_)e:{switch(n){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else yl?Eb(n,t)&&(E="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(E="onCompositionStart");E&&(bb&&t.locale!=="ko"&&(yl||E!=="onCompositionStart"?E==="onCompositionEnd"&&yl&&(w=vb()):(mo=c,y_="value"in mo?mo.value:mo.textContent,yl=!0)),S=mf(u,E),0<S.length&&(E=new Sb(E,n,null,t,c),h.push({event:E,listeners:S}),w?E.data=w:(w=Ab(t),w!==null&&(E.data=w)))),(w=XD?qD(n,t):YD(n,t))&&(u=mf(u,"onBeforeInput"),0<u.length&&(c=new Sb("onBeforeInput","beforeinput",null,t,c),h.push({event:c,listeners:u}),c.data=w))}Xb(h,e)})}function kc(n,e,t){return{instance:n,listener:e,currentTarget:t}}function mf(n,e){for(var t=e+"Capture",i=[];n!==null;){var r=n,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=xc(n,t),s!=null&&i.unshift(kc(n,s,r)),s=xc(n,e),s!=null&&i.push(kc(n,s,r))),n=n.return}return i}function Tl(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Yb(n,e,t,i,r){for(var s=e._reactName,o=[];t!==null&&t!==i;){var a=t,l=a.alternate,u=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&u!==null&&(a=u,r?(l=xc(t,s),l!=null&&o.unshift(kc(t,l,a))):r||(l=xc(t,s),l!=null&&o.push(kc(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var uL=/\r\n?/g,cL=/\u0000|\uFFFD/g;function Kb(n){return(typeof n=="string"?n:""+n).replace(uL,`
`).replace(cL,"")}function gf(n,e,t){if(e=Kb(e),Kb(n)!==e&&t)throw Error(fe(425))}function _f(){}var F_=null,O_=null;function B_(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var k_=typeof setTimeout=="function"?setTimeout:void 0,hL=typeof clearTimeout=="function"?clearTimeout:void 0,Qb=typeof Promise=="function"?Promise:void 0,dL=typeof queueMicrotask=="function"?queueMicrotask:typeof Qb<"u"?function(n){return Qb.resolve(null).then(n).catch(fL)}:k_;function fL(n){setTimeout(function(){throw n})}function z_(n,e){var t=e,i=0;do{var r=t.nextSibling;if(n.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(i===0){n.removeChild(r),Rc(e);return}i--}else t!=="$"&&t!=="$?"&&t!=="$!"||i++;t=r}while(t);Rc(e)}function _o(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function Zb(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var bl=Math.random().toString(36).slice(2),Yr="__reactFiber$"+bl,zc="__reactProps$"+bl,xs="__reactContainer$"+bl,G_="__reactEvents$"+bl,pL="__reactListeners$"+bl,mL="__reactHandles$"+bl;function ca(n){var e=n[Yr];if(e)return e;for(var t=n.parentNode;t;){if(e=t[xs]||t[Yr]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=Zb(n);n!==null;){if(t=n[Yr])return t;n=Zb(n)}return e}n=t,t=n.parentNode}return null}function Gc(n){return n=n[Yr]||n[xs],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function wl(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(fe(33))}function vf(n){return n[zc]||null}var V_=[],Ml=-1;function vo(n){return{current:n}}function kt(n){0>Ml||(n.current=V_[Ml],V_[Ml]=null,Ml--)}function Ft(n,e){Ml++,V_[Ml]=n.current,n.current=e}var yo={},jn=vo(yo),Si=vo(!1),ha=yo;function El(n,e){var t=n.type.contextTypes;if(!t)return yo;var i=n.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in t)r[s]=e[s];return i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=r),r}function Ti(n){return n=n.childContextTypes,n!=null}function yf(){kt(Si),kt(jn)}function Jb(n,e,t){if(jn.current!==yo)throw Error(fe(168));Ft(jn,e),Ft(Si,t)}function ew(n,e,t){var i=n.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return t;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(fe(108,J2(n)||"Unknown",r));return Qt({},t,i)}function xf(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||yo,ha=jn.current,Ft(jn,n),Ft(Si,Si.current),!0}function tw(n,e,t){var i=n.stateNode;if(!i)throw Error(fe(169));t?(n=ew(n,e,ha),i.__reactInternalMemoizedMergedChildContext=n,kt(Si),kt(jn),Ft(jn,n)):kt(Si),Ft(Si,t)}var Ss=null,Sf=!1,H_=!1;function nw(n){Ss===null?Ss=[n]:Ss.push(n)}function gL(n){Sf=!0,nw(n)}function xo(){if(!H_&&Ss!==null){H_=!0;var n=0,e=Pt;try{var t=Ss;for(Pt=1;n<t.length;n++){var i=t[n];do i=i(!0);while(i!==null)}Ss=null,Sf=!1}catch(r){throw Ss!==null&&(Ss=Ss.slice(n+1)),rb(h_,xo),r}finally{Pt=e,H_=!1}}return null}var Al=[],Cl=0,Tf=null,bf=0,or=[],ar=0,da=null,Ts=1,bs="";function fa(n,e){Al[Cl++]=bf,Al[Cl++]=Tf,Tf=n,bf=e}function iw(n,e,t){or[ar++]=Ts,or[ar++]=bs,or[ar++]=da,da=n;var i=Ts;n=bs;var r=32-br(i)-1;i&=~(1<<r),t+=1;var s=32-br(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Ts=1<<32-br(e)+r|t<<r|i,bs=s+n}else Ts=1<<s|t<<r|i,bs=n}function W_(n){n.return!==null&&(fa(n,1),iw(n,1,0))}function $_(n){for(;n===Tf;)Tf=Al[--Cl],Al[Cl]=null,bf=Al[--Cl],Al[Cl]=null;for(;n===da;)da=or[--ar],or[ar]=null,bs=or[--ar],or[ar]=null,Ts=or[--ar],or[ar]=null}var Wi=null,$i=null,Wt=!1,Mr=null;function rw(n,e){var t=hr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function sw(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Wi=n,$i=_o(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Wi=n,$i=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=da!==null?{id:Ts,overflow:bs}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=hr(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Wi=n,$i=null,!0):!1;default:return!1}}function j_(n){return(n.mode&1)!==0&&(n.flags&128)===0}function X_(n){if(Wt){var e=$i;if(e){var t=e;if(!sw(n,e)){if(j_(n))throw Error(fe(418));e=_o(t.nextSibling);var i=Wi;e&&sw(n,e)?rw(i,t):(n.flags=n.flags&-4097|2,Wt=!1,Wi=n)}}else{if(j_(n))throw Error(fe(418));n.flags=n.flags&-4097|2,Wt=!1,Wi=n}}}function ow(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Wi=n}function wf(n){if(n!==Wi)return!1;if(!Wt)return ow(n),Wt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!B_(n.type,n.memoizedProps)),e&&(e=$i)){if(j_(n))throw aw(),Error(fe(418));for(;e;)rw(n,e),e=_o(e.nextSibling)}if(ow(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(fe(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){$i=_o(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}$i=null}}else $i=Wi?_o(n.stateNode.nextSibling):null;return!0}function aw(){for(var n=$i;n;)n=_o(n.nextSibling)}function Rl(){$i=Wi=null,Wt=!1}function q_(n){Mr===null?Mr=[n]:Mr.push(n)}var _L=ys.ReactCurrentBatchConfig;function Vc(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(fe(309));var i=t.stateNode}if(!i)throw Error(fe(147,n));var r=i,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof n!="string")throw Error(fe(284));if(!t._owner)throw Error(fe(290,n))}return n}function Mf(n,e){throw n=Object.prototype.toString.call(e),Error(fe(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function lw(n){var e=n._init;return e(n._payload)}function uw(n){function e(p,v){if(n){var y=p.deletions;y===null?(p.deletions=[v],p.flags|=16):y.push(v)}}function t(p,v){if(!n)return null;for(;v!==null;)e(p,v),v=v.sibling;return null}function i(p,v){for(p=new Map;v!==null;)v.key!==null?p.set(v.key,v):p.set(v.index,v),v=v.sibling;return p}function r(p,v){return p=Co(p,v),p.index=0,p.sibling=null,p}function s(p,v,y){return p.index=y,n?(y=p.alternate,y!==null?(y=y.index,y<v?(p.flags|=2,v):y):(p.flags|=2,v)):(p.flags|=1048576,v)}function o(p){return n&&p.alternate===null&&(p.flags|=2),p}function a(p,v,y,x){return v===null||v.tag!==6?(v=kv(y,p.mode,x),v.return=p,v):(v=r(v,y),v.return=p,v)}function l(p,v,y,x){var T=y.type;return T===fl?c(p,v,y.props.children,x,y.key):v!==null&&(v.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===lo&&lw(T)===v.type)?(x=r(v,y.props),x.ref=Vc(p,v,y),x.return=p,x):(x=Yf(y.type,y.key,y.props,null,p.mode,x),x.ref=Vc(p,v,y),x.return=p,x)}function u(p,v,y,x){return v===null||v.tag!==4||v.stateNode.containerInfo!==y.containerInfo||v.stateNode.implementation!==y.implementation?(v=zv(y,p.mode,x),v.return=p,v):(v=r(v,y.children||[]),v.return=p,v)}function c(p,v,y,x,T){return v===null||v.tag!==7?(v=Sa(y,p.mode,x,T),v.return=p,v):(v=r(v,y),v.return=p,v)}function h(p,v,y){if(typeof v=="string"&&v!==""||typeof v=="number")return v=kv(""+v,p.mode,y),v.return=p,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case $d:return y=Yf(v.type,v.key,v.props,null,p.mode,y),y.ref=Vc(p,null,v),y.return=p,y;case dl:return v=zv(v,p.mode,y),v.return=p,v;case lo:var x=v._init;return h(p,x(v._payload),y)}if(_c(v)||mc(v))return v=Sa(v,p.mode,y,null),v.return=p,v;Mf(p,v)}return null}function d(p,v,y,x){var T=v!==null?v.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return T!==null?null:a(p,v,""+y,x);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case $d:return y.key===T?l(p,v,y,x):null;case dl:return y.key===T?u(p,v,y,x):null;case lo:return T=y._init,d(p,v,T(y._payload),x)}if(_c(y)||mc(y))return T!==null?null:c(p,v,y,x,null);Mf(p,y)}return null}function f(p,v,y,x,T){if(typeof x=="string"&&x!==""||typeof x=="number")return p=p.get(y)||null,a(v,p,""+x,T);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case $d:return p=p.get(x.key===null?y:x.key)||null,l(v,p,x,T);case dl:return p=p.get(x.key===null?y:x.key)||null,u(v,p,x,T);case lo:var S=x._init;return f(p,v,y,S(x._payload),T)}if(_c(x)||mc(x))return p=p.get(y)||null,c(v,p,x,T,null);Mf(v,x)}return null}function m(p,v,y,x){for(var T=null,S=null,w=v,E=v=0,M=null;w!==null&&E<y.length;E++){w.index>E?(M=w,w=null):M=w.sibling;var b=d(p,w,y[E],x);if(b===null){w===null&&(w=M);break}n&&w&&b.alternate===null&&e(p,w),v=s(b,v,E),S===null?T=b:S.sibling=b,S=b,w=M}if(E===y.length)return t(p,w),Wt&&fa(p,E),T;if(w===null){for(;E<y.length;E++)w=h(p,y[E],x),w!==null&&(v=s(w,v,E),S===null?T=w:S.sibling=w,S=w);return Wt&&fa(p,E),T}for(w=i(p,w);E<y.length;E++)M=f(w,p,E,y[E],x),M!==null&&(n&&M.alternate!==null&&w.delete(M.key===null?E:M.key),v=s(M,v,E),S===null?T=M:S.sibling=M,S=M);return n&&w.forEach(function(R){return e(p,R)}),Wt&&fa(p,E),T}function _(p,v,y,x){var T=mc(y);if(typeof T!="function")throw Error(fe(150));if(y=T.call(y),y==null)throw Error(fe(151));for(var S=T=null,w=v,E=v=0,M=null,b=y.next();w!==null&&!b.done;E++,b=y.next()){w.index>E?(M=w,w=null):M=w.sibling;var R=d(p,w,b.value,x);if(R===null){w===null&&(w=M);break}n&&w&&R.alternate===null&&e(p,w),v=s(R,v,E),S===null?T=R:S.sibling=R,S=R,w=M}if(b.done)return t(p,w),Wt&&fa(p,E),T;if(w===null){for(;!b.done;E++,b=y.next())b=h(p,b.value,x),b!==null&&(v=s(b,v,E),S===null?T=b:S.sibling=b,S=b);return Wt&&fa(p,E),T}for(w=i(p,w);!b.done;E++,b=y.next())b=f(w,p,E,b.value,x),b!==null&&(n&&b.alternate!==null&&w.delete(b.key===null?E:b.key),v=s(b,v,E),S===null?T=b:S.sibling=b,S=b);return n&&w.forEach(function(I){return e(p,I)}),Wt&&fa(p,E),T}function g(p,v,y,x){if(typeof y=="object"&&y!==null&&y.type===fl&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case $d:e:{for(var T=y.key,S=v;S!==null;){if(S.key===T){if(T=y.type,T===fl){if(S.tag===7){t(p,S.sibling),v=r(S,y.props.children),v.return=p,p=v;break e}}else if(S.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===lo&&lw(T)===S.type){t(p,S.sibling),v=r(S,y.props),v.ref=Vc(p,S,y),v.return=p,p=v;break e}t(p,S);break}else e(p,S);S=S.sibling}y.type===fl?(v=Sa(y.props.children,p.mode,x,y.key),v.return=p,p=v):(x=Yf(y.type,y.key,y.props,null,p.mode,x),x.ref=Vc(p,v,y),x.return=p,p=x)}return o(p);case dl:e:{for(S=y.key;v!==null;){if(v.key===S)if(v.tag===4&&v.stateNode.containerInfo===y.containerInfo&&v.stateNode.implementation===y.implementation){t(p,v.sibling),v=r(v,y.children||[]),v.return=p,p=v;break e}else{t(p,v);break}else e(p,v);v=v.sibling}v=zv(y,p.mode,x),v.return=p,p=v}return o(p);case lo:return S=y._init,g(p,v,S(y._payload),x)}if(_c(y))return m(p,v,y,x);if(mc(y))return _(p,v,y,x);Mf(p,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,v!==null&&v.tag===6?(t(p,v.sibling),v=r(v,y),v.return=p,p=v):(t(p,v),v=kv(y,p.mode,x),v.return=p,p=v),o(p)):t(p,v)}return g}var Nl=uw(!0),cw=uw(!1),Ef=vo(null),Af=null,Pl=null,Y_=null;function K_(){Y_=Pl=Af=null}function Q_(n){var e=Ef.current;kt(Ef),n._currentValue=e}function Z_(n,e,t){for(;n!==null;){var i=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),n===t)break;n=n.return}}function Dl(n,e){Af=n,Y_=Pl=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(bi=!0),n.firstContext=null)}function lr(n){var e=n._currentValue;if(Y_!==n)if(n={context:n,memoizedValue:e,next:null},Pl===null){if(Af===null)throw Error(fe(308));Pl=n,Af.dependencies={lanes:0,firstContext:n}}else Pl=Pl.next=n;return e}var pa=null;function J_(n){pa===null?pa=[n]:pa.push(n)}function hw(n,e,t,i){var r=e.interleaved;return r===null?(t.next=t,J_(e)):(t.next=r.next,r.next=t),e.interleaved=t,ws(n,i)}function ws(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var So=!1;function ev(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function dw(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Ms(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function To(n,e,t){var i=n.updateQueue;if(i===null)return null;if(i=i.shared,_t&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,ws(n,t)}return r=i.interleaved,r===null?(e.next=e,J_(i)):(e.next=r.next,r.next=e),i.interleaved=e,ws(n,t)}function Cf(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,p_(n,t)}}function fw(n,e){var t=n.updateQueue,i=n.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var r=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?r=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?r=s=e:s=s.next=e}else r=s=e;t={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Rf(n,e,t,i){var r=n.updateQueue;So=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?s=u:o.next=u,o=l;var c=n.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==o&&(a===null?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l))}if(s!==null){var h=r.baseState;o=0,c=u=l=null,a=s;do{var d=a.lane,f=a.eventTime;if((i&d)===d){c!==null&&(c=c.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=n,_=a;switch(d=e,f=t,_.tag){case 1:if(m=_.payload,typeof m=="function"){h=m.call(f,h,d);break e}h=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=_.payload,d=typeof m=="function"?m.call(f,h,d):m,d==null)break e;h=Qt({},h,d);break e;case 2:So=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,d=r.effects,d===null?r.effects=[a]:d.push(a))}else f={eventTime:f,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(u=c=f,l=h):c=c.next=f,o|=d;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;d=a,a=d.next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}while(!0);if(c===null&&(l=h),r.baseState=l,r.firstBaseUpdate=u,r.lastBaseUpdate=c,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);_a|=o,n.lanes=o,n.memoizedState=h}}function pw(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var i=n[e],r=i.callback;if(r!==null){if(i.callback=null,i=t,typeof r!="function")throw Error(fe(191,r));r.call(i)}}}var Hc={},Kr=vo(Hc),Wc=vo(Hc),$c=vo(Hc);function ma(n){if(n===Hc)throw Error(fe(174));return n}function tv(n,e){switch(Ft($c,e),Ft(Wc,n),Ft(Kr,Hc),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:n_(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=n_(e,n)}kt(Kr),Ft(Kr,e)}function Ll(){kt(Kr),kt(Wc),kt($c)}function mw(n){ma($c.current);var e=ma(Kr.current),t=n_(e,n.type);e!==t&&(Ft(Wc,n),Ft(Kr,t))}function nv(n){Wc.current===n&&(kt(Kr),kt(Wc))}var Zt=vo(0);function Nf(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var iv=[];function rv(){for(var n=0;n<iv.length;n++)iv[n]._workInProgressVersionPrimary=null;iv.length=0}var Pf=ys.ReactCurrentDispatcher,sv=ys.ReactCurrentBatchConfig,ga=0,Jt=null,Mn=null,Dn=null,Df=!1,jc=!1,Xc=0,vL=0;function Xn(){throw Error(fe(321))}function ov(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!wr(n[t],e[t]))return!1;return!0}function av(n,e,t,i,r,s){if(ga=s,Jt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Pf.current=n===null||n.memoizedState===null?TL:bL,n=t(i,r),jc){s=0;do{if(jc=!1,Xc=0,25<=s)throw Error(fe(301));s+=1,Dn=Mn=null,e.updateQueue=null,Pf.current=wL,n=t(i,r)}while(jc)}if(Pf.current=Uf,e=Mn!==null&&Mn.next!==null,ga=0,Dn=Mn=Jt=null,Df=!1,e)throw Error(fe(300));return n}function lv(){var n=Xc!==0;return Xc=0,n}function Qr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Dn===null?Jt.memoizedState=Dn=n:Dn=Dn.next=n,Dn}function ur(){if(Mn===null){var n=Jt.alternate;n=n!==null?n.memoizedState:null}else n=Mn.next;var e=Dn===null?Jt.memoizedState:Dn.next;if(e!==null)Dn=e,Mn=n;else{if(n===null)throw Error(fe(310));Mn=n,n={memoizedState:Mn.memoizedState,baseState:Mn.baseState,baseQueue:Mn.baseQueue,queue:Mn.queue,next:null},Dn===null?Jt.memoizedState=Dn=n:Dn=Dn.next=n}return Dn}function qc(n,e){return typeof e=="function"?e(n):e}function uv(n){var e=ur(),t=e.queue;if(t===null)throw Error(fe(311));t.lastRenderedReducer=n;var i=Mn,r=i.baseQueue,s=t.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,t.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,l=null,u=s;do{var c=u.lane;if((ga&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:n(i,u.action);else{var h={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=h,o=i):l=l.next=h,Jt.lanes|=c,_a|=c}u=u.next}while(u!==null&&u!==s);l===null?o=i:l.next=a,wr(i,e.memoizedState)||(bi=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,t.lastRenderedState=i}if(n=t.interleaved,n!==null){r=n;do s=r.lane,Jt.lanes|=s,_a|=s,r=r.next;while(r!==n)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function cv(n){var e=ur(),t=e.queue;if(t===null)throw Error(fe(311));t.lastRenderedReducer=n;var i=t.dispatch,r=t.pending,s=e.memoizedState;if(r!==null){t.pending=null;var o=r=r.next;do s=n(s,o.action),o=o.next;while(o!==r);wr(s,e.memoizedState)||(bi=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,i]}function gw(){}function _w(n,e){var t=Jt,i=ur(),r=e(),s=!wr(i.memoizedState,r);if(s&&(i.memoizedState=r,bi=!0),i=i.queue,hv(xw.bind(null,t,i,n),[n]),i.getSnapshot!==e||s||Dn!==null&&Dn.memoizedState.tag&1){if(t.flags|=2048,Yc(9,yw.bind(null,t,i,r,e),void 0,null),Ln===null)throw Error(fe(349));ga&30||vw(t,e,r)}return r}function vw(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Jt.updateQueue,e===null?(e={lastEffect:null,stores:null},Jt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function yw(n,e,t,i){e.value=t,e.getSnapshot=i,Sw(e)&&Tw(n)}function xw(n,e,t){return t(function(){Sw(e)&&Tw(n)})}function Sw(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!wr(n,t)}catch{return!0}}function Tw(n){var e=ws(n,1);e!==null&&Rr(e,n,1,-1)}function bw(n){var e=Qr();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:qc,lastRenderedState:n},e.queue=n,n=n.dispatch=SL.bind(null,Jt,n),[e.memoizedState,n]}function Yc(n,e,t,i){return n={tag:n,create:e,destroy:t,deps:i,next:null},e=Jt.updateQueue,e===null?(e={lastEffect:null,stores:null},Jt.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(i=t.next,t.next=n,n.next=i,e.lastEffect=n)),n}function ww(){return ur().memoizedState}function Lf(n,e,t,i){var r=Qr();Jt.flags|=n,r.memoizedState=Yc(1|e,t,void 0,i===void 0?null:i)}function If(n,e,t,i){var r=ur();i=i===void 0?null:i;var s=void 0;if(Mn!==null){var o=Mn.memoizedState;if(s=o.destroy,i!==null&&ov(i,o.deps)){r.memoizedState=Yc(e,t,s,i);return}}Jt.flags|=n,r.memoizedState=Yc(1|e,t,s,i)}function Mw(n,e){return Lf(8390656,8,n,e)}function hv(n,e){return If(2048,8,n,e)}function Ew(n,e){return If(4,2,n,e)}function Aw(n,e){return If(4,4,n,e)}function Cw(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function Rw(n,e,t){return t=t!=null?t.concat([n]):null,If(4,4,Cw.bind(null,e,n),t)}function dv(){}function Nw(n,e){var t=ur();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&ov(e,i[1])?i[0]:(t.memoizedState=[n,e],n)}function Pw(n,e){var t=ur();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&ov(e,i[1])?i[0]:(n=n(),t.memoizedState=[n,e],n)}function Dw(n,e,t){return ga&21?(wr(t,e)||(t=lb(),Jt.lanes|=t,_a|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,bi=!0),n.memoizedState=t)}function yL(n,e){var t=Pt;Pt=t!==0&&4>t?t:4,n(!0);var i=sv.transition;sv.transition={};try{n(!1),e()}finally{Pt=t,sv.transition=i}}function Lw(){return ur().memoizedState}function xL(n,e,t){var i=Eo(n);if(t={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null},Iw(n))Uw(e,t);else if(t=hw(n,e,t,i),t!==null){var r=li();Rr(t,n,i,r),Fw(t,e,i)}}function SL(n,e,t){var i=Eo(n),r={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null};if(Iw(n))Uw(e,r);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(r.hasEagerState=!0,r.eagerState=a,wr(a,o)){var l=e.interleaved;l===null?(r.next=r,J_(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}t=hw(n,e,r,i),t!==null&&(r=li(),Rr(t,n,i,r),Fw(t,e,i))}}function Iw(n){var e=n.alternate;return n===Jt||e!==null&&e===Jt}function Uw(n,e){jc=Df=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function Fw(n,e,t){if(t&4194240){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,p_(n,t)}}var Uf={readContext:lr,useCallback:Xn,useContext:Xn,useEffect:Xn,useImperativeHandle:Xn,useInsertionEffect:Xn,useLayoutEffect:Xn,useMemo:Xn,useReducer:Xn,useRef:Xn,useState:Xn,useDebugValue:Xn,useDeferredValue:Xn,useTransition:Xn,useMutableSource:Xn,useSyncExternalStore:Xn,useId:Xn,unstable_isNewReconciler:!1},TL={readContext:lr,useCallback:function(n,e){return Qr().memoizedState=[n,e===void 0?null:e],n},useContext:lr,useEffect:Mw,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Lf(4194308,4,Cw.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Lf(4194308,4,n,e)},useInsertionEffect:function(n,e){return Lf(4,2,n,e)},useMemo:function(n,e){var t=Qr();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var i=Qr();return e=t!==void 0?t(e):e,i.memoizedState=i.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},i.queue=n,n=n.dispatch=xL.bind(null,Jt,n),[i.memoizedState,n]},useRef:function(n){var e=Qr();return n={current:n},e.memoizedState=n},useState:bw,useDebugValue:dv,useDeferredValue:function(n){return Qr().memoizedState=n},useTransition:function(){var n=bw(!1),e=n[0];return n=yL.bind(null,n[1]),Qr().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var i=Jt,r=Qr();if(Wt){if(t===void 0)throw Error(fe(407));t=t()}else{if(t=e(),Ln===null)throw Error(fe(349));ga&30||vw(i,e,t)}r.memoizedState=t;var s={value:t,getSnapshot:e};return r.queue=s,Mw(xw.bind(null,i,s,n),[n]),i.flags|=2048,Yc(9,yw.bind(null,i,s,t,e),void 0,null),t},useId:function(){var n=Qr(),e=Ln.identifierPrefix;if(Wt){var t=bs,i=Ts;t=(i&~(1<<32-br(i)-1)).toString(32)+t,e=":"+e+"R"+t,t=Xc++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=vL++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},bL={readContext:lr,useCallback:Nw,useContext:lr,useEffect:hv,useImperativeHandle:Rw,useInsertionEffect:Ew,useLayoutEffect:Aw,useMemo:Pw,useReducer:uv,useRef:ww,useState:function(){return uv(qc)},useDebugValue:dv,useDeferredValue:function(n){var e=ur();return Dw(e,Mn.memoizedState,n)},useTransition:function(){var n=uv(qc)[0],e=ur().memoizedState;return[n,e]},useMutableSource:gw,useSyncExternalStore:_w,useId:Lw,unstable_isNewReconciler:!1},wL={readContext:lr,useCallback:Nw,useContext:lr,useEffect:hv,useImperativeHandle:Rw,useInsertionEffect:Ew,useLayoutEffect:Aw,useMemo:Pw,useReducer:cv,useRef:ww,useState:function(){return cv(qc)},useDebugValue:dv,useDeferredValue:function(n){var e=ur();return Mn===null?e.memoizedState=n:Dw(e,Mn.memoizedState,n)},useTransition:function(){var n=cv(qc)[0],e=ur().memoizedState;return[n,e]},useMutableSource:gw,useSyncExternalStore:_w,useId:Lw,unstable_isNewReconciler:!1};function Er(n,e){if(n&&n.defaultProps){e=Qt({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function fv(n,e,t,i){e=n.memoizedState,t=t(i,e),t=t==null?e:Qt({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Ff={isMounted:function(n){return(n=n._reactInternals)?ua(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var i=li(),r=Eo(n),s=Ms(i,r);s.payload=e,t!=null&&(s.callback=t),e=To(n,s,r),e!==null&&(Rr(e,n,r,i),Cf(e,n,r))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var i=li(),r=Eo(n),s=Ms(i,r);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=To(n,s,r),e!==null&&(Rr(e,n,r,i),Cf(e,n,r))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=li(),i=Eo(n),r=Ms(t,i);r.tag=2,e!=null&&(r.callback=e),e=To(n,r,i),e!==null&&(Rr(e,n,i,t),Cf(e,n,i))}};function Ow(n,e,t,i,r,s,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!Uc(t,i)||!Uc(r,s):!0}function Bw(n,e,t){var i=!1,r=yo,s=e.contextType;return typeof s=="object"&&s!==null?s=lr(s):(r=Ti(e)?ha:jn.current,i=e.contextTypes,s=(i=i!=null)?El(n,r):yo),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Ff,n.stateNode=e,e._reactInternals=n,i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=s),e}function kw(n,e,t,i){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==n&&Ff.enqueueReplaceState(e,e.state,null)}function pv(n,e,t,i){var r=n.stateNode;r.props=t,r.state=n.memoizedState,r.refs={},ev(n);var s=e.contextType;typeof s=="object"&&s!==null?r.context=lr(s):(s=Ti(e)?ha:jn.current,r.context=El(n,s)),r.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(fv(n,e,s,t),r.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Ff.enqueueReplaceState(r,r.state,null),Rf(n,t,r,i),r.state=n.memoizedState),typeof r.componentDidMount=="function"&&(n.flags|=4194308)}function Il(n,e){try{var t="",i=e;do t+=Z2(i),i=i.return;while(i);var r=t}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:r,digest:null}}function mv(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function gv(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var ML=typeof WeakMap=="function"?WeakMap:Map;function zw(n,e,t){t=Ms(-1,t),t.tag=3,t.payload={element:null};var i=e.value;return t.callback=function(){Hf||(Hf=!0,Pv=i),gv(n,e)},t}function Gw(n,e,t){t=Ms(-1,t),t.tag=3;var i=n.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;t.payload=function(){return i(r)},t.callback=function(){gv(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){gv(n,e),typeof i!="function"&&(wo===null?wo=new Set([this]):wo.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function Vw(n,e,t){var i=n.pingCache;if(i===null){i=n.pingCache=new ML;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(t)||(r.add(t),n=kL.bind(null,n,e,t),e.then(n,n))}function Hw(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function Ww(n,e,t,i,r){return n.mode&1?(n.flags|=65536,n.lanes=r,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Ms(-1,1),e.tag=2,To(t,e,1))),t.lanes|=1),n)}var EL=ys.ReactCurrentOwner,bi=!1;function ai(n,e,t,i){e.child=n===null?cw(e,null,t,i):Nl(e,n.child,t,i)}function $w(n,e,t,i,r){t=t.render;var s=e.ref;return Dl(e,r),i=av(n,e,t,i,s,r),t=lv(),n!==null&&!bi?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,Es(n,e,r)):(Wt&&t&&W_(e),e.flags|=1,ai(n,e,i,r),e.child)}function jw(n,e,t,i,r){if(n===null){var s=t.type;return typeof s=="function"&&!Bv(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,Xw(n,e,s,i,r)):(n=Yf(t.type,null,i,e,e.mode,r),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&r)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:Uc,t(o,i)&&n.ref===e.ref)return Es(n,e,r)}return e.flags|=1,n=Co(s,i),n.ref=e.ref,n.return=e,e.child=n}function Xw(n,e,t,i,r){if(n!==null){var s=n.memoizedProps;if(Uc(s,i)&&n.ref===e.ref)if(bi=!1,e.pendingProps=i=s,(n.lanes&r)!==0)n.flags&131072&&(bi=!0);else return e.lanes=n.lanes,Es(n,e,r)}return _v(n,e,t,i,r)}function qw(n,e,t){var i=e.pendingProps,r=i.children,s=n!==null?n.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ft(Fl,ji),ji|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Ft(Fl,ji),ji|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:t,Ft(Fl,ji),ji|=i}else s!==null?(i=s.baseLanes|t,e.memoizedState=null):i=t,Ft(Fl,ji),ji|=i;return ai(n,e,r,t),e.child}function Yw(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function _v(n,e,t,i,r){var s=Ti(t)?ha:jn.current;return s=El(e,s),Dl(e,r),t=av(n,e,t,i,s,r),i=lv(),n!==null&&!bi?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,Es(n,e,r)):(Wt&&i&&W_(e),e.flags|=1,ai(n,e,t,r),e.child)}function Kw(n,e,t,i,r){if(Ti(t)){var s=!0;xf(e)}else s=!1;if(Dl(e,r),e.stateNode===null)Bf(n,e),Bw(e,t,i),pv(e,t,i,r),i=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=lr(u):(u=Ti(t)?ha:jn.current,u=El(e,u));var c=t.getDerivedStateFromProps,h=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==u)&&kw(e,o,i,u),So=!1;var d=e.memoizedState;o.state=d,Rf(e,i,o,r),l=e.memoizedState,a!==i||d!==l||Si.current||So?(typeof c=="function"&&(fv(e,t,c,i),l=e.memoizedState),(a=So||Ow(e,t,a,i,d,l,u))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=u,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,dw(n,e),a=e.memoizedProps,u=e.type===e.elementType?a:Er(e.type,a),o.props=u,h=e.pendingProps,d=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=lr(l):(l=Ti(t)?ha:jn.current,l=El(e,l));var f=t.getDerivedStateFromProps;(c=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||d!==l)&&kw(e,o,i,l),So=!1,d=e.memoizedState,o.state=d,Rf(e,i,o,r);var m=e.memoizedState;a!==h||d!==m||Si.current||So?(typeof f=="function"&&(fv(e,t,f,i),m=e.memoizedState),(u=So||Ow(e,t,u,i,d,m,l)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,m,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,m,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=m),o.props=i,o.state=m,o.context=l,i=u):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=1024),i=!1)}return vv(n,e,t,i,s,r)}function vv(n,e,t,i,r,s){Yw(n,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&tw(e,t,!1),Es(n,e,s);i=e.stateNode,EL.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,n!==null&&o?(e.child=Nl(e,n.child,null,s),e.child=Nl(e,null,a,s)):ai(n,e,a,s),e.memoizedState=i.state,r&&tw(e,t,!0),e.child}function Qw(n){var e=n.stateNode;e.pendingContext?Jb(n,e.pendingContext,e.pendingContext!==e.context):e.context&&Jb(n,e.context,!1),tv(n,e.containerInfo)}function Zw(n,e,t,i,r){return Rl(),q_(r),e.flags|=256,ai(n,e,t,i),e.child}var yv={dehydrated:null,treeContext:null,retryLane:0};function xv(n){return{baseLanes:n,cachePool:null,transitions:null}}function Jw(n,e,t){var i=e.pendingProps,r=Zt.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(r|=1),Ft(Zt,r&1),n===null)return X_(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,n=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Kf(o,i,0,null),n=Sa(n,i,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=xv(t),e.memoizedState=yv,n):Sv(e,o));if(r=n.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return AL(n,e,o,i,a,r,t);if(s){s=i.fallback,o=e.mode,r=n.child,a=r.sibling;var l={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=Co(r,l),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=Co(a,s):(s=Sa(s,o,t,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=n.child.memoizedState,o=o===null?xv(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=n.childLanes&~t,e.memoizedState=yv,i}return s=n.child,n=s.sibling,i=Co(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=t),i.return=e,i.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=i,e.memoizedState=null,i}function Sv(n,e){return e=Kf({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function Of(n,e,t,i){return i!==null&&q_(i),Nl(e,n.child,null,t),n=Sv(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function AL(n,e,t,i,r,s,o){if(t)return e.flags&256?(e.flags&=-257,i=mv(Error(fe(422))),Of(n,e,o,i)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=Kf({mode:"visible",children:i.children},r,0,null),s=Sa(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&Nl(e,n.child,null,o),e.child.memoizedState=xv(o),e.memoizedState=yv,s);if(!(e.mode&1))return Of(n,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(fe(419)),i=mv(s,i,void 0),Of(n,e,o,i)}if(a=(o&n.childLanes)!==0,bi||a){if(i=Ln,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,ws(n,r),Rr(i,n,r,-1))}return Ov(),i=mv(Error(fe(421))),Of(n,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=n.child,e=zL.bind(null,n),r._reactRetry=e,null):(n=s.treeContext,$i=_o(r.nextSibling),Wi=e,Wt=!0,Mr=null,n!==null&&(or[ar++]=Ts,or[ar++]=bs,or[ar++]=da,Ts=n.id,bs=n.overflow,da=e),e=Sv(e,i.children),e.flags|=4096,e)}function eM(n,e,t){n.lanes|=e;var i=n.alternate;i!==null&&(i.lanes|=e),Z_(n.return,e,t)}function Tv(n,e,t,i,r){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=t,s.tailMode=r)}function tM(n,e,t){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(ai(n,e,i.children,t),i=Zt.current,i&2)i=i&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&eM(n,t,e);else if(n.tag===19)eM(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}i&=1}if(Ft(Zt,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)n=t.alternate,n!==null&&Nf(n)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),Tv(e,!1,r,t,s);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(n=r.alternate,n!==null&&Nf(n)===null){e.child=r;break}n=r.sibling,r.sibling=t,t=r,r=n}Tv(e,!0,t,null,s);break;case"together":Tv(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Bf(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Es(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),_a|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(fe(153));if(e.child!==null){for(n=e.child,t=Co(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Co(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function CL(n,e,t){switch(e.tag){case 3:Qw(e),Rl();break;case 5:mw(e);break;case 1:Ti(e.type)&&xf(e);break;case 4:tv(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;Ft(Ef,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(Ft(Zt,Zt.current&1),e.flags|=128,null):t&e.child.childLanes?Jw(n,e,t):(Ft(Zt,Zt.current&1),n=Es(n,e,t),n!==null?n.sibling:null);Ft(Zt,Zt.current&1);break;case 19:if(i=(t&e.childLanes)!==0,n.flags&128){if(i)return tM(n,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Ft(Zt,Zt.current),i)break;return null;case 22:case 23:return e.lanes=0,qw(n,e,t)}return Es(n,e,t)}var nM,bv,iM,rM;nM=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}},bv=function(){},iM=function(n,e,t,i){var r=n.memoizedProps;if(r!==i){n=e.stateNode,ma(Kr.current);var s=null;switch(t){case"input":r=Zg(n,r),i=Zg(n,i),s=[];break;case"select":r=Qt({},r,{value:void 0}),i=Qt({},i,{value:void 0}),s=[];break;case"textarea":r=t_(n,r),i=t_(n,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(n.onclick=_f)}i_(t,i);var o;t=null;for(u in r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var a=r[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(pc.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in i){var l=i[u];if(a=r!=null?r[u]:void 0,i.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(s||(s=[]),s.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(pc.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Bt("scroll",n),s||a===l||(s=[])):(s=s||[]).push(u,l))}t&&(s=s||[]).push("style",t);var u=s;(e.updateQueue=u)&&(e.flags|=4)}},rM=function(n,e,t,i){t!==i&&(e.flags|=4)};function Kc(n,e){if(!Wt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:i.sibling=null}}function qn(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,i=0;if(e)for(var r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=n,r=r.sibling;else for(r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=n,r=r.sibling;return n.subtreeFlags|=i,n.childLanes=t,e}function RL(n,e,t){var i=e.pendingProps;switch($_(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qn(e),null;case 1:return Ti(e.type)&&yf(),qn(e),null;case 3:return i=e.stateNode,Ll(),kt(Si),kt(jn),rv(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(n===null||n.child===null)&&(wf(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Mr!==null&&(Iv(Mr),Mr=null))),bv(n,e),qn(e),null;case 5:nv(e);var r=ma($c.current);if(t=e.type,n!==null&&e.stateNode!=null)iM(n,e,t,i,r),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(fe(166));return qn(e),null}if(n=ma(Kr.current),wf(e)){i=e.stateNode,t=e.type;var s=e.memoizedProps;switch(i[Yr]=e,i[zc]=s,n=(e.mode&1)!==0,t){case"dialog":Bt("cancel",i),Bt("close",i);break;case"iframe":case"object":case"embed":Bt("load",i);break;case"video":case"audio":for(r=0;r<Oc.length;r++)Bt(Oc[r],i);break;case"source":Bt("error",i);break;case"img":case"image":case"link":Bt("error",i),Bt("load",i);break;case"details":Bt("toggle",i);break;case"input":BT(i,s),Bt("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},Bt("invalid",i);break;case"textarea":GT(i,s),Bt("invalid",i)}i_(t,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&gf(i.textContent,a,n),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&gf(i.textContent,a,n),r=["children",""+a]):pc.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Bt("scroll",i)}switch(t){case"input":jd(i),zT(i,s,!0);break;case"textarea":jd(i),HT(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=_f)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=WT(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof i.is=="string"?n=o.createElement(t,{is:i.is}):(n=o.createElement(t),t==="select"&&(o=n,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):n=o.createElementNS(n,t),n[Yr]=e,n[zc]=i,nM(n,e,!1,!1),e.stateNode=n;e:{switch(o=r_(t,i),t){case"dialog":Bt("cancel",n),Bt("close",n),r=i;break;case"iframe":case"object":case"embed":Bt("load",n),r=i;break;case"video":case"audio":for(r=0;r<Oc.length;r++)Bt(Oc[r],n);r=i;break;case"source":Bt("error",n),r=i;break;case"img":case"image":case"link":Bt("error",n),Bt("load",n),r=i;break;case"details":Bt("toggle",n),r=i;break;case"input":BT(n,i),r=Zg(n,i),Bt("invalid",n);break;case"option":r=i;break;case"select":n._wrapperState={wasMultiple:!!i.multiple},r=Qt({},i,{value:void 0}),Bt("invalid",n);break;case"textarea":GT(n,i),r=t_(n,i),Bt("invalid",n);break;default:r=i}i_(t,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?XT(n,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&$T(n,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&vc(n,l):typeof l=="number"&&vc(n,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(pc.hasOwnProperty(s)?l!=null&&s==="onScroll"&&Bt("scroll",n):l!=null&&Gg(n,s,l,o))}switch(t){case"input":jd(n),zT(n,i,!1);break;case"textarea":jd(n),HT(n);break;case"option":i.value!=null&&n.setAttribute("value",""+uo(i.value));break;case"select":n.multiple=!!i.multiple,s=i.value,s!=null?pl(n,!!i.multiple,s,!1):i.defaultValue!=null&&pl(n,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(n.onclick=_f)}switch(t){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return qn(e),null;case 6:if(n&&e.stateNode!=null)rM(n,e,n.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(fe(166));if(t=ma($c.current),ma(Kr.current),wf(e)){if(i=e.stateNode,t=e.memoizedProps,i[Yr]=e,(s=i.nodeValue!==t)&&(n=Wi,n!==null))switch(n.tag){case 3:gf(i.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&gf(i.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else i=(t.nodeType===9?t:t.ownerDocument).createTextNode(i),i[Yr]=e,e.stateNode=i}return qn(e),null;case 13:if(kt(Zt),i=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Wt&&$i!==null&&e.mode&1&&!(e.flags&128))aw(),Rl(),e.flags|=98560,s=!1;else if(s=wf(e),i!==null&&i.dehydrated!==null){if(n===null){if(!s)throw Error(fe(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(fe(317));s[Yr]=e}else Rl(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;qn(e),s=!1}else Mr!==null&&(Iv(Mr),Mr=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(i=i!==null,i!==(n!==null&&n.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(n===null||Zt.current&1?En===0&&(En=3):Ov())),e.updateQueue!==null&&(e.flags|=4),qn(e),null);case 4:return Ll(),bv(n,e),n===null&&Bc(e.stateNode.containerInfo),qn(e),null;case 10:return Q_(e.type._context),qn(e),null;case 17:return Ti(e.type)&&yf(),qn(e),null;case 19:if(kt(Zt),s=e.memoizedState,s===null)return qn(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)Kc(s,!1);else{if(En!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=Nf(n),o!==null){for(e.flags|=128,Kc(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=t,t=e.child;t!==null;)s=t,n=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,n=o.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Ft(Zt,Zt.current&1|2),e.child}n=n.sibling}s.tail!==null&&un()>Ol&&(e.flags|=128,i=!0,Kc(s,!1),e.lanes=4194304)}else{if(!i)if(n=Nf(o),n!==null){if(e.flags|=128,i=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Kc(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Wt)return qn(e),null}else 2*un()-s.renderingStartTime>Ol&&t!==1073741824&&(e.flags|=128,i=!0,Kc(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=un(),e.sibling=null,t=Zt.current,Ft(Zt,i?t&1|2:t&1),e):(qn(e),null);case 22:case 23:return Fv(),i=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?ji&1073741824&&(qn(e),e.subtreeFlags&6&&(e.flags|=8192)):qn(e),null;case 24:return null;case 25:return null}throw Error(fe(156,e.tag))}function NL(n,e){switch($_(e),e.tag){case 1:return Ti(e.type)&&yf(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Ll(),kt(Si),kt(jn),rv(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return nv(e),null;case 13:if(kt(Zt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(fe(340));Rl()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return kt(Zt),null;case 4:return Ll(),null;case 10:return Q_(e.type._context),null;case 22:case 23:return Fv(),null;case 24:return null;default:return null}}var kf=!1,Yn=!1,PL=typeof WeakSet=="function"?WeakSet:Set,Ae=null;function Ul(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(i){sn(n,e,i)}else t.current=null}function wv(n,e,t){try{t()}catch(i){sn(n,e,i)}}var sM=!1;function DL(n,e){if(F_=sf,n=Ob(),C_(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var i=t.getSelection&&t.getSelection();if(i&&i.rangeCount!==0){t=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,u=0,c=0,h=n,d=null;t:for(;;){for(var f;h!==t||r!==0&&h.nodeType!==3||(a=o+r),h!==s||i!==0&&h.nodeType!==3||(l=o+i),h.nodeType===3&&(o+=h.nodeValue.length),(f=h.firstChild)!==null;)d=h,h=f;for(;;){if(h===n)break t;if(d===t&&++u===r&&(a=o),d===s&&++c===i&&(l=o),(f=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=f}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(O_={focusedElem:n,selectionRange:t},sf=!1,Ae=e;Ae!==null;)if(e=Ae,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,Ae=n;else for(;Ae!==null;){e=Ae;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var _=m.memoizedProps,g=m.memoizedState,p=e.stateNode,v=p.getSnapshotBeforeUpdate(e.elementType===e.type?_:Er(e.type,_),g);p.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var y=e.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(fe(163))}}catch(x){sn(e,e.return,x)}if(n=e.sibling,n!==null){n.return=e.return,Ae=n;break}Ae=e.return}return m=sM,sM=!1,m}function Qc(n,e,t){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&n)===n){var s=r.destroy;r.destroy=void 0,s!==void 0&&wv(e,t,s)}r=r.next}while(r!==i)}}function zf(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var i=t.create;t.destroy=i()}t=t.next}while(t!==e)}}function Mv(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function oM(n){var e=n.alternate;e!==null&&(n.alternate=null,oM(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Yr],delete e[zc],delete e[G_],delete e[pL],delete e[mL])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function aM(n){return n.tag===5||n.tag===3||n.tag===4}function lM(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||aM(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Ev(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=_f));else if(i!==4&&(n=n.child,n!==null))for(Ev(n,e,t),n=n.sibling;n!==null;)Ev(n,e,t),n=n.sibling}function Av(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(i!==4&&(n=n.child,n!==null))for(Av(n,e,t),n=n.sibling;n!==null;)Av(n,e,t),n=n.sibling}var kn=null,Ar=!1;function bo(n,e,t){for(t=t.child;t!==null;)uM(n,e,t),t=t.sibling}function uM(n,e,t){if(qr&&typeof qr.onCommitFiberUnmount=="function")try{qr.onCommitFiberUnmount(Zd,t)}catch{}switch(t.tag){case 5:Yn||Ul(t,e);case 6:var i=kn,r=Ar;kn=null,bo(n,e,t),kn=i,Ar=r,kn!==null&&(Ar?(n=kn,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):kn.removeChild(t.stateNode));break;case 18:kn!==null&&(Ar?(n=kn,t=t.stateNode,n.nodeType===8?z_(n.parentNode,t):n.nodeType===1&&z_(n,t),Rc(n)):z_(kn,t.stateNode));break;case 4:i=kn,r=Ar,kn=t.stateNode.containerInfo,Ar=!0,bo(n,e,t),kn=i,Ar=r;break;case 0:case 11:case 14:case 15:if(!Yn&&(i=t.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&wv(t,e,o),r=r.next}while(r!==i)}bo(n,e,t);break;case 1:if(!Yn&&(Ul(t,e),i=t.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=t.memoizedProps,i.state=t.memoizedState,i.componentWillUnmount()}catch(a){sn(t,e,a)}bo(n,e,t);break;case 21:bo(n,e,t);break;case 22:t.mode&1?(Yn=(i=Yn)||t.memoizedState!==null,bo(n,e,t),Yn=i):bo(n,e,t);break;default:bo(n,e,t)}}function cM(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new PL),e.forEach(function(i){var r=GL.bind(null,n,i);t.has(i)||(t.add(i),i.then(r,r))})}}function Cr(n,e){var t=e.deletions;if(t!==null)for(var i=0;i<t.length;i++){var r=t[i];try{var s=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:kn=a.stateNode,Ar=!1;break e;case 3:kn=a.stateNode.containerInfo,Ar=!0;break e;case 4:kn=a.stateNode.containerInfo,Ar=!0;break e}a=a.return}if(kn===null)throw Error(fe(160));uM(s,o,r),kn=null,Ar=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(u){sn(r,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)hM(e,n),e=e.sibling}function hM(n,e){var t=n.alternate,i=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Cr(e,n),Zr(n),i&4){try{Qc(3,n,n.return),zf(3,n)}catch(_){sn(n,n.return,_)}try{Qc(5,n,n.return)}catch(_){sn(n,n.return,_)}}break;case 1:Cr(e,n),Zr(n),i&512&&t!==null&&Ul(t,t.return);break;case 5:if(Cr(e,n),Zr(n),i&512&&t!==null&&Ul(t,t.return),n.flags&32){var r=n.stateNode;try{vc(r,"")}catch(_){sn(n,n.return,_)}}if(i&4&&(r=n.stateNode,r!=null)){var s=n.memoizedProps,o=t!==null?t.memoizedProps:s,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&kT(r,s),r_(a,o);var u=r_(a,s);for(o=0;o<l.length;o+=2){var c=l[o],h=l[o+1];c==="style"?XT(r,h):c==="dangerouslySetInnerHTML"?$T(r,h):c==="children"?vc(r,h):Gg(r,c,h,u)}switch(a){case"input":Jg(r,s);break;case"textarea":VT(r,s);break;case"select":var d=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var f=s.value;f!=null?pl(r,!!s.multiple,f,!1):d!==!!s.multiple&&(s.defaultValue!=null?pl(r,!!s.multiple,s.defaultValue,!0):pl(r,!!s.multiple,s.multiple?[]:"",!1))}r[zc]=s}catch(_){sn(n,n.return,_)}}break;case 6:if(Cr(e,n),Zr(n),i&4){if(n.stateNode===null)throw Error(fe(162));r=n.stateNode,s=n.memoizedProps;try{r.nodeValue=s}catch(_){sn(n,n.return,_)}}break;case 3:if(Cr(e,n),Zr(n),i&4&&t!==null&&t.memoizedState.isDehydrated)try{Rc(e.containerInfo)}catch(_){sn(n,n.return,_)}break;case 4:Cr(e,n),Zr(n);break;case 13:Cr(e,n),Zr(n),r=n.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(Nv=un())),i&4&&cM(n);break;case 22:if(c=t!==null&&t.memoizedState!==null,n.mode&1?(Yn=(u=Yn)||c,Cr(e,n),Yn=u):Cr(e,n),Zr(n),i&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!c&&n.mode&1)for(Ae=n,c=n.child;c!==null;){for(h=Ae=c;Ae!==null;){switch(d=Ae,f=d.child,d.tag){case 0:case 11:case 14:case 15:Qc(4,d,d.return);break;case 1:Ul(d,d.return);var m=d.stateNode;if(typeof m.componentWillUnmount=="function"){i=d,t=d.return;try{e=i,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(_){sn(i,t,_)}}break;case 5:Ul(d,d.return);break;case 22:if(d.memoizedState!==null){pM(h);continue}}f!==null?(f.return=d,Ae=f):pM(h)}c=c.sibling}e:for(c=null,h=n;;){if(h.tag===5){if(c===null){c=h;try{r=h.stateNode,u?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=jT("display",o))}catch(_){sn(n,n.return,_)}}}else if(h.tag===6){if(c===null)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(_){sn(n,n.return,_)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===n)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===n)break e;for(;h.sibling===null;){if(h.return===null||h.return===n)break e;c===h&&(c=null),h=h.return}c===h&&(c=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Cr(e,n),Zr(n),i&4&&cM(n);break;case 21:break;default:Cr(e,n),Zr(n)}}function Zr(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(aM(t)){var i=t;break e}t=t.return}throw Error(fe(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(vc(r,""),i.flags&=-33);var s=lM(n);Av(n,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=lM(n);Ev(n,a,o);break;default:throw Error(fe(161))}}catch(l){sn(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function LL(n,e,t){Ae=n,dM(n)}function dM(n,e,t){for(var i=(n.mode&1)!==0;Ae!==null;){var r=Ae,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||kf;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||Yn;a=kf;var u=Yn;if(kf=o,(Yn=l)&&!u)for(Ae=r;Ae!==null;)o=Ae,l=o.child,o.tag===22&&o.memoizedState!==null?mM(r):l!==null?(l.return=o,Ae=l):mM(r);for(;s!==null;)Ae=s,dM(s),s=s.sibling;Ae=r,kf=a,Yn=u}fM(n)}else r.subtreeFlags&8772&&s!==null?(s.return=r,Ae=s):fM(n)}}function fM(n){for(;Ae!==null;){var e=Ae;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Yn||zf(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Yn)if(t===null)i.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:Er(e.type,t.memoizedProps);i.componentDidUpdate(r,t.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&pw(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}pw(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var h=c.dehydrated;h!==null&&Rc(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(fe(163))}Yn||e.flags&512&&Mv(e)}catch(d){sn(e,e.return,d)}}if(e===n){Ae=null;break}if(t=e.sibling,t!==null){t.return=e.return,Ae=t;break}Ae=e.return}}function pM(n){for(;Ae!==null;){var e=Ae;if(e===n){Ae=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Ae=t;break}Ae=e.return}}function mM(n){for(;Ae!==null;){var e=Ae;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{zf(4,e)}catch(l){sn(e,t,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){sn(e,r,l)}}var s=e.return;try{Mv(e)}catch(l){sn(e,s,l)}break;case 5:var o=e.return;try{Mv(e)}catch(l){sn(e,o,l)}}}catch(l){sn(e,e.return,l)}if(e===n){Ae=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Ae=a;break}Ae=e.return}}var IL=Math.ceil,Gf=ys.ReactCurrentDispatcher,Cv=ys.ReactCurrentOwner,cr=ys.ReactCurrentBatchConfig,_t=0,Ln=null,pn=null,zn=0,ji=0,Fl=vo(0),En=0,Zc=null,_a=0,Vf=0,Rv=0,Jc=null,wi=null,Nv=0,Ol=1/0,As=null,Hf=!1,Pv=null,wo=null,Wf=!1,Mo=null,$f=0,eh=0,Dv=null,jf=-1,Xf=0;function li(){return _t&6?un():jf!==-1?jf:jf=un()}function Eo(n){return n.mode&1?_t&2&&zn!==0?zn&-zn:_L.transition!==null?(Xf===0&&(Xf=lb()),Xf):(n=Pt,n!==0||(n=window.event,n=n===void 0?16:_b(n.type)),n):1}function Rr(n,e,t,i){if(50<eh)throw eh=0,Dv=null,Error(fe(185));wc(n,t,i),(!(_t&2)||n!==Ln)&&(n===Ln&&(!(_t&2)&&(Vf|=t),En===4&&Ao(n,zn)),Mi(n,i),t===1&&_t===0&&!(e.mode&1)&&(Ol=un()+500,Sf&&xo()))}function Mi(n,e){var t=n.callbackNode;_D(n,e);var i=tf(n,n===Ln?zn:0);if(i===0)t!==null&&sb(t),n.callbackNode=null,n.callbackPriority=0;else if(e=i&-i,n.callbackPriority!==e){if(t!=null&&sb(t),e===1)n.tag===0?gL(_M.bind(null,n)):nw(_M.bind(null,n)),dL(function(){!(_t&6)&&xo()}),t=null;else{switch(ub(i)){case 1:t=h_;break;case 4:t=ob;break;case 16:t=Qd;break;case 536870912:t=ab;break;default:t=Qd}t=MM(t,gM.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function gM(n,e){if(jf=-1,Xf=0,_t&6)throw Error(fe(327));var t=n.callbackNode;if(Bl()&&n.callbackNode!==t)return null;var i=tf(n,n===Ln?zn:0);if(i===0)return null;if(i&30||i&n.expiredLanes||e)e=qf(n,i);else{e=i;var r=_t;_t|=2;var s=yM();(Ln!==n||zn!==e)&&(As=null,Ol=un()+500,ya(n,e));do try{OL();break}catch(a){vM(n,a)}while(!0);K_(),Gf.current=s,_t=r,pn!==null?e=0:(Ln=null,zn=0,e=En)}if(e!==0){if(e===2&&(r=d_(n),r!==0&&(i=r,e=Lv(n,r))),e===1)throw t=Zc,ya(n,0),Ao(n,i),Mi(n,un()),t;if(e===6)Ao(n,i);else{if(r=n.current.alternate,!(i&30)&&!UL(r)&&(e=qf(n,i),e===2&&(s=d_(n),s!==0&&(i=s,e=Lv(n,s))),e===1))throw t=Zc,ya(n,0),Ao(n,i),Mi(n,un()),t;switch(n.finishedWork=r,n.finishedLanes=i,e){case 0:case 1:throw Error(fe(345));case 2:xa(n,wi,As);break;case 3:if(Ao(n,i),(i&130023424)===i&&(e=Nv+500-un(),10<e)){if(tf(n,0)!==0)break;if(r=n.suspendedLanes,(r&i)!==i){li(),n.pingedLanes|=n.suspendedLanes&r;break}n.timeoutHandle=k_(xa.bind(null,n,wi,As),e);break}xa(n,wi,As);break;case 4:if(Ao(n,i),(i&4194240)===i)break;for(e=n.eventTimes,r=-1;0<i;){var o=31-br(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=un()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*IL(i/1960))-i,10<i){n.timeoutHandle=k_(xa.bind(null,n,wi,As),i);break}xa(n,wi,As);break;case 5:xa(n,wi,As);break;default:throw Error(fe(329))}}}return Mi(n,un()),n.callbackNode===t?gM.bind(null,n):null}function Lv(n,e){var t=Jc;return n.current.memoizedState.isDehydrated&&(ya(n,e).flags|=256),n=qf(n,e),n!==2&&(e=wi,wi=t,e!==null&&Iv(e)),n}function Iv(n){wi===null?wi=n:wi.push.apply(wi,n)}function UL(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var i=0;i<t.length;i++){var r=t[i],s=r.getSnapshot;r=r.value;try{if(!wr(s(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ao(n,e){for(e&=~Rv,e&=~Vf,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-br(e),i=1<<t;n[t]=-1,e&=~i}}function _M(n){if(_t&6)throw Error(fe(327));Bl();var e=tf(n,0);if(!(e&1))return Mi(n,un()),null;var t=qf(n,e);if(n.tag!==0&&t===2){var i=d_(n);i!==0&&(e=i,t=Lv(n,i))}if(t===1)throw t=Zc,ya(n,0),Ao(n,e),Mi(n,un()),t;if(t===6)throw Error(fe(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,xa(n,wi,As),Mi(n,un()),null}function Uv(n,e){var t=_t;_t|=1;try{return n(e)}finally{_t=t,_t===0&&(Ol=un()+500,Sf&&xo())}}function va(n){Mo!==null&&Mo.tag===0&&!(_t&6)&&Bl();var e=_t;_t|=1;var t=cr.transition,i=Pt;try{if(cr.transition=null,Pt=1,n)return n()}finally{Pt=i,cr.transition=t,_t=e,!(_t&6)&&xo()}}function Fv(){ji=Fl.current,kt(Fl)}function ya(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,hL(t)),pn!==null)for(t=pn.return;t!==null;){var i=t;switch($_(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&yf();break;case 3:Ll(),kt(Si),kt(jn),rv();break;case 5:nv(i);break;case 4:Ll();break;case 13:kt(Zt);break;case 19:kt(Zt);break;case 10:Q_(i.type._context);break;case 22:case 23:Fv()}t=t.return}if(Ln=n,pn=n=Co(n.current,null),zn=ji=e,En=0,Zc=null,Rv=Vf=_a=0,wi=Jc=null,pa!==null){for(e=0;e<pa.length;e++)if(t=pa[e],i=t.interleaved,i!==null){t.interleaved=null;var r=i.next,s=t.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}t.pending=i}pa=null}return n}function vM(n,e){do{var t=pn;try{if(K_(),Pf.current=Uf,Df){for(var i=Jt.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}Df=!1}if(ga=0,Dn=Mn=Jt=null,jc=!1,Xc=0,Cv.current=null,t===null||t.return===null){En=1,Zc=e,pn=null;break}e:{var s=n,o=t.return,a=t,l=e;if(e=zn,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=a,h=c.tag;if(!(c.mode&1)&&(h===0||h===11||h===15)){var d=c.alternate;d?(c.updateQueue=d.updateQueue,c.memoizedState=d.memoizedState,c.lanes=d.lanes):(c.updateQueue=null,c.memoizedState=null)}var f=Hw(o);if(f!==null){f.flags&=-257,Ww(f,o,a,s,e),f.mode&1&&Vw(s,u,e),e=f,l=u;var m=e.updateQueue;if(m===null){var _=new Set;_.add(l),e.updateQueue=_}else m.add(l);break e}else{if(!(e&1)){Vw(s,u,e),Ov();break e}l=Error(fe(426))}}else if(Wt&&a.mode&1){var g=Hw(o);if(g!==null){!(g.flags&65536)&&(g.flags|=256),Ww(g,o,a,s,e),q_(Il(l,a));break e}}s=l=Il(l,a),En!==4&&(En=2),Jc===null?Jc=[s]:Jc.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var p=zw(s,l,e);fw(s,p);break e;case 1:a=l;var v=s.type,y=s.stateNode;if(!(s.flags&128)&&(typeof v.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(wo===null||!wo.has(y)))){s.flags|=65536,e&=-e,s.lanes|=e;var x=Gw(s,a,e);fw(s,x);break e}}s=s.return}while(s!==null)}SM(t)}catch(T){e=T,pn===t&&t!==null&&(pn=t=t.return);continue}break}while(!0)}function yM(){var n=Gf.current;return Gf.current=Uf,n===null?Uf:n}function Ov(){(En===0||En===3||En===2)&&(En=4),Ln===null||!(_a&268435455)&&!(Vf&268435455)||Ao(Ln,zn)}function qf(n,e){var t=_t;_t|=2;var i=yM();(Ln!==n||zn!==e)&&(As=null,ya(n,e));do try{FL();break}catch(r){vM(n,r)}while(!0);if(K_(),_t=t,Gf.current=i,pn!==null)throw Error(fe(261));return Ln=null,zn=0,En}function FL(){for(;pn!==null;)xM(pn)}function OL(){for(;pn!==null&&!lD();)xM(pn)}function xM(n){var e=wM(n.alternate,n,ji);n.memoizedProps=n.pendingProps,e===null?SM(n):pn=e,Cv.current=null}function SM(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=NL(t,e),t!==null){t.flags&=32767,pn=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{En=6,pn=null;return}}else if(t=RL(t,e,ji),t!==null){pn=t;return}if(e=e.sibling,e!==null){pn=e;return}pn=e=n}while(e!==null);En===0&&(En=5)}function xa(n,e,t){var i=Pt,r=cr.transition;try{cr.transition=null,Pt=1,BL(n,e,t,i)}finally{cr.transition=r,Pt=i}return null}function BL(n,e,t,i){do Bl();while(Mo!==null);if(_t&6)throw Error(fe(327));t=n.finishedWork;var r=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(fe(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(vD(n,s),n===Ln&&(pn=Ln=null,zn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Wf||(Wf=!0,MM(Qd,function(){return Bl(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=cr.transition,cr.transition=null;var o=Pt;Pt=1;var a=_t;_t|=4,Cv.current=null,DL(n,t),hM(t,n),rL(O_),sf=!!F_,O_=F_=null,n.current=t,LL(t),uD(),_t=a,Pt=o,cr.transition=s}else n.current=t;if(Wf&&(Wf=!1,Mo=n,$f=r),s=n.pendingLanes,s===0&&(wo=null),dD(t.stateNode),Mi(n,un()),e!==null)for(i=n.onRecoverableError,t=0;t<e.length;t++)r=e[t],i(r.value,{componentStack:r.stack,digest:r.digest});if(Hf)throw Hf=!1,n=Pv,Pv=null,n;return $f&1&&n.tag!==0&&Bl(),s=n.pendingLanes,s&1?n===Dv?eh++:(eh=0,Dv=n):eh=0,xo(),null}function Bl(){if(Mo!==null){var n=ub($f),e=cr.transition,t=Pt;try{if(cr.transition=null,Pt=16>n?16:n,Mo===null)var i=!1;else{if(n=Mo,Mo=null,$f=0,_t&6)throw Error(fe(331));var r=_t;for(_t|=4,Ae=n.current;Ae!==null;){var s=Ae,o=s.child;if(Ae.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(Ae=u;Ae!==null;){var c=Ae;switch(c.tag){case 0:case 11:case 15:Qc(8,c,s)}var h=c.child;if(h!==null)h.return=c,Ae=h;else for(;Ae!==null;){c=Ae;var d=c.sibling,f=c.return;if(oM(c),c===u){Ae=null;break}if(d!==null){d.return=f,Ae=d;break}Ae=f}}}var m=s.alternate;if(m!==null){var _=m.child;if(_!==null){m.child=null;do{var g=_.sibling;_.sibling=null,_=g}while(_!==null)}}Ae=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,Ae=o;else e:for(;Ae!==null;){if(s=Ae,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Qc(9,s,s.return)}var p=s.sibling;if(p!==null){p.return=s.return,Ae=p;break e}Ae=s.return}}var v=n.current;for(Ae=v;Ae!==null;){o=Ae;var y=o.child;if(o.subtreeFlags&2064&&y!==null)y.return=o,Ae=y;else e:for(o=v;Ae!==null;){if(a=Ae,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:zf(9,a)}}catch(T){sn(a,a.return,T)}if(a===o){Ae=null;break e}var x=a.sibling;if(x!==null){x.return=a.return,Ae=x;break e}Ae=a.return}}if(_t=r,xo(),qr&&typeof qr.onPostCommitFiberRoot=="function")try{qr.onPostCommitFiberRoot(Zd,n)}catch{}i=!0}return i}finally{Pt=t,cr.transition=e}}return!1}function TM(n,e,t){e=Il(t,e),e=zw(n,e,1),n=To(n,e,1),e=li(),n!==null&&(wc(n,1,e),Mi(n,e))}function sn(n,e,t){if(n.tag===3)TM(n,n,t);else for(;e!==null;){if(e.tag===3){TM(e,n,t);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(wo===null||!wo.has(i))){n=Il(t,n),n=Gw(e,n,1),e=To(e,n,1),n=li(),e!==null&&(wc(e,1,n),Mi(e,n));break}}e=e.return}}function kL(n,e,t){var i=n.pingCache;i!==null&&i.delete(e),e=li(),n.pingedLanes|=n.suspendedLanes&t,Ln===n&&(zn&t)===t&&(En===4||En===3&&(zn&130023424)===zn&&500>un()-Nv?ya(n,0):Rv|=t),Mi(n,e)}function bM(n,e){e===0&&(n.mode&1?(e=ef,ef<<=1,!(ef&130023424)&&(ef=4194304)):e=1);var t=li();n=ws(n,e),n!==null&&(wc(n,e,t),Mi(n,t))}function zL(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),bM(n,t)}function GL(n,e){var t=0;switch(n.tag){case 13:var i=n.stateNode,r=n.memoizedState;r!==null&&(t=r.retryLane);break;case 19:i=n.stateNode;break;default:throw Error(fe(314))}i!==null&&i.delete(e),bM(n,t)}var wM;wM=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Si.current)bi=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return bi=!1,CL(n,e,t);bi=!!(n.flags&131072)}else bi=!1,Wt&&e.flags&1048576&&iw(e,bf,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Bf(n,e),n=e.pendingProps;var r=El(e,jn.current);Dl(e,t),r=av(null,e,i,n,r,t);var s=lv();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ti(i)?(s=!0,xf(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,ev(e),r.updater=Ff,e.stateNode=r,r._reactInternals=e,pv(e,i,n,t),e=vv(null,e,i,!0,s,t)):(e.tag=0,Wt&&s&&W_(e),ai(null,e,r,t),e=e.child),e;case 16:i=e.elementType;e:{switch(Bf(n,e),n=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=HL(i),n=Er(i,n),r){case 0:e=_v(null,e,i,n,t);break e;case 1:e=Kw(null,e,i,n,t);break e;case 11:e=$w(null,e,i,n,t);break e;case 14:e=jw(null,e,i,Er(i.type,n),t);break e}throw Error(fe(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Er(i,r),_v(n,e,i,r,t);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Er(i,r),Kw(n,e,i,r,t);case 3:e:{if(Qw(e),n===null)throw Error(fe(387));i=e.pendingProps,s=e.memoizedState,r=s.element,dw(n,e),Rf(e,i,null,t);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Il(Error(fe(423)),e),e=Zw(n,e,i,t,r);break e}else if(i!==r){r=Il(Error(fe(424)),e),e=Zw(n,e,i,t,r);break e}else for($i=_o(e.stateNode.containerInfo.firstChild),Wi=e,Wt=!0,Mr=null,t=cw(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Rl(),i===r){e=Es(n,e,t);break e}ai(n,e,i,t)}e=e.child}return e;case 5:return mw(e),n===null&&X_(e),i=e.type,r=e.pendingProps,s=n!==null?n.memoizedProps:null,o=r.children,B_(i,r)?o=null:s!==null&&B_(i,s)&&(e.flags|=32),Yw(n,e),ai(n,e,o,t),e.child;case 6:return n===null&&X_(e),null;case 13:return Jw(n,e,t);case 4:return tv(e,e.stateNode.containerInfo),i=e.pendingProps,n===null?e.child=Nl(e,null,i,t):ai(n,e,i,t),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Er(i,r),$w(n,e,i,r,t);case 7:return ai(n,e,e.pendingProps,t),e.child;case 8:return ai(n,e,e.pendingProps.children,t),e.child;case 12:return ai(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,Ft(Ef,i._currentValue),i._currentValue=o,s!==null)if(wr(s.value,o)){if(s.children===r.children&&!Si.current){e=Es(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=Ms(-1,t&-t),l.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}s.lanes|=t,l=s.alternate,l!==null&&(l.lanes|=t),Z_(s.return,t,e),a.lanes|=t;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(fe(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),Z_(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}ai(n,e,r.children,t),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,Dl(e,t),r=lr(r),i=i(r),e.flags|=1,ai(n,e,i,t),e.child;case 14:return i=e.type,r=Er(i,e.pendingProps),r=Er(i.type,r),jw(n,e,i,r,t);case 15:return Xw(n,e,e.type,e.pendingProps,t);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Er(i,r),Bf(n,e),e.tag=1,Ti(i)?(n=!0,xf(e)):n=!1,Dl(e,t),Bw(e,i,r),pv(e,i,r,t),vv(null,e,i,!0,n,t);case 19:return tM(n,e,t);case 22:return qw(n,e,t)}throw Error(fe(156,e.tag))};function MM(n,e){return rb(n,e)}function VL(n,e,t,i){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function hr(n,e,t,i){return new VL(n,e,t,i)}function Bv(n){return n=n.prototype,!(!n||!n.isReactComponent)}function HL(n){if(typeof n=="function")return Bv(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Wg)return 11;if(n===Xg)return 14}return 2}function Co(n,e){var t=n.alternate;return t===null?(t=hr(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Yf(n,e,t,i,r,s){var o=2;if(i=n,typeof n=="function")Bv(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case fl:return Sa(t.children,r,s,e);case Vg:o=8,r|=8;break;case Hg:return n=hr(12,t,e,r|2),n.elementType=Hg,n.lanes=s,n;case $g:return n=hr(13,t,e,r),n.elementType=$g,n.lanes=s,n;case jg:return n=hr(19,t,e,r),n.elementType=jg,n.lanes=s,n;case IT:return Kf(t,r,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case DT:o=10;break e;case LT:o=9;break e;case Wg:o=11;break e;case Xg:o=14;break e;case lo:o=16,i=null;break e}throw Error(fe(130,n==null?n:typeof n,""))}return e=hr(o,t,e,r),e.elementType=n,e.type=i,e.lanes=s,e}function Sa(n,e,t,i){return n=hr(7,n,i,e),n.lanes=t,n}function Kf(n,e,t,i){return n=hr(22,n,i,e),n.elementType=IT,n.lanes=t,n.stateNode={isHidden:!1},n}function kv(n,e,t){return n=hr(6,n,null,e),n.lanes=t,n}function zv(n,e,t){return e=hr(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function WL(n,e,t,i,r){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=f_(0),this.expirationTimes=f_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=f_(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Gv(n,e,t,i,r,s,o,a,l){return n=new WL(n,e,t,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=hr(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:i,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},ev(s),n}function $L(n,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:dl,key:i==null?null:""+i,children:n,containerInfo:e,implementation:t}}function EM(n){if(!n)return yo;n=n._reactInternals;e:{if(ua(n)!==n||n.tag!==1)throw Error(fe(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ti(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(fe(171))}if(n.tag===1){var t=n.type;if(Ti(t))return ew(n,t,e)}return e}function AM(n,e,t,i,r,s,o,a,l){return n=Gv(t,i,!0,n,r,s,o,a,l),n.context=EM(null),t=n.current,i=li(),r=Eo(t),s=Ms(i,r),s.callback=e??null,To(t,s,r),n.current.lanes=r,wc(n,r,i),Mi(n,i),n}function Qf(n,e,t,i){var r=e.current,s=li(),o=Eo(r);return t=EM(t),e.context===null?e.context=t:e.pendingContext=t,e=Ms(s,o),e.payload={element:n},i=i===void 0?null:i,i!==null&&(e.callback=i),n=To(r,e,o),n!==null&&(Rr(n,r,o,s),Cf(n,r,o)),o}function Zf(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function CM(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function Vv(n,e){CM(n,e),(n=n.alternate)&&CM(n,e)}var RM=typeof reportError=="function"?reportError:function(n){console.error(n)};function Hv(n){this._internalRoot=n}Jf.prototype.render=Hv.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(fe(409));Qf(n,e,null,null)},Jf.prototype.unmount=Hv.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;va(function(){Qf(null,n,null,null)}),e[xs]=null}};function Jf(n){this._internalRoot=n}Jf.prototype.unstable_scheduleHydration=function(n){if(n){var e=db();n={blockedOn:null,target:n,priority:e};for(var t=0;t<po.length&&e!==0&&e<po[t].priority;t++);po.splice(t,0,n),t===0&&mb(n)}};function Wv(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function ep(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function NM(){}function jL(n,e,t,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var u=Zf(o);s.call(u)}}var o=AM(e,i,n,0,null,!1,!1,"",NM);return n._reactRootContainer=o,n[xs]=o.current,Bc(n.nodeType===8?n.parentNode:n),va(),o}for(;r=n.lastChild;)n.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var u=Zf(l);a.call(u)}}var l=Gv(n,0,!1,null,null,!1,!1,"",NM);return n._reactRootContainer=l,n[xs]=l.current,Bc(n.nodeType===8?n.parentNode:n),va(function(){Qf(e,l,t,i)}),l}function tp(n,e,t,i,r){var s=t._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var l=Zf(o);a.call(l)}}Qf(e,o,n,r)}else o=jL(t,e,n,r,i);return Zf(o)}cb=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=bc(e.pendingLanes);t!==0&&(p_(e,t|1),Mi(e,un()),!(_t&6)&&(Ol=un()+500,xo()))}break;case 13:va(function(){var i=ws(n,1);if(i!==null){var r=li();Rr(i,n,1,r)}}),Vv(n,1)}},m_=function(n){if(n.tag===13){var e=ws(n,134217728);if(e!==null){var t=li();Rr(e,n,134217728,t)}Vv(n,134217728)}},hb=function(n){if(n.tag===13){var e=Eo(n),t=ws(n,e);if(t!==null){var i=li();Rr(t,n,e,i)}Vv(n,e)}},db=function(){return Pt},fb=function(n,e){var t=Pt;try{return Pt=n,e()}finally{Pt=t}},a_=function(n,e,t){switch(e){case"input":if(Jg(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==n&&i.form===n.form){var r=vf(i);if(!r)throw Error(fe(90));OT(i),Jg(i,r)}}}break;case"textarea":VT(n,t);break;case"select":e=t.value,e!=null&&pl(n,!!t.multiple,e,!1)}},QT=Uv,ZT=va;var XL={usingClientEntryPoint:!1,Events:[Gc,wl,vf,YT,KT,Uv]},th={findFiberByHostInstance:ca,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},qL={bundleType:th.bundleType,version:th.version,rendererPackageName:th.rendererPackageName,rendererConfig:th.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ys.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=nb(n),n===null?null:n.stateNode},findFiberByHostInstance:th.findFiberByHostInstance,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var np=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!np.isDisabled&&np.supportsFiber)try{Zd=np.inject(qL),qr=np}catch{}}Gi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=XL,Gi.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Wv(e))throw Error(fe(200));return $L(n,e,null,t)},Gi.createRoot=function(n,e){if(!Wv(n))throw Error(fe(299));var t=!1,i="",r=RM;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Gv(n,1,!1,null,null,t,!1,i,r),n[xs]=e.current,Bc(n.nodeType===8?n.parentNode:n),new Hv(e)},Gi.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(fe(188)):(n=Object.keys(n).join(","),Error(fe(268,n)));return n=nb(e),n=n===null?null:n.stateNode,n},Gi.flushSync=function(n){return va(n)},Gi.hydrate=function(n,e,t){if(!ep(e))throw Error(fe(200));return tp(null,n,e,!0,t)},Gi.hydrateRoot=function(n,e,t){if(!Wv(n))throw Error(fe(405));var i=t!=null&&t.hydratedSources||null,r=!1,s="",o=RM;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=AM(e,null,n,1,t??null,r,!1,s,o),n[xs]=e.current,Bc(n),i)for(n=0;n<i.length;n++)t=i[n],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new Jf(e)},Gi.render=function(n,e,t){if(!ep(e))throw Error(fe(200));return tp(null,n,e,!1,t)},Gi.unmountComponentAtNode=function(n){if(!ep(n))throw Error(fe(40));return n._reactRootContainer?(va(function(){tp(null,null,n,!1,function(){n._reactRootContainer=null,n[xs]=null})}),!0):!1},Gi.unstable_batchedUpdates=Uv,Gi.unstable_renderSubtreeIntoContainer=function(n,e,t,i){if(!ep(t))throw Error(fe(200));if(n==null||n._reactInternals===void 0)throw Error(fe(38));return tp(n,e,t,!1,i)},Gi.version="18.3.1-next-f1338f8080-20240426";function PM(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(PM)}catch(n){console.error(n)}}PM(),ET.exports=Gi;var YL=ET.exports,DM,LM=YL;DM=LM.createRoot,LM.hydrateRoot;/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const kl="172",In={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Cs={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},IM=0,$v=1,UM=2,KL=0,jv=1,QL=2,Xi=3,Nr=0,$t=1,ui=2,Ei=0,dr=1,zl=2,Gl=3,Vl=4,Xv=5,qi=100,qv=101,Yv=102,FM=103,OM=104,Kv=200,Qv=201,Zv=202,Jv=203,nh=204,ih=205,ey=206,ty=207,ny=208,iy=209,ry=210,ZL=211,JL=212,eI=213,tI=214,rh=0,sh=1,oh=2,Ro=3,ah=4,lh=5,uh=6,ch=7,hh=0,BM=1,kM=2,Ai=0,zM=1,GM=2,VM=3,HM=4,nI=5,WM=6,$M=7,sy=300,fr=301,pr=302,No=303,Po=304,Ta=306,ba=1e3,Jr=1001,wa=1002,zt=1003,ip=1004,es=1005,mn=1006,Hl=1007,ci=1008,Kn=1009,Ma=1010,Ea=1011,Pr=1012,Un=1013,en=1014,cn=1015,hi=1016,rp=1017,sp=1018,ts=1020,op=35902,oy=1021,dh=1022,Gn=1023,ay=1024,ly=1025,ns=1026,is=1027,fh=1028,Wl=1029,Aa=1030,$l=1031,iI=1032,jl=1033,Ca=33776,Do=33777,Lo=33778,Io=33779,ph=35840,mh=35841,gh=35842,_h=35843,vh=36196,Xl=37492,ql=37496,Yl=37808,Kl=37809,Ql=37810,Zl=37811,Jl=37812,eu=37813,tu=37814,nu=37815,iu=37816,ru=37817,su=37818,ou=37819,au=37820,lu=37821,Ra=36492,uy=36494,cy=36495,hy=36283,yh=36284,xh=36285,Sh=36286,rI=3200,sI=3201,Rs=0,jM=1,Yi="",Be="srgb",mr="srgb-linear",ap="linear",Et="srgb",oI=0,Na=7680,aI=7681,lI=7682,uI=7683,cI=34055,hI=34056,dI=5386,fI=512,pI=513,mI=514,gI=515,_I=516,vI=517,yI=518,dy=519,fy=512,lp=513,py=514,up=515,my=516,gy=517,_y=518,vy=519,cp=35044,uu=35048,XM="300 es",Ci=2e3,Uo=2001;class Ns{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const Qn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let qM=1234567;const Th=Math.PI/180,cu=180/Math.PI;function Ps(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Qn[n&255]+Qn[n>>8&255]+Qn[n>>16&255]+Qn[n>>24&255]+"-"+Qn[e&255]+Qn[e>>8&255]+"-"+Qn[e>>16&15|64]+Qn[e>>24&255]+"-"+Qn[t&63|128]+Qn[t>>8&255]+"-"+Qn[t>>16&255]+Qn[t>>24&255]+Qn[i&255]+Qn[i>>8&255]+Qn[i>>16&255]+Qn[i>>24&255]).toLowerCase()}function nt(n,e,t){return Math.max(e,Math.min(t,n))}function yy(n,e){return(n%e+e)%e}function xI(n,e,t,i,r){return i+(n-e)*(r-i)/(t-e)}function SI(n,e,t){return n!==e?(t-n)/(e-n):0}function bh(n,e,t){return(1-t)*n+t*e}function TI(n,e,t,i){return bh(n,e,1-Math.exp(-t*i))}function bI(n,e=1){return e-Math.abs(yy(n,e*2)-e)}function wI(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function MI(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function EI(n,e){return n+Math.floor(Math.random()*(e-n+1))}function AI(n,e){return n+Math.random()*(e-n)}function CI(n){return n*(.5-Math.random())}function RI(n){n!==void 0&&(qM=n);let e=qM+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function NI(n){return n*Th}function PI(n){return n*cu}function DI(n){return(n&n-1)===0&&n!==0}function LI(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function II(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function UI(n,e,t,i,r){const s=Math.cos,o=Math.sin,a=s(t/2),l=o(t/2),u=s((e+i)/2),c=o((e+i)/2),h=s((e-i)/2),d=o((e-i)/2),f=s((i-e)/2),m=o((i-e)/2);switch(r){case"XYX":n.set(a*c,l*h,l*d,a*u);break;case"YZY":n.set(l*d,a*c,l*h,a*u);break;case"ZXZ":n.set(l*h,l*d,a*c,a*u);break;case"XZX":n.set(a*c,l*m,l*f,a*u);break;case"YXY":n.set(l*f,a*c,l*m,a*u);break;case"ZYZ":n.set(l*m,l*f,a*c,a*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function di(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function it(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const hp={DEG2RAD:Th,RAD2DEG:cu,generateUUID:Ps,clamp:nt,euclideanModulo:yy,mapLinear:xI,inverseLerp:SI,lerp:bh,damp:TI,pingpong:bI,smoothstep:wI,smootherstep:MI,randInt:EI,randFloat:AI,randFloatSpread:CI,seededRandom:RI,degToRad:NI,radToDeg:PI,isPowerOfTwo:DI,ceilPowerOfTwo:LI,floorPowerOfTwo:II,setQuaternionFromProperEuler:UI,normalize:it,denormalize:di};class ce{constructor(e=0,t=0){ce.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=nt(this.x,e.x,t.x),this.y=nt(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=nt(this.x,e,t),this.y=nt(this.y,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(nt(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(nt(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*i-o*r+e.x,this.y=s*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class je{constructor(e,t,i,r,s,o,a,l,u){je.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,r,s,o,a,l,u)}set(e,t,i,r,s,o,a,l,u){const c=this.elements;return c[0]=e,c[1]=r,c[2]=a,c[3]=t,c[4]=s,c[5]=l,c[6]=i,c[7]=o,c[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[3],l=i[6],u=i[1],c=i[4],h=i[7],d=i[2],f=i[5],m=i[8],_=r[0],g=r[3],p=r[6],v=r[1],y=r[4],x=r[7],T=r[2],S=r[5],w=r[8];return s[0]=o*_+a*v+l*T,s[3]=o*g+a*y+l*S,s[6]=o*p+a*x+l*w,s[1]=u*_+c*v+h*T,s[4]=u*g+c*y+h*S,s[7]=u*p+c*x+h*w,s[2]=d*_+f*v+m*T,s[5]=d*g+f*y+m*S,s[8]=d*p+f*x+m*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8];return t*o*c-t*a*u-i*s*c+i*a*l+r*s*u-r*o*l}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=c*o-a*u,d=a*l-c*s,f=u*s-o*l,m=t*h+i*d+r*f;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const _=1/m;return e[0]=h*_,e[1]=(r*u-c*i)*_,e[2]=(a*i-r*o)*_,e[3]=d*_,e[4]=(c*t-r*l)*_,e[5]=(r*s-a*t)*_,e[6]=f*_,e[7]=(i*l-u*t)*_,e[8]=(o*t-i*s)*_,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,o,a){const l=Math.cos(s),u=Math.sin(s);return this.set(i*l,i*u,-i*(l*o+u*a)+o+e,-r*u,r*l,-r*(-u*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(xy.makeScale(e,t)),this}rotate(e){return this.premultiply(xy.makeRotation(-e)),this}translate(e,t){return this.premultiply(xy.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const xy=new je;function YM(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function wh(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function KM(){const n=wh("canvas");return n.style.display="block",n}const QM={};function Pa(n){n in QM||(QM[n]=!0,console.warn(n))}function FI(n,e,t){return new Promise(function(i,r){function s(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:r();break;case n.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:i()}}setTimeout(s,t)})}function OI(n){const e=n.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function BI(n){const e=n.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const ZM=new je().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),JM=new je().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function kI(){const n={enabled:!0,workingColorSpace:mr,spaces:{},convert:function(r,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===Et&&(r.r=Ds(r.r),r.g=Ds(r.g),r.b=Ds(r.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(r.applyMatrix3(this.spaces[s].toXYZ),r.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===Et&&(r.r=hu(r.r),r.g=hu(r.g),r.b=hu(r.b))),r},fromWorkingColorSpace:function(r,s){return this.convert(r,this.workingColorSpace,s)},toWorkingColorSpace:function(r,s){return this.convert(r,s,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===Yi?ap:this.spaces[r].transfer},getLuminanceCoefficients:function(r,s=this.workingColorSpace){return r.fromArray(this.spaces[s].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,s,o){return r.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],i=[.3127,.329];return n.define({[mr]:{primaries:e,whitePoint:i,transfer:ap,toXYZ:ZM,fromXYZ:JM,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Be},outputColorSpaceConfig:{drawingBufferColorSpace:Be}},[Be]:{primaries:e,whitePoint:i,transfer:Et,toXYZ:ZM,fromXYZ:JM,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Be}}}),n}const st=kI();function Ds(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function hu(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let du;class zI{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{du===void 0&&(du=wh("canvas")),du.width=e.width,du.height=e.height;const i=du.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=du}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=wh("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=Ds(s[o]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Ds(t[i]/255)*255):t[i]=Ds(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let GI=0;class eE{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:GI++}),this.uuid=Ps(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(Sy(r[o].image)):s.push(Sy(r[o]))}else s=Sy(r);i.url=s}return t||(e.images[this.uuid]=i),i}}function Sy(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?zI.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let VI=0;class gn extends Ns{constructor(e=gn.DEFAULT_IMAGE,t=gn.DEFAULT_MAPPING,i=Jr,r=Jr,s=mn,o=ci,a=Gn,l=Kn,u=gn.DEFAULT_ANISOTROPY,c=Yi){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:VI++}),this.uuid=Ps(),this.name="",this.source=new eE(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=u,this.format=a,this.internalFormat=null,this.type=l,this.offset=new ce(0,0),this.repeat=new ce(1,1),this.center=new ce(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new je,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==sy)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ba:e.x=e.x-Math.floor(e.x);break;case Jr:e.x=e.x<0?0:1;break;case wa:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case ba:e.y=e.y-Math.floor(e.y);break;case Jr:e.y=e.y<0?0:1;break;case wa:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}gn.DEFAULT_IMAGE=null,gn.DEFAULT_MAPPING=sy,gn.DEFAULT_ANISOTROPY=1;class et{constructor(e=0,t=0,i=0,r=1){et.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s;const l=e.elements,u=l[0],c=l[4],h=l[8],d=l[1],f=l[5],m=l[9],_=l[2],g=l[6],p=l[10];if(Math.abs(c-d)<.01&&Math.abs(h-_)<.01&&Math.abs(m-g)<.01){if(Math.abs(c+d)<.1&&Math.abs(h+_)<.1&&Math.abs(m+g)<.1&&Math.abs(u+f+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const y=(u+1)/2,x=(f+1)/2,T=(p+1)/2,S=(c+d)/4,w=(h+_)/4,E=(m+g)/4;return y>x&&y>T?y<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(y),r=S/i,s=w/i):x>T?x<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(x),i=S/r,s=E/r):T<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(T),i=w/s,r=E/s),this.set(i,r,s,t),this}let v=Math.sqrt((g-m)*(g-m)+(h-_)*(h-_)+(d-c)*(d-c));return Math.abs(v)<.001&&(v=1),this.x=(g-m)/v,this.y=(h-_)/v,this.z=(d-c)/v,this.w=Math.acos((u+f+p-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=nt(this.x,e.x,t.x),this.y=nt(this.y,e.y,t.y),this.z=nt(this.z,e.z,t.z),this.w=nt(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=nt(this.x,e,t),this.y=nt(this.y,e,t),this.z=nt(this.z,e,t),this.w=nt(this.w,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(nt(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class fu extends Ns{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new et(0,0,e,t),this.scissorTest=!1,this.viewport=new et(0,0,e,t);const r={width:e,height:t,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:mn,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const s=new gn(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);s.flipY=!1,s.generateMipmaps=i.generateMipmaps,s.internalFormat=i.internalFormat,this.textures=[];const o=i.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,r=e.textures.length;i<r;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0,this.textures[i].renderTarget=this;const t=Object.assign({},e.texture.image);return this.texture.source=new eE(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Fo extends fu{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class Ty extends gn{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=zt,this.minFilter=zt,this.wrapR=Jr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class HI extends gn{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=zt,this.minFilter=zt,this.wrapR=Jr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Dr{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,o,a){let l=i[r+0],u=i[r+1],c=i[r+2],h=i[r+3];const d=s[o+0],f=s[o+1],m=s[o+2],_=s[o+3];if(a===0){e[t+0]=l,e[t+1]=u,e[t+2]=c,e[t+3]=h;return}if(a===1){e[t+0]=d,e[t+1]=f,e[t+2]=m,e[t+3]=_;return}if(h!==_||l!==d||u!==f||c!==m){let g=1-a;const p=l*d+u*f+c*m+h*_,v=p>=0?1:-1,y=1-p*p;if(y>Number.EPSILON){const T=Math.sqrt(y),S=Math.atan2(T,p*v);g=Math.sin(g*S)/T,a=Math.sin(a*S)/T}const x=a*v;if(l=l*g+d*x,u=u*g+f*x,c=c*g+m*x,h=h*g+_*x,g===1-a){const T=1/Math.sqrt(l*l+u*u+c*c+h*h);l*=T,u*=T,c*=T,h*=T}}e[t]=l,e[t+1]=u,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,r,s,o){const a=i[r],l=i[r+1],u=i[r+2],c=i[r+3],h=s[o],d=s[o+1],f=s[o+2],m=s[o+3];return e[t]=a*m+c*h+l*f-u*d,e[t+1]=l*m+c*d+u*h-a*f,e[t+2]=u*m+c*f+a*d-l*h,e[t+3]=c*m-a*h-l*d-u*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,u=a(i/2),c=a(r/2),h=a(s/2),d=l(i/2),f=l(r/2),m=l(s/2);switch(o){case"XYZ":this._x=d*c*h+u*f*m,this._y=u*f*h-d*c*m,this._z=u*c*m+d*f*h,this._w=u*c*h-d*f*m;break;case"YXZ":this._x=d*c*h+u*f*m,this._y=u*f*h-d*c*m,this._z=u*c*m-d*f*h,this._w=u*c*h+d*f*m;break;case"ZXY":this._x=d*c*h-u*f*m,this._y=u*f*h+d*c*m,this._z=u*c*m+d*f*h,this._w=u*c*h-d*f*m;break;case"ZYX":this._x=d*c*h-u*f*m,this._y=u*f*h+d*c*m,this._z=u*c*m-d*f*h,this._w=u*c*h+d*f*m;break;case"YZX":this._x=d*c*h+u*f*m,this._y=u*f*h+d*c*m,this._z=u*c*m-d*f*h,this._w=u*c*h-d*f*m;break;case"XZY":this._x=d*c*h-u*f*m,this._y=u*f*h-d*c*m,this._z=u*c*m+d*f*h,this._w=u*c*h+d*f*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=t[8],o=t[1],a=t[5],l=t[9],u=t[2],c=t[6],h=t[10],d=i+a+h;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(c-l)*f,this._y=(s-u)*f,this._z=(o-r)*f}else if(i>a&&i>h){const f=2*Math.sqrt(1+i-a-h);this._w=(c-l)/f,this._x=.25*f,this._y=(r+o)/f,this._z=(s+u)/f}else if(a>h){const f=2*Math.sqrt(1+a-i-h);this._w=(s-u)/f,this._x=(r+o)/f,this._y=.25*f,this._z=(l+c)/f}else{const f=2*Math.sqrt(1+h-i-a);this._w=(o-r)/f,this._x=(s+u)/f,this._y=(l+c)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(nt(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,s=e._z,o=e._w,a=t._x,l=t._y,u=t._z,c=t._w;return this._x=i*c+o*a+r*u-s*l,this._y=r*c+o*l+s*a-i*u,this._z=s*c+o*u+i*l-r*a,this._w=o*c-i*a-r*l-s*u,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+i*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const f=1-t;return this._w=f*o+t*this._w,this._x=f*i+t*this._x,this._y=f*r+t*this._y,this._z=f*s+t*this._z,this.normalize(),this}const u=Math.sqrt(l),c=Math.atan2(u,a),h=Math.sin((1-t)*c)/u,d=Math.sin(t*c)/u;return this._w=o*h+this._w*d,this._x=i*h+this._x*d,this._y=r*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class N{constructor(e=0,t=0,i=0){N.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(tE.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(tE.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,u=2*(o*r-a*i),c=2*(a*t-s*r),h=2*(s*i-o*t);return this.x=t+l*u+o*h-a*c,this.y=i+l*c+a*u-s*h,this.z=r+l*h+s*c-o*u,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=nt(this.x,e.x,t.x),this.y=nt(this.y,e.y,t.y),this.z=nt(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=nt(this.x,e,t),this.y=nt(this.y,e,t),this.z=nt(this.z,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(nt(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=r*l-s*a,this.y=s*o-i*l,this.z=i*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return by.copy(this).projectOnVector(e),this.sub(by)}reflect(e){return this.sub(by.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(nt(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const by=new N,tE=new Dr;class Da{constructor(e=new N(1/0,1/0,1/0),t=new N(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(Lr.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(Lr.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Lr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const s=i.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,Lr):Lr.fromBufferAttribute(s,o),Lr.applyMatrix4(e.matrixWorld),this.expandByPoint(Lr);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),dp.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),dp.copy(i.boundingBox)),dp.applyMatrix4(e.matrixWorld),this.union(dp)}const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Lr),Lr.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Mh),fp.subVectors(this.max,Mh),pu.subVectors(e.a,Mh),mu.subVectors(e.b,Mh),gu.subVectors(e.c,Mh),Oo.subVectors(mu,pu),Bo.subVectors(gu,mu),La.subVectors(pu,gu);let t=[0,-Oo.z,Oo.y,0,-Bo.z,Bo.y,0,-La.z,La.y,Oo.z,0,-Oo.x,Bo.z,0,-Bo.x,La.z,0,-La.x,-Oo.y,Oo.x,0,-Bo.y,Bo.x,0,-La.y,La.x,0];return!wy(t,pu,mu,gu,fp)||(t=[1,0,0,0,1,0,0,0,1],!wy(t,pu,mu,gu,fp))?!1:(pp.crossVectors(Oo,Bo),t=[pp.x,pp.y,pp.z],wy(t,pu,mu,gu,fp))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Lr).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Lr).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Ls[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ls[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ls[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ls[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ls[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ls[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ls[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ls[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ls),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Ls=[new N,new N,new N,new N,new N,new N,new N,new N],Lr=new N,dp=new Da,pu=new N,mu=new N,gu=new N,Oo=new N,Bo=new N,La=new N,Mh=new N,fp=new N,pp=new N,Ia=new N;function wy(n,e,t,i,r){for(let s=0,o=n.length-3;s<=o;s+=3){Ia.fromArray(n,s);const a=r.x*Math.abs(Ia.x)+r.y*Math.abs(Ia.y)+r.z*Math.abs(Ia.z),l=e.dot(Ia),u=t.dot(Ia),c=i.dot(Ia);if(Math.max(-Math.max(l,u,c),Math.min(l,u,c))>a)return!1}return!0}const WI=new Da,Eh=new N,My=new N;class mp{constructor(e=new N,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):WI.setFromPoints(e).getCenter(i);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Eh.subVectors(e,this.center);const t=Eh.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(Eh,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(My.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Eh.copy(e.center).add(My)),this.expandByPoint(Eh.copy(e.center).sub(My))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Is=new N,Ey=new N,gp=new N,ko=new N,Ay=new N,_p=new N,Cy=new N;class vp{constructor(e=new N,t=new N(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Is)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Is.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Is.copy(this.origin).addScaledVector(this.direction,t),Is.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){Ey.copy(e).add(t).multiplyScalar(.5),gp.copy(t).sub(e).normalize(),ko.copy(this.origin).sub(Ey);const s=e.distanceTo(t)*.5,o=-this.direction.dot(gp),a=ko.dot(this.direction),l=-ko.dot(gp),u=ko.lengthSq(),c=Math.abs(1-o*o);let h,d,f,m;if(c>0)if(h=o*l-a,d=o*a-l,m=s*c,h>=0)if(d>=-m)if(d<=m){const _=1/c;h*=_,d*=_,f=h*(h+o*d+2*a)+d*(o*h+d+2*l)+u}else d=s,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*l)+u;else d=-s,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*l)+u;else d<=-m?(h=Math.max(0,-(-o*s+a)),d=h>0?-s:Math.min(Math.max(-s,-l),s),f=-h*h+d*(d+2*l)+u):d<=m?(h=0,d=Math.min(Math.max(-s,-l),s),f=d*(d+2*l)+u):(h=Math.max(0,-(o*s+a)),d=h>0?s:Math.min(Math.max(-s,-l),s),f=-h*h+d*(d+2*l)+u);else d=o>0?-s:s,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*l)+u;return i&&i.copy(this.origin).addScaledVector(this.direction,h),r&&r.copy(Ey).addScaledVector(gp,d),f}intersectSphere(e,t){Is.subVectors(e.center,this.origin);const i=Is.dot(this.direction),r=Is.dot(Is)-i*i,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,o,a,l;const u=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,d=this.origin;return u>=0?(i=(e.min.x-d.x)*u,r=(e.max.x-d.x)*u):(i=(e.max.x-d.x)*u,r=(e.min.x-d.x)*u),c>=0?(s=(e.min.y-d.y)*c,o=(e.max.y-d.y)*c):(s=(e.max.y-d.y)*c,o=(e.min.y-d.y)*c),i>o||s>r||((s>i||isNaN(i))&&(i=s),(o<r||isNaN(r))&&(r=o),h>=0?(a=(e.min.z-d.z)*h,l=(e.max.z-d.z)*h):(a=(e.max.z-d.z)*h,l=(e.min.z-d.z)*h),i>l||a>r)||((a>i||i!==i)&&(i=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,Is)!==null}intersectTriangle(e,t,i,r,s){Ay.subVectors(t,e),_p.subVectors(i,e),Cy.crossVectors(Ay,_p);let o=this.direction.dot(Cy),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;ko.subVectors(this.origin,e);const l=a*this.direction.dot(_p.crossVectors(ko,_p));if(l<0)return null;const u=a*this.direction.dot(Ay.cross(ko));if(u<0||l+u>o)return null;const c=-a*ko.dot(Cy);return c<0?null:this.at(c/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class pt{constructor(e,t,i,r,s,o,a,l,u,c,h,d,f,m,_,g){pt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,r,s,o,a,l,u,c,h,d,f,m,_,g)}set(e,t,i,r,s,o,a,l,u,c,h,d,f,m,_,g){const p=this.elements;return p[0]=e,p[4]=t,p[8]=i,p[12]=r,p[1]=s,p[5]=o,p[9]=a,p[13]=l,p[2]=u,p[6]=c,p[10]=h,p[14]=d,p[3]=f,p[7]=m,p[11]=_,p[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new pt().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/_u.setFromMatrixColumn(e,0).length(),s=1/_u.setFromMatrixColumn(e,1).length(),o=1/_u.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,s=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(r),u=Math.sin(r),c=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const d=o*c,f=o*h,m=a*c,_=a*h;t[0]=l*c,t[4]=-l*h,t[8]=u,t[1]=f+m*u,t[5]=d-_*u,t[9]=-a*l,t[2]=_-d*u,t[6]=m+f*u,t[10]=o*l}else if(e.order==="YXZ"){const d=l*c,f=l*h,m=u*c,_=u*h;t[0]=d+_*a,t[4]=m*a-f,t[8]=o*u,t[1]=o*h,t[5]=o*c,t[9]=-a,t[2]=f*a-m,t[6]=_+d*a,t[10]=o*l}else if(e.order==="ZXY"){const d=l*c,f=l*h,m=u*c,_=u*h;t[0]=d-_*a,t[4]=-o*h,t[8]=m+f*a,t[1]=f+m*a,t[5]=o*c,t[9]=_-d*a,t[2]=-o*u,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const d=o*c,f=o*h,m=a*c,_=a*h;t[0]=l*c,t[4]=m*u-f,t[8]=d*u+_,t[1]=l*h,t[5]=_*u+d,t[9]=f*u-m,t[2]=-u,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const d=o*l,f=o*u,m=a*l,_=a*u;t[0]=l*c,t[4]=_-d*h,t[8]=m*h+f,t[1]=h,t[5]=o*c,t[9]=-a*c,t[2]=-u*c,t[6]=f*h+m,t[10]=d-_*h}else if(e.order==="XZY"){const d=o*l,f=o*u,m=a*l,_=a*u;t[0]=l*c,t[4]=-h,t[8]=u*c,t[1]=d*h+_,t[5]=o*c,t[9]=f*h-m,t[2]=m*h-f,t[6]=a*c,t[10]=_*h+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose($I,e,jI)}lookAt(e,t,i){const r=this.elements;return Ki.subVectors(e,t),Ki.lengthSq()===0&&(Ki.z=1),Ki.normalize(),zo.crossVectors(i,Ki),zo.lengthSq()===0&&(Math.abs(i.z)===1?Ki.x+=1e-4:Ki.z+=1e-4,Ki.normalize(),zo.crossVectors(i,Ki)),zo.normalize(),yp.crossVectors(Ki,zo),r[0]=zo.x,r[4]=yp.x,r[8]=Ki.x,r[1]=zo.y,r[5]=yp.y,r[9]=Ki.y,r[2]=zo.z,r[6]=yp.z,r[10]=Ki.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[4],l=i[8],u=i[12],c=i[1],h=i[5],d=i[9],f=i[13],m=i[2],_=i[6],g=i[10],p=i[14],v=i[3],y=i[7],x=i[11],T=i[15],S=r[0],w=r[4],E=r[8],M=r[12],b=r[1],R=r[5],I=r[9],B=r[13],D=r[2],L=r[6],z=r[10],ie=r[14],k=r[3],Z=r[7],W=r[11],K=r[15];return s[0]=o*S+a*b+l*D+u*k,s[4]=o*w+a*R+l*L+u*Z,s[8]=o*E+a*I+l*z+u*W,s[12]=o*M+a*B+l*ie+u*K,s[1]=c*S+h*b+d*D+f*k,s[5]=c*w+h*R+d*L+f*Z,s[9]=c*E+h*I+d*z+f*W,s[13]=c*M+h*B+d*ie+f*K,s[2]=m*S+_*b+g*D+p*k,s[6]=m*w+_*R+g*L+p*Z,s[10]=m*E+_*I+g*z+p*W,s[14]=m*M+_*B+g*ie+p*K,s[3]=v*S+y*b+x*D+T*k,s[7]=v*w+y*R+x*L+T*Z,s[11]=v*E+y*I+x*z+T*W,s[15]=v*M+y*B+x*ie+T*K,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],u=e[13],c=e[2],h=e[6],d=e[10],f=e[14],m=e[3],_=e[7],g=e[11],p=e[15];return m*(+s*l*h-r*u*h-s*a*d+i*u*d+r*a*f-i*l*f)+_*(+t*l*f-t*u*d+s*o*d-r*o*f+r*u*c-s*l*c)+g*(+t*u*h-t*a*f-s*o*h+i*o*f+s*a*c-i*u*c)+p*(-r*a*c-t*l*h+t*a*d+r*o*h-i*o*d+i*l*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],m=e[12],_=e[13],g=e[14],p=e[15],v=h*g*u-_*d*u+_*l*f-a*g*f-h*l*p+a*d*p,y=m*d*u-c*g*u-m*l*f+o*g*f+c*l*p-o*d*p,x=c*_*u-m*h*u+m*a*f-o*_*f-c*a*p+o*h*p,T=m*h*l-c*_*l-m*a*d+o*_*d+c*a*g-o*h*g,S=t*v+i*y+r*x+s*T;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/S;return e[0]=v*w,e[1]=(_*d*s-h*g*s-_*r*f+i*g*f+h*r*p-i*d*p)*w,e[2]=(a*g*s-_*l*s+_*r*u-i*g*u-a*r*p+i*l*p)*w,e[3]=(h*l*s-a*d*s-h*r*u+i*d*u+a*r*f-i*l*f)*w,e[4]=y*w,e[5]=(c*g*s-m*d*s+m*r*f-t*g*f-c*r*p+t*d*p)*w,e[6]=(m*l*s-o*g*s-m*r*u+t*g*u+o*r*p-t*l*p)*w,e[7]=(o*d*s-c*l*s+c*r*u-t*d*u-o*r*f+t*l*f)*w,e[8]=x*w,e[9]=(m*h*s-c*_*s-m*i*f+t*_*f+c*i*p-t*h*p)*w,e[10]=(o*_*s-m*a*s+m*i*u-t*_*u-o*i*p+t*a*p)*w,e[11]=(c*a*s-o*h*s-c*i*u+t*h*u+o*i*f-t*a*f)*w,e[12]=T*w,e[13]=(c*_*r-m*h*r+m*i*d-t*_*d-c*i*g+t*h*g)*w,e[14]=(m*a*r-o*_*r-m*i*l+t*_*l+o*i*g-t*a*g)*w,e[15]=(o*h*r-c*a*r+c*i*l-t*h*l-o*i*d+t*a*d)*w,this}scale(e){const t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),s=1-i,o=e.x,a=e.y,l=e.z,u=s*o,c=s*a;return this.set(u*o+i,u*a-r*l,u*l+r*a,0,u*a+r*l,c*a+i,c*l-r*o,0,u*l-r*a,c*l+r*o,s*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,o){return this.set(1,i,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,u=s+s,c=o+o,h=a+a,d=s*u,f=s*c,m=s*h,_=o*c,g=o*h,p=a*h,v=l*u,y=l*c,x=l*h,T=i.x,S=i.y,w=i.z;return r[0]=(1-(_+p))*T,r[1]=(f+x)*T,r[2]=(m-y)*T,r[3]=0,r[4]=(f-x)*S,r[5]=(1-(d+p))*S,r[6]=(g+v)*S,r[7]=0,r[8]=(m+y)*w,r[9]=(g-v)*w,r[10]=(1-(d+_))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let s=_u.set(r[0],r[1],r[2]).length();const o=_u.set(r[4],r[5],r[6]).length(),a=_u.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],Ir.copy(this);const u=1/s,c=1/o,h=1/a;return Ir.elements[0]*=u,Ir.elements[1]*=u,Ir.elements[2]*=u,Ir.elements[4]*=c,Ir.elements[5]*=c,Ir.elements[6]*=c,Ir.elements[8]*=h,Ir.elements[9]*=h,Ir.elements[10]*=h,t.setFromRotationMatrix(Ir),i.x=s,i.y=o,i.z=a,this}makePerspective(e,t,i,r,s,o,a=Ci){const l=this.elements,u=2*s/(t-e),c=2*s/(i-r),h=(t+e)/(t-e),d=(i+r)/(i-r);let f,m;if(a===Ci)f=-(o+s)/(o-s),m=-2*o*s/(o-s);else if(a===Uo)f=-o/(o-s),m=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=u,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=c,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=m,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,r,s,o,a=Ci){const l=this.elements,u=1/(t-e),c=1/(i-r),h=1/(o-s),d=(t+e)*u,f=(i+r)*c;let m,_;if(a===Ci)m=(o+s)*h,_=-2*h;else if(a===Uo)m=s*h,_=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*u,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*c,l[9]=0,l[13]=-f,l[2]=0,l[6]=0,l[10]=_,l[14]=-m,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const _u=new N,Ir=new pt,$I=new N(0,0,0),jI=new N(1,1,1),zo=new N,yp=new N,Ki=new N,nE=new pt,iE=new Dr;class Qi{constructor(e=0,t=0,i=0,r=Qi.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],l=r[1],u=r[5],c=r[9],h=r[2],d=r[6],f=r[10];switch(t){case"XYZ":this._y=Math.asin(nt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,f),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(d,u),this._z=0);break;case"YXZ":this._x=Math.asin(-nt(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(nt(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-nt(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,u));break;case"YZX":this._z=Math.asin(nt(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-nt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,u),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-c,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return nE.makeRotationFromQuaternion(e),this.setFromRotationMatrix(nE,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return iE.setFromEuler(this),this.setFromQuaternion(iE,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Qi.DEFAULT_ORDER="XYZ";class Ry{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let XI=0;const rE=new N,vu=new Dr,Us=new pt,xp=new N,Ah=new N,qI=new N,YI=new Dr,sE=new N(1,0,0),oE=new N(0,1,0),aE=new N(0,0,1),lE={type:"added"},KI={type:"removed"},yu={type:"childadded",child:null},Ny={type:"childremoved",child:null};class hn extends Ns{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:XI++}),this.uuid=Ps(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=hn.DEFAULT_UP.clone();const e=new N,t=new Qi,i=new Dr,r=new N(1,1,1);function s(){i.setFromEuler(t,!1)}function o(){t.setFromQuaternion(i,void 0,!1)}t._onChange(s),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new pt},normalMatrix:{value:new je}}),this.matrix=new pt,this.matrixWorld=new pt,this.matrixAutoUpdate=hn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=hn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Ry,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return vu.setFromAxisAngle(e,t),this.quaternion.multiply(vu),this}rotateOnWorldAxis(e,t){return vu.setFromAxisAngle(e,t),this.quaternion.premultiply(vu),this}rotateX(e){return this.rotateOnAxis(sE,e)}rotateY(e){return this.rotateOnAxis(oE,e)}rotateZ(e){return this.rotateOnAxis(aE,e)}translateOnAxis(e,t){return rE.copy(e).applyQuaternion(this.quaternion),this.position.add(rE.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(sE,e)}translateY(e){return this.translateOnAxis(oE,e)}translateZ(e){return this.translateOnAxis(aE,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Us.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?xp.copy(e):xp.set(e,t,i);const r=this.parent;this.updateWorldMatrix(!0,!1),Ah.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Us.lookAt(Ah,xp,this.up):Us.lookAt(xp,Ah,this.up),this.quaternion.setFromRotationMatrix(Us),r&&(Us.extractRotation(r.matrixWorld),vu.setFromRotationMatrix(Us),this.quaternion.premultiply(vu.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(lE),yu.child=e,this.dispatchEvent(yu),yu.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(KI),Ny.child=e,this.dispatchEvent(Ny),Ny.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Us.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Us.multiply(e.parent.matrixWorld)),e.applyMatrix4(Us),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(lE),yu.child=e,this.dispatchEvent(yu),yu.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ah,e,qI),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ah,YI,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let u=0,c=l.length;u<c;u++){const h=l[u];s(e.shapes,h)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,u=this.material.length;l<u;l++)a.push(s(e.materials,this.material[l]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];r.animations.push(s(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),u=o(e.textures),c=o(e.images),h=o(e.shapes),d=o(e.skeletons),f=o(e.animations),m=o(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),u.length>0&&(i.textures=u),c.length>0&&(i.images=c),h.length>0&&(i.shapes=h),d.length>0&&(i.skeletons=d),f.length>0&&(i.animations=f),m.length>0&&(i.nodes=m)}return i.object=r,i;function o(a){const l=[];for(const u in a){const c=a[u];delete c.metadata,l.push(c)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}}hn.DEFAULT_UP=new N(0,1,0),hn.DEFAULT_MATRIX_AUTO_UPDATE=!0,hn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Ur=new N,Fs=new N,Py=new N,Os=new N,xu=new N,Su=new N,uE=new N,Dy=new N,Ly=new N,Iy=new N,Uy=new et,Fy=new et,Oy=new et;class gr{constructor(e=new N,t=new N,i=new N){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),Ur.subVectors(e,t),r.cross(Ur);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){Ur.subVectors(r,t),Fs.subVectors(i,t),Py.subVectors(e,t);const o=Ur.dot(Ur),a=Ur.dot(Fs),l=Ur.dot(Py),u=Fs.dot(Fs),c=Fs.dot(Py),h=o*u-a*a;if(h===0)return s.set(0,0,0),null;const d=1/h,f=(u*l-a*c)*d,m=(o*c-a*l)*d;return s.set(1-f-m,m,f)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,Os)===null?!1:Os.x>=0&&Os.y>=0&&Os.x+Os.y<=1}static getInterpolation(e,t,i,r,s,o,a,l){return this.getBarycoord(e,t,i,r,Os)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,Os.x),l.addScaledVector(o,Os.y),l.addScaledVector(a,Os.z),l)}static getInterpolatedAttribute(e,t,i,r,s,o){return Uy.setScalar(0),Fy.setScalar(0),Oy.setScalar(0),Uy.fromBufferAttribute(e,t),Fy.fromBufferAttribute(e,i),Oy.fromBufferAttribute(e,r),o.setScalar(0),o.addScaledVector(Uy,s.x),o.addScaledVector(Fy,s.y),o.addScaledVector(Oy,s.z),o}static isFrontFacing(e,t,i,r){return Ur.subVectors(i,t),Fs.subVectors(e,t),Ur.cross(Fs).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Ur.subVectors(this.c,this.b),Fs.subVectors(this.a,this.b),Ur.cross(Fs).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return gr.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return gr.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,r,s){return gr.getInterpolation(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return gr.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return gr.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,s=this.c;let o,a;xu.subVectors(r,i),Su.subVectors(s,i),Dy.subVectors(e,i);const l=xu.dot(Dy),u=Su.dot(Dy);if(l<=0&&u<=0)return t.copy(i);Ly.subVectors(e,r);const c=xu.dot(Ly),h=Su.dot(Ly);if(c>=0&&h<=c)return t.copy(r);const d=l*h-c*u;if(d<=0&&l>=0&&c<=0)return o=l/(l-c),t.copy(i).addScaledVector(xu,o);Iy.subVectors(e,s);const f=xu.dot(Iy),m=Su.dot(Iy);if(m>=0&&f<=m)return t.copy(s);const _=f*u-l*m;if(_<=0&&u>=0&&m<=0)return a=u/(u-m),t.copy(i).addScaledVector(Su,a);const g=c*m-f*h;if(g<=0&&h-c>=0&&f-m>=0)return uE.subVectors(s,r),a=(h-c)/(h-c+(f-m)),t.copy(r).addScaledVector(uE,a);const p=1/(g+_+d);return o=_*p,a=d*p,t.copy(i).addScaledVector(xu,o).addScaledVector(Su,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const cE={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Go={h:0,s:0,l:0},Sp={h:0,s:0,l:0};function By(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}let Ue=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Be){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,st.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=st.workingColorSpace){return this.r=e,this.g=t,this.b=i,st.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=st.workingColorSpace){if(e=yy(e,1),t=nt(t,0,1),i=nt(i,0,1),t===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,o=2*i-s;this.r=By(o,s,e+1/3),this.g=By(o,s,e),this.b=By(o,s,e-1/3)}return st.toWorkingColorSpace(this,r),this}setStyle(e,t=Be){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Be){const i=cE[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ds(e.r),this.g=Ds(e.g),this.b=Ds(e.b),this}copyLinearToSRGB(e){return this.r=hu(e.r),this.g=hu(e.g),this.b=hu(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Be){return st.fromWorkingColorSpace(Zn.copy(this),e),Math.round(nt(Zn.r*255,0,255))*65536+Math.round(nt(Zn.g*255,0,255))*256+Math.round(nt(Zn.b*255,0,255))}getHexString(e=Be){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=st.workingColorSpace){st.fromWorkingColorSpace(Zn.copy(this),t);const i=Zn.r,r=Zn.g,s=Zn.b,o=Math.max(i,r,s),a=Math.min(i,r,s);let l,u;const c=(a+o)/2;if(a===o)l=0,u=0;else{const h=o-a;switch(u=c<=.5?h/(o+a):h/(2-o-a),o){case i:l=(r-s)/h+(r<s?6:0);break;case r:l=(s-i)/h+2;break;case s:l=(i-r)/h+4;break}l/=6}return e.h=l,e.s=u,e.l=c,e}getRGB(e,t=st.workingColorSpace){return st.fromWorkingColorSpace(Zn.copy(this),t),e.r=Zn.r,e.g=Zn.g,e.b=Zn.b,e}getStyle(e=Be){st.fromWorkingColorSpace(Zn.copy(this),e);const t=Zn.r,i=Zn.g,r=Zn.b;return e!==Be?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(r*255)})`}offsetHSL(e,t,i){return this.getHSL(Go),this.setHSL(Go.h+e,Go.s+t,Go.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Go),e.getHSL(Sp);const i=bh(Go.h,Sp.h,t),r=bh(Go.s,Sp.s,t),s=bh(Go.l,Sp.l,t);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*i+s[6]*r,this.g=s[1]*t+s[4]*i+s[7]*r,this.b=s[2]*t+s[5]*i+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const Zn=new Ue;Ue.NAMES=cE;let QI=0;class Jn extends Ns{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:QI++}),this.uuid=Ps(),this.name="",this.type="Material",this.blending=dr,this.side=Nr,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=nh,this.blendDst=ih,this.blendEquation=qi,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Ue(0,0,0),this.blendAlpha=0,this.depthFunc=Ro,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=dy,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Na,this.stencilZFail=Na,this.stencilZPass=Na,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==dr&&(i.blending=this.blending),this.side!==Nr&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==nh&&(i.blendSrc=this.blendSrc),this.blendDst!==ih&&(i.blendDst=this.blendDst),this.blendEquation!==qi&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==Ro&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==dy&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Na&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Na&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Na&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(t){const s=r(e.textures),o=r(e.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Ch extends Jn{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ue(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Qi,this.combine=hh,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Bs=ZI();function ZI(){const n=new ArrayBuffer(4),e=new Float32Array(n),t=new Uint32Array(n),i=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const u=l-127;u<-27?(i[l]=0,i[l|256]=32768,r[l]=24,r[l|256]=24):u<-14?(i[l]=1024>>-u-14,i[l|256]=1024>>-u-14|32768,r[l]=-u-1,r[l|256]=-u-1):u<=15?(i[l]=u+15<<10,i[l|256]=u+15<<10|32768,r[l]=13,r[l|256]=13):u<128?(i[l]=31744,i[l|256]=64512,r[l]=24,r[l|256]=24):(i[l]=31744,i[l|256]=64512,r[l]=13,r[l|256]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let u=l<<13,c=0;for(;!(u&8388608);)u<<=1,c-=8388608;u&=-8388609,c+=947912704,s[l]=u|c}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:e,uint32View:t,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:a}}function Zi(n){Math.abs(n)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=nt(n,-65504,65504),Bs.floatView[0]=n;const e=Bs.uint32View[0],t=e>>23&511;return Bs.baseTable[t]+((e&8388607)>>Bs.shiftTable[t])}function Tp(n){const e=n>>10;return Bs.uint32View[0]=Bs.mantissaTable[Bs.offsetTable[e]+(n&1023)]+Bs.exponentTable[e],Bs.floatView[0]}const _n=new N,bp=new ce;class Vn{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=cp,this.updateRanges=[],this.gpuType=cn,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)bp.fromBufferAttribute(this,t),bp.applyMatrix3(e),this.setXY(t,bp.x,bp.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)_n.fromBufferAttribute(this,t),_n.applyMatrix3(e),this.setXYZ(t,_n.x,_n.y,_n.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)_n.fromBufferAttribute(this,t),_n.applyMatrix4(e),this.setXYZ(t,_n.x,_n.y,_n.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)_n.fromBufferAttribute(this,t),_n.applyNormalMatrix(e),this.setXYZ(t,_n.x,_n.y,_n.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)_n.fromBufferAttribute(this,t),_n.transformDirection(e),this.setXYZ(t,_n.x,_n.y,_n.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=di(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=it(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=di(t,this.array)),t}setX(e,t){return this.normalized&&(t=it(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=di(t,this.array)),t}setY(e,t){return this.normalized&&(t=it(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=di(t,this.array)),t}setZ(e,t){return this.normalized&&(t=it(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=di(t,this.array)),t}setW(e,t){return this.normalized&&(t=it(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=it(t,this.array),i=it(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=it(t,this.array),i=it(i,this.array),r=it(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=it(t,this.array),i=it(i,this.array),r=it(r,this.array),s=it(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==cp&&(e.usage=this.usage),e}}class ky extends Vn{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class zy extends Vn{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class hE extends Vn{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}getX(e){let t=Tp(this.array[e*this.itemSize]);return this.normalized&&(t=di(t,this.array)),t}setX(e,t){return this.normalized&&(t=it(t,this.array)),this.array[e*this.itemSize]=Zi(t),this}getY(e){let t=Tp(this.array[e*this.itemSize+1]);return this.normalized&&(t=di(t,this.array)),t}setY(e,t){return this.normalized&&(t=it(t,this.array)),this.array[e*this.itemSize+1]=Zi(t),this}getZ(e){let t=Tp(this.array[e*this.itemSize+2]);return this.normalized&&(t=di(t,this.array)),t}setZ(e,t){return this.normalized&&(t=it(t,this.array)),this.array[e*this.itemSize+2]=Zi(t),this}getW(e){let t=Tp(this.array[e*this.itemSize+3]);return this.normalized&&(t=di(t,this.array)),t}setW(e,t){return this.normalized&&(t=it(t,this.array)),this.array[e*this.itemSize+3]=Zi(t),this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=it(t,this.array),i=it(i,this.array)),this.array[e+0]=Zi(t),this.array[e+1]=Zi(i),this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=it(t,this.array),i=it(i,this.array),r=it(r,this.array)),this.array[e+0]=Zi(t),this.array[e+1]=Zi(i),this.array[e+2]=Zi(r),this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=it(t,this.array),i=it(i,this.array),r=it(r,this.array),s=it(s,this.array)),this.array[e+0]=Zi(t),this.array[e+1]=Zi(i),this.array[e+2]=Zi(r),this.array[e+3]=Zi(s),this}}class dn extends Vn{constructor(e,t,i){super(new Float32Array(e),t,i)}}let JI=0;const _r=new pt,Gy=new hn,Tu=new N,Ji=new Da,Rh=new Da,Fn=new N;class ei extends Ns{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:JI++}),this.uuid=Ps(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(YM(e)?zy:ky)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new je().getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return _r.makeRotationFromQuaternion(e),this.applyMatrix4(_r),this}rotateX(e){return _r.makeRotationX(e),this.applyMatrix4(_r),this}rotateY(e){return _r.makeRotationY(e),this.applyMatrix4(_r),this}rotateZ(e){return _r.makeRotationZ(e),this.applyMatrix4(_r),this}translate(e,t,i){return _r.makeTranslation(e,t,i),this.applyMatrix4(_r),this}scale(e,t,i){return _r.makeScale(e,t,i),this.applyMatrix4(_r),this}lookAt(e){return Gy.lookAt(e),Gy.updateMatrix(),this.applyMatrix4(Gy.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Tu).negate(),this.translate(Tu.x,Tu.y,Tu.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const i=[];for(let r=0,s=e.length;r<s;r++){const o=e[r];i.push(o.x,o.y,o.z||0)}this.setAttribute("position",new dn(i,3))}else{const i=Math.min(e.length,t.count);for(let r=0;r<i;r++){const s=e[r];t.setXYZ(r,s.x,s.y,s.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Da);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new N(-1/0,-1/0,-1/0),new N(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){const s=t[i];Ji.setFromBufferAttribute(s),this.morphTargetsRelative?(Fn.addVectors(this.boundingBox.min,Ji.min),this.boundingBox.expandByPoint(Fn),Fn.addVectors(this.boundingBox.max,Ji.max),this.boundingBox.expandByPoint(Fn)):(this.boundingBox.expandByPoint(Ji.min),this.boundingBox.expandByPoint(Ji.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new mp);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new N,1/0);return}if(e){const i=this.boundingSphere.center;if(Ji.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];Rh.setFromBufferAttribute(a),this.morphTargetsRelative?(Fn.addVectors(Ji.min,Rh.min),Ji.expandByPoint(Fn),Fn.addVectors(Ji.max,Rh.max),Ji.expandByPoint(Fn)):(Ji.expandByPoint(Rh.min),Ji.expandByPoint(Rh.max))}Ji.getCenter(i);let r=0;for(let s=0,o=e.count;s<o;s++)Fn.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(Fn));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let u=0,c=a.count;u<c;u++)Fn.fromBufferAttribute(a,u),l&&(Tu.fromBufferAttribute(e,u),Fn.add(Tu)),r=Math.max(r,i.distanceToSquared(Fn))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,r=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Vn(new Float32Array(4*i.count),4));const o=this.getAttribute("tangent"),a=[],l=[];for(let E=0;E<i.count;E++)a[E]=new N,l[E]=new N;const u=new N,c=new N,h=new N,d=new ce,f=new ce,m=new ce,_=new N,g=new N;function p(E,M,b){u.fromBufferAttribute(i,E),c.fromBufferAttribute(i,M),h.fromBufferAttribute(i,b),d.fromBufferAttribute(s,E),f.fromBufferAttribute(s,M),m.fromBufferAttribute(s,b),c.sub(u),h.sub(u),f.sub(d),m.sub(d);const R=1/(f.x*m.y-m.x*f.y);isFinite(R)&&(_.copy(c).multiplyScalar(m.y).addScaledVector(h,-f.y).multiplyScalar(R),g.copy(h).multiplyScalar(f.x).addScaledVector(c,-m.x).multiplyScalar(R),a[E].add(_),a[M].add(_),a[b].add(_),l[E].add(g),l[M].add(g),l[b].add(g))}let v=this.groups;v.length===0&&(v=[{start:0,count:e.count}]);for(let E=0,M=v.length;E<M;++E){const b=v[E],R=b.start,I=b.count;for(let B=R,D=R+I;B<D;B+=3)p(e.getX(B+0),e.getX(B+1),e.getX(B+2))}const y=new N,x=new N,T=new N,S=new N;function w(E){T.fromBufferAttribute(r,E),S.copy(T);const M=a[E];y.copy(M),y.sub(T.multiplyScalar(T.dot(M))).normalize(),x.crossVectors(S,M);const R=x.dot(l[E])<0?-1:1;o.setXYZW(E,y.x,y.y,y.z,R)}for(let E=0,M=v.length;E<M;++E){const b=v[E],R=b.start,I=b.count;for(let B=R,D=R+I;B<D;B+=3)w(e.getX(B+0)),w(e.getX(B+1)),w(e.getX(B+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Vn(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let d=0,f=i.count;d<f;d++)i.setXYZ(d,0,0,0);const r=new N,s=new N,o=new N,a=new N,l=new N,u=new N,c=new N,h=new N;if(e)for(let d=0,f=e.count;d<f;d+=3){const m=e.getX(d+0),_=e.getX(d+1),g=e.getX(d+2);r.fromBufferAttribute(t,m),s.fromBufferAttribute(t,_),o.fromBufferAttribute(t,g),c.subVectors(o,s),h.subVectors(r,s),c.cross(h),a.fromBufferAttribute(i,m),l.fromBufferAttribute(i,_),u.fromBufferAttribute(i,g),a.add(c),l.add(c),u.add(c),i.setXYZ(m,a.x,a.y,a.z),i.setXYZ(_,l.x,l.y,l.z),i.setXYZ(g,u.x,u.y,u.z)}else for(let d=0,f=t.count;d<f;d+=3)r.fromBufferAttribute(t,d+0),s.fromBufferAttribute(t,d+1),o.fromBufferAttribute(t,d+2),c.subVectors(o,s),h.subVectors(r,s),c.cross(h),i.setXYZ(d+0,c.x,c.y,c.z),i.setXYZ(d+1,c.x,c.y,c.z),i.setXYZ(d+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Fn.fromBufferAttribute(e,t),Fn.normalize(),e.setXYZ(t,Fn.x,Fn.y,Fn.z)}toNonIndexed(){function e(a,l){const u=a.array,c=a.itemSize,h=a.normalized,d=new u.constructor(l.length*c);let f=0,m=0;for(let _=0,g=l.length;_<g;_++){a.isInterleavedBufferAttribute?f=l[_]*a.data.stride+a.offset:f=l[_]*c;for(let p=0;p<c;p++)d[m++]=u[f++]}return new Vn(d,c,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new ei,i=this.index.array,r=this.attributes;for(const a in r){const l=r[a],u=e(l,i);t.setAttribute(a,u)}const s=this.morphAttributes;for(const a in s){const l=[],u=s[a];for(let c=0,h=u.length;c<h;c++){const d=u[c],f=e(d,i);l.push(f)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const u=o[a];t.addGroup(u.start,u.count,u.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const u in l)l[u]!==void 0&&(e[u]=l[u]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const u=i[l];e.data.attributes[l]=u.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const u=this.morphAttributes[l],c=[];for(let h=0,d=u.length;h<d;h++){const f=u[h];c.push(f.toJSON(e.data))}c.length>0&&(r[l]=c,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const r=e.attributes;for(const u in r){const c=r[u];this.setAttribute(u,c.clone(t))}const s=e.morphAttributes;for(const u in s){const c=[],h=s[u];for(let d=0,f=h.length;d<f;d++)c.push(h[d].clone(t));this.morphAttributes[u]=c}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let u=0,c=o.length;u<c;u++){const h=o[u];this.addGroup(h.start,h.count,h.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const dE=new pt,Ua=new vp,wp=new mp,fE=new N,Mp=new N,Ep=new N,Ap=new N,Vy=new N,Cp=new N,pE=new N,Rp=new N;class On extends hn{constructor(e=new ei,t=new Ch){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const i=this.geometry,r=i.attributes.position,s=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(s&&a){Cp.set(0,0,0);for(let l=0,u=s.length;l<u;l++){const c=a[l],h=s[l];c!==0&&(Vy.fromBufferAttribute(h,e),o?Cp.addScaledVector(Vy,c):Cp.addScaledVector(Vy.sub(t),c))}t.add(Cp)}return t}raycast(e,t){const i=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),wp.copy(i.boundingSphere),wp.applyMatrix4(s),Ua.copy(e.ray).recast(e.near),!(wp.containsPoint(Ua.origin)===!1&&(Ua.intersectSphere(wp,fE)===null||Ua.origin.distanceToSquared(fE)>(e.far-e.near)**2))&&(dE.copy(s).invert(),Ua.copy(e.ray).applyMatrix4(dE),!(i.boundingBox!==null&&Ua.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,Ua)))}_computeIntersections(e,t,i){let r;const s=this.geometry,o=this.material,a=s.index,l=s.attributes.position,u=s.attributes.uv,c=s.attributes.uv1,h=s.attributes.normal,d=s.groups,f=s.drawRange;if(a!==null)if(Array.isArray(o))for(let m=0,_=d.length;m<_;m++){const g=d[m],p=o[g.materialIndex],v=Math.max(g.start,f.start),y=Math.min(a.count,Math.min(g.start+g.count,f.start+f.count));for(let x=v,T=y;x<T;x+=3){const S=a.getX(x),w=a.getX(x+1),E=a.getX(x+2);r=Np(this,p,e,i,u,c,h,S,w,E),r&&(r.faceIndex=Math.floor(x/3),r.face.materialIndex=g.materialIndex,t.push(r))}}else{const m=Math.max(0,f.start),_=Math.min(a.count,f.start+f.count);for(let g=m,p=_;g<p;g+=3){const v=a.getX(g),y=a.getX(g+1),x=a.getX(g+2);r=Np(this,o,e,i,u,c,h,v,y,x),r&&(r.faceIndex=Math.floor(g/3),t.push(r))}}else if(l!==void 0)if(Array.isArray(o))for(let m=0,_=d.length;m<_;m++){const g=d[m],p=o[g.materialIndex],v=Math.max(g.start,f.start),y=Math.min(l.count,Math.min(g.start+g.count,f.start+f.count));for(let x=v,T=y;x<T;x+=3){const S=x,w=x+1,E=x+2;r=Np(this,p,e,i,u,c,h,S,w,E),r&&(r.faceIndex=Math.floor(x/3),r.face.materialIndex=g.materialIndex,t.push(r))}}else{const m=Math.max(0,f.start),_=Math.min(l.count,f.start+f.count);for(let g=m,p=_;g<p;g+=3){const v=g,y=g+1,x=g+2;r=Np(this,o,e,i,u,c,h,v,y,x),r&&(r.faceIndex=Math.floor(g/3),t.push(r))}}}}function eU(n,e,t,i,r,s,o,a){let l;if(e.side===$t?l=i.intersectTriangle(o,s,r,!0,a):l=i.intersectTriangle(r,s,o,e.side===Nr,a),l===null)return null;Rp.copy(a),Rp.applyMatrix4(n.matrixWorld);const u=t.ray.origin.distanceTo(Rp);return u<t.near||u>t.far?null:{distance:u,point:Rp.clone(),object:n}}function Np(n,e,t,i,r,s,o,a,l,u){n.getVertexPosition(a,Mp),n.getVertexPosition(l,Ep),n.getVertexPosition(u,Ap);const c=eU(n,e,t,i,Mp,Ep,Ap,pE);if(c){const h=new N;gr.getBarycoord(pE,Mp,Ep,Ap,h),r&&(c.uv=gr.getInterpolatedAttribute(r,a,l,u,h,new ce)),s&&(c.uv1=gr.getInterpolatedAttribute(s,a,l,u,h,new ce)),o&&(c.normal=gr.getInterpolatedAttribute(o,a,l,u,h,new N),c.normal.dot(i.direction)>0&&c.normal.multiplyScalar(-1));const d={a,b:l,c:u,normal:new N,materialIndex:0};gr.getNormal(Mp,Ep,Ap,d.normal),c.face=d,c.barycoord=h}return c}class Fa extends ei{constructor(e=1,t=1,i=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],u=[],c=[],h=[];let d=0,f=0;m("z","y","x",-1,-1,i,t,e,o,s,0),m("z","y","x",1,-1,i,t,-e,o,s,1),m("x","z","y",1,1,e,i,t,r,o,2),m("x","z","y",1,-1,e,i,-t,r,o,3),m("x","y","z",1,-1,e,t,i,r,s,4),m("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(l),this.setAttribute("position",new dn(u,3)),this.setAttribute("normal",new dn(c,3)),this.setAttribute("uv",new dn(h,2));function m(_,g,p,v,y,x,T,S,w,E,M){const b=x/w,R=T/E,I=x/2,B=T/2,D=S/2,L=w+1,z=E+1;let ie=0,k=0;const Z=new N;for(let W=0;W<z;W++){const K=W*R-B;for(let he=0;he<L;he++){const Ie=he*b-I;Z[_]=Ie*v,Z[g]=K*y,Z[p]=D,u.push(Z.x,Z.y,Z.z),Z[_]=0,Z[g]=0,Z[p]=S>0?1:-1,c.push(Z.x,Z.y,Z.z),h.push(he/w),h.push(1-W/E),ie+=1}}for(let W=0;W<E;W++)for(let K=0;K<w;K++){const he=d+K+L*W,Ie=d+K+L*(W+1),O=d+(K+1)+L*(W+1),X=d+(K+1)+L*W;l.push(he,Ie,X),l.push(Ie,O,X),k+=6}a.addGroup(f,k,M),f+=k,d+=ie}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Fa(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function bu(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=r.clone():Array.isArray(r)?e[t][i]=r.slice():e[t][i]=r}}return e}function fi(n){const e={};for(let t=0;t<n.length;t++){const i=bu(n[t]);for(const r in i)e[r]=i[r]}return e}function tU(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function mE(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:st.workingColorSpace}const gE={clone:bu,merge:fi};var nU=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,iU=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class rs extends Jn{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=nU,this.fragmentShader=iU,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=bu(e.uniforms),this.uniformsGroups=tU(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class _E extends hn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new pt,this.projectionMatrix=new pt,this.projectionMatrixInverse=new pt,this.coordinateSystem=Ci}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Vo=new N,vE=new ce,yE=new ce;class pi extends _E{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=cu*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Th*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return cu*2*Math.atan(Math.tan(Th*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){Vo.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Vo.x,Vo.y).multiplyScalar(-e/Vo.z),Vo.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Vo.x,Vo.y).multiplyScalar(-e/Vo.z)}getViewSize(e,t){return this.getViewBounds(e,vE,yE),t.subVectors(yE,vE)}setViewOffset(e,t,i,r,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Th*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,u=o.fullHeight;s+=o.offsetX*r/l,t-=o.offsetY*i/u,r*=o.width/l,i*=o.height/u}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const wu=-90,Mu=1;class xE extends hn{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new pi(wu,Mu,e,t);r.layers=this.layers,this.add(r);const s=new pi(wu,Mu,e,t);s.layers=this.layers,this.add(s);const o=new pi(wu,Mu,e,t);o.layers=this.layers,this.add(o);const a=new pi(wu,Mu,e,t);a.layers=this.layers,this.add(a);const l=new pi(wu,Mu,e,t);l.layers=this.layers,this.add(l);const u=new pi(wu,Mu,e,t);u.layers=this.layers,this.add(u)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,r,s,o,a,l]=t;for(const u of t)this.remove(u);if(e===Ci)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===Uo)i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const u of t)this.add(u),u.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,l,u,c]=this.children,h=e.getRenderTarget(),d=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),m=e.xr.enabled;e.xr.enabled=!1;const _=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,r),e.render(t,s),e.setRenderTarget(i,1,r),e.render(t,o),e.setRenderTarget(i,2,r),e.render(t,a),e.setRenderTarget(i,3,r),e.render(t,l),e.setRenderTarget(i,4,r),e.render(t,u),i.texture.generateMipmaps=_,e.setRenderTarget(i,5,r),e.render(t,c),e.setRenderTarget(h,d,f),e.xr.enabled=m,i.texture.needsPMREMUpdate=!0}}class Pp extends gn{constructor(e,t,i,r,s,o,a,l,u,c){e=e!==void 0?e:[],t=t!==void 0?t:fr,super(e,t,i,r,s,o,a,l,u,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class SE extends Fo{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new Pp(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:mn}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new Fa(5,5,5),s=new rs({name:"CubemapFromEquirect",uniforms:bu(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:$t,blending:Ei});s.uniforms.tEquirect.value=t;const o=new On(r,s),a=t.minFilter;return t.minFilter===ci&&(t.minFilter=mn),new xE(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,r);e.setRenderTarget(s)}}class Hy extends hn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Qi,this.environmentIntensity=1,this.environmentRotation=new Qi,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class Wy{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=cp,this.updateRanges=[],this.version=0,this.uuid=Ps()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ps()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ps()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const mi=new N;class Nh{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)mi.fromBufferAttribute(this,t),mi.applyMatrix4(e),this.setXYZ(t,mi.x,mi.y,mi.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)mi.fromBufferAttribute(this,t),mi.applyNormalMatrix(e),this.setXYZ(t,mi.x,mi.y,mi.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)mi.fromBufferAttribute(this,t),mi.transformDirection(e),this.setXYZ(t,mi.x,mi.y,mi.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=di(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=it(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=it(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=it(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=it(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=it(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=di(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=di(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=di(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=di(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=it(t,this.array),i=it(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=it(t,this.array),i=it(i,this.array),r=it(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=it(t,this.array),i=it(i,this.array),r=it(r,this.array),s=it(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new Vn(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Nh(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class $y extends Jn{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Ue(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Eu;const Ph=new N,Au=new N,Cu=new N,Ru=new ce,Dh=new ce,TE=new pt,Dp=new N,Lh=new N,Lp=new N,bE=new ce,jy=new ce,wE=new ce;class rU extends hn{constructor(e=new $y){if(super(),this.isSprite=!0,this.type="Sprite",Eu===void 0){Eu=new ei;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new Wy(t,5);Eu.setIndex([0,1,2,0,2,3]),Eu.setAttribute("position",new Nh(i,3,0,!1)),Eu.setAttribute("uv",new Nh(i,2,3,!1))}this.geometry=Eu,this.material=e,this.center=new ce(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Au.setFromMatrixScale(this.matrixWorld),TE.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Cu.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Au.multiplyScalar(-Cu.z);const i=this.material.rotation;let r,s;i!==0&&(s=Math.cos(i),r=Math.sin(i));const o=this.center;Ip(Dp.set(-.5,-.5,0),Cu,o,Au,r,s),Ip(Lh.set(.5,-.5,0),Cu,o,Au,r,s),Ip(Lp.set(.5,.5,0),Cu,o,Au,r,s),bE.set(0,0),jy.set(1,0),wE.set(1,1);let a=e.ray.intersectTriangle(Dp,Lh,Lp,!1,Ph);if(a===null&&(Ip(Lh.set(-.5,.5,0),Cu,o,Au,r,s),jy.set(0,1),a=e.ray.intersectTriangle(Dp,Lp,Lh,!1,Ph),a===null))return;const l=e.ray.origin.distanceTo(Ph);l<e.near||l>e.far||t.push({distance:l,point:Ph.clone(),uv:gr.getInterpolation(Ph,Dp,Lh,Lp,bE,jy,wE,new ce),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function Ip(n,e,t,i,r,s){Ru.subVectors(n,t).addScalar(.5).multiply(i),r!==void 0?(Dh.x=s*Ru.x-r*Ru.y,Dh.y=r*Ru.x+s*Ru.y):Dh.copy(Ru),n.copy(e),n.x+=Dh.x,n.y+=Dh.y,n.applyMatrix4(TE)}class sU extends gn{constructor(e=null,t=1,i=1,r,s,o,a,l,u=zt,c=zt,h,d){super(null,o,a,l,u,c,r,s,h,d),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class oU extends Vn{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Xy=new N,aU=new N,lU=new je;class Fr{constructor(e=new N(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=Xy.subVectors(i,t).cross(aU.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(Xy),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||lU.getNormalMatrix(e),r=this.coplanarPoint(Xy).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Oa=new mp,Up=new N;class Fp{constructor(e=new Fr,t=new Fr,i=new Fr,r=new Fr,s=new Fr,o=new Fr){this.planes=[e,t,i,r,s,o]}set(e,t,i,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=Ci){const i=this.planes,r=e.elements,s=r[0],o=r[1],a=r[2],l=r[3],u=r[4],c=r[5],h=r[6],d=r[7],f=r[8],m=r[9],_=r[10],g=r[11],p=r[12],v=r[13],y=r[14],x=r[15];if(i[0].setComponents(l-s,d-u,g-f,x-p).normalize(),i[1].setComponents(l+s,d+u,g+f,x+p).normalize(),i[2].setComponents(l+o,d+c,g+m,x+v).normalize(),i[3].setComponents(l-o,d-c,g-m,x-v).normalize(),i[4].setComponents(l-a,d-h,g-_,x-y).normalize(),t===Ci)i[5].setComponents(l+a,d+h,g+_,x+y).normalize();else if(t===Uo)i[5].setComponents(a,h,_,y).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Oa.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Oa.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Oa)}intersectsSprite(e){return Oa.center.set(0,0,0),Oa.radius=.7071067811865476,Oa.applyMatrix4(e.matrixWorld),this.intersectsSphere(Oa)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(Up.x=r.normal.x>0?e.max.x:e.min.x,Up.y=r.normal.y>0?e.max.y:e.min.y,Up.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Up)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class Op extends Jn{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ue(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Bp=new N,kp=new N,ME=new pt,Ih=new vp,zp=new mp,qy=new N,EE=new N;class uU extends hn{constructor(e=new ei,t=new Op){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let r=1,s=t.count;r<s;r++)Bp.fromBufferAttribute(t,r-1),kp.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=Bp.distanceTo(kp);e.setAttribute("lineDistance",new dn(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),zp.copy(i.boundingSphere),zp.applyMatrix4(r),zp.radius+=s,e.ray.intersectsSphere(zp)===!1)return;ME.copy(r).invert(),Ih.copy(e.ray).applyMatrix4(ME);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,u=this.isLineSegments?2:1,c=i.index,d=i.attributes.position;if(c!==null){const f=Math.max(0,o.start),m=Math.min(c.count,o.start+o.count);for(let _=f,g=m-1;_<g;_+=u){const p=c.getX(_),v=c.getX(_+1),y=Gp(this,e,Ih,l,p,v);y&&t.push(y)}if(this.isLineLoop){const _=c.getX(m-1),g=c.getX(f),p=Gp(this,e,Ih,l,_,g);p&&t.push(p)}}else{const f=Math.max(0,o.start),m=Math.min(d.count,o.start+o.count);for(let _=f,g=m-1;_<g;_+=u){const p=Gp(this,e,Ih,l,_,_+1);p&&t.push(p)}if(this.isLineLoop){const _=Gp(this,e,Ih,l,m-1,f);_&&t.push(_)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function Gp(n,e,t,i,r,s){const o=n.geometry.attributes.position;if(Bp.fromBufferAttribute(o,r),kp.fromBufferAttribute(o,s),t.distanceSqToSegment(Bp,kp,qy,EE)>i)return;qy.applyMatrix4(n.matrixWorld);const l=e.ray.origin.distanceTo(qy);if(!(l<e.near||l>e.far))return{distance:l,point:EE.clone().applyMatrix4(n.matrixWorld),index:r,face:null,faceIndex:null,barycoord:null,object:n}}class cU extends Jn{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ue(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Nu=class extends hn{constructor(){super(),this.isGroup=!0,this.type="Group"}};class hU extends gn{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=zt,this.minFilter=zt,this.generateMipmaps=!1,this.needsUpdate=!0}}class dU extends gn{constructor(e,t,i,r,s,o,a,l,u){super(e,t,i,r,s,o,a,l,u),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Ho extends gn{constructor(e,t,i,r,s,o,a,l,u,c=ns){if(c!==ns&&c!==is)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&c===ns&&(i=en),i===void 0&&c===is&&(i=ts),super(null,r,s,o,a,l,c,i,u),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:zt,this.minFilter=l!==void 0?l:zt,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class ks{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,r=this.getPoint(0),s=0;t.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),s+=i.distanceTo(r),t.push(s),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let r=0;const s=i.length;let o;t?o=t:o=e*i[s-1];let a=0,l=s-1,u;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),u=i[r]-o,u<0)a=r+1;else if(u>0)l=r-1;else{l=r;break}if(r=l,i[r]===o)return r/(s-1);const c=i[r],d=i[r+1]-c,f=(o-c)/d;return(r+f)/(s-1)}getTangent(e,t){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const o=this.getPoint(r),a=this.getPoint(s),l=t||(o.isVector2?new ce:new N);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new N,r=[],s=[],o=[],a=new N,l=new pt;for(let f=0;f<=e;f++){const m=f/e;r[f]=this.getTangentAt(m,new N)}s[0]=new N,o[0]=new N;let u=Number.MAX_VALUE;const c=Math.abs(r[0].x),h=Math.abs(r[0].y),d=Math.abs(r[0].z);c<=u&&(u=c,i.set(1,0,0)),h<=u&&(u=h,i.set(0,1,0)),d<=u&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),s[0].crossVectors(r[0],a),o[0].crossVectors(r[0],s[0]);for(let f=1;f<=e;f++){if(s[f]=s[f-1].clone(),o[f]=o[f-1].clone(),a.crossVectors(r[f-1],r[f]),a.length()>Number.EPSILON){a.normalize();const m=Math.acos(nt(r[f-1].dot(r[f]),-1,1));s[f].applyMatrix4(l.makeRotationAxis(a,m))}o[f].crossVectors(r[f],s[f])}if(t===!0){let f=Math.acos(nt(s[0].dot(s[e]),-1,1));f/=e,r[0].dot(a.crossVectors(s[0],s[e]))>0&&(f=-f);for(let m=1;m<=e;m++)s[m].applyMatrix4(l.makeRotationAxis(r[m],f*m)),o[m].crossVectors(r[m],s[m])}return{tangents:r,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class AE extends ks{constructor(e=0,t=0,i=1,r=1,s=0,o=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,t=new ce){const i=t,r=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(o?s=0:s=r),this.aClockwise===!0&&!o&&(s===r?s=-r:s=s-r);const a=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(a),u=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const c=Math.cos(this.aRotation),h=Math.sin(this.aRotation),d=l-this.aX,f=u-this.aY;l=d*c-f*h+this.aX,u=d*h+f*c+this.aY}return i.set(l,u)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class fU extends AE{constructor(e,t,i,r,s,o){super(e,t,i,i,r,s,o),this.isArcCurve=!0,this.type="ArcCurve"}}function Yy(){let n=0,e=0,t=0,i=0;function r(s,o,a,l){n=s,e=a,t=-3*s+3*o-2*a-l,i=2*s-2*o+a+l}return{initCatmullRom:function(s,o,a,l,u){r(o,a,u*(a-s),u*(l-o))},initNonuniformCatmullRom:function(s,o,a,l,u,c,h){let d=(o-s)/u-(a-s)/(u+c)+(a-o)/c,f=(a-o)/c-(l-o)/(c+h)+(l-a)/h;d*=c,f*=c,r(o,a,d,f)},calc:function(s){const o=s*s,a=o*s;return n+e*s+t*o+i*a}}}const Vp=new N,Ky=new Yy,Qy=new Yy,Zy=new Yy;class pU extends ks{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new N){const i=t,r=this.points,s=r.length,o=(s-(this.closed?0:1))*e;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:l===0&&a===s-1&&(a=s-2,l=1);let u,c;this.closed||a>0?u=r[(a-1)%s]:(Vp.subVectors(r[0],r[1]).add(r[0]),u=Vp);const h=r[a%s],d=r[(a+1)%s];if(this.closed||a+2<s?c=r[(a+2)%s]:(Vp.subVectors(r[s-1],r[s-2]).add(r[s-1]),c=Vp),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let m=Math.pow(u.distanceToSquared(h),f),_=Math.pow(h.distanceToSquared(d),f),g=Math.pow(d.distanceToSquared(c),f);_<1e-4&&(_=1),m<1e-4&&(m=_),g<1e-4&&(g=_),Ky.initNonuniformCatmullRom(u.x,h.x,d.x,c.x,m,_,g),Qy.initNonuniformCatmullRom(u.y,h.y,d.y,c.y,m,_,g),Zy.initNonuniformCatmullRom(u.z,h.z,d.z,c.z,m,_,g)}else this.curveType==="catmullrom"&&(Ky.initCatmullRom(u.x,h.x,d.x,c.x,this.tension),Qy.initCatmullRom(u.y,h.y,d.y,c.y,this.tension),Zy.initCatmullRom(u.z,h.z,d.z,c.z,this.tension));return i.set(Ky.calc(l),Qy.calc(l),Zy.calc(l)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new N().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function CE(n,e,t,i,r){const s=(i-e)*.5,o=(r-t)*.5,a=n*n,l=n*a;return(2*t-2*i+s+o)*l+(-3*t+3*i-2*s-o)*a+s*n+t}function mU(n,e){const t=1-n;return t*t*e}function gU(n,e){return 2*(1-n)*n*e}function _U(n,e){return n*n*e}function Uh(n,e,t,i){return mU(n,e)+gU(n,t)+_U(n,i)}function vU(n,e){const t=1-n;return t*t*t*e}function yU(n,e){const t=1-n;return 3*t*t*n*e}function xU(n,e){return 3*(1-n)*n*n*e}function SU(n,e){return n*n*n*e}function Fh(n,e,t,i,r){return vU(n,e)+yU(n,t)+xU(n,i)+SU(n,r)}class TU extends ks{constructor(e=new ce,t=new ce,i=new ce,r=new ce){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new ce){const i=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return i.set(Fh(e,r.x,s.x,o.x,a.x),Fh(e,r.y,s.y,o.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class RE extends ks{constructor(e=new N,t=new N,i=new N,r=new N){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new N){const i=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return i.set(Fh(e,r.x,s.x,o.x,a.x),Fh(e,r.y,s.y,o.y,a.y),Fh(e,r.z,s.z,o.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class bU extends ks{constructor(e=new ce,t=new ce){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new ce){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ce){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class wU extends ks{constructor(e=new N,t=new N){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new N){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new N){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class MU extends ks{constructor(e=new ce,t=new ce,i=new ce){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new ce){const i=t,r=this.v0,s=this.v1,o=this.v2;return i.set(Uh(e,r.x,s.x,o.x),Uh(e,r.y,s.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Jy extends ks{constructor(e=new N,t=new N,i=new N){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new N){const i=t,r=this.v0,s=this.v1,o=this.v2;return i.set(Uh(e,r.x,s.x,o.x),Uh(e,r.y,s.y,o.y),Uh(e,r.z,s.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class EU extends ks{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new ce){const i=t,r=this.points,s=(r.length-1)*e,o=Math.floor(s),a=s-o,l=r[o===0?o:o-1],u=r[o],c=r[o>r.length-2?r.length-1:o+1],h=r[o>r.length-3?r.length-1:o+2];return i.set(CE(a,l.x,u.x,c.x,h.x),CE(a,l.y,u.y,c.y,h.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new ce().fromArray(r))}return this}}var AU=Object.freeze({__proto__:null,ArcCurve:fU,CatmullRomCurve3:pU,CubicBezierCurve:TU,CubicBezierCurve3:RE,EllipseCurve:AE,LineCurve:bU,LineCurve3:wU,QuadraticBezierCurve:MU,QuadraticBezierCurve3:Jy,SplineCurve:EU});class Hp extends ei{constructor(e=1,t=1,i=1,r=32,s=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l};const u=this;r=Math.floor(r),s=Math.floor(s);const c=[],h=[],d=[],f=[];let m=0;const _=[],g=i/2;let p=0;v(),o===!1&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(c),this.setAttribute("position",new dn(h,3)),this.setAttribute("normal",new dn(d,3)),this.setAttribute("uv",new dn(f,2));function v(){const x=new N,T=new N;let S=0;const w=(t-e)/i;for(let E=0;E<=s;E++){const M=[],b=E/s,R=b*(t-e)+e;for(let I=0;I<=r;I++){const B=I/r,D=B*l+a,L=Math.sin(D),z=Math.cos(D);T.x=R*L,T.y=-b*i+g,T.z=R*z,h.push(T.x,T.y,T.z),x.set(L,w,z).normalize(),d.push(x.x,x.y,x.z),f.push(B,1-b),M.push(m++)}_.push(M)}for(let E=0;E<r;E++)for(let M=0;M<s;M++){const b=_[M][E],R=_[M+1][E],I=_[M+1][E+1],B=_[M][E+1];(e>0||M!==0)&&(c.push(b,R,B),S+=3),(t>0||M!==s-1)&&(c.push(R,I,B),S+=3)}u.addGroup(p,S,0),p+=S}function y(x){const T=m,S=new ce,w=new N;let E=0;const M=x===!0?e:t,b=x===!0?1:-1;for(let I=1;I<=r;I++)h.push(0,g*b,0),d.push(0,b,0),f.push(.5,.5),m++;const R=m;for(let I=0;I<=r;I++){const D=I/r*l+a,L=Math.cos(D),z=Math.sin(D);w.x=M*z,w.y=g*b,w.z=M*L,h.push(w.x,w.y,w.z),d.push(0,b,0),S.x=L*.5+.5,S.y=z*.5*b+.5,f.push(S.x,S.y),m++}for(let I=0;I<r;I++){const B=T+I,D=R+I;x===!0?c.push(D,D+1,B):c.push(D+1,D,B),E+=3}u.addGroup(p,E,x===!0?1:2),p+=E}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Hp(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class e0 extends Hp{constructor(e=1,t=1,i=32,r=1,s=!1,o=0,a=Math.PI*2){super(0,e,t,i,r,s,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a}}static fromJSON(e){return new e0(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Wp extends ei{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(i),l=Math.floor(r),u=a+1,c=l+1,h=e/a,d=t/l,f=[],m=[],_=[],g=[];for(let p=0;p<c;p++){const v=p*d-o;for(let y=0;y<u;y++){const x=y*h-s;m.push(x,-v,0),_.push(0,0,1),g.push(y/a),g.push(1-p/l)}}for(let p=0;p<l;p++)for(let v=0;v<a;v++){const y=v+u*p,x=v+u*(p+1),T=v+1+u*(p+1),S=v+1+u*p;f.push(y,x,S),f.push(x,T,S)}this.setIndex(f),this.setAttribute("position",new dn(m,3)),this.setAttribute("normal",new dn(_,3)),this.setAttribute("uv",new dn(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Wp(e.width,e.height,e.widthSegments,e.heightSegments)}}class Oh extends ei{constructor(e=1,t=32,i=16,r=0,s=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:s,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const l=Math.min(o+a,Math.PI);let u=0;const c=[],h=new N,d=new N,f=[],m=[],_=[],g=[];for(let p=0;p<=i;p++){const v=[],y=p/i;let x=0;p===0&&o===0?x=.5/t:p===i&&l===Math.PI&&(x=-.5/t);for(let T=0;T<=t;T++){const S=T/t;h.x=-e*Math.cos(r+S*s)*Math.sin(o+y*a),h.y=e*Math.cos(o+y*a),h.z=e*Math.sin(r+S*s)*Math.sin(o+y*a),m.push(h.x,h.y,h.z),d.copy(h).normalize(),_.push(d.x,d.y,d.z),g.push(S+x,1-y),v.push(u++)}c.push(v)}for(let p=0;p<i;p++)for(let v=0;v<t;v++){const y=c[p][v+1],x=c[p][v],T=c[p+1][v],S=c[p+1][v+1];(p!==0||o>0)&&f.push(y,x,S),(p!==i-1||l<Math.PI)&&f.push(x,T,S)}this.setIndex(f),this.setAttribute("position",new dn(m,3)),this.setAttribute("normal",new dn(_,3)),this.setAttribute("uv",new dn(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Oh(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class t0 extends ei{constructor(e=new Jy(new N(-1,-1,0),new N(-1,1,0),new N(1,1,0)),t=64,i=1,r=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:s};const o=e.computeFrenetFrames(t,s);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new N,l=new N,u=new ce;let c=new N;const h=[],d=[],f=[],m=[];_(),this.setIndex(m),this.setAttribute("position",new dn(h,3)),this.setAttribute("normal",new dn(d,3)),this.setAttribute("uv",new dn(f,2));function _(){for(let y=0;y<t;y++)g(y);g(s===!1?t:0),v(),p()}function g(y){c=e.getPointAt(y/t,c);const x=o.normals[y],T=o.binormals[y];for(let S=0;S<=r;S++){const w=S/r*Math.PI*2,E=Math.sin(w),M=-Math.cos(w);l.x=M*x.x+E*T.x,l.y=M*x.y+E*T.y,l.z=M*x.z+E*T.z,l.normalize(),d.push(l.x,l.y,l.z),a.x=c.x+i*l.x,a.y=c.y+i*l.y,a.z=c.z+i*l.z,h.push(a.x,a.y,a.z)}}function p(){for(let y=1;y<=t;y++)for(let x=1;x<=r;x++){const T=(r+1)*(y-1)+(x-1),S=(r+1)*y+(x-1),w=(r+1)*y+x,E=(r+1)*(y-1)+x;m.push(T,S,E),m.push(S,w,E)}}function v(){for(let y=0;y<=t;y++)for(let x=0;x<=r;x++)u.x=y/t,u.y=x/r,f.push(u.x,u.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new t0(new AU[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class CU extends Jn{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Ue(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class NE extends Jn{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Ue(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ue(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Rs,this.normalScale=new ce(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Qi,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class RU extends NE{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ce(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return nt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Ue(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Ue(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ue(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class NU extends Jn{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ue(16777215),this.specular=new Ue(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ue(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Rs,this.normalScale=new ce(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Qi,this.combine=hh,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class PU extends Jn{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ue(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ue(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Rs,this.normalScale=new ce(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class DU extends Jn{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Rs,this.normalScale=new ce(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class PE extends Jn{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ue(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ue(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Rs,this.normalScale=new ce(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Qi,this.combine=hh,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class LU extends Jn{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=rI,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class IU extends Jn{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class UU extends Jn{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ue(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Rs,this.normalScale=new ce(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class FU extends Op{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}const DE={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class OU{constructor(e,t,i){const r=this;let s=!1,o=0,a=0,l;const u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(c){a++,s===!1&&r.onStart!==void 0&&r.onStart(c,o,a),s=!0},this.itemEnd=function(c){o++,r.onProgress!==void 0&&r.onProgress(c,o,a),o===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(c){r.onError!==void 0&&r.onError(c)},this.resolveURL=function(c){return l?l(c):c},this.setURLModifier=function(c){return l=c,this},this.addHandler=function(c,h){return u.push(c,h),this},this.removeHandler=function(c){const h=u.indexOf(c);return h!==-1&&u.splice(h,2),this},this.getHandler=function(c){for(let h=0,d=u.length;h<d;h+=2){const f=u[h],m=u[h+1];if(f.global&&(f.lastIndex=0),f.test(c))return m}return null}}}const BU=new OU;class n0{constructor(e){this.manager=e!==void 0?e:BU,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(r,s){i.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}n0.DEFAULT_MATERIAL_NAME="__DEFAULT";class kU extends n0{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=DE.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=wh("img");function l(){c(),DE.add(e,this),t&&t(this),s.manager.itemEnd(e)}function u(h){c(),r&&r(h),s.manager.itemError(e),s.manager.itemEnd(e)}function c(){a.removeEventListener("load",l,!1),a.removeEventListener("error",u,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",u,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class zU extends n0{constructor(e){super(e)}load(e,t,i,r){const s=new gn,o=new kU(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,t!==void 0&&t(s)},i,r),s}}class Ba extends hn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Ue(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}class GU extends Ba{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(hn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Ue(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const i0=new pt,LE=new N,IE=new N;class r0{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ce(512,512),this.map=null,this.mapPass=null,this.matrix=new pt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Fp,this._frameExtents=new ce(1,1),this._viewportCount=1,this._viewports=[new et(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;LE.setFromMatrixPosition(e.matrixWorld),t.position.copy(LE),IE.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(IE),t.updateMatrixWorld(),i0.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(i0),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(i0)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class VU extends r0{constructor(){super(new pi(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=cu*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(i!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=i,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class UE extends Ba{constructor(e,t,i=0,r=Math.PI/3,s=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(hn.DEFAULT_UP),this.updateMatrix(),this.target=new hn,this.distance=i,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new VU}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const FE=new pt,Bh=new N,s0=new N;class HU extends r0{constructor(){super(new pi(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ce(4,2),this._viewportCount=6,this._viewports=[new et(2,1,1,1),new et(0,1,1,1),new et(3,1,1,1),new et(1,1,1,1),new et(3,0,1,1),new et(1,0,1,1)],this._cubeDirections=[new N(1,0,0),new N(-1,0,0),new N(0,0,1),new N(0,0,-1),new N(0,1,0),new N(0,-1,0)],this._cubeUps=[new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,0,1),new N(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,r=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),Bh.setFromMatrixPosition(e.matrixWorld),i.position.copy(Bh),s0.copy(i.position),s0.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(s0),i.updateMatrixWorld(),r.makeTranslation(-Bh.x,-Bh.y,-Bh.z),FE.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(FE)}}class WU extends Ba{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new HU}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class kh extends _E{constructor(e=-1,t=1,i=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,o=i+e,a=r+t,l=r-t;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=u*this.view.offsetX,o=s+u*this.view.width,a-=c*this.view.offsetY,l=a-c*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class $U extends r0{constructor(){super(new kh(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class OE extends Ba{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(hn.DEFAULT_UP),this.updateMatrix(),this.target=new hn,this.shadow=new $U}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class BE extends Ba{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class jU extends Ba{constructor(e,t,i=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class XU{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new N)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*s),t.addScaledVector(o[3],.488603*i),t.addScaledVector(o[4],1.092548*(i*r)),t.addScaledVector(o[5],1.092548*(r*s)),t.addScaledVector(o[6],.315392*(3*s*s-1)),t.addScaledVector(o[7],1.092548*(i*s)),t.addScaledVector(o[8],.546274*(i*i-r*r)),t}getIrradianceAt(e,t){const i=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*r),t.addScaledVector(o[2],2*.511664*s),t.addScaledVector(o[3],2*.511664*i),t.addScaledVector(o[4],2*.429043*i*r),t.addScaledVector(o[5],2*.429043*r*s),t.addScaledVector(o[6],.743125*s*s-.247708),t.addScaledVector(o[7],2*.429043*i*s),t.addScaledVector(o[8],.429043*(i*i-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const i=e.x,r=e.y,s=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*s,t[3]=.488603*i,t[4]=1.092548*i*r,t[5]=1.092548*r*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*i*s,t[8]=.546274*(i*i-r*r)}}class qU extends Ba{constructor(e=new XU,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class YU extends pi{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class kE{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=zE(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=zE();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function zE(){return performance.now()}class KU extends Wy{constructor(e,t,i=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}const GE=new pt;class VE{constructor(e,t,i=0,r=1/0){this.ray=new vp(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new Ry,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return GE.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(GE),this}intersectObject(e,t=!0,i=[]){return o0(e,this,i,t),i.sort(HE),i}intersectObjects(e,t=!0,i=[]){for(let r=0,s=e.length;r<s;r++)o0(e[r],this,i,t);return i.sort(HE),i}}function HE(n,e){return n.distance-e.distance}function o0(n,e,t,i){let r=!0;if(n.layers.test(e.layers)&&n.raycast(e,t)===!1&&(r=!1),r===!0&&i===!0){const s=n.children;for(let o=0,a=s.length;o<a;o++)o0(s[o],e,t,!0)}}class a0{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=nt(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(nt(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class $p extends Ns{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}function WE(n,e,t,i){const r=QU(i);switch(t){case oy:return n*e;case ay:return n*e;case ly:return n*e*2;case fh:return n*e/r.components*r.byteLength;case Wl:return n*e/r.components*r.byteLength;case Aa:return n*e*2/r.components*r.byteLength;case $l:return n*e*2/r.components*r.byteLength;case dh:return n*e*3/r.components*r.byteLength;case Gn:return n*e*4/r.components*r.byteLength;case jl:return n*e*4/r.components*r.byteLength;case Ca:case Do:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case Lo:case Io:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case mh:case _h:return Math.max(n,16)*Math.max(e,8)/4;case ph:case gh:return Math.max(n,8)*Math.max(e,8)/2;case vh:case Xl:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case ql:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Yl:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Kl:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case Ql:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case Zl:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case Jl:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case eu:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case tu:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case nu:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case iu:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case ru:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case su:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case ou:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case au:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case lu:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case Ra:case uy:case cy:return Math.ceil(n/4)*Math.ceil(e/4)*16;case hy:case yh:return Math.ceil(n/4)*Math.ceil(e/4)*8;case xh:case Sh:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function QU(n){switch(n){case Kn:case Ma:return{byteLength:1,components:1};case Pr:case Ea:case hi:return{byteLength:2,components:1};case rp:case sp:return{byteLength:2,components:4};case en:case Un:case cn:return{byteLength:4,components:1};case op:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:kl}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=kl);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function $E(){let n=null,e=!1,t=null,i=null;function r(s,o){t(s,o),i=n.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function ZU(n){const e=new WeakMap;function t(a,l){const u=a.array,c=a.usage,h=u.byteLength,d=n.createBuffer();n.bindBuffer(l,d),n.bufferData(l,u,c),a.onUploadCallback();let f;if(u instanceof Float32Array)f=n.FLOAT;else if(u instanceof Uint16Array)a.isFloat16BufferAttribute?f=n.HALF_FLOAT:f=n.UNSIGNED_SHORT;else if(u instanceof Int16Array)f=n.SHORT;else if(u instanceof Uint32Array)f=n.UNSIGNED_INT;else if(u instanceof Int32Array)f=n.INT;else if(u instanceof Int8Array)f=n.BYTE;else if(u instanceof Uint8Array)f=n.UNSIGNED_BYTE;else if(u instanceof Uint8ClampedArray)f=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:d,type:f,bytesPerElement:u.BYTES_PER_ELEMENT,version:a.version,size:h}}function i(a,l,u){const c=l.array,h=l.updateRanges;if(n.bindBuffer(u,a),h.length===0)n.bufferSubData(u,0,c);else{h.sort((f,m)=>f.start-m.start);let d=0;for(let f=1;f<h.length;f++){const m=h[d],_=h[f];_.start<=m.start+m.count+1?m.count=Math.max(m.count,_.start+_.count-m.start):(++d,h[d]=_)}h.length=d+1;for(let f=0,m=h.length;f<m;f++){const _=h[f];n.bufferSubData(u,_.start*c.BYTES_PER_ELEMENT,c,_.start,_.count)}l.clearUpdateRanges()}l.onUploadCallback()}function r(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function s(a){a.isInterleavedBufferAttribute&&(a=a.data);const l=e.get(a);l&&(n.deleteBuffer(l.buffer),e.delete(a))}function o(a,l){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const c=e.get(a);(!c||c.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const u=e.get(a);if(u===void 0)e.set(a,t(a,l));else if(u.version<a.version){if(u.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(u.buffer,a,l),u.version=a.version}}return{get:r,remove:s,update:o}}var JU=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,eF=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,tF=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,nF=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,iF=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,rF=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,sF=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,oF=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,aF=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,lF=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,uF=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,cF=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,hF=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,dF=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,fF=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,pF=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,mF=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,gF=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,_F=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,vF=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,yF=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,xF=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,SF=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,TF=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,bF=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,wF=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,MF=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,EF=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,AF=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,CF=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,RF="gl_FragColor = linearToOutputTexel( gl_FragColor );",NF=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,PF=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,DF=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,LF=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,IF=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,UF=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,FF=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,OF=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,BF=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,kF=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,zF=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,GF=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,VF=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,HF=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,WF=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,$F=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,jF=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,XF=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,qF=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,YF=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,KF=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,QF=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,ZF=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,JF=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,e3=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,t3=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,n3=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,i3=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,r3=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,s3=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,o3=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,a3=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,l3=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,u3=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,c3=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,h3=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,d3=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,f3=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,p3=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,m3=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,g3=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,_3=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,v3=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,y3=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,x3=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,S3=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,T3=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,b3=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,w3=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,M3=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,E3=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,A3=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,C3=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,R3=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,N3=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,P3=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,D3=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,L3=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,I3=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,U3=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,F3=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,O3=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,B3=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,k3=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,z3=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,G3=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,V3=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,H3=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,W3=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,$3=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,j3=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,X3=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,q3=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Y3=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,K3=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,Q3=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const ot={alphahash_fragment:JU,alphahash_pars_fragment:eF,alphamap_fragment:tF,alphamap_pars_fragment:nF,alphatest_fragment:iF,alphatest_pars_fragment:rF,aomap_fragment:sF,aomap_pars_fragment:oF,batching_pars_vertex:aF,batching_vertex:lF,begin_vertex:uF,beginnormal_vertex:cF,bsdfs:hF,iridescence_fragment:dF,bumpmap_pars_fragment:fF,clipping_planes_fragment:pF,clipping_planes_pars_fragment:mF,clipping_planes_pars_vertex:gF,clipping_planes_vertex:_F,color_fragment:vF,color_pars_fragment:yF,color_pars_vertex:xF,color_vertex:SF,common:TF,cube_uv_reflection_fragment:bF,defaultnormal_vertex:wF,displacementmap_pars_vertex:MF,displacementmap_vertex:EF,emissivemap_fragment:AF,emissivemap_pars_fragment:CF,colorspace_fragment:RF,colorspace_pars_fragment:NF,envmap_fragment:PF,envmap_common_pars_fragment:DF,envmap_pars_fragment:LF,envmap_pars_vertex:IF,envmap_physical_pars_fragment:$F,envmap_vertex:UF,fog_vertex:FF,fog_pars_vertex:OF,fog_fragment:BF,fog_pars_fragment:kF,gradientmap_pars_fragment:zF,lightmap_pars_fragment:GF,lights_lambert_fragment:VF,lights_lambert_pars_fragment:HF,lights_pars_begin:WF,lights_toon_fragment:jF,lights_toon_pars_fragment:XF,lights_phong_fragment:qF,lights_phong_pars_fragment:YF,lights_physical_fragment:KF,lights_physical_pars_fragment:QF,lights_fragment_begin:ZF,lights_fragment_maps:JF,lights_fragment_end:e3,logdepthbuf_fragment:t3,logdepthbuf_pars_fragment:n3,logdepthbuf_pars_vertex:i3,logdepthbuf_vertex:r3,map_fragment:s3,map_pars_fragment:o3,map_particle_fragment:a3,map_particle_pars_fragment:l3,metalnessmap_fragment:u3,metalnessmap_pars_fragment:c3,morphinstance_vertex:h3,morphcolor_vertex:d3,morphnormal_vertex:f3,morphtarget_pars_vertex:p3,morphtarget_vertex:m3,normal_fragment_begin:g3,normal_fragment_maps:_3,normal_pars_fragment:v3,normal_pars_vertex:y3,normal_vertex:x3,normalmap_pars_fragment:S3,clearcoat_normal_fragment_begin:T3,clearcoat_normal_fragment_maps:b3,clearcoat_pars_fragment:w3,iridescence_pars_fragment:M3,opaque_fragment:E3,packing:A3,premultiplied_alpha_fragment:C3,project_vertex:R3,dithering_fragment:N3,dithering_pars_fragment:P3,roughnessmap_fragment:D3,roughnessmap_pars_fragment:L3,shadowmap_pars_fragment:I3,shadowmap_pars_vertex:U3,shadowmap_vertex:F3,shadowmask_pars_fragment:O3,skinbase_vertex:B3,skinning_pars_vertex:k3,skinning_vertex:z3,skinnormal_vertex:G3,specularmap_fragment:V3,specularmap_pars_fragment:H3,tonemapping_fragment:W3,tonemapping_pars_fragment:$3,transmission_fragment:j3,transmission_pars_fragment:X3,uv_pars_fragment:q3,uv_pars_vertex:Y3,uv_vertex:K3,worldpos_vertex:Q3,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,depth_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`},xe={common:{diffuse:{value:new Ue(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new je},alphaMap:{value:null},alphaMapTransform:{value:new je},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new je}},envmap:{envMap:{value:null},envMapRotation:{value:new je},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new je}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new je}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new je},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new je},normalScale:{value:new ce(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new je},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new je}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new je}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new je}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ue(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ue(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new je},alphaTest:{value:0},uvTransform:{value:new je}},sprite:{diffuse:{value:new Ue(16777215)},opacity:{value:1},center:{value:new ce(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new je},alphaMap:{value:null},alphaMapTransform:{value:new je},alphaTest:{value:0}}},ss={basic:{uniforms:fi([xe.common,xe.specularmap,xe.envmap,xe.aomap,xe.lightmap,xe.fog]),vertexShader:ot.meshbasic_vert,fragmentShader:ot.meshbasic_frag},lambert:{uniforms:fi([xe.common,xe.specularmap,xe.envmap,xe.aomap,xe.lightmap,xe.emissivemap,xe.bumpmap,xe.normalmap,xe.displacementmap,xe.fog,xe.lights,{emissive:{value:new Ue(0)}}]),vertexShader:ot.meshlambert_vert,fragmentShader:ot.meshlambert_frag},phong:{uniforms:fi([xe.common,xe.specularmap,xe.envmap,xe.aomap,xe.lightmap,xe.emissivemap,xe.bumpmap,xe.normalmap,xe.displacementmap,xe.fog,xe.lights,{emissive:{value:new Ue(0)},specular:{value:new Ue(1118481)},shininess:{value:30}}]),vertexShader:ot.meshphong_vert,fragmentShader:ot.meshphong_frag},standard:{uniforms:fi([xe.common,xe.envmap,xe.aomap,xe.lightmap,xe.emissivemap,xe.bumpmap,xe.normalmap,xe.displacementmap,xe.roughnessmap,xe.metalnessmap,xe.fog,xe.lights,{emissive:{value:new Ue(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ot.meshphysical_vert,fragmentShader:ot.meshphysical_frag},toon:{uniforms:fi([xe.common,xe.aomap,xe.lightmap,xe.emissivemap,xe.bumpmap,xe.normalmap,xe.displacementmap,xe.gradientmap,xe.fog,xe.lights,{emissive:{value:new Ue(0)}}]),vertexShader:ot.meshtoon_vert,fragmentShader:ot.meshtoon_frag},matcap:{uniforms:fi([xe.common,xe.bumpmap,xe.normalmap,xe.displacementmap,xe.fog,{matcap:{value:null}}]),vertexShader:ot.meshmatcap_vert,fragmentShader:ot.meshmatcap_frag},points:{uniforms:fi([xe.points,xe.fog]),vertexShader:ot.points_vert,fragmentShader:ot.points_frag},dashed:{uniforms:fi([xe.common,xe.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ot.linedashed_vert,fragmentShader:ot.linedashed_frag},depth:{uniforms:fi([xe.common,xe.displacementmap]),vertexShader:ot.depth_vert,fragmentShader:ot.depth_frag},normal:{uniforms:fi([xe.common,xe.bumpmap,xe.normalmap,xe.displacementmap,{opacity:{value:1}}]),vertexShader:ot.meshnormal_vert,fragmentShader:ot.meshnormal_frag},sprite:{uniforms:fi([xe.sprite,xe.fog]),vertexShader:ot.sprite_vert,fragmentShader:ot.sprite_frag},background:{uniforms:{uvTransform:{value:new je},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ot.background_vert,fragmentShader:ot.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new je}},vertexShader:ot.backgroundCube_vert,fragmentShader:ot.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ot.cube_vert,fragmentShader:ot.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ot.equirect_vert,fragmentShader:ot.equirect_frag},distanceRGBA:{uniforms:fi([xe.common,xe.displacementmap,{referencePosition:{value:new N},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ot.distanceRGBA_vert,fragmentShader:ot.distanceRGBA_frag},shadow:{uniforms:fi([xe.lights,xe.fog,{color:{value:new Ue(0)},opacity:{value:1}}]),vertexShader:ot.shadow_vert,fragmentShader:ot.shadow_frag}};ss.physical={uniforms:fi([ss.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new je},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new je},clearcoatNormalScale:{value:new ce(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new je},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new je},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new je},sheen:{value:0},sheenColor:{value:new Ue(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new je},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new je},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new je},transmissionSamplerSize:{value:new ce},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new je},attenuationDistance:{value:0},attenuationColor:{value:new Ue(0)},specularColor:{value:new Ue(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new je},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new je},anisotropyVector:{value:new ce},anisotropyMap:{value:null},anisotropyMapTransform:{value:new je}}]),vertexShader:ot.meshphysical_vert,fragmentShader:ot.meshphysical_frag};const jp={r:0,b:0,g:0},ka=new Qi,Z3=new pt;function J3(n,e,t,i,r,s,o){const a=new Ue(0);let l=s===!0?0:1,u,c,h=null,d=0,f=null;function m(y){let x=y.isScene===!0?y.background:null;return x&&x.isTexture&&(x=(y.backgroundBlurriness>0?t:e).get(x)),x}function _(y){let x=!1;const T=m(y);T===null?p(a,l):T&&T.isColor&&(p(T,1),x=!0);const S=n.xr.getEnvironmentBlendMode();S==="additive"?i.buffers.color.setClear(0,0,0,1,o):S==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,o),(n.autoClear||x)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function g(y,x){const T=m(x);T&&(T.isCubeTexture||T.mapping===Ta)?(c===void 0&&(c=new On(new Fa(1,1,1),new rs({name:"BackgroundCubeMaterial",uniforms:bu(ss.backgroundCube.uniforms),vertexShader:ss.backgroundCube.vertexShader,fragmentShader:ss.backgroundCube.fragmentShader,side:$t,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(S,w,E){this.matrixWorld.copyPosition(E.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),ka.copy(x.backgroundRotation),ka.x*=-1,ka.y*=-1,ka.z*=-1,T.isCubeTexture&&T.isRenderTargetTexture===!1&&(ka.y*=-1,ka.z*=-1),c.material.uniforms.envMap.value=T,c.material.uniforms.flipEnvMap.value=T.isCubeTexture&&T.isRenderTargetTexture===!1?-1:1,c.material.uniforms.backgroundBlurriness.value=x.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(Z3.makeRotationFromEuler(ka)),c.material.toneMapped=st.getTransfer(T.colorSpace)!==Et,(h!==T||d!==T.version||f!==n.toneMapping)&&(c.material.needsUpdate=!0,h=T,d=T.version,f=n.toneMapping),c.layers.enableAll(),y.unshift(c,c.geometry,c.material,0,0,null)):T&&T.isTexture&&(u===void 0&&(u=new On(new Wp(2,2),new rs({name:"BackgroundMaterial",uniforms:bu(ss.background.uniforms),vertexShader:ss.background.vertexShader,fragmentShader:ss.background.fragmentShader,side:Nr,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(u)),u.material.uniforms.t2D.value=T,u.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,u.material.toneMapped=st.getTransfer(T.colorSpace)!==Et,T.matrixAutoUpdate===!0&&T.updateMatrix(),u.material.uniforms.uvTransform.value.copy(T.matrix),(h!==T||d!==T.version||f!==n.toneMapping)&&(u.material.needsUpdate=!0,h=T,d=T.version,f=n.toneMapping),u.layers.enableAll(),y.unshift(u,u.geometry,u.material,0,0,null))}function p(y,x){y.getRGB(jp,mE(n)),i.buffers.color.setClear(jp.r,jp.g,jp.b,x,o)}function v(){c!==void 0&&(c.geometry.dispose(),c.material.dispose()),u!==void 0&&(u.geometry.dispose(),u.material.dispose())}return{getClearColor:function(){return a},setClearColor:function(y,x=1){a.set(y),l=x,p(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(y){l=y,p(a,l)},render:_,addToRenderList:g,dispose:v}}function eO(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},r=d(null);let s=r,o=!1;function a(b,R,I,B,D){let L=!1;const z=h(B,I,R);s!==z&&(s=z,u(s.object)),L=f(b,B,I,D),L&&m(b,B,I,D),D!==null&&e.update(D,n.ELEMENT_ARRAY_BUFFER),(L||o)&&(o=!1,x(b,R,I,B),D!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(D).buffer))}function l(){return n.createVertexArray()}function u(b){return n.bindVertexArray(b)}function c(b){return n.deleteVertexArray(b)}function h(b,R,I){const B=I.wireframe===!0;let D=i[b.id];D===void 0&&(D={},i[b.id]=D);let L=D[R.id];L===void 0&&(L={},D[R.id]=L);let z=L[B];return z===void 0&&(z=d(l()),L[B]=z),z}function d(b){const R=[],I=[],B=[];for(let D=0;D<t;D++)R[D]=0,I[D]=0,B[D]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:R,enabledAttributes:I,attributeDivisors:B,object:b,attributes:{},index:null}}function f(b,R,I,B){const D=s.attributes,L=R.attributes;let z=0;const ie=I.getAttributes();for(const k in ie)if(ie[k].location>=0){const W=D[k];let K=L[k];if(K===void 0&&(k==="instanceMatrix"&&b.instanceMatrix&&(K=b.instanceMatrix),k==="instanceColor"&&b.instanceColor&&(K=b.instanceColor)),W===void 0||W.attribute!==K||K&&W.data!==K.data)return!0;z++}return s.attributesNum!==z||s.index!==B}function m(b,R,I,B){const D={},L=R.attributes;let z=0;const ie=I.getAttributes();for(const k in ie)if(ie[k].location>=0){let W=L[k];W===void 0&&(k==="instanceMatrix"&&b.instanceMatrix&&(W=b.instanceMatrix),k==="instanceColor"&&b.instanceColor&&(W=b.instanceColor));const K={};K.attribute=W,W&&W.data&&(K.data=W.data),D[k]=K,z++}s.attributes=D,s.attributesNum=z,s.index=B}function _(){const b=s.newAttributes;for(let R=0,I=b.length;R<I;R++)b[R]=0}function g(b){p(b,0)}function p(b,R){const I=s.newAttributes,B=s.enabledAttributes,D=s.attributeDivisors;I[b]=1,B[b]===0&&(n.enableVertexAttribArray(b),B[b]=1),D[b]!==R&&(n.vertexAttribDivisor(b,R),D[b]=R)}function v(){const b=s.newAttributes,R=s.enabledAttributes;for(let I=0,B=R.length;I<B;I++)R[I]!==b[I]&&(n.disableVertexAttribArray(I),R[I]=0)}function y(b,R,I,B,D,L,z){z===!0?n.vertexAttribIPointer(b,R,I,D,L):n.vertexAttribPointer(b,R,I,B,D,L)}function x(b,R,I,B){_();const D=B.attributes,L=I.getAttributes(),z=R.defaultAttributeValues;for(const ie in L){const k=L[ie];if(k.location>=0){let Z=D[ie];if(Z===void 0&&(ie==="instanceMatrix"&&b.instanceMatrix&&(Z=b.instanceMatrix),ie==="instanceColor"&&b.instanceColor&&(Z=b.instanceColor)),Z!==void 0){const W=Z.normalized,K=Z.itemSize,he=e.get(Z);if(he===void 0)continue;const Ie=he.buffer,O=he.type,X=he.bytesPerElement,ae=O===n.INT||O===n.UNSIGNED_INT||Z.gpuType===Un;if(Z.isInterleavedBufferAttribute){const re=Z.data,Ee=re.stride,Re=Z.offset;if(re.isInstancedInterleavedBuffer){for(let Fe=0;Fe<k.locationSize;Fe++)p(k.location+Fe,re.meshPerAttribute);b.isInstancedMesh!==!0&&B._maxInstanceCount===void 0&&(B._maxInstanceCount=re.meshPerAttribute*re.count)}else for(let Fe=0;Fe<k.locationSize;Fe++)g(k.location+Fe);n.bindBuffer(n.ARRAY_BUFFER,Ie);for(let Fe=0;Fe<k.locationSize;Fe++)y(k.location+Fe,K/k.locationSize,O,W,Ee*X,(Re+K/k.locationSize*Fe)*X,ae)}else{if(Z.isInstancedBufferAttribute){for(let re=0;re<k.locationSize;re++)p(k.location+re,Z.meshPerAttribute);b.isInstancedMesh!==!0&&B._maxInstanceCount===void 0&&(B._maxInstanceCount=Z.meshPerAttribute*Z.count)}else for(let re=0;re<k.locationSize;re++)g(k.location+re);n.bindBuffer(n.ARRAY_BUFFER,Ie);for(let re=0;re<k.locationSize;re++)y(k.location+re,K/k.locationSize,O,W,K*X,K/k.locationSize*re*X,ae)}}else if(z!==void 0){const W=z[ie];if(W!==void 0)switch(W.length){case 2:n.vertexAttrib2fv(k.location,W);break;case 3:n.vertexAttrib3fv(k.location,W);break;case 4:n.vertexAttrib4fv(k.location,W);break;default:n.vertexAttrib1fv(k.location,W)}}}}v()}function T(){E();for(const b in i){const R=i[b];for(const I in R){const B=R[I];for(const D in B)c(B[D].object),delete B[D];delete R[I]}delete i[b]}}function S(b){if(i[b.id]===void 0)return;const R=i[b.id];for(const I in R){const B=R[I];for(const D in B)c(B[D].object),delete B[D];delete R[I]}delete i[b.id]}function w(b){for(const R in i){const I=i[R];if(I[b.id]===void 0)continue;const B=I[b.id];for(const D in B)c(B[D].object),delete B[D];delete I[b.id]}}function E(){M(),o=!0,s!==r&&(s=r,u(s.object))}function M(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:a,reset:E,resetDefaultState:M,dispose:T,releaseStatesOfGeometry:S,releaseStatesOfProgram:w,initAttributes:_,enableAttribute:g,disableUnusedAttributes:v}}function tO(n,e,t){let i;function r(u){i=u}function s(u,c){n.drawArrays(i,u,c),t.update(c,i,1)}function o(u,c,h){h!==0&&(n.drawArraysInstanced(i,u,c,h),t.update(c,i,h))}function a(u,c,h){if(h===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,u,0,c,0,h);let f=0;for(let m=0;m<h;m++)f+=c[m];t.update(f,i,1)}function l(u,c,h,d){if(h===0)return;const f=e.get("WEBGL_multi_draw");if(f===null)for(let m=0;m<u.length;m++)o(u[m],c[m],d[m]);else{f.multiDrawArraysInstancedWEBGL(i,u,0,c,0,d,0,h);let m=0;for(let _=0;_<h;_++)m+=c[_]*d[_];t.update(m,i,1)}}this.setMode=r,this.render=s,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=l}function nO(n,e,t,i){let r;function s(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const w=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(w.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function o(w){return!(w!==Gn&&i.convert(w)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(w){const E=w===hi&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(w!==Kn&&i.convert(w)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&w!==cn&&!E)}function l(w){if(w==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";w="mediump"}return w==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let u=t.precision!==void 0?t.precision:"highp";const c=l(u);c!==u&&(console.warn("THREE.WebGLRenderer:",u,"not supported, using",c,"instead."),u=c);const h=t.logarithmicDepthBuffer===!0,d=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),f=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),m=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),_=n.getParameter(n.MAX_TEXTURE_SIZE),g=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),p=n.getParameter(n.MAX_VERTEX_ATTRIBS),v=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),y=n.getParameter(n.MAX_VARYING_VECTORS),x=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),T=m>0,S=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:l,textureFormatReadable:o,textureTypeReadable:a,precision:u,logarithmicDepthBuffer:h,reverseDepthBuffer:d,maxTextures:f,maxVertexTextures:m,maxTextureSize:_,maxCubemapSize:g,maxAttributes:p,maxVertexUniforms:v,maxVaryings:y,maxFragmentUniforms:x,vertexTextures:T,maxSamples:S}}function iO(n){const e=this;let t=null,i=0,r=!1,s=!1;const o=new Fr,a=new je,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const f=h.length!==0||d||i!==0||r;return r=d,i=h.length,f},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){t=c(h,d,0)},this.setState=function(h,d,f){const m=h.clippingPlanes,_=h.clipIntersection,g=h.clipShadows,p=n.get(h);if(!r||m===null||m.length===0||s&&!g)s?c(null):u();else{const v=s?0:i,y=v*4;let x=p.clippingState||null;l.value=x,x=c(m,d,y,f);for(let T=0;T!==y;++T)x[T]=t[T];p.clippingState=x,this.numIntersection=_?this.numPlanes:0,this.numPlanes+=v}};function u(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function c(h,d,f,m){const _=h!==null?h.length:0;let g=null;if(_!==0){if(g=l.value,m!==!0||g===null){const p=f+_*4,v=d.matrixWorldInverse;a.getNormalMatrix(v),(g===null||g.length<p)&&(g=new Float32Array(p));for(let y=0,x=f;y!==_;++y,x+=4)o.copy(h[y]).applyMatrix4(v,a),o.normal.toArray(g,x),g[x+3]=o.constant}l.value=g,l.needsUpdate=!0}return e.numPlanes=_,e.numIntersection=0,g}}function rO(n){let e=new WeakMap;function t(o,a){return a===No?o.mapping=fr:a===Po&&(o.mapping=pr),o}function i(o){if(o&&o.isTexture){const a=o.mapping;if(a===No||a===Po)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const u=new SE(l.height);return u.fromEquirectangularTexture(n,o),e.set(o,u),o.addEventListener("dispose",r),t(u.texture,o.mapping)}else return null}}return o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function s(){e=new WeakMap}return{get:i,dispose:s}}const Pu=4,jE=[.125,.215,.35,.446,.526,.582],za=20,l0=new kh,XE=new Ue;let u0=null,c0=0,h0=0,d0=!1;const Ga=(1+Math.sqrt(5))/2,Du=1/Ga,qE=[new N(-Ga,Du,0),new N(Ga,Du,0),new N(-Du,0,Ga),new N(Du,0,Ga),new N(0,Ga,-Du),new N(0,Ga,Du),new N(-1,1,-1),new N(1,1,-1),new N(-1,1,1),new N(1,1,1)];let YE=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){u0=this._renderer.getRenderTarget(),c0=this._renderer.getActiveCubeFace(),h0=this._renderer.getActiveMipmapLevel(),d0=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,i,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=ZE(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=QE(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(u0,c0,h0),this._renderer.xr.enabled=d0,e.scissorTest=!1,Xp(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===fr||e.mapping===pr?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),u0=this._renderer.getRenderTarget(),c0=this._renderer.getActiveCubeFace(),h0=this._renderer.getActiveMipmapLevel(),d0=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:mn,minFilter:mn,generateMipmaps:!1,type:hi,format:Gn,colorSpace:mr,depthBuffer:!1},r=KE(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=KE(e,t,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=sO(s)),this._blurMaterial=oO(s,e,t)}return r}_compileMaterial(e){const t=new On(this._lodPlanes[0],e);this._renderer.compile(t,l0)}_sceneToCubeUV(e,t,i,r){const a=new pi(90,1,t,i),l=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],c=this._renderer,h=c.autoClear,d=c.toneMapping;c.getClearColor(XE),c.toneMapping=Ai,c.autoClear=!1;const f=new Ch({name:"PMREM.Background",side:$t,depthWrite:!1,depthTest:!1}),m=new On(new Fa,f);let _=!1;const g=e.background;g?g.isColor&&(f.color.copy(g),e.background=null,_=!0):(f.color.copy(XE),_=!0);for(let p=0;p<6;p++){const v=p%3;v===0?(a.up.set(0,l[p],0),a.lookAt(u[p],0,0)):v===1?(a.up.set(0,0,l[p]),a.lookAt(0,u[p],0)):(a.up.set(0,l[p],0),a.lookAt(0,0,u[p]));const y=this._cubeSize;Xp(r,v*y,p>2?y:0,y,y),c.setRenderTarget(r),_&&c.render(m,a),c.render(e,a)}m.geometry.dispose(),m.material.dispose(),c.toneMapping=d,c.autoClear=h,e.background=g}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===fr||e.mapping===pr;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=ZE()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=QE());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new On(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const l=this._cubeSize;Xp(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(o,l0)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let s=1;s<r;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=qE[(r-s-1)%qE.length];this._blur(e,s-1,s,o,a)}t.autoClear=i}_blur(e,t,i,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,r,"latitudinal",s),this._halfBlur(o,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,o,a){const l=this._renderer,u=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const c=3,h=new On(this._lodPlanes[r],u),d=u.uniforms,f=this._sizeLods[i]-1,m=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*za-1),_=s/m,g=isFinite(s)?1+Math.floor(c*_):za;g>za&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${za}`);const p=[];let v=0;for(let w=0;w<za;++w){const E=w/_,M=Math.exp(-E*E/2);p.push(M),w===0?v+=M:w<g&&(v+=2*M)}for(let w=0;w<p.length;w++)p[w]=p[w]/v;d.envMap.value=e.texture,d.samples.value=g,d.weights.value=p,d.latitudinal.value=o==="latitudinal",a&&(d.poleAxis.value=a);const{_lodMax:y}=this;d.dTheta.value=m,d.mipInt.value=y-i;const x=this._sizeLods[r],T=3*x*(r>y-Pu?r-y+Pu:0),S=4*(this._cubeSize-x);Xp(t,T,S,3*x,2*x),l.setRenderTarget(t),l.render(h,l0)}};function sO(n){const e=[],t=[],i=[];let r=n;const s=n-Pu+1+jE.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);t.push(a);let l=1/a;o>n-Pu?l=jE[o-n+Pu-1]:o===0&&(l=0),i.push(l);const u=1/(a-2),c=-u,h=1+u,d=[c,c,h,c,h,h,c,c,h,h,c,h],f=6,m=6,_=3,g=2,p=1,v=new Float32Array(_*m*f),y=new Float32Array(g*m*f),x=new Float32Array(p*m*f);for(let S=0;S<f;S++){const w=S%3*2/3-1,E=S>2?0:-1,M=[w,E,0,w+2/3,E,0,w+2/3,E+1,0,w,E,0,w+2/3,E+1,0,w,E+1,0];v.set(M,_*m*S),y.set(d,g*m*S);const b=[S,S,S,S,S,S];x.set(b,p*m*S)}const T=new ei;T.setAttribute("position",new Vn(v,_)),T.setAttribute("uv",new Vn(y,g)),T.setAttribute("faceIndex",new Vn(x,p)),e.push(T),r>Pu&&r--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function KE(n,e,t){const i=new Fo(n,e,t);return i.texture.mapping=Ta,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Xp(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function oO(n,e,t){const i=new Float32Array(za),r=new N(0,1,0);return new rs({name:"SphericalGaussianBlur",defines:{n:za,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:f0(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ei,depthTest:!1,depthWrite:!1})}function QE(){return new rs({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:f0(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Ei,depthTest:!1,depthWrite:!1})}function ZE(){return new rs({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:f0(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Ei,depthTest:!1,depthWrite:!1})}function f0(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function aO(n){let e=new WeakMap,t=null;function i(a){if(a&&a.isTexture){const l=a.mapping,u=l===No||l===Po,c=l===fr||l===pr;if(u||c){let h=e.get(a);const d=h!==void 0?h.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==d)return t===null&&(t=new YE(n)),h=u?t.fromEquirectangular(a,h):t.fromCubemap(a,h),h.texture.pmremVersion=a.pmremVersion,e.set(a,h),h.texture;if(h!==void 0)return h.texture;{const f=a.image;return u&&f&&f.height>0||c&&f&&r(f)?(t===null&&(t=new YE(n)),h=u?t.fromEquirectangular(a):t.fromCubemap(a),h.texture.pmremVersion=a.pmremVersion,e.set(a,h),a.addEventListener("dispose",s),h.texture):null}}}return a}function r(a){let l=0;const u=6;for(let c=0;c<u;c++)a[c]!==void 0&&l++;return l===u}function s(a){const l=a.target;l.removeEventListener("dispose",s);const u=e.get(l);u!==void 0&&(e.delete(l),u.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:o}}function lO(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const r=t(i);return r===null&&Pa("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function uO(n,e,t,i){const r={},s=new WeakMap;function o(h){const d=h.target;d.index!==null&&e.remove(d.index);for(const m in d.attributes)e.remove(d.attributes[m]);d.removeEventListener("dispose",o),delete r[d.id];const f=s.get(d);f&&(e.remove(f),s.delete(d)),i.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,t.memory.geometries--}function a(h,d){return r[d.id]===!0||(d.addEventListener("dispose",o),r[d.id]=!0,t.memory.geometries++),d}function l(h){const d=h.attributes;for(const f in d)e.update(d[f],n.ARRAY_BUFFER)}function u(h){const d=[],f=h.index,m=h.attributes.position;let _=0;if(f!==null){const v=f.array;_=f.version;for(let y=0,x=v.length;y<x;y+=3){const T=v[y+0],S=v[y+1],w=v[y+2];d.push(T,S,S,w,w,T)}}else if(m!==void 0){const v=m.array;_=m.version;for(let y=0,x=v.length/3-1;y<x;y+=3){const T=y+0,S=y+1,w=y+2;d.push(T,S,S,w,w,T)}}else return;const g=new(YM(d)?zy:ky)(d,1);g.version=_;const p=s.get(h);p&&e.remove(p),s.set(h,g)}function c(h){const d=s.get(h);if(d){const f=h.index;f!==null&&d.version<f.version&&u(h)}else u(h);return s.get(h)}return{get:a,update:l,getWireframeAttribute:c}}function cO(n,e,t){let i;function r(d){i=d}let s,o;function a(d){s=d.type,o=d.bytesPerElement}function l(d,f){n.drawElements(i,f,s,d*o),t.update(f,i,1)}function u(d,f,m){m!==0&&(n.drawElementsInstanced(i,f,s,d*o,m),t.update(f,i,m))}function c(d,f,m){if(m===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,f,0,s,d,0,m);let g=0;for(let p=0;p<m;p++)g+=f[p];t.update(g,i,1)}function h(d,f,m,_){if(m===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let p=0;p<d.length;p++)u(d[p]/o,f[p],_[p]);else{g.multiDrawElementsInstancedWEBGL(i,f,0,s,d,0,_,0,m);let p=0;for(let v=0;v<m;v++)p+=f[v]*_[v];t.update(p,i,1)}}this.setMode=r,this.setIndex=a,this.render=l,this.renderInstances=u,this.renderMultiDraw=c,this.renderMultiDrawInstances=h}function hO(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,o,a){switch(t.calls++,o){case n.TRIANGLES:t.triangles+=a*(s/3);break;case n.LINES:t.lines+=a*(s/2);break;case n.LINE_STRIP:t.lines+=a*(s-1);break;case n.LINE_LOOP:t.lines+=a*s;break;case n.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:i}}function dO(n,e,t){const i=new WeakMap,r=new et;function s(o,a,l){const u=o.morphTargetInfluences,c=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,h=c!==void 0?c.length:0;let d=i.get(a);if(d===void 0||d.count!==h){let M=function(){w.dispose(),i.delete(a),a.removeEventListener("dispose",M)};d!==void 0&&d.texture.dispose();const f=a.morphAttributes.position!==void 0,m=a.morphAttributes.normal!==void 0,_=a.morphAttributes.color!==void 0,g=a.morphAttributes.position||[],p=a.morphAttributes.normal||[],v=a.morphAttributes.color||[];let y=0;f===!0&&(y=1),m===!0&&(y=2),_===!0&&(y=3);let x=a.attributes.position.count*y,T=1;x>e.maxTextureSize&&(T=Math.ceil(x/e.maxTextureSize),x=e.maxTextureSize);const S=new Float32Array(x*T*4*h),w=new Ty(S,x,T,h);w.type=cn,w.needsUpdate=!0;const E=y*4;for(let b=0;b<h;b++){const R=g[b],I=p[b],B=v[b],D=x*T*4*b;for(let L=0;L<R.count;L++){const z=L*E;f===!0&&(r.fromBufferAttribute(R,L),S[D+z+0]=r.x,S[D+z+1]=r.y,S[D+z+2]=r.z,S[D+z+3]=0),m===!0&&(r.fromBufferAttribute(I,L),S[D+z+4]=r.x,S[D+z+5]=r.y,S[D+z+6]=r.z,S[D+z+7]=0),_===!0&&(r.fromBufferAttribute(B,L),S[D+z+8]=r.x,S[D+z+9]=r.y,S[D+z+10]=r.z,S[D+z+11]=B.itemSize===4?r.w:1)}}d={count:h,texture:w,size:new ce(x,T)},i.set(a,d),a.addEventListener("dispose",M)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)l.getUniforms().setValue(n,"morphTexture",o.morphTexture,t);else{let f=0;for(let _=0;_<u.length;_++)f+=u[_];const m=a.morphTargetsRelative?1:1-f;l.getUniforms().setValue(n,"morphTargetBaseInfluence",m),l.getUniforms().setValue(n,"morphTargetInfluences",u)}l.getUniforms().setValue(n,"morphTargetsTexture",d.texture,t),l.getUniforms().setValue(n,"morphTargetsTextureSize",d.size)}return{update:s}}function fO(n,e,t,i){let r=new WeakMap;function s(l){const u=i.render.frame,c=l.geometry,h=e.get(l,c);if(r.get(h)!==u&&(e.update(h),r.set(h,u)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),r.get(l)!==u&&(t.update(l.instanceMatrix,n.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,n.ARRAY_BUFFER),r.set(l,u))),l.isSkinnedMesh){const d=l.skeleton;r.get(d)!==u&&(d.update(),r.set(d,u))}return h}function o(){r=new WeakMap}function a(l){const u=l.target;u.removeEventListener("dispose",a),t.remove(u.instanceMatrix),u.instanceColor!==null&&t.remove(u.instanceColor)}return{update:s,dispose:o}}const JE=new gn,e1=new Ho(1,1),t1=new Ty,n1=new HI,i1=new Pp,r1=[],s1=[],o1=new Float32Array(16),a1=new Float32Array(9),l1=new Float32Array(4);function Lu(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let s=r1[r];if(s===void 0&&(s=new Float32Array(r),r1[r]=s),e!==0){i.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(s,a)}return s}function An(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function Cn(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function qp(n,e){let t=s1[e];t===void 0&&(t=new Int32Array(e),s1[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function pO(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function mO(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(An(t,e))return;n.uniform2fv(this.addr,e),Cn(t,e)}}function gO(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(An(t,e))return;n.uniform3fv(this.addr,e),Cn(t,e)}}function _O(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(An(t,e))return;n.uniform4fv(this.addr,e),Cn(t,e)}}function vO(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(An(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Cn(t,e)}else{if(An(t,i))return;l1.set(i),n.uniformMatrix2fv(this.addr,!1,l1),Cn(t,i)}}function yO(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(An(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Cn(t,e)}else{if(An(t,i))return;a1.set(i),n.uniformMatrix3fv(this.addr,!1,a1),Cn(t,i)}}function xO(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(An(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Cn(t,e)}else{if(An(t,i))return;o1.set(i),n.uniformMatrix4fv(this.addr,!1,o1),Cn(t,i)}}function SO(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function TO(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(An(t,e))return;n.uniform2iv(this.addr,e),Cn(t,e)}}function bO(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(An(t,e))return;n.uniform3iv(this.addr,e),Cn(t,e)}}function wO(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(An(t,e))return;n.uniform4iv(this.addr,e),Cn(t,e)}}function MO(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function EO(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(An(t,e))return;n.uniform2uiv(this.addr,e),Cn(t,e)}}function AO(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(An(t,e))return;n.uniform3uiv(this.addr,e),Cn(t,e)}}function CO(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(An(t,e))return;n.uniform4uiv(this.addr,e),Cn(t,e)}}function RO(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r);let s;this.type===n.SAMPLER_2D_SHADOW?(e1.compareFunction=up,s=e1):s=JE,t.setTexture2D(e||s,r)}function NO(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||n1,r)}function PO(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||i1,r)}function DO(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||t1,r)}function LO(n){switch(n){case 5126:return pO;case 35664:return mO;case 35665:return gO;case 35666:return _O;case 35674:return vO;case 35675:return yO;case 35676:return xO;case 5124:case 35670:return SO;case 35667:case 35671:return TO;case 35668:case 35672:return bO;case 35669:case 35673:return wO;case 5125:return MO;case 36294:return EO;case 36295:return AO;case 36296:return CO;case 35678:case 36198:case 36298:case 36306:case 35682:return RO;case 35679:case 36299:case 36307:return NO;case 35680:case 36300:case 36308:case 36293:return PO;case 36289:case 36303:case 36311:case 36292:return DO}}function IO(n,e){n.uniform1fv(this.addr,e)}function UO(n,e){const t=Lu(e,this.size,2);n.uniform2fv(this.addr,t)}function FO(n,e){const t=Lu(e,this.size,3);n.uniform3fv(this.addr,t)}function OO(n,e){const t=Lu(e,this.size,4);n.uniform4fv(this.addr,t)}function BO(n,e){const t=Lu(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function kO(n,e){const t=Lu(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function zO(n,e){const t=Lu(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function GO(n,e){n.uniform1iv(this.addr,e)}function VO(n,e){n.uniform2iv(this.addr,e)}function HO(n,e){n.uniform3iv(this.addr,e)}function WO(n,e){n.uniform4iv(this.addr,e)}function $O(n,e){n.uniform1uiv(this.addr,e)}function jO(n,e){n.uniform2uiv(this.addr,e)}function XO(n,e){n.uniform3uiv(this.addr,e)}function qO(n,e){n.uniform4uiv(this.addr,e)}function YO(n,e,t){const i=this.cache,r=e.length,s=qp(t,r);An(i,s)||(n.uniform1iv(this.addr,s),Cn(i,s));for(let o=0;o!==r;++o)t.setTexture2D(e[o]||JE,s[o])}function KO(n,e,t){const i=this.cache,r=e.length,s=qp(t,r);An(i,s)||(n.uniform1iv(this.addr,s),Cn(i,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||n1,s[o])}function QO(n,e,t){const i=this.cache,r=e.length,s=qp(t,r);An(i,s)||(n.uniform1iv(this.addr,s),Cn(i,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||i1,s[o])}function ZO(n,e,t){const i=this.cache,r=e.length,s=qp(t,r);An(i,s)||(n.uniform1iv(this.addr,s),Cn(i,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||t1,s[o])}function JO(n){switch(n){case 5126:return IO;case 35664:return UO;case 35665:return FO;case 35666:return OO;case 35674:return BO;case 35675:return kO;case 35676:return zO;case 5124:case 35670:return GO;case 35667:case 35671:return VO;case 35668:case 35672:return HO;case 35669:case 35673:return WO;case 5125:return $O;case 36294:return jO;case 36295:return XO;case 36296:return qO;case 35678:case 36198:case 36298:case 36306:case 35682:return YO;case 35679:case 36299:case 36307:return KO;case 35680:case 36300:case 36308:case 36293:return QO;case 36289:case 36303:case 36311:case 36292:return ZO}}class eB{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=LO(t.type)}}class tB{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=JO(t.type)}}class nB{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,t[a.id],i)}}}const p0=/(\w+)(\])?(\[|\.)?/g;function u1(n,e){n.seq.push(e),n.map[e.id]=e}function iB(n,e,t){const i=n.name,r=i.length;for(p0.lastIndex=0;;){const s=p0.exec(i),o=p0.lastIndex;let a=s[1];const l=s[2]==="]",u=s[3];if(l&&(a=a|0),u===void 0||u==="["&&o+2===r){u1(t,u===void 0?new eB(a,n,e):new tB(a,n,e));break}else{let h=t.map[a];h===void 0&&(h=new nB(a),u1(t,h)),t=h}}}class Yp{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const s=e.getActiveUniform(t,r),o=e.getUniformLocation(t,s.name);iB(s,o,this)}}setValue(e,t,i,r){const s=this.map[t];s!==void 0&&s.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let s=0,o=t.length;s!==o;++s){const a=t[s],l=i[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&i.push(o)}return i}}function c1(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}const rB=37297;let sB=0;function oB(n,e){const t=n.split(`
`),i=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join(`
`)}const h1=new je;function aB(n){st._getMatrix(h1,st.workingColorSpace,n);const e=`mat3( ${h1.elements.map(t=>t.toFixed(4))} )`;switch(st.getTransfer(n)){case ap:return[e,"LinearTransferOETF"];case Et:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",n),[e,"LinearTransferOETF"]}}function d1(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),r=n.getShaderInfoLog(e).trim();if(i&&r==="")return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return t.toUpperCase()+`

`+r+`

`+oB(n.getShaderSource(e),o)}else return r}function lB(n,e){const t=aB(e);return[`vec4 ${n}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function uB(n,e){let t;switch(e){case zM:t="Linear";break;case GM:t="Reinhard";break;case VM:t="Cineon";break;case HM:t="ACESFilmic";break;case WM:t="AgX";break;case $M:t="Neutral";break;case nI:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const Kp=new N;function cB(){st.getLuminanceCoefficients(Kp);const n=Kp.x.toFixed(4),e=Kp.y.toFixed(4),t=Kp.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function hB(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(zh).join(`
`)}function dB(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function fB(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const s=n.getActiveAttrib(e,r),o=s.name;let a=1;s.type===n.FLOAT_MAT2&&(a=2),s.type===n.FLOAT_MAT3&&(a=3),s.type===n.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}function zh(n){return n!==""}function f1(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function p1(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const pB=/^[ \t]*#include +<([\w\d./]+)>/gm;function m0(n){return n.replace(pB,gB)}const mB=new Map;function gB(n,e){let t=ot[e];if(t===void 0){const i=mB.get(e);if(i!==void 0)t=ot[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return m0(t)}const _B=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function m1(n){return n.replace(_B,vB)}function vB(n,e,t,i){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function g1(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function yB(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===jv?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===QL?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Xi&&(e="SHADOWMAP_TYPE_VSM"),e}function xB(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case fr:case pr:e="ENVMAP_TYPE_CUBE";break;case Ta:e="ENVMAP_TYPE_CUBE_UV";break}return e}function SB(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case pr:e="ENVMAP_MODE_REFRACTION";break}return e}function TB(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case hh:e="ENVMAP_BLENDING_MULTIPLY";break;case BM:e="ENVMAP_BLENDING_MIX";break;case kM:e="ENVMAP_BLENDING_ADD";break}return e}function bB(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function wB(n,e,t,i){const r=n.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=yB(t),u=xB(t),c=SB(t),h=TB(t),d=bB(t),f=hB(t),m=dB(s),_=r.createProgram();let g,p,v=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(g=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m].filter(zh).join(`
`),g.length>0&&(g+=`
`),p=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m].filter(zh).join(`
`),p.length>0&&(p+=`
`)):(g=[g1(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(zh).join(`
`),p=[g1(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Ai?"#define TONE_MAPPING":"",t.toneMapping!==Ai?ot.tonemapping_pars_fragment:"",t.toneMapping!==Ai?uB("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",ot.colorspace_pars_fragment,lB("linearToOutputTexel",t.outputColorSpace),cB(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(zh).join(`
`)),o=m0(o),o=f1(o,t),o=p1(o,t),a=m0(a),a=f1(a,t),a=p1(a,t),o=m1(o),a=m1(a),t.isRawShaderMaterial!==!0&&(v=`#version 300 es
`,g=[f,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,p=["#define varying in",t.glslVersion===XM?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===XM?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+p);const y=v+g+o,x=v+p+a,T=c1(r,r.VERTEX_SHADER,y),S=c1(r,r.FRAGMENT_SHADER,x);r.attachShader(_,T),r.attachShader(_,S),t.index0AttributeName!==void 0?r.bindAttribLocation(_,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(_,0,"position"),r.linkProgram(_);function w(R){if(n.debug.checkShaderErrors){const I=r.getProgramInfoLog(_).trim(),B=r.getShaderInfoLog(T).trim(),D=r.getShaderInfoLog(S).trim();let L=!0,z=!0;if(r.getProgramParameter(_,r.LINK_STATUS)===!1)if(L=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(r,_,T,S);else{const ie=d1(r,T,"vertex"),k=d1(r,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(_,r.VALIDATE_STATUS)+`

Material Name: `+R.name+`
Material Type: `+R.type+`

Program Info Log: `+I+`
`+ie+`
`+k)}else I!==""?console.warn("THREE.WebGLProgram: Program Info Log:",I):(B===""||D==="")&&(z=!1);z&&(R.diagnostics={runnable:L,programLog:I,vertexShader:{log:B,prefix:g},fragmentShader:{log:D,prefix:p}})}r.deleteShader(T),r.deleteShader(S),E=new Yp(r,_),M=fB(r,_)}let E;this.getUniforms=function(){return E===void 0&&w(this),E};let M;this.getAttributes=function(){return M===void 0&&w(this),M};let b=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return b===!1&&(b=r.getProgramParameter(_,rB)),b},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(_),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=sB++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=T,this.fragmentShader=S,this}let MB=0;class EB{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new AB(e),t.set(e,i)),i}}class AB{constructor(e){this.id=MB++,this.code=e,this.usedTimes=0}}function CB(n,e,t,i,r,s,o){const a=new Ry,l=new EB,u=new Set,c=[],h=r.logarithmicDepthBuffer,d=r.vertexTextures;let f=r.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(M){return u.add(M),M===0?"uv":`uv${M}`}function g(M,b,R,I,B){const D=I.fog,L=B.geometry,z=M.isMeshStandardMaterial?I.environment:null,ie=(M.isMeshStandardMaterial?t:e).get(M.envMap||z),k=ie&&ie.mapping===Ta?ie.image.height:null,Z=m[M.type];M.precision!==null&&(f=r.getMaxPrecision(M.precision),f!==M.precision&&console.warn("THREE.WebGLProgram.getParameters:",M.precision,"not supported, using",f,"instead."));const W=L.morphAttributes.position||L.morphAttributes.normal||L.morphAttributes.color,K=W!==void 0?W.length:0;let he=0;L.morphAttributes.position!==void 0&&(he=1),L.morphAttributes.normal!==void 0&&(he=2),L.morphAttributes.color!==void 0&&(he=3);let Ie,O,X,ae;if(Z){const Lt=ss[Z];Ie=Lt.vertexShader,O=Lt.fragmentShader}else Ie=M.vertexShader,O=M.fragmentShader,l.update(M),X=l.getVertexShaderID(M),ae=l.getFragmentShaderID(M);const re=n.getRenderTarget(),Ee=n.state.buffers.depth.getReversed(),Re=B.isInstancedMesh===!0,Fe=B.isBatchedMesh===!0,mt=!!M.map,ut=!!M.matcap,Ct=!!ie,F=!!M.aoMap,nn=!!M.lightMap,ct=!!M.bumpMap,dt=!!M.normalMap,Ge=!!M.displacementMap,Ht=!!M.emissiveMap,ze=!!M.metalnessMap,P=!!M.roughnessMap,A=M.anisotropy>0,j=M.clearcoat>0,le=M.dispersion>0,de=M.iridescence>0,se=M.sheen>0,ke=M.transmission>0,be=A&&!!M.anisotropyMap,Ne=j&&!!M.clearcoatMap,xt=j&&!!M.clearcoatNormalMap,_e=j&&!!M.clearcoatRoughnessMap,Pe=de&&!!M.iridescenceMap,$e=de&&!!M.iridescenceThicknessMap,Ye=se&&!!M.sheenColorMap,De=se&&!!M.sheenRoughnessMap,gt=!!M.specularMap,lt=!!M.specularColorMap,Ot=!!M.specularIntensityMap,G=ke&&!!M.transmissionMap,Se=ke&&!!M.thicknessMap,ee=!!M.gradientMap,ue=!!M.alphaMap,Me=M.alphaTest>0,we=!!M.alphaHash,rt=!!M.extensions;let an=Ai;M.toneMapped&&(re===null||re.isXRRenderTarget===!0)&&(an=n.toneMapping);const ri={shaderID:Z,shaderType:M.type,shaderName:M.name,vertexShader:Ie,fragmentShader:O,defines:M.defines,customVertexShaderID:X,customFragmentShaderID:ae,isRawShaderMaterial:M.isRawShaderMaterial===!0,glslVersion:M.glslVersion,precision:f,batching:Fe,batchingColor:Fe&&B._colorsTexture!==null,instancing:Re,instancingColor:Re&&B.instanceColor!==null,instancingMorph:Re&&B.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:re===null?n.outputColorSpace:re.isXRRenderTarget===!0?re.texture.colorSpace:mr,alphaToCoverage:!!M.alphaToCoverage,map:mt,matcap:ut,envMap:Ct,envMapMode:Ct&&ie.mapping,envMapCubeUVHeight:k,aoMap:F,lightMap:nn,bumpMap:ct,normalMap:dt,displacementMap:d&&Ge,emissiveMap:Ht,normalMapObjectSpace:dt&&M.normalMapType===jM,normalMapTangentSpace:dt&&M.normalMapType===Rs,metalnessMap:ze,roughnessMap:P,anisotropy:A,anisotropyMap:be,clearcoat:j,clearcoatMap:Ne,clearcoatNormalMap:xt,clearcoatRoughnessMap:_e,dispersion:le,iridescence:de,iridescenceMap:Pe,iridescenceThicknessMap:$e,sheen:se,sheenColorMap:Ye,sheenRoughnessMap:De,specularMap:gt,specularColorMap:lt,specularIntensityMap:Ot,transmission:ke,transmissionMap:G,thicknessMap:Se,gradientMap:ee,opaque:M.transparent===!1&&M.blending===dr&&M.alphaToCoverage===!1,alphaMap:ue,alphaTest:Me,alphaHash:we,combine:M.combine,mapUv:mt&&_(M.map.channel),aoMapUv:F&&_(M.aoMap.channel),lightMapUv:nn&&_(M.lightMap.channel),bumpMapUv:ct&&_(M.bumpMap.channel),normalMapUv:dt&&_(M.normalMap.channel),displacementMapUv:Ge&&_(M.displacementMap.channel),emissiveMapUv:Ht&&_(M.emissiveMap.channel),metalnessMapUv:ze&&_(M.metalnessMap.channel),roughnessMapUv:P&&_(M.roughnessMap.channel),anisotropyMapUv:be&&_(M.anisotropyMap.channel),clearcoatMapUv:Ne&&_(M.clearcoatMap.channel),clearcoatNormalMapUv:xt&&_(M.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:_e&&_(M.clearcoatRoughnessMap.channel),iridescenceMapUv:Pe&&_(M.iridescenceMap.channel),iridescenceThicknessMapUv:$e&&_(M.iridescenceThicknessMap.channel),sheenColorMapUv:Ye&&_(M.sheenColorMap.channel),sheenRoughnessMapUv:De&&_(M.sheenRoughnessMap.channel),specularMapUv:gt&&_(M.specularMap.channel),specularColorMapUv:lt&&_(M.specularColorMap.channel),specularIntensityMapUv:Ot&&_(M.specularIntensityMap.channel),transmissionMapUv:G&&_(M.transmissionMap.channel),thicknessMapUv:Se&&_(M.thicknessMap.channel),alphaMapUv:ue&&_(M.alphaMap.channel),vertexTangents:!!L.attributes.tangent&&(dt||A),vertexColors:M.vertexColors,vertexAlphas:M.vertexColors===!0&&!!L.attributes.color&&L.attributes.color.itemSize===4,pointsUvs:B.isPoints===!0&&!!L.attributes.uv&&(mt||ue),fog:!!D,useFog:M.fog===!0,fogExp2:!!D&&D.isFogExp2,flatShading:M.flatShading===!0,sizeAttenuation:M.sizeAttenuation===!0,logarithmicDepthBuffer:h,reverseDepthBuffer:Ee,skinning:B.isSkinnedMesh===!0,morphTargets:L.morphAttributes.position!==void 0,morphNormals:L.morphAttributes.normal!==void 0,morphColors:L.morphAttributes.color!==void 0,morphTargetsCount:K,morphTextureStride:he,numDirLights:b.directional.length,numPointLights:b.point.length,numSpotLights:b.spot.length,numSpotLightMaps:b.spotLightMap.length,numRectAreaLights:b.rectArea.length,numHemiLights:b.hemi.length,numDirLightShadows:b.directionalShadowMap.length,numPointLightShadows:b.pointShadowMap.length,numSpotLightShadows:b.spotShadowMap.length,numSpotLightShadowsWithMaps:b.numSpotLightShadowsWithMaps,numLightProbes:b.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:M.dithering,shadowMapEnabled:n.shadowMap.enabled&&R.length>0,shadowMapType:n.shadowMap.type,toneMapping:an,decodeVideoTexture:mt&&M.map.isVideoTexture===!0&&st.getTransfer(M.map.colorSpace)===Et,decodeVideoTextureEmissive:Ht&&M.emissiveMap.isVideoTexture===!0&&st.getTransfer(M.emissiveMap.colorSpace)===Et,premultipliedAlpha:M.premultipliedAlpha,doubleSided:M.side===ui,flipSided:M.side===$t,useDepthPacking:M.depthPacking>=0,depthPacking:M.depthPacking||0,index0AttributeName:M.index0AttributeName,extensionClipCullDistance:rt&&M.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(rt&&M.extensions.multiDraw===!0||Fe)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:M.customProgramCacheKey()};return ri.vertexUv1s=u.has(1),ri.vertexUv2s=u.has(2),ri.vertexUv3s=u.has(3),u.clear(),ri}function p(M){const b=[];if(M.shaderID?b.push(M.shaderID):(b.push(M.customVertexShaderID),b.push(M.customFragmentShaderID)),M.defines!==void 0)for(const R in M.defines)b.push(R),b.push(M.defines[R]);return M.isRawShaderMaterial===!1&&(v(b,M),y(b,M),b.push(n.outputColorSpace)),b.push(M.customProgramCacheKey),b.join()}function v(M,b){M.push(b.precision),M.push(b.outputColorSpace),M.push(b.envMapMode),M.push(b.envMapCubeUVHeight),M.push(b.mapUv),M.push(b.alphaMapUv),M.push(b.lightMapUv),M.push(b.aoMapUv),M.push(b.bumpMapUv),M.push(b.normalMapUv),M.push(b.displacementMapUv),M.push(b.emissiveMapUv),M.push(b.metalnessMapUv),M.push(b.roughnessMapUv),M.push(b.anisotropyMapUv),M.push(b.clearcoatMapUv),M.push(b.clearcoatNormalMapUv),M.push(b.clearcoatRoughnessMapUv),M.push(b.iridescenceMapUv),M.push(b.iridescenceThicknessMapUv),M.push(b.sheenColorMapUv),M.push(b.sheenRoughnessMapUv),M.push(b.specularMapUv),M.push(b.specularColorMapUv),M.push(b.specularIntensityMapUv),M.push(b.transmissionMapUv),M.push(b.thicknessMapUv),M.push(b.combine),M.push(b.fogExp2),M.push(b.sizeAttenuation),M.push(b.morphTargetsCount),M.push(b.morphAttributeCount),M.push(b.numDirLights),M.push(b.numPointLights),M.push(b.numSpotLights),M.push(b.numSpotLightMaps),M.push(b.numHemiLights),M.push(b.numRectAreaLights),M.push(b.numDirLightShadows),M.push(b.numPointLightShadows),M.push(b.numSpotLightShadows),M.push(b.numSpotLightShadowsWithMaps),M.push(b.numLightProbes),M.push(b.shadowMapType),M.push(b.toneMapping),M.push(b.numClippingPlanes),M.push(b.numClipIntersection),M.push(b.depthPacking)}function y(M,b){a.disableAll(),b.supportsVertexTextures&&a.enable(0),b.instancing&&a.enable(1),b.instancingColor&&a.enable(2),b.instancingMorph&&a.enable(3),b.matcap&&a.enable(4),b.envMap&&a.enable(5),b.normalMapObjectSpace&&a.enable(6),b.normalMapTangentSpace&&a.enable(7),b.clearcoat&&a.enable(8),b.iridescence&&a.enable(9),b.alphaTest&&a.enable(10),b.vertexColors&&a.enable(11),b.vertexAlphas&&a.enable(12),b.vertexUv1s&&a.enable(13),b.vertexUv2s&&a.enable(14),b.vertexUv3s&&a.enable(15),b.vertexTangents&&a.enable(16),b.anisotropy&&a.enable(17),b.alphaHash&&a.enable(18),b.batching&&a.enable(19),b.dispersion&&a.enable(20),b.batchingColor&&a.enable(21),M.push(a.mask),a.disableAll(),b.fog&&a.enable(0),b.useFog&&a.enable(1),b.flatShading&&a.enable(2),b.logarithmicDepthBuffer&&a.enable(3),b.reverseDepthBuffer&&a.enable(4),b.skinning&&a.enable(5),b.morphTargets&&a.enable(6),b.morphNormals&&a.enable(7),b.morphColors&&a.enable(8),b.premultipliedAlpha&&a.enable(9),b.shadowMapEnabled&&a.enable(10),b.doubleSided&&a.enable(11),b.flipSided&&a.enable(12),b.useDepthPacking&&a.enable(13),b.dithering&&a.enable(14),b.transmission&&a.enable(15),b.sheen&&a.enable(16),b.opaque&&a.enable(17),b.pointsUvs&&a.enable(18),b.decodeVideoTexture&&a.enable(19),b.decodeVideoTextureEmissive&&a.enable(20),b.alphaToCoverage&&a.enable(21),M.push(a.mask)}function x(M){const b=m[M.type];let R;if(b){const I=ss[b];R=gE.clone(I.uniforms)}else R=M.uniforms;return R}function T(M,b){let R;for(let I=0,B=c.length;I<B;I++){const D=c[I];if(D.cacheKey===b){R=D,++R.usedTimes;break}}return R===void 0&&(R=new wB(n,b,M,s),c.push(R)),R}function S(M){if(--M.usedTimes===0){const b=c.indexOf(M);c[b]=c[c.length-1],c.pop(),M.destroy()}}function w(M){l.remove(M)}function E(){l.dispose()}return{getParameters:g,getProgramCacheKey:p,getUniforms:x,acquireProgram:T,releaseProgram:S,releaseShaderCache:w,programs:c,dispose:E}}function RB(){let n=new WeakMap;function e(o){return n.has(o)}function t(o){let a=n.get(o);return a===void 0&&(a={},n.set(o,a)),a}function i(o){n.delete(o)}function r(o,a,l){n.get(o)[a]=l}function s(){n=new WeakMap}return{has:e,get:t,remove:i,update:r,dispose:s}}function NB(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function _1(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function v1(){const n=[];let e=0;const t=[],i=[],r=[];function s(){e=0,t.length=0,i.length=0,r.length=0}function o(h,d,f,m,_,g){let p=n[e];return p===void 0?(p={id:h.id,object:h,geometry:d,material:f,groupOrder:m,renderOrder:h.renderOrder,z:_,group:g},n[e]=p):(p.id=h.id,p.object=h,p.geometry=d,p.material=f,p.groupOrder=m,p.renderOrder=h.renderOrder,p.z=_,p.group=g),e++,p}function a(h,d,f,m,_,g){const p=o(h,d,f,m,_,g);f.transmission>0?i.push(p):f.transparent===!0?r.push(p):t.push(p)}function l(h,d,f,m,_,g){const p=o(h,d,f,m,_,g);f.transmission>0?i.unshift(p):f.transparent===!0?r.unshift(p):t.unshift(p)}function u(h,d){t.length>1&&t.sort(h||NB),i.length>1&&i.sort(d||_1),r.length>1&&r.sort(d||_1)}function c(){for(let h=e,d=n.length;h<d;h++){const f=n[h];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:t,transmissive:i,transparent:r,init:s,push:a,unshift:l,finish:c,sort:u}}function PB(){let n=new WeakMap;function e(i,r){const s=n.get(i);let o;return s===void 0?(o=new v1,n.set(i,[o])):r>=s.length?(o=new v1,s.push(o)):o=s[r],o}function t(){n=new WeakMap}return{get:e,dispose:t}}function DB(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new N,color:new Ue};break;case"SpotLight":t={position:new N,direction:new N,color:new Ue,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new N,color:new Ue,distance:0,decay:0};break;case"HemisphereLight":t={direction:new N,skyColor:new Ue,groundColor:new Ue};break;case"RectAreaLight":t={color:new Ue,position:new N,halfWidth:new N,halfHeight:new N};break}return n[e.id]=t,t}}}function LB(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ce};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ce};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ce,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let IB=0;function UB(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function FB(n){const e=new DB,t=LB(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)i.probe.push(new N);const r=new N,s=new pt,o=new pt;function a(u){let c=0,h=0,d=0;for(let M=0;M<9;M++)i.probe[M].set(0,0,0);let f=0,m=0,_=0,g=0,p=0,v=0,y=0,x=0,T=0,S=0,w=0;u.sort(UB);for(let M=0,b=u.length;M<b;M++){const R=u[M],I=R.color,B=R.intensity,D=R.distance,L=R.shadow&&R.shadow.map?R.shadow.map.texture:null;if(R.isAmbientLight)c+=I.r*B,h+=I.g*B,d+=I.b*B;else if(R.isLightProbe){for(let z=0;z<9;z++)i.probe[z].addScaledVector(R.sh.coefficients[z],B);w++}else if(R.isDirectionalLight){const z=e.get(R);if(z.color.copy(R.color).multiplyScalar(R.intensity),R.castShadow){const ie=R.shadow,k=t.get(R);k.shadowIntensity=ie.intensity,k.shadowBias=ie.bias,k.shadowNormalBias=ie.normalBias,k.shadowRadius=ie.radius,k.shadowMapSize=ie.mapSize,i.directionalShadow[f]=k,i.directionalShadowMap[f]=L,i.directionalShadowMatrix[f]=R.shadow.matrix,v++}i.directional[f]=z,f++}else if(R.isSpotLight){const z=e.get(R);z.position.setFromMatrixPosition(R.matrixWorld),z.color.copy(I).multiplyScalar(B),z.distance=D,z.coneCos=Math.cos(R.angle),z.penumbraCos=Math.cos(R.angle*(1-R.penumbra)),z.decay=R.decay,i.spot[_]=z;const ie=R.shadow;if(R.map&&(i.spotLightMap[T]=R.map,T++,ie.updateMatrices(R),R.castShadow&&S++),i.spotLightMatrix[_]=ie.matrix,R.castShadow){const k=t.get(R);k.shadowIntensity=ie.intensity,k.shadowBias=ie.bias,k.shadowNormalBias=ie.normalBias,k.shadowRadius=ie.radius,k.shadowMapSize=ie.mapSize,i.spotShadow[_]=k,i.spotShadowMap[_]=L,x++}_++}else if(R.isRectAreaLight){const z=e.get(R);z.color.copy(I).multiplyScalar(B),z.halfWidth.set(R.width*.5,0,0),z.halfHeight.set(0,R.height*.5,0),i.rectArea[g]=z,g++}else if(R.isPointLight){const z=e.get(R);if(z.color.copy(R.color).multiplyScalar(R.intensity),z.distance=R.distance,z.decay=R.decay,R.castShadow){const ie=R.shadow,k=t.get(R);k.shadowIntensity=ie.intensity,k.shadowBias=ie.bias,k.shadowNormalBias=ie.normalBias,k.shadowRadius=ie.radius,k.shadowMapSize=ie.mapSize,k.shadowCameraNear=ie.camera.near,k.shadowCameraFar=ie.camera.far,i.pointShadow[m]=k,i.pointShadowMap[m]=L,i.pointShadowMatrix[m]=R.shadow.matrix,y++}i.point[m]=z,m++}else if(R.isHemisphereLight){const z=e.get(R);z.skyColor.copy(R.color).multiplyScalar(B),z.groundColor.copy(R.groundColor).multiplyScalar(B),i.hemi[p]=z,p++}}g>0&&(n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=xe.LTC_FLOAT_1,i.rectAreaLTC2=xe.LTC_FLOAT_2):(i.rectAreaLTC1=xe.LTC_HALF_1,i.rectAreaLTC2=xe.LTC_HALF_2)),i.ambient[0]=c,i.ambient[1]=h,i.ambient[2]=d;const E=i.hash;(E.directionalLength!==f||E.pointLength!==m||E.spotLength!==_||E.rectAreaLength!==g||E.hemiLength!==p||E.numDirectionalShadows!==v||E.numPointShadows!==y||E.numSpotShadows!==x||E.numSpotMaps!==T||E.numLightProbes!==w)&&(i.directional.length=f,i.spot.length=_,i.rectArea.length=g,i.point.length=m,i.hemi.length=p,i.directionalShadow.length=v,i.directionalShadowMap.length=v,i.pointShadow.length=y,i.pointShadowMap.length=y,i.spotShadow.length=x,i.spotShadowMap.length=x,i.directionalShadowMatrix.length=v,i.pointShadowMatrix.length=y,i.spotLightMatrix.length=x+T-S,i.spotLightMap.length=T,i.numSpotLightShadowsWithMaps=S,i.numLightProbes=w,E.directionalLength=f,E.pointLength=m,E.spotLength=_,E.rectAreaLength=g,E.hemiLength=p,E.numDirectionalShadows=v,E.numPointShadows=y,E.numSpotShadows=x,E.numSpotMaps=T,E.numLightProbes=w,i.version=IB++)}function l(u,c){let h=0,d=0,f=0,m=0,_=0;const g=c.matrixWorldInverse;for(let p=0,v=u.length;p<v;p++){const y=u[p];if(y.isDirectionalLight){const x=i.directional[h];x.direction.setFromMatrixPosition(y.matrixWorld),r.setFromMatrixPosition(y.target.matrixWorld),x.direction.sub(r),x.direction.transformDirection(g),h++}else if(y.isSpotLight){const x=i.spot[f];x.position.setFromMatrixPosition(y.matrixWorld),x.position.applyMatrix4(g),x.direction.setFromMatrixPosition(y.matrixWorld),r.setFromMatrixPosition(y.target.matrixWorld),x.direction.sub(r),x.direction.transformDirection(g),f++}else if(y.isRectAreaLight){const x=i.rectArea[m];x.position.setFromMatrixPosition(y.matrixWorld),x.position.applyMatrix4(g),o.identity(),s.copy(y.matrixWorld),s.premultiply(g),o.extractRotation(s),x.halfWidth.set(y.width*.5,0,0),x.halfHeight.set(0,y.height*.5,0),x.halfWidth.applyMatrix4(o),x.halfHeight.applyMatrix4(o),m++}else if(y.isPointLight){const x=i.point[d];x.position.setFromMatrixPosition(y.matrixWorld),x.position.applyMatrix4(g),d++}else if(y.isHemisphereLight){const x=i.hemi[_];x.direction.setFromMatrixPosition(y.matrixWorld),x.direction.transformDirection(g),_++}}}return{setup:a,setupView:l,state:i}}function y1(n){const e=new FB(n),t=[],i=[];function r(c){u.camera=c,t.length=0,i.length=0}function s(c){t.push(c)}function o(c){i.push(c)}function a(){e.setup(t)}function l(c){e.setupView(t,c)}const u={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:u,setupLights:a,setupLightsView:l,pushLight:s,pushShadow:o}}function OB(n){let e=new WeakMap;function t(r,s=0){const o=e.get(r);let a;return o===void 0?(a=new y1(n),e.set(r,[a])):s>=o.length?(a=new y1(n),o.push(a)):a=o[s],a}function i(){e=new WeakMap}return{get:t,dispose:i}}const BB=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,kB=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function zB(n,e,t){let i=new Fp;const r=new ce,s=new ce,o=new et,a=new LU({depthPacking:sI}),l=new IU,u={},c=t.maxTextureSize,h={[Nr]:$t,[$t]:Nr,[ui]:ui},d=new rs({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ce},radius:{value:4}},vertexShader:BB,fragmentShader:kB}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const m=new ei;m.setAttribute("position",new Vn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new On(m,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=jv;let p=this.type;this.render=function(S,w,E){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||S.length===0)return;const M=n.getRenderTarget(),b=n.getActiveCubeFace(),R=n.getActiveMipmapLevel(),I=n.state;I.setBlending(Ei),I.buffers.color.setClear(1,1,1,1),I.buffers.depth.setTest(!0),I.setScissorTest(!1);const B=p!==Xi&&this.type===Xi,D=p===Xi&&this.type!==Xi;for(let L=0,z=S.length;L<z;L++){const ie=S[L],k=ie.shadow;if(k===void 0){console.warn("THREE.WebGLShadowMap:",ie,"has no shadow.");continue}if(k.autoUpdate===!1&&k.needsUpdate===!1)continue;r.copy(k.mapSize);const Z=k.getFrameExtents();if(r.multiply(Z),s.copy(k.mapSize),(r.x>c||r.y>c)&&(r.x>c&&(s.x=Math.floor(c/Z.x),r.x=s.x*Z.x,k.mapSize.x=s.x),r.y>c&&(s.y=Math.floor(c/Z.y),r.y=s.y*Z.y,k.mapSize.y=s.y)),k.map===null||B===!0||D===!0){const K=this.type!==Xi?{minFilter:zt,magFilter:zt}:{};k.map!==null&&k.map.dispose(),k.map=new Fo(r.x,r.y,K),k.map.texture.name=ie.name+".shadowMap",k.camera.updateProjectionMatrix()}n.setRenderTarget(k.map),n.clear();const W=k.getViewportCount();for(let K=0;K<W;K++){const he=k.getViewport(K);o.set(s.x*he.x,s.y*he.y,s.x*he.z,s.y*he.w),I.viewport(o),k.updateMatrices(ie,K),i=k.getFrustum(),x(w,E,k.camera,ie,this.type)}k.isPointLightShadow!==!0&&this.type===Xi&&v(k,E),k.needsUpdate=!1}p=this.type,g.needsUpdate=!1,n.setRenderTarget(M,b,R)};function v(S,w){const E=e.update(_);d.defines.VSM_SAMPLES!==S.blurSamples&&(d.defines.VSM_SAMPLES=S.blurSamples,f.defines.VSM_SAMPLES=S.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),S.mapPass===null&&(S.mapPass=new Fo(r.x,r.y)),d.uniforms.shadow_pass.value=S.map.texture,d.uniforms.resolution.value=S.mapSize,d.uniforms.radius.value=S.radius,n.setRenderTarget(S.mapPass),n.clear(),n.renderBufferDirect(w,null,E,d,_,null),f.uniforms.shadow_pass.value=S.mapPass.texture,f.uniforms.resolution.value=S.mapSize,f.uniforms.radius.value=S.radius,n.setRenderTarget(S.map),n.clear(),n.renderBufferDirect(w,null,E,f,_,null)}function y(S,w,E,M){let b=null;const R=E.isPointLight===!0?S.customDistanceMaterial:S.customDepthMaterial;if(R!==void 0)b=R;else if(b=E.isPointLight===!0?l:a,n.localClippingEnabled&&w.clipShadows===!0&&Array.isArray(w.clippingPlanes)&&w.clippingPlanes.length!==0||w.displacementMap&&w.displacementScale!==0||w.alphaMap&&w.alphaTest>0||w.map&&w.alphaTest>0){const I=b.uuid,B=w.uuid;let D=u[I];D===void 0&&(D={},u[I]=D);let L=D[B];L===void 0&&(L=b.clone(),D[B]=L,w.addEventListener("dispose",T)),b=L}if(b.visible=w.visible,b.wireframe=w.wireframe,M===Xi?b.side=w.shadowSide!==null?w.shadowSide:w.side:b.side=w.shadowSide!==null?w.shadowSide:h[w.side],b.alphaMap=w.alphaMap,b.alphaTest=w.alphaTest,b.map=w.map,b.clipShadows=w.clipShadows,b.clippingPlanes=w.clippingPlanes,b.clipIntersection=w.clipIntersection,b.displacementMap=w.displacementMap,b.displacementScale=w.displacementScale,b.displacementBias=w.displacementBias,b.wireframeLinewidth=w.wireframeLinewidth,b.linewidth=w.linewidth,E.isPointLight===!0&&b.isMeshDistanceMaterial===!0){const I=n.properties.get(b);I.light=E}return b}function x(S,w,E,M,b){if(S.visible===!1)return;if(S.layers.test(w.layers)&&(S.isMesh||S.isLine||S.isPoints)&&(S.castShadow||S.receiveShadow&&b===Xi)&&(!S.frustumCulled||i.intersectsObject(S))){S.modelViewMatrix.multiplyMatrices(E.matrixWorldInverse,S.matrixWorld);const B=e.update(S),D=S.material;if(Array.isArray(D)){const L=B.groups;for(let z=0,ie=L.length;z<ie;z++){const k=L[z],Z=D[k.materialIndex];if(Z&&Z.visible){const W=y(S,Z,M,b);S.onBeforeShadow(n,S,w,E,B,W,k),n.renderBufferDirect(E,null,B,W,S,k),S.onAfterShadow(n,S,w,E,B,W,k)}}}else if(D.visible){const L=y(S,D,M,b);S.onBeforeShadow(n,S,w,E,B,L,null),n.renderBufferDirect(E,null,B,L,S,null),S.onAfterShadow(n,S,w,E,B,L,null)}}const I=S.children;for(let B=0,D=I.length;B<D;B++)x(I[B],w,E,M,b)}function T(S){S.target.removeEventListener("dispose",T);for(const E in u){const M=u[E],b=S.target.uuid;b in M&&(M[b].dispose(),delete M[b])}}}const GB={[rh]:sh,[oh]:uh,[ah]:ch,[Ro]:lh,[sh]:rh,[uh]:oh,[ch]:ah,[lh]:Ro};function VB(n,e){function t(){let G=!1;const Se=new et;let ee=null;const ue=new et(0,0,0,0);return{setMask:function(Me){ee!==Me&&!G&&(n.colorMask(Me,Me,Me,Me),ee=Me)},setLocked:function(Me){G=Me},setClear:function(Me,we,rt,an,ri){ri===!0&&(Me*=an,we*=an,rt*=an),Se.set(Me,we,rt,an),ue.equals(Se)===!1&&(n.clearColor(Me,we,rt,an),ue.copy(Se))},reset:function(){G=!1,ee=null,ue.set(-1,0,0,0)}}}function i(){let G=!1,Se=!1,ee=null,ue=null,Me=null;return{setReversed:function(we){if(Se!==we){const rt=e.get("EXT_clip_control");Se?rt.clipControlEXT(rt.LOWER_LEFT_EXT,rt.ZERO_TO_ONE_EXT):rt.clipControlEXT(rt.LOWER_LEFT_EXT,rt.NEGATIVE_ONE_TO_ONE_EXT);const an=Me;Me=null,this.setClear(an)}Se=we},getReversed:function(){return Se},setTest:function(we){we?re(n.DEPTH_TEST):Ee(n.DEPTH_TEST)},setMask:function(we){ee!==we&&!G&&(n.depthMask(we),ee=we)},setFunc:function(we){if(Se&&(we=GB[we]),ue!==we){switch(we){case rh:n.depthFunc(n.NEVER);break;case sh:n.depthFunc(n.ALWAYS);break;case oh:n.depthFunc(n.LESS);break;case Ro:n.depthFunc(n.LEQUAL);break;case ah:n.depthFunc(n.EQUAL);break;case lh:n.depthFunc(n.GEQUAL);break;case uh:n.depthFunc(n.GREATER);break;case ch:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}ue=we}},setLocked:function(we){G=we},setClear:function(we){Me!==we&&(Se&&(we=1-we),n.clearDepth(we),Me=we)},reset:function(){G=!1,ee=null,ue=null,Me=null,Se=!1}}}function r(){let G=!1,Se=null,ee=null,ue=null,Me=null,we=null,rt=null,an=null,ri=null;return{setTest:function(Lt){G||(Lt?re(n.STENCIL_TEST):Ee(n.STENCIL_TEST))},setMask:function(Lt){Se!==Lt&&!G&&(n.stencilMask(Lt),Se=Lt)},setFunc:function(Lt,jr,ao){(ee!==Lt||ue!==jr||Me!==ao)&&(n.stencilFunc(Lt,jr,ao),ee=Lt,ue=jr,Me=ao)},setOp:function(Lt,jr,ao){(we!==Lt||rt!==jr||an!==ao)&&(n.stencilOp(Lt,jr,ao),we=Lt,rt=jr,an=ao)},setLocked:function(Lt){G=Lt},setClear:function(Lt){ri!==Lt&&(n.clearStencil(Lt),ri=Lt)},reset:function(){G=!1,Se=null,ee=null,ue=null,Me=null,we=null,rt=null,an=null,ri=null}}}const s=new t,o=new i,a=new r,l=new WeakMap,u=new WeakMap;let c={},h={},d=new WeakMap,f=[],m=null,_=!1,g=null,p=null,v=null,y=null,x=null,T=null,S=null,w=new Ue(0,0,0),E=0,M=!1,b=null,R=null,I=null,B=null,D=null;const L=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let z=!1,ie=0;const k=n.getParameter(n.VERSION);k.indexOf("WebGL")!==-1?(ie=parseFloat(/^WebGL (\d)/.exec(k)[1]),z=ie>=1):k.indexOf("OpenGL ES")!==-1&&(ie=parseFloat(/^OpenGL ES (\d)/.exec(k)[1]),z=ie>=2);let Z=null,W={};const K=n.getParameter(n.SCISSOR_BOX),he=n.getParameter(n.VIEWPORT),Ie=new et().fromArray(K),O=new et().fromArray(he);function X(G,Se,ee,ue){const Me=new Uint8Array(4),we=n.createTexture();n.bindTexture(G,we),n.texParameteri(G,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(G,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let rt=0;rt<ee;rt++)G===n.TEXTURE_3D||G===n.TEXTURE_2D_ARRAY?n.texImage3D(Se,0,n.RGBA,1,1,ue,0,n.RGBA,n.UNSIGNED_BYTE,Me):n.texImage2D(Se+rt,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,Me);return we}const ae={};ae[n.TEXTURE_2D]=X(n.TEXTURE_2D,n.TEXTURE_2D,1),ae[n.TEXTURE_CUBE_MAP]=X(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),ae[n.TEXTURE_2D_ARRAY]=X(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),ae[n.TEXTURE_3D]=X(n.TEXTURE_3D,n.TEXTURE_3D,1,1),s.setClear(0,0,0,1),o.setClear(1),a.setClear(0),re(n.DEPTH_TEST),o.setFunc(Ro),ct(!1),dt($v),re(n.CULL_FACE),F(Ei);function re(G){c[G]!==!0&&(n.enable(G),c[G]=!0)}function Ee(G){c[G]!==!1&&(n.disable(G),c[G]=!1)}function Re(G,Se){return h[G]!==Se?(n.bindFramebuffer(G,Se),h[G]=Se,G===n.DRAW_FRAMEBUFFER&&(h[n.FRAMEBUFFER]=Se),G===n.FRAMEBUFFER&&(h[n.DRAW_FRAMEBUFFER]=Se),!0):!1}function Fe(G,Se){let ee=f,ue=!1;if(G){ee=d.get(Se),ee===void 0&&(ee=[],d.set(Se,ee));const Me=G.textures;if(ee.length!==Me.length||ee[0]!==n.COLOR_ATTACHMENT0){for(let we=0,rt=Me.length;we<rt;we++)ee[we]=n.COLOR_ATTACHMENT0+we;ee.length=Me.length,ue=!0}}else ee[0]!==n.BACK&&(ee[0]=n.BACK,ue=!0);ue&&n.drawBuffers(ee)}function mt(G){return m!==G?(n.useProgram(G),m=G,!0):!1}const ut={[qi]:n.FUNC_ADD,[qv]:n.FUNC_SUBTRACT,[Yv]:n.FUNC_REVERSE_SUBTRACT};ut[FM]=n.MIN,ut[OM]=n.MAX;const Ct={[Kv]:n.ZERO,[Qv]:n.ONE,[Zv]:n.SRC_COLOR,[nh]:n.SRC_ALPHA,[ry]:n.SRC_ALPHA_SATURATE,[ny]:n.DST_COLOR,[ey]:n.DST_ALPHA,[Jv]:n.ONE_MINUS_SRC_COLOR,[ih]:n.ONE_MINUS_SRC_ALPHA,[iy]:n.ONE_MINUS_DST_COLOR,[ty]:n.ONE_MINUS_DST_ALPHA,[ZL]:n.CONSTANT_COLOR,[JL]:n.ONE_MINUS_CONSTANT_COLOR,[eI]:n.CONSTANT_ALPHA,[tI]:n.ONE_MINUS_CONSTANT_ALPHA};function F(G,Se,ee,ue,Me,we,rt,an,ri,Lt){if(G===Ei){_===!0&&(Ee(n.BLEND),_=!1);return}if(_===!1&&(re(n.BLEND),_=!0),G!==Xv){if(G!==g||Lt!==M){if((p!==qi||x!==qi)&&(n.blendEquation(n.FUNC_ADD),p=qi,x=qi),Lt)switch(G){case dr:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case zl:n.blendFunc(n.ONE,n.ONE);break;case Gl:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case Vl:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",G);break}else switch(G){case dr:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case zl:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case Gl:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case Vl:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",G);break}v=null,y=null,T=null,S=null,w.set(0,0,0),E=0,g=G,M=Lt}return}Me=Me||Se,we=we||ee,rt=rt||ue,(Se!==p||Me!==x)&&(n.blendEquationSeparate(ut[Se],ut[Me]),p=Se,x=Me),(ee!==v||ue!==y||we!==T||rt!==S)&&(n.blendFuncSeparate(Ct[ee],Ct[ue],Ct[we],Ct[rt]),v=ee,y=ue,T=we,S=rt),(an.equals(w)===!1||ri!==E)&&(n.blendColor(an.r,an.g,an.b,ri),w.copy(an),E=ri),g=G,M=!1}function nn(G,Se){G.side===ui?Ee(n.CULL_FACE):re(n.CULL_FACE);let ee=G.side===$t;Se&&(ee=!ee),ct(ee),G.blending===dr&&G.transparent===!1?F(Ei):F(G.blending,G.blendEquation,G.blendSrc,G.blendDst,G.blendEquationAlpha,G.blendSrcAlpha,G.blendDstAlpha,G.blendColor,G.blendAlpha,G.premultipliedAlpha),o.setFunc(G.depthFunc),o.setTest(G.depthTest),o.setMask(G.depthWrite),s.setMask(G.colorWrite);const ue=G.stencilWrite;a.setTest(ue),ue&&(a.setMask(G.stencilWriteMask),a.setFunc(G.stencilFunc,G.stencilRef,G.stencilFuncMask),a.setOp(G.stencilFail,G.stencilZFail,G.stencilZPass)),Ht(G.polygonOffset,G.polygonOffsetFactor,G.polygonOffsetUnits),G.alphaToCoverage===!0?re(n.SAMPLE_ALPHA_TO_COVERAGE):Ee(n.SAMPLE_ALPHA_TO_COVERAGE)}function ct(G){b!==G&&(G?n.frontFace(n.CW):n.frontFace(n.CCW),b=G)}function dt(G){G!==IM?(re(n.CULL_FACE),G!==R&&(G===$v?n.cullFace(n.BACK):G===UM?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):Ee(n.CULL_FACE),R=G}function Ge(G){G!==I&&(z&&n.lineWidth(G),I=G)}function Ht(G,Se,ee){G?(re(n.POLYGON_OFFSET_FILL),(B!==Se||D!==ee)&&(n.polygonOffset(Se,ee),B=Se,D=ee)):Ee(n.POLYGON_OFFSET_FILL)}function ze(G){G?re(n.SCISSOR_TEST):Ee(n.SCISSOR_TEST)}function P(G){G===void 0&&(G=n.TEXTURE0+L-1),Z!==G&&(n.activeTexture(G),Z=G)}function A(G,Se,ee){ee===void 0&&(Z===null?ee=n.TEXTURE0+L-1:ee=Z);let ue=W[ee];ue===void 0&&(ue={type:void 0,texture:void 0},W[ee]=ue),(ue.type!==G||ue.texture!==Se)&&(Z!==ee&&(n.activeTexture(ee),Z=ee),n.bindTexture(G,Se||ae[G]),ue.type=G,ue.texture=Se)}function j(){const G=W[Z];G!==void 0&&G.type!==void 0&&(n.bindTexture(G.type,null),G.type=void 0,G.texture=void 0)}function le(){try{n.compressedTexImage2D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function de(){try{n.compressedTexImage3D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function se(){try{n.texSubImage2D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function ke(){try{n.texSubImage3D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function be(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function Ne(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function xt(){try{n.texStorage2D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function _e(){try{n.texStorage3D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function Pe(){try{n.texImage2D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function $e(){try{n.texImage3D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function Ye(G){Ie.equals(G)===!1&&(n.scissor(G.x,G.y,G.z,G.w),Ie.copy(G))}function De(G){O.equals(G)===!1&&(n.viewport(G.x,G.y,G.z,G.w),O.copy(G))}function gt(G,Se){let ee=u.get(Se);ee===void 0&&(ee=new WeakMap,u.set(Se,ee));let ue=ee.get(G);ue===void 0&&(ue=n.getUniformBlockIndex(Se,G.name),ee.set(G,ue))}function lt(G,Se){const ue=u.get(Se).get(G);l.get(Se)!==ue&&(n.uniformBlockBinding(Se,ue,G.__bindingPointIndex),l.set(Se,ue))}function Ot(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),o.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),c={},Z=null,W={},h={},d=new WeakMap,f=[],m=null,_=!1,g=null,p=null,v=null,y=null,x=null,T=null,S=null,w=new Ue(0,0,0),E=0,M=!1,b=null,R=null,I=null,B=null,D=null,Ie.set(0,0,n.canvas.width,n.canvas.height),O.set(0,0,n.canvas.width,n.canvas.height),s.reset(),o.reset(),a.reset()}return{buffers:{color:s,depth:o,stencil:a},enable:re,disable:Ee,bindFramebuffer:Re,drawBuffers:Fe,useProgram:mt,setBlending:F,setMaterial:nn,setFlipSided:ct,setCullFace:dt,setLineWidth:Ge,setPolygonOffset:Ht,setScissorTest:ze,activeTexture:P,bindTexture:A,unbindTexture:j,compressedTexImage2D:le,compressedTexImage3D:de,texImage2D:Pe,texImage3D:$e,updateUBOMapping:gt,uniformBlockBinding:lt,texStorage2D:xt,texStorage3D:_e,texSubImage2D:se,texSubImage3D:ke,compressedTexSubImage2D:be,compressedTexSubImage3D:Ne,scissor:Ye,viewport:De,reset:Ot}}function HB(n,e,t,i,r,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new ce,c=new WeakMap;let h;const d=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function m(P,A){return f?new OffscreenCanvas(P,A):wh("canvas")}function _(P,A,j){let le=1;const de=ze(P);if((de.width>j||de.height>j)&&(le=j/Math.max(de.width,de.height)),le<1)if(typeof HTMLImageElement<"u"&&P instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&P instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&P instanceof ImageBitmap||typeof VideoFrame<"u"&&P instanceof VideoFrame){const se=Math.floor(le*de.width),ke=Math.floor(le*de.height);h===void 0&&(h=m(se,ke));const be=A?m(se,ke):h;return be.width=se,be.height=ke,be.getContext("2d").drawImage(P,0,0,se,ke),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+de.width+"x"+de.height+") to ("+se+"x"+ke+")."),be}else return"data"in P&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+de.width+"x"+de.height+")."),P;return P}function g(P){return P.generateMipmaps}function p(P){n.generateMipmap(P)}function v(P){return P.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:P.isWebGL3DRenderTarget?n.TEXTURE_3D:P.isWebGLArrayRenderTarget||P.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function y(P,A,j,le,de=!1){if(P!==null){if(n[P]!==void 0)return n[P];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+P+"'")}let se=A;if(A===n.RED&&(j===n.FLOAT&&(se=n.R32F),j===n.HALF_FLOAT&&(se=n.R16F),j===n.UNSIGNED_BYTE&&(se=n.R8)),A===n.RED_INTEGER&&(j===n.UNSIGNED_BYTE&&(se=n.R8UI),j===n.UNSIGNED_SHORT&&(se=n.R16UI),j===n.UNSIGNED_INT&&(se=n.R32UI),j===n.BYTE&&(se=n.R8I),j===n.SHORT&&(se=n.R16I),j===n.INT&&(se=n.R32I)),A===n.RG&&(j===n.FLOAT&&(se=n.RG32F),j===n.HALF_FLOAT&&(se=n.RG16F),j===n.UNSIGNED_BYTE&&(se=n.RG8)),A===n.RG_INTEGER&&(j===n.UNSIGNED_BYTE&&(se=n.RG8UI),j===n.UNSIGNED_SHORT&&(se=n.RG16UI),j===n.UNSIGNED_INT&&(se=n.RG32UI),j===n.BYTE&&(se=n.RG8I),j===n.SHORT&&(se=n.RG16I),j===n.INT&&(se=n.RG32I)),A===n.RGB_INTEGER&&(j===n.UNSIGNED_BYTE&&(se=n.RGB8UI),j===n.UNSIGNED_SHORT&&(se=n.RGB16UI),j===n.UNSIGNED_INT&&(se=n.RGB32UI),j===n.BYTE&&(se=n.RGB8I),j===n.SHORT&&(se=n.RGB16I),j===n.INT&&(se=n.RGB32I)),A===n.RGBA_INTEGER&&(j===n.UNSIGNED_BYTE&&(se=n.RGBA8UI),j===n.UNSIGNED_SHORT&&(se=n.RGBA16UI),j===n.UNSIGNED_INT&&(se=n.RGBA32UI),j===n.BYTE&&(se=n.RGBA8I),j===n.SHORT&&(se=n.RGBA16I),j===n.INT&&(se=n.RGBA32I)),A===n.RGB&&j===n.UNSIGNED_INT_5_9_9_9_REV&&(se=n.RGB9_E5),A===n.RGBA){const ke=de?ap:st.getTransfer(le);j===n.FLOAT&&(se=n.RGBA32F),j===n.HALF_FLOAT&&(se=n.RGBA16F),j===n.UNSIGNED_BYTE&&(se=ke===Et?n.SRGB8_ALPHA8:n.RGBA8),j===n.UNSIGNED_SHORT_4_4_4_4&&(se=n.RGBA4),j===n.UNSIGNED_SHORT_5_5_5_1&&(se=n.RGB5_A1)}return(se===n.R16F||se===n.R32F||se===n.RG16F||se===n.RG32F||se===n.RGBA16F||se===n.RGBA32F)&&e.get("EXT_color_buffer_float"),se}function x(P,A){let j;return P?A===null||A===en||A===ts?j=n.DEPTH24_STENCIL8:A===cn?j=n.DEPTH32F_STENCIL8:A===Pr&&(j=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):A===null||A===en||A===ts?j=n.DEPTH_COMPONENT24:A===cn?j=n.DEPTH_COMPONENT32F:A===Pr&&(j=n.DEPTH_COMPONENT16),j}function T(P,A){return g(P)===!0||P.isFramebufferTexture&&P.minFilter!==zt&&P.minFilter!==mn?Math.log2(Math.max(A.width,A.height))+1:P.mipmaps!==void 0&&P.mipmaps.length>0?P.mipmaps.length:P.isCompressedTexture&&Array.isArray(P.image)?A.mipmaps.length:1}function S(P){const A=P.target;A.removeEventListener("dispose",S),E(A),A.isVideoTexture&&c.delete(A)}function w(P){const A=P.target;A.removeEventListener("dispose",w),b(A)}function E(P){const A=i.get(P);if(A.__webglInit===void 0)return;const j=P.source,le=d.get(j);if(le){const de=le[A.__cacheKey];de.usedTimes--,de.usedTimes===0&&M(P),Object.keys(le).length===0&&d.delete(j)}i.remove(P)}function M(P){const A=i.get(P);n.deleteTexture(A.__webglTexture);const j=P.source,le=d.get(j);delete le[A.__cacheKey],o.memory.textures--}function b(P){const A=i.get(P);if(P.depthTexture&&(P.depthTexture.dispose(),i.remove(P.depthTexture)),P.isWebGLCubeRenderTarget)for(let le=0;le<6;le++){if(Array.isArray(A.__webglFramebuffer[le]))for(let de=0;de<A.__webglFramebuffer[le].length;de++)n.deleteFramebuffer(A.__webglFramebuffer[le][de]);else n.deleteFramebuffer(A.__webglFramebuffer[le]);A.__webglDepthbuffer&&n.deleteRenderbuffer(A.__webglDepthbuffer[le])}else{if(Array.isArray(A.__webglFramebuffer))for(let le=0;le<A.__webglFramebuffer.length;le++)n.deleteFramebuffer(A.__webglFramebuffer[le]);else n.deleteFramebuffer(A.__webglFramebuffer);if(A.__webglDepthbuffer&&n.deleteRenderbuffer(A.__webglDepthbuffer),A.__webglMultisampledFramebuffer&&n.deleteFramebuffer(A.__webglMultisampledFramebuffer),A.__webglColorRenderbuffer)for(let le=0;le<A.__webglColorRenderbuffer.length;le++)A.__webglColorRenderbuffer[le]&&n.deleteRenderbuffer(A.__webglColorRenderbuffer[le]);A.__webglDepthRenderbuffer&&n.deleteRenderbuffer(A.__webglDepthRenderbuffer)}const j=P.textures;for(let le=0,de=j.length;le<de;le++){const se=i.get(j[le]);se.__webglTexture&&(n.deleteTexture(se.__webglTexture),o.memory.textures--),i.remove(j[le])}i.remove(P)}let R=0;function I(){R=0}function B(){const P=R;return P>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+P+" texture units while this GPU supports only "+r.maxTextures),R+=1,P}function D(P){const A=[];return A.push(P.wrapS),A.push(P.wrapT),A.push(P.wrapR||0),A.push(P.magFilter),A.push(P.minFilter),A.push(P.anisotropy),A.push(P.internalFormat),A.push(P.format),A.push(P.type),A.push(P.generateMipmaps),A.push(P.premultiplyAlpha),A.push(P.flipY),A.push(P.unpackAlignment),A.push(P.colorSpace),A.join()}function L(P,A){const j=i.get(P);if(P.isVideoTexture&&Ge(P),P.isRenderTargetTexture===!1&&P.version>0&&j.__version!==P.version){const le=P.image;if(le===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(le.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{O(j,P,A);return}}t.bindTexture(n.TEXTURE_2D,j.__webglTexture,n.TEXTURE0+A)}function z(P,A){const j=i.get(P);if(P.version>0&&j.__version!==P.version){O(j,P,A);return}t.bindTexture(n.TEXTURE_2D_ARRAY,j.__webglTexture,n.TEXTURE0+A)}function ie(P,A){const j=i.get(P);if(P.version>0&&j.__version!==P.version){O(j,P,A);return}t.bindTexture(n.TEXTURE_3D,j.__webglTexture,n.TEXTURE0+A)}function k(P,A){const j=i.get(P);if(P.version>0&&j.__version!==P.version){X(j,P,A);return}t.bindTexture(n.TEXTURE_CUBE_MAP,j.__webglTexture,n.TEXTURE0+A)}const Z={[ba]:n.REPEAT,[Jr]:n.CLAMP_TO_EDGE,[wa]:n.MIRRORED_REPEAT},W={[zt]:n.NEAREST,[ip]:n.NEAREST_MIPMAP_NEAREST,[es]:n.NEAREST_MIPMAP_LINEAR,[mn]:n.LINEAR,[Hl]:n.LINEAR_MIPMAP_NEAREST,[ci]:n.LINEAR_MIPMAP_LINEAR},K={[fy]:n.NEVER,[vy]:n.ALWAYS,[lp]:n.LESS,[up]:n.LEQUAL,[py]:n.EQUAL,[_y]:n.GEQUAL,[my]:n.GREATER,[gy]:n.NOTEQUAL};function he(P,A){if(A.type===cn&&e.has("OES_texture_float_linear")===!1&&(A.magFilter===mn||A.magFilter===Hl||A.magFilter===es||A.magFilter===ci||A.minFilter===mn||A.minFilter===Hl||A.minFilter===es||A.minFilter===ci)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(P,n.TEXTURE_WRAP_S,Z[A.wrapS]),n.texParameteri(P,n.TEXTURE_WRAP_T,Z[A.wrapT]),(P===n.TEXTURE_3D||P===n.TEXTURE_2D_ARRAY)&&n.texParameteri(P,n.TEXTURE_WRAP_R,Z[A.wrapR]),n.texParameteri(P,n.TEXTURE_MAG_FILTER,W[A.magFilter]),n.texParameteri(P,n.TEXTURE_MIN_FILTER,W[A.minFilter]),A.compareFunction&&(n.texParameteri(P,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(P,n.TEXTURE_COMPARE_FUNC,K[A.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(A.magFilter===zt||A.minFilter!==es&&A.minFilter!==ci||A.type===cn&&e.has("OES_texture_float_linear")===!1)return;if(A.anisotropy>1||i.get(A).__currentAnisotropy){const j=e.get("EXT_texture_filter_anisotropic");n.texParameterf(P,j.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(A.anisotropy,r.getMaxAnisotropy())),i.get(A).__currentAnisotropy=A.anisotropy}}}function Ie(P,A){let j=!1;P.__webglInit===void 0&&(P.__webglInit=!0,A.addEventListener("dispose",S));const le=A.source;let de=d.get(le);de===void 0&&(de={},d.set(le,de));const se=D(A);if(se!==P.__cacheKey){de[se]===void 0&&(de[se]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,j=!0),de[se].usedTimes++;const ke=de[P.__cacheKey];ke!==void 0&&(de[P.__cacheKey].usedTimes--,ke.usedTimes===0&&M(A)),P.__cacheKey=se,P.__webglTexture=de[se].texture}return j}function O(P,A,j){let le=n.TEXTURE_2D;(A.isDataArrayTexture||A.isCompressedArrayTexture)&&(le=n.TEXTURE_2D_ARRAY),A.isData3DTexture&&(le=n.TEXTURE_3D);const de=Ie(P,A),se=A.source;t.bindTexture(le,P.__webglTexture,n.TEXTURE0+j);const ke=i.get(se);if(se.version!==ke.__version||de===!0){t.activeTexture(n.TEXTURE0+j);const be=st.getPrimaries(st.workingColorSpace),Ne=A.colorSpace===Yi?null:st.getPrimaries(A.colorSpace),xt=A.colorSpace===Yi||be===Ne?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,A.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,A.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,A.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,xt);let _e=_(A.image,!1,r.maxTextureSize);_e=Ht(A,_e);const Pe=s.convert(A.format,A.colorSpace),$e=s.convert(A.type);let Ye=y(A.internalFormat,Pe,$e,A.colorSpace,A.isVideoTexture);he(le,A);let De;const gt=A.mipmaps,lt=A.isVideoTexture!==!0,Ot=ke.__version===void 0||de===!0,G=se.dataReady,Se=T(A,_e);if(A.isDepthTexture)Ye=x(A.format===is,A.type),Ot&&(lt?t.texStorage2D(n.TEXTURE_2D,1,Ye,_e.width,_e.height):t.texImage2D(n.TEXTURE_2D,0,Ye,_e.width,_e.height,0,Pe,$e,null));else if(A.isDataTexture)if(gt.length>0){lt&&Ot&&t.texStorage2D(n.TEXTURE_2D,Se,Ye,gt[0].width,gt[0].height);for(let ee=0,ue=gt.length;ee<ue;ee++)De=gt[ee],lt?G&&t.texSubImage2D(n.TEXTURE_2D,ee,0,0,De.width,De.height,Pe,$e,De.data):t.texImage2D(n.TEXTURE_2D,ee,Ye,De.width,De.height,0,Pe,$e,De.data);A.generateMipmaps=!1}else lt?(Ot&&t.texStorage2D(n.TEXTURE_2D,Se,Ye,_e.width,_e.height),G&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,_e.width,_e.height,Pe,$e,_e.data)):t.texImage2D(n.TEXTURE_2D,0,Ye,_e.width,_e.height,0,Pe,$e,_e.data);else if(A.isCompressedTexture)if(A.isCompressedArrayTexture){lt&&Ot&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Se,Ye,gt[0].width,gt[0].height,_e.depth);for(let ee=0,ue=gt.length;ee<ue;ee++)if(De=gt[ee],A.format!==Gn)if(Pe!==null)if(lt){if(G)if(A.layerUpdates.size>0){const Me=WE(De.width,De.height,A.format,A.type);for(const we of A.layerUpdates){const rt=De.data.subarray(we*Me/De.data.BYTES_PER_ELEMENT,(we+1)*Me/De.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,ee,0,0,we,De.width,De.height,1,Pe,rt)}A.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,ee,0,0,0,De.width,De.height,_e.depth,Pe,De.data)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,ee,Ye,De.width,De.height,_e.depth,0,De.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else lt?G&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,ee,0,0,0,De.width,De.height,_e.depth,Pe,$e,De.data):t.texImage3D(n.TEXTURE_2D_ARRAY,ee,Ye,De.width,De.height,_e.depth,0,Pe,$e,De.data)}else{lt&&Ot&&t.texStorage2D(n.TEXTURE_2D,Se,Ye,gt[0].width,gt[0].height);for(let ee=0,ue=gt.length;ee<ue;ee++)De=gt[ee],A.format!==Gn?Pe!==null?lt?G&&t.compressedTexSubImage2D(n.TEXTURE_2D,ee,0,0,De.width,De.height,Pe,De.data):t.compressedTexImage2D(n.TEXTURE_2D,ee,Ye,De.width,De.height,0,De.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):lt?G&&t.texSubImage2D(n.TEXTURE_2D,ee,0,0,De.width,De.height,Pe,$e,De.data):t.texImage2D(n.TEXTURE_2D,ee,Ye,De.width,De.height,0,Pe,$e,De.data)}else if(A.isDataArrayTexture)if(lt){if(Ot&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Se,Ye,_e.width,_e.height,_e.depth),G)if(A.layerUpdates.size>0){const ee=WE(_e.width,_e.height,A.format,A.type);for(const ue of A.layerUpdates){const Me=_e.data.subarray(ue*ee/_e.data.BYTES_PER_ELEMENT,(ue+1)*ee/_e.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,ue,_e.width,_e.height,1,Pe,$e,Me)}A.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,_e.width,_e.height,_e.depth,Pe,$e,_e.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,Ye,_e.width,_e.height,_e.depth,0,Pe,$e,_e.data);else if(A.isData3DTexture)lt?(Ot&&t.texStorage3D(n.TEXTURE_3D,Se,Ye,_e.width,_e.height,_e.depth),G&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,_e.width,_e.height,_e.depth,Pe,$e,_e.data)):t.texImage3D(n.TEXTURE_3D,0,Ye,_e.width,_e.height,_e.depth,0,Pe,$e,_e.data);else if(A.isFramebufferTexture){if(Ot)if(lt)t.texStorage2D(n.TEXTURE_2D,Se,Ye,_e.width,_e.height);else{let ee=_e.width,ue=_e.height;for(let Me=0;Me<Se;Me++)t.texImage2D(n.TEXTURE_2D,Me,Ye,ee,ue,0,Pe,$e,null),ee>>=1,ue>>=1}}else if(gt.length>0){if(lt&&Ot){const ee=ze(gt[0]);t.texStorage2D(n.TEXTURE_2D,Se,Ye,ee.width,ee.height)}for(let ee=0,ue=gt.length;ee<ue;ee++)De=gt[ee],lt?G&&t.texSubImage2D(n.TEXTURE_2D,ee,0,0,Pe,$e,De):t.texImage2D(n.TEXTURE_2D,ee,Ye,Pe,$e,De);A.generateMipmaps=!1}else if(lt){if(Ot){const ee=ze(_e);t.texStorage2D(n.TEXTURE_2D,Se,Ye,ee.width,ee.height)}G&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,Pe,$e,_e)}else t.texImage2D(n.TEXTURE_2D,0,Ye,Pe,$e,_e);g(A)&&p(le),ke.__version=se.version,A.onUpdate&&A.onUpdate(A)}P.__version=A.version}function X(P,A,j){if(A.image.length!==6)return;const le=Ie(P,A),de=A.source;t.bindTexture(n.TEXTURE_CUBE_MAP,P.__webglTexture,n.TEXTURE0+j);const se=i.get(de);if(de.version!==se.__version||le===!0){t.activeTexture(n.TEXTURE0+j);const ke=st.getPrimaries(st.workingColorSpace),be=A.colorSpace===Yi?null:st.getPrimaries(A.colorSpace),Ne=A.colorSpace===Yi||ke===be?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,A.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,A.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,A.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ne);const xt=A.isCompressedTexture||A.image[0].isCompressedTexture,_e=A.image[0]&&A.image[0].isDataTexture,Pe=[];for(let ue=0;ue<6;ue++)!xt&&!_e?Pe[ue]=_(A.image[ue],!0,r.maxCubemapSize):Pe[ue]=_e?A.image[ue].image:A.image[ue],Pe[ue]=Ht(A,Pe[ue]);const $e=Pe[0],Ye=s.convert(A.format,A.colorSpace),De=s.convert(A.type),gt=y(A.internalFormat,Ye,De,A.colorSpace),lt=A.isVideoTexture!==!0,Ot=se.__version===void 0||le===!0,G=de.dataReady;let Se=T(A,$e);he(n.TEXTURE_CUBE_MAP,A);let ee;if(xt){lt&&Ot&&t.texStorage2D(n.TEXTURE_CUBE_MAP,Se,gt,$e.width,$e.height);for(let ue=0;ue<6;ue++){ee=Pe[ue].mipmaps;for(let Me=0;Me<ee.length;Me++){const we=ee[Me];A.format!==Gn?Ye!==null?lt?G&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ue,Me,0,0,we.width,we.height,Ye,we.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ue,Me,gt,we.width,we.height,0,we.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):lt?G&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ue,Me,0,0,we.width,we.height,Ye,De,we.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ue,Me,gt,we.width,we.height,0,Ye,De,we.data)}}}else{if(ee=A.mipmaps,lt&&Ot){ee.length>0&&Se++;const ue=ze(Pe[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,Se,gt,ue.width,ue.height)}for(let ue=0;ue<6;ue++)if(_e){lt?G&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,0,0,Pe[ue].width,Pe[ue].height,Ye,De,Pe[ue].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,gt,Pe[ue].width,Pe[ue].height,0,Ye,De,Pe[ue].data);for(let Me=0;Me<ee.length;Me++){const rt=ee[Me].image[ue].image;lt?G&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ue,Me+1,0,0,rt.width,rt.height,Ye,De,rt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ue,Me+1,gt,rt.width,rt.height,0,Ye,De,rt.data)}}else{lt?G&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,0,0,Ye,De,Pe[ue]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,gt,Ye,De,Pe[ue]);for(let Me=0;Me<ee.length;Me++){const we=ee[Me];lt?G&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ue,Me+1,0,0,Ye,De,we.image[ue]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ue,Me+1,gt,Ye,De,we.image[ue])}}}g(A)&&p(n.TEXTURE_CUBE_MAP),se.__version=de.version,A.onUpdate&&A.onUpdate(A)}P.__version=A.version}function ae(P,A,j,le,de,se){const ke=s.convert(j.format,j.colorSpace),be=s.convert(j.type),Ne=y(j.internalFormat,ke,be,j.colorSpace),xt=i.get(A),_e=i.get(j);if(_e.__renderTarget=A,!xt.__hasExternalTextures){const Pe=Math.max(1,A.width>>se),$e=Math.max(1,A.height>>se);de===n.TEXTURE_3D||de===n.TEXTURE_2D_ARRAY?t.texImage3D(de,se,Ne,Pe,$e,A.depth,0,ke,be,null):t.texImage2D(de,se,Ne,Pe,$e,0,ke,be,null)}t.bindFramebuffer(n.FRAMEBUFFER,P),dt(A)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,le,de,_e.__webglTexture,0,ct(A)):(de===n.TEXTURE_2D||de>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&de<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,le,de,_e.__webglTexture,se),t.bindFramebuffer(n.FRAMEBUFFER,null)}function re(P,A,j){if(n.bindRenderbuffer(n.RENDERBUFFER,P),A.depthBuffer){const le=A.depthTexture,de=le&&le.isDepthTexture?le.type:null,se=x(A.stencilBuffer,de),ke=A.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,be=ct(A);dt(A)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,be,se,A.width,A.height):j?n.renderbufferStorageMultisample(n.RENDERBUFFER,be,se,A.width,A.height):n.renderbufferStorage(n.RENDERBUFFER,se,A.width,A.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,ke,n.RENDERBUFFER,P)}else{const le=A.textures;for(let de=0;de<le.length;de++){const se=le[de],ke=s.convert(se.format,se.colorSpace),be=s.convert(se.type),Ne=y(se.internalFormat,ke,be,se.colorSpace),xt=ct(A);j&&dt(A)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,xt,Ne,A.width,A.height):dt(A)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,xt,Ne,A.width,A.height):n.renderbufferStorage(n.RENDERBUFFER,Ne,A.width,A.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function Ee(P,A){if(A&&A.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,P),!(A.depthTexture&&A.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const le=i.get(A.depthTexture);le.__renderTarget=A,(!le.__webglTexture||A.depthTexture.image.width!==A.width||A.depthTexture.image.height!==A.height)&&(A.depthTexture.image.width=A.width,A.depthTexture.image.height=A.height,A.depthTexture.needsUpdate=!0),L(A.depthTexture,0);const de=le.__webglTexture,se=ct(A);if(A.depthTexture.format===ns)dt(A)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,de,0,se):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,de,0);else if(A.depthTexture.format===is)dt(A)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,de,0,se):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,de,0);else throw new Error("Unknown depthTexture format")}function Re(P){const A=i.get(P),j=P.isWebGLCubeRenderTarget===!0;if(A.__boundDepthTexture!==P.depthTexture){const le=P.depthTexture;if(A.__depthDisposeCallback&&A.__depthDisposeCallback(),le){const de=()=>{delete A.__boundDepthTexture,delete A.__depthDisposeCallback,le.removeEventListener("dispose",de)};le.addEventListener("dispose",de),A.__depthDisposeCallback=de}A.__boundDepthTexture=le}if(P.depthTexture&&!A.__autoAllocateDepthBuffer){if(j)throw new Error("target.depthTexture not supported in Cube render targets");Ee(A.__webglFramebuffer,P)}else if(j){A.__webglDepthbuffer=[];for(let le=0;le<6;le++)if(t.bindFramebuffer(n.FRAMEBUFFER,A.__webglFramebuffer[le]),A.__webglDepthbuffer[le]===void 0)A.__webglDepthbuffer[le]=n.createRenderbuffer(),re(A.__webglDepthbuffer[le],P,!1);else{const de=P.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,se=A.__webglDepthbuffer[le];n.bindRenderbuffer(n.RENDERBUFFER,se),n.framebufferRenderbuffer(n.FRAMEBUFFER,de,n.RENDERBUFFER,se)}}else if(t.bindFramebuffer(n.FRAMEBUFFER,A.__webglFramebuffer),A.__webglDepthbuffer===void 0)A.__webglDepthbuffer=n.createRenderbuffer(),re(A.__webglDepthbuffer,P,!1);else{const le=P.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,de=A.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,de),n.framebufferRenderbuffer(n.FRAMEBUFFER,le,n.RENDERBUFFER,de)}t.bindFramebuffer(n.FRAMEBUFFER,null)}function Fe(P,A,j){const le=i.get(P);A!==void 0&&ae(le.__webglFramebuffer,P,P.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),j!==void 0&&Re(P)}function mt(P){const A=P.texture,j=i.get(P),le=i.get(A);P.addEventListener("dispose",w);const de=P.textures,se=P.isWebGLCubeRenderTarget===!0,ke=de.length>1;if(ke||(le.__webglTexture===void 0&&(le.__webglTexture=n.createTexture()),le.__version=A.version,o.memory.textures++),se){j.__webglFramebuffer=[];for(let be=0;be<6;be++)if(A.mipmaps&&A.mipmaps.length>0){j.__webglFramebuffer[be]=[];for(let Ne=0;Ne<A.mipmaps.length;Ne++)j.__webglFramebuffer[be][Ne]=n.createFramebuffer()}else j.__webglFramebuffer[be]=n.createFramebuffer()}else{if(A.mipmaps&&A.mipmaps.length>0){j.__webglFramebuffer=[];for(let be=0;be<A.mipmaps.length;be++)j.__webglFramebuffer[be]=n.createFramebuffer()}else j.__webglFramebuffer=n.createFramebuffer();if(ke)for(let be=0,Ne=de.length;be<Ne;be++){const xt=i.get(de[be]);xt.__webglTexture===void 0&&(xt.__webglTexture=n.createTexture(),o.memory.textures++)}if(P.samples>0&&dt(P)===!1){j.__webglMultisampledFramebuffer=n.createFramebuffer(),j.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,j.__webglMultisampledFramebuffer);for(let be=0;be<de.length;be++){const Ne=de[be];j.__webglColorRenderbuffer[be]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,j.__webglColorRenderbuffer[be]);const xt=s.convert(Ne.format,Ne.colorSpace),_e=s.convert(Ne.type),Pe=y(Ne.internalFormat,xt,_e,Ne.colorSpace,P.isXRRenderTarget===!0),$e=ct(P);n.renderbufferStorageMultisample(n.RENDERBUFFER,$e,Pe,P.width,P.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+be,n.RENDERBUFFER,j.__webglColorRenderbuffer[be])}n.bindRenderbuffer(n.RENDERBUFFER,null),P.depthBuffer&&(j.__webglDepthRenderbuffer=n.createRenderbuffer(),re(j.__webglDepthRenderbuffer,P,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(se){t.bindTexture(n.TEXTURE_CUBE_MAP,le.__webglTexture),he(n.TEXTURE_CUBE_MAP,A);for(let be=0;be<6;be++)if(A.mipmaps&&A.mipmaps.length>0)for(let Ne=0;Ne<A.mipmaps.length;Ne++)ae(j.__webglFramebuffer[be][Ne],P,A,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+be,Ne);else ae(j.__webglFramebuffer[be],P,A,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+be,0);g(A)&&p(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(ke){for(let be=0,Ne=de.length;be<Ne;be++){const xt=de[be],_e=i.get(xt);t.bindTexture(n.TEXTURE_2D,_e.__webglTexture),he(n.TEXTURE_2D,xt),ae(j.__webglFramebuffer,P,xt,n.COLOR_ATTACHMENT0+be,n.TEXTURE_2D,0),g(xt)&&p(n.TEXTURE_2D)}t.unbindTexture()}else{let be=n.TEXTURE_2D;if((P.isWebGL3DRenderTarget||P.isWebGLArrayRenderTarget)&&(be=P.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(be,le.__webglTexture),he(be,A),A.mipmaps&&A.mipmaps.length>0)for(let Ne=0;Ne<A.mipmaps.length;Ne++)ae(j.__webglFramebuffer[Ne],P,A,n.COLOR_ATTACHMENT0,be,Ne);else ae(j.__webglFramebuffer,P,A,n.COLOR_ATTACHMENT0,be,0);g(A)&&p(be),t.unbindTexture()}P.depthBuffer&&Re(P)}function ut(P){const A=P.textures;for(let j=0,le=A.length;j<le;j++){const de=A[j];if(g(de)){const se=v(P),ke=i.get(de).__webglTexture;t.bindTexture(se,ke),p(se),t.unbindTexture()}}}const Ct=[],F=[];function nn(P){if(P.samples>0){if(dt(P)===!1){const A=P.textures,j=P.width,le=P.height;let de=n.COLOR_BUFFER_BIT;const se=P.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ke=i.get(P),be=A.length>1;if(be)for(let Ne=0;Ne<A.length;Ne++)t.bindFramebuffer(n.FRAMEBUFFER,ke.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ne,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,ke.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ne,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,ke.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,ke.__webglFramebuffer);for(let Ne=0;Ne<A.length;Ne++){if(P.resolveDepthBuffer&&(P.depthBuffer&&(de|=n.DEPTH_BUFFER_BIT),P.stencilBuffer&&P.resolveStencilBuffer&&(de|=n.STENCIL_BUFFER_BIT)),be){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,ke.__webglColorRenderbuffer[Ne]);const xt=i.get(A[Ne]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,xt,0)}n.blitFramebuffer(0,0,j,le,0,0,j,le,de,n.NEAREST),l===!0&&(Ct.length=0,F.length=0,Ct.push(n.COLOR_ATTACHMENT0+Ne),P.depthBuffer&&P.resolveDepthBuffer===!1&&(Ct.push(se),F.push(se),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,F)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,Ct))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),be)for(let Ne=0;Ne<A.length;Ne++){t.bindFramebuffer(n.FRAMEBUFFER,ke.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ne,n.RENDERBUFFER,ke.__webglColorRenderbuffer[Ne]);const xt=i.get(A[Ne]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,ke.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ne,n.TEXTURE_2D,xt,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,ke.__webglMultisampledFramebuffer)}else if(P.depthBuffer&&P.resolveDepthBuffer===!1&&l){const A=P.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[A])}}}function ct(P){return Math.min(r.maxSamples,P.samples)}function dt(P){const A=i.get(P);return P.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&A.__useRenderToTexture!==!1}function Ge(P){const A=o.render.frame;c.get(P)!==A&&(c.set(P,A),P.update())}function Ht(P,A){const j=P.colorSpace,le=P.format,de=P.type;return P.isCompressedTexture===!0||P.isVideoTexture===!0||j!==mr&&j!==Yi&&(st.getTransfer(j)===Et?(le!==Gn||de!==Kn)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",j)),A}function ze(P){return typeof HTMLImageElement<"u"&&P instanceof HTMLImageElement?(u.width=P.naturalWidth||P.width,u.height=P.naturalHeight||P.height):typeof VideoFrame<"u"&&P instanceof VideoFrame?(u.width=P.displayWidth,u.height=P.displayHeight):(u.width=P.width,u.height=P.height),u}this.allocateTextureUnit=B,this.resetTextureUnits=I,this.setTexture2D=L,this.setTexture2DArray=z,this.setTexture3D=ie,this.setTextureCube=k,this.rebindTextures=Fe,this.setupRenderTarget=mt,this.updateRenderTargetMipmap=ut,this.updateMultisampleRenderTarget=nn,this.setupDepthRenderbuffer=Re,this.setupFrameBufferTexture=ae,this.useMultisampledRTT=dt}function WB(n,e){function t(i,r=Yi){let s;const o=st.getTransfer(r);if(i===Kn)return n.UNSIGNED_BYTE;if(i===rp)return n.UNSIGNED_SHORT_4_4_4_4;if(i===sp)return n.UNSIGNED_SHORT_5_5_5_1;if(i===op)return n.UNSIGNED_INT_5_9_9_9_REV;if(i===Ma)return n.BYTE;if(i===Ea)return n.SHORT;if(i===Pr)return n.UNSIGNED_SHORT;if(i===Un)return n.INT;if(i===en)return n.UNSIGNED_INT;if(i===cn)return n.FLOAT;if(i===hi)return n.HALF_FLOAT;if(i===oy)return n.ALPHA;if(i===dh)return n.RGB;if(i===Gn)return n.RGBA;if(i===ay)return n.LUMINANCE;if(i===ly)return n.LUMINANCE_ALPHA;if(i===ns)return n.DEPTH_COMPONENT;if(i===is)return n.DEPTH_STENCIL;if(i===fh)return n.RED;if(i===Wl)return n.RED_INTEGER;if(i===Aa)return n.RG;if(i===$l)return n.RG_INTEGER;if(i===jl)return n.RGBA_INTEGER;if(i===Ca||i===Do||i===Lo||i===Io)if(o===Et)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(i===Ca)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===Do)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===Lo)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===Io)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(i===Ca)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===Do)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===Lo)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===Io)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===ph||i===mh||i===gh||i===_h)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(i===ph)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===mh)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===gh)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===_h)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===vh||i===Xl||i===ql)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(i===vh||i===Xl)return o===Et?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(i===ql)return o===Et?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===Yl||i===Kl||i===Ql||i===Zl||i===Jl||i===eu||i===tu||i===nu||i===iu||i===ru||i===su||i===ou||i===au||i===lu)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(i===Yl)return o===Et?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===Kl)return o===Et?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===Ql)return o===Et?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===Zl)return o===Et?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===Jl)return o===Et?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===eu)return o===Et?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===tu)return o===Et?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===nu)return o===Et?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===iu)return o===Et?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===ru)return o===Et?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===su)return o===Et?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===ou)return o===Et?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===au)return o===Et?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===lu)return o===Et?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===Ra||i===uy||i===cy)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(i===Ra)return o===Et?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===uy)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===cy)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===hy||i===yh||i===xh||i===Sh)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(i===Ra)return s.COMPRESSED_RED_RGTC1_EXT;if(i===yh)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===xh)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===Sh)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===ts?n.UNSIGNED_INT_24_8:n[i]!==void 0?n[i]:null}return{convert:t}}const $B={type:"move"};class g0{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Nu,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Nu,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new N,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new N),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Nu,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new N,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new N),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,u=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(u&&e.hand){o=!0;for(const _ of e.hand.values()){const g=t.getJointPose(_,i),p=this._getHandJoint(u,_);g!==null&&(p.matrix.fromArray(g.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.matrixWorldNeedsUpdate=!0,p.jointRadius=g.radius),p.visible=g!==null}const c=u.joints["index-finger-tip"],h=u.joints["thumb-tip"],d=c.position.distanceTo(h.position),f=.02,m=.005;u.inputState.pinching&&d>f+m?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&d<=f-m&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&s!==null&&(r=s),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent($B)))}return a!==null&&(a.visible=r!==null),l!==null&&(l.visible=s!==null),u!==null&&(u.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new Nu;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}const jB=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,XB=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class qB{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(this.texture===null){const r=new gn,s=e.properties.get(r);s.__webglTexture=t.texture,(t.depthNear!==i.depthNear||t.depthFar!==i.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=r}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,i=new rs({vertexShader:jB,fragmentShader:XB,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new On(new Wp(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class YB extends Ns{constructor(e,t){super();const i=this;let r=null,s=1,o=null,a="local-floor",l=1,u=null,c=null,h=null,d=null,f=null,m=null;const _=new qB,g=t.getContextAttributes();let p=null,v=null;const y=[],x=[],T=new ce;let S=null;const w=new pi;w.viewport=new et;const E=new pi;E.viewport=new et;const M=[w,E],b=new YU;let R=null,I=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(O){let X=y[O];return X===void 0&&(X=new g0,y[O]=X),X.getTargetRaySpace()},this.getControllerGrip=function(O){let X=y[O];return X===void 0&&(X=new g0,y[O]=X),X.getGripSpace()},this.getHand=function(O){let X=y[O];return X===void 0&&(X=new g0,y[O]=X),X.getHandSpace()};function B(O){const X=x.indexOf(O.inputSource);if(X===-1)return;const ae=y[X];ae!==void 0&&(ae.update(O.inputSource,O.frame,u||o),ae.dispatchEvent({type:O.type,data:O.inputSource}))}function D(){r.removeEventListener("select",B),r.removeEventListener("selectstart",B),r.removeEventListener("selectend",B),r.removeEventListener("squeeze",B),r.removeEventListener("squeezestart",B),r.removeEventListener("squeezeend",B),r.removeEventListener("end",D),r.removeEventListener("inputsourceschange",L);for(let O=0;O<y.length;O++){const X=x[O];X!==null&&(x[O]=null,y[O].disconnect(X))}R=null,I=null,_.reset(),e.setRenderTarget(p),f=null,d=null,h=null,r=null,v=null,Ie.stop(),i.isPresenting=!1,e.setPixelRatio(S),e.setSize(T.width,T.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(O){s=O,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(O){a=O,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||o},this.setReferenceSpace=function(O){u=O},this.getBaseLayer=function(){return d!==null?d:f},this.getBinding=function(){return h},this.getFrame=function(){return m},this.getSession=function(){return r},this.setSession=async function(O){if(r=O,r!==null){if(p=e.getRenderTarget(),r.addEventListener("select",B),r.addEventListener("selectstart",B),r.addEventListener("selectend",B),r.addEventListener("squeeze",B),r.addEventListener("squeezestart",B),r.addEventListener("squeezeend",B),r.addEventListener("end",D),r.addEventListener("inputsourceschange",L),g.xrCompatible!==!0&&await t.makeXRCompatible(),S=e.getPixelRatio(),e.getSize(T),r.enabledFeatures!==void 0&&r.enabledFeatures.includes("layers")){let ae=null,re=null,Ee=null;g.depth&&(Ee=g.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ae=g.stencil?is:ns,re=g.stencil?ts:en);const Re={colorFormat:t.RGBA8,depthFormat:Ee,scaleFactor:s};h=new XRWebGLBinding(r,t),d=h.createProjectionLayer(Re),r.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),v=new Fo(d.textureWidth,d.textureHeight,{format:Gn,type:Kn,depthTexture:new Ho(d.textureWidth,d.textureHeight,re,void 0,void 0,void 0,void 0,void 0,void 0,ae),stencilBuffer:g.stencil,colorSpace:e.outputColorSpace,samples:g.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1})}else{const ae={antialias:g.antialias,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:s};f=new XRWebGLLayer(r,t,ae),r.updateRenderState({baseLayer:f}),e.setPixelRatio(1),e.setSize(f.framebufferWidth,f.framebufferHeight,!1),v=new Fo(f.framebufferWidth,f.framebufferHeight,{format:Gn,type:Kn,colorSpace:e.outputColorSpace,stencilBuffer:g.stencil})}v.isXRRenderTarget=!0,this.setFoveation(l),u=null,o=await r.requestReferenceSpace(a),Ie.setContext(r),Ie.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode},this.getDepthTexture=function(){return _.getDepthTexture()};function L(O){for(let X=0;X<O.removed.length;X++){const ae=O.removed[X],re=x.indexOf(ae);re>=0&&(x[re]=null,y[re].disconnect(ae))}for(let X=0;X<O.added.length;X++){const ae=O.added[X];let re=x.indexOf(ae);if(re===-1){for(let Re=0;Re<y.length;Re++)if(Re>=x.length){x.push(ae),re=Re;break}else if(x[Re]===null){x[Re]=ae,re=Re;break}if(re===-1)break}const Ee=y[re];Ee&&Ee.connect(ae)}}const z=new N,ie=new N;function k(O,X,ae){z.setFromMatrixPosition(X.matrixWorld),ie.setFromMatrixPosition(ae.matrixWorld);const re=z.distanceTo(ie),Ee=X.projectionMatrix.elements,Re=ae.projectionMatrix.elements,Fe=Ee[14]/(Ee[10]-1),mt=Ee[14]/(Ee[10]+1),ut=(Ee[9]+1)/Ee[5],Ct=(Ee[9]-1)/Ee[5],F=(Ee[8]-1)/Ee[0],nn=(Re[8]+1)/Re[0],ct=Fe*F,dt=Fe*nn,Ge=re/(-F+nn),Ht=Ge*-F;if(X.matrixWorld.decompose(O.position,O.quaternion,O.scale),O.translateX(Ht),O.translateZ(Ge),O.matrixWorld.compose(O.position,O.quaternion,O.scale),O.matrixWorldInverse.copy(O.matrixWorld).invert(),Ee[10]===-1)O.projectionMatrix.copy(X.projectionMatrix),O.projectionMatrixInverse.copy(X.projectionMatrixInverse);else{const ze=Fe+Ge,P=mt+Ge,A=ct-Ht,j=dt+(re-Ht),le=ut*mt/P*ze,de=Ct*mt/P*ze;O.projectionMatrix.makePerspective(A,j,le,de,ze,P),O.projectionMatrixInverse.copy(O.projectionMatrix).invert()}}function Z(O,X){X===null?O.matrixWorld.copy(O.matrix):O.matrixWorld.multiplyMatrices(X.matrixWorld,O.matrix),O.matrixWorldInverse.copy(O.matrixWorld).invert()}this.updateCamera=function(O){if(r===null)return;let X=O.near,ae=O.far;_.texture!==null&&(_.depthNear>0&&(X=_.depthNear),_.depthFar>0&&(ae=_.depthFar)),b.near=E.near=w.near=X,b.far=E.far=w.far=ae,(R!==b.near||I!==b.far)&&(r.updateRenderState({depthNear:b.near,depthFar:b.far}),R=b.near,I=b.far),w.layers.mask=O.layers.mask|2,E.layers.mask=O.layers.mask|4,b.layers.mask=w.layers.mask|E.layers.mask;const re=O.parent,Ee=b.cameras;Z(b,re);for(let Re=0;Re<Ee.length;Re++)Z(Ee[Re],re);Ee.length===2?k(b,w,E):b.projectionMatrix.copy(w.projectionMatrix),W(O,b,re)};function W(O,X,ae){ae===null?O.matrix.copy(X.matrixWorld):(O.matrix.copy(ae.matrixWorld),O.matrix.invert(),O.matrix.multiply(X.matrixWorld)),O.matrix.decompose(O.position,O.quaternion,O.scale),O.updateMatrixWorld(!0),O.projectionMatrix.copy(X.projectionMatrix),O.projectionMatrixInverse.copy(X.projectionMatrixInverse),O.isPerspectiveCamera&&(O.fov=cu*2*Math.atan(1/O.projectionMatrix.elements[5]),O.zoom=1)}this.getCamera=function(){return b},this.getFoveation=function(){if(!(d===null&&f===null))return l},this.setFoveation=function(O){l=O,d!==null&&(d.fixedFoveation=O),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=O)},this.hasDepthSensing=function(){return _.texture!==null},this.getDepthSensingMesh=function(){return _.getMesh(b)};let K=null;function he(O,X){if(c=X.getViewerPose(u||o),m=X,c!==null){const ae=c.views;f!==null&&(e.setRenderTargetFramebuffer(v,f.framebuffer),e.setRenderTarget(v));let re=!1;ae.length!==b.cameras.length&&(b.cameras.length=0,re=!0);for(let Re=0;Re<ae.length;Re++){const Fe=ae[Re];let mt=null;if(f!==null)mt=f.getViewport(Fe);else{const Ct=h.getViewSubImage(d,Fe);mt=Ct.viewport,Re===0&&(e.setRenderTargetTextures(v,Ct.colorTexture,d.ignoreDepthValues?void 0:Ct.depthStencilTexture),e.setRenderTarget(v))}let ut=M[Re];ut===void 0&&(ut=new pi,ut.layers.enable(Re),ut.viewport=new et,M[Re]=ut),ut.matrix.fromArray(Fe.transform.matrix),ut.matrix.decompose(ut.position,ut.quaternion,ut.scale),ut.projectionMatrix.fromArray(Fe.projectionMatrix),ut.projectionMatrixInverse.copy(ut.projectionMatrix).invert(),ut.viewport.set(mt.x,mt.y,mt.width,mt.height),Re===0&&(b.matrix.copy(ut.matrix),b.matrix.decompose(b.position,b.quaternion,b.scale)),re===!0&&b.cameras.push(ut)}const Ee=r.enabledFeatures;if(Ee&&Ee.includes("depth-sensing")){const Re=h.getDepthInformation(ae[0]);Re&&Re.isValid&&Re.texture&&_.init(e,Re,r.renderState)}}for(let ae=0;ae<y.length;ae++){const re=x[ae],Ee=y[ae];re!==null&&Ee!==void 0&&Ee.update(re,X,u||o)}K&&K(O,X),X.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:X}),m=null}const Ie=new $E;Ie.setAnimationLoop(he),this.setAnimationLoop=function(O){K=O},this.dispose=function(){}}}const Va=new Qi,KB=new pt;function QB(n,e){function t(g,p){g.matrixAutoUpdate===!0&&g.updateMatrix(),p.value.copy(g.matrix)}function i(g,p){p.color.getRGB(g.fogColor.value,mE(n)),p.isFog?(g.fogNear.value=p.near,g.fogFar.value=p.far):p.isFogExp2&&(g.fogDensity.value=p.density)}function r(g,p,v,y,x){p.isMeshBasicMaterial||p.isMeshLambertMaterial?s(g,p):p.isMeshToonMaterial?(s(g,p),h(g,p)):p.isMeshPhongMaterial?(s(g,p),c(g,p)):p.isMeshStandardMaterial?(s(g,p),d(g,p),p.isMeshPhysicalMaterial&&f(g,p,x)):p.isMeshMatcapMaterial?(s(g,p),m(g,p)):p.isMeshDepthMaterial?s(g,p):p.isMeshDistanceMaterial?(s(g,p),_(g,p)):p.isMeshNormalMaterial?s(g,p):p.isLineBasicMaterial?(o(g,p),p.isLineDashedMaterial&&a(g,p)):p.isPointsMaterial?l(g,p,v,y):p.isSpriteMaterial?u(g,p):p.isShadowMaterial?(g.color.value.copy(p.color),g.opacity.value=p.opacity):p.isShaderMaterial&&(p.uniformsNeedUpdate=!1)}function s(g,p){g.opacity.value=p.opacity,p.color&&g.diffuse.value.copy(p.color),p.emissive&&g.emissive.value.copy(p.emissive).multiplyScalar(p.emissiveIntensity),p.map&&(g.map.value=p.map,t(p.map,g.mapTransform)),p.alphaMap&&(g.alphaMap.value=p.alphaMap,t(p.alphaMap,g.alphaMapTransform)),p.bumpMap&&(g.bumpMap.value=p.bumpMap,t(p.bumpMap,g.bumpMapTransform),g.bumpScale.value=p.bumpScale,p.side===$t&&(g.bumpScale.value*=-1)),p.normalMap&&(g.normalMap.value=p.normalMap,t(p.normalMap,g.normalMapTransform),g.normalScale.value.copy(p.normalScale),p.side===$t&&g.normalScale.value.negate()),p.displacementMap&&(g.displacementMap.value=p.displacementMap,t(p.displacementMap,g.displacementMapTransform),g.displacementScale.value=p.displacementScale,g.displacementBias.value=p.displacementBias),p.emissiveMap&&(g.emissiveMap.value=p.emissiveMap,t(p.emissiveMap,g.emissiveMapTransform)),p.specularMap&&(g.specularMap.value=p.specularMap,t(p.specularMap,g.specularMapTransform)),p.alphaTest>0&&(g.alphaTest.value=p.alphaTest);const v=e.get(p),y=v.envMap,x=v.envMapRotation;y&&(g.envMap.value=y,Va.copy(x),Va.x*=-1,Va.y*=-1,Va.z*=-1,y.isCubeTexture&&y.isRenderTargetTexture===!1&&(Va.y*=-1,Va.z*=-1),g.envMapRotation.value.setFromMatrix4(KB.makeRotationFromEuler(Va)),g.flipEnvMap.value=y.isCubeTexture&&y.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=p.reflectivity,g.ior.value=p.ior,g.refractionRatio.value=p.refractionRatio),p.lightMap&&(g.lightMap.value=p.lightMap,g.lightMapIntensity.value=p.lightMapIntensity,t(p.lightMap,g.lightMapTransform)),p.aoMap&&(g.aoMap.value=p.aoMap,g.aoMapIntensity.value=p.aoMapIntensity,t(p.aoMap,g.aoMapTransform))}function o(g,p){g.diffuse.value.copy(p.color),g.opacity.value=p.opacity,p.map&&(g.map.value=p.map,t(p.map,g.mapTransform))}function a(g,p){g.dashSize.value=p.dashSize,g.totalSize.value=p.dashSize+p.gapSize,g.scale.value=p.scale}function l(g,p,v,y){g.diffuse.value.copy(p.color),g.opacity.value=p.opacity,g.size.value=p.size*v,g.scale.value=y*.5,p.map&&(g.map.value=p.map,t(p.map,g.uvTransform)),p.alphaMap&&(g.alphaMap.value=p.alphaMap,t(p.alphaMap,g.alphaMapTransform)),p.alphaTest>0&&(g.alphaTest.value=p.alphaTest)}function u(g,p){g.diffuse.value.copy(p.color),g.opacity.value=p.opacity,g.rotation.value=p.rotation,p.map&&(g.map.value=p.map,t(p.map,g.mapTransform)),p.alphaMap&&(g.alphaMap.value=p.alphaMap,t(p.alphaMap,g.alphaMapTransform)),p.alphaTest>0&&(g.alphaTest.value=p.alphaTest)}function c(g,p){g.specular.value.copy(p.specular),g.shininess.value=Math.max(p.shininess,1e-4)}function h(g,p){p.gradientMap&&(g.gradientMap.value=p.gradientMap)}function d(g,p){g.metalness.value=p.metalness,p.metalnessMap&&(g.metalnessMap.value=p.metalnessMap,t(p.metalnessMap,g.metalnessMapTransform)),g.roughness.value=p.roughness,p.roughnessMap&&(g.roughnessMap.value=p.roughnessMap,t(p.roughnessMap,g.roughnessMapTransform)),p.envMap&&(g.envMapIntensity.value=p.envMapIntensity)}function f(g,p,v){g.ior.value=p.ior,p.sheen>0&&(g.sheenColor.value.copy(p.sheenColor).multiplyScalar(p.sheen),g.sheenRoughness.value=p.sheenRoughness,p.sheenColorMap&&(g.sheenColorMap.value=p.sheenColorMap,t(p.sheenColorMap,g.sheenColorMapTransform)),p.sheenRoughnessMap&&(g.sheenRoughnessMap.value=p.sheenRoughnessMap,t(p.sheenRoughnessMap,g.sheenRoughnessMapTransform))),p.clearcoat>0&&(g.clearcoat.value=p.clearcoat,g.clearcoatRoughness.value=p.clearcoatRoughness,p.clearcoatMap&&(g.clearcoatMap.value=p.clearcoatMap,t(p.clearcoatMap,g.clearcoatMapTransform)),p.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=p.clearcoatRoughnessMap,t(p.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),p.clearcoatNormalMap&&(g.clearcoatNormalMap.value=p.clearcoatNormalMap,t(p.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(p.clearcoatNormalScale),p.side===$t&&g.clearcoatNormalScale.value.negate())),p.dispersion>0&&(g.dispersion.value=p.dispersion),p.iridescence>0&&(g.iridescence.value=p.iridescence,g.iridescenceIOR.value=p.iridescenceIOR,g.iridescenceThicknessMinimum.value=p.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=p.iridescenceThicknessRange[1],p.iridescenceMap&&(g.iridescenceMap.value=p.iridescenceMap,t(p.iridescenceMap,g.iridescenceMapTransform)),p.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=p.iridescenceThicknessMap,t(p.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),p.transmission>0&&(g.transmission.value=p.transmission,g.transmissionSamplerMap.value=v.texture,g.transmissionSamplerSize.value.set(v.width,v.height),p.transmissionMap&&(g.transmissionMap.value=p.transmissionMap,t(p.transmissionMap,g.transmissionMapTransform)),g.thickness.value=p.thickness,p.thicknessMap&&(g.thicknessMap.value=p.thicknessMap,t(p.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=p.attenuationDistance,g.attenuationColor.value.copy(p.attenuationColor)),p.anisotropy>0&&(g.anisotropyVector.value.set(p.anisotropy*Math.cos(p.anisotropyRotation),p.anisotropy*Math.sin(p.anisotropyRotation)),p.anisotropyMap&&(g.anisotropyMap.value=p.anisotropyMap,t(p.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=p.specularIntensity,g.specularColor.value.copy(p.specularColor),p.specularColorMap&&(g.specularColorMap.value=p.specularColorMap,t(p.specularColorMap,g.specularColorMapTransform)),p.specularIntensityMap&&(g.specularIntensityMap.value=p.specularIntensityMap,t(p.specularIntensityMap,g.specularIntensityMapTransform))}function m(g,p){p.matcap&&(g.matcap.value=p.matcap)}function _(g,p){const v=e.get(p).light;g.referencePosition.value.setFromMatrixPosition(v.matrixWorld),g.nearDistance.value=v.shadow.camera.near,g.farDistance.value=v.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function ZB(n,e,t,i){let r={},s={},o=[];const a=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function l(v,y){const x=y.program;i.uniformBlockBinding(v,x)}function u(v,y){let x=r[v.id];x===void 0&&(m(v),x=c(v),r[v.id]=x,v.addEventListener("dispose",g));const T=y.program;i.updateUBOMapping(v,T);const S=e.render.frame;s[v.id]!==S&&(d(v),s[v.id]=S)}function c(v){const y=h();v.__bindingPointIndex=y;const x=n.createBuffer(),T=v.__size,S=v.usage;return n.bindBuffer(n.UNIFORM_BUFFER,x),n.bufferData(n.UNIFORM_BUFFER,T,S),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,y,x),x}function h(){for(let v=0;v<a;v++)if(o.indexOf(v)===-1)return o.push(v),v;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(v){const y=r[v.id],x=v.uniforms,T=v.__cache;n.bindBuffer(n.UNIFORM_BUFFER,y);for(let S=0,w=x.length;S<w;S++){const E=Array.isArray(x[S])?x[S]:[x[S]];for(let M=0,b=E.length;M<b;M++){const R=E[M];if(f(R,S,M,T)===!0){const I=R.__offset,B=Array.isArray(R.value)?R.value:[R.value];let D=0;for(let L=0;L<B.length;L++){const z=B[L],ie=_(z);typeof z=="number"||typeof z=="boolean"?(R.__data[0]=z,n.bufferSubData(n.UNIFORM_BUFFER,I+D,R.__data)):z.isMatrix3?(R.__data[0]=z.elements[0],R.__data[1]=z.elements[1],R.__data[2]=z.elements[2],R.__data[3]=0,R.__data[4]=z.elements[3],R.__data[5]=z.elements[4],R.__data[6]=z.elements[5],R.__data[7]=0,R.__data[8]=z.elements[6],R.__data[9]=z.elements[7],R.__data[10]=z.elements[8],R.__data[11]=0):(z.toArray(R.__data,D),D+=ie.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,I,R.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function f(v,y,x,T){const S=v.value,w=y+"_"+x;if(T[w]===void 0)return typeof S=="number"||typeof S=="boolean"?T[w]=S:T[w]=S.clone(),!0;{const E=T[w];if(typeof S=="number"||typeof S=="boolean"){if(E!==S)return T[w]=S,!0}else if(E.equals(S)===!1)return E.copy(S),!0}return!1}function m(v){const y=v.uniforms;let x=0;const T=16;for(let w=0,E=y.length;w<E;w++){const M=Array.isArray(y[w])?y[w]:[y[w]];for(let b=0,R=M.length;b<R;b++){const I=M[b],B=Array.isArray(I.value)?I.value:[I.value];for(let D=0,L=B.length;D<L;D++){const z=B[D],ie=_(z),k=x%T,Z=k%ie.boundary,W=k+Z;x+=Z,W!==0&&T-W<ie.storage&&(x+=T-W),I.__data=new Float32Array(ie.storage/Float32Array.BYTES_PER_ELEMENT),I.__offset=x,x+=ie.storage}}}const S=x%T;return S>0&&(x+=T-S),v.__size=x,v.__cache={},this}function _(v){const y={boundary:0,storage:0};return typeof v=="number"||typeof v=="boolean"?(y.boundary=4,y.storage=4):v.isVector2?(y.boundary=8,y.storage=8):v.isVector3||v.isColor?(y.boundary=16,y.storage=12):v.isVector4?(y.boundary=16,y.storage=16):v.isMatrix3?(y.boundary=48,y.storage=48):v.isMatrix4?(y.boundary=64,y.storage=64):v.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",v),y}function g(v){const y=v.target;y.removeEventListener("dispose",g);const x=o.indexOf(y.__bindingPointIndex);o.splice(x,1),n.deleteBuffer(r[y.id]),delete r[y.id],delete s[y.id]}function p(){for(const v in r)n.deleteBuffer(r[v]);o=[],r={},s={}}return{bind:l,update:u,dispose:p}}class JB{constructor(e={}){const{canvas:t=KM(),context:i=null,depth:r=!0,stencil:s=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:u=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:h=!1,reverseDepthBuffer:d=!1}=e;this.isWebGLRenderer=!0;let f;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");f=i.getContextAttributes().alpha}else f=o;const m=new Uint32Array(4),_=new Int32Array(4);let g=null,p=null;const v=[],y=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Be,this.toneMapping=Ai,this.toneMappingExposure=1;const x=this;let T=!1,S=0,w=0,E=null,M=-1,b=null;const R=new et,I=new et;let B=null;const D=new Ue(0);let L=0,z=t.width,ie=t.height,k=1,Z=null,W=null;const K=new et(0,0,z,ie),he=new et(0,0,z,ie);let Ie=!1;const O=new Fp;let X=!1,ae=!1;this.transmissionResolutionScale=1;const re=new pt,Ee=new pt,Re=new N,Fe=new et,mt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let ut=!1;function Ct(){return E===null?k:1}let F=i;function nn(C,H){return t.getContext(C,H)}try{const C={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:u,powerPreference:c,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${kl}`),t.addEventListener("webglcontextlost",ue,!1),t.addEventListener("webglcontextrestored",Me,!1),t.addEventListener("webglcontextcreationerror",we,!1),F===null){const H="webgl2";if(F=nn(H,C),F===null)throw nn(H)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(C){throw console.error("THREE.WebGLRenderer: "+C.message),C}let ct,dt,Ge,Ht,ze,P,A,j,le,de,se,ke,be,Ne,xt,_e,Pe,$e,Ye,De,gt,lt,Ot,G;function Se(){ct=new lO(F),ct.init(),lt=new WB(F,ct),dt=new nO(F,ct,e,lt),Ge=new VB(F,ct),dt.reverseDepthBuffer&&d&&Ge.buffers.depth.setReversed(!0),Ht=new hO(F),ze=new RB,P=new HB(F,ct,Ge,ze,dt,lt,Ht),A=new rO(x),j=new aO(x),le=new ZU(F),Ot=new eO(F,le),de=new uO(F,le,Ht,Ot),se=new fO(F,de,le,Ht),Ye=new dO(F,dt,P),_e=new iO(ze),ke=new CB(x,A,j,ct,dt,Ot,_e),be=new QB(x,ze),Ne=new PB,xt=new OB(ct),$e=new J3(x,A,j,Ge,se,f,l),Pe=new zB(x,se,dt),G=new ZB(F,Ht,dt,Ge),De=new tO(F,ct,Ht),gt=new cO(F,ct,Ht),Ht.programs=ke.programs,x.capabilities=dt,x.extensions=ct,x.properties=ze,x.renderLists=Ne,x.shadowMap=Pe,x.state=Ge,x.info=Ht}Se();const ee=new YB(x,F);this.xr=ee,this.getContext=function(){return F},this.getContextAttributes=function(){return F.getContextAttributes()},this.forceContextLoss=function(){const C=ct.get("WEBGL_lose_context");C&&C.loseContext()},this.forceContextRestore=function(){const C=ct.get("WEBGL_lose_context");C&&C.restoreContext()},this.getPixelRatio=function(){return k},this.setPixelRatio=function(C){C!==void 0&&(k=C,this.setSize(z,ie,!1))},this.getSize=function(C){return C.set(z,ie)},this.setSize=function(C,H,q=!0){if(ee.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}z=C,ie=H,t.width=Math.floor(C*k),t.height=Math.floor(H*k),q===!0&&(t.style.width=C+"px",t.style.height=H+"px"),this.setViewport(0,0,C,H)},this.getDrawingBufferSize=function(C){return C.set(z*k,ie*k).floor()},this.setDrawingBufferSize=function(C,H,q){z=C,ie=H,k=q,t.width=Math.floor(C*q),t.height=Math.floor(H*q),this.setViewport(0,0,C,H)},this.getCurrentViewport=function(C){return C.copy(R)},this.getViewport=function(C){return C.copy(K)},this.setViewport=function(C,H,q,Y){C.isVector4?K.set(C.x,C.y,C.z,C.w):K.set(C,H,q,Y),Ge.viewport(R.copy(K).multiplyScalar(k).round())},this.getScissor=function(C){return C.copy(he)},this.setScissor=function(C,H,q,Y){C.isVector4?he.set(C.x,C.y,C.z,C.w):he.set(C,H,q,Y),Ge.scissor(I.copy(he).multiplyScalar(k).round())},this.getScissorTest=function(){return Ie},this.setScissorTest=function(C){Ge.setScissorTest(Ie=C)},this.setOpaqueSort=function(C){Z=C},this.setTransparentSort=function(C){W=C},this.getClearColor=function(C){return C.copy($e.getClearColor())},this.setClearColor=function(){$e.setClearColor.apply($e,arguments)},this.getClearAlpha=function(){return $e.getClearAlpha()},this.setClearAlpha=function(){$e.setClearAlpha.apply($e,arguments)},this.clear=function(C=!0,H=!0,q=!0){let Y=0;if(C){let $=!1;if(E!==null){const ge=E.texture.format;$=ge===jl||ge===$l||ge===Wl}if($){const ge=E.texture.type,Te=ge===Kn||ge===en||ge===Pr||ge===ts||ge===rp||ge===sp,Ce=$e.getClearColor(),Le=$e.getClearAlpha(),Ke=Ce.r,Je=Ce.g,Ve=Ce.b;Te?(m[0]=Ke,m[1]=Je,m[2]=Ve,m[3]=Le,F.clearBufferuiv(F.COLOR,0,m)):(_[0]=Ke,_[1]=Je,_[2]=Ve,_[3]=Le,F.clearBufferiv(F.COLOR,0,_))}else Y|=F.COLOR_BUFFER_BIT}H&&(Y|=F.DEPTH_BUFFER_BIT),q&&(Y|=F.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),F.clear(Y)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ue,!1),t.removeEventListener("webglcontextrestored",Me,!1),t.removeEventListener("webglcontextcreationerror",we,!1),$e.dispose(),Ne.dispose(),xt.dispose(),ze.dispose(),A.dispose(),j.dispose(),se.dispose(),Ot.dispose(),G.dispose(),ke.dispose(),ee.dispose(),ee.removeEventListener("sessionstart",_2),ee.removeEventListener("sessionend",v2),ll.stop()};function ue(C){C.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),T=!0}function Me(){console.log("THREE.WebGLRenderer: Context Restored."),T=!1;const C=Ht.autoReset,H=Pe.enabled,q=Pe.autoUpdate,Y=Pe.needsUpdate,$=Pe.type;Se(),Ht.autoReset=C,Pe.enabled=H,Pe.autoUpdate=q,Pe.needsUpdate=Y,Pe.type=$}function we(C){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",C.statusMessage)}function rt(C){const H=C.target;H.removeEventListener("dispose",rt),an(H)}function an(C){ri(C),ze.remove(C)}function ri(C){const H=ze.get(C).programs;H!==void 0&&(H.forEach(function(q){ke.releaseProgram(q)}),C.isShaderMaterial&&ke.releaseShaderCache(C))}this.renderBufferDirect=function(C,H,q,Y,$,ge){H===null&&(H=mt);const Te=$.isMesh&&$.matrixWorld.determinant()<0,Ce=SQ(C,H,q,Y,$);Ge.setMaterial(Y,Te);let Le=q.index,Ke=1;if(Y.wireframe===!0){if(Le=de.getWireframeAttribute(q),Le===void 0)return;Ke=2}const Je=q.drawRange,Ve=q.attributes.position;let St=Je.start*Ke,Rt=(Je.start+Je.count)*Ke;ge!==null&&(St=Math.max(St,ge.start*Ke),Rt=Math.min(Rt,(ge.start+ge.count)*Ke)),Le!==null?(St=Math.max(St,0),Rt=Math.min(Rt,Le.count)):Ve!=null&&(St=Math.max(St,0),Rt=Math.min(Rt,Ve.count));const wn=Rt-St;if(wn<0||wn===1/0)return;Ot.setup($,Y,Ce,q,Le);let ln,bt=De;if(Le!==null&&(ln=le.get(Le),bt=gt,bt.setIndex(ln)),$.isMesh)Y.wireframe===!0?(Ge.setLineWidth(Y.wireframeLinewidth*Ct()),bt.setMode(F.LINES)):bt.setMode(F.TRIANGLES);else if($.isLine){let He=Y.linewidth;He===void 0&&(He=1),Ge.setLineWidth(He*Ct()),$.isLineSegments?bt.setMode(F.LINES):$.isLineLoop?bt.setMode(F.LINE_LOOP):bt.setMode(F.LINE_STRIP)}else $.isPoints?bt.setMode(F.POINTS):$.isSprite&&bt.setMode(F.TRIANGLES);if($.isBatchedMesh)if($._multiDrawInstances!==null)bt.renderMultiDrawInstances($._multiDrawStarts,$._multiDrawCounts,$._multiDrawCount,$._multiDrawInstances);else if(ct.get("WEBGL_multi_draw"))bt.renderMultiDraw($._multiDrawStarts,$._multiDrawCounts,$._multiDrawCount);else{const He=$._multiDrawStarts,$n=$._multiDrawCounts,Nt=$._multiDrawCount,Xr=Le?le.get(Le).bytesPerElement:1,dc=ze.get(Y).currentProgram.getUniforms();for(let sr=0;sr<Nt;sr++)dc.setValue(F,"_gl_DrawID",sr),bt.render(He[sr]/Xr,$n[sr])}else if($.isInstancedMesh)bt.renderInstances(St,wn,$.count);else if(q.isInstancedBufferGeometry){const He=q._maxInstanceCount!==void 0?q._maxInstanceCount:1/0,$n=Math.min(q.instanceCount,He);bt.renderInstances(St,wn,$n)}else bt.render(St,wn)};function Lt(C,H,q){C.transparent===!0&&C.side===ui&&C.forceSinglePass===!1?(C.side=$t,C.needsUpdate=!0,Pg(C,H,q),C.side=Nr,C.needsUpdate=!0,Pg(C,H,q),C.side=ui):Pg(C,H,q)}this.compile=function(C,H,q=null){q===null&&(q=C),p=xt.get(q),p.init(H),y.push(p),q.traverseVisible(function($){$.isLight&&$.layers.test(H.layers)&&(p.pushLight($),$.castShadow&&p.pushShadow($))}),C!==q&&C.traverseVisible(function($){$.isLight&&$.layers.test(H.layers)&&(p.pushLight($),$.castShadow&&p.pushShadow($))}),p.setupLights();const Y=new Set;return C.traverse(function($){if(!($.isMesh||$.isPoints||$.isLine||$.isSprite))return;const ge=$.material;if(ge)if(Array.isArray(ge))for(let Te=0;Te<ge.length;Te++){const Ce=ge[Te];Lt(Ce,q,$),Y.add(Ce)}else Lt(ge,q,$),Y.add(ge)}),y.pop(),p=null,Y},this.compileAsync=function(C,H,q=null){const Y=this.compile(C,H,q);return new Promise($=>{function ge(){if(Y.forEach(function(Te){ze.get(Te).currentProgram.isReady()&&Y.delete(Te)}),Y.size===0){$(C);return}setTimeout(ge,10)}ct.get("KHR_parallel_shader_compile")!==null?ge():setTimeout(ge,10)})};let jr=null;function ao(C){jr&&jr(C)}function _2(){ll.stop()}function v2(){ll.start()}const ll=new $E;ll.setAnimationLoop(ao),typeof self<"u"&&ll.setContext(self),this.setAnimationLoop=function(C){jr=C,ee.setAnimationLoop(C),C===null?ll.stop():ll.start()},ee.addEventListener("sessionstart",_2),ee.addEventListener("sessionend",v2),this.render=function(C,H){if(H!==void 0&&H.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(T===!0)return;if(C.matrixWorldAutoUpdate===!0&&C.updateMatrixWorld(),H.parent===null&&H.matrixWorldAutoUpdate===!0&&H.updateMatrixWorld(),ee.enabled===!0&&ee.isPresenting===!0&&(ee.cameraAutoUpdate===!0&&ee.updateCamera(H),H=ee.getCamera()),C.isScene===!0&&C.onBeforeRender(x,C,H,E),p=xt.get(C,y.length),p.init(H),y.push(p),Ee.multiplyMatrices(H.projectionMatrix,H.matrixWorldInverse),O.setFromProjectionMatrix(Ee),ae=this.localClippingEnabled,X=_e.init(this.clippingPlanes,ae),g=Ne.get(C,v.length),g.init(),v.push(g),ee.enabled===!0&&ee.isPresenting===!0){const ge=x.xr.getDepthSensingMesh();ge!==null&&cT(ge,H,-1/0,x.sortObjects)}cT(C,H,0,x.sortObjects),g.finish(),x.sortObjects===!0&&g.sort(Z,W),ut=ee.enabled===!1||ee.isPresenting===!1||ee.hasDepthSensing()===!1,ut&&$e.addToRenderList(g,C),this.info.render.frame++,X===!0&&_e.beginShadows();const q=p.state.shadowsArray;Pe.render(q,C,H),X===!0&&_e.endShadows(),this.info.autoReset===!0&&this.info.reset();const Y=g.opaque,$=g.transmissive;if(p.setupLights(),H.isArrayCamera){const ge=H.cameras;if($.length>0)for(let Te=0,Ce=ge.length;Te<Ce;Te++){const Le=ge[Te];x2(Y,$,C,Le)}ut&&$e.render(C);for(let Te=0,Ce=ge.length;Te<Ce;Te++){const Le=ge[Te];y2(g,C,Le,Le.viewport)}}else $.length>0&&x2(Y,$,C,H),ut&&$e.render(C),y2(g,C,H);E!==null&&w===0&&(P.updateMultisampleRenderTarget(E),P.updateRenderTargetMipmap(E)),C.isScene===!0&&C.onAfterRender(x,C,H),Ot.resetDefaultState(),M=-1,b=null,y.pop(),y.length>0?(p=y[y.length-1],X===!0&&_e.setGlobalState(x.clippingPlanes,p.state.camera)):p=null,v.pop(),v.length>0?g=v[v.length-1]:g=null};function cT(C,H,q,Y){if(C.visible===!1)return;if(C.layers.test(H.layers)){if(C.isGroup)q=C.renderOrder;else if(C.isLOD)C.autoUpdate===!0&&C.update(H);else if(C.isLight)p.pushLight(C),C.castShadow&&p.pushShadow(C);else if(C.isSprite){if(!C.frustumCulled||O.intersectsSprite(C)){Y&&Fe.setFromMatrixPosition(C.matrixWorld).applyMatrix4(Ee);const Te=se.update(C),Ce=C.material;Ce.visible&&g.push(C,Te,Ce,q,Fe.z,null)}}else if((C.isMesh||C.isLine||C.isPoints)&&(!C.frustumCulled||O.intersectsObject(C))){const Te=se.update(C),Ce=C.material;if(Y&&(C.boundingSphere!==void 0?(C.boundingSphere===null&&C.computeBoundingSphere(),Fe.copy(C.boundingSphere.center)):(Te.boundingSphere===null&&Te.computeBoundingSphere(),Fe.copy(Te.boundingSphere.center)),Fe.applyMatrix4(C.matrixWorld).applyMatrix4(Ee)),Array.isArray(Ce)){const Le=Te.groups;for(let Ke=0,Je=Le.length;Ke<Je;Ke++){const Ve=Le[Ke],St=Ce[Ve.materialIndex];St&&St.visible&&g.push(C,Te,St,q,Fe.z,Ve)}}else Ce.visible&&g.push(C,Te,Ce,q,Fe.z,null)}}const ge=C.children;for(let Te=0,Ce=ge.length;Te<Ce;Te++)cT(ge[Te],H,q,Y)}function y2(C,H,q,Y){const $=C.opaque,ge=C.transmissive,Te=C.transparent;p.setupLightsView(q),X===!0&&_e.setGlobalState(x.clippingPlanes,q),Y&&Ge.viewport(R.copy(Y)),$.length>0&&Ng($,H,q),ge.length>0&&Ng(ge,H,q),Te.length>0&&Ng(Te,H,q),Ge.buffers.depth.setTest(!0),Ge.buffers.depth.setMask(!0),Ge.buffers.color.setMask(!0),Ge.setPolygonOffset(!1)}function x2(C,H,q,Y){if((q.isScene===!0?q.overrideMaterial:null)!==null)return;p.state.transmissionRenderTarget[Y.id]===void 0&&(p.state.transmissionRenderTarget[Y.id]=new Fo(1,1,{generateMipmaps:!0,type:ct.has("EXT_color_buffer_half_float")||ct.has("EXT_color_buffer_float")?hi:Kn,minFilter:ci,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:st.workingColorSpace}));const ge=p.state.transmissionRenderTarget[Y.id],Te=Y.viewport||R;ge.setSize(Te.z*x.transmissionResolutionScale,Te.w*x.transmissionResolutionScale);const Ce=x.getRenderTarget();x.setRenderTarget(ge),x.getClearColor(D),L=x.getClearAlpha(),L<1&&x.setClearColor(16777215,.5),x.clear(),ut&&$e.render(q);const Le=x.toneMapping;x.toneMapping=Ai;const Ke=Y.viewport;if(Y.viewport!==void 0&&(Y.viewport=void 0),p.setupLightsView(Y),X===!0&&_e.setGlobalState(x.clippingPlanes,Y),Ng(C,q,Y),P.updateMultisampleRenderTarget(ge),P.updateRenderTargetMipmap(ge),ct.has("WEBGL_multisampled_render_to_texture")===!1){let Je=!1;for(let Ve=0,St=H.length;Ve<St;Ve++){const Rt=H[Ve],wn=Rt.object,ln=Rt.geometry,bt=Rt.material,He=Rt.group;if(bt.side===ui&&wn.layers.test(Y.layers)){const $n=bt.side;bt.side=$t,bt.needsUpdate=!0,S2(wn,q,Y,ln,bt,He),bt.side=$n,bt.needsUpdate=!0,Je=!0}}Je===!0&&(P.updateMultisampleRenderTarget(ge),P.updateRenderTargetMipmap(ge))}x.setRenderTarget(Ce),x.setClearColor(D,L),Ke!==void 0&&(Y.viewport=Ke),x.toneMapping=Le}function Ng(C,H,q){const Y=H.isScene===!0?H.overrideMaterial:null;for(let $=0,ge=C.length;$<ge;$++){const Te=C[$],Ce=Te.object,Le=Te.geometry,Ke=Y===null?Te.material:Y,Je=Te.group;Ce.layers.test(q.layers)&&S2(Ce,H,q,Le,Ke,Je)}}function S2(C,H,q,Y,$,ge){C.onBeforeRender(x,H,q,Y,$,ge),C.modelViewMatrix.multiplyMatrices(q.matrixWorldInverse,C.matrixWorld),C.normalMatrix.getNormalMatrix(C.modelViewMatrix),$.onBeforeRender(x,H,q,Y,C,ge),$.transparent===!0&&$.side===ui&&$.forceSinglePass===!1?($.side=$t,$.needsUpdate=!0,x.renderBufferDirect(q,H,Y,$,C,ge),$.side=Nr,$.needsUpdate=!0,x.renderBufferDirect(q,H,Y,$,C,ge),$.side=ui):x.renderBufferDirect(q,H,Y,$,C,ge),C.onAfterRender(x,H,q,Y,$,ge)}function Pg(C,H,q){H.isScene!==!0&&(H=mt);const Y=ze.get(C),$=p.state.lights,ge=p.state.shadowsArray,Te=$.state.version,Ce=ke.getParameters(C,$.state,ge,H,q),Le=ke.getProgramCacheKey(Ce);let Ke=Y.programs;Y.environment=C.isMeshStandardMaterial?H.environment:null,Y.fog=H.fog,Y.envMap=(C.isMeshStandardMaterial?j:A).get(C.envMap||Y.environment),Y.envMapRotation=Y.environment!==null&&C.envMap===null?H.environmentRotation:C.envMapRotation,Ke===void 0&&(C.addEventListener("dispose",rt),Ke=new Map,Y.programs=Ke);let Je=Ke.get(Le);if(Je!==void 0){if(Y.currentProgram===Je&&Y.lightsStateVersion===Te)return b2(C,Ce),Je}else Ce.uniforms=ke.getUniforms(C),C.onBeforeCompile(Ce,x),Je=ke.acquireProgram(Ce,Le),Ke.set(Le,Je),Y.uniforms=Ce.uniforms;const Ve=Y.uniforms;return(!C.isShaderMaterial&&!C.isRawShaderMaterial||C.clipping===!0)&&(Ve.clippingPlanes=_e.uniform),b2(C,Ce),Y.needsLights=bQ(C),Y.lightsStateVersion=Te,Y.needsLights&&(Ve.ambientLightColor.value=$.state.ambient,Ve.lightProbe.value=$.state.probe,Ve.directionalLights.value=$.state.directional,Ve.directionalLightShadows.value=$.state.directionalShadow,Ve.spotLights.value=$.state.spot,Ve.spotLightShadows.value=$.state.spotShadow,Ve.rectAreaLights.value=$.state.rectArea,Ve.ltc_1.value=$.state.rectAreaLTC1,Ve.ltc_2.value=$.state.rectAreaLTC2,Ve.pointLights.value=$.state.point,Ve.pointLightShadows.value=$.state.pointShadow,Ve.hemisphereLights.value=$.state.hemi,Ve.directionalShadowMap.value=$.state.directionalShadowMap,Ve.directionalShadowMatrix.value=$.state.directionalShadowMatrix,Ve.spotShadowMap.value=$.state.spotShadowMap,Ve.spotLightMatrix.value=$.state.spotLightMatrix,Ve.spotLightMap.value=$.state.spotLightMap,Ve.pointShadowMap.value=$.state.pointShadowMap,Ve.pointShadowMatrix.value=$.state.pointShadowMatrix),Y.currentProgram=Je,Y.uniformsList=null,Je}function T2(C){if(C.uniformsList===null){const H=C.currentProgram.getUniforms();C.uniformsList=Yp.seqWithValue(H.seq,C.uniforms)}return C.uniformsList}function b2(C,H){const q=ze.get(C);q.outputColorSpace=H.outputColorSpace,q.batching=H.batching,q.batchingColor=H.batchingColor,q.instancing=H.instancing,q.instancingColor=H.instancingColor,q.instancingMorph=H.instancingMorph,q.skinning=H.skinning,q.morphTargets=H.morphTargets,q.morphNormals=H.morphNormals,q.morphColors=H.morphColors,q.morphTargetsCount=H.morphTargetsCount,q.numClippingPlanes=H.numClippingPlanes,q.numIntersection=H.numClipIntersection,q.vertexAlphas=H.vertexAlphas,q.vertexTangents=H.vertexTangents,q.toneMapping=H.toneMapping}function SQ(C,H,q,Y,$){H.isScene!==!0&&(H=mt),P.resetTextureUnits();const ge=H.fog,Te=Y.isMeshStandardMaterial?H.environment:null,Ce=E===null?x.outputColorSpace:E.isXRRenderTarget===!0?E.texture.colorSpace:mr,Le=(Y.isMeshStandardMaterial?j:A).get(Y.envMap||Te),Ke=Y.vertexColors===!0&&!!q.attributes.color&&q.attributes.color.itemSize===4,Je=!!q.attributes.tangent&&(!!Y.normalMap||Y.anisotropy>0),Ve=!!q.morphAttributes.position,St=!!q.morphAttributes.normal,Rt=!!q.morphAttributes.color;let wn=Ai;Y.toneMapped&&(E===null||E.isXRRenderTarget===!0)&&(wn=x.toneMapping);const ln=q.morphAttributes.position||q.morphAttributes.normal||q.morphAttributes.color,bt=ln!==void 0?ln.length:0,He=ze.get(Y),$n=p.state.lights;if(X===!0&&(ae===!0||C!==b)){const xi=C===b&&Y.id===M;_e.setState(Y,C,xi)}let Nt=!1;Y.version===He.__version?(He.needsLights&&He.lightsStateVersion!==$n.state.version||He.outputColorSpace!==Ce||$.isBatchedMesh&&He.batching===!1||!$.isBatchedMesh&&He.batching===!0||$.isBatchedMesh&&He.batchingColor===!0&&$.colorTexture===null||$.isBatchedMesh&&He.batchingColor===!1&&$.colorTexture!==null||$.isInstancedMesh&&He.instancing===!1||!$.isInstancedMesh&&He.instancing===!0||$.isSkinnedMesh&&He.skinning===!1||!$.isSkinnedMesh&&He.skinning===!0||$.isInstancedMesh&&He.instancingColor===!0&&$.instanceColor===null||$.isInstancedMesh&&He.instancingColor===!1&&$.instanceColor!==null||$.isInstancedMesh&&He.instancingMorph===!0&&$.morphTexture===null||$.isInstancedMesh&&He.instancingMorph===!1&&$.morphTexture!==null||He.envMap!==Le||Y.fog===!0&&He.fog!==ge||He.numClippingPlanes!==void 0&&(He.numClippingPlanes!==_e.numPlanes||He.numIntersection!==_e.numIntersection)||He.vertexAlphas!==Ke||He.vertexTangents!==Je||He.morphTargets!==Ve||He.morphNormals!==St||He.morphColors!==Rt||He.toneMapping!==wn||He.morphTargetsCount!==bt)&&(Nt=!0):(Nt=!0,He.__version=Y.version);let Xr=He.currentProgram;Nt===!0&&(Xr=Pg(Y,H,$));let dc=!1,sr=!1,zd=!1;const Kt=Xr.getUniforms(),Sr=He.uniforms;if(Ge.useProgram(Xr.program)&&(dc=!0,sr=!0,zd=!0),Y.id!==M&&(M=Y.id,sr=!0),dc||b!==C){Ge.buffers.depth.getReversed()?(re.copy(C.projectionMatrix),OI(re),BI(re),Kt.setValue(F,"projectionMatrix",re)):Kt.setValue(F,"projectionMatrix",C.projectionMatrix),Kt.setValue(F,"viewMatrix",C.matrixWorldInverse);const zi=Kt.map.cameraPosition;zi!==void 0&&zi.setValue(F,Re.setFromMatrixPosition(C.matrixWorld)),dt.logarithmicDepthBuffer&&Kt.setValue(F,"logDepthBufFC",2/(Math.log(C.far+1)/Math.LN2)),(Y.isMeshPhongMaterial||Y.isMeshToonMaterial||Y.isMeshLambertMaterial||Y.isMeshBasicMaterial||Y.isMeshStandardMaterial||Y.isShaderMaterial)&&Kt.setValue(F,"isOrthographic",C.isOrthographicCamera===!0),b!==C&&(b=C,sr=!0,zd=!0)}if($.isSkinnedMesh){Kt.setOptional(F,$,"bindMatrix"),Kt.setOptional(F,$,"bindMatrixInverse");const xi=$.skeleton;xi&&(xi.boneTexture===null&&xi.computeBoneTexture(),Kt.setValue(F,"boneTexture",xi.boneTexture,P))}$.isBatchedMesh&&(Kt.setOptional(F,$,"batchingTexture"),Kt.setValue(F,"batchingTexture",$._matricesTexture,P),Kt.setOptional(F,$,"batchingIdTexture"),Kt.setValue(F,"batchingIdTexture",$._indirectTexture,P),Kt.setOptional(F,$,"batchingColorTexture"),$._colorsTexture!==null&&Kt.setValue(F,"batchingColorTexture",$._colorsTexture,P));const Tr=q.morphAttributes;if((Tr.position!==void 0||Tr.normal!==void 0||Tr.color!==void 0)&&Ye.update($,q,Xr),(sr||He.receiveShadow!==$.receiveShadow)&&(He.receiveShadow=$.receiveShadow,Kt.setValue(F,"receiveShadow",$.receiveShadow)),Y.isMeshGouraudMaterial&&Y.envMap!==null&&(Sr.envMap.value=Le,Sr.flipEnvMap.value=Le.isCubeTexture&&Le.isRenderTargetTexture===!1?-1:1),Y.isMeshStandardMaterial&&Y.envMap===null&&H.environment!==null&&(Sr.envMapIntensity.value=H.environmentIntensity),sr&&(Kt.setValue(F,"toneMappingExposure",x.toneMappingExposure),He.needsLights&&TQ(Sr,zd),ge&&Y.fog===!0&&be.refreshFogUniforms(Sr,ge),be.refreshMaterialUniforms(Sr,Y,k,ie,p.state.transmissionRenderTarget[C.id]),Yp.upload(F,T2(He),Sr,P)),Y.isShaderMaterial&&Y.uniformsNeedUpdate===!0&&(Yp.upload(F,T2(He),Sr,P),Y.uniformsNeedUpdate=!1),Y.isSpriteMaterial&&Kt.setValue(F,"center",$.center),Kt.setValue(F,"modelViewMatrix",$.modelViewMatrix),Kt.setValue(F,"normalMatrix",$.normalMatrix),Kt.setValue(F,"modelMatrix",$.matrixWorld),Y.isShaderMaterial||Y.isRawShaderMaterial){const xi=Y.uniformsGroups;for(let zi=0,hT=xi.length;zi<hT;zi++){const ul=xi[zi];G.update(ul,Xr),G.bind(ul,Xr)}}return Xr}function TQ(C,H){C.ambientLightColor.needsUpdate=H,C.lightProbe.needsUpdate=H,C.directionalLights.needsUpdate=H,C.directionalLightShadows.needsUpdate=H,C.pointLights.needsUpdate=H,C.pointLightShadows.needsUpdate=H,C.spotLights.needsUpdate=H,C.spotLightShadows.needsUpdate=H,C.rectAreaLights.needsUpdate=H,C.hemisphereLights.needsUpdate=H}function bQ(C){return C.isMeshLambertMaterial||C.isMeshToonMaterial||C.isMeshPhongMaterial||C.isMeshStandardMaterial||C.isShadowMaterial||C.isShaderMaterial&&C.lights===!0}this.getActiveCubeFace=function(){return S},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return E},this.setRenderTargetTextures=function(C,H,q){ze.get(C.texture).__webglTexture=H,ze.get(C.depthTexture).__webglTexture=q;const Y=ze.get(C);Y.__hasExternalTextures=!0,Y.__autoAllocateDepthBuffer=q===void 0,Y.__autoAllocateDepthBuffer||ct.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Y.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(C,H){const q=ze.get(C);q.__webglFramebuffer=H,q.__useDefaultFramebuffer=H===void 0};const wQ=F.createFramebuffer();this.setRenderTarget=function(C,H=0,q=0){E=C,S=H,w=q;let Y=!0,$=null,ge=!1,Te=!1;if(C){const Le=ze.get(C);if(Le.__useDefaultFramebuffer!==void 0)Ge.bindFramebuffer(F.FRAMEBUFFER,null),Y=!1;else if(Le.__webglFramebuffer===void 0)P.setupRenderTarget(C);else if(Le.__hasExternalTextures)P.rebindTextures(C,ze.get(C.texture).__webglTexture,ze.get(C.depthTexture).__webglTexture);else if(C.depthBuffer){const Ve=C.depthTexture;if(Le.__boundDepthTexture!==Ve){if(Ve!==null&&ze.has(Ve)&&(C.width!==Ve.image.width||C.height!==Ve.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");P.setupDepthRenderbuffer(C)}}const Ke=C.texture;(Ke.isData3DTexture||Ke.isDataArrayTexture||Ke.isCompressedArrayTexture)&&(Te=!0);const Je=ze.get(C).__webglFramebuffer;C.isWebGLCubeRenderTarget?(Array.isArray(Je[H])?$=Je[H][q]:$=Je[H],ge=!0):C.samples>0&&P.useMultisampledRTT(C)===!1?$=ze.get(C).__webglMultisampledFramebuffer:Array.isArray(Je)?$=Je[q]:$=Je,R.copy(C.viewport),I.copy(C.scissor),B=C.scissorTest}else R.copy(K).multiplyScalar(k).floor(),I.copy(he).multiplyScalar(k).floor(),B=Ie;if(q!==0&&($=wQ),Ge.bindFramebuffer(F.FRAMEBUFFER,$)&&Y&&Ge.drawBuffers(C,$),Ge.viewport(R),Ge.scissor(I),Ge.setScissorTest(B),ge){const Le=ze.get(C.texture);F.framebufferTexture2D(F.FRAMEBUFFER,F.COLOR_ATTACHMENT0,F.TEXTURE_CUBE_MAP_POSITIVE_X+H,Le.__webglTexture,q)}else if(Te){const Le=ze.get(C.texture),Ke=H;F.framebufferTextureLayer(F.FRAMEBUFFER,F.COLOR_ATTACHMENT0,Le.__webglTexture,q,Ke)}else if(C!==null&&q!==0){const Le=ze.get(C.texture);F.framebufferTexture2D(F.FRAMEBUFFER,F.COLOR_ATTACHMENT0,F.TEXTURE_2D,Le.__webglTexture,q)}M=-1},this.readRenderTargetPixels=function(C,H,q,Y,$,ge,Te){if(!(C&&C.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ce=ze.get(C).__webglFramebuffer;if(C.isWebGLCubeRenderTarget&&Te!==void 0&&(Ce=Ce[Te]),Ce){Ge.bindFramebuffer(F.FRAMEBUFFER,Ce);try{const Le=C.texture,Ke=Le.format,Je=Le.type;if(!dt.textureFormatReadable(Ke)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!dt.textureTypeReadable(Je)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}H>=0&&H<=C.width-Y&&q>=0&&q<=C.height-$&&F.readPixels(H,q,Y,$,lt.convert(Ke),lt.convert(Je),ge)}finally{const Le=E!==null?ze.get(E).__webglFramebuffer:null;Ge.bindFramebuffer(F.FRAMEBUFFER,Le)}}},this.readRenderTargetPixelsAsync=async function(C,H,q,Y,$,ge,Te){if(!(C&&C.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Ce=ze.get(C).__webglFramebuffer;if(C.isWebGLCubeRenderTarget&&Te!==void 0&&(Ce=Ce[Te]),Ce){const Le=C.texture,Ke=Le.format,Je=Le.type;if(!dt.textureFormatReadable(Ke))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!dt.textureTypeReadable(Je))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(H>=0&&H<=C.width-Y&&q>=0&&q<=C.height-$){Ge.bindFramebuffer(F.FRAMEBUFFER,Ce);const Ve=F.createBuffer();F.bindBuffer(F.PIXEL_PACK_BUFFER,Ve),F.bufferData(F.PIXEL_PACK_BUFFER,ge.byteLength,F.STREAM_READ),F.readPixels(H,q,Y,$,lt.convert(Ke),lt.convert(Je),0);const St=E!==null?ze.get(E).__webglFramebuffer:null;Ge.bindFramebuffer(F.FRAMEBUFFER,St);const Rt=F.fenceSync(F.SYNC_GPU_COMMANDS_COMPLETE,0);return F.flush(),await FI(F,Rt,4),F.bindBuffer(F.PIXEL_PACK_BUFFER,Ve),F.getBufferSubData(F.PIXEL_PACK_BUFFER,0,ge),F.deleteBuffer(Ve),F.deleteSync(Rt),ge}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(C,H=null,q=0){C.isTexture!==!0&&(Pa("WebGLRenderer: copyFramebufferToTexture function signature has changed."),H=arguments[0]||null,C=arguments[1]);const Y=Math.pow(2,-q),$=Math.floor(C.image.width*Y),ge=Math.floor(C.image.height*Y),Te=H!==null?H.x:0,Ce=H!==null?H.y:0;P.setTexture2D(C,0),F.copyTexSubImage2D(F.TEXTURE_2D,q,0,0,Te,Ce,$,ge),Ge.unbindTexture()};const MQ=F.createFramebuffer(),EQ=F.createFramebuffer();this.copyTextureToTexture=function(C,H,q=null,Y=null,$=0,ge=null){C.isTexture!==!0&&(Pa("WebGLRenderer: copyTextureToTexture function signature has changed."),Y=arguments[0]||null,C=arguments[1],H=arguments[2],ge=arguments[3]||0,q=null),ge===null&&($!==0?(Pa("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),ge=$,$=0):ge=0);let Te,Ce,Le,Ke,Je,Ve,St,Rt,wn;const ln=C.isCompressedTexture?C.mipmaps[ge]:C.image;if(q!==null)Te=q.max.x-q.min.x,Ce=q.max.y-q.min.y,Le=q.isBox3?q.max.z-q.min.z:1,Ke=q.min.x,Je=q.min.y,Ve=q.isBox3?q.min.z:0;else{const Tr=Math.pow(2,-$);Te=Math.floor(ln.width*Tr),Ce=Math.floor(ln.height*Tr),C.isDataArrayTexture?Le=ln.depth:C.isData3DTexture?Le=Math.floor(ln.depth*Tr):Le=1,Ke=0,Je=0,Ve=0}Y!==null?(St=Y.x,Rt=Y.y,wn=Y.z):(St=0,Rt=0,wn=0);const bt=lt.convert(H.format),He=lt.convert(H.type);let $n;H.isData3DTexture?(P.setTexture3D(H,0),$n=F.TEXTURE_3D):H.isDataArrayTexture||H.isCompressedArrayTexture?(P.setTexture2DArray(H,0),$n=F.TEXTURE_2D_ARRAY):(P.setTexture2D(H,0),$n=F.TEXTURE_2D),F.pixelStorei(F.UNPACK_FLIP_Y_WEBGL,H.flipY),F.pixelStorei(F.UNPACK_PREMULTIPLY_ALPHA_WEBGL,H.premultiplyAlpha),F.pixelStorei(F.UNPACK_ALIGNMENT,H.unpackAlignment);const Nt=F.getParameter(F.UNPACK_ROW_LENGTH),Xr=F.getParameter(F.UNPACK_IMAGE_HEIGHT),dc=F.getParameter(F.UNPACK_SKIP_PIXELS),sr=F.getParameter(F.UNPACK_SKIP_ROWS),zd=F.getParameter(F.UNPACK_SKIP_IMAGES);F.pixelStorei(F.UNPACK_ROW_LENGTH,ln.width),F.pixelStorei(F.UNPACK_IMAGE_HEIGHT,ln.height),F.pixelStorei(F.UNPACK_SKIP_PIXELS,Ke),F.pixelStorei(F.UNPACK_SKIP_ROWS,Je),F.pixelStorei(F.UNPACK_SKIP_IMAGES,Ve);const Kt=C.isDataArrayTexture||C.isData3DTexture,Sr=H.isDataArrayTexture||H.isData3DTexture;if(C.isDepthTexture){const Tr=ze.get(C),xi=ze.get(H),zi=ze.get(Tr.__renderTarget),hT=ze.get(xi.__renderTarget);Ge.bindFramebuffer(F.READ_FRAMEBUFFER,zi.__webglFramebuffer),Ge.bindFramebuffer(F.DRAW_FRAMEBUFFER,hT.__webglFramebuffer);for(let ul=0;ul<Le;ul++)Kt&&(F.framebufferTextureLayer(F.READ_FRAMEBUFFER,F.COLOR_ATTACHMENT0,ze.get(C).__webglTexture,$,Ve+ul),F.framebufferTextureLayer(F.DRAW_FRAMEBUFFER,F.COLOR_ATTACHMENT0,ze.get(H).__webglTexture,ge,wn+ul)),F.blitFramebuffer(Ke,Je,Te,Ce,St,Rt,Te,Ce,F.DEPTH_BUFFER_BIT,F.NEAREST);Ge.bindFramebuffer(F.READ_FRAMEBUFFER,null),Ge.bindFramebuffer(F.DRAW_FRAMEBUFFER,null)}else if($!==0||C.isRenderTargetTexture||ze.has(C)){const Tr=ze.get(C),xi=ze.get(H);Ge.bindFramebuffer(F.READ_FRAMEBUFFER,MQ),Ge.bindFramebuffer(F.DRAW_FRAMEBUFFER,EQ);for(let zi=0;zi<Le;zi++)Kt?F.framebufferTextureLayer(F.READ_FRAMEBUFFER,F.COLOR_ATTACHMENT0,Tr.__webglTexture,$,Ve+zi):F.framebufferTexture2D(F.READ_FRAMEBUFFER,F.COLOR_ATTACHMENT0,F.TEXTURE_2D,Tr.__webglTexture,$),Sr?F.framebufferTextureLayer(F.DRAW_FRAMEBUFFER,F.COLOR_ATTACHMENT0,xi.__webglTexture,ge,wn+zi):F.framebufferTexture2D(F.DRAW_FRAMEBUFFER,F.COLOR_ATTACHMENT0,F.TEXTURE_2D,xi.__webglTexture,ge),$!==0?F.blitFramebuffer(Ke,Je,Te,Ce,St,Rt,Te,Ce,F.COLOR_BUFFER_BIT,F.NEAREST):Sr?F.copyTexSubImage3D($n,ge,St,Rt,wn+zi,Ke,Je,Te,Ce):F.copyTexSubImage2D($n,ge,St,Rt,Ke,Je,Te,Ce);Ge.bindFramebuffer(F.READ_FRAMEBUFFER,null),Ge.bindFramebuffer(F.DRAW_FRAMEBUFFER,null)}else Sr?C.isDataTexture||C.isData3DTexture?F.texSubImage3D($n,ge,St,Rt,wn,Te,Ce,Le,bt,He,ln.data):H.isCompressedArrayTexture?F.compressedTexSubImage3D($n,ge,St,Rt,wn,Te,Ce,Le,bt,ln.data):F.texSubImage3D($n,ge,St,Rt,wn,Te,Ce,Le,bt,He,ln):C.isDataTexture?F.texSubImage2D(F.TEXTURE_2D,ge,St,Rt,Te,Ce,bt,He,ln.data):C.isCompressedTexture?F.compressedTexSubImage2D(F.TEXTURE_2D,ge,St,Rt,ln.width,ln.height,bt,ln.data):F.texSubImage2D(F.TEXTURE_2D,ge,St,Rt,Te,Ce,bt,He,ln);F.pixelStorei(F.UNPACK_ROW_LENGTH,Nt),F.pixelStorei(F.UNPACK_IMAGE_HEIGHT,Xr),F.pixelStorei(F.UNPACK_SKIP_PIXELS,dc),F.pixelStorei(F.UNPACK_SKIP_ROWS,sr),F.pixelStorei(F.UNPACK_SKIP_IMAGES,zd),ge===0&&H.generateMipmaps&&F.generateMipmap($n),Ge.unbindTexture()},this.copyTextureToTexture3D=function(C,H,q=null,Y=null,$=0){return C.isTexture!==!0&&(Pa("WebGLRenderer: copyTextureToTexture3D function signature has changed."),q=arguments[0]||null,Y=arguments[1]||null,C=arguments[2],H=arguments[3],$=arguments[4]||0),Pa('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(C,H,q,Y,$)},this.initRenderTarget=function(C){ze.get(C).__webglFramebuffer===void 0&&P.setupRenderTarget(C)},this.initTexture=function(C){C.isCubeTexture?P.setTextureCube(C,0):C.isData3DTexture?P.setTexture3D(C,0):C.isDataArrayTexture||C.isCompressedArrayTexture?P.setTexture2DArray(C,0):P.setTexture2D(C,0),Ge.unbindTexture()},this.resetState=function(){S=0,w=0,E=null,Ge.reset(),Ot.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Ci}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorspace=st._getDrawingBufferColorSpace(e),t.unpackColorSpace=st._getUnpackColorSpace()}}const Iu=new Fr,zs=new ce,x1=new N,_0=new ce,Qp=new ce,Zp=new N,v0=new N,S1=new pt,T1=new N,b1=new N;let Ri=null,os=null;const Gs=[],Wo={NONE:-1,PAN:0,ROTATE:1};class ek extends $p{constructor(e,t,i=null){super(t,i),this.objects=e,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new VE,this.mouseButtons={LEFT:In.PAN,MIDDLE:In.PAN,RIGHT:In.ROTATE},this.touches={ONE:Cs.PAN},this._onPointerMove=tk.bind(this),this._onPointerDown=nk.bind(this),this._onPointerCancel=ik.bind(this),this._onContextMenu=rk.bind(this),i!==null&&this.connect()}connect(){this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(e){const t=this.domElement.getBoundingClientRect();zs.x=(e.clientX-t.left)/t.width*2-1,zs.y=-(e.clientY-t.top)/t.height*2+1}_updateState(e){let t;if(e.pointerType==="touch")t=this.touches.ONE;else switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=null}switch(t){case In.PAN:case Cs.PAN:this.state=Wo.PAN;break;case In.ROTATE:case Cs.ROTATE:this.state=Wo.ROTATE;break;default:this.state=Wo.NONE}}getRaycaster(){return console.warn("THREE.DragControls: getRaycaster() has been deprecated. Use controls.raycaster instead."),this.raycaster}setObjects(e){console.warn("THREE.DragControls: setObjects() has been deprecated. Use controls.objects instead."),this.objects=e}getObjects(){return console.warn("THREE.DragControls: getObjects() has been deprecated. Use controls.objects instead."),this.objects}activate(){console.warn("THREE.DragControls: activate() has been renamed to connect()."),this.connect()}deactivate(){console.warn("THREE.DragControls: deactivate() has been renamed to disconnect()."),this.disconnect()}set mode(e){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}get mode(){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}}function tk(n){const e=this.object,t=this.domElement,i=this.raycaster;if(this.enabled!==!1){if(this._updatePointer(n),i.setFromCamera(zs,e),Ri)this.state===Wo.PAN?i.ray.intersectPlane(Iu,Zp)&&Ri.position.copy(Zp.sub(x1).applyMatrix4(S1)):this.state===Wo.ROTATE&&(_0.subVectors(zs,Qp).multiplyScalar(this.rotateSpeed),Ri.rotateOnWorldAxis(T1,_0.x),Ri.rotateOnWorldAxis(b1.normalize(),-_0.y)),this.dispatchEvent({type:"drag",object:Ri}),Qp.copy(zs);else if(n.pointerType==="mouse"||n.pointerType==="pen")if(Gs.length=0,i.setFromCamera(zs,e),i.intersectObjects(this.objects,this.recursive,Gs),Gs.length>0){const r=Gs[0].object;Iu.setFromNormalAndCoplanarPoint(e.getWorldDirection(Iu.normal),v0.setFromMatrixPosition(r.matrixWorld)),os!==r&&os!==null&&(this.dispatchEvent({type:"hoveroff",object:os}),t.style.cursor="auto",os=null),os!==r&&(this.dispatchEvent({type:"hoveron",object:r}),t.style.cursor="pointer",os=r)}else os!==null&&(this.dispatchEvent({type:"hoveroff",object:os}),t.style.cursor="auto",os=null);Qp.copy(zs)}}function nk(n){const e=this.object,t=this.domElement,i=this.raycaster;this.enabled!==!1&&(this._updatePointer(n),this._updateState(n),Gs.length=0,i.setFromCamera(zs,e),i.intersectObjects(this.objects,this.recursive,Gs),Gs.length>0&&(this.transformGroup===!0?Ri=w1(Gs[0].object):Ri=Gs[0].object,Iu.setFromNormalAndCoplanarPoint(e.getWorldDirection(Iu.normal),v0.setFromMatrixPosition(Ri.matrixWorld)),i.ray.intersectPlane(Iu,Zp)&&(this.state===Wo.PAN?(S1.copy(Ri.parent.matrixWorld).invert(),x1.copy(Zp).sub(v0.setFromMatrixPosition(Ri.matrixWorld))):this.state===Wo.ROTATE&&(T1.set(0,1,0).applyQuaternion(e.quaternion).normalize(),b1.set(1,0,0).applyQuaternion(e.quaternion).normalize())),t.style.cursor="move",this.dispatchEvent({type:"dragstart",object:Ri})),Qp.copy(zs))}function ik(){this.enabled!==!1&&(Ri&&(this.dispatchEvent({type:"dragend",object:Ri}),Ri=null),this.domElement.style.cursor=os?"pointer":"auto",this.state=Wo.NONE)}function rk(n){this.enabled!==!1&&n.preventDefault()}function w1(n,e=null){return n.isGroup&&(e=n),n.parent===null?e:w1(n.parent,e)}function sk(n,e,t){var i,r=1;n==null&&(n=0),e==null&&(e=0),t==null&&(t=0);function s(){var o,a=i.length,l,u=0,c=0,h=0;for(o=0;o<a;++o)l=i[o],u+=l.x||0,c+=l.y||0,h+=l.z||0;for(u=(u/a-n)*r,c=(c/a-e)*r,h=(h/a-t)*r,o=0;o<a;++o)l=i[o],u&&(l.x-=u),c&&(l.y-=c),h&&(l.z-=h)}return s.initialize=function(o){i=o},s.x=function(o){return arguments.length?(n=+o,s):n},s.y=function(o){return arguments.length?(e=+o,s):e},s.z=function(o){return arguments.length?(t=+o,s):t},s.strength=function(o){return arguments.length?(r=+o,s):r},s}function ok(n){const e=+this._x.call(null,n);return M1(this.cover(e),e,n)}function M1(n,e,t){if(isNaN(e))return n;var i,r=n._root,s={data:t},o=n._x0,a=n._x1,l,u,c,h,d;if(!r)return n._root=s,n;for(;r.length;)if((c=e>=(l=(o+a)/2))?o=l:a=l,i=r,!(r=r[h=+c]))return i[h]=s,n;if(u=+n._x.call(null,r.data),e===u)return s.next=r,i?i[h]=s:n._root=s,n;do i=i?i[h]=new Array(2):n._root=new Array(2),(c=e>=(l=(o+a)/2))?o=l:a=l;while((h=+c)==(d=+(u>=l)));return i[d]=r,i[h]=s,n}function ak(n){Array.isArray(n)||(n=Array.from(n));const e=n.length,t=new Float64Array(e);let i=1/0,r=-1/0;for(let s=0,o;s<e;++s)isNaN(o=+this._x.call(null,n[s]))||(t[s]=o,o<i&&(i=o),o>r&&(r=o));if(i>r)return this;this.cover(i).cover(r);for(let s=0;s<e;++s)M1(this,t[s],n[s]);return this}function lk(n){if(isNaN(n=+n))return this;var e=this._x0,t=this._x1;if(isNaN(e))t=(e=Math.floor(n))+1;else{for(var i=t-e||1,r=this._root,s,o;e>n||n>=t;)switch(o=+(n<e),s=new Array(2),s[o]=r,r=s,i*=2,o){case 0:t=e+i;break;case 1:e=t-i;break}this._root&&this._root.length&&(this._root=r)}return this._x0=e,this._x1=t,this}function uk(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function ck(n){return arguments.length?this.cover(+n[0][0]).cover(+n[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]}function Vs(n,e,t){this.node=n,this.x0=e,this.x1=t}function hk(n,e){var t,i=this._x0,r,s,o=this._x1,a=[],l=this._root,u,c;for(l&&a.push(new Vs(l,i,o)),e==null?e=1/0:(i=n-e,o=n+e);u=a.pop();)if(!(!(l=u.node)||(r=u.x0)>o||(s=u.x1)<i))if(l.length){var h=(r+s)/2;a.push(new Vs(l[1],h,s),new Vs(l[0],r,h)),(c=+(n>=h))&&(u=a[a.length-1],a[a.length-1]=a[a.length-1-c],a[a.length-1-c]=u)}else{var d=Math.abs(n-+this._x.call(null,l.data));d<e&&(e=d,i=n-d,o=n+d,t=l.data)}return t}function dk(n){if(isNaN(l=+this._x.call(null,n)))return this;var e,t=this._root,i,r,s,o=this._x0,a=this._x1,l,u,c,h,d;if(!t)return this;if(t.length)for(;;){if((c=l>=(u=(o+a)/2))?o=u:a=u,e=t,!(t=t[h=+c]))return this;if(!t.length)break;e[h+1&1]&&(i=e,d=h)}for(;t.data!==n;)if(r=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,r?(s?r.next=s:delete r.next,this):e?(s?e[h]=s:delete e[h],(t=e[0]||e[1])&&t===(e[1]||e[0])&&!t.length&&(i?i[d]=t:this._root=t),this):(this._root=s,this)}function fk(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function pk(){return this._root}function mk(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function gk(n){var e=[],t,i=this._root,r,s,o;for(i&&e.push(new Vs(i,this._x0,this._x1));t=e.pop();)if(!n(i=t.node,s=t.x0,o=t.x1)&&i.length){var a=(s+o)/2;(r=i[1])&&e.push(new Vs(r,a,o)),(r=i[0])&&e.push(new Vs(r,s,a))}return this}function _k(n){var e=[],t=[],i;for(this._root&&e.push(new Vs(this._root,this._x0,this._x1));i=e.pop();){var r=i.node;if(r.length){var s,o=i.x0,a=i.x1,l=(o+a)/2;(s=r[0])&&e.push(new Vs(s,o,l)),(s=r[1])&&e.push(new Vs(s,l,a))}t.push(i)}for(;i=t.pop();)n(i.node,i.x0,i.x1);return this}function vk(n){return n[0]}function yk(n){return arguments.length?(this._x=n,this):this._x}function E1(n,e){var t=new y0(e??vk,NaN,NaN);return n==null?t:t.addAll(n)}function y0(n,e,t){this._x=n,this._x0=e,this._x1=t,this._root=void 0}function A1(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var Ni=E1.prototype=y0.prototype;Ni.copy=function(){var n=new y0(this._x,this._x0,this._x1),e=this._root,t,i;if(!e)return n;if(!e.length)return n._root=A1(e),n;for(t=[{source:e,target:n._root=new Array(2)}];e=t.pop();)for(var r=0;r<2;++r)(i=e.source[r])&&(i.length?t.push({source:i,target:e.target[r]=new Array(2)}):e.target[r]=A1(i));return n},Ni.add=ok,Ni.addAll=ak,Ni.cover=lk,Ni.data=uk,Ni.extent=ck,Ni.find=hk,Ni.remove=dk,Ni.removeAll=fk,Ni.root=pk,Ni.size=mk,Ni.visit=gk,Ni.visitAfter=_k,Ni.x=yk;function xk(n){const e=+this._x.call(null,n),t=+this._y.call(null,n);return C1(this.cover(e,t),e,t,n)}function C1(n,e,t,i){if(isNaN(e)||isNaN(t))return n;var r,s=n._root,o={data:i},a=n._x0,l=n._y0,u=n._x1,c=n._y1,h,d,f,m,_,g,p,v;if(!s)return n._root=o,n;for(;s.length;)if((_=e>=(h=(a+u)/2))?a=h:u=h,(g=t>=(d=(l+c)/2))?l=d:c=d,r=s,!(s=s[p=g<<1|_]))return r[p]=o,n;if(f=+n._x.call(null,s.data),m=+n._y.call(null,s.data),e===f&&t===m)return o.next=s,r?r[p]=o:n._root=o,n;do r=r?r[p]=new Array(4):n._root=new Array(4),(_=e>=(h=(a+u)/2))?a=h:u=h,(g=t>=(d=(l+c)/2))?l=d:c=d;while((p=g<<1|_)===(v=(m>=d)<<1|f>=h));return r[v]=s,r[p]=o,n}function Sk(n){var e,t,i=n.length,r,s,o=new Array(i),a=new Array(i),l=1/0,u=1/0,c=-1/0,h=-1/0;for(t=0;t<i;++t)isNaN(r=+this._x.call(null,e=n[t]))||isNaN(s=+this._y.call(null,e))||(o[t]=r,a[t]=s,r<l&&(l=r),r>c&&(c=r),s<u&&(u=s),s>h&&(h=s));if(l>c||u>h)return this;for(this.cover(l,u).cover(c,h),t=0;t<i;++t)C1(this,o[t],a[t],n[t]);return this}function Tk(n,e){if(isNaN(n=+n)||isNaN(e=+e))return this;var t=this._x0,i=this._y0,r=this._x1,s=this._y1;if(isNaN(t))r=(t=Math.floor(n))+1,s=(i=Math.floor(e))+1;else{for(var o=r-t||1,a=this._root,l,u;t>n||n>=r||i>e||e>=s;)switch(u=(e<i)<<1|n<t,l=new Array(4),l[u]=a,a=l,o*=2,u){case 0:r=t+o,s=i+o;break;case 1:t=r-o,s=i+o;break;case 2:r=t+o,i=s-o;break;case 3:t=r-o,i=s-o;break}this._root&&this._root.length&&(this._root=a)}return this._x0=t,this._y0=i,this._x1=r,this._y1=s,this}function bk(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function wk(n){return arguments.length?this.cover(+n[0][0],+n[0][1]).cover(+n[1][0],+n[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function gi(n,e,t,i,r){this.node=n,this.x0=e,this.y0=t,this.x1=i,this.y1=r}function Mk(n,e,t){var i,r=this._x0,s=this._y0,o,a,l,u,c=this._x1,h=this._y1,d=[],f=this._root,m,_;for(f&&d.push(new gi(f,r,s,c,h)),t==null?t=1/0:(r=n-t,s=e-t,c=n+t,h=e+t,t*=t);m=d.pop();)if(!(!(f=m.node)||(o=m.x0)>c||(a=m.y0)>h||(l=m.x1)<r||(u=m.y1)<s))if(f.length){var g=(o+l)/2,p=(a+u)/2;d.push(new gi(f[3],g,p,l,u),new gi(f[2],o,p,g,u),new gi(f[1],g,a,l,p),new gi(f[0],o,a,g,p)),(_=(e>=p)<<1|n>=g)&&(m=d[d.length-1],d[d.length-1]=d[d.length-1-_],d[d.length-1-_]=m)}else{var v=n-+this._x.call(null,f.data),y=e-+this._y.call(null,f.data),x=v*v+y*y;if(x<t){var T=Math.sqrt(t=x);r=n-T,s=e-T,c=n+T,h=e+T,i=f.data}}return i}function Ek(n){if(isNaN(c=+this._x.call(null,n))||isNaN(h=+this._y.call(null,n)))return this;var e,t=this._root,i,r,s,o=this._x0,a=this._y0,l=this._x1,u=this._y1,c,h,d,f,m,_,g,p;if(!t)return this;if(t.length)for(;;){if((m=c>=(d=(o+l)/2))?o=d:l=d,(_=h>=(f=(a+u)/2))?a=f:u=f,e=t,!(t=t[g=_<<1|m]))return this;if(!t.length)break;(e[g+1&3]||e[g+2&3]||e[g+3&3])&&(i=e,p=g)}for(;t.data!==n;)if(r=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,r?(s?r.next=s:delete r.next,this):e?(s?e[g]=s:delete e[g],(t=e[0]||e[1]||e[2]||e[3])&&t===(e[3]||e[2]||e[1]||e[0])&&!t.length&&(i?i[p]=t:this._root=t),this):(this._root=s,this)}function Ak(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function Ck(){return this._root}function Rk(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function Nk(n){var e=[],t,i=this._root,r,s,o,a,l;for(i&&e.push(new gi(i,this._x0,this._y0,this._x1,this._y1));t=e.pop();)if(!n(i=t.node,s=t.x0,o=t.y0,a=t.x1,l=t.y1)&&i.length){var u=(s+a)/2,c=(o+l)/2;(r=i[3])&&e.push(new gi(r,u,c,a,l)),(r=i[2])&&e.push(new gi(r,s,c,u,l)),(r=i[1])&&e.push(new gi(r,u,o,a,c)),(r=i[0])&&e.push(new gi(r,s,o,u,c))}return this}function Pk(n){var e=[],t=[],i;for(this._root&&e.push(new gi(this._root,this._x0,this._y0,this._x1,this._y1));i=e.pop();){var r=i.node;if(r.length){var s,o=i.x0,a=i.y0,l=i.x1,u=i.y1,c=(o+l)/2,h=(a+u)/2;(s=r[0])&&e.push(new gi(s,o,a,c,h)),(s=r[1])&&e.push(new gi(s,c,a,l,h)),(s=r[2])&&e.push(new gi(s,o,h,c,u)),(s=r[3])&&e.push(new gi(s,c,h,l,u))}t.push(i)}for(;i=t.pop();)n(i.node,i.x0,i.y0,i.x1,i.y1);return this}function Dk(n){return n[0]}function Lk(n){return arguments.length?(this._x=n,this):this._x}function Ik(n){return n[1]}function Uk(n){return arguments.length?(this._y=n,this):this._y}function Jp(n,e,t){var i=new x0(e??Dk,t??Ik,NaN,NaN,NaN,NaN);return n==null?i:i.addAll(n)}function x0(n,e,t,i,r,s){this._x=n,this._y=e,this._x0=t,this._y0=i,this._x1=r,this._y1=s,this._root=void 0}function R1(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var _i=Jp.prototype=x0.prototype;_i.copy=function(){var n=new x0(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,t,i;if(!e)return n;if(!e.length)return n._root=R1(e),n;for(t=[{source:e,target:n._root=new Array(4)}];e=t.pop();)for(var r=0;r<4;++r)(i=e.source[r])&&(i.length?t.push({source:i,target:e.target[r]=new Array(4)}):e.target[r]=R1(i));return n},_i.add=xk,_i.addAll=Sk,_i.cover=Tk,_i.data=bk,_i.extent=wk,_i.find=Mk,_i.remove=Ek,_i.removeAll=Ak,_i.root=Ck,_i.size=Rk,_i.visit=Nk,_i.visitAfter=Pk,_i.x=Lk,_i.y=Uk;function Fk(n){const e=+this._x.call(null,n),t=+this._y.call(null,n),i=+this._z.call(null,n);return N1(this.cover(e,t,i),e,t,i,n)}function N1(n,e,t,i,r){if(isNaN(e)||isNaN(t)||isNaN(i))return n;var s,o=n._root,a={data:r},l=n._x0,u=n._y0,c=n._z0,h=n._x1,d=n._y1,f=n._z1,m,_,g,p,v,y,x,T,S,w,E;if(!o)return n._root=a,n;for(;o.length;)if((x=e>=(m=(l+h)/2))?l=m:h=m,(T=t>=(_=(u+d)/2))?u=_:d=_,(S=i>=(g=(c+f)/2))?c=g:f=g,s=o,!(o=o[w=S<<2|T<<1|x]))return s[w]=a,n;if(p=+n._x.call(null,o.data),v=+n._y.call(null,o.data),y=+n._z.call(null,o.data),e===p&&t===v&&i===y)return a.next=o,s?s[w]=a:n._root=a,n;do s=s?s[w]=new Array(8):n._root=new Array(8),(x=e>=(m=(l+h)/2))?l=m:h=m,(T=t>=(_=(u+d)/2))?u=_:d=_,(S=i>=(g=(c+f)/2))?c=g:f=g;while((w=S<<2|T<<1|x)===(E=(y>=g)<<2|(v>=_)<<1|p>=m));return s[E]=o,s[w]=a,n}function Ok(n){Array.isArray(n)||(n=Array.from(n));const e=n.length,t=new Float64Array(e),i=new Float64Array(e),r=new Float64Array(e);let s=1/0,o=1/0,a=1/0,l=-1/0,u=-1/0,c=-1/0;for(let h=0,d,f,m,_;h<e;++h)isNaN(f=+this._x.call(null,d=n[h]))||isNaN(m=+this._y.call(null,d))||isNaN(_=+this._z.call(null,d))||(t[h]=f,i[h]=m,r[h]=_,f<s&&(s=f),f>l&&(l=f),m<o&&(o=m),m>u&&(u=m),_<a&&(a=_),_>c&&(c=_));if(s>l||o>u||a>c)return this;this.cover(s,o,a).cover(l,u,c);for(let h=0;h<e;++h)N1(this,t[h],i[h],r[h],n[h]);return this}function Bk(n,e,t){if(isNaN(n=+n)||isNaN(e=+e)||isNaN(t=+t))return this;var i=this._x0,r=this._y0,s=this._z0,o=this._x1,a=this._y1,l=this._z1;if(isNaN(i))o=(i=Math.floor(n))+1,a=(r=Math.floor(e))+1,l=(s=Math.floor(t))+1;else{for(var u=o-i||1,c=this._root,h,d;i>n||n>=o||r>e||e>=a||s>t||t>=l;)switch(d=(t<s)<<2|(e<r)<<1|n<i,h=new Array(8),h[d]=c,c=h,u*=2,d){case 0:o=i+u,a=r+u,l=s+u;break;case 1:i=o-u,a=r+u,l=s+u;break;case 2:o=i+u,r=a-u,l=s+u;break;case 3:i=o-u,r=a-u,l=s+u;break;case 4:o=i+u,a=r+u,s=l-u;break;case 5:i=o-u,a=r+u,s=l-u;break;case 6:o=i+u,r=a-u,s=l-u;break;case 7:i=o-u,r=a-u,s=l-u;break}this._root&&this._root.length&&(this._root=c)}return this._x0=i,this._y0=r,this._z0=s,this._x1=o,this._y1=a,this._z1=l,this}function kk(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function zk(n){return arguments.length?this.cover(+n[0][0],+n[0][1],+n[0][2]).cover(+n[1][0],+n[1][1],+n[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function Ut(n,e,t,i,r,s,o){this.node=n,this.x0=e,this.y0=t,this.z0=i,this.x1=r,this.y1=s,this.z1=o}function Gk(n,e,t,i){var r,s=this._x0,o=this._y0,a=this._z0,l,u,c,h,d,f,m=this._x1,_=this._y1,g=this._z1,p=[],v=this._root,y,x;for(v&&p.push(new Ut(v,s,o,a,m,_,g)),i==null?i=1/0:(s=n-i,o=e-i,a=t-i,m=n+i,_=e+i,g=t+i,i*=i);y=p.pop();)if(!(!(v=y.node)||(l=y.x0)>m||(u=y.y0)>_||(c=y.z0)>g||(h=y.x1)<s||(d=y.y1)<o||(f=y.z1)<a))if(v.length){var T=(l+h)/2,S=(u+d)/2,w=(c+f)/2;p.push(new Ut(v[7],T,S,w,h,d,f),new Ut(v[6],l,S,w,T,d,f),new Ut(v[5],T,u,w,h,S,f),new Ut(v[4],l,u,w,T,S,f),new Ut(v[3],T,S,c,h,d,w),new Ut(v[2],l,S,c,T,d,w),new Ut(v[1],T,u,c,h,S,w),new Ut(v[0],l,u,c,T,S,w)),(x=(t>=w)<<2|(e>=S)<<1|n>=T)&&(y=p[p.length-1],p[p.length-1]=p[p.length-1-x],p[p.length-1-x]=y)}else{var E=n-+this._x.call(null,v.data),M=e-+this._y.call(null,v.data),b=t-+this._z.call(null,v.data),R=E*E+M*M+b*b;if(R<i){var I=Math.sqrt(i=R);s=n-I,o=e-I,a=t-I,m=n+I,_=e+I,g=t+I,r=v.data}}return r}const Vk=(n,e,t,i,r,s)=>Math.sqrt((n-i)**2+(e-r)**2+(t-s)**2);function Hk(n,e,t,i){const r=[],s=n-i,o=e-i,a=t-i,l=n+i,u=e+i,c=t+i;return this.visit((h,d,f,m,_,g,p)=>{if(!h.length)do{const v=h.data;Vk(n,e,t,this._x(v),this._y(v),this._z(v))<=i&&r.push(v)}while(h=h.next);return d>l||f>u||m>c||_<s||g<o||p<a}),r}function Wk(n){if(isNaN(d=+this._x.call(null,n))||isNaN(f=+this._y.call(null,n))||isNaN(m=+this._z.call(null,n)))return this;var e,t=this._root,i,r,s,o=this._x0,a=this._y0,l=this._z0,u=this._x1,c=this._y1,h=this._z1,d,f,m,_,g,p,v,y,x,T,S;if(!t)return this;if(t.length)for(;;){if((v=d>=(_=(o+u)/2))?o=_:u=_,(y=f>=(g=(a+c)/2))?a=g:c=g,(x=m>=(p=(l+h)/2))?l=p:h=p,e=t,!(t=t[T=x<<2|y<<1|v]))return this;if(!t.length)break;(e[T+1&7]||e[T+2&7]||e[T+3&7]||e[T+4&7]||e[T+5&7]||e[T+6&7]||e[T+7&7])&&(i=e,S=T)}for(;t.data!==n;)if(r=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,r?(s?r.next=s:delete r.next,this):e?(s?e[T]=s:delete e[T],(t=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&t===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!t.length&&(i?i[S]=t:this._root=t),this):(this._root=s,this)}function $k(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function jk(){return this._root}function Xk(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function qk(n){var e=[],t,i=this._root,r,s,o,a,l,u,c;for(i&&e.push(new Ut(i,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));t=e.pop();)if(!n(i=t.node,s=t.x0,o=t.y0,a=t.z0,l=t.x1,u=t.y1,c=t.z1)&&i.length){var h=(s+l)/2,d=(o+u)/2,f=(a+c)/2;(r=i[7])&&e.push(new Ut(r,h,d,f,l,u,c)),(r=i[6])&&e.push(new Ut(r,s,d,f,h,u,c)),(r=i[5])&&e.push(new Ut(r,h,o,f,l,d,c)),(r=i[4])&&e.push(new Ut(r,s,o,f,h,d,c)),(r=i[3])&&e.push(new Ut(r,h,d,a,l,u,f)),(r=i[2])&&e.push(new Ut(r,s,d,a,h,u,f)),(r=i[1])&&e.push(new Ut(r,h,o,a,l,d,f)),(r=i[0])&&e.push(new Ut(r,s,o,a,h,d,f))}return this}function Yk(n){var e=[],t=[],i;for(this._root&&e.push(new Ut(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));i=e.pop();){var r=i.node;if(r.length){var s,o=i.x0,a=i.y0,l=i.z0,u=i.x1,c=i.y1,h=i.z1,d=(o+u)/2,f=(a+c)/2,m=(l+h)/2;(s=r[0])&&e.push(new Ut(s,o,a,l,d,f,m)),(s=r[1])&&e.push(new Ut(s,d,a,l,u,f,m)),(s=r[2])&&e.push(new Ut(s,o,f,l,d,c,m)),(s=r[3])&&e.push(new Ut(s,d,f,l,u,c,m)),(s=r[4])&&e.push(new Ut(s,o,a,m,d,f,h)),(s=r[5])&&e.push(new Ut(s,d,a,m,u,f,h)),(s=r[6])&&e.push(new Ut(s,o,f,m,d,c,h)),(s=r[7])&&e.push(new Ut(s,d,f,m,u,c,h))}t.push(i)}for(;i=t.pop();)n(i.node,i.x0,i.y0,i.z0,i.x1,i.y1,i.z1);return this}function Kk(n){return n[0]}function Qk(n){return arguments.length?(this._x=n,this):this._x}function Zk(n){return n[1]}function Jk(n){return arguments.length?(this._y=n,this):this._y}function ez(n){return n[2]}function tz(n){return arguments.length?(this._z=n,this):this._z}function P1(n,e,t,i){var r=new S0(e??Kk,t??Zk,i??ez,NaN,NaN,NaN,NaN,NaN,NaN);return n==null?r:r.addAll(n)}function S0(n,e,t,i,r,s,o,a,l){this._x=n,this._y=e,this._z=t,this._x0=i,this._y0=r,this._z0=s,this._x1=o,this._y1=a,this._z1=l,this._root=void 0}function D1(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var Hn=P1.prototype=S0.prototype;Hn.copy=function(){var n=new S0(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),e=this._root,t,i;if(!e)return n;if(!e.length)return n._root=D1(e),n;for(t=[{source:e,target:n._root=new Array(8)}];e=t.pop();)for(var r=0;r<8;++r)(i=e.source[r])&&(i.length?t.push({source:i,target:e.target[r]=new Array(8)}):e.target[r]=D1(i));return n},Hn.add=Fk,Hn.addAll=Ok,Hn.cover=Bk,Hn.data=kk,Hn.extent=zk,Hn.find=Gk,Hn.findAllWithinRadius=Hk,Hn.remove=Wk,Hn.removeAll=$k,Hn.root=jk,Hn.size=Xk,Hn.visit=qk,Hn.visitAfter=Yk,Hn.x=Qk,Hn.y=Jk,Hn.z=tz;function Hs(n){return function(){return n}}function Ws(n){return(n()-.5)*1e-6}function nz(n){return n.index}function L1(n,e){var t=n.get(e);if(!t)throw new Error("node not found: "+e);return t}function iz(n){var e=nz,t=d,i,r=Hs(30),s,o,a,l,u,c,h=1;n==null&&(n=[]);function d(p){return 1/Math.min(l[p.source.index],l[p.target.index])}function f(p){for(var v=0,y=n.length;v<h;++v)for(var x=0,T,S,w,E=0,M=0,b=0,R,I;x<y;++x)T=n[x],S=T.source,w=T.target,E=w.x+w.vx-S.x-S.vx||Ws(c),a>1&&(M=w.y+w.vy-S.y-S.vy||Ws(c)),a>2&&(b=w.z+w.vz-S.z-S.vz||Ws(c)),R=Math.sqrt(E*E+M*M+b*b),R=(R-s[x])/R*p*i[x],E*=R,M*=R,b*=R,w.vx-=E*(I=u[x]),a>1&&(w.vy-=M*I),a>2&&(w.vz-=b*I),S.vx+=E*(I=1-I),a>1&&(S.vy+=M*I),a>2&&(S.vz+=b*I)}function m(){if(o){var p,v=o.length,y=n.length,x=new Map(o.map((S,w)=>[e(S,w,o),S])),T;for(p=0,l=new Array(v);p<y;++p)T=n[p],T.index=p,typeof T.source!="object"&&(T.source=L1(x,T.source)),typeof T.target!="object"&&(T.target=L1(x,T.target)),l[T.source.index]=(l[T.source.index]||0)+1,l[T.target.index]=(l[T.target.index]||0)+1;for(p=0,u=new Array(y);p<y;++p)T=n[p],u[p]=l[T.source.index]/(l[T.source.index]+l[T.target.index]);i=new Array(y),_(),s=new Array(y),g()}}function _(){if(o)for(var p=0,v=n.length;p<v;++p)i[p]=+t(n[p],p,n)}function g(){if(o)for(var p=0,v=n.length;p<v;++p)s[p]=+r(n[p],p,n)}return f.initialize=function(p,...v){o=p,c=v.find(y=>typeof y=="function")||Math.random,a=v.find(y=>[1,2,3].includes(y))||2,m()},f.links=function(p){return arguments.length?(n=p,m(),f):n},f.id=function(p){return arguments.length?(e=p,f):e},f.iterations=function(p){return arguments.length?(h=+p,f):h},f.strength=function(p){return arguments.length?(t=typeof p=="function"?p:Hs(+p),_(),f):t},f.distance=function(p){return arguments.length?(r=typeof p=="function"?p:Hs(+p),g(),f):r},f}var rz={value:()=>{}};function T0(){for(var n=0,e=arguments.length,t={},i;n<e;++n){if(!(i=arguments[n]+"")||i in t||/[\s.]/.test(i))throw new Error("illegal type: "+i);t[i]=[]}return new em(t)}function em(n){this._=n}function sz(n,e){return n.trim().split(/^|\s+/).map(function(t){var i="",r=t.indexOf(".");if(r>=0&&(i=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:i}})}em.prototype=T0.prototype={constructor:em,on:function(n,e){var t=this._,i=sz(n+"",t),r,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((r=(n=i[s]).type)&&(r=oz(t[r],n.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(r=(n=i[s]).type)t[r]=I1(t[r],n.name,e);else if(e==null)for(r in t)t[r]=I1(t[r],n.name,null);return this},copy:function(){var n={},e=this._;for(var t in e)n[t]=e[t].slice();return new em(n)},call:function(n,e){if((r=arguments.length-2)>0)for(var t=new Array(r),i=0,r,s;i<r;++i)t[i]=arguments[i+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(s=this._[n],i=0,r=s.length;i<r;++i)s[i].value.apply(e,t)},apply:function(n,e,t){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var i=this._[n],r=0,s=i.length;r<s;++r)i[r].value.apply(e,t)}};function oz(n,e){for(var t=0,i=n.length,r;t<i;++t)if((r=n[t]).name===e)return r.value}function I1(n,e,t){for(var i=0,r=n.length;i<r;++i)if(n[i].name===e){n[i]=rz,n=n.slice(0,i).concat(n.slice(i+1));break}return t!=null&&n.push({name:e,value:t}),n}var Uu=0,Gh=0,Vh=0,U1=1e3,tm,Hh,nm=0,Ha=0,im=0,Wh=typeof performance=="object"&&performance.now?performance:Date,F1=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function b0(){return Ha||(F1(az),Ha=Wh.now()+im)}function az(){Ha=0}function rm(){this._call=this._time=this._next=null}rm.prototype=w0.prototype={constructor:rm,restart:function(n,e,t){if(typeof n!="function")throw new TypeError("callback is not a function");t=(t==null?b0():+t)+(e==null?0:+e),!this._next&&Hh!==this&&(Hh?Hh._next=this:tm=this,Hh=this),this._call=n,this._time=t,M0()},stop:function(){this._call&&(this._call=null,this._time=1/0,M0())}};function w0(n,e,t){var i=new rm;return i.restart(n,e,t),i}function lz(){b0(),++Uu;for(var n=tm,e;n;)(e=Ha-n._time)>=0&&n._call.call(void 0,e),n=n._next;--Uu}function O1(){Ha=(nm=Wh.now())+im,Uu=Gh=0;try{lz()}finally{Uu=0,cz(),Ha=0}}function uz(){var n=Wh.now(),e=n-nm;e>U1&&(im-=e,nm=n)}function cz(){for(var n,e=tm,t,i=1/0;e;)e._call?(i>e._time&&(i=e._time),n=e,e=e._next):(t=e._next,e._next=null,e=n?n._next=t:tm=t);Hh=n,M0(i)}function M0(n){if(!Uu){Gh&&(Gh=clearTimeout(Gh));var e=n-Ha;e>24?(n<1/0&&(Gh=setTimeout(O1,n-Wh.now()-im)),Vh&&(Vh=clearInterval(Vh))):(Vh||(nm=Wh.now(),Vh=setInterval(uz,U1)),Uu=1,F1(O1))}}function B1(n,e,t){var i=new rm;return e=e==null?0:+e,i.restart(r=>{i.stop(),n(r+e)},e,t),i}const hz=1664525,dz=1013904223,k1=4294967296;function fz(){let n=1;return()=>(n=(hz*n+dz)%k1)/k1}var z1=3;function E0(n){return n.x}function G1(n){return n.y}function pz(n){return n.z}var mz=10,gz=Math.PI*(3-Math.sqrt(5)),_z=Math.PI*20/(9+Math.sqrt(221));function vz(n,e){e=e||2;var t=Math.min(z1,Math.max(1,Math.round(e))),i,r=1,s=.001,o=1-Math.pow(s,1/300),a=0,l=.6,u=new Map,c=w0(f),h=T0("tick","end"),d=fz();n==null&&(n=[]);function f(){m(),h.call("tick",i),r<s&&(c.stop(),h.call("end",i))}function m(p){var v,y=n.length,x;p===void 0&&(p=1);for(var T=0;T<p;++T)for(r+=(a-r)*o,u.forEach(function(S){S(r)}),v=0;v<y;++v)x=n[v],x.fx==null?x.x+=x.vx*=l:(x.x=x.fx,x.vx=0),t>1&&(x.fy==null?x.y+=x.vy*=l:(x.y=x.fy,x.vy=0)),t>2&&(x.fz==null?x.z+=x.vz*=l:(x.z=x.fz,x.vz=0));return i}function _(){for(var p=0,v=n.length,y;p<v;++p){if(y=n[p],y.index=p,y.fx!=null&&(y.x=y.fx),y.fy!=null&&(y.y=y.fy),y.fz!=null&&(y.z=y.fz),isNaN(y.x)||t>1&&isNaN(y.y)||t>2&&isNaN(y.z)){var x=mz*(t>2?Math.cbrt(.5+p):t>1?Math.sqrt(.5+p):p),T=p*gz,S=p*_z;t===1?y.x=x:t===2?(y.x=x*Math.cos(T),y.y=x*Math.sin(T)):(y.x=x*Math.sin(T)*Math.cos(S),y.y=x*Math.cos(T),y.z=x*Math.sin(T)*Math.sin(S))}(isNaN(y.vx)||t>1&&isNaN(y.vy)||t>2&&isNaN(y.vz))&&(y.vx=0,t>1&&(y.vy=0),t>2&&(y.vz=0))}}function g(p){return p.initialize&&p.initialize(n,d,t),p}return _(),i={tick:m,restart:function(){return c.restart(f),i},stop:function(){return c.stop(),i},numDimensions:function(p){return arguments.length?(t=Math.min(z1,Math.max(1,Math.round(p))),u.forEach(g),i):t},nodes:function(p){return arguments.length?(n=p,_(),u.forEach(g),i):n},alpha:function(p){return arguments.length?(r=+p,i):r},alphaMin:function(p){return arguments.length?(s=+p,i):s},alphaDecay:function(p){return arguments.length?(o=+p,i):+o},alphaTarget:function(p){return arguments.length?(a=+p,i):a},velocityDecay:function(p){return arguments.length?(l=1-p,i):1-l},randomSource:function(p){return arguments.length?(d=p,u.forEach(g),i):d},force:function(p,v){return arguments.length>1?(v==null?u.delete(p):u.set(p,g(v)),i):u.get(p)},find:function(){var p=Array.prototype.slice.call(arguments),v=p.shift()||0,y=(t>1?p.shift():null)||0,x=(t>2?p.shift():null)||0,T=p.shift()||1/0,S=0,w=n.length,E,M,b,R,I,B;for(T*=T,S=0;S<w;++S)I=n[S],E=v-I.x,M=y-(I.y||0),b=x-(I.z||0),R=E*E+M*M+b*b,R<T&&(B=I,T=R);return B},on:function(p,v){return arguments.length>1?(h.on(p,v),i):h.on(p)}}}function yz(){var n,e,t,i,r,s=Hs(-30),o,a=1,l=1/0,u=.81;function c(m){var _,g=n.length,p=(e===1?E1(n,E0):e===2?Jp(n,E0,G1):e===3?P1(n,E0,G1,pz):null).visitAfter(d);for(r=m,_=0;_<g;++_)t=n[_],p.visit(f)}function h(){if(n){var m,_=n.length,g;for(o=new Array(_),m=0;m<_;++m)g=n[m],o[g.index]=+s(g,m,n)}}function d(m){var _=0,g,p,v=0,y,x,T,S,w=m.length;if(w){for(y=x=T=S=0;S<w;++S)(g=m[S])&&(p=Math.abs(g.value))&&(_+=g.value,v+=p,y+=p*(g.x||0),x+=p*(g.y||0),T+=p*(g.z||0));_*=Math.sqrt(4/w),m.x=y/v,e>1&&(m.y=x/v),e>2&&(m.z=T/v)}else{g=m,g.x=g.data.x,e>1&&(g.y=g.data.y),e>2&&(g.z=g.data.z);do _+=o[g.data.index];while(g=g.next)}m.value=_}function f(m,_,g,p,v){if(!m.value)return!0;var y=[g,p,v][e-1],x=m.x-t.x,T=e>1?m.y-t.y:0,S=e>2?m.z-t.z:0,w=y-_,E=x*x+T*T+S*S;if(w*w/u<E)return E<l&&(x===0&&(x=Ws(i),E+=x*x),e>1&&T===0&&(T=Ws(i),E+=T*T),e>2&&S===0&&(S=Ws(i),E+=S*S),E<a&&(E=Math.sqrt(a*E)),t.vx+=x*m.value*r/E,e>1&&(t.vy+=T*m.value*r/E),e>2&&(t.vz+=S*m.value*r/E)),!0;if(m.length||E>=l)return;(m.data!==t||m.next)&&(x===0&&(x=Ws(i),E+=x*x),e>1&&T===0&&(T=Ws(i),E+=T*T),e>2&&S===0&&(S=Ws(i),E+=S*S),E<a&&(E=Math.sqrt(a*E)));do m.data!==t&&(w=o[m.data.index]*r/E,t.vx+=x*w,e>1&&(t.vy+=T*w),e>2&&(t.vz+=S*w));while(m=m.next)}return c.initialize=function(m,..._){n=m,i=_.find(g=>typeof g=="function")||Math.random,e=_.find(g=>[1,2,3].includes(g))||2,h()},c.strength=function(m){return arguments.length?(s=typeof m=="function"?m:Hs(+m),h(),c):s},c.distanceMin=function(m){return arguments.length?(a=m*m,c):Math.sqrt(a)},c.distanceMax=function(m){return arguments.length?(l=m*m,c):Math.sqrt(l)},c.theta=function(m){return arguments.length?(u=m*m,c):Math.sqrt(u)},c}function xz(n,e,t,i){var r,s,o=Hs(.1),a,l;typeof n!="function"&&(n=Hs(+n)),e==null&&(e=0),t==null&&(t=0),i==null&&(i=0);function u(h){for(var d=0,f=r.length;d<f;++d){var m=r[d],_=m.x-e||1e-6,g=(m.y||0)-t||1e-6,p=(m.z||0)-i||1e-6,v=Math.sqrt(_*_+g*g+p*p),y=(l[d]-v)*a[d]*h/v;m.vx+=_*y,s>1&&(m.vy+=g*y),s>2&&(m.vz+=p*y)}}function c(){if(r){var h,d=r.length;for(a=new Array(d),l=new Array(d),h=0;h<d;++h)l[h]=+n(r[h],h,r),a[h]=isNaN(l[h])?0:+o(r[h],h,r)}}return u.initialize=function(h,...d){r=h,s=d.find(f=>[1,2,3].includes(f))||2,c()},u.strength=function(h){return arguments.length?(o=typeof h=="function"?h:Hs(+h),c(),u):o},u.radius=function(h){return arguments.length?(n=typeof h=="function"?h:Hs(+h),c(),u):n},u.x=function(h){return arguments.length?(e=+h,u):e},u.y=function(h){return arguments.length?(t=+h,u):t},u.z=function(h){return arguments.length?(i=+h,u):i},u}var A0=function(e){Tz(e);var t=Sz(e);return e.on=t.on,e.off=t.off,e.fire=t.fire,e};function Sz(n){var e=Object.create(null);return{on:function(t,i,r){if(typeof i!="function")throw new Error("callback is expected to be a function");var s=e[t];return s||(s=e[t]=[]),s.push({callback:i,ctx:r}),n},off:function(t,i){var r=typeof t>"u";if(r)return e=Object.create(null),n;if(e[t]){var s=typeof i!="function";if(s)delete e[t];else for(var o=e[t],a=0;a<o.length;++a)o[a].callback===i&&o.splice(a,1)}return n},fire:function(t){var i=e[t];if(!i)return n;var r;arguments.length>1&&(r=Array.prototype.splice.call(arguments,1));for(var s=0;s<i.length;++s){var o=i[s];o.callback.apply(o.ctx,r)}return n}}}function Tz(n){if(!n)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],t=0;t<e.length;++t)if(n.hasOwnProperty(e[t]))throw new Error("Subject cannot be eventified, since it already has property '"+e[t]+"'")}var bz=Mz,wz=A0;function Mz(n){if(n=n||{},"uniqueLinkId"in n&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n",`
`,`Note: there is also change in default behavior: From now on each graph
is considered to be not a multigraph by default (each edge is unique).`),n.multigraph=n.uniqueLinkId),n.multigraph===void 0&&(n.multigraph=!1),typeof Map!="function")throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var e=new Map,t=new Map,i={},r=0,s=n.multigraph?x:y,o=[],a=z,l=z,u=z,c=z,h={version:20,addNode:_,addLink:v,removeLink:E,removeNode:p,getNode:g,getNodeCount:T,getLinkCount:S,getEdgeCount:S,getLinksCount:S,getNodesCount:T,getLinks:w,forEachNode:Z,forEachLinkedNode:B,forEachLink:I,beginUpdate:u,endUpdate:c,clear:R,hasLink:b,hasNode:g,getLink:b};return wz(h),d(),h;function d(){var W=h.on;h.on=K;function K(){return h.beginUpdate=u=ie,h.endUpdate=c=k,a=f,l=m,h.on=W,W.apply(h,arguments)}}function f(W,K){o.push({link:W,changeType:K})}function m(W,K){o.push({node:W,changeType:K})}function _(W,K){if(W===void 0)throw new Error("Invalid node identifier");u();var he=g(W);return he?(he.data=K,l(he,"update")):(he=new Ez(W,K),l(he,"add")),e.set(W,he),c(),he}function g(W){return e.get(W)}function p(W){var K=g(W);if(!K)return!1;u();var he=K.links;return he&&(he.forEach(M),K.links=null),e.delete(W),l(K,"remove"),c(),!0}function v(W,K,he){u();var Ie=g(W)||_(W),O=g(K)||_(K),X=s(W,K,he),ae=t.has(X.id);return t.set(X.id,X),V1(Ie,X),W!==K&&V1(O,X),a(X,ae?"update":"add"),c(),X}function y(W,K,he){var Ie=sm(W,K),O=t.get(Ie);return O?(O.data=he,O):new H1(W,K,he,Ie)}function x(W,K,he){var Ie=sm(W,K),O=i.hasOwnProperty(Ie);if(O||b(W,K)){O||(i[Ie]=0);var X="@"+ ++i[Ie];Ie=sm(W+X,K+X)}return new H1(W,K,he,Ie)}function T(){return e.size}function S(){return t.size}function w(W){var K=g(W);return K?K.links:null}function E(W,K){return K!==void 0&&(W=b(W,K)),M(W)}function M(W){if(!W||!t.get(W.id))return!1;u(),t.delete(W.id);var K=g(W.fromId),he=g(W.toId);return K&&K.links.delete(W),he&&he.links.delete(W),a(W,"remove"),c(),!0}function b(W,K){if(!(W===void 0||K===void 0))return t.get(sm(W,K))}function R(){u(),Z(function(W){p(W.id)}),c()}function I(W){if(typeof W=="function")for(var K=t.values(),he=K.next();!he.done;){if(W(he.value))return!0;he=K.next()}}function B(W,K,he){var Ie=g(W);if(Ie&&Ie.links&&typeof K=="function")return he?L(Ie.links,W,K):D(Ie.links,W,K)}function D(W,K,he){for(var Ie,O=W.values(),X=O.next();!X.done;){var ae=X.value,re=ae.fromId===K?ae.toId:ae.fromId;if(Ie=he(e.get(re),ae),Ie)return!0;X=O.next()}}function L(W,K,he){for(var Ie,O=W.values(),X=O.next();!X.done;){var ae=X.value;if(ae.fromId===K&&(Ie=he(e.get(ae.toId),ae),Ie))return!0;X=O.next()}}function z(){}function ie(){r+=1}function k(){r-=1,r===0&&o.length>0&&(h.fire("changed",o),o.length=0)}function Z(W){if(typeof W!="function")throw new Error("Function is expected to iterate over graph nodes. You passed "+W);for(var K=e.values(),he=K.next();!he.done;){if(W(he.value))return!0;he=K.next()}}}function Ez(n,e){this.id=n,this.links=null,this.data=e}function V1(n,e){n.links?n.links.add(e):n.links=new Set([e])}function H1(n,e,t,i){this.fromId=n,this.toId=e,this.data=t,this.id=i}function sm(n,e){return n.toString()+" "+e.toString()}const Az=Dg(bz);var C0={exports:{}},$h={exports:{}},W1=function(e){return e===0?"x":e===1?"y":e===2?"z":"c"+(e+1)};const Cz=W1;var Fu=function(e){return t;function t(i,r){let s=r&&r.indent||0,o=r&&r.join!==void 0?r.join:`
`,a=Array(s+1).join(" "),l=[];for(let u=0;u<e;++u){let c=Cz(u),h=u===0?"":a;l.push(h+i.replace(/{var}/g,c))}return l.join(o)}};const $1=Fu;$h.exports=Rz,$h.exports.generateCreateBodyFunctionBody=j1,$h.exports.getVectorCode=q1,$h.exports.getBodyCode=X1;function Rz(n,e){let t=j1(n,e),{Body:i}=new Function(t)();return i}function j1(n,e){return`
${q1(n,e)}
${X1(n)}
return {Body: Body, Vector: Vector};
`}function X1(n){let e=$1(n),t=e("{var}",{join:", "});return`
function Body(${t}) {
  this.isPinned = false;
  this.pos = new Vector(${t});
  this.force = new Vector();
  this.velocity = new Vector();
  this.mass = 1;

  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.reset = function() {
  this.force.reset();
  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.setPosition = function (${t}) {
  ${e("this.pos.{var} = {var} || 0;",{indent:2})}
};`}function q1(n,e){let t=$1(n),i="";return e&&(i=`${t(`
   var v{var};
Object.defineProperty(this, '{var}', {
  set: function(v) { 
    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');
    v{var} = v; 
  },
  get: function() { return v{var}; }
});`)}`),`function Vector(${t("{var}",{join:", "})}) {
  ${i}
    if (typeof arguments[0] === 'object') {
      // could be another vector
      let v = arguments[0];
      ${t('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4})}
      ${t("this.{var} = v.{var};",{indent:4})}
    } else {
      ${t('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4})}
    }
  }
  
  Vector.prototype.reset = function () {
    ${t("this.{var} = ",{join:""})}0;
  };`}var Nz=$h.exports,$o={exports:{}};const R0=Fu,jo=W1;$o.exports=Pz,$o.exports.generateQuadTreeFunctionBody=Y1,$o.exports.getInsertStackCode=eA,$o.exports.getQuadNodeCode=J1,$o.exports.isSamePosition=K1,$o.exports.getChildBodyCode=Z1,$o.exports.setChildBodyCode=Q1;function Pz(n){let e=Y1(n);return new Function(e)()}function Y1(n){let e=R0(n),t=Math.pow(2,n);return`
${eA()}
${J1(n)}
${K1(n)}
${Z1(n)}
${Q1(n)}

function createQuadTree(options, random) {
  options = options || {};
  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;
  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;

  var gravity = options.gravity;
  var updateQueue = [];
  var insertStack = new InsertStack();
  var theta = options.theta;

  var nodesCache = [];
  var currentInCache = 0;
  var root = newNode();

  return {
    insertBodies: insertBodies,

    /**
     * Gets root node if it is present
     */
    getRoot: function() {
      return root;
    },

    updateBodyForce: update,

    options: function(newOptions) {
      if (newOptions) {
        if (typeof newOptions.gravity === 'number') {
          gravity = newOptions.gravity;
        }
        if (typeof newOptions.theta === 'number') {
          theta = newOptions.theta;
        }

        return this;
      }

      return {
        gravity: gravity,
        theta: theta
      };
    }
  };

  function newNode() {
    // To avoid pressure on GC we reuse nodes.
    var node = nodesCache[currentInCache];
    if (node) {
${o("      node.")}
      node.body = null;
      node.mass = ${e("node.mass_{var} = ",{join:""})}0;
      ${e("node.min_{var} = node.max_{var} = ",{join:""})}0;
    } else {
      node = new QuadNode();
      nodesCache[currentInCache] = node;
    }

    ++currentInCache;
    return node;
  }

  function update(sourceBody) {
    var queue = updateQueue;
    var v;
    ${e("var d{var};",{indent:4})}
    var r; 
    ${e("var f{var} = 0;",{indent:4})}
    var queueLength = 1;
    var shiftIdx = 0;
    var pushIdx = 1;

    queue[0] = root;

    while (queueLength) {
      var node = queue[shiftIdx];
      var body = node.body;

      queueLength -= 1;
      shiftIdx += 1;
      var differentBody = (body !== sourceBody);
      if (body && differentBody) {
        // If the current node is a leaf node (and it is not source body),
        // calculate the force exerted by the current node on body, and add this
        // amount to body's net force.
        ${e("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Poor man's protection against zero distance.
          ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
        }

        // This is standard gravitation force calculation but we divide
        // by r^3 to save two operations when normalizing force vector.
        v = gravity * body.mass * sourceBody.mass / (r * r * r);
        ${e("f{var} += v * d{var};",{indent:8})}
      } else if (differentBody) {
        // Otherwise, calculate the ratio s / r,  where s is the width of the region
        // represented by the internal node, and r is the distance between the body
        // and the node's center-of-mass
        ${e("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Sorry about code duplication. I don't want to create many functions
          // right away. Just want to see performance first.
          ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
        }
        // If s / r < , treat this internal node as a single body, and calculate the
        // force it exerts on sourceBody, and add this amount to sourceBody's net force.
        if ((node.max_${jo(0)} - node.min_${jo(0)}) / r < theta) {
          // in the if statement above we consider node's width only
          // because the region was made into square during tree creation.
          // Thus there is no difference between using width or height.
          v = gravity * node.mass * sourceBody.mass / (r * r * r);
          ${e("f{var} += v * d{var};",{indent:10})}
        } else {
          // Otherwise, run the procedure recursively on each of the current node's children.

          // I intentionally unfolded this loop, to save several CPU cycles.
${s()}
        }
      }
    }

    ${e("sourceBody.force.{var} += f{var};",{indent:4})}
  }

  function insertBodies(bodies) {
    ${e("var {var}min = Number.MAX_VALUE;",{indent:4})}
    ${e("var {var}max = Number.MIN_VALUE;",{indent:4})}
    var i = bodies.length;

    // To reduce quad tree depth we are looking for exact bounding box of all particles.
    while (i--) {
      var pos = bodies[i].pos;
      ${e("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6})}
      ${e("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6})}
    }

    // Makes the bounds square.
    var maxSideLength = -Infinity;
    ${e("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4})}

    currentInCache = 0;
    root = newNode();
    ${e("root.min_{var} = {var}min;",{indent:4})}
    ${e("root.max_{var} = {var}min + maxSideLength;",{indent:4})}

    i = bodies.length - 1;
    if (i >= 0) {
      root.body = bodies[i];
    }
    while (i--) {
      insert(bodies[i], root);
    }
  }

  function insert(newBody) {
    insertStack.reset();
    insertStack.push(root, newBody);

    while (!insertStack.isEmpty()) {
      var stackItem = insertStack.pop();
      var node = stackItem.node;
      var body = stackItem.body;

      if (!node.body) {
        // This is internal node. Update the total mass of the node and center-of-mass.
        ${e("var {var} = body.pos.{var};",{indent:8})}
        node.mass += body.mass;
        ${e("node.mass_{var} += body.mass * {var};",{indent:8})}

        // Recursively insert the body in the appropriate quadrant.
        // But first find the appropriate quadrant.
        var quadIdx = 0; // Assume we are in the 0's quad.
        ${e("var min_{var} = node.min_{var};",{indent:8})}
        ${e("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8})}

${r(8)}

        var child = getChild(node, quadIdx);

        if (!child) {
          // The node is internal but this quadrant is not taken. Add
          // subnode to it.
          child = newNode();
          ${e("child.min_{var} = min_{var};",{indent:10})}
          ${e("child.max_{var} = max_{var};",{indent:10})}
          child.body = body;

          setChild(node, quadIdx, child);
        } else {
          // continue searching in this quadrant.
          insertStack.push(child, body);
        }
      } else {
        // We are trying to add to the leaf node.
        // We have to convert current leaf into internal node
        // and continue adding two nodes.
        var oldBody = node.body;
        node.body = null; // internal nodes do not cary bodies

        if (isSamePosition(oldBody.pos, body.pos)) {
          // Prevent infinite subdivision by bumping one node
          // anywhere in this quadrant
          var retriesCount = 3;
          do {
            var offset = random.nextDouble();
            ${e("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12})}

            ${e("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12})}
            retriesCount -= 1;
            // Make sure we don't bump it out of the box. If we do, next iteration should fix it
          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));

          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {
            // This is very bad, we ran out of precision.
            // if we do not return from the method we'll get into
            // infinite loop here. So we sacrifice correctness of layout, and keep the app running
            // Next layout iteration should get larger bounding box in the first step and fix this
            return;
          }
        }
        // Next iteration should subdivide node further.
        insertStack.push(node, oldBody);
        insertStack.push(node, body);
      }
    }
  }
}
return createQuadTree;

`;function r(a){let l=[],u=Array(a+1).join(" ");for(let c=0;c<n;++c)l.push(u+`if (${jo(c)} > max_${jo(c)}) {`),l.push(u+`  quadIdx = quadIdx + ${Math.pow(2,c)};`),l.push(u+`  min_${jo(c)} = max_${jo(c)};`),l.push(u+`  max_${jo(c)} = node.max_${jo(c)};`),l.push(u+"}");return l.join(`
`)}function s(){let a=Array(11).join(" "),l=[];for(let u=0;u<t;++u)l.push(a+`if (node.quad${u}) {`),l.push(a+`  queue[pushIdx] = node.quad${u};`),l.push(a+"  queueLength += 1;"),l.push(a+"  pushIdx += 1;"),l.push(a+"}");return l.join(`
`)}function o(a){let l=[];for(let u=0;u<t;++u)l.push(`${a}quad${u} = null;`);return l.join(`
`)}}function K1(n){let e=R0(n);return`
  function isSamePosition(point1, point2) {
    ${e("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2})}
  
    return ${e("d{var} < 1e-8",{join:" && "})};
  }  
`}function Q1(n){var e=Math.pow(2,n);return`
function setChild(node, idx, child) {
  ${t()}
}`;function t(){let i=[];for(let r=0;r<e;++r){let s=r===0?"  ":"  else ";i.push(`${s}if (idx === ${r}) node.quad${r} = child;`)}return i.join(`
`)}}function Z1(n){return`function getChild(node, idx) {
${e()}
  return null;
}`;function e(){let t=[],i=Math.pow(2,n);for(let r=0;r<i;++r)t.push(`  if (idx === ${r}) return node.quad${r};`);return t.join(`
`)}}function J1(n){let e=R0(n),t=Math.pow(2,n);var i=`
function QuadNode() {
  // body stored inside this node. In quad tree only leaf nodes (by construction)
  // contain bodies:
  this.body = null;

  // Child nodes are stored in quads. Each quad is presented by number:
  // 0 | 1
  // -----
  // 2 | 3
${r("  this.")}

  // Total mass of current node
  this.mass = 0;

  // Center of mass coordinates
  ${e("this.mass_{var} = 0;",{indent:2})}

  // bounding box coordinates
  ${e("this.min_{var} = 0;",{indent:2})}
  ${e("this.max_{var} = 0;",{indent:2})}
}
`;return i;function r(s){let o=[];for(let a=0;a<t;++a)o.push(`${s}quad${a} = null;`);return o.join(`
`)}}function eA(){return`
/**
 * Our implementation of QuadTree is non-recursive to avoid GC hit
 * This data structure represent stack of elements
 * which we are trying to insert into quad tree.
 */
function InsertStack () {
    this.stack = [];
    this.popIdx = 0;
}

InsertStack.prototype = {
    isEmpty: function() {
        return this.popIdx === 0;
    },
    push: function (node, body) {
        var item = this.stack[this.popIdx];
        if (!item) {
            // we are trying to avoid memory pressure: create new element
            // only when absolutely necessary
            this.stack[this.popIdx] = new InsertStackElement(node, body);
        } else {
            item.node = node;
            item.body = body;
        }
        ++this.popIdx;
    },
    pop: function () {
        if (this.popIdx > 0) {
            return this.stack[--this.popIdx];
        }
    },
    reset: function () {
        this.popIdx = 0;
    }
};

function InsertStackElement(node, body) {
    this.node = node; // QuadTree node
    this.body = body; // physical body which needs to be inserted to node
}
`}var Dz=$o.exports,N0={exports:{}};N0.exports=Iz,N0.exports.generateFunctionBody=tA;const Lz=Fu;function Iz(n){let e=tA(n);return new Function("bodies","settings","random",e)}function tA(n){let e=Lz(n);return`
  var boundingBox = {
    ${e("min_{var}: 0, max_{var}: 0,",{indent:4})}
  };

  return {
    box: boundingBox,

    update: updateBoundingBox,

    reset: resetBoundingBox,

    getBestNewPosition: function (neighbors) {
      var ${e("base_{var} = 0",{join:", "})};

      if (neighbors.length) {
        for (var i = 0; i < neighbors.length; ++i) {
          let neighborPos = neighbors[i].pos;
          ${e("base_{var} += neighborPos.{var};",{indent:10})}
        }

        ${e("base_{var} /= neighbors.length;",{indent:8})}
      } else {
        ${e("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8})}
      }

      var springLength = settings.springLength;
      return {
        ${e("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8})}
      };
    }
  };

  function updateBoundingBox() {
    var i = bodies.length;
    if (i === 0) return; // No bodies - no borders.

    ${e("var max_{var} = -Infinity;",{indent:4})}
    ${e("var min_{var} = Infinity;",{indent:4})}

    while(i--) {
      // this is O(n), it could be done faster with quadtree, if we check the root node bounds
      var bodyPos = bodies[i].pos;
      ${e("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6})}
      ${e("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6})}
    }

    ${e("boundingBox.min_{var} = min_{var};",{indent:4})}
    ${e("boundingBox.max_{var} = max_{var};",{indent:4})}
  }

  function resetBoundingBox() {
    ${e("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4})}
  }
`}var Uz=N0.exports,P0={exports:{}};const Fz=Fu;P0.exports=Oz,P0.exports.generateCreateDragForceFunctionBody=nA;function Oz(n){let e=nA(n);return new Function("options",e)}function nA(n){return`
  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');

  return {
    update: function(body) {
      ${Fz(n)("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6})}
    }
  };
`}var Bz=P0.exports,D0={exports:{}};const kz=Fu;D0.exports=zz,D0.exports.generateCreateSpringForceFunctionBody=iA;function zz(n){let e=iA(n);return new Function("options","random",e)}function iA(n){let e=kz(n);return`
  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');
  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');

  return {
    /**
     * Updates forces acting on a spring
     */
    update: function (spring) {
      var body1 = spring.from;
      var body2 = spring.to;
      var length = spring.length < 0 ? options.springLength : spring.length;
      ${e("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6})}
      var r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

      if (r === 0) {
        ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
      }

      var d = r - length;
      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;

      ${e("body1.force.{var} += coefficient * d{var}",{indent:6})};
      body1.springCount += 1;
      body1.springLength += r;

      ${e("body2.force.{var} -= coefficient * d{var}",{indent:6})};
      body2.springCount += 1;
      body2.springLength += r;
    }
  };
`}var Gz=D0.exports,L0={exports:{}};const Vz=Fu;L0.exports=Hz,L0.exports.generateIntegratorFunctionBody=rA;function Hz(n){let e=rA(n);return new Function("bodies","timeStep","adaptiveTimeStepWeight",e)}function rA(n){let e=Vz(n);return`
  var length = bodies.length;
  if (length === 0) return 0;

  ${e("var d{var} = 0, t{var} = 0;",{indent:2})}

  for (var i = 0; i < length; ++i) {
    var body = bodies[i];
    if (body.isPinned) continue;

    if (adaptiveTimeStepWeight && body.springCount) {
      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);
    }

    var coeff = timeStep / body.mass;

    ${e("body.velocity.{var} += coeff * body.force.{var};",{indent:4})}
    ${e("var v{var} = body.velocity.{var};",{indent:4})}
    var v = Math.sqrt(${e("v{var} * v{var}",{join:" + "})});

    if (v > 1) {
      // We normalize it so that we move within timeStep range. 
      // for the case when v <= 1 - we let velocity to fade out.
      ${e("body.velocity.{var} = v{var} / v;",{indent:6})}
    }

    ${e("d{var} = timeStep * body.velocity.{var};",{indent:4})}

    ${e("body.pos.{var} += d{var};",{indent:4})}

    ${e("t{var} += Math.abs(d{var});",{indent:4})}
  }

  return (${e("t{var} * t{var}",{join:" + "})})/length;
`}var Wz=L0.exports,I0,sA;function $z(){if(sA)return I0;sA=1,I0=n;function n(e,t,i,r){this.from=e,this.to=t,this.length=i,this.coefficient=r}return I0}var U0,oA;function jz(){if(oA)return U0;oA=1,U0=n;function n(e,t){var i;if(e||(e={}),t){for(i in t)if(t.hasOwnProperty(i)){var r=e.hasOwnProperty(i),s=typeof t[i],o=!r||typeof e[i]!==s;o?e[i]=t[i]:s==="object"&&(e[i]=n(e[i],t[i]))}}return e}return U0}var jh={exports:{}},aA;function Xz(){if(aA)return jh.exports;aA=1,jh.exports=n,jh.exports.random=n,jh.exports.randomIterator=a;function n(l){var u=typeof l=="number"?l:+new Date;return new e(u)}function e(l){this.seed=l}e.prototype.next=o,e.prototype.nextDouble=s,e.prototype.uniform=s,e.prototype.gaussian=t;function t(){var l,u,c;do u=this.nextDouble()*2-1,c=this.nextDouble()*2-1,l=u*u+c*c;while(l>=1||l===0);return u*Math.sqrt(-2*Math.log(l)/l)}e.prototype.levy=i;function i(){var l=1.5,u=Math.pow(r(1+l)*Math.sin(Math.PI*l/2)/(r((1+l)/2)*l*Math.pow(2,(l-1)/2)),1/l);return this.gaussian()*u/Math.pow(Math.abs(this.gaussian()),1/l)}function r(l){return Math.sqrt(2*Math.PI/l)*Math.pow(1/Math.E*(l+1/(12*l-1/(10*l))),l)}function s(){var l=this.seed;return l=l+2127912214+(l<<12)&4294967295,l=(l^3345072700^l>>>19)&4294967295,l=l+374761393+(l<<5)&4294967295,l=(l+3550635116^l<<9)&4294967295,l=l+4251993797+(l<<3)&4294967295,l=(l^3042594569^l>>>16)&4294967295,this.seed=l,(l&268435455)/268435456}function o(l){return Math.floor(this.nextDouble()*l)}function a(l,u){var c=u||n();if(typeof c.next!="function")throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:d,shuffle:h};function h(){var f,m,_;for(f=l.length-1;f>0;--f)m=c.next(f+1),_=l[m],l[m]=l[f],l[f]=_;return l}function d(f){var m,_,g;for(m=l.length-1;m>0;--m)_=c.next(m+1),g=l[_],l[_]=l[m],l[m]=g,f(g);l.length&&f(l[0])}}return jh.exports}var lA=eG,qz=Nz,Yz=Dz,Kz=Uz,Qz=Bz,Zz=Gz,Jz=Wz,uA={};function eG(n){var e=$z(),t=jz(),i=A0;if(n){if(n.springCoeff!==void 0)throw new Error("springCoeff was renamed to springCoefficient");if(n.dragCoeff!==void 0)throw new Error("dragCoeff was renamed to dragCoefficient")}n=t(n,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1});var r=uA[n.dimensions];if(!r){var s=n.dimensions;r={Body:qz(s,n.debug),createQuadTree:Yz(s),createBounds:Kz(s),createDragForce:Qz(s),createSpringForce:Zz(s),integrate:Jz(s)},uA[s]=r}var o=r.Body,a=r.createQuadTree,l=r.createBounds,u=r.createDragForce,c=r.createSpringForce,h=r.integrate,d=L=>new o(L),f=Xz().random(42),m=[],_=[],g=a(n,f),p=l(m,n,f),v=c(n,f),y=u(n),x=0,T=[],S=new Map,w=0;b("nbody",B),b("spring",D);var E={bodies:m,quadTree:g,springs:_,settings:n,addForce:b,removeForce:R,getForces:I,step:function(){for(var L=0;L<T.length;++L)T[L](w);var z=h(m,n.timeStep,n.adaptiveTimeStepWeight);return w+=1,z},addBody:function(L){if(!L)throw new Error("Body is required");return m.push(L),L},addBodyAt:function(L){if(!L)throw new Error("Body position is required");var z=d(L);return m.push(z),z},removeBody:function(L){if(L){var z=m.indexOf(L);if(!(z<0))return m.splice(z,1),m.length===0&&p.reset(),!0}},addSpring:function(L,z,ie,k){if(!L||!z)throw new Error("Cannot add null spring to force simulator");typeof ie!="number"&&(ie=-1);var Z=new e(L,z,ie,k>=0?k:-1);return _.push(Z),Z},getTotalMovement:function(){return x},removeSpring:function(L){if(L){var z=_.indexOf(L);if(z>-1)return _.splice(z,1),!0}},getBestNewBodyPosition:function(L){return p.getBestNewPosition(L)},getBBox:M,getBoundingBox:M,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function(L){return L!==void 0?(n.gravity=L,g.options({gravity:L}),this):n.gravity},theta:function(L){return L!==void 0?(n.theta=L,g.options({theta:L}),this):n.theta},random:f};return tG(n,E),i(E),E;function M(){return p.update(),p.box}function b(L,z){if(S.has(L))throw new Error("Force "+L+" is already added");S.set(L,z),T.push(z)}function R(L){var z=T.indexOf(S.get(L));z<0||(T.splice(z,1),S.delete(L))}function I(){return S}function B(){if(m.length!==0){g.insertBodies(m);for(var L=m.length;L--;){var z=m[L];z.isPinned||(z.reset(),g.updateBodyForce(z),y.update(z))}}}function D(){for(var L=_.length;L--;)v.update(_[L])}}function tG(n,e){for(var t in n)nG(n,e,t)}function nG(n,e,t){if(n.hasOwnProperty(t)&&typeof e[t]!="function"){var i=Number.isFinite(n[t]);i?e[t]=function(r){if(r!==void 0){if(!Number.isFinite(r))throw new Error("Value of "+t+" should be a valid number.");return n[t]=r,e}return n[t]}:e[t]=function(r){return r!==void 0?(n[t]=r,e):n[t]}}}C0.exports=rG,C0.exports.simulator=lA;var iG=A0;function rG(n,e){if(!n)throw new Error("Graph structure cannot be undefined");var t=e&&e.createSimulator||lA,i=t(e);if(Array.isArray(e))throw new Error("Physics settings is expected to be an object");var r=n.version>19?B:I;e&&typeof e.nodeMass=="function"&&(r=e.nodeMass);var s=new Map,o={},a=0,l=i.settings.springTransform||sG;y(),g();var u=!1,c={step:function(){if(a===0)return h(!0),!0;var D=i.step();c.lastMove=D,c.fire("step");var L=D/a,z=L<=.01;return h(z),z},getNodePosition:function(D){return R(D).pos},setNodePosition:function(D){var L=R(D);L.setPosition.apply(L,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(D){var L=o[D];if(L)return{from:L.from.pos,to:L.to.pos}},getGraphRect:function(){return i.getBBox()},forEachBody:d,pinNode:function(D,L){var z=R(D.id);z.isPinned=!!L},isNodePinned:function(D){return R(D.id).isPinned},dispose:function(){n.off("changed",v),c.fire("disposed")},getBody:_,getSpring:m,getForceVectorLength:f,simulator:i,graph:n,lastMove:0};return iG(c),c;function h(D){u!==D&&(u=D,p(D))}function d(D){s.forEach(D)}function f(){var D=0,L=0;return d(function(z){D+=Math.abs(z.force.x),L+=Math.abs(z.force.y)}),Math.sqrt(D*D+L*L)}function m(D,L){var z;if(L===void 0)typeof D!="object"?z=D:z=D.id;else{var ie=n.hasLink(D,L);if(!ie)return;z=ie.id}return o[z]}function _(D){return s.get(D)}function g(){n.on("changed",v)}function p(D){c.fire("stable",D)}function v(D){for(var L=0;L<D.length;++L){var z=D[L];z.changeType==="add"?(z.node&&x(z.node.id),z.link&&S(z.link)):z.changeType==="remove"&&(z.node&&T(z.node),z.link&&w(z.link))}a=n.getNodesCount()}function y(){a=0,n.forEachNode(function(D){x(D.id),a+=1}),n.forEachLink(S)}function x(D){var L=s.get(D);if(!L){var z=n.getNode(D);if(!z)throw new Error("initBody() was called with unknown node id");var ie=z.position;if(!ie){var k=E(z);ie=i.getBestNewBodyPosition(k)}L=i.addBodyAt(ie),L.id=D,s.set(D,L),M(D),b(z)&&(L.isPinned=!0)}}function T(D){var L=D.id,z=s.get(L);z&&(s.delete(L),i.removeBody(z))}function S(D){M(D.fromId),M(D.toId);var L=s.get(D.fromId),z=s.get(D.toId),ie=i.addSpring(L,z,D.length);l(D,ie),o[D.id]=ie}function w(D){var L=o[D.id];if(L){var z=n.getNode(D.fromId),ie=n.getNode(D.toId);z&&M(z.id),ie&&M(ie.id),delete o[D.id],i.removeSpring(L)}}function E(D){var L=[];if(!D.links)return L;for(var z=Math.min(D.links.length,2),ie=0;ie<z;++ie){var k=D.links[ie],Z=k.fromId!==D.id?s.get(k.fromId):s.get(k.toId);Z&&Z.pos&&L.push(Z)}return L}function M(D){var L=s.get(D);if(L.mass=r(D),Number.isNaN(L.mass))throw new Error("Node mass should be a number")}function b(D){return D&&(D.isPinned||D.data&&D.data.isPinned)}function R(D){var L=s.get(D);return L||(x(D),L=s.get(D)),L}function I(D){var L=n.getLinks(D);return L?1+L.length/3:1}function B(D){var L=n.getLinks(D);return L?1+L.size/3:1}}function sG(){}var oG=C0.exports;const aG=Dg(oG);function F0(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var lG=typeof global=="object"&&global&&global.Object===Object&&global,uG=typeof self=="object"&&self&&self.Object===Object&&self,cA=lG||uG||Function("return this")(),O0=function(){return cA.Date.now()},cG=/\s/;function hG(n){for(var e=n.length;e--&&cG.test(n.charAt(e)););return e}var dG=/^\s+/;function fG(n){return n&&n.slice(0,hG(n)+1).replace(dG,"")}var om=cA.Symbol,hA=Object.prototype,pG=hA.hasOwnProperty,mG=hA.toString,Xh=om?om.toStringTag:void 0;function gG(n){var e=pG.call(n,Xh),t=n[Xh];try{n[Xh]=void 0;var i=!0}catch{}var r=mG.call(n);return i&&(e?n[Xh]=t:delete n[Xh]),r}var _G=Object.prototype,vG=_G.toString;function yG(n){return vG.call(n)}var xG="[object Null]",SG="[object Undefined]",dA=om?om.toStringTag:void 0;function TG(n){return n==null?n===void 0?SG:xG:dA&&dA in Object(n)?gG(n):yG(n)}function bG(n){return n!=null&&typeof n=="object"}var wG="[object Symbol]";function MG(n){return typeof n=="symbol"||bG(n)&&TG(n)==wG}var fA=NaN,EG=/^[-+]0x[0-9a-f]+$/i,AG=/^0b[01]+$/i,CG=/^0o[0-7]+$/i,RG=parseInt;function pA(n){if(typeof n=="number")return n;if(MG(n))return fA;if(F0(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=F0(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=fG(n);var t=AG.test(n);return t||CG.test(n)?RG(n.slice(2),t?2:8):EG.test(n)?fA:+n}var NG="Expected a function",PG=Math.max,DG=Math.min;function LG(n,e,t){var i,r,s,o,a,l,u=0,c=!1,h=!1,d=!0;if(typeof n!="function")throw new TypeError(NG);e=pA(e)||0,F0(t)&&(c=!!t.leading,h="maxWait"in t,s=h?PG(pA(t.maxWait)||0,e):s,d="trailing"in t?!!t.trailing:d);function f(S){var w=i,E=r;return i=r=void 0,u=S,o=n.apply(E,w),o}function m(S){return u=S,a=setTimeout(p,e),c?f(S):o}function _(S){var w=S-l,E=S-u,M=e-w;return h?DG(M,s-E):M}function g(S){var w=S-l,E=S-u;return l===void 0||w>=e||w<0||h&&E>=s}function p(){var S=O0();if(g(S))return v(S);a=setTimeout(p,_(S))}function v(S){return a=void 0,d&&i?f(S):(i=r=void 0,o)}function y(){a!==void 0&&clearTimeout(a),u=0,i=l=r=a=void 0}function x(){return a===void 0?o:v(O0())}function T(){var S=O0(),w=g(S);if(i=arguments,r=this,l=S,w){if(a===void 0)return m(l);if(h)return clearTimeout(a),a=setTimeout(p,e),f(l)}return a===void 0&&(a=setTimeout(p,e)),o}return T.cancel=y,T.flush=x,T}function mA(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function IG(n){if(Array.isArray(n))return n}function UG(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function FG(n,e,t){return Object.defineProperty(n,"prototype",{writable:!1}),n}function OG(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,r,s,o,a=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(i=s.call(t)).done)&&(a.push(i.value),a.length!==e);l=!0);}catch(c){u=!0,r=c}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(u)throw r}}return a}}function BG(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kG(n,e){return IG(n)||OG(n,e)||zG(n,e)||BG()}function zG(n,e){if(n){if(typeof n=="string")return mA(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?mA(n,e):void 0}}var GG=FG(function n(e,t){var i=t.default,r=i===void 0?null:i,s=t.triggerUpdate,o=s===void 0?!0:s,a=t.onChange,l=a===void 0?function(u,c){}:a;UG(this,n),this.name=e,this.defaultVal=r,this.triggerUpdate=o,this.onChange=l});function am(n){var e=n.stateInit,t=e===void 0?function(){return{}}:e,i=n.props,r=i===void 0?{}:i,s=n.methods,o=s===void 0?{}:s,a=n.aliases,l=a===void 0?{}:a,u=n.init,c=u===void 0?function(){}:u,h=n.update,d=h===void 0?function(){}:h,f=Object.keys(r).map(function(m){return new GG(m,r[m])});return function m(){for(var _=arguments.length,g=new Array(_),p=0;p<_;p++)g[p]=arguments[p];var v=!!(this instanceof m&&this.constructor),y=v?g.shift():void 0,x=g[0],T=x===void 0?{}:x,S=Object.assign({},t instanceof Function?t(T):t,{initialised:!1}),w={};function E(R){return M(R,T),b(),E}var M=function(I,B){c.call(E,I,S,B),S.initialised=!0},b=LG(function(){S.initialised&&(d.call(E,S,w),w={})},1);return f.forEach(function(R){E[R.name]=I(R);function I(B){var D=B.name,L=B.triggerUpdate,z=L===void 0?!1:L,ie=B.onChange,k=ie===void 0?function(K,he){}:ie,Z=B.defaultVal,W=Z===void 0?null:Z;return function(K){var he=S[D];if(!arguments.length)return he;var Ie=K===void 0?W:K;return S[D]=Ie,k.call(E,Ie,S,he),!w.hasOwnProperty(D)&&(w[D]=he),z&&b(),E}}}),Object.keys(o).forEach(function(R){E[R]=function(){for(var I,B=arguments.length,D=new Array(B),L=0;L<B;L++)D[L]=arguments[L];return(I=o[R]).call.apply(I,[E,S].concat(D))}}),Object.entries(l).forEach(function(R){var I=kG(R,2),B=I[0],D=I[1];return E[B]=E[D]}),E.resetProps=function(){return f.forEach(function(R){E[R.name](R.defaultVal)}),E},E.resetProps(),S._rerender=b,v&&y&&E(y),E}}var vt=function(n){return typeof n=="function"?n:typeof n=="string"?function(e){return e[n]}:function(e){return n}};class gA extends Map{constructor(e,t=WG){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),e!=null)for(const[i,r]of e)this.set(i,r)}get(e){return super.get(_A(this,e))}has(e){return super.has(_A(this,e))}set(e,t){return super.set(VG(this,e),t)}delete(e){return super.delete(HG(this,e))}}function _A({_intern:n,_key:e},t){const i=e(t);return n.has(i)?n.get(i):t}function VG({_intern:n,_key:e},t){const i=e(t);return n.has(i)?n.get(i):(n.set(i,t),t)}function HG({_intern:n,_key:e},t){const i=e(t);return n.has(i)&&(t=n.get(i),n.delete(i)),t}function WG(n){return n!==null&&typeof n=="object"?n.valueOf():n}function $G(n,e){let t;if(e===void 0)for(const i of n)i!=null&&(t<i||t===void 0&&i>=i)&&(t=i);else{let i=-1;for(let r of n)(r=e(r,++i,n))!=null&&(t<r||t===void 0&&r>=r)&&(t=r)}return t}function jG(n,e){let t;if(e===void 0)for(const i of n)i!=null&&(t>i||t===void 0&&i>=i)&&(t=i);else{let i=-1;for(let r of n)(r=e(r,++i,n))!=null&&(t>r||t===void 0&&r>=r)&&(t=r)}return t}function B0(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function XG(n){if(Array.isArray(n))return n}function qG(n){if(Array.isArray(n))return B0(n)}function vA(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function YG(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function KG(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function ti(n,e){return n.get(vA(n,e))}function Ou(n,e,t){YG(n,e),e.set(n,t)}function lm(n,e,t){return n.set(vA(n,e),t),t}function QG(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,o4(i.key),i)}}function ZG(n,e,t){return QG(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function JG(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function e4(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,r,s,o,a=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(i=s.call(t)).done)&&(a.push(i.value),a.length!==e);l=!0);}catch(c){u=!0,r=c}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(u)throw r}}return a}}function t4(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function n4(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function i4(n,e){return XG(n)||e4(n,e)||yA(n,e)||t4()}function r4(n){return qG(n)||JG(n)||yA(n)||n4()}function s4(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}function o4(n){var e=s4(n,"string");return typeof e=="symbol"?e:e+""}function yA(n,e){if(n){if(typeof n=="string")return B0(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?B0(n,e):void 0}}var Bu=new WeakMap,qh=new WeakMap,ku=new WeakMap,k0=new WeakMap,z0=new WeakMap,G0=new WeakMap,a4=function(){function n(){KG(this,n),Ou(this,Bu,new Map),Ou(this,qh,new Map),Ou(this,ku,function(e){return e}),Ou(this,k0,function(){return{}}),Ou(this,z0,function(){}),Ou(this,G0,function(){})}return ZG(n,[{key:"getObj",value:function(t){return ti(Bu,this).get(ti(ku,this).call(this,t))}},{key:"getData",value:function(t){return ti(qh,this).get(t)}},{key:"entries",value:function(){return r4(ti(qh,this).entries()).map(function(t){var i=i4(t,2),r=i[0],s=i[1];return[s,r]})}},{key:"id",value:function(t){return lm(ku,this,vt(t)),this}},{key:"onCreateObj",value:function(t){return lm(k0,this,t),this}},{key:"onUpdateObj",value:function(t){return lm(z0,this,t),this}},{key:"onRemoveObj",value:function(t){return lm(G0,this,t),this}},{key:"digest",value:function(t){var i=this;t.filter(function(s){return!ti(Bu,i).has(ti(ku,i).call(i,s))}).forEach(function(s){var o=ti(k0,i).call(i,s);ti(Bu,i).set(ti(ku,i).call(i,s),o),ti(qh,i).set(o,s)});var r=new Map(t.map(function(s){return[ti(ku,i).call(i,s),s]}));return ti(Bu,this).forEach(function(s,o){r.has(o)?ti(z0,i).call(i,s,r.get(o)):(ti(G0,i).call(i,s,o),ti(Bu,i).delete(o),ti(qh,i).delete(s))}),this}},{key:"clear",value:function(){return this.digest([]),this}}])}();function l4(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}const xA=Symbol("implicit");function SA(){var n=new gA,e=[],t=[],i=xA;function r(s){let o=n.get(s);if(o===void 0){if(i!==xA)return i;n.set(s,o=e.push(s)-1)}return t[o%t.length]}return r.domain=function(s){if(!arguments.length)return e.slice();e=[],n=new gA;for(const o of s)n.has(o)||n.set(o,e.push(o)-1);return r},r.range=function(s){return arguments.length?(t=Array.from(s),r):t.slice()},r.unknown=function(s){return arguments.length?(i=s,r):i},r.copy=function(){return SA(e,t).unknown(i)},l4.apply(r,arguments),r}function V0(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function TA(n,e){var t=Object.create(n.prototype);for(var i in e)t[i]=e[i];return t}function Yh(){}var Kh=.7,um=1/Kh,zu="\\s*([+-]?\\d+)\\s*",Qh="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",as="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",u4=/^#([0-9a-f]{3,8})$/,c4=new RegExp(`^rgb\\(${zu},${zu},${zu}\\)$`),h4=new RegExp(`^rgb\\(${as},${as},${as}\\)$`),d4=new RegExp(`^rgba\\(${zu},${zu},${zu},${Qh}\\)$`),f4=new RegExp(`^rgba\\(${as},${as},${as},${Qh}\\)$`),p4=new RegExp(`^hsl\\(${Qh},${as},${as}\\)$`),m4=new RegExp(`^hsla\\(${Qh},${as},${as},${Qh}\\)$`),bA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};V0(Yh,Zh,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:wA,formatHex:wA,formatHex8:g4,formatHsl:_4,formatRgb:MA,toString:MA});function wA(){return this.rgb().formatHex()}function g4(){return this.rgb().formatHex8()}function _4(){return NA(this).formatHsl()}function MA(){return this.rgb().formatRgb()}function Zh(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=u4.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?EA(e):t===3?new Pi(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?cm(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?cm(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=c4.exec(n))?new Pi(e[1],e[2],e[3],1):(e=h4.exec(n))?new Pi(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=d4.exec(n))?cm(e[1],e[2],e[3],e[4]):(e=f4.exec(n))?cm(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=p4.exec(n))?RA(e[1],e[2]/100,e[3]/100,1):(e=m4.exec(n))?RA(e[1],e[2]/100,e[3]/100,e[4]):bA.hasOwnProperty(n)?EA(bA[n]):n==="transparent"?new Pi(NaN,NaN,NaN,0):null}function EA(n){return new Pi(n>>16&255,n>>8&255,n&255,1)}function cm(n,e,t,i){return i<=0&&(n=e=t=NaN),new Pi(n,e,t,i)}function v4(n){return n instanceof Yh||(n=Zh(n)),n?(n=n.rgb(),new Pi(n.r,n.g,n.b,n.opacity)):new Pi}function H0(n,e,t,i){return arguments.length===1?v4(n):new Pi(n,e,t,i??1)}function Pi(n,e,t,i){this.r=+n,this.g=+e,this.b=+t,this.opacity=+i}V0(Pi,H0,TA(Yh,{brighter(n){return n=n==null?um:Math.pow(um,n),new Pi(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?Kh:Math.pow(Kh,n),new Pi(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Pi(Wa(this.r),Wa(this.g),Wa(this.b),hm(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:AA,formatHex:AA,formatHex8:y4,formatRgb:CA,toString:CA}));function AA(){return`#${$a(this.r)}${$a(this.g)}${$a(this.b)}`}function y4(){return`#${$a(this.r)}${$a(this.g)}${$a(this.b)}${$a((isNaN(this.opacity)?1:this.opacity)*255)}`}function CA(){const n=hm(this.opacity);return`${n===1?"rgb(":"rgba("}${Wa(this.r)}, ${Wa(this.g)}, ${Wa(this.b)}${n===1?")":`, ${n})`}`}function hm(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Wa(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function $a(n){return n=Wa(n),(n<16?"0":"")+n.toString(16)}function RA(n,e,t,i){return i<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new Or(n,e,t,i)}function NA(n){if(n instanceof Or)return new Or(n.h,n.s,n.l,n.opacity);if(n instanceof Yh||(n=Zh(n)),!n)return new Or;if(n instanceof Or)return n;n=n.rgb();var e=n.r/255,t=n.g/255,i=n.b/255,r=Math.min(e,t,i),s=Math.max(e,t,i),o=NaN,a=s-r,l=(s+r)/2;return a?(e===s?o=(t-i)/a+(t<i)*6:t===s?o=(i-e)/a+2:o=(e-t)/a+4,a/=l<.5?s+r:2-s-r,o*=60):a=l>0&&l<1?0:o,new Or(o,a,l,n.opacity)}function x4(n,e,t,i){return arguments.length===1?NA(n):new Or(n,e,t,i??1)}function Or(n,e,t,i){this.h=+n,this.s=+e,this.l=+t,this.opacity=+i}V0(Or,x4,TA(Yh,{brighter(n){return n=n==null?um:Math.pow(um,n),new Or(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?Kh:Math.pow(Kh,n),new Or(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,i=t+(t<.5?t:1-t)*e,r=2*t-i;return new Pi(W0(n>=240?n-240:n+120,r,i),W0(n,r,i),W0(n<120?n+240:n-120,r,i),this.opacity)},clamp(){return new Or(PA(this.h),dm(this.s),dm(this.l),hm(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=hm(this.opacity);return`${n===1?"hsl(":"hsla("}${PA(this.h)}, ${dm(this.s)*100}%, ${dm(this.l)*100}%${n===1?")":`, ${n})`}`}}));function PA(n){return n=(n||0)%360,n<0?n+360:n}function dm(n){return Math.max(0,Math.min(1,n||0))}function W0(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}const DA=n=>()=>n;function S4(n,e){return function(t){return n+t*e}}function T4(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(i){return Math.pow(n+i*e,t)}}function b4(n){return(n=+n)==1?LA:function(e,t){return t-e?T4(e,t,n):DA(isNaN(e)?t:e)}}function LA(n,e){var t=e-n;return t?S4(n,t):DA(isNaN(n)?e:n)}const IA=function n(e){var t=b4(e);function i(r,s){var o=t((r=H0(r)).r,(s=H0(s)).r),a=t(r.g,s.g),l=t(r.b,s.b),u=LA(r.opacity,s.opacity);return function(c){return r.r=o(c),r.g=a(c),r.b=l(c),r.opacity=u(c),r+""}}return i.gamma=n,i}(1);function Xo(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}var $0=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,j0=new RegExp($0.source,"g");function w4(n){return function(){return n}}function M4(n){return function(e){return n(e)+""}}function E4(n,e){var t=$0.lastIndex=j0.lastIndex=0,i,r,s,o=-1,a=[],l=[];for(n=n+"",e=e+"";(i=$0.exec(n))&&(r=j0.exec(e));)(s=r.index)>t&&(s=e.slice(t,s),a[o]?a[o]+=s:a[++o]=s),(i=i[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,l.push({i:o,x:Xo(i,r)})),t=j0.lastIndex;return t<e.length&&(s=e.slice(t),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?M4(l[0].x):w4(e):(e=l.length,function(u){for(var c=0,h;c<e;++c)a[(h=l[c]).i]=h.x(u);return a.join("")})}var UA=180/Math.PI,X0={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function FA(n,e,t,i,r,s){var o,a,l;return(o=Math.sqrt(n*n+e*e))&&(n/=o,e/=o),(l=n*t+e*i)&&(t-=n*l,i-=e*l),(a=Math.sqrt(t*t+i*i))&&(t/=a,i/=a,l/=a),n*i<e*t&&(n=-n,e=-e,l=-l,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(e,n)*UA,skewX:Math.atan(l)*UA,scaleX:o,scaleY:a}}var fm;function A4(n){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return e.isIdentity?X0:FA(e.a,e.b,e.c,e.d,e.e,e.f)}function C4(n){return n==null||(fm||(fm=document.createElementNS("http://www.w3.org/2000/svg","g")),fm.setAttribute("transform",n),!(n=fm.transform.baseVal.consolidate()))?X0:(n=n.matrix,FA(n.a,n.b,n.c,n.d,n.e,n.f))}function OA(n,e,t,i){function r(u){return u.length?u.pop()+" ":""}function s(u,c,h,d,f,m){if(u!==h||c!==d){var _=f.push("translate(",null,e,null,t);m.push({i:_-4,x:Xo(u,h)},{i:_-2,x:Xo(c,d)})}else(h||d)&&f.push("translate("+h+e+d+t)}function o(u,c,h,d){u!==c?(u-c>180?c+=360:c-u>180&&(u+=360),d.push({i:h.push(r(h)+"rotate(",null,i)-2,x:Xo(u,c)})):c&&h.push(r(h)+"rotate("+c+i)}function a(u,c,h,d){u!==c?d.push({i:h.push(r(h)+"skewX(",null,i)-2,x:Xo(u,c)}):c&&h.push(r(h)+"skewX("+c+i)}function l(u,c,h,d,f,m){if(u!==h||c!==d){var _=f.push(r(f)+"scale(",null,",",null,")");m.push({i:_-4,x:Xo(u,h)},{i:_-2,x:Xo(c,d)})}else(h!==1||d!==1)&&f.push(r(f)+"scale("+h+","+d+")")}return function(u,c){var h=[],d=[];return u=n(u),c=n(c),s(u.translateX,u.translateY,c.translateX,c.translateY,h,d),o(u.rotate,c.rotate,h,d),a(u.skewX,c.skewX,h,d),l(u.scaleX,u.scaleY,c.scaleX,c.scaleY,h,d),u=c=null,function(f){for(var m=-1,_=d.length,g;++m<_;)h[(g=d[m]).i]=g.x(f);return h.join("")}}}var R4=OA(A4,"px, ","px)","deg)"),N4=OA(C4,", ",")",")");function P4(n){for(var e=n.length/6|0,t=new Array(e),i=0;i<e;)t[i]="#"+n.slice(i*6,++i*6);return t}const D4=P4("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");function pm(n){"@babel/helpers - typeof";return pm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pm(n)}var L4=/^\s+/,I4=/\s+$/;function Oe(n,e){if(n=n||"",e=e||{},n instanceof Oe)return n;if(!(this instanceof Oe))return new Oe(n,e);var t=U4(n);this._originalInput=n,this._r=t.r,this._g=t.g,this._b=t.b,this._a=t.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||t.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=t.ok}Oe.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},getLuminance:function(){var e=this.toRgb(),t,i,r,s,o,a;return t=e.r/255,i=e.g/255,r=e.b/255,t<=.03928?s=t/12.92:s=Math.pow((t+.055)/1.055,2.4),i<=.03928?o=i/12.92:o=Math.pow((i+.055)/1.055,2.4),r<=.03928?a=r/12.92:a=Math.pow((r+.055)/1.055,2.4),.2126*s+.7152*o+.0722*a},setAlpha:function(e){return this._a=HA(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=kA(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=kA(this._r,this._g,this._b),t=Math.round(e.h*360),i=Math.round(e.s*100),r=Math.round(e.v*100);return this._a==1?"hsv("+t+", "+i+"%, "+r+"%)":"hsva("+t+", "+i+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var e=BA(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=BA(this._r,this._g,this._b),t=Math.round(e.h*360),i=Math.round(e.s*100),r=Math.round(e.l*100);return this._a==1?"hsl("+t+", "+i+"%, "+r+"%)":"hsla("+t+", "+i+"%, "+r+"%, "+this._roundA+")"},toHex:function(e){return zA(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return k4(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(jt(this._r,255)*100)+"%",g:Math.round(jt(this._g,255)*100)+"%",b:Math.round(jt(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(jt(this._r,255)*100)+"%, "+Math.round(jt(this._g,255)*100)+"%, "+Math.round(jt(this._b,255)*100)+"%)":"rgba("+Math.round(jt(this._r,255)*100)+"%, "+Math.round(jt(this._g,255)*100)+"%, "+Math.round(jt(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:Q4[zA(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var t="#"+GA(this._r,this._g,this._b,this._a),i=t,r=this._gradientType?"GradientType = 1, ":"";if(e){var s=Oe(e);i="#"+GA(s._r,s._g,s._b,s._a)}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+t+",endColorstr="+i+")"},toString:function(e){var t=!!e;e=e||this._format;var i=!1,r=this._a<1&&this._a>=0,s=!t&&r&&(e==="hex"||e==="hex6"||e==="hex3"||e==="hex4"||e==="hex8"||e==="name");return s?e==="name"&&this._a===0?this.toName():this.toRgbString():(e==="rgb"&&(i=this.toRgbString()),e==="prgb"&&(i=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(i=this.toHexString()),e==="hex3"&&(i=this.toHexString(!0)),e==="hex4"&&(i=this.toHex8String(!0)),e==="hex8"&&(i=this.toHex8String()),e==="name"&&(i=this.toName()),e==="hsl"&&(i=this.toHslString()),e==="hsv"&&(i=this.toHsvString()),i||this.toHexString())},clone:function(){return Oe(this.toString())},_applyModification:function(e,t){var i=e.apply(null,[this].concat([].slice.call(t)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(H4,arguments)},brighten:function(){return this._applyModification(W4,arguments)},darken:function(){return this._applyModification($4,arguments)},desaturate:function(){return this._applyModification(z4,arguments)},saturate:function(){return this._applyModification(G4,arguments)},greyscale:function(){return this._applyModification(V4,arguments)},spin:function(){return this._applyModification(j4,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(Y4,arguments)},complement:function(){return this._applyCombination(X4,arguments)},monochromatic:function(){return this._applyCombination(K4,arguments)},splitcomplement:function(){return this._applyCombination(q4,arguments)},triad:function(){return this._applyCombination(VA,[3])},tetrad:function(){return this._applyCombination(VA,[4])}},Oe.fromRatio=function(n,e){if(pm(n)=="object"){var t={};for(var i in n)n.hasOwnProperty(i)&&(i==="a"?t[i]=n[i]:t[i]=Jh(n[i]));n=t}return Oe(n,e)};function U4(n){var e={r:0,g:0,b:0},t=1,i=null,r=null,s=null,o=!1,a=!1;return typeof n=="string"&&(n=tV(n)),pm(n)=="object"&&($s(n.r)&&$s(n.g)&&$s(n.b)?(e=F4(n.r,n.g,n.b),o=!0,a=String(n.r).substr(-1)==="%"?"prgb":"rgb"):$s(n.h)&&$s(n.s)&&$s(n.v)?(i=Jh(n.s),r=Jh(n.v),e=B4(n.h,i,r),o=!0,a="hsv"):$s(n.h)&&$s(n.s)&&$s(n.l)&&(i=Jh(n.s),s=Jh(n.l),e=O4(n.h,i,s),o=!0,a="hsl"),n.hasOwnProperty("a")&&(t=n.a)),t=HA(t),{ok:o,format:n.format||a,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:t}}function F4(n,e,t){return{r:jt(n,255)*255,g:jt(e,255)*255,b:jt(t,255)*255}}function BA(n,e,t){n=jt(n,255),e=jt(e,255),t=jt(t,255);var i=Math.max(n,e,t),r=Math.min(n,e,t),s,o,a=(i+r)/2;if(i==r)s=o=0;else{var l=i-r;switch(o=a>.5?l/(2-i-r):l/(i+r),i){case n:s=(e-t)/l+(e<t?6:0);break;case e:s=(t-n)/l+2;break;case t:s=(n-e)/l+4;break}s/=6}return{h:s,s:o,l:a}}function O4(n,e,t){var i,r,s;n=jt(n,360),e=jt(e,100),t=jt(t,100);function o(u,c,h){return h<0&&(h+=1),h>1&&(h-=1),h<1/6?u+(c-u)*6*h:h<1/2?c:h<2/3?u+(c-u)*(2/3-h)*6:u}if(e===0)i=r=s=t;else{var a=t<.5?t*(1+e):t+e-t*e,l=2*t-a;i=o(l,a,n+1/3),r=o(l,a,n),s=o(l,a,n-1/3)}return{r:i*255,g:r*255,b:s*255}}function kA(n,e,t){n=jt(n,255),e=jt(e,255),t=jt(t,255);var i=Math.max(n,e,t),r=Math.min(n,e,t),s,o,a=i,l=i-r;if(o=i===0?0:l/i,i==r)s=0;else{switch(i){case n:s=(e-t)/l+(e<t?6:0);break;case e:s=(t-n)/l+2;break;case t:s=(n-e)/l+4;break}s/=6}return{h:s,s:o,v:a}}function B4(n,e,t){n=jt(n,360)*6,e=jt(e,100),t=jt(t,100);var i=Math.floor(n),r=n-i,s=t*(1-e),o=t*(1-r*e),a=t*(1-(1-r)*e),l=i%6,u=[t,o,s,s,a,t][l],c=[a,t,t,o,s,s][l],h=[s,s,a,t,t,o][l];return{r:u*255,g:c*255,b:h*255}}function zA(n,e,t,i){var r=[Br(Math.round(n).toString(16)),Br(Math.round(e).toString(16)),Br(Math.round(t).toString(16))];return i&&r[0].charAt(0)==r[0].charAt(1)&&r[1].charAt(0)==r[1].charAt(1)&&r[2].charAt(0)==r[2].charAt(1)?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0):r.join("")}function k4(n,e,t,i,r){var s=[Br(Math.round(n).toString(16)),Br(Math.round(e).toString(16)),Br(Math.round(t).toString(16)),Br(WA(i))];return r&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)&&s[3].charAt(0)==s[3].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0):s.join("")}function GA(n,e,t,i){var r=[Br(WA(i)),Br(Math.round(n).toString(16)),Br(Math.round(e).toString(16)),Br(Math.round(t).toString(16))];return r.join("")}Oe.equals=function(n,e){return!n||!e?!1:Oe(n).toRgbString()==Oe(e).toRgbString()},Oe.random=function(){return Oe.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function z4(n,e){e=e===0?0:e||10;var t=Oe(n).toHsl();return t.s-=e/100,t.s=mm(t.s),Oe(t)}function G4(n,e){e=e===0?0:e||10;var t=Oe(n).toHsl();return t.s+=e/100,t.s=mm(t.s),Oe(t)}function V4(n){return Oe(n).desaturate(100)}function H4(n,e){e=e===0?0:e||10;var t=Oe(n).toHsl();return t.l+=e/100,t.l=mm(t.l),Oe(t)}function W4(n,e){e=e===0?0:e||10;var t=Oe(n).toRgb();return t.r=Math.max(0,Math.min(255,t.r-Math.round(255*-(e/100)))),t.g=Math.max(0,Math.min(255,t.g-Math.round(255*-(e/100)))),t.b=Math.max(0,Math.min(255,t.b-Math.round(255*-(e/100)))),Oe(t)}function $4(n,e){e=e===0?0:e||10;var t=Oe(n).toHsl();return t.l-=e/100,t.l=mm(t.l),Oe(t)}function j4(n,e){var t=Oe(n).toHsl(),i=(t.h+e)%360;return t.h=i<0?360+i:i,Oe(t)}function X4(n){var e=Oe(n).toHsl();return e.h=(e.h+180)%360,Oe(e)}function VA(n,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var t=Oe(n).toHsl(),i=[Oe(n)],r=360/e,s=1;s<e;s++)i.push(Oe({h:(t.h+s*r)%360,s:t.s,l:t.l}));return i}function q4(n){var e=Oe(n).toHsl(),t=e.h;return[Oe(n),Oe({h:(t+72)%360,s:e.s,l:e.l}),Oe({h:(t+216)%360,s:e.s,l:e.l})]}function Y4(n,e,t){e=e||6,t=t||30;var i=Oe(n).toHsl(),r=360/t,s=[Oe(n)];for(i.h=(i.h-(r*e>>1)+720)%360;--e;)i.h=(i.h+r)%360,s.push(Oe(i));return s}function K4(n,e){e=e||6;for(var t=Oe(n).toHsv(),i=t.h,r=t.s,s=t.v,o=[],a=1/e;e--;)o.push(Oe({h:i,s:r,v:s})),s=(s+a)%1;return o}Oe.mix=function(n,e,t){t=t===0?0:t||50;var i=Oe(n).toRgb(),r=Oe(e).toRgb(),s=t/100,o={r:(r.r-i.r)*s+i.r,g:(r.g-i.g)*s+i.g,b:(r.b-i.b)*s+i.b,a:(r.a-i.a)*s+i.a};return Oe(o)},Oe.readability=function(n,e){var t=Oe(n),i=Oe(e);return(Math.max(t.getLuminance(),i.getLuminance())+.05)/(Math.min(t.getLuminance(),i.getLuminance())+.05)},Oe.isReadable=function(n,e,t){var i=Oe.readability(n,e),r,s;switch(s=!1,r=nV(t),r.level+r.size){case"AAsmall":case"AAAlarge":s=i>=4.5;break;case"AAlarge":s=i>=3;break;case"AAAsmall":s=i>=7;break}return s},Oe.mostReadable=function(n,e,t){var i=null,r=0,s,o,a,l;t=t||{},o=t.includeFallbackColors,a=t.level,l=t.size;for(var u=0;u<e.length;u++)s=Oe.readability(n,e[u]),s>r&&(r=s,i=Oe(e[u]));return Oe.isReadable(n,i,{level:a,size:l})||!o?i:(t.includeFallbackColors=!1,Oe.mostReadable(n,["#fff","#000"],t))};var q0=Oe.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},Q4=Oe.hexNames=Z4(q0);function Z4(n){var e={};for(var t in n)n.hasOwnProperty(t)&&(e[n[t]]=t);return e}function HA(n){return n=parseFloat(n),(isNaN(n)||n<0||n>1)&&(n=1),n}function jt(n,e){J4(n)&&(n="100%");var t=eV(n);return n=Math.min(e,Math.max(0,parseFloat(n))),t&&(n=parseInt(n*e,10)/100),Math.abs(n-e)<1e-6?1:n%e/parseFloat(e)}function mm(n){return Math.min(1,Math.max(0,n))}function er(n){return parseInt(n,16)}function J4(n){return typeof n=="string"&&n.indexOf(".")!=-1&&parseFloat(n)===1}function eV(n){return typeof n=="string"&&n.indexOf("%")!=-1}function Br(n){return n.length==1?"0"+n:""+n}function Jh(n){return n<=1&&(n=n*100+"%"),n}function WA(n){return Math.round(parseFloat(n)*255).toString(16)}function $A(n){return er(n)/255}var kr=function(){var n="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",t="(?:"+e+")|(?:"+n+")",i="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?",r="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?";return{CSS_UNIT:new RegExp(t),rgb:new RegExp("rgb"+i),rgba:new RegExp("rgba"+r),hsl:new RegExp("hsl"+i),hsla:new RegExp("hsla"+r),hsv:new RegExp("hsv"+i),hsva:new RegExp("hsva"+r),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function $s(n){return!!kr.CSS_UNIT.exec(n)}function tV(n){n=n.replace(L4,"").replace(I4,"").toLowerCase();var e=!1;if(q0[n])n=q0[n],e=!0;else if(n=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var t;return(t=kr.rgb.exec(n))?{r:t[1],g:t[2],b:t[3]}:(t=kr.rgba.exec(n))?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=kr.hsl.exec(n))?{h:t[1],s:t[2],l:t[3]}:(t=kr.hsla.exec(n))?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=kr.hsv.exec(n))?{h:t[1],s:t[2],v:t[3]}:(t=kr.hsva.exec(n))?{h:t[1],s:t[2],v:t[3],a:t[4]}:(t=kr.hex8.exec(n))?{r:er(t[1]),g:er(t[2]),b:er(t[3]),a:$A(t[4]),format:e?"name":"hex8"}:(t=kr.hex6.exec(n))?{r:er(t[1]),g:er(t[2]),b:er(t[3]),format:e?"name":"hex"}:(t=kr.hex4.exec(n))?{r:er(t[1]+""+t[1]),g:er(t[2]+""+t[2]),b:er(t[3]+""+t[3]),a:$A(t[4]+""+t[4]),format:e?"name":"hex8"}:(t=kr.hex3.exec(n))?{r:er(t[1]+""+t[1]),g:er(t[2]+""+t[2]),b:er(t[3]+""+t[3]),format:e?"name":"hex"}:!1}function nV(n){var e,t;return n=n||{level:"AA",size:"small"},e=(n.level||"AA").toUpperCase(),t=(n.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),t!=="small"&&t!=="large"&&(t="small"),{level:e,size:t}}function Y0(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function iV(n){if(Array.isArray(n))return n}function rV(n){if(Array.isArray(n))return Y0(n)}function jA(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function sV(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function XA(n,e,t){return e=Gu(e),fV(n,Z0()?Reflect.construct(e,t||[],Gu(n).constructor):e.apply(n,t))}function oV(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function qA(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function K0(n,e){return n.get(jA(n,e))}function YA(n,e,t){oV(n,e),e.set(n,t)}function KA(n,e,t){return n.set(jA(n,e),t),t}function QA(n,e,t){if(Z0())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,e);var r=new(n.bind.apply(n,i));return r}function aV(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,tC(i.key),i)}}function ZA(n,e,t){return e&&aV(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function gm(n,e,t){return(e=tC(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Q0(){return Q0=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(n,e,t){var i=pV(n,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(arguments.length<3?n:t):r.value}},Q0.apply(null,arguments)}function Gu(n){return Gu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Gu(n)}function JA(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&J0(n,e)}function Z0(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Z0=function(){return!!n})()}function lV(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function uV(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,r,s,o,a=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(i=s.call(t)).done)&&(a.push(i.value),a.length!==e);l=!0);}catch(c){u=!0,r=c}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(u)throw r}}return a}}function cV(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hV(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function eC(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function dV(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?eC(Object(t),!0).forEach(function(i){gm(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):eC(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function fV(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return sV(n)}function J0(n,e){return J0=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t},J0(n,e)}function ed(n,e){return iV(n)||uV(n,e)||nC(n,e)||cV()}function pV(n,e){for(;!{}.hasOwnProperty.call(n,e)&&(n=Gu(n))!==null;);return n}function ex(n,e,t,i){var r=Q0(Gu(n.prototype),e,t);return typeof r=="function"?function(s){return r.apply(t,s)}:r}function zr(n){return rV(n)||lV(n)||nC(n)||hV()}function mV(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function tC(n){var e=mV(n,"string");return typeof e=="symbol"?e:e+""}function tx(n){"@babel/helpers - typeof";return tx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tx(n)}function nC(n,e){if(n){if(typeof n=="string")return Y0(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Y0(n,e):void 0}}var iC=function(e){e instanceof Array?e.forEach(iC):(e.map&&e.map.dispose(),e.dispose())},rC=function(e){e.geometry&&e.geometry.dispose(),e.material&&iC(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(rC)},nx=function(e){for(;e.children.length;){var t=e.children[0];e.remove(t),rC(t)}},ix=new WeakMap,_m=new WeakMap,td=function(n){function e(t){var i,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=r.dataBindAttr,o=s===void 0?"__data":s,a=r.objBindAttr,l=a===void 0?"__threeObj":a;return qA(this,e),i=XA(this,e),gm(i,"scene",void 0),YA(i,ix,void 0),YA(i,_m,void 0),i.scene=t,KA(ix,i,o),KA(_m,i,l),i.onRemoveObj(function(){}),i}return JA(e,n),ZA(e,[{key:"onCreateObj",value:function(i){var r=this;return ex(e,"onCreateObj",this)([function(s){var o=i(s);return s[K0(_m,r)]=o,o[K0(ix,r)]=s,r.scene.add(o),o}]),this}},{key:"onRemoveObj",value:function(i){var r=this;return ex(e,"onRemoveObj",this)([function(s,o){var a=ex(e,"getData",r)([s]);i(s,o),r.scene.remove(s),nx(s),delete a[K0(_m,r)]}]),this}}])}(a4),nd=function(e){return isNaN(e)?parseInt(Oe(e).toHex(),16):e},rx=function(e){return isNaN(e)?Oe(e).getAlpha():1},gV=SA(D4);function sC(n,e,t){!e||typeof t!="string"||n.filter(function(i){return!i[t]}).forEach(function(i){i[t]=gV(e(i))})}function _V(n,e){var t=n.nodes,i=n.links,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=r.nodeFilter,o=s===void 0?function(){return!0}:s,a=r.onLoopError,l=a===void 0?function(f){throw"Invalid DAG structure! Found cycle in node path: ".concat(f.join(" -> "),".")}:a,u={};t.forEach(function(f){return u[e(f)]={data:f,out:[],depth:-1,skip:!o(f)}}),i.forEach(function(f){var m=f.source,_=f.target,g=x(m),p=x(_);if(!u.hasOwnProperty(g))throw"Missing source node with id: ".concat(g);if(!u.hasOwnProperty(p))throw"Missing target node with id: ".concat(p);var v=u[g],y=u[p];v.out.push(y);function x(T){return tx(T)==="object"?e(T):T}});var c=[];d(Object.values(u));var h=Object.assign.apply(Object,[{}].concat(zr(Object.entries(u).filter(function(f){var m=ed(f,2),_=m[1];return!_.skip}).map(function(f){var m=ed(f,2),_=m[0],g=m[1];return gm({},_,g.depth)}))));return h;function d(f){for(var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,g=function(){var x=f[p];if(m.indexOf(x)!==-1){var T=[].concat(zr(m.slice(m.indexOf(x))),[x]).map(function(S){return e(S.data)});return c.some(function(S){return S.length===T.length&&S.every(function(w,E){return w===T[E]})})||(c.push(T),l(T)),1}_>x.depth&&(x.depth=_,d(x.out,[].concat(zr(m),[x]),_+(x.skip?0:1)))},p=0,v=f.length;p<v;p++)g()}}var We=window.THREE?window.THREE:{Group:Nu,Mesh:On,MeshLambertMaterial:PE,Color:Ue,BufferGeometry:ei,BufferAttribute:Vn,Matrix4:pt,Vector3:N,SphereGeometry:Oh,CylinderGeometry:Hp,TubeGeometry:t0,ConeGeometry:e0,Line:uU,LineBasicMaterial:Op,QuadraticBezierCurve3:Jy,CubicBezierCurve3:RE,Box3:Da},oC={graph:Az,forcelayout:aG},vV=2,sx=new We.BufferGeometry().setAttribute?"setAttribute":"addAttribute",vm=new We.BufferGeometry().applyMatrix4?"applyMatrix4":"applyMatrix",yV=am({props:{jsonUrl:{onChange:function(e,t){var i=this;e&&!t.fetchingJson&&(t.fetchingJson=!0,t.onLoading(),fetch(e).then(function(r){return r.json()}).then(function(r){t.fetchingJson=!1,t.onFinishLoading(r),i.graphData(r)}))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(e,t){t.engineRunning=!1}},numDimensions:{default:3,onChange:function(e,t){var i=t.d3ForceLayout.force("charge");i&&i.strength(e>2?-60:-30),e<3&&r(t.graphData.nodes,"z"),e<2&&r(t.graphData.nodes,"y");function r(s,o){s.forEach(function(a){delete a[o],delete a["v".concat(o)]})}}},dagMode:{onChange:function(e,t){!e&&t.forceEngine==="d3"&&(t.graphData.nodes||[]).forEach(function(i){return i.fx=i.fy=i.fz=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(e){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},nodePositionUpdate:{triggerUpdate:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaDecay(e)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaTarget(e)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.velocityDecay(e)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(e){return e._flushObjects=!0,e._rerender(),this},d3Force:function(e,t,i){return i===void 0?e.d3ForceLayout.force(t):(e.d3ForceLayout.force(t,i),this)},d3ReheatSimulation:function(e){return e.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(e){return e.cntTicks=0,e.startTickTime=new Date,e.engineRunning=!0,this},tickFrame:function(e){var t=e.forceEngine!=="ngraph";return e.engineRunning&&i(),r(),s(),this;function i(){++e.cntTicks>e.cooldownTicks||new Date-e.startTickTime>e.cooldownTime||t&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin?(e.engineRunning=!1,e.onEngineStop()):(e.layout[t?"tick":"step"](),e.onEngineTick());var o=vt(e.nodeThreeObjectExtend);e.nodeDataMapper.entries().forEach(function(d){var f=ed(d,2),m=f[0],_=f[1];if(_){var g=t?m:e.layout.getNodePosition(m[e.nodeId]),p=o(m);(!e.nodePositionUpdate||!e.nodePositionUpdate(p?_.children[0]:_,{x:g.x,y:g.y,z:g.z},m)||p)&&(_.position.x=g.x,_.position.y=g.y||0,_.position.z=g.z||0)}});var a=vt(e.linkWidth),l=vt(e.linkCurvature),u=vt(e.linkCurveRotation),c=vt(e.linkThreeObjectExtend);e.linkDataMapper.entries().forEach(function(d){var f=ed(d,2),m=f[0],_=f[1];if(_){var g=t?m:e.layout.getLinkPosition(e.layout.graph.getLink(m.source,m.target).id),p=g[t?"source":"from"],v=g[t?"target":"to"];if(!(!p||!v||!p.hasOwnProperty("x")||!v.hasOwnProperty("x"))){h(m);var y=c(m);if(!(e.linkPositionUpdate&&e.linkPositionUpdate(y?_.children[1]:_,{start:{x:p.x,y:p.y,z:p.z},end:{x:v.x,y:v.y,z:v.z}},m)&&!y)){var x=30,T=m.__curve,S=_.children.length?_.children[0]:_;if(S.type==="Line"){if(T){var E=T.getPoints(x);S.geometry.getAttribute("position").array.length!==E.length*3&&S.geometry[sx]("position",new We.BufferAttribute(new Float32Array(E.length*3),3)),S.geometry.setFromPoints(E)}else{var w=S.geometry.getAttribute("position");(!w||!w.array||w.array.length!==6)&&S.geometry[sx]("position",w=new We.BufferAttribute(new Float32Array(2*3),3)),w.array[0]=p.x,w.array[1]=p.y||0,w.array[2]=p.z||0,w.array[3]=v.x,w.array[4]=v.y||0,w.array[5]=v.z||0,w.needsUpdate=!0}S.geometry.computeBoundingSphere()}else if(S.type==="Mesh")if(T){S.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(S.position.set(0,0,0),S.rotation.set(0,0,0),S.scale.set(1,1,1));var L=Math.ceil(a(m)*10)/10,z=L/2,ie=new We.TubeGeometry(T,x,z,e.linkResolution,!1);S.geometry.dispose(),S.geometry=ie}else{if(!S.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var M=Math.ceil(a(m)*10)/10,b=M/2,R=new We.CylinderGeometry(b,b,1,e.linkResolution,1,!1);R[vm](new We.Matrix4().makeTranslation(0,1/2,0)),R[vm](new We.Matrix4().makeRotationX(Math.PI/2)),S.geometry.dispose(),S.geometry=R}var I=new We.Vector3(p.x,p.y||0,p.z||0),B=new We.Vector3(v.x,v.y||0,v.z||0),D=I.distanceTo(B);S.position.x=I.x,S.position.y=I.y,S.position.z=I.z,S.scale.z=D,S.parent.localToWorld(B),S.lookAt(B)}}}}});function h(d){var f=t?d:e.layout.getLinkPosition(e.layout.graph.getLink(d.source,d.target).id),m=f[t?"source":"from"],_=f[t?"target":"to"];if(!(!m||!_||!m.hasOwnProperty("x")||!_.hasOwnProperty("x"))){var g=l(d);if(!g)d.__curve=null;else{var p=new We.Vector3(m.x,m.y||0,m.z||0),v=new We.Vector3(_.x,_.y||0,_.z||0),y=p.distanceTo(v),x,T=u(d);if(y>0){var S=_.x-m.x,w=_.y-m.y||0,E=new We.Vector3().subVectors(v,p),M=E.clone().multiplyScalar(g).cross(S!==0||w!==0?new We.Vector3(0,0,1):new We.Vector3(0,1,0)).applyAxisAngle(E.normalize(),T).add(new We.Vector3().addVectors(p,v).divideScalar(2));x=new We.QuadraticBezierCurve3(p,M,v)}else{var b=g*70,R=-T,I=R+Math.PI/2;x=new We.CubicBezierCurve3(p,new We.Vector3(b*Math.cos(I),b*Math.sin(I),0).add(p),new We.Vector3(b*Math.cos(R),b*Math.sin(R),0).add(p),v)}d.__curve=x}}}}function r(){var o=vt(e.linkDirectionalArrowRelPos),a=vt(e.linkDirectionalArrowLength),l=vt(e.nodeVal);e.arrowDataMapper.entries().forEach(function(u){var c=ed(u,2),h=c[0],d=c[1];if(d){var f=t?h:e.layout.getLinkPosition(e.layout.graph.getLink(h.source,h.target).id),m=f[t?"source":"from"],_=f[t?"target":"to"];if(!(!m||!_||!m.hasOwnProperty("x")||!_.hasOwnProperty("x"))){var g=Math.cbrt(Math.max(0,l(m)||1))*e.nodeRelSize,p=Math.cbrt(Math.max(0,l(_)||1))*e.nodeRelSize,v=a(h),y=o(h),x=h.__curve?function(b){return h.__curve.getPoint(b)}:function(b){var R=function(B,D,L,z){return D[B]+(L[B]-D[B])*z||0};return{x:R("x",m,_,b),y:R("y",m,_,b),z:R("z",m,_,b)}},T=h.__curve?h.__curve.getLength():Math.sqrt(["x","y","z"].map(function(b){return Math.pow((_[b]||0)-(m[b]||0),2)}).reduce(function(b,R){return b+R},0)),S=g+v+(T-g-p-v)*y,w=x(S/T),E=x((S-v)/T);["x","y","z"].forEach(function(b){return d.position[b]=E[b]});var M=QA(We.Vector3,zr(["x","y","z"].map(function(b){return w[b]})));d.parent.localToWorld(M),d.lookAt(M)}}})}function s(){var o=vt(e.linkDirectionalParticleSpeed);e.graphData.links.forEach(function(a){var l=e.particlesDataMapper.getObj(a),u=l&&l.children,c=a.__singleHopPhotonsObj&&a.__singleHopPhotonsObj.children;if(!((!c||!c.length)&&(!u||!u.length))){var h=t?a:e.layout.getLinkPosition(e.layout.graph.getLink(a.source,a.target).id),d=h[t?"source":"from"],f=h[t?"target":"to"];if(!(!d||!f||!d.hasOwnProperty("x")||!f.hasOwnProperty("x"))){var m=o(a),_=a.__curve?function(p){return a.__curve.getPoint(p)}:function(p){var v=function(x,T,S,w){return T[x]+(S[x]-T[x])*w||0};return{x:v("x",d,f,p),y:v("y",d,f,p),z:v("z",d,f,p)}},g=[].concat(zr(u||[]),zr(c||[]));g.forEach(function(p,v){var y=p.parent.__linkThreeObjType==="singleHopPhotons";if(p.hasOwnProperty("__progressRatio")||(p.__progressRatio=y?0:v/u.length),p.__progressRatio+=m,p.__progressRatio>=1)if(!y)p.__progressRatio=p.__progressRatio%1;else{p.parent.remove(p),nx(p);return}var x=p.__progressRatio,T=_(x);["x","y","z"].forEach(function(S){return p.position[S]=T[S]})})}}})}},emitParticle:function(e,t){if(t&&e.graphData.links.includes(t)){if(!t.__singleHopPhotonsObj){var i=new We.Group;i.__linkThreeObjType="singleHopPhotons",t.__singleHopPhotonsObj=i,e.graphScene.add(i)}var r=vt(e.linkDirectionalParticleWidth),s=Math.ceil(r(t)*10)/10/2,o=e.linkDirectionalParticleResolution,a=new We.SphereGeometry(s,o,o),l=vt(e.linkColor),u=vt(e.linkDirectionalParticleColor),c=u(t)||l(t)||"#f0f0f0",h=new We.Color(nd(c)),d=e.linkOpacity*3,f=new We.MeshLambertMaterial({color:h,transparent:!0,opacity:d});t.__singleHopPhotonsObj.add(new We.Mesh(a,f))}return this},getGraphBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0};if(!e.initialised)return null;var i=function r(s){var o=[];if(s.geometry){s.geometry.computeBoundingBox();var a=new We.Box3;a.copy(s.geometry.boundingBox).applyMatrix4(s.matrixWorld),o.push(a)}return o.concat.apply(o,zr((s.children||[]).filter(function(l){return!l.hasOwnProperty("__graphObjType")||l.__graphObjType==="node"&&t(l.__data)}).map(r)))}(e.graphScene);return i.length?Object.assign.apply(Object,zr(["x","y","z"].map(function(r){return gm({},r,[jG(i,function(s){return s.min[r]}),$G(i,function(s){return s.max[r]})])}))):null}},stateInit:function(){return{d3ForceLayout:vz().force("link",iz()).force("charge",yz()).force("center",sk()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(e,t){t.graphScene=e,t.nodeDataMapper=new td(e,{objBindAttr:"__threeObj"}),t.linkDataMapper=new td(e,{objBindAttr:"__lineObj"}),t.arrowDataMapper=new td(e,{objBindAttr:"__arrowObj"}),t.particlesDataMapper=new td(e,{objBindAttr:"__photonsObj"})},update:function(e,t){var i=function(X){return X.some(function(ae){return t.hasOwnProperty(ae)})};if(e.engineRunning=!1,typeof e.onUpdate=="function"&&e.onUpdate(),e.nodeAutoColorBy!==null&&i(["nodeAutoColorBy","graphData","nodeColor"])&&sC(e.graphData.nodes,vt(e.nodeAutoColorBy),e.nodeColor),e.linkAutoColorBy!==null&&i(["linkAutoColorBy","graphData","linkColor"])&&sC(e.graphData.links,vt(e.linkAutoColorBy),e.linkColor),e._flushObjects||i(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var r=vt(e.nodeThreeObject),s=vt(e.nodeThreeObjectExtend),o=vt(e.nodeVal),a=vt(e.nodeColor),l=vt(e.nodeVisibility),u={},c={};(e._flushObjects||i(["nodeThreeObject","nodeThreeObjectExtend"]))&&e.nodeDataMapper.clear(),e.nodeDataMapper.onCreateObj(function(O){var X=r(O),ae=s(O);X&&e.nodeThreeObject===X&&(X=X.clone());var re;return X&&!ae?re=X:(re=new We.Mesh,re.__graphDefaultObj=!0,X&&ae&&re.add(X)),re.__graphObjType="node",re}).onUpdateObj(function(O,X){if(O.__graphDefaultObj){var ae=o(X)||1,re=Math.cbrt(ae)*e.nodeRelSize,Ee=e.nodeResolution;(!O.geometry.type.match(/^Sphere(Buffer)?Geometry$/)||O.geometry.parameters.radius!==re||O.geometry.parameters.widthSegments!==Ee)&&(u.hasOwnProperty(ae)||(u[ae]=new We.SphereGeometry(re,Ee,Ee)),O.geometry.dispose(),O.geometry=u[ae]);var Re=a(X),Fe=new We.Color(nd(Re||"#ffffaa")),mt=e.nodeOpacity*rx(Re);(O.material.type!=="MeshLambertMaterial"||!O.material.color.equals(Fe)||O.material.opacity!==mt)&&(c.hasOwnProperty(Re)||(c[Re]=new We.MeshLambertMaterial({color:Fe,transparent:!0,opacity:mt})),O.material.dispose(),O.material=c[Re])}}).digest(e.graphData.nodes.filter(l))}if(e._flushObjects||i(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution"])){var h=vt(e.linkThreeObject),d=vt(e.linkThreeObjectExtend),f=vt(e.linkMaterial),m=vt(e.linkVisibility),_=vt(e.linkColor),g=vt(e.linkWidth),p={},v={},y={},x=e.graphData.links.filter(m);if((e._flushObjects||i(["linkThreeObject","linkThreeObjectExtend","linkWidth"]))&&e.linkDataMapper.clear(),e.linkDataMapper.onRemoveObj(function(O){var X=O.__data&&O.__data.__singleHopPhotonsObj;X&&(X.parent.remove(X),nx(X),delete O.__data.__singleHopPhotonsObj)}).onCreateObj(function(O){var X=h(O),ae=d(O);X&&e.linkThreeObject===X&&(X=X.clone());var re;if(!X||ae){var Ee=!!g(O);if(Ee)re=new We.Mesh;else{var Re=new We.BufferGeometry;Re[sx]("position",new We.BufferAttribute(new Float32Array(2*3),3)),re=new We.Line(Re)}}var Fe;return X?ae?(Fe=new We.Group,Fe.__graphDefaultObj=!0,Fe.add(re),Fe.add(X)):Fe=X:(Fe=re,Fe.__graphDefaultObj=!0),Fe.renderOrder=10,Fe.__graphObjType="link",Fe}).onUpdateObj(function(O,X){if(O.__graphDefaultObj){var ae=O.children.length?O.children[0]:O,re=Math.ceil(g(X)*10)/10,Ee=!!re;if(Ee){var Re=re/2,Fe=e.linkResolution;if(!ae.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||ae.geometry.parameters.radiusTop!==Re||ae.geometry.parameters.radialSegments!==Fe){if(!p.hasOwnProperty(re)){var mt=new We.CylinderGeometry(Re,Re,1,Fe,1,!1);mt[vm](new We.Matrix4().makeTranslation(0,1/2,0)),mt[vm](new We.Matrix4().makeRotationX(Math.PI/2)),p[re]=mt}ae.geometry.dispose(),ae.geometry=p[re]}}var ut=f(X);if(ut)ae.material=ut;else{var Ct=_(X),F=new We.Color(nd(Ct||"#f0f0f0")),nn=e.linkOpacity*rx(Ct),ct=Ee?"MeshLambertMaterial":"LineBasicMaterial";if(ae.material.type!==ct||!ae.material.color.equals(F)||ae.material.opacity!==nn){var dt=Ee?v:y;dt.hasOwnProperty(Ct)||(dt[Ct]=new We[ct]({color:F,transparent:nn<1,opacity:nn,depthWrite:nn>=1})),ae.material.dispose(),ae.material=dt[Ct]}}}}).digest(x),e.linkDirectionalArrowLength||t.hasOwnProperty("linkDirectionalArrowLength")){var T=vt(e.linkDirectionalArrowLength),S=vt(e.linkDirectionalArrowColor);e.arrowDataMapper.onCreateObj(function(){var O=new We.Mesh(void 0,new We.MeshLambertMaterial({transparent:!0}));return O.__linkThreeObjType="arrow",O}).onUpdateObj(function(O,X){var ae=T(X),re=e.linkDirectionalArrowResolution;if(!O.geometry.type.match(/^Cone(Buffer)?Geometry$/)||O.geometry.parameters.height!==ae||O.geometry.parameters.radialSegments!==re){var Ee=new We.ConeGeometry(ae*.25,ae,re);Ee.translate(0,ae/2,0),Ee.rotateX(Math.PI/2),O.geometry.dispose(),O.geometry=Ee}var Re=S(X)||_(X)||"#f0f0f0";O.material.color=new We.Color(nd(Re)),O.material.opacity=e.linkOpacity*3*rx(Re)}).digest(x.filter(T))}if(e.linkDirectionalParticles||t.hasOwnProperty("linkDirectionalParticles")){var w=vt(e.linkDirectionalParticles),E=vt(e.linkDirectionalParticleWidth),M=vt(e.linkDirectionalParticleColor),b={},R={};e.particlesDataMapper.onCreateObj(function(){var O=new We.Group;return O.__linkThreeObjType="photons",O.__photonDataMapper=new td(O),O}).onUpdateObj(function(O,X){var ae=Math.round(Math.abs(w(X))),re=!!O.children.length&&O.children[0],Ee=Math.ceil(E(X)*10)/10/2,Re=e.linkDirectionalParticleResolution,Fe;re&&re.geometry.parameters.radius===Ee&&re.geometry.parameters.widthSegments===Re?Fe=re.geometry:(R.hasOwnProperty(Ee)||(R[Ee]=new We.SphereGeometry(Ee,Re,Re)),Fe=R[Ee],re&&re.geometry.dispose());var mt=M(X)||_(X)||"#f0f0f0",ut=new We.Color(nd(mt)),Ct=e.linkOpacity*3,F;re&&re.material.color.equals(ut)&&re.material.opacity===Ct?F=re.material:(b.hasOwnProperty(mt)||(b[mt]=new We.MeshLambertMaterial({color:ut,transparent:!0,opacity:Ct})),F=b[mt],re&&re.material.dispose()),O.__photonDataMapper.id(function(nn){return nn.idx}).onCreateObj(function(){return new We.Mesh(Fe,F)}).onUpdateObj(function(nn){nn.geometry=Fe,nn.material=F}).digest(zr(new Array(ae)).map(function(nn,ct){return{idx:ct}}))}).digest(x.filter(w))}}if(e._flushObjects=!1,i(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){e.engineRunning=!1,e.graphData.links.forEach(function(O){O.source=O[e.linkSource],O.target=O[e.linkTarget]});var I=e.forceEngine!=="ngraph",B;if(I){(B=e.d3ForceLayout).stop().alpha(1).numDimensions(e.numDimensions).nodes(e.graphData.nodes);var D=e.d3ForceLayout.force("link");D&&D.id(function(O){return O[e.nodeId]}).links(e.graphData.links);var L=e.dagMode&&_V(e.graphData,function(O){return O[e.nodeId]},{nodeFilter:e.dagNodeFilter,onLoopError:e.onDagError||void 0}),z=Math.max.apply(Math,zr(Object.values(L||[]))),ie=e.dagLevelDistance||e.graphData.nodes.length/(z||1)*vV*(["radialin","radialout"].indexOf(e.dagMode)!==-1?.7:1);if(["lr","rl","td","bu","zin","zout"].includes(t.dagMode)){var k=["lr","rl"].includes(t.dagMode)?"fx":["td","bu"].includes(t.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(O){return delete O[k]})}if(["lr","rl","td","bu","zin","zout"].includes(e.dagMode)){var Z=["rl","td","zout"].includes(e.dagMode),W=function(X){return(L[X[e.nodeId]]-z/2)*ie*(Z?-1:1)},K=["lr","rl"].includes(e.dagMode)?"fx":["td","bu"].includes(e.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(O){return O[K]=W(O)})}e.d3ForceLayout.force("dagRadial",["radialin","radialout"].indexOf(e.dagMode)!==-1?xz(function(O){var X=L[O[e.nodeId]]||-1;return(e.dagMode==="radialin"?z-X:X)*ie}).strength(function(O){return e.dagNodeFilter(O)?1:0}):null)}else{var he=oC.graph();e.graphData.nodes.forEach(function(O){he.addNode(O[e.nodeId])}),e.graphData.links.forEach(function(O){he.addLink(O.source,O.target)}),B=oC.forcelayout(he,dV({dimensions:e.numDimensions},e.ngraphPhysics)),B.graph=he}for(var Ie=0;Ie<e.warmupTicks&&!(I&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin);Ie++)B[I?"tick":"step"]();e.layout=B,this.resetCountdown()}e.engineRunning=!0,e.onFinishUpdate()}});function xV(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Object,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=function(r){function s(){var o;qA(this,s);for(var a=arguments.length,l=new Array(a),u=0;u<a;u++)l[u]=arguments[u];return o=XA(this,s,[].concat(l)),o.__kapsuleInstance=QA(n,[].concat(zr(t?[o]:[]),l)),o}return JA(s,r),ZA(s)}(e);return Object.keys(n()).forEach(function(r){return i.prototype[r]=function(){var s,o=(s=this.__kapsuleInstance)[r].apply(s,arguments);return o===this.__kapsuleInstance?this:o}}),i}var SV=window.THREE?window.THREE:{Group:Nu},aC=xV(yV,SV.Group,!0);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const TV=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveMap","envMap","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class bV{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=TV,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:i,material:r,object:s}=e;if(t={material:this.getMaterialData(r),geometry:{attributes:this.getAttributesData(i.attributes),indexVersion:i.index?i.index.version:null,drawRange:{start:i.drawRange.start,count:i.drawRange.count}},worldMatrix:s.matrixWorld.clone()},s.center&&(t.center=s.center.clone()),s.morphTargetInfluences&&(t.morphTargetInfluences=s.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:o,height:a}=e.context;t.bufferWidth=o,t.bufferHeight=a}this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const i in e){const r=e[i];t[i]={version:r.version}}return t}containsNode(e){const t=e.material;for(const i in t)if(t[i]&&t[i].isNode)return!0;return e.renderer.nodes.modelViewMatrix!==null||e.renderer.nodes.modelNormalViewMatrix!==null}getMaterialData(e){const t={};for(const i of this.refreshUniforms){const r=e[i];r!=null&&(typeof r=="object"&&r.clone!==void 0?r.isTexture===!0?t[i]={id:r.id,version:r.version}:t[i]=r.clone():t[i]=r)}return t}equals(e){const{object:t,material:i,geometry:r}=e,s=this.getRenderObjectData(e);if(s.worldMatrix.equals(t.matrixWorld)!==!0)return s.worldMatrix.copy(t.matrixWorld),!1;const o=s.material;for(const _ in o){const g=o[_],p=i[_];if(g.equals!==void 0){if(g.equals(p)===!1)return g.copy(p),!1}else if(p.isTexture===!0){if(g.id!==p.id||g.version!==p.version)return g.id=p.id,g.version=p.version,!1}else if(g!==p)return o[_]=p,!1}if(o.transmission>0){const{width:_,height:g}=e.context;if(s.bufferWidth!==_||s.bufferHeight!==g)return s.bufferWidth=_,s.bufferHeight=g,!1}const a=s.geometry,l=r.attributes,u=a.attributes,c=Object.keys(u),h=Object.keys(l);if(c.length!==h.length)return s.geometry.attributes=this.getAttributesData(l),!1;for(const _ of c){const g=u[_],p=l[_];if(p===void 0)return delete u[_],!1;if(g.version!==p.version)return g.version=p.version,!1}const d=r.index,f=a.indexVersion,m=d?d.version:null;if(f!==m)return a.indexVersion=m,!1;if(a.drawRange.start!==r.drawRange.start||a.drawRange.count!==r.drawRange.count)return a.drawRange.start=r.drawRange.start,a.drawRange.count=r.drawRange.count,!1;if(s.morphTargetInfluences){let _=!1;for(let g=0;g<s.morphTargetInfluences.length;g++)s.morphTargetInfluences[g]!==t.morphTargetInfluences[g]&&(_=!0);if(_)return!0}return s.center&&s.center.equals(t.center)===!1?(s.center.copy(t.center),!0):(e.bundle!==null&&(s.version=e.bundle.version),!0)}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e))return!0;const{renderId:i}=t;if(this.renderId!==i)return this.renderId=i,!0;const r=e.object.static===!0,s=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;return r||s?!1:this.equals(e)!==!0}}function id(n,e=0){let t=3735928559^e,i=1103547991^e;if(n instanceof Array)for(let r=0,s;r<n.length;r++)s=n[r],t=Math.imul(t^s,2654435761),i=Math.imul(i^s,1597334677);else for(let r=0,s;r<n.length;r++)s=n.charCodeAt(r),t=Math.imul(t^s,2654435761),i=Math.imul(i^s,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(i^i>>>13,3266489909),i=Math.imul(i^i>>>16,2246822507),i^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&i)+(t>>>0)}const wV=n=>id(n),ox=n=>id(n),ax=(...n)=>id(n);function lC(n,e=!1){const t=[];n.isNode===!0&&(t.push(n.id),n=n.getSelf());for(const{property:i,childNode:r}of ym(n))t.push(t,id(i.slice(0,-4)),r.getCacheKey(e));return id(t)}function*ym(n,e=!1){for(const t in n){if(t.startsWith("_")===!0)continue;const i=n[t];if(Array.isArray(i)===!0)for(let r=0;r<i.length;r++){const s=i[r];s&&(s.isNode===!0||e&&typeof s.toJSON=="function")&&(yield{property:t,index:r,childNode:s})}else if(i&&i.isNode===!0)yield{property:t,childNode:i};else if(typeof i=="object")for(const r in i){const s=i[r];s&&(s.isNode===!0||e&&typeof s.toJSON=="function")&&(yield{property:t,index:r,childNode:s})}}}const MV=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),uC=new WeakMap;function EV(n){return MV.get(n)}function xm(n){if(n==null)return null;const e=typeof n;return n.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":n.isVector2===!0?"vec2":n.isVector3===!0?"vec3":n.isVector4===!0?"vec4":n.isMatrix3===!0?"mat3":n.isMatrix4===!0?"mat4":n.isColor===!0?"color":n instanceof ArrayBuffer?"ArrayBuffer":null}function cC(n,...e){const t=n?n.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),n==="color"?new Ue(...e):t==="vec2"?new ce(...e):t==="vec3"?new N(...e):t==="vec4"?new et(...e):t==="mat3"?new je(...e):t==="mat4"?new pt(...e):n==="bool"?e[0]||!1:n==="float"||n==="int"||n==="uint"?e[0]||0:n==="string"?e[0]||"":n==="ArrayBuffer"?CV(e[0]):null}function hC(n){let e=uC.get(n);return e===void 0&&(e={},uC.set(n,e)),e}function AV(n){let e="";const t=new Uint8Array(n);for(let i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return btoa(e)}function CV(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0)).buffer}const dC={VERTEX:"vertex",FRAGMENT:"fragment"},at={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},js={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},RV=["fragment","vertex"],fC=["setup","analyze","generate"],pC=[...RV,"compute"],Vu=["x","y","z","w"];let NV=0;class tt extends Ns{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=at.NONE,this.updateBeforeType=at.NONE,this.updateAfterType=at.NONE,this.uuid=hp.generateUUID(),this.version=0,this.global=!1,this.isNode=!0,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:NV++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this.getSelf()),this}onFrameUpdate(e){return this.onUpdate(e,at.FRAME)}onRenderUpdate(e){return this.onUpdate(e,at.RENDER)}onObjectUpdate(e){return this.onUpdate(e,at.OBJECT)}onReference(e){return this.updateReference=e.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of ym(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(e=!1){return e=e||this.version!==this._cacheKeyVersion,(e===!0||this._cacheKey===null)&&(this._cacheKey=ax(lC(this,e),this.customCacheKey()),this._cacheKeyVersion=this.version),this._cacheKey}customCacheKey(){return 0}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){const t=e.getNodeProperties(this);let i=0;for(const r of this.getChildren())t["node"+i++]=r;return t.outputNode||null}analyze(e){if(e.increaseUsage(this)===1){const i=e.getNodeProperties(this);for(const r of Object.values(i))r&&r.isNode===!0&&r.build(e)}}generate(e,t){const{outputNode:i}=e.getNodeProperties(this);if(i&&i.isNode===!0)return i.build(e,t)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){const i=this.getShared(e);if(this!==i)return i.build(e,t);e.addNode(this),e.addChain(this);let r=null;const s=e.getBuildStage();if(s==="setup"){this.updateReference(e);const o=e.getNodeProperties(this);if(o.initialized!==!0){o.initialized=!0;const a=this.setup(e),l=a&&a.isNode===!0;for(const u of Object.values(o))u&&u.isNode===!0&&u.build(e);l&&a.build(e),o.outputNode=a}}else if(s==="analyze")this.analyze(e);else if(s==="generate")if(this.generate.length===1){const a=this.getNodeType(e),l=e.getDataFromNode(this);r=l.snippet,r===void 0?(r=this.generate(e)||"",l.snippet=r):l.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),r=e.format(r,a,t)}else r=this.generate(e,t)||"";return e.removeChain(this),e.addSequentialNode(this),r}getSerializeChildren(){return ym(this)}serialize(e){const t=this.getSerializeChildren(),i={};for(const{property:r,index:s,childNode:o}of t)s!==void 0?(i[r]===void 0&&(i[r]=Number.isInteger(s)?[]:{}),i[r][s]=o.toJSON(e.meta).uuid):i[r]=o.toJSON(e.meta).uuid;Object.keys(i).length>0&&(e.inputNodes=i)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const i in e.inputNodes)if(Array.isArray(e.inputNodes[i])){const r=[];for(const s of e.inputNodes[i])r.push(t[s]);this[i]=r}else if(typeof e.inputNodes[i]=="object"){const r={};for(const s in e.inputNodes[i]){const o=e.inputNodes[i][s];r[s]=t[o]}this[i]=r}else{const r=e.inputNodes[i];this[i]=t[r]}}}toJSON(e){const{uuid:t,type:i}=this,r=e===void 0||typeof e=="string";r&&(e={textures:{},images:{},nodes:{}});let s=e.nodes[t];s===void 0&&(s={uuid:t,type:i,meta:e,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},r!==!0&&(e.nodes[s.uuid]=s),this.serialize(s),delete s.meta);function o(a){const l=[];for(const u in a){const c=a[u];delete c.metadata,l.push(c)}return l}if(r){const a=o(e.textures),l=o(e.images),u=o(e.nodes);a.length>0&&(s.textures=a),l.length>0&&(s.images=l),u.length>0&&(s.nodes=u)}return s}}class rd extends tt{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=this.node.build(e),i=this.indexNode.build(e,"uint");return`${t}[ ${i} ]`}}class mC extends tt{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let i=null;for(const r of this.convertTo.split("|"))(i===null||e.getTypeLength(t)===e.getTypeLength(r))&&(i=r);return i}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const i=this.node,r=this.getNodeType(e),s=i.build(e,r);return e.format(s,r,t)}}class Rn extends tt{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const r=e.getVectorType(this.getNodeType(e,t)),s=e.getDataFromNode(this);if(s.propertyName!==void 0)return e.format(s.propertyName,r,t);if(r!=="void"&&t!=="void"&&this.hasDependencies(e)){const o=super.build(e,r),a=e.getVarFromNode(this,null,r),l=e.getPropertyName(a);return e.addLineFlowCode(`${l} = ${o}`,this),s.snippet=o,s.propertyName=l,e.format(s.propertyName,r,t)}}return super.build(e,t)}}class PV extends Rn{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,i)=>t+e.getTypeLength(i.getNodeType(e)),0))}generate(e,t){const i=this.getNodeType(e),r=this.nodes,s=e.getComponentType(i),o=[];for(const l of r){let u=l.build(e);const c=e.getComponentType(l.getNodeType(e));c!==s&&(u=e.format(u,c,s)),o.push(u)}const a=`${e.getType(i)}( ${o.join(", ")} )`;return e.format(a,i,t)}}const DV=Vu.join("");class gC extends tt{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(Vu.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,t){const i=this.node,r=e.getTypeLength(i.getNodeType(e));let s=null;if(r>1){let o=null;this.getVectorLength()>=r&&(o=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const l=i.build(e,o);this.components.length===r&&this.components===DV.slice(0,this.components.length)?s=e.format(l,o,t):s=e.format(`${l}.${this.components}`,this.getNodeType(e),t)}else s=i.build(e,t);return s}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class LV extends Rn{static get type(){return"SetNode"}constructor(e,t,i){super(),this.sourceNode=e,this.components=t,this.targetNode=i}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:i,targetNode:r}=this,s=this.getNodeType(e),o=e.getComponentType(r.getNodeType(e)),a=e.getTypeFromLength(i.length,o),l=r.build(e,a),u=t.build(e,s),c=e.getTypeLength(s),h=[];for(let d=0;d<c;d++){const f=Vu[d];f===i[0]?(h.push(l),d+=i.length-1):h.push(u+"."+f)}return`${e.getType(s)}( ${h.join(", ")} )`}}class IV extends Rn{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:i}=this,r=this.getNodeType(e),s=i.build(e),o=e.getVarFromNode(this),a=e.getPropertyName(o);e.addLineFlowCode(a+" = "+s,this);const l=e.getTypeLength(r),u=[];let c=0;for(let h=0;h<l;h++){const d=Vu[h];d===t[c]?(u.push("1.0 - "+(a+"."+d)),c++):u.push(a+"."+d)}return`${e.getType(r)}( ${u.join(", ")} )`}}class lx extends tt{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?xm(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=xm(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=AV(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?cC(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}class Xs extends lx{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const i=this.getNodeType(e);return e.format(this.generateConst(e),i,t)}}let Hu=null;const Wu=new Map;function J(n,e){if(Wu.has(n)){console.warn(`Redefinition of method chaining ${n}`);return}if(typeof e!="function")throw new Error(`Node element ${n} is not a function`);Wu.set(n,e)}const _C=n=>n.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),vC=n=>_C(n).split("").sort().join(""),yC={setup(n,e){const t=e.shift();return n(wm(t),...e)},get(n,e,t){if(typeof e=="string"&&n[e]===void 0){if(n.isStackNode!==!0&&e==="assign")return(...i)=>(Hu.assign(t,...i),t);if(Wu.has(e)){const i=Wu.get(e);return n.isStackNode?(...r)=>t.add(i(...r)):(...r)=>i(t,...r)}else{if(e==="self")return n;if(e.endsWith("Assign")&&Wu.has(e.slice(0,e.length-6))){const i=Wu.get(e.slice(0,e.length-6));return n.isStackNode?(...r)=>t.assign(r[0],i(...r)):(...r)=>t.assign(i(t,...r))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=_C(e),pe(new gC(t,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=vC(e.slice(3).toLowerCase()),i=>pe(new LV(n,e,i));if(/^flip[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=vC(e.slice(4).toLowerCase()),()=>pe(new IV(pe(n),e));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),pe(new gC(n,e));if(/^\d+$/.test(e)===!0)return pe(new rd(t,new Xs(Number(e),"uint")))}}}return Reflect.get(n,e,t)},set(n,e,t,i){return typeof e=="string"&&n[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(i[e].assign(t),!0):Reflect.set(n,e,t,i)}},ux=new WeakMap,xC=new WeakMap,UV=function(n,e=null){const t=xm(n);if(t==="node"){let i=ux.get(n);return i===void 0&&(i=new Proxy(n,yC),ux.set(n,i),ux.set(i,i)),i}else{if(e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string")return pe(fx(n,e));if(t==="shader")return me(n)}return n},FV=function(n,e=null){for(const t in n)n[t]=pe(n[t],e);return n},OV=function(n,e=null){const t=n.length;for(let i=0;i<t;i++)n[i]=pe(n[i],e);return n},BV=function(n,e=null,t=null,i=null){const r=s=>pe(i!==null?Object.assign(s,i):s);return e===null?(...s)=>r(new n(...$u(s))):t!==null?(t=pe(t),(...s)=>r(new n(e,...$u(s),t))):(...s)=>r(new n(e,...$u(s)))},kV=function(n,...e){return pe(new n(...$u(e)))};class zV extends tt{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}call(e){const{shaderNode:t,inputNodes:i}=this,r=e.getNodeProperties(t);if(r.onceOutput)return r.onceOutput;let s=null;if(t.layout){let o=xC.get(e.constructor);o===void 0&&(o=new WeakMap,xC.set(e.constructor,o));let a=o.get(t);a===void 0&&(a=pe(e.buildFunctionNode(t)),o.set(t,a)),e.currentFunctionNode!==null&&e.currentFunctionNode.includes.push(a),s=pe(a.call(i))}else{const o=t.jsFunc,a=i!==null?o(i,e):o(e);s=pe(a)}return t.once&&(r.onceOutput=s),s}getOutputNode(e){const t=e.getNodeProperties(this);return t.outputNode===null&&(t.outputNode=this.setupOutput(e)),t.outputNode}setup(e){return this.getOutputNode(e)}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,t){return this.getOutputNode(e).build(e,t)}}class GV extends tt{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}call(e=null){return wm(e),pe(new zV(this,e))}setup(){return this.call()}}const VV=[!1,!0],HV=[0,1,2,3],WV=[-1,-2],SC=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],cx=new Map;for(const n of VV)cx.set(n,new Xs(n));const hx=new Map;for(const n of HV)hx.set(n,new Xs(n,"uint"));const dx=new Map([...hx].map(n=>new Xs(n.value,"int")));for(const n of WV)dx.set(n,new Xs(n,"int"));const Sm=new Map([...dx].map(n=>new Xs(n.value)));for(const n of SC)Sm.set(n,new Xs(n));for(const n of SC)Sm.set(-n,new Xs(-n));const Tm={bool:cx,uint:hx,ints:dx,float:Sm},TC=new Map([...cx,...Sm]),fx=(n,e)=>TC.has(n)?TC.get(n):n.isNode===!0?n:new Xs(n,e),$V=n=>{try{return n.getNodeType()}catch{return}},vn=function(n,e=null){return(...t)=>{if((t.length===0||!["bool","float","int","uint"].includes(n)&&t.every(r=>typeof r!="object"))&&(t=[cC(n,...t)]),t.length===1&&e!==null&&e.has(t[0]))return pe(e.get(t[0]));if(t.length===1){const r=fx(t[0],n);return $V(r)===n?pe(r):pe(new mC(r,n))}const i=t.map(r=>fx(r));return pe(new PV(i,n))}},bC=n=>typeof n=="object"&&n!==null?n.value:n,jV=n=>n!=null?n.nodeType||n.convertTo||(typeof n=="string"?n:null):null;function bm(n,e){return new Proxy(new GV(n,e),yC)}const pe=(n,e=null)=>UV(n,e),wm=(n,e=null)=>new FV(n,e),$u=(n,e=null)=>new OV(n,e),oe=(...n)=>new BV(...n),ve=(...n)=>new kV(...n),me=(n,e)=>{const t=new bm(n,e),i=(...r)=>{let s;return wm(r),r[0]&&r[0].isNode?s=[...r]:s=r[0],t.call(s)};return i.shaderNode=t,i.setLayout=r=>(t.setLayout(r),i),i.once=()=>(t.once=!0,i),i};J("toGlobal",n=>(n.global=!0,n));const Mm=n=>{Hu=n},wC=()=>Hu,yn=(...n)=>Hu.If(...n);function XV(n){return Hu&&Hu.add(n),n}J("append",XV);const qV=new vn("color"),te=new vn("float",Tm.float),on=new vn("int",Tm.ints),YV=new vn("uint",Tm.uint),MC=new vn("bool",Tm.bool),ye=new vn("vec2"),qs=new vn("ivec2"),KV=new vn("uvec2"),QV=new vn("bvec2"),ne=new vn("vec3"),ZV=new vn("ivec3"),JV=new vn("uvec3"),e5=new vn("bvec3"),Qe=new vn("vec4"),t5=new vn("ivec4"),n5=new vn("uvec4"),i5=new vn("bvec4"),px=new vn("mat2"),vi=new vn("mat3"),ju=new vn("mat4");J("toColor",qV),J("toFloat",te),J("toInt",on),J("toUint",YV),J("toBool",MC),J("toVec2",ye),J("toIVec2",qs),J("toUVec2",KV),J("toBVec2",QV),J("toVec3",ne),J("toIVec3",ZV),J("toUVec3",JV),J("toBVec3",e5),J("toVec4",Qe),J("toIVec4",t5),J("toUVec4",n5),J("toBVec4",i5),J("toMat2",px),J("toMat3",vi),J("toMat4",ju);const r5=oe(rd),s5=(n,e)=>pe(new mC(pe(n),e));J("element",r5),J("convert",s5);class EC extends tt{static get type(){return"UniformGroupNode"}constructor(e,t=!1,i=1){super("string"),this.name=e,this.shared=t,this.order=i,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const o5=n=>new EC(n),AC=(n,e=0)=>new EC(n,!0,e),a5=AC("frame"),Xe=AC("render"),CC=o5("object");class sd extends lx{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=CC}label(e){return this.name=e,this}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){const i=this.getSelf();return e=e.bind(i),super.onUpdate(r=>{const s=e(r,i);s!==void 0&&(this.value=s)},t)}generate(e,t){const i=this.getNodeType(e),r=this.getUniformHash(e);let s=e.getNodeFromHash(r);s===void 0&&(e.setHashNode(this,r),s=this);const o=s.getInputType(e),a=e.getUniformFromNode(s,o,e.shaderStage,this.name||e.context.label),l=e.getPropertyName(a);return e.context.label!==void 0&&delete e.context.label,e.format(l,i,t)}}const Ze=(n,e)=>{const t=jV(e||n),i=n&&n.isNode===!0?n.node&&n.node.value||n.value:n;return pe(new sd(i,t))};class At extends tt{static get type(){return"PropertyNode"}constructor(e,t=null,i=!1){super(e),this.name=t,this.varying=i,this.isPropertyNode=!0}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const l5=(n,e)=>pe(new At(n,e)),Em=(n,e)=>pe(new At(n,e,!0)),wt=ve(At,"vec4","DiffuseColor"),RC=ve(At,"vec3","EmissiveColor"),Ys=ve(At,"float","Roughness"),Am=ve(At,"float","Metalness"),mx=ve(At,"float","Clearcoat"),Cm=ve(At,"float","ClearcoatRoughness"),Xu=ve(At,"vec3","Sheen"),gx=ve(At,"float","SheenRoughness"),_x=ve(At,"float","Iridescence"),NC=ve(At,"float","IridescenceIOR"),PC=ve(At,"float","IridescenceThickness"),vx=ve(At,"float","AlphaT"),ja=ve(At,"float","Anisotropy"),Rm=ve(At,"vec3","AnisotropyT"),qu=ve(At,"vec3","AnisotropyB"),tr=ve(At,"color","SpecularColor"),Nm=ve(At,"float","SpecularF90"),yx=ve(At,"float","Shininess"),Pm=ve(At,"vec4","Output"),xx=ve(At,"float","dashSize"),DC=ve(At,"float","gapSize"),Dm=ve(At,"float","IOR"),Sx=ve(At,"float","Transmission"),LC=ve(At,"float","Thickness"),IC=ve(At,"float","AttenuationDistance"),UC=ve(At,"color","AttenuationColor"),FC=ve(At,"float","Dispersion");class u5 extends Rn{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const i=e.getTypeLength(t.node.getNodeType(e));return Vu.join("").slice(0,i)!==t.components}return!1}generate(e,t){const{targetNode:i,sourceNode:r}=this,s=this.needsSplitAssign(e),o=i.getNodeType(e),a=i.context({assign:!0}).build(e),l=r.build(e,o),u=r.getNodeType(e),c=e.getDataFromNode(this);let h;if(c.initialized===!0)t!=="void"&&(h=a);else if(s){const d=e.getVarFromNode(this,null,o),f=e.getPropertyName(d);e.addLineFlowCode(`${f} = ${l}`,this);const m=i.node.context({assign:!0}).build(e);for(let _=0;_<i.components.length;_++){const g=i.components[_];e.addLineFlowCode(`${m}.${g} = ${f}[ ${_} ]`,this)}t!=="void"&&(h=a)}else h=`${a} = ${l}`,(t==="void"||u==="void")&&(e.addLineFlowCode(h,this),t!=="void"&&(h=a));return c.initialized=!0,e.format(h,o,t)}}J("assign",oe(u5));class c5 extends Rn{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const t=[],i=this.functionNode,r=i.getInputs(e),s=this.parameters,o=(l,u)=>{const c=u.type,h=c==="pointer";let d;return h?d="&"+l.build(e):d=l.build(e,c),d};if(Array.isArray(s))for(let l=0;l<s.length;l++)t.push(o(s[l],r[l]));else for(const l of r){const u=s[l.name];if(u!==void 0)t.push(o(u,l));else throw new Error(`FunctionCallNode: Input '${l.name}' not found in FunctionNode.`)}return`${i.build(e,"property")}( ${t.join(", ")} )`}}J("call",(n,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?$u(e):wm(e[0]),pe(new c5(pe(n),e))));class Xt extends Rn{static get type(){return"OperatorNode"}constructor(e,t,i,...r){if(super(),r.length>0){let s=new Xt(e,t,i);for(let o=0;o<r.length-1;o++)s=new Xt(e,s,r[o]);t=s,i=r[r.length-1]}this.op=e,this.aNode=t,this.bNode=i}getNodeType(e,t){const i=this.op,r=this.aNode,s=this.bNode,o=r.getNodeType(e),a=typeof s<"u"?s.getNodeType(e):null;if(o==="void"||a==="void")return"void";if(i==="%")return o;if(i==="~"||i==="&"||i==="|"||i==="^"||i===">>"||i==="<<")return e.getIntegerType(o);if(i==="!"||i==="=="||i==="&&"||i==="||"||i==="^^")return"bool";if(i==="<"||i===">"||i==="<="||i===">="){const l=t?e.getTypeLength(t):Math.max(e.getTypeLength(o),e.getTypeLength(a));return l>1?`bvec${l}`:"bool"}else return o==="float"&&e.isMatrix(a)?a:e.isMatrix(o)&&e.isVector(a)?e.getVectorFromMatrix(o):e.isVector(o)&&e.isMatrix(a)?e.getVectorFromMatrix(a):e.getTypeLength(a)>e.getTypeLength(o)?a:o}generate(e,t){const i=this.op,r=this.aNode,s=this.bNode,o=this.getNodeType(e,t);let a=null,l=null;o!=="void"?(a=r.getNodeType(e),l=typeof s<"u"?s.getNodeType(e):null,i==="<"||i===">"||i==="<="||i===">="||i==="=="?e.isVector(a)?l=a:a!==l&&(a=l="float"):i===">>"||i==="<<"?(a=o,l=e.changeComponentType(l,"uint")):e.isMatrix(a)&&e.isVector(l)?l=e.getVectorFromMatrix(a):e.isVector(a)&&e.isMatrix(l)?a=e.getVectorFromMatrix(l):a=l=o):a=l=o;const u=r.build(e,a),c=typeof s<"u"?s.build(e,l):null,h=e.getTypeLength(t),d=e.getFunctionOperator(i);if(t!=="void")return i==="<"&&h>1?e.useComparisonMethod?e.format(`${e.getMethod("lessThan",t)}( ${u}, ${c} )`,o,t):e.format(`( ${u} < ${c} )`,o,t):i==="<="&&h>1?e.useComparisonMethod?e.format(`${e.getMethod("lessThanEqual",t)}( ${u}, ${c} )`,o,t):e.format(`( ${u} <= ${c} )`,o,t):i===">"&&h>1?e.useComparisonMethod?e.format(`${e.getMethod("greaterThan",t)}( ${u}, ${c} )`,o,t):e.format(`( ${u} > ${c} )`,o,t):i===">="&&h>1?e.useComparisonMethod?e.format(`${e.getMethod("greaterThanEqual",t)}( ${u}, ${c} )`,o,t):e.format(`( ${u} >= ${c} )`,o,t):i==="!"||i==="~"?e.format(`(${i}${u})`,a,t):d?e.format(`${d}( ${u}, ${c} )`,o,t):e.format(`( ${u} ${i} ${c} )`,o,t);if(a!=="void")return d?e.format(`${d}( ${u}, ${c} )`,o,t):e.format(`${u} ${i} ${c}`,o,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const yi=oe(Xt,"+"),Di=oe(Xt,"-"),ht=oe(Xt,"*"),Ks=oe(Xt,"/"),OC=oe(Xt,"%"),h5=oe(Xt,"=="),d5=oe(Xt,"!="),f5=oe(Xt,"<"),p5=oe(Xt,">"),m5=oe(Xt,"<="),g5=oe(Xt,">="),_5=oe(Xt,"&&"),v5=oe(Xt,"||"),y5=oe(Xt,"!"),x5=oe(Xt,"^^"),S5=oe(Xt,"&"),T5=oe(Xt,"~"),b5=oe(Xt,"|"),w5=oe(Xt,"^"),M5=oe(Xt,"<<"),E5=oe(Xt,">>");J("add",yi),J("sub",Di),J("mul",ht),J("div",Ks),J("modInt",OC),J("equal",h5),J("notEqual",d5),J("lessThan",f5),J("greaterThan",p5),J("lessThanEqual",m5),J("greaterThanEqual",g5),J("and",_5),J("or",v5),J("not",y5),J("xor",x5),J("bitAnd",S5),J("bitNot",T5),J("bitOr",b5),J("bitXor",w5),J("shiftLeft",M5),J("shiftRight",E5),J("remainder",(...n)=>(console.warn("TSL.OperatorNode: .remainder() has been renamed to .modInt()."),OC(...n)));class V extends Rn{static get type(){return"MathNode"}constructor(e,t,i=null,r=null){super(),this.method=e,this.aNode=t,this.bNode=i,this.cNode=r}getInputType(e){const t=this.aNode.getNodeType(e),i=this.bNode?this.bNode.getNodeType(e):null,r=this.cNode?this.cNode.getNodeType(e):null,s=e.isMatrix(t)?0:e.getTypeLength(t),o=e.isMatrix(i)?0:e.getTypeLength(i),a=e.isMatrix(r)?0:e.getTypeLength(r);return s>o&&s>a?t:o>a?i:a>s?r:t}getNodeType(e){const t=this.method;return t===V.LENGTH||t===V.DISTANCE||t===V.DOT?"float":t===V.CROSS?"vec3":t===V.ALL?"bool":t===V.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):t===V.MOD?this.aNode.getNodeType(e):this.getInputType(e)}generate(e,t){let i=this.method;const r=this.getNodeType(e),s=this.getInputType(e),o=this.aNode,a=this.bNode,l=this.cNode,u=e.renderer.coordinateSystem;if(i===V.TRANSFORM_DIRECTION){let c=o,h=a;e.isMatrix(c.getNodeType(e))?h=Qe(ne(h),0):c=Qe(ne(c),0);const d=ht(c,h).xyz;return ad(d).build(e,t)}else{if(i===V.NEGATE)return e.format("( - "+o.build(e,s)+" )",r,t);if(i===V.ONE_MINUS)return Di(1,o).build(e,t);if(i===V.RECIPROCAL)return Ks(1,o).build(e,t);if(i===V.DIFFERENCE)return vr(Di(o,a)).build(e,t);{const c=[];return i===V.CROSS||i===V.MOD?c.push(o.build(e,r),a.build(e,r)):u===Ci&&i===V.STEP?c.push(o.build(e,e.getTypeLength(o.getNodeType(e))===1?"float":s),a.build(e,s)):u===Ci&&(i===V.MIN||i===V.MAX)||i===V.MOD?c.push(o.build(e,s),a.build(e,e.getTypeLength(a.getNodeType(e))===1?"float":s)):i===V.REFRACT?c.push(o.build(e,s),a.build(e,s),l.build(e,"float")):i===V.MIX?c.push(o.build(e,s),a.build(e,s),l.build(e,e.getTypeLength(l.getNodeType(e))===1?"float":s)):(u===Uo&&i===V.ATAN&&a!==null&&(i="atan2"),c.push(o.build(e,s)),a!==null&&c.push(a.build(e,s)),l!==null&&c.push(l.build(e,s))),e.format(`${e.getMethod(i,r)}( ${c.join(", ")} )`,r,t)}}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}V.ALL="all",V.ANY="any",V.RADIANS="radians",V.DEGREES="degrees",V.EXP="exp",V.EXP2="exp2",V.LOG="log",V.LOG2="log2",V.SQRT="sqrt",V.INVERSE_SQRT="inversesqrt",V.FLOOR="floor",V.CEIL="ceil",V.NORMALIZE="normalize",V.FRACT="fract",V.SIN="sin",V.COS="cos",V.TAN="tan",V.ASIN="asin",V.ACOS="acos",V.ATAN="atan",V.ABS="abs",V.SIGN="sign",V.LENGTH="length",V.NEGATE="negate",V.ONE_MINUS="oneMinus",V.DFDX="dFdx",V.DFDY="dFdy",V.ROUND="round",V.RECIPROCAL="reciprocal",V.TRUNC="trunc",V.FWIDTH="fwidth",V.TRANSPOSE="transpose",V.BITCAST="bitcast",V.EQUALS="equals",V.MIN="min",V.MAX="max",V.MOD="mod",V.STEP="step",V.REFLECT="reflect",V.DISTANCE="distance",V.DIFFERENCE="difference",V.DOT="dot",V.CROSS="cross",V.POW="pow",V.TRANSFORM_DIRECTION="transformDirection",V.MIX="mix",V.CLAMP="clamp",V.REFRACT="refract",V.SMOOTHSTEP="smoothstep",V.FACEFORWARD="faceforward";const A5=te(1e-6),C5=te(Math.PI),BC=oe(V,V.ALL),R5=oe(V,V.ANY),N5=oe(V,V.RADIANS),P5=oe(V,V.DEGREES),kC=oe(V,V.EXP),od=oe(V,V.EXP2),zC=oe(V,V.LOG),Qs=oe(V,V.LOG2),Tx=oe(V,V.SQRT),D5=oe(V,V.INVERSE_SQRT),Xa=oe(V,V.FLOOR),bx=oe(V,V.CEIL),ad=oe(V,V.NORMALIZE),qo=oe(V,V.FRACT),Gr=oe(V,V.SIN),Yo=oe(V,V.COS),L5=oe(V,V.TAN),I5=oe(V,V.ASIN),U5=oe(V,V.ACOS),GC=oe(V,V.ATAN),vr=oe(V,V.ABS),Lm=oe(V,V.SIGN),Ko=oe(V,V.LENGTH),F5=oe(V,V.NEGATE),O5=oe(V,V.ONE_MINUS),VC=oe(V,V.DFDX),HC=oe(V,V.DFDY),B5=oe(V,V.ROUND),k5=oe(V,V.RECIPROCAL),z5=oe(V,V.TRUNC),G5=oe(V,V.FWIDTH),V5=oe(V,V.TRANSPOSE);V.BITCAST;const H5=oe(V,V.EQUALS),ld=oe(V,V.MIN),Li=oe(V,V.MAX),WC=oe(V,V.MOD),$C=oe(V,V.STEP),W5=oe(V,V.REFLECT),$5=oe(V,V.DISTANCE),j5=oe(V,V.DIFFERENCE),wx=oe(V,V.DOT),jC=oe(V,V.CROSS),Im=oe(V,V.POW),XC=oe(V,V.POW,2),X5=oe(V,V.POW,3),q5=oe(V,V.POW,4),Y5=oe(V,V.TRANSFORM_DIRECTION),K5=n=>ht(Lm(n),Im(vr(n),1/3)),Q5=n=>wx(n,n),Gt=oe(V,V.MIX),Zs=(n,e=0,t=1)=>pe(new V(V.CLAMP,pe(n),pe(e),pe(t))),Z5=n=>Zs(n),qC=oe(V,V.REFRACT),qa=oe(V,V.SMOOTHSTEP),J5=oe(V,V.FACEFORWARD),eH=me(([n])=>{const i=43758.5453,r=wx(n.xy,ye(12.9898,78.233)),s=WC(r,C5);return qo(Gr(s).mul(i))}),tH=(n,e,t)=>Gt(e,t,n),nH=(n,e,t)=>qa(e,t,n),iH=(n,e)=>(console.warn('THREE.TSL: "atan2" is overloaded. Use "atan" instead.'),GC(n,e));J("all",BC),J("any",R5),J("equals",H5),J("radians",N5),J("degrees",P5),J("exp",kC),J("exp2",od),J("log",zC),J("log2",Qs),J("sqrt",Tx),J("inverseSqrt",D5),J("floor",Xa),J("ceil",bx),J("normalize",ad),J("fract",qo),J("sin",Gr),J("cos",Yo),J("tan",L5),J("asin",I5),J("acos",U5),J("atan",GC),J("abs",vr),J("sign",Lm),J("length",Ko),J("lengthSq",Q5),J("negate",F5),J("oneMinus",O5),J("dFdx",VC),J("dFdy",HC),J("round",B5),J("reciprocal",k5),J("trunc",z5),J("fwidth",G5),J("atan2",iH),J("min",ld),J("max",Li),J("mod",WC),J("step",$C),J("reflect",W5),J("distance",$5),J("dot",wx),J("cross",jC),J("pow",Im),J("pow2",XC),J("pow3",X5),J("pow4",q5),J("transformDirection",Y5),J("mix",tH),J("clamp",Zs),J("refract",qC),J("smoothstep",nH),J("faceForward",J5),J("difference",j5),J("saturate",Z5),J("cbrt",K5),J("transpose",V5),J("rand",eH);class rH extends tt{static get type(){return"ConditionalNode"}constructor(e,t,i=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=i}getNodeType(e){const{ifNode:t,elseNode:i}=e.getNodeProperties(this);if(t===void 0)return this.setup(e),this.getNodeType(e);const r=t.getNodeType(e);if(i!==null){const s=i.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(r))return s}return r}setup(e){const t=this.condNode.cache(),i=this.ifNode.cache(),r=this.elseNode?this.elseNode.cache():null,s=e.context.nodeBlock;e.getDataFromNode(i).parentNodeBlock=s,r!==null&&(e.getDataFromNode(r).parentNodeBlock=s);const o=e.getNodeProperties(this);o.condNode=t,o.ifNode=i.context({nodeBlock:i}),o.elseNode=r?r.context({nodeBlock:r}):null}generate(e,t){const i=this.getNodeType(e),r=e.getDataFromNode(this);if(r.nodeProperty!==void 0)return r.nodeProperty;const{condNode:s,ifNode:o,elseNode:a}=e.getNodeProperties(this),l=t!=="void",u=l?l5(i).build(e):"";r.nodeProperty=u;const c=s.build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${c} ) {

`).addFlowTab();let h=o.build(e,i);if(h&&(l?h=u+" = "+h+";":h="return "+h+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+h+`

`+e.tab+"}"),a!==null){e.addFlowCode(` else {

`).addFlowTab();let d=a.build(e,i);d&&(l?d=u+" = "+d+";":d="return "+d+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+d+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(u,i,t)}}const Ii=oe(rH);J("select",Ii),J("cond",(...n)=>(console.warn("TSL.ConditionalNode: cond() has been renamed to select()."),Ii(...n)));class YC extends tt{static get type(){return"ContextNode"}constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}analyze(e){this.node.build(e)}setup(e){const t=e.getContext();e.setContext({...e.context,...this.value});const i=this.node.build(e);return e.setContext(t),i}generate(e,t){const i=e.getContext();e.setContext({...e.context,...this.value});const r=this.node.build(e,t);return e.setContext(i),r}}const Mx=oe(YC),sH=(n,e)=>Mx(n,{label:e});J("context",Mx),J("label",sH);class Um extends tt{static get type(){return"VarNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:t,name:i}=this,r=e.getVarFromNode(this,i,e.getVectorType(this.getNodeType(e))),s=e.getPropertyName(r),o=t.build(e,r.type);return e.addLineFlowCode(`${s} = ${o}`,this),s}}const KC=oe(Um);J("toVar",(...n)=>KC(...n).append()),J("temp",n=>(console.warn('TSL: "temp" is deprecated. Use ".toVar()" instead.'),KC(n)));class oH extends tt{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let i=t.varying;if(i===void 0){const r=this.name,s=this.getNodeType(e);t.varying=i=e.getVaryingFromNode(this,r,s),t.node=this.node}return i.needsInterpolation||(i.needsInterpolation=e.shaderStage==="fragment"),i}setup(e){this.setupVarying(e)}analyze(e){return this.setupVarying(e),this.node.analyze(e)}generate(e){const t=e.getNodeProperties(this),i=this.setupVarying(e),r=e.shaderStage==="fragment"&&t.reassignPosition===!0&&e.context.needsPositionReassign;if(t.propertyName===void 0||r){const s=this.getNodeType(e),o=e.getPropertyName(i,dC.VERTEX);e.flowNodeFromShaderStage(dC.VERTEX,this.node,s,o),t.propertyName=o,r?t.reassignPosition=!1:t.reassignPosition===void 0&&e.context.isPositionNodeInput&&(t.reassignPosition=!0)}return e.getPropertyName(i)}}const Js=oe(oH),aH=n=>Js(n);J("varying",Js),J("vertexStage",aH);const lH=me(([n])=>{const e=n.mul(.9478672986).add(.0521327014).pow(2.4),t=n.mul(.0773993808),i=n.lessThanEqual(.04045);return Gt(e,t,i)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),uH=me(([n])=>{const e=n.pow(.41666).mul(1.055).sub(.055),t=n.mul(12.92),i=n.lessThanEqual(.0031308);return Gt(e,t,i)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),ud="WorkingColorSpace",Ex="OutputColorSpace";class Fm extends Rn{static get type(){return"ColorSpaceNode"}constructor(e,t,i){super("vec4"),this.colorNode=e,this.source=t,this.target=i}resolveColorSpace(e,t){return t===ud?st.workingColorSpace:t===Ex?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,i=this.resolveColorSpace(e,this.source),r=this.resolveColorSpace(e,this.target);let s=t;return st.enabled===!1||i===r||!i||!r||(st.getTransfer(i)===Et&&(s=Qe(lH(s.rgb),s.a)),st.getPrimaries(i)!==st.getPrimaries(r)&&(s=Qe(vi(st._getMatrix(new je,i,r)).mul(s.rgb),s.a)),st.getTransfer(r)===Et&&(s=Qe(uH(s.rgb),s.a))),s}}const cH=n=>pe(new Fm(pe(n),ud,Ex)),hH=n=>pe(new Fm(pe(n),Ex,ud)),dH=(n,e)=>pe(new Fm(pe(n),ud,e)),QC=(n,e)=>pe(new Fm(pe(n),e,ud));J("toOutputColorSpace",cH),J("toWorkingColorSpace",hH),J("workingToColorSpace",dH),J("colorSpaceToWorking",QC);let fH=class extends rd{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),i=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,i,r)}};class ZC extends tt{static get type(){return"ReferenceBaseNode"}constructor(e,t,i=null,r=null){super(),this.property=e,this.uniformType=t,this.object=i,this.count=r,this.properties=e.split("."),this.reference=i,this.node=null,this.group=null,this.updateType=at.OBJECT}setGroup(e){return this.group=e,this}element(e){return pe(new fH(this,pe(e)))}setNodeType(e){const t=Ze(null,e).getSelf();this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let i=e[t[0]];for(let r=1;r<t.length;r++)i=i[t[r]];return i}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const pH=(n,e,t)=>pe(new ZC(n,e,t));class mH extends ZC{static get type(){return"RendererReferenceNode"}constructor(e,t,i=null){super(e,t,i),this.renderer=i,this.setGroup(Xe)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const gH=(n,e,t=null)=>pe(new mH(n,e,t));class _H extends Rn{static get type(){return"ToneMappingNode"}constructor(e,t=yH,i=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=i}customCacheKey(){return ax(this.toneMapping)}setup(e){const t=this.colorNode||e.context.color,i=this.toneMapping;if(i===Ai)return t;let r=null;const s=e.renderer.library.getToneMappingFunction(i);return s!==null?r=Qe(s(t.rgb,this.exposureNode),t.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",i),r=t),r}}const vH=(n,e,t)=>pe(new _H(n,pe(e),pe(t))),yH=gH("toneMappingExposure","float");J("toneMapping",(n,e,t)=>vH(e,t,n));class xH extends lx{static get type(){return"BufferAttributeNode"}constructor(e,t=null,i=0,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=i,this.bufferOffset=r,this.usage=cp,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),i=this.value,r=e.getTypeLength(t),s=this.bufferStride||r,o=this.bufferOffset,a=i.isInterleavedBuffer===!0?i:new Wy(i,s),l=new Nh(a,r,o);a.setUsage(this.usage),this.attribute=l,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),i=e.getBufferAttributeFromNode(this,t),r=e.getPropertyName(i);let s=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=r,s=r):s=Js(this).build(e,t),s}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const Ax=(n,e=null,t=0,i=0)=>pe(new xH(n,e,t,i)),SH=(n,e=null,t=0,i=0)=>Ax(n,e,t,i).setUsage(uu),JC=(n,e=null,t=0,i=0)=>Ax(n,e,t,i).setInstanced(!0),eR=(n,e=null,t=0,i=0)=>SH(n,e,t,i).setInstanced(!0);J("toAttribute",n=>Ax(n.value));class TH extends tt{static get type(){return"ComputeNode"}constructor(e,t,i=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=i,this.dispatchCount=0,this.version=1,this.name="",this.updateBeforeType=at.OBJECT,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}label(e){return this.name=e,this}updateDispatchCount(){const{count:e,workgroupSize:t}=this;let i=t[0];for(let r=1;r<t.length;r++)i*=t[r];this.dispatchCount=Math.ceil(e/i)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}generate(e){const{shaderStage:t}=e;if(t==="compute"){const i=this.computeNode.build(e,"void");i!==""&&e.addLineFlowCode(i,this)}}}J("compute",(n,e,t)=>pe(new TH(pe(n),e,t)));class bH extends tt{static get type(){return"CacheNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isCacheNode=!0}getNodeType(e){const t=e.getCache(),i=e.getCacheFromNode(this,this.parent);e.setCache(i);const r=this.node.getNodeType(e);return e.setCache(t),r}build(e,...t){const i=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);const s=this.node.build(e,...t);return e.setCache(i),s}}const Om=(n,e)=>pe(new bH(pe(n),e));J("cache",Om);class wH extends tt{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}J("bypass",oe(wH));class tR extends tt{static get type(){return"RemapNode"}constructor(e,t,i,r=te(0),s=te(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=i,this.outLowNode=r,this.outHighNode=s,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:i,outLowNode:r,outHighNode:s,doClamp:o}=this;let a=e.sub(t).div(i.sub(t));return o===!0&&(a=a.clamp()),a.mul(s.sub(r)).add(r)}}const MH=oe(tR,null,null,{doClamp:!1}),EH=oe(tR);J("remap",MH),J("remapClamp",EH);class Bm extends tt{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const i=this.getNodeType(e),r=this.snippet;if(i==="void")e.addLineFlowCode(r,this);else return e.format(`( ${r} )`,i,t)}}const cd=oe(Bm);J("discard",n=>(n?Ii(n,cd("discard")):cd("discard")).append());class AH extends Rn{static get type(){return"RenderOutputNode"}constructor(e,t,i){super("vec4"),this.colorNode=e,this.toneMapping=t,this.outputColorSpace=i,this.isRenderOutputNode=!0}setup({context:e}){let t=this.colorNode||e.color;const i=(this.toneMapping!==null?this.toneMapping:e.toneMapping)||Ai,r=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||Yi;return i!==Ai&&(t=t.toneMapping(i)),r!==Yi&&r!==st.workingColorSpace&&(t=t.workingToColorSpace(r)),t}}J("renderOutput",(n,e=null,t=null)=>pe(new AH(pe(n),e,t)));class CH extends tt{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const i=this.getAttributeName(e);if(e.hasGeometryAttribute(i)){const r=e.geometry.getAttribute(i);t=e.getTypeFromAttribute(r)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),i=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const s=e.geometry.getAttribute(t),o=e.getTypeFromAttribute(s),a=e.getAttribute(t,o);return e.shaderStage==="vertex"?e.format(a.name,o,i):Js(this).build(e,i)}else return console.warn(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(i)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const eo=(n,e)=>pe(new CH(n,e)),km=(n=0)=>eo("uv"+(n>0?n:""),"vec2");class RH extends tt{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const i=this.textureNode.build(e,"property"),r=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${i}, ${r} )`,this.getNodeType(e),t)}}const hd=oe(RH);class NH extends sd{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=at.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,i=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(i&&i.width!==void 0){const{width:r,height:s}=i;this.value=Math.log2(Math.max(r,s))}}}const PH=oe(NH);class dd extends sd{static get type(){return"TextureNode"}constructor(e,t=null,i=null,r=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=i,this.biasNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=at.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===en?"uvec4":this.value.type===Un?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return km(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=Ze(this.value.matrix)),this._matrixUniform.mul(ne(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?at.RENDER:at.NONE,this}setupUV(e,t){const i=this.value;return e.isFlipY()&&(i.image instanceof ImageBitmap&&i.flipY===!0||i.isRenderTargetTexture===!0||i.isFramebufferTexture===!0||i.isDepthTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(on(hd(this,this.levelNode).y).sub(t.y).sub(1))),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const i=this.value;if(!i||i.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");let r=this.uvNode;(r===null||e.context.forceUVContext===!0)&&e.context.getUV&&(r=e.context.getUV(this)),r||(r=this.getDefaultUV()),this.updateMatrix===!0&&(r=this.getTransformedUV(r)),r=this.setupUV(e,r);let s=this.levelNode;s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),t.uvNode=r,t.levelNode=s,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateSnippet(e,t,i,r,s,o,a,l){const u=this.value;let c;return r?c=e.generateTextureLevel(u,t,i,r,o):s?c=e.generateTextureBias(u,t,i,s,o):l?c=e.generateTextureGrad(u,t,i,l,o):a?c=e.generateTextureCompare(u,t,i,a,o):this.sampler===!1?c=e.generateTextureLoad(u,t,i,o):c=e.generateTexture(u,t,i,o),c}generate(e,t){const i=this.value,r=e.getNodeProperties(this),s=super.generate(e,"property");if(t==="sampler")return s+"_sampler";if(e.isReference(t))return s;{const o=e.getDataFromNode(this);let a=o.propertyName;if(a===void 0){const{uvNode:c,levelNode:h,biasNode:d,compareNode:f,depthNode:m,gradNode:_}=r,g=this.generateUV(e,c),p=h?h.build(e,"float"):null,v=d?d.build(e,"float"):null,y=m?m.build(e,"int"):null,x=f?f.build(e,"float"):null,T=_?[_[0].build(e,"vec2"),_[1].build(e,"vec2")]:null,S=e.getVarFromNode(this);a=e.getPropertyName(S);const w=this.generateSnippet(e,s,g,p,v,y,x,T);e.addLineFlowCode(`${a} = ${w}`,this),o.snippet=w,o.propertyName=a}let l=a;const u=this.getNodeType(e);return e.needsToWorkingColorSpace(i)&&(l=QC(cd(l,u),i.colorSpace).setup(e).build(e,u)),e.format(l,u,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return console.warn("THREE.TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=pe(e),t.referenceNode=this.getSelf(),pe(t)}blur(e){const t=this.clone();return t.biasNode=pe(e).mul(PH(t)),t.referenceNode=this.getSelf(),pe(t)}level(e){const t=this.clone();return t.levelNode=pe(e),t.referenceNode=this.getSelf(),pe(t)}size(e){return hd(this,e)}bias(e){const t=this.clone();return t.biasNode=pe(e),t.referenceNode=this.getSelf(),pe(t)}compare(e){const t=this.clone();return t.compareNode=pe(e),t.referenceNode=this.getSelf(),pe(t)}grad(e,t){const i=this.clone();return i.gradNode=[pe(e),pe(t)],i.referenceNode=this.getSelf(),pe(i)}depth(e){const t=this.clone();return t.depthNode=pe(e),t.referenceNode=this.getSelf(),pe(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e}}const yt=oe(dd),Vr=(...n)=>yt(...n).setSampler(!1),Ya=Ze("float").label("cameraNear").setGroup(Xe).onRenderUpdate(({camera:n})=>n.near),Ka=Ze("float").label("cameraFar").setGroup(Xe).onRenderUpdate(({camera:n})=>n.far),Cx=Ze("mat4").label("cameraProjectionMatrix").setGroup(Xe).onRenderUpdate(({camera:n})=>n.projectionMatrix),to=Ze("mat4").label("cameraViewMatrix").setGroup(Xe).onRenderUpdate(({camera:n})=>n.matrixWorldInverse),DH=Ze(new N).label("cameraPosition").setGroup(Xe).onRenderUpdate(({camera:n},e)=>e.value.setFromMatrixPosition(n.matrixWorld));class Tt extends tt{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=at.OBJECT,this._uniformNode=new sd(null)}getNodeType(){const e=this.scope;if(e===Tt.WORLD_MATRIX)return"mat4";if(e===Tt.POSITION||e===Tt.VIEW_POSITION||e===Tt.DIRECTION||e===Tt.SCALE)return"vec3"}update(e){const t=this.object3d,i=this._uniformNode,r=this.scope;if(r===Tt.WORLD_MATRIX)i.value=t.matrixWorld;else if(r===Tt.POSITION)i.value=i.value||new N,i.value.setFromMatrixPosition(t.matrixWorld);else if(r===Tt.SCALE)i.value=i.value||new N,i.value.setFromMatrixScale(t.matrixWorld);else if(r===Tt.DIRECTION)i.value=i.value||new N,t.getWorldDirection(i.value);else if(r===Tt.VIEW_POSITION){const s=e.camera;i.value=i.value||new N,i.value.setFromMatrixPosition(t.matrixWorld),i.value.applyMatrix4(s.matrixWorldInverse)}}generate(e){const t=this.scope;return t===Tt.WORLD_MATRIX?this._uniformNode.nodeType="mat4":(t===Tt.POSITION||t===Tt.VIEW_POSITION||t===Tt.DIRECTION||t===Tt.SCALE)&&(this._uniformNode.nodeType="vec3"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}Tt.WORLD_MATRIX="worldMatrix",Tt.POSITION="position",Tt.SCALE="scale",Tt.VIEW_POSITION="viewPosition",Tt.DIRECTION="direction",Tt.DIRECTION,Tt.WORLD_MATRIX;const LH=oe(Tt,Tt.POSITION);Tt.SCALE,Tt.VIEW_POSITION;class ls extends Tt{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}ls.DIRECTION;const Qa=ve(ls,ls.WORLD_MATRIX);ls.POSITION,ls.SCALE,ls.VIEW_POSITION;const IH=Ze(new je).onObjectUpdate(({object:n},e)=>e.value.getNormalMatrix(n.matrixWorld)),Rx=me(n=>n.renderer.nodes.modelViewMatrix||UH).once()().toVar("modelViewMatrix"),UH=to.mul(Qa),Nx=eo("position","vec3"),ni=Nx.varying("positionLocal"),nR=Nx.varying("positionPrevious"),fd=Qa.mul(ni).xyz.varying("v_positionWorld").context({needsPositionReassign:!0}),iR=ni.transformDirection(Qa).varying("v_positionWorldDirection").normalize().toVar("positionWorldDirection").context({needsPositionReassign:!0}),xn=me(n=>n.context.setupPositionView(),"vec3").once()().varying("v_positionView").context({needsPositionReassign:!0}),tn=xn.negate().varying("v_positionViewDirection").normalize().toVar("positionViewDirection");class FH extends tt{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){const{renderer:t,material:i}=e;return t.coordinateSystem===Ci&&i.side===$t?"false":e.getFrontFacing()}}const zm=te(ve(FH)).mul(2).sub(1),rR=eo("normal","vec3"),us=me(n=>n.geometry.hasAttribute("normal")===!1?(console.warn('TSL.NormalNode: Vertex attribute "normal" not found on geometry.'),ne(0,1,0)):rR,"vec3").once()().toVar("normalLocal"),OH=xn.dFdx().cross(xn.dFdy()).normalize().toVar("normalFlat"),Hr=me(n=>{let e;return n.material.flatShading===!0?e=OH:e=Js(oR(us),"v_normalView").normalize(),e},"vec3").once()().toVar("normalView"),sR=Js(Hr.transformDirection(to),"v_normalWorld").normalize().toVar("normalWorld"),Sn=me(n=>n.context.setupNormal(),"vec3").once()().mul(zm).toVar("transformedNormalView"),Px=Sn.transformDirection(to).toVar("transformedNormalWorld"),pd=me(n=>n.context.setupClearcoatNormal(),"vec3").once()().mul(zm).toVar("transformedClearcoatNormalView"),BH=me(([n,e=Qa])=>{const t=vi(e),i=n.div(ne(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(i).xyz}),oR=me(([n],e)=>{const t=e.renderer.nodes.modelNormalViewMatrix;if(t!==null)return t.transformDirection(n);const i=IH.mul(n);return to.transformDirection(i)}),kH=Ze(0).onReference(({material:n})=>n).onRenderUpdate(({material:n})=>n.refractionRatio),zH=tn.negate().reflect(Sn),GH=tn.negate().refract(Sn,kH),VH=zH.transformDirection(to).toVar("reflectVector"),HH=GH.transformDirection(to).toVar("reflectVector");class WH extends dd{static get type(){return"CubeTextureNode"}constructor(e,t=null,i=null,r=null){super(e,t,i,r),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===fr?VH:e.mapping===pr?HH:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',e.mapping),ne(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const i=this.value;return e.renderer.coordinateSystem===Uo||!i.isRenderTargetTexture?ne(t.x.negate(),t.yz):t}generateUV(e,t){return t.build(e,"vec3")}}const md=oe(WH);class aR extends sd{static get type(){return"BufferNode"}constructor(e,t,i=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=i}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const Dx=(n,e,t)=>pe(new aR(n,e,t));class $H extends rd{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),i=this.getNodeType(),r=this.node.getPaddedType();return e.format(t,r,i)}}class jH extends aR{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?xm(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=at.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,i=this.elementType;if(i==="float"||i==="int"||i==="uint")for(let r=0;r<e.length;r++){const s=r*4;t[s]=e[r]}else if(i==="color")for(let r=0;r<e.length;r++){const s=r*4,o=e[r];t[s]=o.r,t[s+1]=o.g,t[s+2]=o.b||0}else if(i==="mat2")for(let r=0;r<e.length;r++){const s=r*4,o=e[r];t[s]=o.elements[0],t[s+1]=o.elements[1],t[s+2]=o.elements[2],t[s+3]=o.elements[3]}else if(i==="mat3")for(let r=0;r<e.length;r++){const s=r*16,o=e[r];t[s]=o.elements[0],t[s+1]=o.elements[1],t[s+2]=o.elements[2],t[s+4]=o.elements[3],t[s+5]=o.elements[4],t[s+6]=o.elements[5],t[s+8]=o.elements[6],t[s+9]=o.elements[7],t[s+10]=o.elements[8],t[s+15]=1}else if(i==="mat4")for(let r=0;r<e.length;r++){const s=r*16,o=e[r];for(let a=0;a<o.elements.length;a++)t[s+a]=o.elements[a]}else for(let r=0;r<e.length;r++){const s=r*4,o=e[r];t[s]=o.x,t[s+1]=o.y,t[s+2]=o.z||0,t[s+3]=o.w||0}}setup(e){const t=this.array.length,i=this.elementType;let r=Float32Array;const s=this.paddedType,o=e.getTypeLength(s);return i.charAt(0)==="i"&&(r=Int32Array),i.charAt(0)==="u"&&(r=Uint32Array),this.value=new r(t*o),this.bufferCount=t,this.bufferType=s,super.setup(e)}element(e){return pe(new $H(this,pe(e)))}}const Qo=(n,e)=>pe(new jH(n,e));class XH extends rd{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),i=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,i,r)}}class Lx extends tt{static get type(){return"ReferenceNode"}constructor(e,t,i=null,r=null){super(),this.property=e,this.uniformType=t,this.object=i,this.count=r,this.properties=e.split("."),this.reference=i,this.node=null,this.group=null,this.name=null,this.updateType=at.OBJECT}element(e){return pe(new XH(this,pe(e)))}setGroup(e){return this.group=e,this}label(e){return this.name=e,this}setNodeType(e){let t=null;this.count!==null?t=Dx(null,e,this.count):Array.isArray(this.getValueFromReference())?t=Qo(null,e):e==="texture"?t=yt(null):e==="cubeTexture"?t=md(null):t=Ze(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.label(this.name),this.node=t.getSelf()}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let i=e[t[0]];for(let r=1;r<t.length;r++)i=i[t[r]];return i}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const Dt=(n,e,t)=>pe(new Lx(n,e,t)),lR=(n,e,t,i)=>pe(new Lx(n,e,i,t));class qH extends Lx{static get type(){return"MaterialReferenceNode"}constructor(e,t,i=null){super(e,t,i),this.material=i,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const Zo=(n,e,t=null)=>pe(new qH(n,e,t)),uR=me(n=>(n.geometry.hasAttribute("tangent")===!1&&n.geometry.computeTangents(),eo("tangent","vec4")))(),Ix=uR.xyz.toVar("tangentLocal"),cR=Rx.mul(Qe(Ix,0)).xyz.varying("v_tangentView").normalize().toVar("tangentView"),gd=vi(cR,Js((n=>n.mul(uR.w).xyz)(Hr.cross(cR)),"v_bitangentView").normalize().toVar("bitangentView"),Hr),YH=(()=>{let n=qu.cross(tn);return n=n.cross(qu).normalize(),n=Gt(n,Sn,ja.mul(Ys.oneMinus()).oneMinus().pow2().pow2()).normalize(),n})(),KH=me(n=>{const{eye_pos:e,surf_norm:t,mapN:i,uv:r}=n,s=e.dFdx(),o=e.dFdy(),a=r.dFdx(),l=r.dFdy(),u=t,c=o.cross(u),h=u.cross(s),d=c.mul(a.x).add(h.mul(l.x)),f=c.mul(a.y).add(h.mul(l.y)),m=d.dot(d).max(f.dot(f)),_=zm.mul(m.inverseSqrt());return yi(d.mul(i.x,_),f.mul(i.y,_),u.mul(i.z)).normalize()});class QH extends Rn{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=Rs}setup(e){const{normalMapType:t,scaleNode:i}=this;let r=this.node.mul(2).sub(1);i!==null&&(r=ne(r.xy.mul(i),r.z));let s=null;return t===jM?s=oR(r):t===Rs&&(e.hasGeometryAttribute("tangent")===!0?s=gd.mul(r).normalize():s=KH({eye_pos:xn,surf_norm:Hr,mapN:r,uv:km()})),s}}const hR=oe(QH),ZH=me(({textureNode:n,bumpScale:e})=>{const t=r=>n.cache().context({getUV:s=>r(s.uvNode||km()),forceUVContext:!0}),i=te(t(r=>r));return ye(te(t(r=>r.add(r.dFdx()))).sub(i),te(t(r=>r.add(r.dFdy()))).sub(i)).mul(e)}),JH=me(n=>{const{surf_pos:e,surf_norm:t,dHdxy:i}=n,r=e.dFdx().normalize(),s=e.dFdy().normalize(),o=t,a=s.cross(o),l=o.cross(r),u=r.dot(a).mul(zm),c=u.sign().mul(i.x.mul(a).add(i.y.mul(l)));return u.abs().mul(t).sub(c).normalize()});class e6 extends Rn{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=ZH({textureNode:this.textureNode,bumpScale:e});return JH({surf_pos:xn,surf_norm:Hr,dHdxy:t})}}const t6=oe(e6),dR=new Map;class Q extends tt{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let i=dR.get(e);return i===void 0&&(i=Zo(e,t),dR.set(e,i)),i}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,i=this.scope;let r=null;if(i===Q.COLOR){const s=t.color!==void 0?this.getColor(i):ne();t.map&&t.map.isTexture===!0?r=s.mul(this.getTexture("map")):r=s}else if(i===Q.OPACITY){const s=this.getFloat(i);t.alphaMap&&t.alphaMap.isTexture===!0?r=s.mul(this.getTexture("alpha")):r=s}else if(i===Q.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?r=this.getTexture("specular").r:r=te(1);else if(i===Q.SPECULAR_INTENSITY){const s=this.getFloat(i);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?r=s.mul(this.getTexture(i).a):r=s}else if(i===Q.SPECULAR_COLOR){const s=this.getColor(i);t.specularColorMap&&t.specularColorMap.isTexture===!0?r=s.mul(this.getTexture(i).rgb):r=s}else if(i===Q.ROUGHNESS){const s=this.getFloat(i);t.roughnessMap&&t.roughnessMap.isTexture===!0?r=s.mul(this.getTexture(i).g):r=s}else if(i===Q.METALNESS){const s=this.getFloat(i);t.metalnessMap&&t.metalnessMap.isTexture===!0?r=s.mul(this.getTexture(i).b):r=s}else if(i===Q.EMISSIVE){const s=this.getFloat("emissiveIntensity"),o=this.getColor(i).mul(s);t.emissiveMap&&t.emissiveMap.isTexture===!0?r=o.mul(this.getTexture(i)):r=o}else if(i===Q.NORMAL)t.normalMap?(r=hR(this.getTexture("normal"),this.getCache("normalScale","vec2")),r.normalMapType=t.normalMapType):t.bumpMap?r=t6(this.getTexture("bump").r,this.getFloat("bumpScale")):r=Hr;else if(i===Q.CLEARCOAT){const s=this.getFloat(i);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?r=s.mul(this.getTexture(i).r):r=s}else if(i===Q.CLEARCOAT_ROUGHNESS){const s=this.getFloat(i);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?r=s.mul(this.getTexture(i).r):r=s}else if(i===Q.CLEARCOAT_NORMAL)t.clearcoatNormalMap?r=hR(this.getTexture(i),this.getCache(i+"Scale","vec2")):r=Hr;else if(i===Q.SHEEN){const s=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?r=s.mul(this.getTexture("sheenColor").rgb):r=s}else if(i===Q.SHEEN_ROUGHNESS){const s=this.getFloat(i);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?r=s.mul(this.getTexture(i).a):r=s,r=r.clamp(.07,1)}else if(i===Q.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const s=this.getTexture(i);r=px(_d.x,_d.y,_d.y.negate(),_d.x).mul(s.rg.mul(2).sub(ye(1)).normalize().mul(s.b))}else r=_d;else if(i===Q.IRIDESCENCE_THICKNESS){const s=Dt("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const o=Dt("0","float",t.iridescenceThicknessRange);r=s.sub(o).mul(this.getTexture(i).g).add(o)}else r=s}else if(i===Q.TRANSMISSION){const s=this.getFloat(i);t.transmissionMap?r=s.mul(this.getTexture(i).r):r=s}else if(i===Q.THICKNESS){const s=this.getFloat(i);t.thicknessMap?r=s.mul(this.getTexture(i).g):r=s}else if(i===Q.IOR)r=this.getFloat(i);else if(i===Q.LIGHT_MAP)r=this.getTexture(i).rgb.mul(this.getFloat("lightMapIntensity"));else if(i===Q.AO)r=this.getTexture(i).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else{const s=this.getNodeType(e);r=this.getCache(i,s)}return r}}Q.ALPHA_TEST="alphaTest",Q.COLOR="color",Q.OPACITY="opacity",Q.SHININESS="shininess",Q.SPECULAR="specular",Q.SPECULAR_STRENGTH="specularStrength",Q.SPECULAR_INTENSITY="specularIntensity",Q.SPECULAR_COLOR="specularColor",Q.REFLECTIVITY="reflectivity",Q.ROUGHNESS="roughness",Q.METALNESS="metalness",Q.NORMAL="normal",Q.CLEARCOAT="clearcoat",Q.CLEARCOAT_ROUGHNESS="clearcoatRoughness",Q.CLEARCOAT_NORMAL="clearcoatNormal",Q.EMISSIVE="emissive",Q.ROTATION="rotation",Q.SHEEN="sheen",Q.SHEEN_ROUGHNESS="sheenRoughness",Q.ANISOTROPY="anisotropy",Q.IRIDESCENCE="iridescence",Q.IRIDESCENCE_IOR="iridescenceIOR",Q.IRIDESCENCE_THICKNESS="iridescenceThickness",Q.IOR="ior",Q.TRANSMISSION="transmission",Q.THICKNESS="thickness",Q.ATTENUATION_DISTANCE="attenuationDistance",Q.ATTENUATION_COLOR="attenuationColor",Q.LINE_SCALE="scale",Q.LINE_DASH_SIZE="dashSize",Q.LINE_GAP_SIZE="gapSize",Q.LINE_WIDTH="linewidth",Q.LINE_DASH_OFFSET="dashOffset",Q.POINT_WIDTH="pointWidth",Q.DISPERSION="dispersion",Q.LIGHT_MAP="light",Q.AO="ao";const n6=ve(Q,Q.ALPHA_TEST),i6=ve(Q,Q.COLOR),r6=ve(Q,Q.SHININESS),s6=ve(Q,Q.EMISSIVE),fR=ve(Q,Q.OPACITY),o6=ve(Q,Q.SPECULAR),pR=ve(Q,Q.SPECULAR_INTENSITY),a6=ve(Q,Q.SPECULAR_COLOR),Gm=ve(Q,Q.SPECULAR_STRENGTH),Ux=ve(Q,Q.REFLECTIVITY),l6=ve(Q,Q.ROUGHNESS),u6=ve(Q,Q.METALNESS),c6=ve(Q,Q.NORMAL).context({getUV:null}),h6=ve(Q,Q.CLEARCOAT),d6=ve(Q,Q.CLEARCOAT_ROUGHNESS),f6=ve(Q,Q.CLEARCOAT_NORMAL).context({getUV:null}),p6=ve(Q,Q.ROTATION),m6=ve(Q,Q.SHEEN),g6=ve(Q,Q.SHEEN_ROUGHNESS),_6=ve(Q,Q.ANISOTROPY),v6=ve(Q,Q.IRIDESCENCE),y6=ve(Q,Q.IRIDESCENCE_IOR),x6=ve(Q,Q.IRIDESCENCE_THICKNESS),S6=ve(Q,Q.TRANSMISSION),T6=ve(Q,Q.THICKNESS),b6=ve(Q,Q.IOR),w6=ve(Q,Q.ATTENUATION_DISTANCE),M6=ve(Q,Q.ATTENUATION_COLOR),E6=ve(Q,Q.LINE_SCALE),A6=ve(Q,Q.LINE_DASH_SIZE),C6=ve(Q,Q.LINE_GAP_SIZE);Q.LINE_WIDTH;const R6=ve(Q,Q.LINE_DASH_OFFSET);Q.POINT_WIDTH;const N6=ve(Q,Q.DISPERSION),mR=ve(Q,Q.LIGHT_MAP),P6=ve(Q,Q.AO),_d=Ze(new ce).onReference(function(n){return n.material}).onRenderUpdate(function({material:n}){this.value.set(n.anisotropy*Math.cos(n.anisotropyRotation),n.anisotropy*Math.sin(n.anisotropyRotation))}),gR=me(n=>n.context.setupModelViewProjection(),"vec4").once()().varying("v_modelViewProjection");class Vt extends tt{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),i=this.scope;let r;if(i===Vt.VERTEX)r=e.getVertexIndex();else if(i===Vt.INSTANCE)r=e.getInstanceIndex();else if(i===Vt.DRAW)r=e.getDrawIndex();else if(i===Vt.INVOCATION_LOCAL)r=e.getInvocationLocalIndex();else if(i===Vt.INVOCATION_SUBGROUP)r=e.getInvocationSubgroupIndex();else if(i===Vt.SUBGROUP)r=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+i);let s;return e.shaderStage==="vertex"||e.shaderStage==="compute"?s=r:s=Js(this).build(e,t),s}}Vt.VERTEX="vertex",Vt.INSTANCE="instance",Vt.SUBGROUP="subgroup",Vt.INVOCATION_LOCAL="invocationLocal",Vt.INVOCATION_SUBGROUP="invocationSubgroup",Vt.DRAW="draw";const D6=ve(Vt,Vt.VERTEX),Fx=ve(Vt,Vt.INSTANCE);Vt.SUBGROUP,Vt.INVOCATION_SUBGROUP,Vt.INVOCATION_LOCAL;const L6=ve(Vt,Vt.DRAW);class I6 extends tt{static get type(){return"InstanceNode"}constructor(e,t,i){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=i,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=at.FRAME,this.buffer=null,this.bufferColor=null}setup(e){const{count:t,instanceMatrix:i,instanceColor:r}=this;let{instanceMatrixNode:s,instanceColorNode:o}=this;if(s===null){if(t<=1e3)s=Dx(i.array,"mat4",Math.max(t,1)).element(Fx);else{const l=new KU(i.array,16,1);this.buffer=l;const u=i.usage===uu?eR:JC,c=[u(l,"vec4",16,0),u(l,"vec4",16,4),u(l,"vec4",16,8),u(l,"vec4",16,12)];s=ju(...c)}this.instanceMatrixNode=s}if(r&&o===null){const l=new oU(r.array,3),u=r.usage===uu?eR:JC;this.bufferColor=l,o=ne(u(l,"vec3",3,0)),this.instanceColorNode=o}const a=s.mul(ni).xyz;if(ni.assign(a),e.hasGeometryAttribute("normal")){const l=BH(us,s);us.assign(l)}this.instanceColorNode!==null&&Em("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMatrix.usage!==uu&&this.buffer!==null&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version),this.instanceColor&&this.instanceColor.usage!==uu&&this.bufferColor!==null&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)}}class U6 extends I6{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:i,instanceColor:r}=e;super(t,i,r),this.instancedMesh=e}}const F6=oe(U6);class O6 extends tt{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=Fx:this.batchingIdNode=L6);const i=me(([m])=>{const _=hd(Vr(this.batchMesh._indirectTexture),0),g=on(m).modInt(on(_)),p=on(m).div(on(_));return Vr(this.batchMesh._indirectTexture,qs(g,p)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(on(this.batchingIdNode)),r=this.batchMesh._matricesTexture,s=hd(Vr(r),0),o=te(i).mul(4).toInt().toVar(),a=o.modInt(s),l=o.div(on(s)),u=ju(Vr(r,qs(a,l)),Vr(r,qs(a.add(1),l)),Vr(r,qs(a.add(2),l)),Vr(r,qs(a.add(3),l))),c=this.batchMesh._colorsTexture;if(c!==null){const _=me(([g])=>{const p=hd(Vr(c),0).x,v=g,y=v.modInt(p),x=v.div(p);return Vr(c,qs(y,x)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(i);Em("vec3","vBatchColor").assign(_)}const h=vi(u);ni.assign(u.mul(ni));const d=us.div(ne(h[0].dot(h[0]),h[1].dot(h[1]),h[2].dot(h[2]))),f=h.mul(d).xyz;us.assign(f),e.hasGeometryAttribute("tangent")&&Ix.mulAssign(h)}}const B6=oe(O6),_R=new WeakMap;class k6 extends tt{static get type(){return"SkinningNode"}constructor(e,t=!1){super("void"),this.skinnedMesh=e,this.useReference=t,this.updateType=at.OBJECT,this.skinIndexNode=eo("skinIndex","uvec4"),this.skinWeightNode=eo("skinWeight","vec4");let i,r,s;t?(i=Dt("bindMatrix","mat4"),r=Dt("bindMatrixInverse","mat4"),s=lR("skeleton.boneMatrices","mat4",e.skeleton.bones.length)):(i=Ze(e.bindMatrix,"mat4"),r=Ze(e.bindMatrixInverse,"mat4"),s=Dx(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)),this.bindMatrixNode=i,this.bindMatrixInverseNode=r,this.boneMatricesNode=s,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=ni){const{skinIndexNode:i,skinWeightNode:r,bindMatrixNode:s,bindMatrixInverseNode:o}=this,a=e.element(i.x),l=e.element(i.y),u=e.element(i.z),c=e.element(i.w),h=s.mul(t),d=yi(a.mul(r.x).mul(h),l.mul(r.y).mul(h),u.mul(r.z).mul(h),c.mul(r.w).mul(h));return o.mul(d).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=us){const{skinIndexNode:i,skinWeightNode:r,bindMatrixNode:s,bindMatrixInverseNode:o}=this,a=e.element(i.x),l=e.element(i.y),u=e.element(i.z),c=e.element(i.w);let h=yi(r.x.mul(a),r.y.mul(l),r.z.mul(u),r.w.mul(c));return h=o.mul(h).mul(s),h.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=lR("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,nR)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||hC(e.object).useVelocity===!0}setup(e){this.needsPreviousBoneMatrices(e)&&nR.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(ni.assign(t),e.hasGeometryAttribute("normal")){const i=this.getSkinnedNormal();us.assign(i),e.hasGeometryAttribute("tangent")&&Ix.assign(i)}}generate(e,t){if(t!=="void")return ni.build(e,t)}update(e){const i=(this.useReference?e.object:this.skinnedMesh).skeleton;_R.get(i)!==e.frameId&&(_R.set(i,e.frameId),this.previousBoneMatricesNode!==null&&i.previousBoneMatrices.set(i.boneMatrices),i.update())}}const z6=n=>pe(new k6(n,!0));class G6 extends tt{static get type(){return"LoopNode"}constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const i={};for(let s=0,o=this.params.length-1;s<o;s++){const a=this.params[s],l=a.isNode!==!0&&a.name||this.getVarName(s),u=a.isNode!==!0&&a.type||"int";i[l]=cd(l,u)}const r=e.addStack();return t.returnsNode=this.params[this.params.length-1](i,r,e),t.stackNode=r,e.removeStack(),t}getNodeType(e){const{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const t=this.getProperties(e),i=this.params,r=t.stackNode;for(let a=0,l=i.length-1;a<l;a++){const u=i[a];let c=null,h=null,d=null,f=null,m=null,_=null;u.isNode?(f="int",d=this.getVarName(a),c="0",h=u.build(e,f),m="<"):(f=u.type||"int",d=u.name||this.getVarName(a),c=u.start,h=u.end,m=u.condition,_=u.update,typeof c=="number"?c=e.generateConst(f,c):c&&c.isNode&&(c=c.build(e,f)),typeof h=="number"?h=e.generateConst(f,h):h&&h.isNode&&(h=h.build(e,f)),c!==void 0&&h===void 0?(c=c+" - 1",h="0",m=">="):h!==void 0&&c===void 0&&(c="0",m="<"),m===void 0&&(Number(c)>Number(h)?m=">=":m="<"));const g={start:c,end:h,condition:m},p=g.start,v=g.end;let y="",x="",T="";_||(f==="int"||f==="uint"?m.includes("<")?_="++":_="--":m.includes("<")?_="+= 1.":_="-= 1."),y+=e.getVar(f,d)+" = "+p,x+=d+" "+m+" "+v,T+=d+" "+_;const S=`for ( ${y}; ${x}; ${T} )`;e.addFlowCode((a===0?`
`:"")+e.tab+S+` {

`).addFlowTab()}const s=r.build(e,"void"),o=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode(`
`+e.tab+s);for(let a=0,l=this.params.length-1;a<l;a++)e.addFlowCode((a===0?"":e.tab)+`}

`).removeFlowTab();return e.addFlowTab(),o}}const Wr=(...n)=>pe(new G6($u(n,"int"))).append(),V6=()=>cd("break").append(),Ox=new WeakMap,nr=new et,vR=me(({bufferMap:n,influence:e,stride:t,width:i,depth:r,offset:s})=>{const o=on(D6).mul(t).add(s),a=o.div(i),l=o.sub(a.mul(i));return Vr(n,qs(l,a)).depth(r).mul(e)});function H6(n){const e=n.morphAttributes.position!==void 0,t=n.morphAttributes.normal!==void 0,i=n.morphAttributes.color!==void 0,r=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,s=r!==void 0?r.length:0;let o=Ox.get(n);if(o===void 0||o.count!==s){let p=function(){_.dispose(),Ox.delete(n),n.removeEventListener("dispose",p)};o!==void 0&&o.texture.dispose();const a=n.morphAttributes.position||[],l=n.morphAttributes.normal||[],u=n.morphAttributes.color||[];let c=0;e===!0&&(c=1),t===!0&&(c=2),i===!0&&(c=3);let h=n.attributes.position.count*c,d=1;const f=4096;h>f&&(d=Math.ceil(h/f),h=f);const m=new Float32Array(h*d*4*s),_=new Ty(m,h,d,s);_.type=cn,_.needsUpdate=!0;const g=c*4;for(let v=0;v<s;v++){const y=a[v],x=l[v],T=u[v],S=h*d*4*v;for(let w=0;w<y.count;w++){const E=w*g;e===!0&&(nr.fromBufferAttribute(y,w),m[S+E+0]=nr.x,m[S+E+1]=nr.y,m[S+E+2]=nr.z,m[S+E+3]=0),t===!0&&(nr.fromBufferAttribute(x,w),m[S+E+4]=nr.x,m[S+E+5]=nr.y,m[S+E+6]=nr.z,m[S+E+7]=0),i===!0&&(nr.fromBufferAttribute(T,w),m[S+E+8]=nr.x,m[S+E+9]=nr.y,m[S+E+10]=nr.z,m[S+E+11]=T.itemSize===4?nr.w:1)}}o={count:s,texture:_,stride:c,size:new ce(h,d)},Ox.set(n,o),n.addEventListener("dispose",p)}return o}class W6 extends tt{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=Ze(1),this.updateType=at.OBJECT}setup(e){const{geometry:t}=e,i=t.morphAttributes.position!==void 0,r=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,s=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,o=s!==void 0?s.length:0,{texture:a,stride:l,size:u}=H6(t);i===!0&&ni.mulAssign(this.morphBaseInfluence),r===!0&&us.mulAssign(this.morphBaseInfluence);const c=on(u.width);Wr(o,({i:h})=>{const d=te(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?d.assign(Vr(this.mesh.morphTexture,qs(on(h).add(1),on(Fx))).r):d.assign(Dt("morphTargetInfluences","float").element(h).toVar()),i===!0&&ni.addAssign(vR({bufferMap:a,influence:d,stride:l,width:c,depth:h,offset:on(0)})),r===!0&&us.addAssign(vR({bufferMap:a,influence:d,stride:l,width:c,depth:h,offset:on(1)}))})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,i)=>t+i,0)}}const $6=oe(W6);class Yu extends tt{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class j6 extends Yu{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class X6 extends YC{static get type(){return"LightingContextNode"}constructor(e,t=null,i=null,r=null){super(e),this.lightingModel=t,this.backdropNode=i,this.backdropAlphaNode=r,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,i=ne().toVar("directDiffuse"),r=ne().toVar("directSpecular"),s=ne().toVar("indirectDiffuse"),o=ne().toVar("indirectSpecular"),a={directDiffuse:i,directSpecular:r,indirectDiffuse:s,indirectSpecular:o};return{radiance:ne().toVar("radiance"),irradiance:ne().toVar("irradiance"),iblIrradiance:ne().toVar("iblIrradiance"),ambientOcclusion:te(1).toVar("ambientOcclusion"),reflectedLight:a,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const q6=oe(X6);class Y6 extends Yu{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}let vd,yd;class Tn extends tt{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===Tn.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=at.NONE;return(this.scope===Tn.SIZE||this.scope===Tn.VIEWPORT)&&(e=at.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===Tn.VIEWPORT?t!==null?yd.copy(t.viewport):(e.getViewport(yd),yd.multiplyScalar(e.getPixelRatio())):t!==null?(vd.width=t.width,vd.height=t.height):e.getDrawingBufferSize(vd)}setup(){const e=this.scope;let t=null;return e===Tn.SIZE?t=Ze(vd||(vd=new ce)):e===Tn.VIEWPORT?t=Ze(yd||(yd=new et)):t=ye(Vm.div(Bx)),t}generate(e){if(this.scope===Tn.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const i=e.getNodeProperties(Bx).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${i}.y - ${t}.y )`}return t}return super.generate(e)}}Tn.COORDINATE="coordinate",Tn.VIEWPORT="viewport",Tn.SIZE="size",Tn.UV="uv";const xd=ve(Tn,Tn.UV),Bx=ve(Tn,Tn.SIZE),Vm=ve(Tn,Tn.COORDINATE),yR=ve(Tn,Tn.VIEWPORT);yR.zw,yR.xy;const Sd=new ce;class xR extends dd{static get type(){return"ViewportTextureNode"}constructor(e=xd,t=null,i=null){i===null&&(i=new hU,i.minFilter=ci),super(i,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=at.FRAME}updateBefore(e){const t=e.renderer;t.getDrawingBufferSize(Sd);const i=this.value;(i.image.width!==Sd.width||i.image.height!==Sd.height)&&(i.image.width=Sd.width,i.image.height=Sd.height,i.needsUpdate=!0);const r=i.generateMipmaps;i.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(i),i.generateMipmaps=r}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const SR=oe(xR,null,null,{generateMipmaps:!0});let kx=null;class K6 extends xR{static get type(){return"ViewportDepthTextureNode"}constructor(e=xd,t=null){kx===null&&(kx=new Ho),super(e,t,kx)}}const Q6=oe(K6);class Ui extends tt{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===Ui.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,i=this.valueNode;let r=null;if(t===Ui.DEPTH_BASE)i!==null&&(r=wR().assign(i));else if(t===Ui.DEPTH)e.isPerspectiveCamera?r=Z6(xn.z,Ya,Ka):r=Td(xn.z,Ya,Ka);else if(t===Ui.LINEAR_DEPTH)if(i!==null)if(e.isPerspectiveCamera){const s=TR(i,Ya,Ka);r=Td(s,Ya,Ka)}else r=i;else r=Td(xn.z,Ya,Ka);return r}}Ui.DEPTH_BASE="depthBase",Ui.DEPTH="depth",Ui.LINEAR_DEPTH="linearDepth";const Td=(n,e,t)=>n.add(e).div(e.sub(t)),Z6=(n,e,t)=>e.add(n).mul(t).div(t.sub(e).mul(n)),TR=(n,e,t)=>e.mul(t).div(t.sub(e).mul(n).sub(t)),bR=(n,e,t)=>{e=e.max(1e-6).toVar();const i=Qs(n.negate().div(e)),r=Qs(t.div(e));return i.div(r)},wR=oe(Ui,Ui.DEPTH_BASE),MR=ve(Ui,Ui.DEPTH),J6=oe(Ui,Ui.LINEAR_DEPTH);Q6(),MR.assign=n=>wR(n);class e8 extends tt{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const t8=oe(e8);class yr extends tt{static get type(){return"ClippingNode"}constructor(e=yr.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:i,unionPlanes:r}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===yr.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(i,r):this.scope===yr.HARDWARE?this.setupHardwareClipping(r,e):this.setupDefault(i,r)}setupAlphaToCoverage(e,t){return me(()=>{const i=te().toVar("distanceToPlane"),r=te().toVar("distanceToGradient"),s=te(1).toVar("clipOpacity"),o=t.length;if(this.hardwareClipping===!1&&o>0){const l=Qo(t);Wr(o,({i:u})=>{const c=l.element(u);i.assign(xn.dot(c.xyz).negate().add(c.w)),r.assign(i.fwidth().div(2)),s.mulAssign(qa(r.negate(),r,i))})}const a=e.length;if(a>0){const l=Qo(e),u=te(1).toVar("intersectionClipOpacity");Wr(a,({i:c})=>{const h=l.element(c);i.assign(xn.dot(h.xyz).negate().add(h.w)),r.assign(i.fwidth().div(2)),u.mulAssign(qa(r.negate(),r,i).oneMinus())}),s.mulAssign(u.oneMinus())}wt.a.mulAssign(s),wt.a.equal(0).discard()})()}setupDefault(e,t){return me(()=>{const i=t.length;if(this.hardwareClipping===!1&&i>0){const s=Qo(t);Wr(i,({i:o})=>{const a=s.element(o);xn.dot(a.xyz).greaterThan(a.w).discard()})}const r=e.length;if(r>0){const s=Qo(e),o=MC(!0).toVar("clipped");Wr(r,({i:a})=>{const l=s.element(a);o.assign(xn.dot(l.xyz).greaterThan(l.w).and(o))}),o.discard()}})()}setupHardwareClipping(e,t){const i=e.length;return t.enableHardwareClipping(i),me(()=>{const r=Qo(e),s=t8(t.getClipDistance());Wr(i,({i:o})=>{const a=r.element(o),l=xn.dot(a.xyz).sub(a.w).negate();s.element(o).assign(l)})})()}}yr.ALPHA_TO_COVERAGE="alphaToCoverage",yr.DEFAULT="default",yr.HARDWARE="hardware";const n8=()=>pe(new yr),i8=()=>pe(new yr(yr.ALPHA_TO_COVERAGE)),r8=()=>pe(new yr(yr.HARDWARE)),s8=.05,ER=me(([n])=>qo(ht(1e4,Gr(ht(17,n.x).add(ht(.1,n.y)))).mul(yi(.1,vr(Gr(ht(13,n.y).add(n.x))))))),AR=me(([n])=>ER(ye(ER(n.xy),n.z))),o8=me(([n])=>{const e=Li(Ko(VC(n.xyz)),Ko(HC(n.xyz))),t=te(1).div(te(s8).mul(e)).toVar("pixScale"),i=ye(od(Xa(Qs(t))),od(bx(Qs(t)))),r=ye(AR(Xa(i.x.mul(n.xyz))),AR(Xa(i.y.mul(n.xyz)))),s=qo(Qs(t)),o=yi(ht(s.oneMinus(),r.x),ht(s,r.y)),a=ld(s,s.oneMinus()),l=ne(o.mul(o).div(ht(2,a).mul(Di(1,a))),o.sub(ht(.5,a)).div(Di(1,a)),Di(1,Di(1,o).mul(Di(1,o)).div(ht(2,a).mul(Di(1,a))))),u=o.lessThan(a.oneMinus()).select(o.lessThan(a).select(l.x,l.y),l.z);return Zs(u,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class bn extends Jn{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.shadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+lC(this)}build(e){this.setup(e)}setupObserver(e){return new bV(e)}setup(e){e.context.setupNormal=()=>this.setupNormal(e),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,i=t.getRenderTarget();e.addStack();const r=this.vertexNode||this.setupVertex(e);e.stack.outputNode=r,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let s;const o=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(i!==null?i.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const a=this.setupLighting(e);o!==null&&e.stack.add(o);const l=Qe(a,wt.a).max(0);if(s=this.setupOutput(e,l),Pm.assign(s),this.outputNode!==null&&(s=this.outputNode),i!==null){const u=t.getMRT(),c=this.mrtNode;u!==null?(s=u,c!==null&&(s=u.merge(c))):c!==null&&(s=c)}}else{let a=this.fragmentNode;a.isOutputStructNode!==!0&&(a=Qe(a)),s=this.setupOutput(e,a)}e.stack.outputNode=s,e.addFlow("fragment",e.removeStack()),e.monitor=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:i}=e.clippingContext;let r=null;if(t.length>0||i.length>0){const s=e.renderer.samples;this.alphaToCoverage&&s>1?r=i8():e.stack.add(n8())}return r}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.add(r8()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:i}=e;let r=this.depthNode;if(r===null){const s=t.getMRT();s&&s.has("depth")?r=s.get("depth"):t.logarithmicDepthBuffer===!0&&(i.isPerspectiveCamera?r=bR(xn.z,Ya,Ka):r=Td(xn.z,Ya,Ka))}r!==null&&MR.assign(r).append()}setupPositionView(){return Rx.mul(ni).xyz}setupModelViewProjection(){return Cx.mul(xn)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),gR}setupPosition(e){const{object:t,geometry:i}=e;if((i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color)&&$6(t).append(),t.isSkinnedMesh===!0&&z6(t).append(),this.displacementMap){const r=Zo("displacementMap","texture"),s=Zo("displacementScale","float"),o=Zo("displacementBias","float");ni.addAssign(us.normalize().mul(r.x.mul(s).add(o)))}return t.isBatchedMesh&&B6(t).append(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&F6(t).append(),this.positionNode!==null&&ni.assign(this.positionNode.context({isPositionNodeInput:!0})),ni}setupDiffuseColor({object:e,geometry:t}){let i=this.colorNode?Qe(this.colorNode):i6;this.vertexColors===!0&&t.hasAttribute("color")&&(i=Qe(i.xyz.mul(eo("color","vec3")),i.a)),e.instanceColor&&(i=Em("vec3","vInstanceColor").mul(i)),e.isBatchedMesh&&e._colorsTexture&&(i=Em("vec3","vBatchColor").mul(i)),wt.assign(i);const r=this.opacityNode?te(this.opacityNode):fR;if(wt.a.assign(wt.a.mul(r)),this.alphaTestNode!==null||this.alphaTest>0){const s=this.alphaTestNode!==null?te(this.alphaTestNode):n6;wt.a.lessThanEqual(s).discard()}this.alphaHash===!0&&wt.a.lessThan(o8(ni)).discard(),this.transparent===!1&&this.blending===dr&&this.alphaToCoverage===!1&&wt.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?ne(0):wt.rgb}setupNormal(){return this.normalNode?ne(this.normalNode):c6}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?Zo("envMap","cubeTexture"):Zo("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new Y6(mR)),t}setupLights(e){const t=[],i=this.setupEnvironment(e);i&&i.isLightingNode&&t.push(i);const r=this.setupLightMap(e);if(r&&r.isLightingNode&&t.push(r),this.aoNode!==null||e.material.aoMap){const o=this.aoNode!==null?this.aoNode:P6;t.push(new j6(o))}let s=this.lightsNode||e.lightsNode;return t.length>0&&(s=e.renderer.lighting.createNode([...s.getLights(),...t])),s}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:i,backdropAlphaNode:r,emissiveNode:s}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let l=this.setupOutgoingLight(e);if(a&&a.getScope().hasLights){const u=this.setupLightingModel(e);l=q6(a,u,i,r)}else i!==null&&(l=ne(r!==null?Gt(l,i,r):i));return(s&&s.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(RC.assign(ne(s||s6)),l=l.add(RC)),l}setupOutput(e,t){if(this.fog===!0){const i=e.fogNode;i&&(Pm.assign(t),t=Qe(i))}return t}setDefaultValues(e){for(const i in e){const r=e[i];this[i]===void 0&&(this[i]=r,r&&r.clone&&(this[i]=r.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const i in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,i)===void 0&&t[i].get!==void 0&&Object.defineProperty(this.constructor.prototype,i,t[i])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const i=Jn.prototype.toJSON.call(this,e),r=ym(this);i.inputNodes={};for(const{property:o,childNode:a}of r)i.inputNodes[o]=a.toJSON(e).uuid;function s(o){const a=[];for(const l in o){const u=o[l];delete u.metadata,a.push(u)}return a}if(t){const o=s(e.textures),a=s(e.images),l=s(e.nodes);o.length>0&&(i.textures=o),a.length>0&&(i.images=a),l.length>0&&(i.nodes=l)}return i}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.shadowPositionNode=e.shadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}const a8=new Op;class l8 extends bn{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(a8),this.setValues(e)}}const u8=new FU;class c8 extends bn{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(u8),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?te(this.offsetNode):R6,t=this.dashScaleNode?te(this.dashScaleNode):E6,i=this.dashSizeNode?te(this.dashSizeNode):A6,r=this.gapSizeNode?te(this.gapSizeNode):C6;xx.assign(i),DC.assign(r);const s=Js(eo("lineDistance").mul(t));(e?s.add(e):s).mod(xx.add(DC)).greaterThan(xx).discard()}}const h8=n=>pe(n).mul(.5).add(.5),d8=new DU;class f8 extends bn{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(d8),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?te(this.opacityNode):fR;wt.assign(Qe(h8(Sn),e))}}class p8 extends Rn{static get type(){return"EquirectUVNode"}constructor(e=iR){super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,t=e.z.atan(e.x).mul(1/(Math.PI*2)).add(.5),i=e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return ye(t,i)}}const CR=oe(p8);class RR extends SE{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const i=t.minFilter,r=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const s=new Fa(5,5,5),o=CR(iR),a=new bn;a.colorNode=yt(t,o,0),a.side=$t,a.blending=Ei;const l=new On(s,a),u=new Hy;u.add(l),t.minFilter===ci&&(t.minFilter=mn);const c=new xE(1,10,this),h=e.getMRT();return e.setMRT(null),c.update(e,u),e.setMRT(h),t.minFilter=i,t.currentGenerateMipmaps=r,l.geometry.dispose(),l.material.dispose(),this}}const bd=new WeakMap;class m8 extends Rn{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=md();const t=new Pp;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=at.RENDER}updateBefore(e){const{renderer:t,material:i}=e,r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const s=r.isTextureNode?r.value:i[r.property];if(s&&s.isTexture){const o=s.mapping;if(o===No||o===Po){if(bd.has(s)){const a=bd.get(s);PR(a,s.mapping),this._cubeTexture=a}else{const a=s.image;if(g8(a)){const l=new RR(a.height);l.fromEquirectangularTexture(t,s),PR(l.texture,s.mapping),this._cubeTexture=l.texture,bd.set(s,l.texture),s.addEventListener("dispose",NR)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function g8(n){return n==null?!1:n.height>0}function NR(n){const e=n.target;e.removeEventListener("dispose",NR);const t=bd.get(e);t!==void 0&&(bd.delete(e),t.dispose())}function PR(n,e){e===No?n.mapping=fr:e===Po&&(n.mapping=pr)}const DR=oe(m8);class zx extends Yu{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=DR(this.envNode)}}class _8 extends Yu{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=te(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class Hm{start(){}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class LR extends Hm{constructor(){super()}indirect(e,t,i){const r=e.ambientOcclusion,s=e.reflectedLight,o=i.context.irradianceLightMap;s.indirectDiffuse.assign(Qe(0)),o?s.indirectDiffuse.addAssign(o):s.indirectDiffuse.addAssign(Qe(1,1,1,0)),s.indirectDiffuse.mulAssign(r),s.indirectDiffuse.mulAssign(wt.rgb)}finish(e,t,i){const r=i.material,s=e.outgoingLight,o=i.context.environment;if(o)switch(r.combine){case hh:s.rgb.assign(Gt(s.rgb,s.rgb.mul(o.rgb),Gm.mul(Ux)));break;case BM:s.rgb.assign(Gt(s.rgb,o.rgb,Gm.mul(Ux)));break;case kM:s.rgb.addAssign(o.rgb.mul(Gm.mul(Ux)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",r.combine);break}}}const v8=new Ch;class y8 extends bn{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(v8),this.setValues(e)}setupNormal(){return Hr}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new zx(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new _8(mR)),t}setupOutgoingLight(){return wt.rgb}setupLightingModel(){return new LR}}const wd=me(({f0:n,f90:e,dotVH:t})=>{const i=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return n.mul(i.oneMinus()).add(e.mul(i))}),Ku=me(n=>n.diffuseColor.mul(1/Math.PI)),x8=()=>te(.25),S8=me(({dotNH:n})=>yx.mul(te(.5)).add(1).mul(te(1/Math.PI)).mul(n.pow(yx))),T8=me(({lightDirection:n})=>{const e=n.add(tn).normalize(),t=Sn.dot(e).clamp(),i=tn.dot(e).clamp(),r=wd({f0:tr,f90:1,dotVH:i}),s=x8(),o=S8({dotNH:t});return r.mul(s).mul(o)});class IR extends LR{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:i}){const s=Sn.dot(e).clamp().mul(t);i.directDiffuse.addAssign(s.mul(Ku({diffuseColor:wt.rgb}))),this.specular===!0&&i.directSpecular.addAssign(s.mul(T8({lightDirection:e})).mul(Gm))}indirect({ambientOcclusion:e,irradiance:t,reflectedLight:i}){i.indirectDiffuse.addAssign(t.mul(Ku({diffuseColor:wt}))),i.indirectDiffuse.mulAssign(e)}}const b8=new PE;class w8 extends bn{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(b8),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new zx(t):null}setupLightingModel(){return new IR(!1)}}const M8=new NU;class E8 extends bn{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(M8),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new zx(t):null}setupLightingModel(){return new IR}setupVariants(){const e=(this.shininessNode?te(this.shininessNode):r6).max(1e-4);yx.assign(e);const t=this.specularNode||o6;tr.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const A8=me(n=>{if(n.geometry.hasAttribute("normal")===!1)return te(0);const e=Hr.dFdx().abs().max(Hr.dFdy().abs());return e.x.max(e.y).max(e.z)}),UR=me(n=>{const{roughness:e}=n,t=A8();let i=e.max(.0525);return i=i.add(t),i=i.min(1),i}),C8=me(({alpha:n,dotNL:e,dotNV:t})=>{const i=n.pow2(),r=e.mul(i.add(i.oneMinus().mul(t.pow2())).sqrt()),s=t.mul(i.add(i.oneMinus().mul(e.pow2())).sqrt());return Ks(.5,r.add(s).max(A5))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),R8=me(({alphaT:n,alphaB:e,dotTV:t,dotBV:i,dotTL:r,dotBL:s,dotNV:o,dotNL:a})=>{const l=a.mul(ne(n.mul(t),e.mul(i),o).length()),u=o.mul(ne(n.mul(r),e.mul(s),a).length());return Ks(.5,l.add(u)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),N8=me(({alpha:n,dotNH:e})=>{const t=n.pow2(),i=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(i.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),P8=te(1/Math.PI),D8=me(({alphaT:n,alphaB:e,dotNH:t,dotTH:i,dotBH:r})=>{const s=n.mul(e),o=ne(e.mul(i),n.mul(r),s.mul(t)),a=o.dot(o),l=s.div(a);return P8.mul(s.mul(l.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),FR=me(n=>{const{lightDirection:e,f0:t,f90:i,roughness:r,f:s,USE_IRIDESCENCE:o,USE_ANISOTROPY:a}=n,l=n.normalView||Sn,u=r.pow2(),c=e.add(tn).normalize(),h=l.dot(e).clamp(),d=l.dot(tn).clamp(),f=l.dot(c).clamp(),m=tn.dot(c).clamp();let _=wd({f0:t,f90:i,dotVH:m}),g,p;if(bC(o)&&(_=_x.mix(_,s)),bC(a)){const v=Rm.dot(e),y=Rm.dot(tn),x=Rm.dot(c),T=qu.dot(e),S=qu.dot(tn),w=qu.dot(c);g=R8({alphaT:vx,alphaB:u,dotTV:y,dotBV:S,dotTL:v,dotBL:T,dotNV:d,dotNL:h}),p=D8({alphaT:vx,alphaB:u,dotNH:f,dotTH:x,dotBH:w})}else g=C8({alpha:u,dotNL:h,dotNV:d}),p=N8({alpha:u,dotNH:f});return _.mul(g).mul(p)}),OR=me(({roughness:n,dotNV:e})=>{const t=Qe(-1,-.0275,-.572,.022),i=Qe(1,.0425,1.04,-.04),r=n.mul(t).add(i),s=r.x.mul(r.x).min(e.mul(-9.28).exp2()).mul(r.x).add(r.y);return ye(-1.04,1.04).mul(s).add(r.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),BR=me(n=>{const{dotNV:e,specularColor:t,specularF90:i,roughness:r}=n,s=OR({dotNV:e,roughness:r});return t.mul(s.x).add(i.mul(s.y))}),L8=me(({f:n,f90:e,dotVH:t})=>{const i=t.oneMinus().saturate(),r=i.mul(i),s=i.mul(r,r).clamp(0,.9999);return n.sub(ne(e).mul(s)).div(s.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),I8=me(({roughness:n,dotNH:e})=>{const t=n.pow2(),i=te(1).div(t),s=e.pow2().oneMinus().max(.0078125);return te(2).add(i).mul(s.pow(i.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),U8=me(({dotNV:n,dotNL:e})=>te(1).div(te(4).mul(e.add(n).sub(e.mul(n))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),F8=me(({lightDirection:n})=>{const e=n.add(tn).normalize(),t=Sn.dot(n).clamp(),i=Sn.dot(tn).clamp(),r=Sn.dot(e).clamp(),s=I8({roughness:gx,dotNH:r}),o=U8({dotNV:i,dotNL:t});return Xu.mul(s).mul(o)}),O8=me(({N:n,V:e,roughness:t})=>{const s=.0078125,o=n.dot(e).saturate(),a=ye(t,o.oneMinus().sqrt());return a.assign(a.mul(.984375).add(s)),a}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),B8=me(({f:n})=>{const e=n.length();return Li(e.mul(e).add(n.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),Wm=me(({v1:n,v2:e})=>{const t=n.dot(e),i=t.abs().toVar(),r=i.mul(.0145206).add(.4965155).mul(i).add(.8543985).toVar(),s=i.add(4.1616724).mul(i).add(3.417594).toVar(),o=r.div(s),a=t.greaterThan(0).select(o,Li(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(o));return n.cross(e).mul(a)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),kR=me(({N:n,V:e,P:t,mInv:i,p0:r,p1:s,p2:o,p3:a})=>{const l=s.sub(r).toVar(),u=a.sub(r).toVar(),c=l.cross(u),h=ne().toVar();return yn(c.dot(t.sub(r)).greaterThanEqual(0),()=>{const d=e.sub(n.mul(e.dot(n))).normalize(),f=n.cross(d).negate(),m=i.mul(vi(d,f,n).transpose()).toVar(),_=m.mul(r.sub(t)).normalize().toVar(),g=m.mul(s.sub(t)).normalize().toVar(),p=m.mul(o.sub(t)).normalize().toVar(),v=m.mul(a.sub(t)).normalize().toVar(),y=ne(0).toVar();y.addAssign(Wm({v1:_,v2:g})),y.addAssign(Wm({v1:g,v2:p})),y.addAssign(Wm({v1:p,v2:v})),y.addAssign(Wm({v1:v,v2:_})),h.assign(ne(B8({f:y})))}),h}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),$m=1/6,zR=n=>ht($m,ht(n,ht(n,n.negate().add(3)).sub(3)).add(1)),Gx=n=>ht($m,ht(n,ht(n,ht(3,n).sub(6))).add(4)),GR=n=>ht($m,ht(n,ht(n,ht(-3,n).add(3)).add(3)).add(1)),Vx=n=>ht($m,Im(n,3)),VR=n=>zR(n).add(Gx(n)),HR=n=>GR(n).add(Vx(n)),WR=n=>yi(-1,Gx(n).div(zR(n).add(Gx(n)))),$R=n=>yi(1,Vx(n).div(GR(n).add(Vx(n)))),jR=(n,e,t)=>{const i=n.uvNode,r=ht(i,e.zw).add(.5),s=Xa(r),o=qo(r),a=VR(o.x),l=HR(o.x),u=WR(o.x),c=$R(o.x),h=WR(o.y),d=$R(o.y),f=ye(s.x.add(u),s.y.add(h)).sub(.5).mul(e.xy),m=ye(s.x.add(c),s.y.add(h)).sub(.5).mul(e.xy),_=ye(s.x.add(u),s.y.add(d)).sub(.5).mul(e.xy),g=ye(s.x.add(c),s.y.add(d)).sub(.5).mul(e.xy),p=VR(o.y).mul(yi(a.mul(n.sample(f).level(t)),l.mul(n.sample(m).level(t)))),v=HR(o.y).mul(yi(a.mul(n.sample(_).level(t)),l.mul(n.sample(g).level(t))));return p.add(v)},k8=me(([n,e=te(3)])=>{const t=ye(n.size(on(e))),i=ye(n.size(on(e.add(1)))),r=Ks(1,t),s=Ks(1,i),o=jR(n,Qe(r,t),Xa(e)),a=jR(n,Qe(s,i),bx(e));return qo(e).mix(o,a)}),XR=me(([n,e,t,i,r])=>{const s=ne(qC(e.negate(),ad(n),Ks(1,i))),o=ne(Ko(r[0].xyz),Ko(r[1].xyz),Ko(r[2].xyz));return ad(s).mul(t.mul(o))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),z8=me(([n,e])=>n.mul(Zs(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),G8=SR(),V8=SR(),qR=me(([n,e,t],{material:i})=>{const s=(i.side===$t?G8:V8).sample(n),o=Qs(Bx.x).mul(z8(e,t));return k8(s,o)}),YR=me(([n,e,t])=>(yn(t.notEqual(0),()=>{const i=zC(e).negate().div(t);return kC(i.negate().mul(n))}),ne(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),H8=me(([n,e,t,i,r,s,o,a,l,u,c,h,d,f,m])=>{let _,g;if(m){_=Qe().toVar(),g=ne().toVar();const T=c.sub(1).mul(m.mul(.025)),S=ne(c.sub(T),c,c.add(T));Wr({start:0,end:3},({i:w})=>{const E=S.element(w),M=XR(n,e,h,E,a),b=o.add(M),R=u.mul(l.mul(Qe(b,1))),I=ye(R.xy.div(R.w)).toVar();I.addAssign(1),I.divAssign(2),I.assign(ye(I.x,I.y.oneMinus()));const B=qR(I,t,E);_.element(w).assign(B.element(w)),_.a.addAssign(B.a),g.element(w).assign(i.element(w).mul(YR(Ko(M),d,f).element(w)))}),_.a.divAssign(3)}else{const T=XR(n,e,h,c,a),S=o.add(T),w=u.mul(l.mul(Qe(S,1))),E=ye(w.xy.div(w.w)).toVar();E.addAssign(1),E.divAssign(2),E.assign(ye(E.x,E.y.oneMinus())),_=qR(E,t,c),g=i.mul(YR(Ko(T),d,f))}const p=g.rgb.mul(_.rgb),v=n.dot(e).clamp(),y=ne(BR({dotNV:v,specularColor:r,specularF90:s,roughness:t})),x=g.r.add(g.g,g.b).div(3);return Qe(y.oneMinus().mul(p),_.a.oneMinus().mul(x).oneMinus())}),W8=vi(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),$8=n=>{const e=n.sqrt();return ne(1).add(e).div(ne(1).sub(e))},KR=(n,e)=>n.sub(e).div(n.add(e)).pow2(),j8=(n,e)=>{const t=n.mul(2*Math.PI*1e-9),i=ne(54856e-17,44201e-17,52481e-17),r=ne(1681e3,1795300,2208400),s=ne(43278e5,93046e5,66121e5),o=te(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let a=i.mul(s.mul(2*Math.PI).sqrt()).mul(r.mul(t).add(e).cos()).mul(t.pow2().negate().mul(s).exp());return a=ne(a.x.add(o),a.y,a.z).div(10685e-11),W8.mul(a)},X8=me(({outsideIOR:n,eta2:e,cosTheta1:t,thinFilmThickness:i,baseF0:r})=>{const s=Gt(n,e,qa(0,.03,i)),a=n.div(s).pow2().mul(t.pow2().oneMinus()).oneMinus();yn(a.lessThan(0),()=>ne(1));const l=a.sqrt(),u=KR(s,n),c=wd({f0:u,f90:1,dotVH:t}),h=c.oneMinus(),d=s.lessThan(n).select(Math.PI,0),f=te(Math.PI).sub(d),m=$8(r.clamp(0,.9999)),_=KR(m,s.toVec3()),g=wd({f0:_,f90:1,dotVH:l}),p=ne(m.x.lessThan(s).select(Math.PI,0),m.y.lessThan(s).select(Math.PI,0),m.z.lessThan(s).select(Math.PI,0)),v=s.mul(i,l,2),y=ne(f).add(p),x=c.mul(g).clamp(1e-5,.9999),T=x.sqrt(),S=h.pow2().mul(g).div(ne(1).sub(x)),E=c.add(S).toVar(),M=S.sub(h).toVar();return Wr({start:1,end:2,condition:"<=",name:"m"},({m:b})=>{M.mulAssign(T);const R=j8(te(b).mul(v),te(b).mul(y)).mul(2);E.addAssign(M.mul(R))}),E.max(ne(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),q8=me(({normal:n,viewDir:e,roughness:t})=>{const i=n.dot(e).saturate(),r=t.pow2(),s=Ii(t.lessThan(.25),te(-339.2).mul(r).add(te(161.4).mul(t)).sub(25.9),te(-8.48).mul(r).add(te(14.3).mul(t)).sub(9.95)),o=Ii(t.lessThan(.25),te(44).mul(r).sub(te(23.7).mul(t)).add(3.26),te(1.97).mul(r).sub(te(3.27).mul(t)).add(.72));return Ii(t.lessThan(.25),0,te(.1).mul(t).sub(.025)).add(s.mul(i).add(o).exp()).mul(1/Math.PI).saturate()}),Hx=ne(.04),Wx=te(1);class QR extends Hm{constructor(e=!1,t=!1,i=!1,r=!1,s=!1,o=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=i,this.anisotropy=r,this.transmission=s,this.dispersion=o,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=ne().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=ne().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=ne().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=ne().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=ne().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=Sn.dot(tn).clamp();this.iridescenceFresnel=X8({outsideIOR:te(1),eta2:NC,cosTheta1:t,thinFilmThickness:PC,baseF0:tr}),this.iridescenceF0=L8({f:this.iridescenceFresnel,f90:1,dotVH:t})}if(this.transmission===!0){const t=fd,i=DH.sub(fd).normalize(),r=Px;e.backdrop=H8(r,i,Ys,wt,tr,Nm,t,Qa,to,Cx,Dm,LC,UC,IC,this.dispersion?FC:null),e.backdropAlpha=Sx,wt.a.mulAssign(Gt(1,e.backdrop.a,Sx))}}computeMultiscattering(e,t,i){const r=Sn.dot(tn).clamp(),s=OR({roughness:Ys,dotNV:r}),a=(this.iridescenceF0?_x.mix(tr,this.iridescenceF0):tr).mul(s.x).add(i.mul(s.y)),u=s.x.add(s.y).oneMinus(),c=tr.add(tr.oneMinus().mul(.047619)),h=a.mul(c).div(u.mul(c).oneMinus());e.addAssign(a),t.addAssign(h.mul(u))}direct({lightDirection:e,lightColor:t,reflectedLight:i}){const s=Sn.dot(e).clamp().mul(t);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(s.mul(F8({lightDirection:e}))),this.clearcoat===!0){const a=pd.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(a.mul(FR({lightDirection:e,f0:Hx,f90:Wx,roughness:Cm,normalView:pd})))}i.directDiffuse.addAssign(s.mul(Ku({diffuseColor:wt.rgb}))),i.directSpecular.addAssign(s.mul(FR({lightDirection:e,f0:tr,f90:1,roughness:Ys,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:i,halfHeight:r,reflectedLight:s,ltc_1:o,ltc_2:a}){const l=t.add(i).sub(r),u=t.sub(i).sub(r),c=t.sub(i).add(r),h=t.add(i).add(r),d=Sn,f=tn,m=xn.toVar(),_=O8({N:d,V:f,roughness:Ys}),g=o.sample(_).toVar(),p=a.sample(_).toVar(),v=vi(ne(g.x,0,g.y),ne(0,1,0),ne(g.z,0,g.w)).toVar(),y=tr.mul(p.x).add(tr.oneMinus().mul(p.y)).toVar();s.directSpecular.addAssign(e.mul(y).mul(kR({N:d,V:f,P:m,mInv:v,p0:l,p1:u,p2:c,p3:h}))),s.directDiffuse.addAssign(e.mul(wt).mul(kR({N:d,V:f,P:m,mInv:vi(1,0,0,0,1,0,0,0,1),p0:l,p1:u,p2:c,p3:h})))}indirect(e,t,i){this.indirectDiffuse(e,t,i),this.indirectSpecular(e,t,i),this.ambientOcclusion(e,t,i)}indirectDiffuse({irradiance:e,reflectedLight:t}){t.indirectDiffuse.addAssign(e.mul(Ku({diffuseColor:wt})))}indirectSpecular({radiance:e,iblIrradiance:t,reflectedLight:i}){if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(t.mul(Xu,q8({normal:Sn,viewDir:tn,roughness:gx}))),this.clearcoat===!0){const u=pd.dot(tn).clamp(),c=BR({dotNV:u,specularColor:Hx,specularF90:Wx,roughness:Cm});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(c))}const r=ne().toVar("singleScattering"),s=ne().toVar("multiScattering"),o=t.mul(1/Math.PI);this.computeMultiscattering(r,s,Nm);const a=r.add(s),l=wt.mul(a.r.max(a.g).max(a.b).oneMinus());i.indirectSpecular.addAssign(e.mul(r)),i.indirectSpecular.addAssign(s.mul(o)),i.indirectDiffuse.addAssign(l.mul(o))}ambientOcclusion({ambientOcclusion:e,reflectedLight:t}){const r=Sn.dot(tn).clamp().add(e),s=Ys.mul(-16).oneMinus().negate().exp2(),o=e.sub(r.pow(s).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(e),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(e),t.indirectDiffuse.mulAssign(e),t.indirectSpecular.mulAssign(o)}finish(e){const{outgoingLight:t}=e;if(this.clearcoat===!0){const i=pd.dot(tn).clamp(),r=wd({dotVH:i,f0:Hx,f90:Wx}),s=t.mul(mx.mul(r).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(mx));t.assign(s)}if(this.sheen===!0){const i=Xu.r.max(Xu.g).max(Xu.b).mul(.157).oneMinus(),r=t.mul(i).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(r)}}}const ZR=te(1),$x=te(-2),jm=te(.8),jx=te(-1),Xm=te(.4),Xx=te(2),qm=te(.305),qx=te(3),JR=te(.21),Y8=te(4),eN=te(4),K8=te(16),Q8=me(([n])=>{const e=ne(vr(n)).toVar(),t=te(-1).toVar();return yn(e.x.greaterThan(e.z),()=>{yn(e.x.greaterThan(e.y),()=>{t.assign(Ii(n.x.greaterThan(0),0,3))}).Else(()=>{t.assign(Ii(n.y.greaterThan(0),1,4))})}).Else(()=>{yn(e.z.greaterThan(e.y),()=>{t.assign(Ii(n.z.greaterThan(0),2,5))}).Else(()=>{t.assign(Ii(n.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),Z8=me(([n,e])=>{const t=ye().toVar();return yn(e.equal(0),()=>{t.assign(ye(n.z,n.y).div(vr(n.x)))}).ElseIf(e.equal(1),()=>{t.assign(ye(n.x.negate(),n.z.negate()).div(vr(n.y)))}).ElseIf(e.equal(2),()=>{t.assign(ye(n.x.negate(),n.y).div(vr(n.z)))}).ElseIf(e.equal(3),()=>{t.assign(ye(n.z.negate(),n.y).div(vr(n.x)))}).ElseIf(e.equal(4),()=>{t.assign(ye(n.x.negate(),n.z).div(vr(n.y)))}).Else(()=>{t.assign(ye(n.x,n.y).div(vr(n.z)))}),ht(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),J8=me(([n])=>{const e=te(0).toVar();return yn(n.greaterThanEqual(jm),()=>{e.assign(ZR.sub(n).mul(jx.sub($x)).div(ZR.sub(jm)).add($x))}).ElseIf(n.greaterThanEqual(Xm),()=>{e.assign(jm.sub(n).mul(Xx.sub(jx)).div(jm.sub(Xm)).add(jx))}).ElseIf(n.greaterThanEqual(qm),()=>{e.assign(Xm.sub(n).mul(qx.sub(Xx)).div(Xm.sub(qm)).add(Xx))}).ElseIf(n.greaterThanEqual(JR),()=>{e.assign(qm.sub(n).mul(Y8.sub(qx)).div(qm.sub(JR)).add(qx))}).Else(()=>{e.assign(te(-2).mul(Qs(ht(1.16,n))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),eW=me(([n,e])=>{const t=n.toVar();t.assign(ht(2,t).sub(1));const i=ne(t,1).toVar();return yn(e.equal(0),()=>{i.assign(i.zyx)}).ElseIf(e.equal(1),()=>{i.assign(i.xzy),i.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{i.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{i.assign(i.zyx),i.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{i.assign(i.xzy),i.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{i.z.mulAssign(-1)}),i}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),tW=me(([n,e,t,i,r,s])=>{const o=te(t),a=ne(e),l=Zs(J8(o),$x,s),u=qo(l),c=Xa(l),h=ne(Yx(n,a,c,i,r,s)).toVar();return yn(u.notEqual(0),()=>{const d=ne(Yx(n,a,c.add(1),i,r,s)).toVar();h.assign(Gt(h,d,u))}),h}),Yx=me(([n,e,t,i,r,s])=>{const o=te(t).toVar(),a=ne(e),l=te(Q8(a)).toVar(),u=te(Li(eN.sub(o),0)).toVar();o.assign(Li(o,eN));const c=te(od(o)).toVar(),h=ye(Z8(a,l).mul(c.sub(2)).add(1)).toVar();return yn(l.greaterThan(2),()=>{h.y.addAssign(c),l.subAssign(3)}),h.x.addAssign(l.mul(c)),h.x.addAssign(u.mul(ht(3,K8))),h.y.addAssign(ht(4,od(s).sub(c))),h.x.mulAssign(i),h.y.mulAssign(r),n.sample(h).grad(ye(),ye())}),Kx=me(({envMap:n,mipInt:e,outputDirection:t,theta:i,axis:r,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:a})=>{const l=Yo(i),u=t.mul(l).add(r.cross(t).mul(Gr(i))).add(r.mul(r.dot(t).mul(l.oneMinus())));return Yx(n,u,e,s,o,a)}),nW=me(({n,latitudinal:e,poleAxis:t,outputDirection:i,weights:r,samples:s,dTheta:o,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:h})=>{const d=ne(Ii(e,t,jC(t,i))).toVar();yn(BC(d.equals(ne(0))),()=>{d.assign(ne(i.z,0,i.x.negate()))}),d.assign(ad(d));const f=ne().toVar();return f.addAssign(r.element(on(0)).mul(Kx({theta:0,axis:d,outputDirection:i,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:h}))),Wr({start:on(1),end:n},({i:m})=>{yn(m.greaterThanEqual(s),()=>{V6()});const _=te(o.mul(te(m))).toVar();f.addAssign(r.element(m).mul(Kx({theta:_.mul(-1),axis:d,outputDirection:i,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:h}))),f.addAssign(r.element(m).mul(Kx({theta:_,axis:d,outputDirection:i,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:h})))}),Qe(f,1)});let Ym=null;const tN=new WeakMap;function iW(n){const e=Math.log2(n)-2,t=1/n;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:t,maxMip:e}}function rW(n){let e=tN.get(n);if((e!==void 0?e.pmremVersion:-1)!==n.pmremVersion){const i=n.image;if(n.isCubeTexture)if(oW(i))e=Ym.fromCubemap(n,e);else return null;else if(aW(i))e=Ym.fromEquirectangular(n,e);else return null;e.pmremVersion=n.pmremVersion,tN.set(n,e)}return e.texture}class sW extends Rn{static get type(){return"PMREMNode"}constructor(e,t=null,i=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=i,this._generator=null;const r=new gn;r.isRenderTargetTexture=!0,this._texture=yt(r),this._width=Ze(0),this._height=Ze(0),this._maxMip=Ze(0),this.updateBeforeType=at.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=iW(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(){let e=this._pmrem;const t=e?e.pmremVersion:-1,i=this._value;t!==i.pmremVersion&&(i.isPMREMTexture===!0?e=i:e=rW(i),e!==null&&(this._pmrem=e,this.updateFromTexture(e)))}setup(e){Ym===null&&(Ym=e.createPMREMGenerator()),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this));const i=this.value;e.renderer.coordinateSystem===Ci&&i.isPMREMTexture!==!0&&i.isRenderTargetTexture===!0&&(t=ne(t.x.negate(),t.yz)),t=ne(t.x,t.y.negate(),t.z);let r=this.levelNode;return r===null&&e.context.getTextureLevel&&(r=e.context.getTextureLevel(this)),tW(this._texture,t,r,this._width,this._height,this._maxMip)}}function oW(n){if(n==null)return!1;let e=0;const t=6;for(let i=0;i<t;i++)n[i]!==void 0&&e++;return e===t}function aW(n){return n==null?!1:n.height>0}const nN=oe(sW),iN=new WeakMap;class lW extends Yu{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let i=this.envNode;if(i.isTextureNode||i.isMaterialReferenceNode){const f=i.isTextureNode?i.value:t[i.property];let m=iN.get(f);m===void 0&&(m=nN(f),iN.set(f,m)),i=m}const s=t.envMap?Dt("envMapIntensity","float",e.material):Dt("environmentIntensity","float",e.scene),a=t.useAnisotropy===!0||t.anisotropy>0?YH:Sn,l=i.context(rN(Ys,a)).mul(s),u=i.context(uW(Px)).mul(Math.PI).mul(s),c=Om(l),h=Om(u);e.context.radiance.addAssign(c),e.context.iblIrradiance.addAssign(h);const d=e.context.lightingModel.clearcoatRadiance;if(d){const f=i.context(rN(Cm,pd)).mul(s),m=Om(f);d.addAssign(m)}}}const rN=(n,e)=>{let t=null;return{getUV:()=>(t===null&&(t=tn.negate().reflect(e),t=n.mul(n).mix(t,e).normalize(),t=t.transformDirection(to)),t),getTextureLevel:()=>n}},uW=n=>({getUV:()=>n,getTextureLevel:()=>te(1)}),cW=new NE;class sN extends bn{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(cW),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new lW(t):null}setupLightingModel(){return new QR}setupSpecular(){const e=Gt(ne(.04),wt.rgb,Am);tr.assign(e),Nm.assign(1)}setupVariants(){const e=this.metalnessNode?te(this.metalnessNode):u6;Am.assign(e);let t=this.roughnessNode?te(this.roughnessNode):l6;t=UR({roughness:t}),Ys.assign(t),this.setupSpecular(),wt.assign(Qe(wt.rgb.mul(e.oneMinus()),wt.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const hW=new RU;class dW extends sN{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(hW),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?te(this.iorNode):b6;Dm.assign(e),tr.assign(Gt(ld(XC(Dm.sub(1).div(Dm.add(1))).mul(a6),ne(1)).mul(pR),wt.rgb,Am)),Nm.assign(Gt(pR,1,Am))}setupLightingModel(){return new QR(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?te(this.clearcoatNode):h6,i=this.clearcoatRoughnessNode?te(this.clearcoatRoughnessNode):d6;mx.assign(t),Cm.assign(UR({roughness:i}))}if(this.useSheen){const t=this.sheenNode?ne(this.sheenNode):m6,i=this.sheenRoughnessNode?te(this.sheenRoughnessNode):g6;Xu.assign(t),gx.assign(i)}if(this.useIridescence){const t=this.iridescenceNode?te(this.iridescenceNode):v6,i=this.iridescenceIORNode?te(this.iridescenceIORNode):y6,r=this.iridescenceThicknessNode?te(this.iridescenceThicknessNode):x6;_x.assign(t),NC.assign(i),PC.assign(r)}if(this.useAnisotropy){const t=(this.anisotropyNode?ye(this.anisotropyNode):_6).toVar();ja.assign(t.length()),yn(ja.equal(0),()=>{t.assign(ye(1,0))}).Else(()=>{t.divAssign(ye(ja)),ja.assign(ja.saturate())}),vx.assign(ja.pow2().mix(Ys.pow2(),1)),Rm.assign(gd[0].mul(t.x).add(gd[1].mul(t.y))),qu.assign(gd[1].mul(t.x).sub(gd[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?te(this.transmissionNode):S6,i=this.thicknessNode?te(this.thicknessNode):T6,r=this.attenuationDistanceNode?te(this.attenuationDistanceNode):w6,s=this.attenuationColorNode?ne(this.attenuationColorNode):M6;if(Sx.assign(t),LC.assign(i),IC.assign(r),UC.assign(s),this.useDispersion){const o=this.dispersionNode?te(this.dispersionNode):N6;FC.assign(o)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?ne(this.clearcoatNormalNode):f6}setup(e){e.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(e),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const fW=me(({normal:n,lightDirection:e,builder:t})=>{const i=n.dot(e),r=ye(i.mul(.5).add(.5),0);if(t.material.gradientMap){const s=Zo("gradientMap","texture").context({getUV:()=>r});return ne(s.r)}else{const s=r.fwidth().mul(.5);return Gt(ne(.7),ne(1),qa(te(.7).sub(s.x),te(.7).add(s.x),r.x))}});class pW extends Hm{direct({lightDirection:e,lightColor:t,reflectedLight:i},r,s){const o=fW({normal:rR,lightDirection:e,builder:s}).mul(t);i.directDiffuse.addAssign(o.mul(Ku({diffuseColor:wt.rgb})))}indirect({ambientOcclusion:e,irradiance:t,reflectedLight:i}){i.indirectDiffuse.addAssign(t.mul(Ku({diffuseColor:wt}))),i.indirectDiffuse.mulAssign(e)}}const mW=new PU;class gW extends bn{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(mW),this.setValues(e)}setupLightingModel(){return new pW}}class _W extends Rn{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){const e=ne(tn.z,0,tn.x.negate()).normalize(),t=tn.cross(e);return ye(e.dot(Sn),t.dot(Sn)).mul(.495).add(.5)}}const vW=ve(_W),yW=new UU;class xW extends bn{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(yW),this.setValues(e)}setupVariants(e){const t=vW;let i;e.material.matcap?i=Zo("matcap","texture").context({getUV:()=>t}):i=ne(Gt(.2,.8,t.y)),wt.rgb.mulAssign(i.rgb)}}const SW=new cU;class TW extends bn{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.isPointsNodeMaterial=!0,this.setDefaultValues(SW),this.setValues(e)}}class bW extends Rn{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:i}=this;if(this.getNodeType(e)==="vec2"){const s=t.cos(),o=t.sin();return px(s,o,o.negate(),s).mul(i)}else{const s=t,o=ju(Qe(1,0,0,0),Qe(0,Yo(s.x),Gr(s.x).negate(),0),Qe(0,Gr(s.x),Yo(s.x),0),Qe(0,0,0,1)),a=ju(Qe(Yo(s.y),0,Gr(s.y),0),Qe(0,1,0,0),Qe(Gr(s.y).negate(),0,Yo(s.y),0),Qe(0,0,0,1)),l=ju(Qe(Yo(s.z),Gr(s.z).negate(),0,0),Qe(Gr(s.z),Yo(s.z),0,0),Qe(0,0,1,0),Qe(0,0,0,1));return o.mul(a).mul(l).mul(Qe(i,1)).xyz}}}const wW=oe(bW),MW=new $y;class EW extends bn{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(MW),this.setValues(e)}setupPositionView(e){const{object:t,camera:i}=e,r=this.sizeAttenuation,{positionNode:s,rotationNode:o,scaleNode:a}=this,l=Rx.mul(ne(s||0));let u=ye(Qa[0].xyz.length(),Qa[1].xyz.length());if(a!==null&&(u=u.mul(a)),r===!1)if(i.isPerspectiveCamera)u=u.mul(l.z.negate());else{const f=te(2).div(Cx.element(1).element(1));u=u.mul(f.mul(2))}let c=Nx.xy;if(t.center&&t.center.isVector2===!0){const f=pH("center","vec2",t);c=c.sub(f.sub(.5))}c=c.mul(u);const h=te(o||p6),d=wW(c,h);return Qe(l.xy.add(d),l.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}class AW extends Hm{constructor(){super(),this.shadowNode=te(1).toVar("shadowMask")}direct({shadowMask:e}){this.shadowNode.mulAssign(e)}finish(e){wt.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(wt.rgb)}}const CW=new CU;class RW extends bn{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.setDefaultValues(CW),this.setValues(e)}setupLightingModel(){return new AW}}me(({texture:n,uv:e})=>{const i=ne().toVar();return yn(e.x.lessThan(1e-4),()=>{i.assign(ne(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{i.assign(ne(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{i.assign(ne(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{i.assign(ne(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{i.assign(ne(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{i.assign(ne(0,0,-1))}).Else(()=>{const s=n.sample(e.add(ne(-.01,0,0))).r.sub(n.sample(e.add(ne(.01,0,0))).r),o=n.sample(e.add(ne(0,-.01,0))).r.sub(n.sample(e.add(ne(0,.01,0))).r),a=n.sample(e.add(ne(0,0,-.01))).r.sub(n.sample(e.add(ne(0,0,.01))).r);i.assign(ne(s,o,a))}),i.normalize()});class NW{constructor(e,t){this.nodes=e,this.info=t,this._context=self,this._animationLoop=null,this._requestId=null}start(){const e=(t,i)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this._animationLoop!==null&&this._animationLoop(t,i)};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}setAnimationLoop(e){this._animationLoop=e}setContext(e){this._context=e}dispose(){this.stop()}}class cs{constructor(){this.weakMap=new WeakMap}get(e){let t=this.weakMap;for(let i=0;i<e.length;i++)if(t=t.get(e[i]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let i=this.weakMap;for(let r=0;r<e.length;r++){const s=e[r];i.has(s)===!1&&i.set(s,new WeakMap),i=i.get(s)}return i.set(e[e.length-1],t),this}delete(e){let t=this.weakMap;for(let i=0;i<e.length;i++)if(t=t.get(e[i]),t===void 0)return!1;return t.delete(e[e.length-1])}}let PW=0;function DW(n){const e=Object.keys(n);let t=Object.getPrototypeOf(n);for(;t;){const i=Object.getOwnPropertyDescriptors(t);for(const r in i)if(i[r]!==void 0){const s=i[r];s&&typeof s.get=="function"&&e.push(r)}t=Object.getPrototypeOf(t)}return e}class LW{constructor(e,t,i,r,s,o,a,l,u,c){this.id=PW++,this._nodes=e,this._geometries=t,this.renderer=i,this.object=r,this.material=s,this.scene=o,this.camera=a,this.lightsNode=l,this.context=u,this.geometry=r.geometry,this.version=s.version,this.drawRange=null,this.attributes=null,this.pipeline=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=c,this.clippingContextCacheKey=c!==null?c.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.material.addEventListener("dispose",this.onMaterialDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().monitor)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,i=[],r=new Set;for(const s of e){const o=s.node&&s.node.attribute?s.node.attribute:t.getAttribute(s.name);if(o===void 0)continue;i.push(o);const a=o.isInterleavedBufferAttribute?o.data:o;r.add(a)}return this.attributes=i,this.vertexBuffers=Array.from(r.values()),i}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:i,group:r,drawRange:s}=this,o=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),a=this.getIndex(),l=a!==null,u=i.isInstancedBufferGeometry?i.instanceCount:e.count>1?e.count:1;if(u===0)return null;if(o.instanceCount=u,e.isBatchedMesh===!0)return o;let c=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(c=2);let h=s.start*c,d=(s.start+s.count)*c;r!==null&&(h=Math.max(h,r.start*c),d=Math.min(d,(r.start+r.count)*c));const f=i.attributes.position;let m=1/0;l?m=a.count:f!=null&&(m=f.count),h=Math.max(h,0),d=Math.min(d,m);const _=d-h;return _<0||_===1/0?null:(o.vertexCount=_,o.firstVertex=h,o)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const i of Object.keys(e.attributes).sort()){const r=e.attributes[i];t+=i+",",r.data&&(t+=r.data.stride+","),r.offset&&(t+=r.offset+","),r.itemSize&&(t+=r.itemSize+","),r.normalized&&(t+="n,")}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t}=this;let i=t.customProgramCacheKey();for(const r of DW(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(r))continue;const s=t[r];let o;if(s!==null){const a=typeof s;a==="number"?o=s!==0?"1":"0":a==="object"?(o="{",s.isTexture&&(o+=s.mapping),o+="}"):o=String(s)}else o=String(s);i+=o+","}return i+=this.clippingContextCacheKey+",",e.geometry&&(i+=this.getGeometryCacheKey()),e.skeleton&&(i+=e.skeleton.bones.length+","),e.morphTargetInfluences&&(i+=e.morphTargetInfluences.length+","),e.isBatchedMesh&&(i+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(i+=e._colorsTexture.uuid+",")),e.count>1&&(i+=e.uuid+","),i+=e.receiveShadow+",",wV(i)}get needsGeometryUpdate(){return this.geometry.id!==this.object.geometry.id}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=this._nodes.getCacheKey(this.scene,this.lightsNode);return this.object.receiveShadow&&(e+=1),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.onDispose()}}const Qu=[];class IW{constructor(e,t,i,r,s,o){this.renderer=e,this.nodes=t,this.geometries=i,this.pipelines=r,this.bindings=s,this.info=o,this.chainMaps={}}get(e,t,i,r,s,o,a,l){const u=this.getChainMap(l);Qu[0]=e,Qu[1]=t,Qu[2]=o,Qu[3]=s;let c=u.get(Qu);return c===void 0?(c=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,i,r,s,o,a,l),u.set(Qu,c)):(c.updateClipping(a),c.needsGeometryUpdate&&c.setGeometry(e.geometry),(c.version!==t.version||c.needsUpdate)&&(c.initialCacheKey!==c.getCacheKey()?(c.dispose(),c=this.get(e,t,i,r,s,o,a,l)):c.version=t.version)),c}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new cs)}dispose(){this.chainMaps={}}createRenderObject(e,t,i,r,s,o,a,l,u,c,h){const d=this.getChainMap(h),f=new LW(e,t,i,r,s,o,a,l,u,c);return f.onDispose=()=>{this.pipelines.delete(f),this.bindings.delete(f),this.nodes.delete(f),d.delete(f.getChainArray())},f}}class Jo{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const hs={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},ea=16,UW=211,FW=212;class OW extends Jo{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==void 0&&this.backend.destroyAttribute(e),t}update(e,t){const i=this.get(e);if(i.version===void 0)t===hs.VERTEX?this.backend.createAttribute(e):t===hs.INDEX?this.backend.createIndexAttribute(e):t===hs.STORAGE?this.backend.createStorageAttribute(e):t===hs.INDIRECT&&this.backend.createIndirectStorageAttribute(e),i.version=this._getBufferAttribute(e).version;else{const r=this._getBufferAttribute(e);(i.version<r.version||r.usage===uu)&&(this.backend.updateAttribute(e),i.version=r.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function BW(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function oN(n){return n.index!==null?n.index.version:n.attributes.position.version}function aN(n){const e=[],t=n.index,i=n.attributes.position;if(t!==null){const s=t.array;for(let o=0,a=s.length;o<a;o+=3){const l=s[o+0],u=s[o+1],c=s[o+2];e.push(l,u,u,c,c,l)}}else{const s=i.array;for(let o=0,a=s.length/3-1;o<a;o+=3){const l=o+0,u=o+1,c=o+2;e.push(l,u,u,c,c,l)}}const r=new(BW(e)?zy:ky)(e,1);return r.version=oN(n),r}class kW extends Jo{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,i=this.get(t);i.initialized=!0,this.info.memory.geometries++;const r=()=>{this.info.memory.geometries--;const s=t.index,o=e.getAttributes();s!==null&&this.attributes.delete(s);for(const l of o)this.attributes.delete(l);const a=this.wireframes.get(t);a!==void 0&&this.attributes.delete(a),t.removeEventListener("dispose",r)};t.addEventListener("dispose",r)}updateAttributes(e){const t=e.getAttributes();for(const s of t)s.isStorageBufferAttribute||s.isStorageInstancedBufferAttribute?this.updateAttribute(s,hs.STORAGE):this.updateAttribute(s,hs.VERTEX);const i=this.getIndex(e);i!==null&&this.updateAttribute(i,hs.INDEX);const r=e.geometry.indirect;r!==null&&this.updateAttribute(r,hs.INDIRECT)}updateAttribute(e,t){const i=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,i)):this.attributeCall.get(e.data)!==i&&(this.attributes.update(e,t),this.attributeCall.set(e.data,i),this.attributeCall.set(e,i)):this.attributeCall.get(e)!==i&&(this.attributes.update(e,t),this.attributeCall.set(e,i))}getIndirect(e){return e.geometry.indirect}getIndex(e){const{geometry:t,material:i}=e;let r=t.index;if(i.wireframe===!0){const s=this.wireframes;let o=s.get(t);o===void 0?(o=aN(t),s.set(t,o)):o.version!==oN(t)&&(this.attributes.delete(o),o=aN(t),s.set(t,o)),r=o}return r}}class zW{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0,previousFrameCalls:0,timestampCalls:0},this.compute={calls:0,frameCalls:0,timestamp:0,previousFrameCalls:0,timestampCalls:0},this.memory={geometries:0,textures:0}}update(e,t,i){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=i*(t/3):e.isPoints?this.render.points+=i*t:e.isLineSegments?this.render.lines+=i*(t/2):e.isLine?this.render.lines+=i*(t-1):console.error("THREE.WebGPUInfo: Unknown object type.")}updateTimestamp(e,t){this[e].timestampCalls===0&&(this[e].timestamp=0),this[e].timestamp+=t,this[e].timestampCalls++,this[e].timestampCalls>=this[e].previousFrameCalls&&(this[e].timestampCalls=0)}reset(){const e=this.render.frameCalls;this.render.previousFrameCalls=e;const t=this.compute.frameCalls;this.compute.previousFrameCalls=t,this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class lN{constructor(e){this.cacheKey=e,this.usedTimes=0}}class GW extends lN{constructor(e,t,i){super(e),this.vertexProgram=t,this.fragmentProgram=i}}class VW extends lN{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let HW=0;class Qx{constructor(e,t,i,r=null,s=null){this.id=HW++,this.code=e,this.stage=t,this.name=i,this.transforms=r,this.attributes=s,this.usedTimes=0}}class WW extends Jo{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:i}=this,r=this.get(e);if(this._needsComputeUpdate(e)){const s=r.pipeline;s&&(s.usedTimes--,s.computeProgram.usedTimes--);const o=this.nodes.getForCompute(e);let a=this.programs.compute.get(o.computeShader);a===void 0&&(s&&s.computeProgram.usedTimes===0&&this._releaseProgram(s.computeProgram),a=new Qx(o.computeShader,"compute",e.name,o.transforms,o.nodeAttributes),this.programs.compute.set(o.computeShader,a),i.createProgram(a));const l=this._getComputeCacheKey(e,a);let u=this.caches.get(l);u===void 0&&(s&&s.usedTimes===0&&this._releasePipeline(s),u=this._getComputePipeline(e,a,l,t)),u.usedTimes++,a.usedTimes++,r.version=e.version,r.pipeline=u}return r.pipeline}getForRender(e,t=null){const{backend:i}=this,r=this.get(e);if(this._needsRenderUpdate(e)){const s=r.pipeline;s&&(s.usedTimes--,s.vertexProgram.usedTimes--,s.fragmentProgram.usedTimes--);const o=e.getNodeBuilderState(),a=e.material?e.material.name:"";let l=this.programs.vertex.get(o.vertexShader);l===void 0&&(s&&s.vertexProgram.usedTimes===0&&this._releaseProgram(s.vertexProgram),l=new Qx(o.vertexShader,"vertex",a),this.programs.vertex.set(o.vertexShader,l),i.createProgram(l));let u=this.programs.fragment.get(o.fragmentShader);u===void 0&&(s&&s.fragmentProgram.usedTimes===0&&this._releaseProgram(s.fragmentProgram),u=new Qx(o.fragmentShader,"fragment",a),this.programs.fragment.set(o.fragmentShader,u),i.createProgram(u));const c=this._getRenderCacheKey(e,l,u);let h=this.caches.get(c);h===void 0?(s&&s.usedTimes===0&&this._releasePipeline(s),h=this._getRenderPipeline(e,l,u,c,t)):e.pipeline=h,h.usedTimes++,l.usedTimes++,u.usedTimes++,r.pipeline=h}return r.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,i,r){i=i||this._getComputeCacheKey(e,t);let s=this.caches.get(i);return s===void 0&&(s=new VW(i,t),this.caches.set(i,s),this.backend.createComputePipeline(s,r)),s}_getRenderPipeline(e,t,i,r,s){r=r||this._getRenderCacheKey(e,t,i);let o=this.caches.get(r);return o===void 0&&(o=new GW(r,t,i),this.caches.set(r,o),e.pipeline=o,this.backend.createRenderPipeline(e,s)),o}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,i){return t.id+","+i.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,i=e.stage;this.programs[i].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class $W extends Jo{constructor(e,t,i,r,s,o){super(),this.backend=e,this.textures=i,this.pipelines=s,this.attributes=r,this.nodes=t,this.info=o,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const i of t){const r=this.get(i);r.bindGroup===void 0&&(this._init(i),this.backend.createBindings(i,t,0),r.bindGroup=i)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const i of t){const r=this.get(i);r.bindGroup===void 0&&(this._init(i),this.backend.createBindings(i,t,0),r.bindGroup=i)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isStorageBuffer){const i=t.attribute,r=i.isIndirectStorageBufferAttribute?hs.INDIRECT:hs.STORAGE;this.attributes.update(i,r)}}_update(e,t){const{backend:i}=this;let r=!1,s=!0,o=0,a=0;for(const l of e.bindings)if(!(l.isNodeUniformsGroup&&this.nodes.updateGroup(l)===!1)){if(l.isUniformBuffer)l.update()&&i.updateBinding(l);else if(l.isSampler)l.update();else if(l.isSampledTexture){const u=this.textures.get(l.texture);l.needsBindingsUpdate(u.generation)&&(r=!0);const c=l.update(),h=l.texture;c&&this.textures.updateTexture(h);const d=i.get(h);if(d.externalTexture!==void 0||u.isDefaultTexture?s=!1:(o=o*10+h.id,a+=h.version),i.isWebGPUBackend===!0&&d.texture===void 0&&d.externalTexture===void 0&&(console.error("Bindings._update: binding should be available:",l,c,h,l.textureNode.value,r),this.textures.updateTexture(h),r=!0),h.isStorageTexture===!0){const f=this.get(h);l.store===!0?f.needsMipmap=!0:this.textures.needsMipmaps(h)&&f.needsMipmap===!0&&(this.backend.generateMipmaps(h),f.needsMipmap=!1)}}}r===!0&&this.backend.updateBindings(e,t,s?o:0,a)}}function jW(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function uN(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function cN(n){return(n.transmission>0||n.transmissionNode)&&n.side===ui&&n.forceSinglePass===!1}class XW{constructor(e,t,i){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,i),this.lightsArray=[],this.scene=t,this.camera=i,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,i,r,s,o,a){let l=this.renderItems[this.renderItemsIndex];return l===void 0?(l={id:e.id,object:e,geometry:t,material:i,groupOrder:r,renderOrder:e.renderOrder,z:s,group:o,clippingContext:a},this.renderItems[this.renderItemsIndex]=l):(l.id=e.id,l.object=e,l.geometry=t,l.material=i,l.groupOrder=r,l.renderOrder=e.renderOrder,l.z=s,l.group=o,l.clippingContext=a),this.renderItemsIndex++,l}push(e,t,i,r,s,o,a){const l=this.getNextRenderItem(e,t,i,r,s,o,a);e.occlusionTest===!0&&this.occlusionQueryCount++,i.transparent===!0||i.transmission>0?(cN(i)&&this.transparentDoublePass.push(l),this.transparent.push(l)):this.opaque.push(l)}unshift(e,t,i,r,s,o,a){const l=this.getNextRenderItem(e,t,i,r,s,o,a);i.transparent===!0||i.transmission>0?(cN(i)&&this.transparentDoublePass.unshift(l),this.transparent.unshift(l)):this.opaque.unshift(l)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||jW),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||uN),this.transparent.length>1&&this.transparent.sort(t||uN)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const i=this.renderItems[e];if(i.id===null)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.groupOrder=null,i.renderOrder=null,i.z=null,i.group=null,i.clippingContext=null}}}class qW{constructor(e){this.lighting=e,this.lists=new cs}get(e,t){const i=this.lists,r=[e,t];let s=i.get(r);return s===void 0&&(s=new XW(this.lighting,e,t),i.set(r,s)),s}dispose(){this.lists=new cs}}let YW=0;class KW{constructor(){this.id=YW++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new et,this.scissor=!1,this.scissorValue=new et,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.sampleCount=1,this.width=0,this.height=0,this.isRenderContext=!0}getCacheKey(){return hN(this)}}function hN(n){const{textures:e,activeCubeFace:t}=n,i=[t];for(const r of e)i.push(r.id);return ox(i)}class QW{constructor(){this.chainMaps={}}get(e=null,t=null,i=null){const r=[];e!==null&&r.push(e),t!==null&&r.push(t),r.length===0&&r.push({id:"default"});let s;if(i===null)s="default";else{const l=i.texture.format;s=`${i.textures.length}:${l}:${i.samples}:${i.depthBuffer}:${i.stencilBuffer}`}const o=this.getChainMap(s);let a=o.get(r);return a===void 0&&(a=new KW,o.set(r,a)),i!==null&&(a.sampleCount=i.samples===0?1:i.samples),a}getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new cs)}dispose(){this.chainMaps={}}}const ZW=new N;class JW extends Jo{constructor(e,t,i){super(),this.renderer=e,this.backend=t,this.info=i}updateRenderTarget(e,t=0){const i=this.get(e),r=e.samples===0?1:e.samples,s=i.depthTextureMips||(i.depthTextureMips={}),o=e.textures,a=this.getSize(o[0]),l=a.width>>t,u=a.height>>t;let c=e.depthTexture||s[t];const h=e.depthBuffer===!0||e.stencilBuffer===!0;let d=!1;c===void 0&&h&&(c=new Ho,c.format=e.stencilBuffer?is:ns,c.type=e.stencilBuffer?ts:en,c.image.width=l,c.image.height=u,s[t]=c),(i.width!==a.width||a.height!==i.height)&&(d=!0,c&&(c.needsUpdate=!0,c.image.width=l,c.image.height=u)),i.width=a.width,i.height=a.height,i.textures=o,i.depthTexture=c||null,i.depth=e.depthBuffer,i.stencil=e.stencilBuffer,i.renderTarget=e,i.sampleCount!==r&&(d=!0,c&&(c.needsUpdate=!0),i.sampleCount=r);const f={sampleCount:r};for(let m=0;m<o.length;m++){const _=o[m];d&&(_.needsUpdate=!0),this.updateTexture(_,f)}if(c&&this.updateTexture(c,f),i.initialized!==!0){i.initialized=!0;const m=()=>{e.removeEventListener("dispose",m);for(let _=0;_<o.length;_++)this._destroyTexture(o[_]);c&&this._destroyTexture(c),this.delete(e)};e.addEventListener("dispose",m)}}updateTexture(e,t={}){const i=this.get(e);if(i.initialized===!0&&i.version===e.version)return;const r=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,s=this.backend;if(r&&i.initialized===!0&&(s.destroySampler(e),s.destroyTexture(e)),e.isFramebufferTexture){const u=this.renderer.getRenderTarget();u?e.type=u.texture.type:e.type=Kn}const{width:o,height:a,depth:l}=this.getSize(e);if(t.width=o,t.height=a,t.depth=l,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,o,a):1,r||e.isStorageTexture===!0)s.createSampler(e),s.createTexture(e,t),i.generation=e.version;else if(i.initialized!==!0&&s.createSampler(e),e.version>0){const c=e.image;if(c===void 0)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(c.complete===!1)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const h=[];for(const d of e.images)h.push(d);t.images=h}else t.image=c;(i.isDefaultTexture===void 0||i.isDefaultTexture===!0)&&(s.createTexture(e,t),i.isDefaultTexture=!1,i.generation=e.version),e.source.dataReady===!0&&s.updateTexture(e,t),t.needsMipmaps&&e.mipmaps.length===0&&s.generateMipmaps(e)}}else s.createDefaultTexture(e),i.isDefaultTexture=!0,i.generation=e.version;if(i.initialized!==!0){i.initialized=!0,i.generation=e.version,this.info.memory.textures++;const u=()=>{e.removeEventListener("dispose",u),this._destroyTexture(e),this.info.memory.textures--};e.addEventListener("dispose",u)}i.version=e.version}getSize(e,t=ZW){let i=e.images?e.images[0]:e.image;return i?(i.image!==void 0&&(i=i.image),t.width=i.width||1,t.height=i.height||1,t.depth=e.isCubeTexture?6:i.depth||1):t.width=t.height=t.depth=1,t}getMipLevels(e,t,i){let r;return e.isCompressedTexture?e.mipmaps?r=e.mipmaps.length:r=1:r=Math.floor(Math.log2(Math.max(t,i)))+1,r}needsMipmaps(e){return this.isEnvironmentTexture(e)||e.isCompressedTexture===!0||e.generateMipmaps}isEnvironmentTexture(e){const t=e.mapping;return t===No||t===Po||t===fr||t===pr}_destroyTexture(e){this.backend.destroySampler(e),this.backend.destroyTexture(e),this.delete(e)}}class Zx extends Ue{constructor(e,t,i,r=1){super(e,t,i),this.a=r}set(e,t,i,r=1){return this.a=r,super.set(e,t,i)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class e$ extends At{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}class t$ extends tt{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}add(e){return this.nodes.push(e),this}If(e,t){const i=new bm(t);return this._currentCond=Ii(e,i),this.add(this._currentCond)}ElseIf(e,t){const i=new bm(t),r=Ii(e,i);return this._currentCond.elseNode=r,this._currentCond=r,this}Else(e){return this._currentCond.elseNode=new bm(e),this}build(e,...t){const i=wC();Mm(this);for(const r of this.nodes)r.build(e,"void");return Mm(i),this.outputNode?this.outputNode.build(e,...t):super.build(e,...t)}else(...e){return console.warn("TSL.StackNode: .else() has been renamed to .Else()."),this.Else(...e)}elseif(...e){return console.warn("TSL.StackNode: .elseif() has been renamed to .ElseIf()."),this.ElseIf(...e)}}const Jx=oe(t$);new Fr,new N,new N,new N,new pt,new N(0,0,-1),new et,new N,new N,new et,new ce;const n$=new fu;xd.flipX(),n$.depthTexture=new Ho(1,1);const eS=new kh(-1,1,1,-1,0,1);class i$ extends ei{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new dn([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new dn(t,2))}}const r$=new i$;class dN extends On{constructor(e=null){super(r$,e),this.camera=eS,this.isQuadMesh=!0}async renderAsync(e){return e.renderAsync(this,eS)}render(e){e.render(this,eS)}}const Md=new Qi,tS=new pt;class Fi extends tt{static get type(){return"SceneNode"}constructor(e=Fi.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,i=this.scene!==null?this.scene:e.scene;let r;return t===Fi.BACKGROUND_BLURRINESS?r=Dt("backgroundBlurriness","float",i):t===Fi.BACKGROUND_INTENSITY?r=Dt("backgroundIntensity","float",i):t===Fi.BACKGROUND_ROTATION?r=Ze("mat4").label("backgroundRotation").setGroup(Xe).onRenderUpdate(()=>{const s=i.background;return s!==null&&s.isTexture&&s.mapping!==sy?(Md.copy(i.backgroundRotation),Md.x*=-1,Md.y*=-1,Md.z*=-1,tS.makeRotationFromEuler(Md)):tS.identity(),tS}):console.error("THREE.SceneNode: Unknown scope:",t),r}}Fi.BACKGROUND_BLURRINESS="backgroundBlurriness",Fi.BACKGROUND_INTENSITY="backgroundIntensity",Fi.BACKGROUND_ROTATION="backgroundRotation";const s$=ve(Fi,Fi.BACKGROUND_BLURRINESS),fN=ve(Fi,Fi.BACKGROUND_INTENSITY),o$=ve(Fi,Fi.BACKGROUND_ROTATION),a$=new ce;class l$ extends dd{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return e.object.isQuadMesh&&this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class pN extends l${static get type(){return"PassMultipleTextureNode"}constructor(e,t,i=!1){super(e,null),this.textureName=t,this.previousTexture=i}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class Km extends Rn{static get type(){return"PassNode"}constructor(e,t,i,r={}){super("vec4"),this.scope=e,this.scene=t,this.camera=i,this.options=r,this._pixelRatio=1,this._width=1,this._height=1;const s=new Ho;s.isRenderTargetTexture=!0,s.name="depth";const o=new fu(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:hi,...r});o.texture.name="output",o.depthTexture=s,this.renderTarget=o,this._textures={output:o.texture,depth:s},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=Ze(0),this._cameraFar=Ze(0),this._mrt=null,this.isPassNode=!0,this.updateBeforeType=at.FRAME}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}isGlobal(){return!0}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const i=this._textures[e],r=this.renderTarget.textures.indexOf(i);this.renderTarget.textures[r]=t,this._textures[e]=t,this._previousTextures[e]=i,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=pe(new pN(this,e)),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=pe(new pN(this,e,!0)),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const i=this._cameraNear,r=this._cameraFar;this._viewZNodes[e]=t=TR(this.getTextureNode(e),i,r)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const i=this._cameraNear,r=this._cameraFar,s=this.getViewZNode(e);this._linearDepthNodes[e]=t=Td(s,i,r)}return t}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,e.backend.isWebGLBackend===!0&&(this.renderTarget.samples=0),this.scope===Km.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:i,camera:r}=this;this._pixelRatio=t.getPixelRatio();const s=t.getSize(a$);this.setSize(s.width,s.height);const o=t.getRenderTarget(),a=t.getMRT();this._cameraNear.value=r.near,this._cameraFar.value=r.far;for(const l in this._previousTextures)this.toggleTexture(l);t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.render(i,r),t.setRenderTarget(o),t.setMRT(a)}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget.setSize(i,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}Km.COLOR="color",Km.DEPTH="depth";const u$=me(([n,e])=>n.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),c$=me(([n,e])=>(n=n.mul(e),n.div(n.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),h$=me(([n,e])=>{n=n.mul(e),n=n.sub(.004).max(0);const t=n.mul(n.mul(6.2).add(.5)),i=n.mul(n.mul(6.2).add(1.7)).add(.06);return t.div(i).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),d$=me(([n])=>{const e=n.mul(n.add(.0245786)).sub(90537e-9),t=n.mul(n.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),f$=me(([n,e])=>{const t=vi(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),i=vi(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return n=n.mul(e).div(.6),n=t.mul(n),n=d$(n),n=i.mul(n),n.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),p$=vi(ne(1.6605,-.1246,-.0182),ne(-.5876,1.1329,-.1006),ne(-.0728,-.0083,1.1187)),m$=vi(ne(.6274,.0691,.0164),ne(.3293,.9195,.088),ne(.0433,.0113,.8956)),g$=me(([n])=>{const e=ne(n).toVar(),t=ne(e.mul(e)).toVar(),i=ne(t.mul(t)).toVar();return te(15.5).mul(i.mul(t)).sub(ht(40.14,i.mul(e))).add(ht(31.96,i).sub(ht(6.868,t.mul(e))).add(ht(.4298,t).add(ht(.1191,e).sub(.00232))))}),_$=me(([n,e])=>{const t=ne(n).toVar(),i=vi(ne(.856627153315983,.137318972929847,.11189821299995),ne(.0951212405381588,.761241990602591,.0767994186031903),ne(.0482516061458583,.101439036467562,.811302368396859)),r=vi(ne(1.1271005818144368,-.1413297634984383,-.14132976349843826),ne(-.11060664309660323,1.157823702216272,-.11060664309660294),ne(-.016493938717834573,-.016493938717834257,1.2519364065950405)),s=te(-12.47393),o=te(4.026069);return t.mulAssign(e),t.assign(m$.mul(t)),t.assign(i.mul(t)),t.assign(Li(t,1e-10)),t.assign(Qs(t)),t.assign(t.sub(s).div(o.sub(s))),t.assign(Zs(t,0,1)),t.assign(g$(t)),t.assign(r.mul(t)),t.assign(Im(Li(ne(0),t),ne(2.2))),t.assign(p$.mul(t)),t.assign(Zs(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),v$=me(([n,e])=>{const t=te(.76),i=te(.15);n=n.mul(e);const r=ld(n.r,ld(n.g,n.b)),s=Ii(r.lessThan(.08),r.sub(ht(6.25,r.mul(r))),.04);n.subAssign(s);const o=Li(n.r,Li(n.g,n.b));yn(o.lessThan(t),()=>n);const a=Di(1,t),l=Di(1,a.mul(a).div(o.add(a.sub(t))));n.mulAssign(l.div(o));const u=Di(1,Ks(1,i.mul(o.sub(l)).add(1)));return Gt(n,ne(l),u)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class Nn extends tt{static get type(){return"CodeNode"}constructor(e="",t=[],i=""){super("code"),this.isCodeNode=!0,this.code=e,this.includes=t,this.language=i}isGlobal(){return!0}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const r of t)r.build(e);const i=e.getCodeFromNode(this,this.getNodeType(e));return i.code=this.code,i.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}class y$ extends Nn{static get type(){return"FunctionNode"}constructor(e="",t=[],i=""){super(e,t,i)}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let i=t.nodeFunction;return i===void 0&&(i=e.parser.parseFunction(this.code),t.nodeFunction=i),i}generate(e,t){super.generate(e);const i=this.getNodeFunction(e),r=i.name,s=i.type,o=e.getCodeFromNode(this,s);r!==""&&(o.name=r);const a=e.getPropertyName(o),l=this.getNodeFunction(e).getCode(a);return o.code=l+`
`,t==="property"?a:e.format(`${a}()`,s,t)}}function mN(n){let e;const t=n.context.getViewZ;return t!==void 0&&(e=t(this)),(e||xn.z).negate()}const x$=me(([n,e],t)=>{const i=mN(t);return qa(n,e,i)}),S$=me(([n],e)=>{const t=mN(e);return n.mul(n,t,t).negate().exp().oneMinus()}),gN=me(([n,e])=>Qe(e.toFloat().mix(Pm.rgb,n.toVec3()),Pm.a));class T$ extends tt{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:i}=e;i.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}oe(T$);class ds extends Rn{static get type(){return"AtomicFunctionNode"}constructor(e,t,i,r=null){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=i,this.storeNode=r}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=this.method,i=this.getNodeType(e),r=this.getInputType(e),s=this.pointerNode,o=this.valueNode,a=[];a.push(`&${s.build(e,r)}`),a.push(o.build(e,r));const l=`${e.getMethod(t,i)}( ${a.join(", ")} )`;if(this.storeNode!==null){const u=this.storeNode.build(e,r);e.addLineFlowCode(`${u} = ${l}`,this)}else e.addLineFlowCode(l,this)}}ds.ATOMIC_LOAD="atomicLoad",ds.ATOMIC_STORE="atomicStore",ds.ATOMIC_ADD="atomicAdd",ds.ATOMIC_SUB="atomicSub",ds.ATOMIC_MAX="atomicMax",ds.ATOMIC_MIN="atomicMin",ds.ATOMIC_AND="atomicAnd",ds.ATOMIC_OR="atomicOr",ds.ATOMIC_XOR="atomicXor",oe(ds);let Qm;function Ed(n){Qm=Qm||new WeakMap;let e=Qm.get(n);return e===void 0&&Qm.set(n,e={}),e}function _N(n){const e=Ed(n);return e.shadowMatrix||(e.shadowMatrix=Ze("mat4").setGroup(Xe).onRenderUpdate(()=>(n.castShadow!==!0&&n.shadow.updateMatrices(n),n.shadow.matrix)))}function b$(n){const e=Ed(n);if(e.projectionUV===void 0){const t=_N(n).mul(fd);e.projectionUV=t.xyz.div(t.w)}return e.projectionUV}function vN(n){const e=Ed(n);return e.position||(e.position=Ze(new N).setGroup(Xe).onRenderUpdate((t,i)=>i.value.setFromMatrixPosition(n.matrixWorld)))}function w$(n){const e=Ed(n);return e.targetPosition||(e.targetPosition=Ze(new N).setGroup(Xe).onRenderUpdate((t,i)=>i.value.setFromMatrixPosition(n.target.matrixWorld)))}function nS(n){const e=Ed(n);return e.viewPosition||(e.viewPosition=Ze(new N).setGroup(Xe).onRenderUpdate(({camera:t},i)=>{i.value=i.value||new N,i.value.setFromMatrixPosition(n.matrixWorld),i.value.applyMatrix4(t.matrixWorldInverse)}))}const yN=n=>to.transformDirection(vN(n).sub(w$(n))),M$=n=>n.sort((e,t)=>e.id-t.id),E$=(n,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===n)return t;return null},iS=new WeakMap;class xN extends tt{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=ne().toVar("totalDiffuse"),this.totalSpecularNode=ne().toVar("totalSpecular"),this.outgoingLightNode=ne().toVar("outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=[],t=this._lights;for(let i=0;i<t.length;i++)e.push(t[i].id);return ox(e)}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const i of this._lightNodes)t.push(i.getSelf().getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getDataFromNode(this);for(const i of t.nodes)i.build(e)}setupLightsNode(e){const t=[],i=this._lightNodes,r=M$(this._lights),s=e.renderer.library;for(const o of r)if(o.isNode)t.push(pe(o));else{let a=null;if(i!==null&&(a=E$(o.id,i)),a===null){const l=s.getLightNodeClass(o.constructor);if(l===null){console.warn(`LightsNode.setupNodeLights: Light node not found for ${o.constructor.name}`);continue}let u=null;iS.has(o)?u=iS.get(o):(u=pe(new l(o)),iS.set(o,u)),t.push(u)}}this._lightNodes=t}setupLights(e,t){for(const i of t)i.build(e)}setup(e){this._lightNodes===null&&this.setupLightsNode(e);const t=e.context,i=t.lightingModel;let r=this.outgoingLightNode;if(i){const{_lightNodes:s,totalDiffuseNode:o,totalSpecularNode:a}=this;t.outgoingLight=r;const l=e.addStack(),u=e.getDataFromNode(this);u.nodes=l.nodes,i.start(t,l,e),this.setupLights(e,s),i.indirect(t,l,e);const{backdrop:c,backdropAlpha:h}=t,{directDiffuse:d,directSpecular:f,indirectDiffuse:m,indirectSpecular:_}=t.reflectedLight;let g=d.add(m);c!==null&&(h!==null?g=ne(h.mix(g,c)):g=ne(c),t.material.transparent=!0),o.assign(g),a.assign(f.add(_)),r.assign(o.add(a)),i.finish(t,l,e),r=r.bypass(e.removeStack())}return r}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}class A$ extends tt{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=at.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({material:e}){SN.assign(e.shadowPositionNode||fd)}dispose(){this.updateBeforeType=at.NONE}}const SN=ne().toVar("shadowPositionWorld");function C$(n,e={}){return e.toneMapping=n.toneMapping,e.toneMappingExposure=n.toneMappingExposure,e.outputColorSpace=n.outputColorSpace,e.renderTarget=n.getRenderTarget(),e.activeCubeFace=n.getActiveCubeFace(),e.activeMipmapLevel=n.getActiveMipmapLevel(),e.renderObjectFunction=n.getRenderObjectFunction(),e.pixelRatio=n.getPixelRatio(),e.mrt=n.getMRT(),e.clearColor=n.getClearColor(e.clearColor||new Ue),e.clearAlpha=n.getClearAlpha(),e.autoClear=n.autoClear,e.scissorTest=n.getScissorTest(),e}function R$(n,e){return e=C$(n,e),n.setMRT(null),n.setRenderObjectFunction(null),n.setClearColor(0,1),n.autoClear=!0,e}function N$(n,e){n.toneMapping=e.toneMapping,n.toneMappingExposure=e.toneMappingExposure,n.outputColorSpace=e.outputColorSpace,n.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),n.setRenderObjectFunction(e.renderObjectFunction),n.setPixelRatio(e.pixelRatio),n.setMRT(e.mrt),n.setClearColor(e.clearColor,e.clearAlpha),n.autoClear=e.autoClear,n.setScissorTest(e.scissorTest)}function P$(n,e={}){return e.background=n.background,e.backgroundNode=n.backgroundNode,e.overrideMaterial=n.overrideMaterial,e}function D$(n,e){return e=P$(n,e),n.background=null,n.backgroundNode=null,n.overrideMaterial=null,e}function L$(n,e){n.background=e.background,n.backgroundNode=e.backgroundNode,n.overrideMaterial=e.overrideMaterial}function I$(n,e,t){return t=R$(n,t),t=D$(e,t),t}function U$(n,e,t){N$(n,t),L$(e,t)}const TN=new WeakMap,F$=me(([n,e,t])=>{let i=fd.sub(n).length();return i=i.sub(e).div(t.sub(e)),i=i.saturate(),i}),O$=n=>{const e=n.shadow.camera,t=Dt("near","float",e).setGroup(Xe),i=Dt("far","float",e).setGroup(Xe),r=LH(n);return F$(r,t,i)},B$=n=>{let e=TN.get(n);if(e===void 0){const t=n.isPointLight?O$(n):null;e=new bn,e.colorNode=Qe(0,0,0,1),e.depthNode=t,e.isShadowNodeMaterial=!0,e.name="ShadowMaterial",e.fog=!1,TN.set(n,e)}return e},k$=me(({depthTexture:n,shadowCoord:e})=>yt(n,e.xy).compare(e.z)),z$=me(({depthTexture:n,shadowCoord:e,shadow:t})=>{const i=(_,g)=>yt(n,_).compare(g),r=Dt("mapSize","vec2",t).setGroup(Xe),s=Dt("radius","float",t).setGroup(Xe),o=ye(1).div(r),a=o.x.negate().mul(s),l=o.y.negate().mul(s),u=o.x.mul(s),c=o.y.mul(s),h=a.div(2),d=l.div(2),f=u.div(2),m=c.div(2);return yi(i(e.xy.add(ye(a,l)),e.z),i(e.xy.add(ye(0,l)),e.z),i(e.xy.add(ye(u,l)),e.z),i(e.xy.add(ye(h,d)),e.z),i(e.xy.add(ye(0,d)),e.z),i(e.xy.add(ye(f,d)),e.z),i(e.xy.add(ye(a,0)),e.z),i(e.xy.add(ye(h,0)),e.z),i(e.xy,e.z),i(e.xy.add(ye(f,0)),e.z),i(e.xy.add(ye(u,0)),e.z),i(e.xy.add(ye(h,m)),e.z),i(e.xy.add(ye(0,m)),e.z),i(e.xy.add(ye(f,m)),e.z),i(e.xy.add(ye(a,c)),e.z),i(e.xy.add(ye(0,c)),e.z),i(e.xy.add(ye(u,c)),e.z)).mul(1/17)}),G$=me(({depthTexture:n,shadowCoord:e,shadow:t})=>{const i=(c,h)=>yt(n,c).compare(h),r=Dt("mapSize","vec2",t).setGroup(Xe),s=ye(1).div(r),o=s.x,a=s.y,l=e.xy,u=qo(l.mul(r).add(.5));return l.subAssign(u.mul(s)),yi(i(l,e.z),i(l.add(ye(o,0)),e.z),i(l.add(ye(0,a)),e.z),i(l.add(s),e.z),Gt(i(l.add(ye(o.negate(),0)),e.z),i(l.add(ye(o.mul(2),0)),e.z),u.x),Gt(i(l.add(ye(o.negate(),a)),e.z),i(l.add(ye(o.mul(2),a)),e.z),u.x),Gt(i(l.add(ye(0,a.negate())),e.z),i(l.add(ye(0,a.mul(2))),e.z),u.y),Gt(i(l.add(ye(o,a.negate())),e.z),i(l.add(ye(o,a.mul(2))),e.z),u.y),Gt(Gt(i(l.add(ye(o.negate(),a.negate())),e.z),i(l.add(ye(o.mul(2),a.negate())),e.z),u.x),Gt(i(l.add(ye(o.negate(),a.mul(2))),e.z),i(l.add(ye(o.mul(2),a.mul(2))),e.z),u.x),u.y)).mul(1/9)}),V$=me(({depthTexture:n,shadowCoord:e})=>{const t=te(1).toVar(),i=yt(n).sample(e.xy).rg,r=$C(e.z,i.x);return yn(r.notEqual(te(1)),()=>{const s=e.z.sub(i.x),o=Li(0,i.y.mul(i.y));let a=o.div(o.add(s.mul(s)));a=Zs(Di(a,.3).div(.95-.3)),t.assign(Zs(Li(r,a)))}),t}),H$=me(({samples:n,radius:e,size:t,shadowPass:i})=>{const r=te(0).toVar(),s=te(0).toVar(),o=n.lessThanEqual(te(1)).select(te(0),te(2).div(n.sub(1))),a=n.lessThanEqual(te(1)).select(te(0),te(-1));Wr({start:on(0),end:on(n),type:"int",condition:"<"},({i:u})=>{const c=a.add(te(u).mul(o)),h=i.sample(yi(Vm.xy,ye(0,c).mul(e)).div(t)).x;r.addAssign(h),s.addAssign(h.mul(h))}),r.divAssign(n),s.divAssign(n);const l=Tx(s.sub(r.mul(r)));return ye(r,l)}),W$=me(({samples:n,radius:e,size:t,shadowPass:i})=>{const r=te(0).toVar(),s=te(0).toVar(),o=n.lessThanEqual(te(1)).select(te(0),te(2).div(n.sub(1))),a=n.lessThanEqual(te(1)).select(te(0),te(-1));Wr({start:on(0),end:on(n),type:"int",condition:"<"},({i:u})=>{const c=a.add(te(u).mul(o)),h=i.sample(yi(Vm.xy,ye(c,0).mul(e)).div(t));r.addAssign(h.x),s.addAssign(yi(h.y.mul(h.y),h.x.mul(h.x)))}),r.divAssign(n),s.divAssign(n);const l=Tx(s.sub(r.mul(r)));return ye(r,l)}),$$=[k$,z$,G$,V$];let rS;const Zm=new dN;class bN extends A${static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this.isShadowNode=!0}setupShadowFilter(e,{filterFn:t,depthTexture:i,shadowCoord:r,shadow:s}){const o=r.x.greaterThanEqual(0).and(r.x.lessThanEqual(1)).and(r.y.greaterThanEqual(0)).and(r.y.lessThanEqual(1)).and(r.z.lessThanEqual(1)),a=t({depthTexture:i,shadowCoord:r,shadow:s});return o.select(a,te(1))}setupShadowCoord(e,t){const{shadow:i}=this,{renderer:r}=e,s=Dt("bias","float",i).setGroup(Xe);let o=t,a;if(i.camera.isOrthographicCamera||r.logarithmicDepthBuffer!==!0)o=o.xyz.div(o.w),a=o.z,r.coordinateSystem===Uo&&(a=a.mul(2).sub(1));else{const l=o.w;o=o.xy.div(l);const u=Dt("near","float",i.camera).setGroup(Xe),c=Dt("far","float",i.camera).setGroup(Xe);a=bR(l.negate(),u,c)}return o=ne(o.x,o.y.oneMinus(),a.add(s)),o}getShadowFilterFn(e){return $$[e]}setupShadow(e){const{renderer:t}=e,{light:i,shadow:r}=this,s=t.shadowMap.type,o=new Ho(r.mapSize.width,r.mapSize.height);o.compareFunction=lp;const a=e.createRenderTarget(r.mapSize.width,r.mapSize.height);if(a.depthTexture=o,r.camera.updateProjectionMatrix(),s===Xi){o.compareFunction=null,this.vsmShadowMapVertical=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:Aa,type:hi}),this.vsmShadowMapHorizontal=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:Aa,type:hi});const p=yt(o),v=yt(this.vsmShadowMapVertical.texture),y=Dt("blurSamples","float",r).setGroup(Xe),x=Dt("radius","float",r).setGroup(Xe),T=Dt("mapSize","vec2",r).setGroup(Xe);let S=this.vsmMaterialVertical||(this.vsmMaterialVertical=new bn);S.fragmentNode=H$({samples:y,radius:x,size:T,shadowPass:p}).context(e.getSharedContext()),S.name="VSMVertical",S=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new bn),S.fragmentNode=W$({samples:y,radius:x,size:T,shadowPass:v}).context(e.getSharedContext()),S.name="VSMHorizontal"}const l=Dt("intensity","float",r).setGroup(Xe),u=Dt("normalBias","float",r).setGroup(Xe),c=_N(i).mul(SN.add(Px.mul(u))),h=this.setupShadowCoord(e,c),d=r.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(d===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const f=s===Xi?this.vsmShadowMapHorizontal.texture:o,m=this.setupShadowFilter(e,{filterFn:d,shadowTexture:a.texture,depthTexture:f,shadowCoord:h,shadow:r}),_=yt(a.texture,h),g=Gt(1,m.rgb.mix(_,1),l.mul(_.a)).toVar();return this.shadowMap=a,this.shadow.map=a,g}setup(e){if(e.renderer.shadowMap.enabled!==!1)return me(()=>{let t=this._node;return this.setupShadowPosition(e),t===null&&(this._node=t=this.setupShadow(e)),e.material.shadowNode&&console.warn('THREE.NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(t=e.material.receivedShadowNode(t)),t})()}renderShadow(e){const{shadow:t,shadowMap:i,light:r}=this,{renderer:s,scene:o}=e;t.updateMatrices(r),i.setSize(t.mapSize.width,t.mapSize.height),s.render(o,t.camera)}updateShadow(e){const{shadowMap:t,light:i,shadow:r}=this,{renderer:s,scene:o,camera:a}=e,l=s.shadowMap.type,u=t.depthTexture.version;this._depthVersionCached=u,r.camera.layers.mask=a.layers.mask;const c=s.getRenderObjectFunction(),h=s.getMRT(),d=h?h.has("velocity"):!1;rS=I$(s,o,rS),o.overrideMaterial=B$(i),s.setRenderObjectFunction((f,m,_,g,p,v,...y)=>{(f.castShadow===!0||f.receiveShadow&&l===Xi)&&(d&&(hC(f).useVelocity=!0),f.onBeforeShadow(s,f,a,r.camera,g,m.overrideMaterial,v),s.renderObject(f,m,_,g,p,v,...y),f.onAfterShadow(s,f,a,r.camera,g,m.overrideMaterial,v))}),s.setRenderTarget(t),this.renderShadow(e),s.setRenderObjectFunction(c),i.isPointLight!==!0&&l===Xi&&this.vsmPass(s),U$(s,o,rS)}vsmPass(e){const{shadow:t}=this;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height),e.setRenderTarget(this.vsmShadowMapVertical),Zm.material=this.vsmMaterialVertical,Zm.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),Zm.material=this.vsmMaterialHorizontal,Zm.render(e)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),super.dispose()}updateBefore(e){const{shadow:t}=this;(t.needsUpdate||t.autoUpdate)&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const j$=(n,e)=>pe(new bN(n,e));class Za extends Yu{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new Ue,this.colorNode=e&&e.colorNode||Ze(this.color).setGroup(Xe),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=at.FRAME}customCacheKey(){return ax(this.light.id,this.light.castShadow?1:0)}getHash(){return this.light.uuid}setupShadowNode(){return j$(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let i=this.shadowColorNode;if(i===null){const r=this.light.shadow.shadowNode;let s;r!==void 0?s=pe(r):s=this.setupShadowNode(e),this.shadowNode=s,this.shadowColorNode=i=this.colorNode.mul(s),this.baseColorNode=this.colorNode}this.colorNode=i}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const wN=me(n=>{const{lightDistance:e,cutoffDistance:t,decayExponent:i}=n,r=e.pow(i).max(.01).reciprocal();return t.greaterThan(0).select(r.mul(e.div(t).pow4().oneMinus().clamp().pow2()),r)}),X$=new Ue,fs=me(([n,e])=>{const t=n.toVar(),i=vr(t),r=Ks(1,Li(i.x,Li(i.y,i.z)));i.mulAssign(r),t.mulAssign(r.mul(e.mul(2).oneMinus()));const s=ye(t.xy).toVar(),a=e.mul(1.5).oneMinus();return yn(i.z.greaterThanEqual(a),()=>{yn(t.z.greaterThan(0),()=>{s.x.assign(Di(4,t.x))})}).ElseIf(i.x.greaterThanEqual(a),()=>{const l=Lm(t.x);s.x.assign(t.z.mul(l).add(l.mul(2)))}).ElseIf(i.y.greaterThanEqual(a),()=>{const l=Lm(t.y);s.x.assign(t.x.add(l.mul(2)).add(2)),s.y.assign(t.z.mul(l).sub(2))}),ye(.125,.25).mul(s).add(ye(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),q$=me(({depthTexture:n,bd3D:e,dp:t,texelSize:i})=>yt(n,fs(e,i.y)).compare(t)),Y$=me(({depthTexture:n,bd3D:e,dp:t,texelSize:i,shadow:r})=>{const s=Dt("radius","float",r).setGroup(Xe),o=ye(-1,1).mul(s).mul(i.y);return yt(n,fs(e.add(o.xyy),i.y)).compare(t).add(yt(n,fs(e.add(o.yyy),i.y)).compare(t)).add(yt(n,fs(e.add(o.xyx),i.y)).compare(t)).add(yt(n,fs(e.add(o.yyx),i.y)).compare(t)).add(yt(n,fs(e,i.y)).compare(t)).add(yt(n,fs(e.add(o.xxy),i.y)).compare(t)).add(yt(n,fs(e.add(o.yxy),i.y)).compare(t)).add(yt(n,fs(e.add(o.xxx),i.y)).compare(t)).add(yt(n,fs(e.add(o.yxx),i.y)).compare(t)).mul(1/9)}),K$=me(({filterFn:n,depthTexture:e,shadowCoord:t,shadow:i})=>{const r=t.xyz.toVar(),s=r.length(),o=Ze("float").setGroup(Xe).onRenderUpdate(()=>i.camera.near),a=Ze("float").setGroup(Xe).onRenderUpdate(()=>i.camera.far),l=Dt("bias","float",i).setGroup(Xe),u=Ze(i.mapSize).setGroup(Xe),c=te(1).toVar();return yn(s.sub(a).lessThanEqual(0).and(s.sub(o).greaterThanEqual(0)),()=>{const h=s.sub(o).div(a.sub(o)).toVar();h.addAssign(l);const d=r.normalize(),f=ye(1).div(u.mul(ye(4,2)));c.assign(n({depthTexture:e,bd3D:d,dp:h,texelSize:f,shadow:i}))}),c}),MN=new et,Zu=new ce,Ad=new ce;class Q$ extends bN{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===KL?q$:Y$}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,shadowTexture:i,depthTexture:r,shadowCoord:s,shadow:o}){return K$({filterFn:t,shadowTexture:i,depthTexture:r,shadowCoord:s,shadow:o})}renderShadow(e){const{shadow:t,shadowMap:i,light:r}=this,{renderer:s,scene:o}=e,a=t.getFrameExtents();Ad.copy(t.mapSize),Ad.multiply(a),i.setSize(Ad.width,Ad.height),Zu.copy(t.mapSize);const l=s.autoClear,u=s.getClearColor(X$),c=s.getClearAlpha();s.autoClear=!1,s.setClearColor(t.clearColor,t.clearAlpha),s.clear();const h=t.getViewportCount();for(let d=0;d<h;d++){const f=t.getViewport(d),m=Zu.x*f.x,_=Ad.y-Zu.y-Zu.y*f.y;MN.set(m,_,Zu.x*f.z,Zu.y*f.w),i.viewport.copy(MN),t.updateMatrices(r,d),s.render(o,t.camera)}s.autoClear=l,s.setClearColor(u,c)}}const Z$=(n,e)=>pe(new Q$(n,e)),J$=me(({color:n,lightViewPosition:e,cutoffDistance:t,decayExponent:i},r)=>{const s=r.context.lightingModel,o=e.sub(xn),a=o.normalize(),l=o.length(),u=wN({lightDistance:l,cutoffDistance:t,decayExponent:i}),c=n.mul(u),h=r.context.reflectedLight;s.direct({lightDirection:a,lightColor:c,reflectedLight:h},r.stack,r)});class e9 extends Za{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=Ze(0).setGroup(Xe),this.decayExponentNode=Ze(2).setGroup(Xe)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return Z$(this.light)}setup(e){super.setup(e),J$({color:this.colorNode,lightViewPosition:nS(this.light),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode}).append()}}const t9=me(([n,e])=>{const t=n.x,i=n.y,r=n.z;let s=e.element(0).mul(.886227);return s=s.add(e.element(1).mul(2*.511664).mul(i)),s=s.add(e.element(2).mul(2*.511664).mul(r)),s=s.add(e.element(3).mul(2*.511664).mul(t)),s=s.add(e.element(4).mul(2*.429043).mul(t).mul(i)),s=s.add(e.element(5).mul(2*.429043).mul(i).mul(r)),s=s.add(e.element(6).mul(r.mul(r).mul(.743125).sub(.247708))),s=s.add(e.element(7).mul(2*.429043).mul(t).mul(r)),s=s.add(e.element(8).mul(.429043).mul(ht(t,t).sub(ht(i,i)))),s}),no=new Zx;class n9 extends Jo{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,i){const r=this.renderer,s=this.nodes.getBackgroundNode(e)||e.background;let o=!1;if(s===null)r._clearColor.getRGB(no,mr),no.a=r._clearColor.a;else if(s.isColor===!0)s.getRGB(no,mr),no.a=1,o=!0;else if(s.isNode===!0){const a=this.get(e),l=s;no.copy(r._clearColor);let u=a.backgroundMesh;if(u===void 0){const h=Mx(Qe(l).mul(fN),{getUV:()=>o$.mul(sR),getTextureLevel:()=>s$});let d=gR;d=d.setZ(d.w);const f=new bn;f.name="Background.material",f.side=$t,f.depthTest=!1,f.depthWrite=!1,f.fog=!1,f.lights=!1,f.vertexNode=d,f.colorNode=h,a.backgroundMeshNode=h,a.backgroundMesh=u=new On(new Oh(1,32,32),f),u.frustumCulled=!1,u.name="Background.mesh",u.onBeforeRender=function(m,_,g){this.matrixWorld.copyPosition(g.matrixWorld)}}const c=l.getCacheKey();a.backgroundCacheKey!==c&&(a.backgroundMeshNode.node=Qe(l).mul(fN),a.backgroundMeshNode.needsUpdate=!0,u.material.needsUpdate=!0,a.backgroundCacheKey=c),t.unshift(u,u.geometry,u.material,0,0,null,null)}else console.error("THREE.Renderer: Unsupported background configuration.",s);if(r.autoClear===!0||o===!0){const a=i.clearColorValue;a.r=no.r,a.g=no.g,a.b=no.b,a.a=no.a,(r.backend.isWebGLBackend===!0||r.alpha===!0)&&(a.r*=a.a,a.g*=a.a,a.b*=a.a),i.depthClearValue=r._clearDepth,i.stencilClearValue=r._clearStencil,i.clearColor=r.autoClearColor===!0,i.clearDepth=r.autoClearDepth===!0,i.clearStencil=r.autoClearStencil===!0}else i.clearColor=!1,i.clearDepth=!1,i.clearStencil=!1}}let i9=0;class sS{constructor(e="",t=[],i=0,r=[]){this.name=e,this.bindings=t,this.index=i,this.bindingsReference=r,this.id=i9++}}class r9{constructor(e,t,i,r,s,o,a,l,u,c=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=i,this.transforms=c,this.nodeAttributes=r,this.bindings=s,this.updateNodes=o,this.updateBeforeNodes=a,this.updateAfterNodes=l,this.monitor=u,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const r=new sS(t.name,[],t.index,t);e.push(r);for(const s of t.bindings)r.bindings.push(s.clone())}else e.push(t);return e}}class EN{constructor(e,t,i=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=i}}class s9{constructor(e,t,i){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=i.getSelf()}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class AN{constructor(e,t){this.isNodeVar=!0,this.name=e,this.type=t}}class o9 extends AN{constructor(e,t){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0}}class a9{constructor(e,t,i=""){this.name=e,this.type=t,this.code=i,Object.defineProperty(this,"isNodeCode",{value:!0})}}let l9=0;class oS{constructor(e=null){this.id=l9++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class u9 extends tt{static get type(){return"StructTypeNode"}constructor(e,t){super(),this.name=e,this.types=t,this.isStructTypeNode=!0}getMemberTypes(){return this.types}}class Ja{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class c9 extends Ja{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class h9 extends Ja{constructor(e,t=new ce){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class d9 extends Ja{constructor(e,t=new N){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class f9 extends Ja{constructor(e,t=new et){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class p9 extends Ja{constructor(e,t=new Ue){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class m9 extends Ja{constructor(e,t=new je){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class g9 extends Ja{constructor(e,t=new pt){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class _9 extends c9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class v9 extends h9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class y9 extends d9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class x9 extends f9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class S9 extends p9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class T9 extends m9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class b9 extends g9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}const Ju=4,CN=[.125,.215,.35,.446,.526,.582],el=20,aS=new kh(-1,1,1,-1,0,1),w9=new pi(90,1),RN=new Ue;let lS=null,uS=0,cS=0;const tl=(1+Math.sqrt(5))/2,ec=1/tl,NN=[new N(-tl,ec,0),new N(tl,ec,0),new N(-ec,0,tl),new N(ec,0,tl),new N(0,tl,-ec),new N(0,tl,ec),new N(-1,1,-1),new N(1,1,-1),new N(-1,1,1),new N(1,1,1)],M9=[3,1,5,0,4,2],hS=eW(km(),eo("faceIndex")).normalize(),dS=ne(hS.x,hS.y,hS.z);class E9{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,i=.1,r=100,s=null){if(this._setSize(256),this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromScene() called before the backend is initialized. Try using .fromSceneAsync() instead.");const a=s||this._allocateTargets();return this.fromSceneAsync(e,t,i,r,a),a}lS=this._renderer.getRenderTarget(),uS=this._renderer.getActiveCubeFace(),cS=this._renderer.getActiveMipmapLevel();const o=s||this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,i,r,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}async fromSceneAsync(e,t=0,i=.1,r=100,s=null){return this._hasInitialized===!1&&await this._renderer.init(),this.fromScene(e,t,i,r,s)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using .fromEquirectangularAsync() instead."),this._setSizeFromTexture(e);const i=t||this._allocateTargets();return this.fromEquirectangularAsync(e,i),i}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const i=t||this._allocateTargets();return this.fromCubemapAsync(e,t),i}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=DN(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=LN(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===fr||e.mapping===pr?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(lS,uS,cS),e.scissorTest=!1,Jm(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),lS=this._renderer.getRenderTarget(),uS=this._renderer.getActiveCubeFace(),cS=this._renderer.getActiveMipmapLevel();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:mn,minFilter:mn,generateMipmaps:!1,type:hi,format:Gn,colorSpace:mr},r=PN(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=PN(e,t,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=A9(s)),this._blurMaterial=C9(s,e,t)}return r}async _compileMaterial(e){const t=new On(this._lodPlanes[0],e);await this._renderer.compile(t,aS)}_sceneToCubeUV(e,t,i,r){const s=w9;s.near=t,s.far=i;const o=[1,1,1,1,-1,1],a=[1,-1,1,-1,1,-1],l=this._renderer,u=l.autoClear;l.getClearColor(RN),l.autoClear=!1;let c=this._backgroundBox;if(c===null){const f=new Ch({name:"PMREM.Background",side:$t,depthWrite:!1,depthTest:!1});c=new On(new Fa,f)}let h=!1;const d=e.background;d?d.isColor&&(c.material.color.copy(d),e.background=null,h=!0):(c.material.color.copy(RN),h=!0),l.setRenderTarget(r),l.clear(),h&&l.render(c,s);for(let f=0;f<6;f++){const m=f%3;m===0?(s.up.set(0,o[f],0),s.lookAt(a[f],0,0)):m===1?(s.up.set(0,0,o[f]),s.lookAt(0,a[f],0)):(s.up.set(0,o[f],0),s.lookAt(0,0,a[f]));const _=this._cubeSize;Jm(r,m*_,f>2?_:0,_,_),l.render(e,s)}l.autoClear=u,e.background=d}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===fr||e.mapping===pr;r?this._cubemapMaterial===null&&(this._cubemapMaterial=DN(e)):this._equirectMaterial===null&&(this._equirectMaterial=LN(e));const s=r?this._cubemapMaterial:this._equirectMaterial;s.fragmentNode.value=e;const o=this._lodMeshes[0];o.material=s;const a=this._cubeSize;Jm(t,0,0,3*a,2*a),i.setRenderTarget(t),i.render(o,aS)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let s=1;s<r;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=NN[(r-s-1)%NN.length];this._blur(e,s-1,s,o,a)}t.autoClear=i}_blur(e,t,i,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,r,"latitudinal",s),this._halfBlur(o,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,o,a){const l=this._renderer,u=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const c=3,h=this._lodMeshes[r];h.material=u;const d=u.uniforms,f=this._sizeLods[i]-1,m=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*el-1),_=s/m,g=isFinite(s)?1+Math.floor(c*_):el;g>el&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${el}`);const p=[];let v=0;for(let w=0;w<el;++w){const E=w/_,M=Math.exp(-E*E/2);p.push(M),w===0?v+=M:w<g&&(v+=2*M)}for(let w=0;w<p.length;w++)p[w]=p[w]/v;e.texture.frame=(e.texture.frame||0)+1,d.envMap.value=e.texture,d.samples.value=g,d.weights.array=p,d.latitudinal.value=o==="latitudinal"?1:0,a&&(d.poleAxis.value=a);const{_lodMax:y}=this;d.dTheta.value=m,d.mipInt.value=y-i;const x=this._sizeLods[r],T=3*x*(r>y-Ju?r-y+Ju:0),S=4*(this._cubeSize-x);Jm(t,T,S,3*x,2*x),l.setRenderTarget(t),l.render(h,aS)}}function A9(n){const e=[],t=[],i=[],r=[];let s=n;const o=n-Ju+1+CN.length;for(let a=0;a<o;a++){const l=Math.pow(2,s);t.push(l);let u=1/l;a>n-Ju?u=CN[a-n+Ju-1]:a===0&&(u=0),i.push(u);const c=1/(l-2),h=-c,d=1+c,f=[h,h,d,h,d,d,h,h,d,d,h,d],m=6,_=6,g=3,p=2,v=1,y=new Float32Array(g*_*m),x=new Float32Array(p*_*m),T=new Float32Array(v*_*m);for(let w=0;w<m;w++){const E=w%3*2/3-1,M=w>2?0:-1,b=[E,M,0,E+2/3,M,0,E+2/3,M+1,0,E,M,0,E+2/3,M+1,0,E,M+1,0],R=M9[w];y.set(b,g*_*R),x.set(f,p*_*R);const I=[R,R,R,R,R,R];T.set(I,v*_*R)}const S=new ei;S.setAttribute("position",new Vn(y,g)),S.setAttribute("uv",new Vn(x,p)),S.setAttribute("faceIndex",new Vn(T,v)),e.push(S),r.push(new On(S,null)),s>Ju&&s--}return{lodPlanes:e,sizeLods:t,sigmas:i,lodMeshes:r}}function PN(n,e,t){const i=new fu(n,e,t);return i.texture.mapping=Ta,i.texture.name="PMREM.cubeUv",i.texture.isPMREMTexture=!0,i.scissorTest=!0,i}function Jm(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function fS(n){const e=new bn;return e.depthTest=!1,e.depthWrite=!1,e.blending=Ei,e.name=`PMREM_${n}`,e}function C9(n,e,t){const i=Qo(new Array(el).fill(0)),r=Ze(new N(0,1,0)),s=Ze(0),o=te(el),a=Ze(0),l=Ze(1),u=yt(null),c=Ze(0),h=te(1/e),d=te(1/t),f=te(n),m={n:o,latitudinal:a,weights:i,poleAxis:r,outputDirection:dS,dTheta:s,samples:l,envMap:u,mipInt:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:f},_=fS("blur");return _.uniforms=m,_.fragmentNode=nW({...m,latitudinal:a.equal(1)}),_}function DN(n){const e=fS("cubemap");return e.fragmentNode=md(n,dS),e}function LN(n){const e=fS("equirect");return e.fragmentNode=yt(n,CR(dS),0),e}const IN=new WeakMap,R9=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),eg=n=>/e/g.test(n)?String(n).replace(/\+/g,""):(n=Number(n),n+(n%1?"":".0"));class UN{constructor(e,t,i){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=i,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.monitor=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.flow={code:""},this.chaining=[],this.stack=Jx(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new oS,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.useComparisonMethod=!1}getBindGroupsCache(){let e=IN.get(this.renderer);return e===void 0&&(e=new cs,IN.set(this.renderer,e)),e}createRenderTarget(e,t,i){return new fu(e,t,i)}createCubeRenderTarget(e,t){return new RR(e,t)}createPMREMGenerator(){return new E9(this.renderer)}includes(e){return this.nodes.includes(e)}_getBindGroup(e,t){const i=this.getBindGroupsCache(),r=[];let s=!0;for(const a of t)r.push(a),s=s&&a.groupNode.shared!==!0;let o;return s?(o=i.get(r),o===void 0&&(o=new sS(e,r,this.bindingsIndexes[e].group,r),i.set(r,o))):o=new sS(e,r,this.bindingsIndexes[e].group,r),o}getBindGroupArray(e,t){const i=this.bindings[t];let r=i[e];return r===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),i[e]=r=[]),r}getBindings(){let e=this.bindGroups;if(e===null){const t={},i=this.bindings;for(const r of pC)for(const s in i[r]){const o=i[r][s];(t[s]||(t[s]=[])).push(...o)}e=[];for(const r in t){const s=t[r],o=this._getBindGroup(r,s);e.push(o)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,i)=>t.bindings[0].groupNode.order-i.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const i=e[t];this.bindingsIndexes[i.name].group=t,i.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==at.NONE&&this.updateNodes.push(e.getSelf());for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),i=e.getUpdateAfterType();t!==at.NONE&&this.updateBeforeNodes.push(e.getSelf()),i!==at.NONE&&this.updateAfterNodes.push(e.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===mn||e.magFilter===Hl||e.magFilter===es||e.magFilter===ci||e.minFilter===mn||e.minFilter===Hl||e.minFilter===es||e.minFilter===ci}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}getSharedContext(){return{...this.context},this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const i=this.getDataFromNode(e);return i.cache===void 0&&(i.cache=new oS(t?this.getCache():null)),i.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new Ue:e==="vec2"?t=new ce:e==="vec3"?t=new N:e==="vec4"&&(t=new et)),e==="float")return eg(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${eg(t.r)}, ${eg(t.g)}, ${eg(t.b)} )`;const i=this.getTypeLength(e),r=this.getComponentType(e),s=o=>this.generateConst(r,o);if(i===2)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)} )`;if(i===3)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)} )`;if(i===4)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)}, ${s(t.w)} )`;if(i>4&&t&&(t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(s).join(", ")} )`;if(i>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const i=this.attributes;for(const s of i)if(s.name===e)return s;const r=new EN(e,t);return i.push(r),r}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===Un)return"int";if(t===en)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;const i=EV(e);return(t==="float"?"":t[0])+i}getTypeFromArray(e){return R9.get(e.constructor)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const i=t.array,r=e.itemSize,s=e.normalized;let o;return!(e instanceof hE)&&s!==!0&&(o=this.getTypeFromArray(i)),this.getTypeFromLength(r,o)}getTypeLength(e){const t=this.getVectorType(e),i=/vec([2-4])/.exec(t);return i!==null?Number(i[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}addStack(){return this.stack=Jx(this.stack),this.stacks.push(wC()||this.stack),Mm(this.stack),this.stack}removeStack(){const e=this.stack;return this.stack=e.parent,Mm(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,i=null){i=i===null?e.isGlobal(this)?this.globalCache:this.cache:i;let r=i.getData(e);return r===void 0&&(r={},i.setData(e,r)),r[t]===void 0&&(r[t]={}),r[t]}getNodeProperties(e,t="any"){const i=this.getDataFromNode(e,t);return i.properties||(i.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const i=this.getDataFromNode(e);let r=i.bufferAttribute;if(r===void 0){const s=this.uniforms.index++;r=new EN("nodeAttribute"+s,t,e),this.bufferAttributes.push(r),i.bufferAttribute=r}return r}getStructTypeFromNode(e,t,i=this.shaderStage){const r=this.getDataFromNode(e,i);let s=r.structType;if(s===void 0){const o=this.structs.index++;s=new u9("StructType"+o,t),this.structs[i].push(s),r.structType=s}return s}getUniformFromNode(e,t,i=this.shaderStage,r=null){const s=this.getDataFromNode(e,i,this.globalCache);let o=s.uniform;if(o===void 0){const a=this.uniforms.index++;o=new s9(r||"nodeUniform"+a,t,e),this.uniforms[i].push(o),s.uniform=o}return o}getVarFromNode(e,t=null,i=e.getNodeType(this),r=this.shaderStage){const s=this.getDataFromNode(e,r);let o=s.variable;if(o===void 0){const a=this.vars[r]||(this.vars[r]=[]);t===null&&(t="nodeVar"+a.length),o=new AN(t,i),a.push(o),s.variable=o}return o}getVaryingFromNode(e,t=null,i=e.getNodeType(this)){const r=this.getDataFromNode(e,"any");let s=r.varying;if(s===void 0){const o=this.varyings,a=o.length;t===null&&(t="nodeVarying"+a),s=new o9(t,i),o.push(s),r.varying=s}return s}getCodeFromNode(e,t,i=this.shaderStage){const r=this.getDataFromNode(e);let s=r.code;if(s===void 0){const o=this.codes[i]||(this.codes[i]=[]),a=o.length;s=new a9("nodeCode"+a,t),o.push(s),r.code=s}return s}addFlowCodeHierarchy(e,t){const{flowCodes:i,flowCodeBlock:r}=this.getDataFromNode(e);let s=!0,o=t;for(;o;){if(r.get(o)===!0){s=!1;break}o=this.getDataFromNode(o).parentNodeBlock}if(s)for(const a of i)this.addLineFlowCode(a)}addLineFlowCodeBlock(e,t,i){const r=this.getDataFromNode(e),s=r.flowCodes||(r.flowCodes=[]),o=r.flowCodeBlock||(r.flowCodeBlock=new WeakMap);s.push(t),o.set(i,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),i=this.flowChildNode(e,t);return this.flowsData.set(e,i),i}buildFunctionNode(e){const t=new y$,i=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=i,t}flowShaderNode(e){const t=e.layout,i={[Symbol.iterator](){let o=0;const a=Object.values(this);return{next:()=>({value:a[o],done:o++>=a.length})}}};for(const o of t.inputs)i[o.name]=new e$(o.type,o.name);e.layout=null;const r=e.call(i),s=this.flowStagesNode(r,t.type);return e.layout=t,s}flowStagesNode(e,t=null){const i=this.flow,r=this.vars,s=this.cache,o=this.buildStage,a=this.stack,l={code:""};this.flow=l,this.vars={},this.cache=new oS,this.stack=Jx();for(const u of fC)this.setBuildStage(u),l.result=e.build(this,t);return l.vars=this.getVars(this.shaderStage),this.flow=i,this.vars=r,this.cache=s,this.stack=a,this.setBuildStage(o),l}getFunctionOperator(){return null}flowChildNode(e,t=null){const i=this.flow,r={code:""};return this.flow=r,r.result=e.build(this,t),this.flow=i,r}flowNodeFromShaderStage(e,t,i=null,r=null){const s=this.shaderStage;this.setShaderStage(e);const o=this.flowChildNode(t,i);return r!==null&&(o.code+=`${this.tab+r} = ${o.result};
`),this.flowCode[e]=this.flowCode[e]+o.code,this.setShaderStage(s),o}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(e,t){return`${this.getType(e)} ${t}`}getVars(e){let t="";const i=this.vars[e];if(i!==void 0)for(const r of i)t+=`${this.getVar(r.type,r.name)}; `;return t}getUniforms(){console.warn("Abstract function.")}getCodes(e){const t=this.codes[e];let i="";if(t!==void 0)for(const r of t)i+=r.code+`
`;return i}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){const{object:e,material:t,renderer:i}=this;if(t!==null){let r=i.library.fromMaterial(t);r===null&&(console.error(`NodeMaterial: Material "${t.type}" is not compatible.`),r=new bn),r.build(this)}else this.addFlow("compute",e);for(const r of fC){this.setBuildStage(r),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const s of pC){this.setShaderStage(s);const o=this.flowNodes[s];for(const a of o)r==="generate"?this.flowNode(a):a.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,t){if(t==="float"||t==="int"||t==="uint")return new _9(e);if(t==="vec2"||t==="ivec2"||t==="uvec2")return new v9(e);if(t==="vec3"||t==="ivec3"||t==="uvec3")return new y9(e);if(t==="vec4"||t==="ivec4"||t==="uvec4")return new x9(e);if(t==="color")return new S9(e);if(t==="mat3")return new T9(e);if(t==="mat4")return new b9(e);throw new Error(`Uniform "${t}" not declared.`)}format(e,t,i){if(t=this.getVectorType(t),i=this.getVectorType(i),t===i||i===null||this.isReference(i))return e;const r=this.getTypeLength(t),s=this.getTypeLength(i);return r===16&&s===9?`${this.getType(i)}(${e}[0].xyz, ${e}[1].xyz, ${e}[2].xyz)`:r===9&&s===4?`${this.getType(i)}(${e}[0].xy, ${e}[1].xy)`:r>4||s>4||s===0?e:r===s?`${this.getType(i)}( ${e} )`:r>s?this.format(`${e}.${"xyz".slice(0,s)}`,this.getTypeFromLength(s,this.getComponentType(t)),i):s===4&&r>1?`${this.getType(i)}( ${this.format(e,t,"vec3")}, 1.0 )`:r===2?`${this.getType(i)}( ${this.format(e,t,"vec2")}, 0.0 )`:(r===1&&s>1&&t!==this.getComponentType(i)&&(e=`${this.getType(this.getComponentType(i))}( ${e} )`),`${this.getType(i)}( ${e} )`)}getSignature(){return`// Three.js r${kl} - Node System
`}createNodeMaterial(e="NodeMaterial"){throw new Error(`THREE.NodeBuilder: createNodeMaterial() was deprecated. Use new ${e}() instead.`)}}class FN{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let i=e.get(t);return i===void 0&&(i={renderMap:new WeakMap,frameMap:new WeakMap},e.set(t,i)),i}updateBeforeNode(e){const t=e.getUpdateBeforeType(),i=e.updateReference(this);if(t===at.FRAME){const{frameMap:r}=this._getMaps(this.updateBeforeMap,i);r.get(i)!==this.frameId&&e.updateBefore(this)!==!1&&r.set(i,this.frameId)}else if(t===at.RENDER){const{renderMap:r}=this._getMaps(this.updateBeforeMap,i);r.get(i)!==this.renderId&&e.updateBefore(this)!==!1&&r.set(i,this.renderId)}else t===at.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),i=e.updateReference(this);if(t===at.FRAME){const{frameMap:r}=this._getMaps(this.updateAfterMap,i);r.get(i)!==this.frameId&&e.updateAfter(this)!==!1&&r.set(i,this.frameId)}else if(t===at.RENDER){const{renderMap:r}=this._getMaps(this.updateAfterMap,i);r.get(i)!==this.renderId&&e.updateAfter(this)!==!1&&r.set(i,this.renderId)}else t===at.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),i=e.updateReference(this);if(t===at.FRAME){const{frameMap:r}=this._getMaps(this.updateMap,i);r.get(i)!==this.frameId&&e.update(this)!==!1&&r.set(i,this.frameId)}else if(t===at.RENDER){const{renderMap:r}=this._getMaps(this.updateMap,i);r.get(i)!==this.renderId&&e.update(this)!==!1&&r.set(i,this.renderId)}else t===at.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class pS{constructor(e,t,i=null,r="",s=!1){this.type=e,this.name=t,this.count=i,this.qualifier=r,this.isConst=s}}pS.isNodeFunctionInput=!0;class N9 extends Za{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setup(e){super.setup(e);const t=e.context.lightingModel,i=this.colorNode,r=yN(this.light),s=e.context.reflectedLight;t.direct({lightDirection:r,lightColor:i,reflectedLight:s},e.stack,e)}}const mS=new pt,tg=new pt;let Cd=null;class P9 extends Za{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=Ze(new N).setGroup(Xe),this.halfWidth=Ze(new N).setGroup(Xe),this.updateType=at.RENDER}update(e){super.update(e);const{light:t}=this,i=e.camera.matrixWorldInverse;tg.identity(),mS.copy(t.matrixWorld),mS.premultiply(i),tg.extractRotation(mS),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(tg),this.halfHeight.value.applyMatrix4(tg)}setup(e){super.setup(e);let t,i;e.isAvailable("float32Filterable")?(t=yt(Cd.LTC_FLOAT_1),i=yt(Cd.LTC_FLOAT_2)):(t=yt(Cd.LTC_HALF_1),i=yt(Cd.LTC_HALF_2));const{colorNode:r,light:s}=this,o=e.context.lightingModel,a=nS(s),l=e.context.reflectedLight;o.directRectArea({lightColor:r,lightPosition:a,halfWidth:this.halfWidth,halfHeight:this.halfHeight,reflectedLight:l,ltc_1:t,ltc_2:i},e.stack,e)}static setLTC(e){Cd=e}}class ON extends Za{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=Ze(0).setGroup(Xe),this.penumbraCosNode=Ze(0).setGroup(Xe),this.cutoffDistanceNode=Ze(0).setGroup(Xe),this.decayExponentNode=Ze(0).setGroup(Xe)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e){const{coneCosNode:t,penumbraCosNode:i}=this;return qa(t,i,e)}setup(e){super.setup(e);const t=e.context.lightingModel,{colorNode:i,cutoffDistanceNode:r,decayExponentNode:s,light:o}=this,a=nS(o).sub(xn),l=a.normalize(),u=l.dot(yN(o)),c=this.getSpotAttenuation(u),h=a.length(),d=wN({lightDistance:h,cutoffDistance:r,decayExponent:s});let f=i.mul(c).mul(d);if(o.map){const _=b$(o),g=yt(o.map,_.xy).onRenderUpdate(()=>o.map);f=_.mul(2).sub(1).abs().lessThan(1).all().select(f.mul(g),f)}const m=e.context.reflectedLight;t.direct({lightDirection:l,lightColor:f,reflectedLight:m},e.stack,e)}}class D9 extends ON{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e){const t=this.light.iesMap;let i=null;if(t&&t.isTexture===!0){const r=e.acos().mul(1/Math.PI);i=yt(t,ye(r,0),0).r}else i=super.getSpotAttenuation(e);return i}}class L9 extends Za{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class I9 extends Za{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=vN(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Ze(new Ue).setGroup(Xe)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:i,lightDirectionNode:r}=this,o=Hr.dot(r).mul(.5).add(.5),a=Gt(i,t,o);e.context.irradiance.addAssign(a)}}class U9 extends Za{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let i=0;i<9;i++)t.push(new N);this.lightProbe=Qo(t)}update(e){const{light:t}=this;super.update(e);for(let i=0;i<9;i++)this.lightProbe.array[i].copy(t.sh.coefficients[i]).multiplyScalar(t.intensity)}setup(e){const t=t9(sR,this.lightProbe);e.context.irradiance.addAssign(t)}}class BN{parseFunction(){console.warn("Abstract function.")}}class gS{constructor(e,t,i="",r=""){this.type=e,this.inputs=t,this.name=i,this.precision=r}getCode(){console.warn("Abstract function.")}}gS.isNodeFunction=!0;const F9=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,O9=/[a-z_0-9]+/ig,kN="#pragma main",B9=n=>{n=n.trim();const e=n.indexOf(kN),t=e!==-1?n.slice(e+kN.length):n,i=t.match(F9);if(i!==null&&i.length===5){const r=i[4],s=[];let o=null;for(;(o=O9.exec(r))!==null;)s.push(o);const a=[];let l=0;for(;l<s.length;){const m=s[l][0]==="const";m===!0&&l++;let _=s[l][0];_==="in"||_==="out"||_==="inout"?l++:_="";const g=s[l++][0];let p=Number.parseInt(s[l][0]);Number.isNaN(p)===!1?l++:p=null;const v=s[l++][0];a.push(new pS(g,v,p,_,m))}const u=t.substring(i[0].length),c=i[3]!==void 0?i[3]:"",h=i[2],d=i[1]!==void 0?i[1]:"",f=e!==-1?n.slice(0,e):"";return{type:h,inputs:a,name:c,precision:d,inputsCode:r,blockCode:u,headerCode:f}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class k9 extends gS{constructor(e){const{type:t,inputs:i,name:r,precision:s,inputsCode:o,blockCode:a,headerCode:l}=B9(e);super(t,i,r,s),this.inputsCode=o,this.blockCode=a,this.headerCode=l}getCode(e=this.name){let t;const i=this.blockCode;if(i!==""){const{type:r,inputsCode:s,headerCode:o,precision:a}=this;let l=`${r} ${e} ( ${s.trim()} )`;a!==""&&(l=`${a} ${l}`),t=o+l+i}else t="";return t}}class z9 extends BN{parseFunction(e){return new k9(e)}}const zN=new WeakMap;class G9 extends Jo{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new FN,this.nodeBuilderCache=new Map,this.callHashCache=new cs,this.groupsData=new cs,this.cacheLib={}}updateGroup(e){const t=e.groupNode,i=t.name;if(i===CC.name)return!0;if(i===Xe.name){const o=this.get(e),a=this.nodeFrame.renderId;return o.renderId!==a?(o.renderId=a,!0):!1}if(i===a5.name){const o=this.get(e),a=this.nodeFrame.frameId;return o.frameId!==a?(o.frameId=a,!0):!1}const r=[t,e];let s=this.groupsData.get(r);return s===void 0&&this.groupsData.set(r,s={}),s.version!==t.version?(s.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let i=t.nodeBuilderState;if(i===void 0){const{nodeBuilderCache:r}=this,s=this.getForRenderCacheKey(e);if(i=r.get(s),i===void 0){const o=this.backend.createNodeBuilder(e.object,this.renderer);o.scene=e.scene,o.material=e.material,o.camera=e.camera,o.context.material=e.material,o.lightsNode=e.lightsNode,o.environmentNode=this.getEnvironmentNode(e.scene),o.fogNode=this.getFogNode(e.scene),o.clippingContext=e.clippingContext,o.build(),i=this._createNodeBuilderState(o),r.set(s,i)}i.usedTimes++,t.nodeBuilderState=i}return i}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let i=t.nodeBuilderState;if(i===void 0){const r=this.backend.createNodeBuilder(e,this.renderer);r.build(),i=this._createNodeBuilderState(r),t.nodeBuilderState=i}return i}_createNodeBuilderState(e){return new r9(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.monitor,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const i=this.get(e);i.environmentNode&&(t=i.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const i=this.get(e);i.backgroundNode&&(t=i.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){const i=[e,t],r=this.renderer.info.calls;let s=this.callHashCache.get(i);if(s===void 0||s.callId!==r){const o=this.getEnvironmentNode(e),a=this.getFogNode(e),l=[];t&&l.push(t.getCacheKey(!0)),o&&l.push(o.getCacheKey()),a&&l.push(a.getCacheKey()),l.push(this.renderer.shadowMap.enabled?1:0),s={callId:r,cacheKey:ox(l)},this.callHashCache.set(i,s)}return s.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),i=e.background;if(i){const r=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==i||r){const s=this.getCacheNode("background",i,()=>{if(i.isCubeTexture===!0||i.mapping===No||i.mapping===Po||i.mapping===Ta){if(e.backgroundBlurriness>0||i.mapping===Ta)return nN(i);{let o;return i.isCubeTexture===!0?o=md(i):o=yt(i),DR(o)}}else{if(i.isTexture===!0)return yt(i,xd.flipY()).setUpdateMatrix(!0);i.isColor!==!0&&console.error("WebGPUNodes: Unsupported background configuration.",i)}},r);t.backgroundNode=s,t.background=i,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,i,r=!1){const s=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let o=s.get(t);return(o===void 0||r)&&(o=i(),s.set(t,o)),o}updateFog(e){const t=this.get(e),i=e.fog;if(i){if(t.fog!==i){const r=this.getCacheNode("fog",i,()=>{if(i.isFogExp2){const s=Dt("color","color",i).setGroup(Xe),o=Dt("density","float",i).setGroup(Xe);return gN(s,S$(o))}else if(i.isFog){const s=Dt("color","color",i).setGroup(Xe),o=Dt("near","float",i).setGroup(Xe),a=Dt("far","float",i).setGroup(Xe);return gN(s,x$(o,a))}else console.error("THREE.Renderer: Unsupported fog configuration.",i)});t.fogNode=r,t.fog=i}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),i=e.environment;if(i){if(t.environment!==i){const r=this.getCacheNode("environment",i,()=>{if(i.isCubeTexture===!0)return md(i);if(i.isTexture===!0)return yt(i);console.error("Nodes: Unsupported environment configuration.",i)});t.environmentNode=r,t.environment=i}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,i=null,r=null,s=null){const o=this.nodeFrame;return o.renderer=e,o.scene=t,o.object=i,o.camera=r,o.material=s,o}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace}hasOutputChange(e){return zN.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,i=this.getOutputCacheKey(),r=yt(e,xd).renderOutput(t.toneMapping,t.currentColorSpace);return zN.set(e,i),r}updateBefore(e){const t=e.getNodeBuilderState();for(const i of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(i)}updateAfter(e){const t=e.getNodeBuilderState();for(const i of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(i)}updateForCompute(e){const t=this.getNodeFrame(),i=this.getForCompute(e);for(const r of i.updateNodes)t.updateNode(r)}updateForRender(e){const t=this.getNodeFrameForRender(e),i=e.getNodeBuilderState();for(const r of i.updateNodes)t.updateNode(r)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new FN,this.nodeBuilderCache=new Map,this.cacheLib={}}}const _S=new Fr;class ng{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new je,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,i){const r=e.length;for(let s=0;s<r;s++){_S.copy(e[s]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const o=t[i+s],a=_S.normal;o.x=-a.x,o.y=-a.y,o.z=-a.z,o.w=_S.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowNodeMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let i=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const r=t.clippingPlanes,s=r.length;let o,a;if(this.clipIntersection?(o=this.intersectionPlanes,a=e.intersectionPlanes.length):(o=this.unionPlanes,a=e.unionPlanes.length),o.length!==a+s){o.length=a+s;for(let l=0;l<s;l++)o[a+l]=new et;i=!0}this.projectPlanes(r,o,a),i&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new ng(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class V9{constructor(e,t){this.bundleGroup=e,this.camera=t}}class H9{constructor(){this.bundles=new cs}get(e,t){const i=this.bundles,r=[e,t];let s=i.get(r);return s===void 0&&(s=new V9(e,t),i.set(r,s)),s}dispose(){this.bundles=new cs}}class GN{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const i=this.getMaterialNodeClass(e.type);if(i!==null){t=new i;for(const r in e)t[r]=e[r]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,i){if(i.has(t)){console.warn(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);i.set(t,e)}addClass(e,t,i){if(i.has(t)){console.warn(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);i.set(t,e)}}const W9=new xN;class $9 extends cs{constructor(){super()}createNode(e=[]){return new xN().setLights(e)}getNode(e,t){if(e.isQuadMesh)return W9;const i=[e,t];let r=this.get(i);return r===void 0&&(r=this.createNode(),this.set(i,r)),r}}const VN=new Hy,ig=new ce,vS=new et,yS=new Fp,rg=new pt,ta=new et;class j9{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:i=!1,alpha:r=!0,depth:s=!0,stencil:o=!1,antialias:a=!1,samples:l=0,getFallback:u=null}=t;this.domElement=e.getDomElement(),this.backend=e,this.samples=l||a===!0?4:0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=r,this.logarithmicDepthBuffer=i,this.outputColorSpace=Be,this.toneMapping=Ai,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=s,this.stencil=o,this.info=new zW,this.nodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new GN,this.lighting=new $9,this._getFallback=u,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new et(0,0,this._width,this._height),this._scissor=new et(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new dN(new bn),this._quad.material.name="Renderer_output",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const c=this.alpha===!0?0:1;this._clearColor=new Zx(0,0,0,c),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:jv},this.xr={enabled:!1},this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(h,d,f)=>{await this.compileAsync(h,d);const m=this._renderLists.get(h,d),_=this._renderContexts.get(h,d,this._renderTarget),g=h.overrideMaterial||f.material,p=this._objects.get(f,g,h,d,m.lightsNode,_,_.clippingContext),{fragmentShader:v,vertexShader:y}=p.getNodeBuilderState();return{fragmentShader:v,vertexShader:y}}}}async init(){if(this._initialized)throw new Error("Renderer: Backend has already been initialized.");return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let i=this.backend;try{await i.init(this)}catch(r){if(this._getFallback!==null)try{this.backend=i=this._getFallback(r),await i.init(this)}catch(s){t(s);return}else{t(r);return}}this._nodes=new G9(this,i),this._animation=new NW(this._nodes,this.info),this._attributes=new OW(i),this._background=new n9(this,this._nodes),this._geometries=new kW(this._attributes,this.info),this._textures=new JW(this,i,this.info),this._pipelines=new WW(i,this._nodes),this._bindings=new $W(i,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new IW(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new qW(this.lighting),this._bundles=new H9,this._renderContexts=new QW,this._animation.start(),this._initialized=!0,e()}),this._initPromise)}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,i=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const r=this._nodes.nodeFrame,s=r.renderId,o=this._currentRenderContext,a=this._currentRenderObjectFunction,l=this._compilationPromises,u=e.isScene===!0?e:VN;i===null&&(i=e);const c=this._renderTarget,h=this._renderContexts.get(i,t,c),d=this._activeMipmapLevel,f=[];this._currentRenderContext=h,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=f,r.renderId++,r.update(),h.depth=this.depth,h.stencil=this.stencil,h.clippingContext||(h.clippingContext=new ng),h.clippingContext.updateGlobal(u,t),u.onBeforeRender(this,e,t,c);const m=this._renderLists.get(e,t);if(m.begin(),this._projectObject(e,t,0,m,h.clippingContext),i!==e&&i.traverseVisible(function(y){y.isLight&&y.layers.test(t.layers)&&m.pushLight(y)}),m.finish(),c!==null){this._textures.updateRenderTarget(c,d);const y=this._textures.get(c);h.textures=y.textures,h.depthTexture=y.depthTexture}else h.textures=null,h.depthTexture=null;this._background.update(u,m,h);const _=m.opaque,g=m.transparent,p=m.transparentDoublePass,v=m.lightsNode;this.opaque===!0&&_.length>0&&this._renderObjects(_,t,u,v),this.transparent===!0&&g.length>0&&this._renderTransparents(g,p,t,u,v),r.renderId=s,this._currentRenderContext=o,this._currentRenderObjectFunction=a,this._compilationPromises=l,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(f)}async renderAsync(e,t){this._initialized===!1&&await this.init();const i=this._renderScene(e,t);await this.backend.resolveTimestampAsync(i,"render")}async waitForGPU(){await this.backend.waitForGPU()}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),console.error(t),this._isDeviceLost=!0}_renderBundle(e,t,i){const{bundleGroup:r,camera:s,renderList:o}=e,a=this._currentRenderContext,l=this._bundles.get(r,s),u=this.backend.get(l);u.renderContexts===void 0&&(u.renderContexts=new Set);const c=r.version!==u.version,h=u.renderContexts.has(a)===!1||c;if(u.renderContexts.add(a),h){this.backend.beginBundle(a),(u.renderObjects===void 0||c)&&(u.renderObjects=[]),this._currentRenderBundle=l;const d=o.opaque;this.opaque===!0&&d.length>0&&this._renderObjects(d,s,t,i),this._currentRenderBundle=null,this.backend.finishBundle(a,l),u.version=r.version}else{const{renderObjects:d}=u;for(let f=0,m=d.length;f<m;f++){const _=d[f];this._nodes.needsRefresh(_)&&(this._nodes.updateBefore(_),this._nodes.updateForRender(_),this._bindings.updateForRender(_),this._nodes.updateAfter(_))}}this.backend.addBundle(a,l)}render(e,t){if(this._initialized===!1)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(e,t);this._renderScene(e,t)}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this;if(e!==Ai===!1&&t!==mr===!1)return null;const{width:s,height:o}=this.getDrawingBufferSize(ig),{depth:a,stencil:l}=this;let u=this._frameBufferTarget;return u===null&&(u=new fu(s,o,{depthBuffer:a,stencilBuffer:l,type:hi,format:Gn,colorSpace:mr,generateMipmaps:!1,minFilter:mn,magFilter:mn,samples:this.samples}),u.isPostProcessingRenderTarget=!0,this._frameBufferTarget=u),u.depthBuffer=a,u.stencilBuffer=l,u.setSize(s,o),u.viewport.copy(this._viewport),u.scissor.copy(this._scissor),u.viewport.multiplyScalar(this._pixelRatio),u.scissor.multiplyScalar(this._pixelRatio),u.scissorTest=this._scissorTest,u}_renderScene(e,t,i=!0){if(this._isDeviceLost===!0)return;const r=i?this._getFrameBufferTarget():null,s=this._nodes.nodeFrame,o=s.renderId,a=this._currentRenderContext,l=this._currentRenderObjectFunction,u=e.isScene===!0?e:VN,c=this._renderTarget,h=this._activeCubeFace,d=this._activeMipmapLevel;let f;r!==null?(f=r,this.setRenderTarget(f)):f=c;const m=this._renderContexts.get(e,t,f);this._currentRenderContext=m,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,s.renderId=this.info.calls;const _=this.coordinateSystem;t.coordinateSystem!==_&&(t.coordinateSystem=_,t.updateProjectionMatrix()),e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld();let g=this._viewport,p=this._scissor,v=this._pixelRatio;f!==null&&(g=f.viewport,p=f.scissor,v=1),this.getDrawingBufferSize(ig),vS.set(0,0,ig.width,ig.height);const y=g.minDepth===void 0?0:g.minDepth,x=g.maxDepth===void 0?1:g.maxDepth;m.viewportValue.copy(g).multiplyScalar(v).floor(),m.viewportValue.width>>=d,m.viewportValue.height>>=d,m.viewportValue.minDepth=y,m.viewportValue.maxDepth=x,m.viewport=m.viewportValue.equals(vS)===!1,m.scissorValue.copy(p).multiplyScalar(v).floor(),m.scissor=this._scissorTest&&m.scissorValue.equals(vS)===!1,m.scissorValue.width>>=d,m.scissorValue.height>>=d,m.clippingContext||(m.clippingContext=new ng),m.clippingContext.updateGlobal(u,t),u.onBeforeRender(this,e,t,f),rg.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),yS.setFromProjectionMatrix(rg,_);const T=this._renderLists.get(e,t);if(T.begin(),this._projectObject(e,t,0,T,m.clippingContext),T.finish(),this.sortObjects===!0&&T.sort(this._opaqueSort,this._transparentSort),f!==null){this._textures.updateRenderTarget(f,d);const R=this._textures.get(f);m.textures=R.textures,m.depthTexture=R.depthTexture,m.width=R.width,m.height=R.height,m.renderTarget=f,m.depth=f.depthBuffer,m.stencil=f.stencilBuffer}else m.textures=null,m.depthTexture=null,m.width=this.domElement.width,m.height=this.domElement.height,m.depth=this.depth,m.stencil=this.stencil;m.width>>=d,m.height>>=d,m.activeCubeFace=h,m.activeMipmapLevel=d,m.occlusionQueryCount=T.occlusionQueryCount,this._background.update(u,T,m),this.backend.beginRender(m);const{bundles:S,lightsNode:w,transparentDoublePass:E,transparent:M,opaque:b}=T;if(S.length>0&&this._renderBundles(S,u,w),this.opaque===!0&&b.length>0&&this._renderObjects(b,t,u,w),this.transparent===!0&&M.length>0&&this._renderTransparents(M,E,t,u,w),this.backend.finishRender(m),s.renderId=o,this._currentRenderContext=a,this._currentRenderObjectFunction=l,r!==null){this.setRenderTarget(c,h,d);const R=this._quad;this._nodes.hasOutputChange(f.texture)&&(R.material.fragmentNode=this._nodes.getOutputNode(f.texture),R.material.needsUpdate=!0),this._renderScene(R,R.camera,!1)}return u.onAfterRender(this,e,t,f),m}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,i){this._width=e,this._height=t,this._pixelRatio=i,this.domElement.width=Math.floor(e*i),this.domElement.height=Math.floor(t*i),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize()}setSize(e,t,i=!0){this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),i===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize()}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,i,r){const s=this._scissor;e.isVector4?s.copy(e):s.set(e,t,i,r)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e,this.backend.setScissorTest(e)}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,i,r,s=0,o=1){const a=this._viewport;e.isVector4?a.copy(e):a.set(e,t,i,r),a.minDepth=s,a.maxDepth=o}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,i=!0){if(this._initialized===!1)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(e,t,i);const r=this._renderTarget||this._getFrameBufferTarget();let s=null;if(r!==null){this._textures.updateRenderTarget(r);const o=this._textures.get(r);s=this._renderContexts.get(null,null,r),s.textures=o.textures,s.depthTexture=o.depthTexture,s.width=o.width,s.height=o.height,s.renderTarget=r,s.depth=r.depthBuffer,s.stencil=r.stencilBuffer}if(this.backend.clear(e,t,i,s),r!==null&&this._renderTarget===null){const o=this._quad;this._nodes.hasOutputChange(r.texture)&&(o.material.fragmentNode=this._nodes.getOutputNode(r.texture),o.material.needsUpdate=!0),this._renderScene(o,o.camera,!1)}}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,i=!0){this._initialized===!1&&await this.init(),this.clear(e,t,i)}async clearColorAsync(){this.clearAsync(!0,!1,!1)}async clearDepthAsync(){this.clearAsync(!1,!0,!1)}async clearStencilAsync(){this.clearAsync(!1,!1,!0)}get currentToneMapping(){return this._renderTarget!==null?Ai:this.toneMapping}get currentColorSpace(){return this._renderTarget!==null?mr:this.outputColorSpace}dispose(){this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,i=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=i}getRenderTarget(){return this._renderTarget}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e){if(this.isDeviceLost===!0)return;if(this._initialized===!1)return console.warn("THREE.Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e);const t=this._nodes.nodeFrame,i=t.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,t.renderId=this.info.calls;const r=this.backend,s=this._pipelines,o=this._bindings,a=this._nodes,l=Array.isArray(e)?e:[e];if(l[0]===void 0||l[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");r.beginCompute(e);for(const u of l){if(s.has(u)===!1){const d=()=>{u.removeEventListener("dispose",d),s.delete(u),o.delete(u),a.delete(u)};u.addEventListener("dispose",d);const f=u.onInitFunction;f!==null&&f.call(u,{renderer:this})}a.updateForCompute(u),o.updateForCompute(u);const c=o.getForCompute(u),h=s.getForCompute(u,c);r.compute(e,u,c,h)}r.finishCompute(e),t.renderId=i}async computeAsync(e){this._initialized===!1&&await this.init(),this.compute(e),await this.backend.resolveTimestampAsync(e,"compute")}async hasFeatureAsync(e){return this._initialized===!1&&await this.init(),this.backend.hasFeature(e)}hasFeature(e){return this._initialized===!1?(console.warn("THREE.Renderer: .hasFeature() called before the backend is initialized. Try using .hasFeatureAsync() instead."),!1):this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){this._initialized===!1&&await this.init(),this._textures.updateTexture(e)}initTexture(e){this._initialized===!1&&console.warn("THREE.Renderer: .initTexture() called before the backend is initialized. Try using .initTextureAsync() instead."),this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=ta.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=ta.copy(t).floor();else{console.error("THREE.Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=ta.set(0,0,e.image.width,e.image.height);let i=this._currentRenderContext,r;i!==null?r=i.renderTarget:(r=this._renderTarget||this._getFrameBufferTarget(),r!==null&&(this._textures.updateRenderTarget(r),i=this._textures.get(r))),this._textures.updateTexture(e,{renderTarget:r}),this.backend.copyFramebufferToTexture(e,i,t)}copyTextureToTexture(e,t,i=null,r=null,s=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,i,r,s)}async readRenderTargetPixelsAsync(e,t,i,r,s,o=0,a=0){return this.backend.copyTextureToBuffer(e.textures[o],t,i,r,s,a)}_projectObject(e,t,i,r,s){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)i=e.renderOrder,e.isClippingGroup&&e.enabled&&(s=s.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)r.pushLight(e);else if(e.isSprite){if(!e.frustumCulled||yS.intersectsSprite(e)){this.sortObjects===!0&&ta.setFromMatrixPosition(e.matrixWorld).applyMatrix4(rg);const{geometry:l,material:u}=e;u.visible&&r.push(e,l,u,i,ta.z,null,s)}}else if(e.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||yS.intersectsObject(e))){const{geometry:l,material:u}=e;if(this.sortObjects===!0&&(l.boundingSphere===null&&l.computeBoundingSphere(),ta.copy(l.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(rg)),Array.isArray(u)){const c=l.groups;for(let h=0,d=c.length;h<d;h++){const f=c[h],m=u[f.materialIndex];m&&m.visible&&r.push(e,l,m,i,ta.z,f,s)}}else u.visible&&r.push(e,l,u,i,ta.z,null,s)}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const l=r;r=this._renderLists.get(e,t),r.begin(),l.pushBundle({bundleGroup:e,camera:t,renderList:r}),r.finish()}const a=e.children;for(let l=0,u=a.length;l<u;l++)this._projectObject(a[l],t,i,r,s)}_renderBundles(e,t,i){for(const r of e)this._renderBundle(r,t,i)}_renderTransparents(e,t,i,r,s){if(t.length>0){for(const{material:o}of t)o.side=$t;this._renderObjects(t,i,r,s,"backSide");for(const{material:o}of t)o.side=Nr;this._renderObjects(e,i,r,s);for(const{material:o}of t)o.side=ui}else this._renderObjects(e,i,r,s)}_renderObjects(e,t,i,r,s=null){for(let o=0,a=e.length;o<a;o++){const l=e[o],{object:u,geometry:c,material:h,group:d,clippingContext:f}=l;if(t.isArrayCamera){const m=t.cameras;for(let _=0,g=m.length;_<g;_++){const p=m[_];if(u.layers.test(p.layers)){const v=p.viewport,y=v.minDepth===void 0?0:v.minDepth,x=v.maxDepth===void 0?1:v.maxDepth,T=this._currentRenderContext.viewportValue;T.copy(v).multiplyScalar(this._pixelRatio).floor(),T.minDepth=y,T.maxDepth=x,this.backend.updateViewport(this._currentRenderContext),this._currentRenderObjectFunction(u,i,p,c,h,d,r,f,s)}}}else this._currentRenderObjectFunction(u,i,t,c,h,d,r,f,s)}}renderObject(e,t,i,r,s,o,a,l=null,u=null){let c,h,d;if(e.onBeforeRender(this,t,i,r,s,o),t.overrideMaterial!==null){const f=t.overrideMaterial;s.positionNode&&s.positionNode.isNode&&(c=f.positionNode,f.positionNode=s.positionNode),f.alphaTest=s.alphaTest,f.alphaMap=s.alphaMap,f.transparent=s.transparent||s.transmission>0,f.isShadowNodeMaterial&&(f.side=s.shadowSide===null?s.side:s.shadowSide,s.depthNode&&s.depthNode.isNode&&(d=f.depthNode,f.depthNode=s.depthNode),s.castShadowNode&&s.castShadowNode.isNode&&(h=f.colorNode,f.colorNode=s.castShadowNode)),s=f}s.transparent===!0&&s.side===ui&&s.forceSinglePass===!1?(s.side=$t,this._handleObjectFunction(e,s,t,i,a,o,l,"backSide"),s.side=Nr,this._handleObjectFunction(e,s,t,i,a,o,l,u),s.side=ui):this._handleObjectFunction(e,s,t,i,a,o,l,u),c!==void 0&&(t.overrideMaterial.positionNode=c),d!==void 0&&(t.overrideMaterial.depthNode=d),h!==void 0&&(t.overrideMaterial.colorNode=h),e.onAfterRender(this,t,i,r,s,o)}_renderObjectDirect(e,t,i,r,s,o,a,l){const u=this._objects.get(e,t,i,r,s,this._currentRenderContext,a,l);u.drawRange=e.geometry.drawRange,u.group=o;const c=this._nodes.needsRefresh(u);c&&(this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u)),this._pipelines.updateForRender(u),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(u),u.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(u,this.info),c&&this._nodes.updateAfter(u)}_createObjectPipeline(e,t,i,r,s,o,a,l){const u=this._objects.get(e,t,i,r,s,this._currentRenderContext,a,l);u.drawRange=e.geometry.drawRange,u.group=o,this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u),this._pipelines.getForRender(u,this._compilationPromises),this._nodes.updateAfter(u)}get compile(){return this.compileAsync}}class xS{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}}function X9(n){return n+(ea-n%ea)%ea}class HN extends xS{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t}get byteLength(){return X9(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class WN extends HN{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let q9=0;class $N extends WN{constructor(e,t){super("UniformBuffer_"+q9++,e?e.value:null),this.nodeUniform=e,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class Y9 extends WN{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){let e=0;for(let t=0,i=this.uniforms.length;t<i;t++){const r=this.uniforms[t],{boundary:s,itemSize:o}=r,a=e%ea,l=ea-a;a!==0&&l-s<0?e+=ea-a:a%s!==0&&(e+=a%s),r.offset=e/this.bytesPerElement,e+=o*this.bytesPerElement}return Math.ceil(e/ea)*ea}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const i=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(i[s]!==r){const a=this._getBufferForType(o);a[s]=i[s]=r,t=!0}return t}updateVector2(e){let t=!1;const i=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(i[s+0]!==r.x||i[s+1]!==r.y){const a=this._getBufferForType(o);a[s+0]=i[s+0]=r.x,a[s+1]=i[s+1]=r.y,t=!0}return t}updateVector3(e){let t=!1;const i=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(i[s+0]!==r.x||i[s+1]!==r.y||i[s+2]!==r.z){const a=this._getBufferForType(o);a[s+0]=i[s+0]=r.x,a[s+1]=i[s+1]=r.y,a[s+2]=i[s+2]=r.z,t=!0}return t}updateVector4(e){let t=!1;const i=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(i[s+0]!==r.x||i[s+1]!==r.y||i[s+2]!==r.z||i[s+4]!==r.w){const a=this._getBufferForType(o);a[s+0]=i[s+0]=r.x,a[s+1]=i[s+1]=r.y,a[s+2]=i[s+2]=r.z,a[s+3]=i[s+3]=r.w,t=!0}return t}updateColor(e){let t=!1;const i=this.values,r=e.getValue(),s=e.offset;if(i[s+0]!==r.r||i[s+1]!==r.g||i[s+2]!==r.b){const o=this.buffer;o[s+0]=i[s+0]=r.r,o[s+1]=i[s+1]=r.g,o[s+2]=i[s+2]=r.b,t=!0}return t}updateMatrix3(e){let t=!1;const i=this.values,r=e.getValue().elements,s=e.offset;if(i[s+0]!==r[0]||i[s+1]!==r[1]||i[s+2]!==r[2]||i[s+4]!==r[3]||i[s+5]!==r[4]||i[s+6]!==r[5]||i[s+8]!==r[6]||i[s+9]!==r[7]||i[s+10]!==r[8]){const o=this.buffer;o[s+0]=i[s+0]=r[0],o[s+1]=i[s+1]=r[1],o[s+2]=i[s+2]=r[2],o[s+4]=i[s+4]=r[3],o[s+5]=i[s+5]=r[4],o[s+6]=i[s+6]=r[5],o[s+8]=i[s+8]=r[6],o[s+9]=i[s+9]=r[7],o[s+10]=i[s+10]=r[8],t=!0}return t}updateMatrix4(e){let t=!1;const i=this.values,r=e.getValue().elements,s=e.offset;return Q9(i,r,s)===!1&&(this.buffer.set(r,s),K9(i,r,s),t=!0),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function K9(n,e,t){for(let i=0,r=e.length;i<r;i++)n[t+i]=e[i]}function Q9(n,e,t){for(let i=0,r=e.length;i<r;i++)if(n[t+i]!==e[i])return!1;return!0}let Z9=0;class jN extends Y9{constructor(e,t){super(e),this.id=Z9++,this.groupNode=t,this.isNodeUniformsGroup=!0}}let J9=0;class ej extends xS{constructor(e,t){super(e),this.id=J9++,this.texture=t,this.version=t?t.version:0,this.store=!1,this.generation=null,this.isSampledTexture=!0}needsBindingsUpdate(e){const{texture:t}=this;return e!==this.generation?(this.generation=e,!0):t.isVideoTexture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}}class sg extends ej{constructor(e,t,i,r=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=i,this.access=r}needsBindingsUpdate(e){return this.textureNode.value!==this.texture||super.needsBindingsUpdate(e)}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class XN extends sg{constructor(e,t,i,r=null){super(e,t,i,r),this.isSampledCubeTexture=!0}}class qN extends sg{constructor(e,t,i,r=null){super(e,t,i,r),this.isSampledTexture3D=!0}}const tj={textureDimensions:"textureSize",equals:"equal"},nj={low:"lowp",medium:"mediump",high:"highp"},YN={swizzleAssign:!0,storageBuffer:!1},KN=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
`;class ij extends UN{constructor(e,t){super(e,t,new z9),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]},this.useComparisonMethod=!0}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==Yi}getMethod(e){return tj[e]||e}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,i=this.flowShaderNode(e),r=[];for(const o of t.inputs)r.push(this.getType(o.type)+" "+o.name);return`${this.getType(t.type)} ${t.name}( ${r.join(", ")} ) {

	${i.vars}

${i.code}
	return ${i.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const i=t.array,r=t.count*t.itemSize,{itemSize:s}=t,o=t.array.constructor.name.toLowerCase().includes("int");let a=o?Wl:fh;s===2?a=o?$l:Aa:s===3?a=o?iI:dh:s===4&&(a=o?jl:Gn);const l={Float32Array:cn,Uint8Array:Kn,Uint16Array:Pr,Uint32Array:en,Int8Array:Ma,Int16Array:Ea,Int32Array:Un,Uint8ClampedArray:Kn},u=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(r/s))));let c=Math.ceil(r/s/u);u*c*s<r&&c++;const h=u*c*s,d=new i.constructor(h);d.set(i,0),t.array=d;const f=new sU(t.array,u,c,a,l[t.array.constructor.name]||cn);f.needsUpdate=!0,f.isPBOTexture=!0;const m=new dd(f,null,null);m.setPrecision("high"),t.pboNode=m,t.pbo=m.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.label)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:i}=e,r=t.value;if(this.renderer.backend.has(r)){const c=this.renderer.backend.get(r);c.pbo=r.pbo}const s=this.getUniformFromNode(r.pboNode,"texture",this.shaderStage,this.context.label),o=this.getPropertyName(s);this.increaseUsage(i);const a=i.build(this,"uint"),l=this.getDataFromNode(e);let u=l.propertyName;if(u===void 0){const c=this.getVarFromNode(e);u=this.getPropertyName(c);const h=this.getDataFromNode(t);let d=h.propertySizeName;d===void 0&&(d=u+"Size",this.getVarFromNode(t,d,"uint"),this.addLineFlowCode(`${d} = uint( textureSize( ${o}, 0 ).x )`,e),h.propertySizeName=d);const{itemSize:f}=r,m="."+Vu.join("").slice(0,f),_=`ivec2(${a} % ${d}, ${a} / ${d})`,g=this.generateTextureLoad(null,o,_,null,"0");let p="vec4";r.pbo.type===en?p="uvec4":r.pbo.type===Un&&(p="ivec4"),this.addLineFlowCode(`${u} = ${p}(${g})${m}`,e),l.propertyName=u}return u}generateTextureLoad(e,t,i,r,s="0"){return r?`texelFetch( ${t}, ivec3( ${i}, ${r} ), ${s} )`:`texelFetch( ${t}, ${i}, ${s} )`}generateTexture(e,t,i,r){return e.isDepthTexture?`texture( ${t}, ${i} ).x`:(r&&(i=`vec3( ${i}, ${r} )`),`texture( ${t}, ${i} )`)}generateTextureLevel(e,t,i,r){return`textureLod( ${t}, ${i}, ${r} )`}generateTextureBias(e,t,i,r){return`texture( ${t}, ${i}, ${r} )`}generateTextureGrad(e,t,i,r){return`textureGrad( ${t}, ${i}, ${r[0]}, ${r[1]} )`}generateTextureCompare(e,t,i,r,s,o=this.shaderStage){if(o==="fragment")return`texture( ${t}, vec3( ${i}, ${r} ) )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}getVars(e){const t=[],i=this.vars[e];if(i!==void 0)for(const r of i)t.push(`${this.getVar(r.type,r.name)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],i=[],r={};for(const o of t){let a=null,l=!1;if(o.type==="texture"){const c=o.node.value;let h="";c.isDataTexture===!0&&(c.type===en?h="u":c.type===Un&&(h="i")),c.compareFunction?a=`sampler2DShadow ${o.name};`:c.isDataArrayTexture===!0||c.isCompressedArrayTexture===!0?a=`${h}sampler2DArray ${o.name};`:a=`${h}sampler2D ${o.name};`}else if(o.type==="cubeTexture")a=`samplerCube ${o.name};`;else if(o.type==="texture3D")a=`sampler3D ${o.name};`;else if(o.type==="buffer"){const c=o.node,h=this.getType(c.bufferType),d=c.bufferCount,f=d>0?d:"";a=`${c.name} {
	${h} ${o.name}[${f}];
};
`}else a=`${this.getVectorType(o.type)} ${this.getPropertyName(o,e)};`,l=!0;const u=o.node.precision;if(u!==null&&(a=nj[u]+" "+a),l){a="	"+a;const c=o.groupNode.name;(r[c]||(r[c]=[])).push(a)}else a="uniform "+a,i.push(a)}let s="";for(const o in r){const a=r[o];s+=this._getGLSLUniformStruct(e+"_"+o,a.join(`
`))+`
`}return s+=i.join(`
`),s}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==Un){let i=e;e.isInterleavedBufferAttribute&&(i=e.data);const r=i.array;r instanceof Uint32Array||r instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const i=this.getAttributesArray();let r=0;for(const s of i)t+=`layout( location = ${r++} ) in ${s.type} ${s.name};
`}return t}getStructMembers(e){const t=[],i=e.getMemberTypes();for(let r=0;r<i.length;r++){const s=i[r];t.push(`layout( location = ${r} ) out ${s} m${r};`)}return t.join(`
`)}getStructs(e){const t=[],i=this.structs[e];if(i.length===0)return`layout( location = 0 ) out vec4 fragColor;
`;for(let r=0,s=i.length;r<s;r++){const o=i[r];let a=`
`;a+=this.getStructMembers(o),a+=`
`,t.push(a)}return t.join(`

`)}getVaryings(e){let t="";const i=this.varyings;if(e==="vertex"||e==="compute")for(const r of i){e==="compute"&&(r.needsInterpolation=!0);const s=this.getType(r.type),o=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${o}${r.needsInterpolation?"out":"/*out*/"} ${s} ${r.name};
`}else if(e==="fragment"){for(const r of i)if(r.needsInterpolation){const s=this.getType(r.type),o=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${o}in ${s} ${r.name};
`}}for(const r of this.builtins[e])t+=`${r};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((i,r)=>i*r,1)}u`}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,i=this.shaderStage){const r=this.extensions[i]||(this.extensions[i]=new Map);r.has(e)===!1&&r.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const r=this.renderer.backend.extensions;this.object.isBatchedMesh&&r.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const i=this.extensions[e];if(i!==void 0)for(const{name:r,behavior:s}of i.values())t.push(`#extension ${r} : ${s}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=YN[e];if(t===void 0){let i;switch(t=!1,e){case"float32Filterable":i="OES_texture_float_linear";break;case"clipDistance":i="WEBGL_clip_cull_distance";break}if(i!==void 0){const r=this.renderer.backend.extensions;r.has(i)&&(r.get(i),t=!0)}YN[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let i=0;i<e.length;i++){const r=e[i],s=this.getPropertyName(r.attributeNode);t+=`${r.varyingName} = ${s};
	`}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions 
${e.extensions}

// precision
${KN}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// precision
${KN}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

${e.structs}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let i=`// code

`;i+=this.flowCode[t];const r=this.flowNodes[t],s=r[r.length-1];for(const a of r){const l=this.getFlowData(a),u=a.name;u&&(i.length>0&&(i+=`
`),i+=`	// flow -> ${u}
	`),i+=`${l.code}
	`,a===s&&t!=="compute"&&(i+=`// result
	`,t==="vertex"?(i+="gl_Position = ",i+=`${l.result};`):t==="fragment"&&(a.outputNode.isOutputStructNode||(i+="fragColor = ",i+=`${l.result};`)))}const o=e[t];o.extensions=this.getExtensions(t),o.uniforms=this.getUniforms(t),o.attributes=this.getAttributes(t),o.varyings=this.getVaryings(t),o.vars=this.getVars(t),o.structs=this.getStructs(t),o.codes=this.getCodes(t),o.transforms=this.getTransforms(t),o.flow=i}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,i,r=null){const s=super.getUniformFromNode(e,t,i,r),o=this.getDataFromNode(e,i,this.globalCache);let a=o.uniformGPU;if(a===void 0){const l=e.groupNode,u=l.name,c=this.getBindGroupArray(u,i);if(t==="texture")a=new sg(s.name,s.node,l),c.push(a);else if(t==="cubeTexture")a=new XN(s.name,s.node,l),c.push(a);else if(t==="texture3D")a=new qN(s.name,s.node,l),c.push(a);else if(t==="buffer"){e.name=`NodeBuffer_${e.id}`,s.name=`buffer${e.id}`;const h=new $N(e,l);h.name=e.name,c.push(h),a=h}else{const h=this.uniformGroups[i]||(this.uniformGroups[i]={});let d=h[u];d===void 0&&(d=new jN(i+"_"+u,l),h[u]=d,c.push(d)),a=this.getNodeUniform(s,t),d.addUniform(a)}o.uniformGPU=a}return s}}let SS=null,tc=null;class QN{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}createSampler(){}destroySampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}isOccluded(){}async resolveTimestampAsync(){}async waitForGPU(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return SS=SS||new ce,this.renderer.getDrawingBufferSize(SS)}setScissorTest(){}getClearColor(){const e=this.renderer;return tc=tc||new Zx,e.getClearColor(tc),tc.getRGB(tc,this.renderer.currentColorSpace),tc}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:KM(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${kl} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}}let rj=0;class sj{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class oj{constructor(e){this.backend=e}createAttribute(e,t){const i=this.backend,{gl:r}=i,s=e.array,o=e.usage||r.STATIC_DRAW,a=e.isInterleavedBufferAttribute?e.data:e,l=i.get(a);let u=l.bufferGPU;u===void 0&&(u=this._createBuffer(r,t,s,o),l.bufferGPU=u,l.bufferType=t,l.version=a.version);let c;if(s instanceof Float32Array)c=r.FLOAT;else if(s instanceof Uint16Array)e.isFloat16BufferAttribute?c=r.HALF_FLOAT:c=r.UNSIGNED_SHORT;else if(s instanceof Int16Array)c=r.SHORT;else if(s instanceof Uint32Array)c=r.UNSIGNED_INT;else if(s instanceof Int32Array)c=r.INT;else if(s instanceof Int8Array)c=r.BYTE;else if(s instanceof Uint8Array)c=r.UNSIGNED_BYTE;else if(s instanceof Uint8ClampedArray)c=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+s);let h={bufferGPU:u,bufferType:t,type:c,byteLength:s.byteLength,bytesPerElement:s.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:c===r.INT||c===r.UNSIGNED_INT||e.gpuType===Un,id:rj++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const d=this._createBuffer(r,t,s,o);h=new sj(h,d)}i.set(e,h)}updateAttribute(e){const t=this.backend,{gl:i}=t,r=e.array,s=e.isInterleavedBufferAttribute?e.data:e,o=t.get(s),a=o.bufferType,l=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(i.bindBuffer(a,o.bufferGPU),l.length===0)i.bufferSubData(a,0,r);else{for(let u=0,c=l.length;u<c;u++){const h=l[u];i.bufferSubData(a,h.start*r.BYTES_PER_ELEMENT,r,h.start,h.count)}s.clearUpdateRanges()}i.bindBuffer(a,null),o.version=s.version}destroyAttribute(e){const t=this.backend,{gl:i}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const r=t.get(e);i.deleteBuffer(r.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:i}=t,r=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:s}=t.get(r),o=e.array,a=o.byteLength;i.bindBuffer(i.COPY_READ_BUFFER,s);const l=i.createBuffer();i.bindBuffer(i.COPY_WRITE_BUFFER,l),i.bufferData(i.COPY_WRITE_BUFFER,a,i.STREAM_READ),i.copyBufferSubData(i.COPY_READ_BUFFER,i.COPY_WRITE_BUFFER,0,0,a),await t.utils._clientWaitAsync();const u=new e.array.constructor(o.length);return i.bindBuffer(i.COPY_WRITE_BUFFER,l),i.getBufferSubData(i.COPY_WRITE_BUFFER,0,u),i.deleteBuffer(l),i.bindBuffer(i.COPY_READ_BUFFER,null),i.bindBuffer(i.COPY_WRITE_BUFFER,null),u.buffer}_createBuffer(e,t,i,r){const s=e.createBuffer();return e.bindBuffer(t,s),e.bufferData(t,i,r),e.bindBuffer(t,null),s}}let ZN=!1,TS,Rd;class aj{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},ZN===!1&&(this._init(this.gl),ZN=!0)}_init(e){TS={[qi]:e.FUNC_ADD,[qv]:e.FUNC_SUBTRACT,[Yv]:e.FUNC_REVERSE_SUBTRACT},Rd={[Kv]:e.ZERO,[Qv]:e.ONE,[Zv]:e.SRC_COLOR,[nh]:e.SRC_ALPHA,[ry]:e.SRC_ALPHA_SATURATE,[ny]:e.DST_COLOR,[ey]:e.DST_ALPHA,[Jv]:e.ONE_MINUS_SRC_COLOR,[ih]:e.ONE_MINUS_SRC_ALPHA,[iy]:e.ONE_MINUS_DST_COLOR,[ty]:e.ONE_MINUS_DST_ALPHA}}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==IM?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===$v?t.cullFace(t.BACK):e===UM?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:i}=this;e!==t&&(i.lineWidth(e),this.currentLineWidth=e)}setBlending(e,t,i,r,s,o,a,l){const{gl:u}=this;if(e===Ei){this.currentBlendingEnabled===!0&&(this.disable(u.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(u.BLEND),this.currentBlendingEnabled=!0),e!==Xv){if(e!==this.currentBlending||l!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==qi||this.currentBlendEquationAlpha!==qi)&&(u.blendEquation(u.FUNC_ADD),this.currentBlendEquation=qi,this.currentBlendEquationAlpha=qi),l)switch(e){case dr:u.blendFuncSeparate(u.ONE,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case zl:u.blendFunc(u.ONE,u.ONE);break;case Gl:u.blendFuncSeparate(u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ZERO,u.ONE);break;case Vl:u.blendFuncSeparate(u.ZERO,u.SRC_COLOR,u.ZERO,u.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}else switch(e){case dr:u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case zl:u.blendFunc(u.SRC_ALPHA,u.ONE);break;case Gl:u.blendFuncSeparate(u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ZERO,u.ONE);break;case Vl:u.blendFunc(u.ZERO,u.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=l}return}s=s||t,o=o||i,a=a||r,(t!==this.currentBlendEquation||s!==this.currentBlendEquationAlpha)&&(u.blendEquationSeparate(TS[t],TS[s]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=s),(i!==this.currentBlendSrc||r!==this.currentBlendDst||o!==this.currentBlendSrcAlpha||a!==this.currentBlendDstAlpha)&&(u.blendFuncSeparate(Rd[i],Rd[r],Rd[o],Rd[a]),this.currentBlendSrc=i,this.currentBlendDst=r,this.currentBlendSrcAlpha=o,this.currentBlendDstAlpha=a),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case rh:t.depthFunc(t.NEVER);break;case sh:t.depthFunc(t.ALWAYS);break;case oh:t.depthFunc(t.LESS);break;case Ro:t.depthFunc(t.LEQUAL);break;case ah:t.depthFunc(t.EQUAL);break;case lh:t.depthFunc(t.GEQUAL);break;case uh:t.depthFunc(t.GREATER);break;case ch:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,i){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==i)&&(this.gl.stencilFunc(e,t,i),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=i)}setStencilOp(e,t,i){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==i)&&(this.gl.stencilOp(e,t,i),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=i)}setMaterial(e,t,i){const{gl:r}=this;e.side===ui?this.disable(r.CULL_FACE):this.enable(r.CULL_FACE);let s=e.side===$t;t&&(s=!s),this.setFlipSided(s),e.blending===dr&&e.transparent===!1?this.setBlending(Ei):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const o=e.stencilWrite;if(this.setStencilTest(o),o&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.samples>1?this.enable(r.SAMPLE_ALPHA_TO_COVERAGE):this.disable(r.SAMPLE_ALPHA_TO_COVERAGE),i>0&&this.currentClippingPlanes!==i)for(let l=0;l<8;l++)l<i?this.enable(12288+l):this.disable(12288+l)}setPolygonOffset(e,t,i){const{gl:r}=this;e?(this.enable(r.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==i)&&(r.polygonOffset(t,i),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=i)):this.disable(r.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}bindFramebuffer(e,t){const{gl:i,currentBoundFramebuffers:r}=this;return r[e]!==t?(i.bindFramebuffer(e,t),r[e]=t,e===i.DRAW_FRAMEBUFFER&&(r[i.FRAMEBUFFER]=t),e===i.FRAMEBUFFER&&(r[i.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:i}=this;let r=[],s=!1;if(e.textures!==null){r=this.currentDrawbuffers.get(t),r===void 0&&(r=[],this.currentDrawbuffers.set(t,r));const o=e.textures;if(r.length!==o.length||r[0]!==i.COLOR_ATTACHMENT0){for(let a=0,l=o.length;a<l;a++)r[a]=i.COLOR_ATTACHMENT0+a;r.length=o.length,s=!0}}else r[0]!==i.BACK&&(r[0]=i.BACK,s=!0);s&&i.drawBuffers(r)}activeTexture(e){const{gl:t,currentTextureSlot:i,maxTextures:r}=this;e===void 0&&(e=t.TEXTURE0+r-1),i!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,i){const{gl:r,currentTextureSlot:s,currentBoundTextures:o,maxTextures:a}=this;i===void 0&&(s===null?i=r.TEXTURE0+a-1:i=s);let l=o[i];l===void 0&&(l={type:void 0,texture:void 0},o[i]=l),(l.type!==e||l.texture!==t)&&(s!==i&&(r.activeTexture(i),this.currentTextureSlot=i),r.bindTexture(e,t),l.type=e,l.texture=t)}bindBufferBase(e,t,i){const{gl:r}=this,s=`${e}-${t}`;return this.currentBoundBufferBases[s]!==i?(r.bindBufferBase(e,t,i),this.currentBoundBufferBases[s]=i,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:i}=this,r=i[t];r!==void 0&&r.type!==void 0&&(e.bindTexture(r.type,null),r.type=void 0,r.texture=void 0)}}class lj{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=Yi){const{gl:i,extensions:r}=this;let s;if(e===Kn)return i.UNSIGNED_BYTE;if(e===rp)return i.UNSIGNED_SHORT_4_4_4_4;if(e===sp)return i.UNSIGNED_SHORT_5_5_5_1;if(e===op)return i.UNSIGNED_INT_5_9_9_9_REV;if(e===Ma)return i.BYTE;if(e===Ea)return i.SHORT;if(e===Pr)return i.UNSIGNED_SHORT;if(e===Un)return i.INT;if(e===en)return i.UNSIGNED_INT;if(e===cn)return i.FLOAT;if(e===hi)return i.HALF_FLOAT;if(e===oy)return i.ALPHA;if(e===dh)return i.RGB;if(e===Gn)return i.RGBA;if(e===ay)return i.LUMINANCE;if(e===ly)return i.LUMINANCE_ALPHA;if(e===ns)return i.DEPTH_COMPONENT;if(e===is)return i.DEPTH_STENCIL;if(e===fh)return i.RED;if(e===Wl)return i.RED_INTEGER;if(e===Aa)return i.RG;if(e===$l)return i.RG_INTEGER;if(e===jl)return i.RGBA_INTEGER;if(e===Ca||e===Do||e===Lo||e===Io)if(t===Be)if(s=r.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(e===Ca)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===Do)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===Lo)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===Io)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=r.get("WEBGL_compressed_texture_s3tc"),s!==null){if(e===Ca)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Do)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Lo)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Io)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===ph||e===mh||e===gh||e===_h)if(s=r.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(e===ph)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===mh)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===gh)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===_h)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===vh||e===Xl||e===ql)if(s=r.get("WEBGL_compressed_texture_etc"),s!==null){if(e===vh||e===Xl)return t===Be?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(e===ql)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(e===Yl||e===Kl||e===Ql||e===Zl||e===Jl||e===eu||e===tu||e===nu||e===iu||e===ru||e===su||e===ou||e===au||e===lu)if(s=r.get("WEBGL_compressed_texture_astc"),s!==null){if(e===Yl)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===Kl)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===Ql)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===Zl)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===Jl)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===eu)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===tu)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===nu)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===iu)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===ru)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===su)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===ou)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===au)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===lu)return t===Be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===Ra)if(s=r.get("EXT_texture_compression_bptc"),s!==null){if(e===Ra)return t===Be?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===hy||e===yh||e===xh||e===Sh)if(s=r.get("EXT_texture_compression_rgtc"),s!==null){if(e===Ra)return s.COMPRESSED_RED_RGTC1_EXT;if(e===yh)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===xh)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===Sh)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===ts?i.UNSIGNED_INT_24_8:i[e]!==void 0?i[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((i,r)=>{function s(){const o=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(o===e.WAIT_FAILED){e.deleteSync(t),r();return}if(o===e.TIMEOUT_EXPIRED){requestAnimationFrame(s);return}e.deleteSync(t),i()}s()})}}let JN=!1,og,bS,eP;class uj{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},JN===!1&&(this._init(this.gl),JN=!0)}_init(e){og={[ba]:e.REPEAT,[Jr]:e.CLAMP_TO_EDGE,[wa]:e.MIRRORED_REPEAT},bS={[zt]:e.NEAREST,[ip]:e.NEAREST_MIPMAP_NEAREST,[es]:e.NEAREST_MIPMAP_LINEAR,[mn]:e.LINEAR,[Hl]:e.LINEAR_MIPMAP_NEAREST,[ci]:e.LINEAR_MIPMAP_LINEAR},eP={[fy]:e.NEVER,[vy]:e.ALWAYS,[lp]:e.LESS,[up]:e.LEQUAL,[py]:e.EQUAL,[_y]:e.GEQUAL,[my]:e.GREATER,[gy]:e.NOTEQUAL}}filterFallback(e){const{gl:t}=this;return e===zt||e===ip||e===es?t.NEAREST:t.LINEAR}getGLTextureType(e){const{gl:t}=this;let i;return e.isCubeTexture===!0?i=t.TEXTURE_CUBE_MAP:e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?i=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?i=t.TEXTURE_3D:i=t.TEXTURE_2D,i}getInternalFormat(e,t,i,r,s=!1){const{gl:o,extensions:a}=this;if(e!==null){if(o[e]!==void 0)return o[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let l=t;return t===o.RED&&(i===o.FLOAT&&(l=o.R32F),i===o.HALF_FLOAT&&(l=o.R16F),i===o.UNSIGNED_BYTE&&(l=o.R8),i===o.UNSIGNED_SHORT&&(l=o.R16),i===o.UNSIGNED_INT&&(l=o.R32UI),i===o.BYTE&&(l=o.R8I),i===o.SHORT&&(l=o.R16I),i===o.INT&&(l=o.R32I)),t===o.RED_INTEGER&&(i===o.UNSIGNED_BYTE&&(l=o.R8UI),i===o.UNSIGNED_SHORT&&(l=o.R16UI),i===o.UNSIGNED_INT&&(l=o.R32UI),i===o.BYTE&&(l=o.R8I),i===o.SHORT&&(l=o.R16I),i===o.INT&&(l=o.R32I)),t===o.RG&&(i===o.FLOAT&&(l=o.RG32F),i===o.HALF_FLOAT&&(l=o.RG16F),i===o.UNSIGNED_BYTE&&(l=o.RG8),i===o.UNSIGNED_SHORT&&(l=o.RG16),i===o.UNSIGNED_INT&&(l=o.RG32UI),i===o.BYTE&&(l=o.RG8I),i===o.SHORT&&(l=o.RG16I),i===o.INT&&(l=o.RG32I)),t===o.RG_INTEGER&&(i===o.UNSIGNED_BYTE&&(l=o.RG8UI),i===o.UNSIGNED_SHORT&&(l=o.RG16UI),i===o.UNSIGNED_INT&&(l=o.RG32UI),i===o.BYTE&&(l=o.RG8I),i===o.SHORT&&(l=o.RG16I),i===o.INT&&(l=o.RG32I)),t===o.RGB&&(i===o.FLOAT&&(l=o.RGB32F),i===o.HALF_FLOAT&&(l=o.RGB16F),i===o.UNSIGNED_BYTE&&(l=o.RGB8),i===o.UNSIGNED_SHORT&&(l=o.RGB16),i===o.UNSIGNED_INT&&(l=o.RGB32UI),i===o.BYTE&&(l=o.RGB8I),i===o.SHORT&&(l=o.RGB16I),i===o.INT&&(l=o.RGB32I),i===o.UNSIGNED_BYTE&&(l=r===Be&&s===!1?o.SRGB8:o.RGB8),i===o.UNSIGNED_SHORT_5_6_5&&(l=o.RGB565),i===o.UNSIGNED_SHORT_5_5_5_1&&(l=o.RGB5_A1),i===o.UNSIGNED_SHORT_4_4_4_4&&(l=o.RGB4),i===o.UNSIGNED_INT_5_9_9_9_REV&&(l=o.RGB9_E5)),t===o.RGB_INTEGER&&(i===o.UNSIGNED_BYTE&&(l=o.RGB8UI),i===o.UNSIGNED_SHORT&&(l=o.RGB16UI),i===o.UNSIGNED_INT&&(l=o.RGB32UI),i===o.BYTE&&(l=o.RGB8I),i===o.SHORT&&(l=o.RGB16I),i===o.INT&&(l=o.RGB32I)),t===o.RGBA&&(i===o.FLOAT&&(l=o.RGBA32F),i===o.HALF_FLOAT&&(l=o.RGBA16F),i===o.UNSIGNED_BYTE&&(l=o.RGBA8),i===o.UNSIGNED_SHORT&&(l=o.RGBA16),i===o.UNSIGNED_INT&&(l=o.RGBA32UI),i===o.BYTE&&(l=o.RGBA8I),i===o.SHORT&&(l=o.RGBA16I),i===o.INT&&(l=o.RGBA32I),i===o.UNSIGNED_BYTE&&(l=r===Be&&s===!1?o.SRGB8_ALPHA8:o.RGBA8),i===o.UNSIGNED_SHORT_4_4_4_4&&(l=o.RGBA4),i===o.UNSIGNED_SHORT_5_5_5_1&&(l=o.RGB5_A1)),t===o.RGBA_INTEGER&&(i===o.UNSIGNED_BYTE&&(l=o.RGBA8UI),i===o.UNSIGNED_SHORT&&(l=o.RGBA16UI),i===o.UNSIGNED_INT&&(l=o.RGBA32UI),i===o.BYTE&&(l=o.RGBA8I),i===o.SHORT&&(l=o.RGBA16I),i===o.INT&&(l=o.RGBA32I)),t===o.DEPTH_COMPONENT&&(i===o.UNSIGNED_INT&&(l=o.DEPTH24_STENCIL8),i===o.FLOAT&&(l=o.DEPTH_COMPONENT32F)),t===o.DEPTH_STENCIL&&i===o.UNSIGNED_INT_24_8&&(l=o.DEPTH24_STENCIL8),(l===o.R16F||l===o.R32F||l===o.RG16F||l===o.RG32F||l===o.RGBA16F||l===o.RGBA32F)&&a.get("EXT_color_buffer_float"),l}setTextureParameters(e,t){const{gl:i,extensions:r,backend:s}=this;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,t.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,t.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE),i.texParameteri(e,i.TEXTURE_WRAP_S,og[t.wrapS]),i.texParameteri(e,i.TEXTURE_WRAP_T,og[t.wrapT]),(e===i.TEXTURE_3D||e===i.TEXTURE_2D_ARRAY)&&i.texParameteri(e,i.TEXTURE_WRAP_R,og[t.wrapR]),i.texParameteri(e,i.TEXTURE_MAG_FILTER,bS[t.magFilter]);const o=t.mipmaps!==void 0&&t.mipmaps.length>0,a=t.minFilter===mn&&o?ci:t.minFilter;if(i.texParameteri(e,i.TEXTURE_MIN_FILTER,bS[a]),t.compareFunction&&(i.texParameteri(e,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(e,i.TEXTURE_COMPARE_FUNC,eP[t.compareFunction])),r.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===zt||t.minFilter!==es&&t.minFilter!==ci||t.type===cn&&r.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const l=r.get("EXT_texture_filter_anisotropic");i.texParameterf(e,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,s.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:i,defaultTextures:r}=this,s=this.getGLTextureType(e);let o=r[s];o===void 0&&(o=t.createTexture(),i.state.bindTexture(s,o),t.texParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(s,t.TEXTURE_MAG_FILTER,t.NEAREST),r[s]=o),i.set(e,{textureGPU:o,glTextureType:s,isDefault:!0})}createTexture(e,t){const{gl:i,backend:r}=this,{levels:s,width:o,height:a,depth:l}=t,u=r.utils.convert(e.format,e.colorSpace),c=r.utils.convert(e.type),h=this.getInternalFormat(e.internalFormat,u,c,e.colorSpace,e.isVideoTexture),d=i.createTexture(),f=this.getGLTextureType(e);r.state.bindTexture(f,d),this.setTextureParameters(f,e),e.isDataArrayTexture||e.isCompressedArrayTexture?i.texStorage3D(i.TEXTURE_2D_ARRAY,s,h,o,a,l):e.isData3DTexture?i.texStorage3D(i.TEXTURE_3D,s,h,o,a,l):e.isVideoTexture||i.texStorage2D(f,s,h,o,a),r.set(e,{textureGPU:d,glTextureType:f,glFormat:u,glType:c,glInternalFormat:h})}copyBufferToTexture(e,t){const{gl:i,backend:r}=this,{textureGPU:s,glTextureType:o,glFormat:a,glType:l}=r.get(t),{width:u,height:c}=t.source.data;i.bindBuffer(i.PIXEL_UNPACK_BUFFER,e),r.state.bindTexture(o,s),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.texSubImage2D(o,0,0,0,u,c,a,l,0),i.bindBuffer(i.PIXEL_UNPACK_BUFFER,null),r.state.unbindTexture()}updateTexture(e,t){const{gl:i}=this,{width:r,height:s}=t,{textureGPU:o,glTextureType:a,glFormat:l,glType:u,glInternalFormat:c}=this.backend.get(e);if(e.isRenderTargetTexture||o===void 0)return;const h=d=>d.isDataTexture?d.image.data:typeof HTMLImageElement<"u"&&d instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&d instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&d instanceof ImageBitmap||d instanceof OffscreenCanvas?d:d.data;if(this.backend.state.bindTexture(a,o),this.setTextureParameters(a,e),e.isCompressedTexture){const d=e.mipmaps,f=t.image;for(let m=0;m<d.length;m++){const _=d[m];e.isCompressedArrayTexture?e.format!==i.RGBA?l!==null?i.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,m,0,0,0,_.width,_.height,f.depth,l,_.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texSubImage3D(i.TEXTURE_2D_ARRAY,m,0,0,0,_.width,_.height,f.depth,l,u,_.data):l!==null?i.compressedTexSubImage2D(i.TEXTURE_2D,m,0,0,_.width,_.height,l,_.data):console.warn("Unsupported compressed texture format")}}else if(e.isCubeTexture){const d=t.images;for(let f=0;f<6;f++){const m=h(d[f]);i.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,0,0,r,s,l,u,m)}}else if(e.isDataArrayTexture){const d=t.image;i.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,d.width,d.height,d.depth,l,u,d.data)}else if(e.isData3DTexture){const d=t.image;i.texSubImage3D(i.TEXTURE_3D,0,0,0,0,d.width,d.height,d.depth,l,u,d.data)}else if(e.isVideoTexture)e.update(),i.texImage2D(a,0,c,l,u,t.image);else{const d=h(t.image);i.texSubImage2D(a,0,0,0,r,s,l,u,d)}}generateMipmaps(e){const{gl:t,backend:i}=this,{textureGPU:r,glTextureType:s}=i.get(e);i.state.bindTexture(s,r),t.generateMipmap(s)}deallocateRenderBuffers(e){const{gl:t,backend:i}=this;if(e){const r=i.get(e);if(r.renderBufferStorageSetup=void 0,r.framebuffers){for(const s in r.framebuffers)t.deleteFramebuffer(r.framebuffers[s]);delete r.framebuffers}if(r.depthRenderbuffer&&(t.deleteRenderbuffer(r.depthRenderbuffer),delete r.depthRenderbuffer),r.stencilRenderbuffer&&(t.deleteRenderbuffer(r.stencilRenderbuffer),delete r.stencilRenderbuffer),r.msaaFrameBuffer&&(t.deleteFramebuffer(r.msaaFrameBuffer),delete r.msaaFrameBuffer),r.msaaRenderbuffers){for(let s=0;s<r.msaaRenderbuffers.length;s++)t.deleteRenderbuffer(r.msaaRenderbuffers[s]);delete r.msaaRenderbuffers}}}destroyTexture(e){const{gl:t,backend:i}=this,{textureGPU:r,renderTarget:s}=i.get(e);this.deallocateRenderBuffers(s),t.deleteTexture(r),i.delete(e)}copyTextureToTexture(e,t,i=null,r=null,s=0){const{gl:o,backend:a}=this,{state:l}=this.backend,{textureGPU:u,glTextureType:c,glType:h,glFormat:d}=a.get(t);let f,m,_,g,p,v;i!==null?(f=i.max.x-i.min.x,m=i.max.y-i.min.y,_=i.min.x,g=i.min.y):(f=e.image.width,m=e.image.height,_=0,g=0),r!==null?(p=r.x,v=r.y):(p=0,v=0),l.bindTexture(c,u),o.pixelStorei(o.UNPACK_ALIGNMENT,t.unpackAlignment),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,t.unpackAlignment);const y=o.getParameter(o.UNPACK_ROW_LENGTH),x=o.getParameter(o.UNPACK_IMAGE_HEIGHT),T=o.getParameter(o.UNPACK_SKIP_PIXELS),S=o.getParameter(o.UNPACK_SKIP_ROWS),w=o.getParameter(o.UNPACK_SKIP_IMAGES),E=e.isCompressedTexture?e.mipmaps[s]:e.image;if(o.pixelStorei(o.UNPACK_ROW_LENGTH,E.width),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,E.height),o.pixelStorei(o.UNPACK_SKIP_PIXELS,_),o.pixelStorei(o.UNPACK_SKIP_ROWS,g),e.isRenderTargetTexture||e.isDepthTexture){const M=a.get(e),b=a.get(t),R=a.get(M.renderTarget),I=a.get(b.renderTarget),B=R.framebuffers[M.cacheKey],D=I.framebuffers[b.cacheKey];l.bindFramebuffer(o.READ_FRAMEBUFFER,B),l.bindFramebuffer(o.DRAW_FRAMEBUFFER,D);let L=o.COLOR_BUFFER_BIT;e.isDepthTexture&&(L=o.DEPTH_BUFFER_BIT),o.blitFramebuffer(_,g,f,m,p,v,f,m,L,o.NEAREST),l.bindFramebuffer(o.READ_FRAMEBUFFER,null),l.bindFramebuffer(o.DRAW_FRAMEBUFFER,null)}else e.isDataTexture?o.texSubImage2D(o.TEXTURE_2D,s,p,v,f,m,d,h,E.data):e.isCompressedTexture?o.compressedTexSubImage2D(o.TEXTURE_2D,s,p,v,E.width,E.height,d,E.data):o.texSubImage2D(o.TEXTURE_2D,s,p,v,f,m,d,h,E);o.pixelStorei(o.UNPACK_ROW_LENGTH,y),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,x),o.pixelStorei(o.UNPACK_SKIP_PIXELS,T),o.pixelStorei(o.UNPACK_SKIP_ROWS,S),o.pixelStorei(o.UNPACK_SKIP_IMAGES,w),s===0&&t.generateMipmaps&&o.generateMipmap(o.TEXTURE_2D),l.unbindTexture()}copyFramebufferToTexture(e,t,i){const{gl:r}=this,{state:s}=this.backend,{textureGPU:o}=this.backend.get(e),{x:a,y:l,z:u,w:c}=i,h=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,d=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(h){const f=a!==0||l!==0;let m,_;if(e.isDepthTexture===!0?(m=r.DEPTH_BUFFER_BIT,_=r.DEPTH_ATTACHMENT,t.stencil&&(m|=r.STENCIL_BUFFER_BIT)):(m=r.COLOR_BUFFER_BIT,_=r.COLOR_ATTACHMENT0),f){const g=this.backend.get(t.renderTarget),p=g.framebuffers[t.getCacheKey()],v=g.msaaFrameBuffer;s.bindFramebuffer(r.DRAW_FRAMEBUFFER,p),s.bindFramebuffer(r.READ_FRAMEBUFFER,v);const y=d-l-c;r.blitFramebuffer(a,y,a+u,y+c,a,y,a+u,y+c,m,r.NEAREST),s.bindFramebuffer(r.READ_FRAMEBUFFER,p),s.bindTexture(r.TEXTURE_2D,o),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,a,y,u,c),s.unbindTexture()}else{const g=r.createFramebuffer();s.bindFramebuffer(r.DRAW_FRAMEBUFFER,g),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,_,r.TEXTURE_2D,o,0),r.blitFramebuffer(0,0,u,c,0,0,u,c,m,r.NEAREST),r.deleteFramebuffer(g)}}else s.bindTexture(r.TEXTURE_2D,o),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,a,d-c-l,u,c),s.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t){const{gl:i}=this,r=t.renderTarget,{samples:s,depthTexture:o,depthBuffer:a,stencilBuffer:l,width:u,height:c}=r;if(i.bindRenderbuffer(i.RENDERBUFFER,e),a&&!l){let h=i.DEPTH_COMPONENT24;s>0?(o&&o.isDepthTexture&&o.type===i.FLOAT&&(h=i.DEPTH_COMPONENT32F),i.renderbufferStorageMultisample(i.RENDERBUFFER,s,h,u,c)):i.renderbufferStorage(i.RENDERBUFFER,h,u,c),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e)}else a&&l&&(s>0?i.renderbufferStorageMultisample(i.RENDERBUFFER,s,i.DEPTH24_STENCIL8,u,c):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,u,c),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e))}async copyTextureToBuffer(e,t,i,r,s,o){const{backend:a,gl:l}=this,{textureGPU:u,glFormat:c,glType:h}=this.backend.get(e),d=l.createFramebuffer();l.bindFramebuffer(l.READ_FRAMEBUFFER,d);const f=e.isCubeTexture?l.TEXTURE_CUBE_MAP_POSITIVE_X+o:l.TEXTURE_2D;l.framebufferTexture2D(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,f,u,0);const m=this._getTypedArrayType(h),_=this._getBytesPerTexel(h,c),p=r*s*_,v=l.createBuffer();l.bindBuffer(l.PIXEL_PACK_BUFFER,v),l.bufferData(l.PIXEL_PACK_BUFFER,p,l.STREAM_READ),l.readPixels(t,i,r,s,c,h,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),await a.utils._clientWaitAsync();const y=new m(p/m.BYTES_PER_ELEMENT);return l.bindBuffer(l.PIXEL_PACK_BUFFER,v),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,y),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),l.deleteFramebuffer(d),y}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:i}=this;let r=0;if(e===i.UNSIGNED_BYTE&&(r=1),(e===i.UNSIGNED_SHORT_4_4_4_4||e===i.UNSIGNED_SHORT_5_5_5_1||e===i.UNSIGNED_SHORT_5_6_5||e===i.UNSIGNED_SHORT||e===i.HALF_FLOAT)&&(r=2),(e===i.UNSIGNED_INT||e===i.FLOAT)&&(r=4),t===i.RGBA)return r*4;if(t===i.RGB)return r*3;if(t===i.ALPHA)return r}}class cj{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class hj{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const i=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const tP={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query"};class dj{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:i,mode:r,object:s,type:o,info:a,index:l}=this;l!==0?i.drawElements(r,t,o,e):i.drawArrays(r,e,t),a.update(s,t,r,1)}renderInstances(e,t,i){const{gl:r,mode:s,type:o,index:a,object:l,info:u}=this;i!==0&&(a!==0?r.drawElementsInstanced(s,t,o,e,i):r.drawArraysInstanced(s,e,t,i),u.update(l,t,s,i))}renderMultiDraw(e,t,i){const{extensions:r,mode:s,object:o,info:a}=this;if(i===0)return;const l=r.get("WEBGL_multi_draw");if(l===null)for(let u=0;u<i;u++)this.render(e[u],t[u]);else{this.index!==0?l.multiDrawElementsWEBGL(s,t,0,this.type,e,0,i):l.multiDrawArraysWEBGL(s,e,0,t,0,i);let u=0;for(let c=0;c<i;c++)u+=t[c];a.update(o,u,s,1)}}renderMultiDrawInstances(e,t,i,r){const{extensions:s,mode:o,object:a,info:l}=this;if(i===0)return;const u=s.get("WEBGL_multi_draw");if(u===null)for(let c=0;c<i;c++)this.renderInstances(e[c],t[c],r[c]);else{this.index!==0?u.multiDrawElementsInstancedWEBGL(o,t,0,this.type,e,0,r,0,i):u.multiDrawArraysInstancedWEBGL(o,e,0,t,0,r,0,i);let c=0;for(let h=0;h<i;h++)c+=t[h]*r[h];l.update(a,c,o,1)}}}class nP extends QN{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this.trackTimestamp=e.trackTimestamp===!0,this._currentContext=null,this._knownBindings=new WeakSet}init(e){super.init(e);const t=this.parameters,i=t.context!==void 0?t.context:e.domElement.getContext("webgl2");function r(s){s.preventDefault();const o={api:"WebGL",message:s.statusMessage||"Unknown reason",reason:null,originalEvent:s};e.onDeviceLost(o)}this._onContextLost=r,e.domElement.addEventListener("webglcontextlost",r,!1),this.gl=i,this.extensions=new cj(this),this.capabilities=new hj(this),this.attributeUtils=new oj(this),this.textureUtils=new uj(this),this.bufferRenderer=new dj(this),this.state=new aj(this),this.utils=new lj(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile")}get coordinateSystem(){return Ci}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async waitForGPU(){await this.utils._clientWaitAsync()}initTimestampQuery(e){if(!this.disjoint||!this.trackTimestamp)return;const t=this.get(e);if(this.queryRunning){t.queryQueue||(t.queryQueue=[]),t.queryQueue.push(e);return}t.activeQuery&&(this.gl.endQuery(this.disjoint.TIME_ELAPSED_EXT),t.activeQuery=null),t.activeQuery=this.gl.createQuery(),t.activeQuery!==null&&(this.gl.beginQuery(this.disjoint.TIME_ELAPSED_EXT,t.activeQuery),this.queryRunning=!0)}prepareTimestampBuffer(e){if(!this.disjoint||!this.trackTimestamp)return;const t=this.get(e);if(t.activeQuery&&(this.gl.endQuery(this.disjoint.TIME_ELAPSED_EXT),t.gpuQueries||(t.gpuQueries=[]),t.gpuQueries.push({query:t.activeQuery}),t.activeQuery=null,this.queryRunning=!1,t.queryQueue&&t.queryQueue.length>0)){const i=t.queryQueue.shift();this.initTimestampQuery(i)}}async resolveTimestampAsync(e,t="render"){if(!this.disjoint||!this.trackTimestamp)return;const i=this.get(e);i.gpuQueries||(i.gpuQueries=[]);for(let r=0;r<i.gpuQueries.length;r++){const s=i.gpuQueries[r],o=this.gl.getQueryParameter(s.query,this.gl.QUERY_RESULT_AVAILABLE),a=this.gl.getParameter(this.disjoint.GPU_DISJOINT_EXT);if(o&&!a){const l=this.gl.getQueryParameter(s.query,this.gl.QUERY_RESULT),u=Number(l)/1e6;this.gl.deleteQuery(s.query),i.gpuQueries.splice(r,1),r--,this.renderer.info.updateTimestamp(t,u)}}}getContext(){return this.gl}beginRender(e){const{gl:t}=this,i=this.get(e);if(this.initTimestampQuery(e),i.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1),e.viewport?this.updateViewport(e):t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),e.scissor){const{x:s,y:o,width:a,height:l}=e.scissorValue;t.scissor(s,e.height-l-o,a,l)}const r=e.occlusionQueryCount;r>0&&(i.currentOcclusionQueries=i.occlusionQueries,i.currentOcclusionQueryObjects=i.occlusionQueryObjects,i.lastOcclusionObject=null,i.occlusionQueries=new Array(r),i.occlusionQueryObjects=new Array(r),i.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:i}=this,r=this.get(e),s=r.previousContext,o=e.occlusionQueryCount;o>0&&(o>r.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const a=e.textures;if(a!==null)for(let l=0;l<a.length;l++){const u=a[l];u.generateMipmaps&&this.generateMipmaps(u)}if(this._currentContext=s,e.textures!==null&&e.renderTarget){const l=this.get(e.renderTarget),{samples:u}=e.renderTarget;if(u>0){const c=l.framebuffers[e.getCacheKey()],h=t.COLOR_BUFFER_BIT,d=l.msaaFrameBuffer,f=e.textures;i.bindFramebuffer(t.READ_FRAMEBUFFER,d),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,c);for(let m=0;m<f.length;m++)if(e.scissor){const{x:_,y:g,width:p,height:v}=e.scissorValue,y=e.height-v-g;t.blitFramebuffer(_,y,_+p,y+v,_,y,_+p,y+v,h,t.NEAREST),t.invalidateSubFramebuffer(t.READ_FRAMEBUFFER,l.invalidationArray,_,y,p,v)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,h,t.NEAREST),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,l.invalidationArray)}}s!==null&&(this._setFramebuffer(s),s.viewport?this.updateViewport(s):t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight)),this.prepareTimestampBuffer(e)}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:i,currentOcclusionQueryObjects:r}=t;if(i&&r){const s=new WeakSet,{gl:o}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const a=()=>{let l=0;for(let u=0;u<i.length;u++){const c=i[u];c!==null&&o.getQueryParameter(c,o.QUERY_RESULT_AVAILABLE)&&(o.getQueryParameter(c,o.QUERY_RESULT)>0&&s.add(r[u]),i[u]=null,o.deleteQuery(c),l++)}l<i.length?requestAnimationFrame(a):t.occluded=s};a()}}isOccluded(e,t){const i=this.get(e);return i.occluded&&i.occluded.has(t)}updateViewport(e){const t=this.gl,{x:i,y:r,width:s,height:o}=e.viewportValue;t.viewport(i,e.height-o-r,s,o)}setScissorTest(e){const t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)}clear(e,t,i,r=null,s=!0){const{gl:o}=this;if(r===null){const l=this.getClearColor();l.r*=l.a,l.g*=l.a,l.b*=l.a,r={textures:null,clearColorValue:l}}let a=0;if(e&&(a|=o.COLOR_BUFFER_BIT),t&&(a|=o.DEPTH_BUFFER_BIT),i&&(a|=o.STENCIL_BUFFER_BIT),a!==0){let l;if(r.clearColorValue?l=r.clearColorValue:(l=this.getClearColor(),l.r*=l.a,l.g*=l.a,l.b*=l.a),t&&this.state.setDepthMask(!0),r.textures===null)o.clearColor(l.r,l.g,l.b,l.a),o.clear(a);else{if(s&&this._setFramebuffer(r),e)for(let u=0;u<r.textures.length;u++)o.clearBufferfv(o.COLOR,u,[l.r,l.g,l.b,l.a]);t&&i?o.clearBufferfi(o.DEPTH_STENCIL,0,1,0):t?o.clearBufferfv(o.DEPTH,0,[1]):i&&o.clearBufferiv(o.STENCIL,0,[0])}}}beginCompute(e){const{state:t,gl:i}=this;t.bindFramebuffer(i.FRAMEBUFFER,null),this.initTimestampQuery(e)}compute(e,t,i,r){const{state:s,gl:o}=this;this.discard===!1&&(o.enable(o.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:a,transformBuffers:l,attributes:u}=this.get(r),c=this._getVaoKey(null,u),h=this.vaoCache[c];h===void 0?this._createVao(null,u):o.bindVertexArray(h),s.useProgram(a),this._bindUniforms(i);const d=this._getTransformFeedback(l);o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,d),o.beginTransformFeedback(o.POINTS),u[0].isStorageInstancedBufferAttribute?o.drawArraysInstanced(o.POINTS,0,1,t.count):o.drawArrays(o.POINTS,0,t.count),o.endTransformFeedback(),o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,null);for(let f=0;f<l.length;f++){const m=l[f];m.pbo&&this.textureUtils.copyBufferToTexture(m.transformBuffer,m.pbo),m.switchBuffers()}}finishCompute(e){const t=this.gl;this.discard=!1,t.disable(t.RASTERIZER_DISCARD),this.prepareTimestampBuffer(e),this._currentContext&&this._setFramebuffer(this._currentContext)}draw(e){const{object:t,pipeline:i,material:r,context:s,hardwareClippingPlanes:o}=e,{programGPU:a}=this.get(i),{gl:l,state:u}=this,c=this.get(s),h=e.getDrawParameters();if(h===null)return;this._bindUniforms(e.getBindings());const d=t.isMesh&&t.matrixWorld.determinant()<0;u.setMaterial(r,d,o),u.useProgram(a);const f=this.get(e);let m=f.staticVao;if(m===void 0||f.geometryId!==e.geometry.id){const T=this._getVaoKey(e.getIndex(),e.getAttributes());if(m=this.vaoCache[T],m===void 0){let S;({vaoGPU:m,staticVao:S}=this._createVao(e.getIndex(),e.getAttributes())),S&&(f.staticVao=m,f.geometryId=e.geometry.id)}}l.bindVertexArray(m);const _=e.getIndex(),g=c.lastOcclusionObject;if(g!==t&&g!==void 0){if(g!==null&&g.occlusionTest===!0&&(l.endQuery(l.ANY_SAMPLES_PASSED),c.occlusionQueryIndex++),t.occlusionTest===!0){const T=l.createQuery();l.beginQuery(l.ANY_SAMPLES_PASSED,T),c.occlusionQueries[c.occlusionQueryIndex]=T,c.occlusionQueryObjects[c.occlusionQueryIndex]=t}c.lastOcclusionObject=t}const p=this.bufferRenderer;t.isPoints?p.mode=l.POINTS:t.isLineSegments?p.mode=l.LINES:t.isLine?p.mode=l.LINE_STRIP:t.isLineLoop?p.mode=l.LINE_LOOP:r.wireframe===!0?(u.setLineWidth(r.wireframeLinewidth*this.renderer.getPixelRatio()),p.mode=l.LINES):p.mode=l.TRIANGLES;const{vertexCount:v,instanceCount:y}=h;let{firstVertex:x}=h;if(p.object=t,_!==null){x*=_.array.BYTES_PER_ELEMENT;const T=this.get(_);p.index=_.count,p.type=T.type}else p.index=0;t.isBatchedMesh?t._multiDrawInstances!==null?p.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances):this.hasFeature("WEBGL_multi_draw")?p.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):Pa("THREE.WebGLRenderer: WEBGL_multi_draw not supported."):y>1?p.renderInstances(x,v,y):p.render(x,v),l.bindVertexArray(null)}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}copyTextureToBuffer(e,t,i,r,s,o){return this.textureUtils.copyTextureToBuffer(e,t,i,r,s,o)}createSampler(){}destroySampler(){}createNodeBuilder(e,t){return new ij(e,t)}createProgram(e){const t=this.gl,{stage:i,code:r}=e,s=i==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(s,r),t.compileShader(s),this.set(e,{shaderGPU:s})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const i=this.gl,r=e.pipeline,{fragmentProgram:s,vertexProgram:o}=r,a=i.createProgram(),l=this.get(s).shaderGPU,u=this.get(o).shaderGPU;if(i.attachShader(a,l),i.attachShader(a,u),i.linkProgram(a),this.set(r,{programGPU:a,fragmentShader:l,vertexShader:u}),t!==null&&this.parallel){const c=new Promise(h=>{const d=this.parallel,f=()=>{i.getProgramParameter(a,d.COMPLETION_STATUS_KHR)?(this._completeCompile(e,r),h()):requestAnimationFrame(f)};f()});t.push(c);return}this._completeCompile(e,r)}_handleSource(e,t){const i=e.split(`
`),r=[],s=Math.max(t-6,0),o=Math.min(t+6,i.length);for(let a=s;a<o;a++){const l=a+1;r.push(`${l===t?">":" "} ${l}: ${i[a]}`)}return r.join(`
`)}_getShaderErrors(e,t,i){const r=e.getShaderParameter(t,e.COMPILE_STATUS),s=e.getShaderInfoLog(t).trim();if(r&&s==="")return"";const o=/ERROR: 0:(\d+)/.exec(s);if(o){const a=parseInt(o[1]);return i.toUpperCase()+`

`+s+`

`+this._handleSource(e.getShaderSource(t),a)}else return s}_logProgramError(e,t,i){if(this.renderer.debug.checkShaderErrors){const r=this.gl,s=r.getProgramInfoLog(e).trim();if(r.getProgramParameter(e,r.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(r,e,i,t);else{const o=this._getShaderErrors(r,i,"vertex"),a=this._getShaderErrors(r,t,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(e,r.VALIDATE_STATUS)+`

Program Info Log: `+s+`
`+o+`
`+a)}else s!==""&&console.warn("THREE.WebGLProgram: Program Info Log:",s)}}_completeCompile(e,t){const{state:i,gl:r}=this,s=this.get(t),{programGPU:o,fragmentShader:a,vertexShader:l}=s;r.getProgramParameter(o,r.LINK_STATUS)===!1&&this._logProgramError(o,a,l),i.useProgram(o);const u=e.getBindings();this._setupBindings(u,o),this.set(t,{programGPU:o})}createComputePipeline(e,t){const{state:i,gl:r}=this,s={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(s);const{computeProgram:o}=e,a=r.createProgram(),l=this.get(s).shaderGPU,u=this.get(o).shaderGPU,c=o.transforms,h=[],d=[];for(let g=0;g<c.length;g++){const p=c[g];h.push(p.varyingName),d.push(p.attributeNode)}r.attachShader(a,l),r.attachShader(a,u),r.transformFeedbackVaryings(a,h,r.SEPARATE_ATTRIBS),r.linkProgram(a),r.getProgramParameter(a,r.LINK_STATUS)===!1&&this._logProgramError(a,l,u),i.useProgram(a),this._setupBindings(t,a);const f=o.attributes,m=[],_=[];for(let g=0;g<f.length;g++){const p=f[g].node.attribute;m.push(p),this.has(p)||this.attributeUtils.createAttribute(p,r.ARRAY_BUFFER)}for(let g=0;g<d.length;g++){const p=d[g].attribute;this.has(p)||this.attributeUtils.createAttribute(p,r.ARRAY_BUFFER);const v=this.get(p);_.push(v)}this.set(e,{programGPU:a,transformBuffers:_,attributes:m})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let i=0,r=0;for(const s of t){this.set(s,{textures:r,uniformBuffers:i});for(const o of s.bindings)o.isUniformBuffer&&i++,o.isSampledTexture&&r++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,i=this.get(e);let r=i.uniformBuffers,s=i.textures;for(const o of e.bindings)if(o.isUniformsGroup||o.isUniformBuffer){const a=o.buffer,l=t.createBuffer();t.bindBuffer(t.UNIFORM_BUFFER,l),t.bufferData(t.UNIFORM_BUFFER,a,t.DYNAMIC_DRAW),this.set(o,{index:r++,bufferGPU:l})}else if(o.isSampledTexture){const{textureGPU:a,glTextureType:l}=this.get(o.texture);this.set(o,{index:s++,textureGPU:a,glTextureType:l})}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const r=this.get(e).bufferGPU,s=e.buffer;t.bindBuffer(t.UNIFORM_BUFFER,r),t.bufferData(t.UNIFORM_BUFFER,s,t.DYNAMIC_DRAW)}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(tP).filter(r=>tP[r]===e),i=this.extensions;for(let r=0;r<t.length;r++)if(i.has(t[r]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,i=null,r=null,s=0){this.textureUtils.copyTextureToTexture(e,t,i,r,s)}copyFramebufferToTexture(e,t,i){this.textureUtils.copyFramebufferToTexture(e,t,i)}_setFramebuffer(e){const{gl:t,state:i}=this;let r=null;if(e.textures!==null){const s=e.renderTarget,o=this.get(s),{samples:a,depthBuffer:l,stencilBuffer:u}=s,c=s.isWebGLCubeRenderTarget===!0,h=s.isRenderTarget3D===!0,d=s.isRenderTargetArray===!0;let f=o.msaaFrameBuffer,m=o.depthRenderbuffer;const _=hN(e);let g;if(c?(o.cubeFramebuffers||(o.cubeFramebuffers={}),g=o.cubeFramebuffers[_]):(o.framebuffers||(o.framebuffers={}),g=o.framebuffers[_]),g===void 0){g=t.createFramebuffer(),i.bindFramebuffer(t.FRAMEBUFFER,g);const p=e.textures;if(c){o.cubeFramebuffers[_]=g;const{textureGPU:v}=this.get(p[0]),y=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+y,v,0)}else{o.framebuffers[_]=g;for(let v=0;v<p.length;v++){const y=p[v],x=this.get(y);x.renderTarget=e.renderTarget,x.cacheKey=_;const T=t.COLOR_ATTACHMENT0+v;if(h||d){const S=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,T,x.textureGPU,0,S)}else t.framebufferTexture2D(t.FRAMEBUFFER,T,t.TEXTURE_2D,x.textureGPU,0)}i.drawBuffers(e,g)}if(e.depthTexture!==null){const v=this.get(e.depthTexture),y=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;v.renderTarget=e.renderTarget,v.cacheKey=_,t.framebufferTexture2D(t.FRAMEBUFFER,y,t.TEXTURE_2D,v.textureGPU,0)}}if(a>0){if(f===void 0){const p=[];f=t.createFramebuffer(),i.bindFramebuffer(t.FRAMEBUFFER,f);const v=[],y=e.textures;for(let x=0;x<y.length;x++){if(v[x]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,v[x]),p.push(t.COLOR_ATTACHMENT0+x),l){const w=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;p.push(w)}const T=e.textures[x],S=this.get(T);t.renderbufferStorageMultisample(t.RENDERBUFFER,a,S.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+x,t.RENDERBUFFER,v[x])}if(o.msaaFrameBuffer=f,o.msaaRenderbuffers=v,m===void 0){m=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(m,e),o.depthRenderbuffer=m;const x=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;p.push(x)}o.invalidationArray=p}r=o.msaaFrameBuffer}else r=g}i.bindFramebuffer(t.FRAMEBUFFER,r)}_getVaoKey(e,t){let i="";if(e!==null){const r=this.get(e);i+=":"+r.id}for(let r=0;r<t.length;r++){const s=this.get(t[r]);i+=":"+s.id}return i}_createVao(e,t){const{gl:i}=this,r=i.createVertexArray();let s="",o=!0;if(i.bindVertexArray(r),e!==null){const a=this.get(e);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,a.bufferGPU),s+=":"+a.id}for(let a=0;a<t.length;a++){const l=t[a],u=this.get(l);s+=":"+u.id,i.bindBuffer(i.ARRAY_BUFFER,u.bufferGPU),i.enableVertexAttribArray(a),(l.isStorageBufferAttribute||l.isStorageInstancedBufferAttribute)&&(o=!1);let c,h;l.isInterleavedBufferAttribute===!0?(c=l.data.stride*u.bytesPerElement,h=l.offset*u.bytesPerElement):(c=0,h=0),u.isInteger?i.vertexAttribIPointer(a,l.itemSize,u.type,c,h):i.vertexAttribPointer(a,l.itemSize,u.type,l.normalized,c,h),l.isInstancedBufferAttribute&&!l.isInterleavedBufferAttribute?i.vertexAttribDivisor(a,l.meshPerAttribute):l.isInterleavedBufferAttribute&&l.data.isInstancedInterleavedBuffer&&i.vertexAttribDivisor(a,l.data.meshPerAttribute)}return i.bindBuffer(i.ARRAY_BUFFER,null),this.vaoCache[s]=r,{vaoGPU:r,staticVao:o}}_getTransformFeedback(e){let t="";for(let s=0;s<e.length;s++)t+=":"+e[s].id;let i=this.transformFeedbackCache[t];if(i!==void 0)return i;const{gl:r}=this;i=r.createTransformFeedback(),r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,i);for(let s=0;s<e.length;s++){const o=e[s];r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,s,o.transformBuffer)}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=i,i}_setupBindings(e,t){const i=this.gl;for(const r of e)for(const s of r.bindings){const a=this.get(s).index;if(s.isUniformsGroup||s.isUniformBuffer){const l=i.getUniformBlockIndex(t,s.name);i.uniformBlockBinding(t,l,a)}else if(s.isSampledTexture){const l=i.getUniformLocation(t,s.name);i.uniform1i(l,a)}}}_bindUniforms(e){const{gl:t,state:i}=this;for(const r of e)for(const s of r.bindings){const o=this.get(s),a=o.index;s.isUniformsGroup||s.isUniformBuffer?i.bindBufferBase(t.UNIFORM_BUFFER,a,o.bufferGPU):s.isSampledTexture&&i.bindTexture(o.glTextureType,o.textureGPU,t.TEXTURE0+a)}}dispose(){this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const nc={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},Wn={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},ii={Store:"store",Discard:"discard"},fn={Load:"load",Clear:"clear"},wS={CCW:"ccw",CW:"cw"},MS={None:"none",Front:"front",Back:"back"},ic={Uint16:"uint16",Uint32:"uint32"},U={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10uFloat:"rgb10a2unorm",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Stencil8:"stencil8",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},ES={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},nl={Linear:"linear",Nearest:"nearest"},qe={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDstColor:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},il={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},iP={None:0,Red:1,Green:2,Blue:4,Alpha:8,All:15},na={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},AS={Uniform:"uniform",Storage:"storage",ReadOnlyStorage:"read-only-storage"},CS={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},rc={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},rP={OneD:"1d",TwoD:"2d",ThreeD:"3d"},Oi={OneD:"1d",TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",CubeArray:"cube-array",ThreeD:"3d"},fj={All:"all",StencilOnly:"stencil-only",DepthOnly:"depth-only"},ag={Vertex:"vertex",Instance:"instance"},RS={DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups"};class pj extends xS{constructor(e,t){super(e),this.texture=t,this.version=t?t.version:0,this.isSampler=!0}}class mj extends pj{constructor(e,t,i){super(e,t?t.value:null),this.textureNode=t,this.groupNode=i}update(){this.texture=this.textureNode.value}}class gj extends HN{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let _j=0;class vj extends gj{constructor(e,t){super("StorageBuffer_"+_j++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:js.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class yj extends Jo{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,i=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,r=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:nl.Linear}),this.flipYSampler=e.createSampler({minFilter:nl.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:t}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:i}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:r})}getTransferPipeline(e){let t=this.transferPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:nc.TriangleStrip,stripIndexFormat:ic.Uint32},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:nc.TriangleStrip,stripIndexFormat:ic.Uint32},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,i=0){const r=t.format,{width:s,height:o}=t.size,a=this.getTransferPipeline(r),l=this.getFlipYPipeline(r),u=this.device.createTexture({size:{width:s,height:o,depthOrArrayLayers:1},format:r,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),c=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Oi.TwoD,baseArrayLayer:i}),h=u.createView({baseMipLevel:0,mipLevelCount:1,dimension:Oi.TwoD,baseArrayLayer:0}),d=this.device.createCommandEncoder({}),f=(m,_,g)=>{const p=m.getBindGroupLayout(0),v=this.device.createBindGroup({layout:p,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:_}]}),y=d.beginRenderPass({colorAttachments:[{view:g,loadOp:fn.Clear,storeOp:ii.Store,clearValue:[0,0,0,0]}]});y.setPipeline(m),y.setBindGroup(0,v),y.draw(4,1,0,0),y.end()};f(a,c,h),f(l,h,c),this.device.queue.submit([d.finish()]),u.destroy()}generateMipmaps(e,t,i=0){const r=this.get(e);r.useCount===void 0&&(r.useCount=0,r.layers=[]);const s=r.layers[i]||this._mipmapCreateBundles(e,t,i),o=this.device.createCommandEncoder({});this._mipmapRunBundles(o,s),this.device.queue.submit([o.finish()]),r.useCount!==0&&(r.layers[i]=s),r.useCount++}_mipmapCreateBundles(e,t,i){const r=this.getTransferPipeline(t.format),s=r.getBindGroupLayout(0);let o=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Oi.TwoD,baseArrayLayer:i});const a=[];for(let l=1;l<t.mipLevelCount;l++){const u=this.device.createBindGroup({layout:s,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:o}]}),c=e.createView({baseMipLevel:l,mipLevelCount:1,dimension:Oi.TwoD,baseArrayLayer:i}),h={colorAttachments:[{view:c,loadOp:fn.Clear,storeOp:ii.Store,clearValue:[0,0,0,0]}]},d=this.device.createRenderBundleEncoder({colorFormats:[t.format]});d.setPipeline(r),d.setBindGroup(0,u),d.draw(4,1,0,0),a.push({renderBundles:[d.finish()],passDescriptor:h}),o=c}return a}_mipmapRunBundles(e,t){const i=t.length;for(let r=0;r<i;r++){const s=t[r],o=e.beginRenderPass(s.passDescriptor);o.executeBundles(s.renderBundles),o.end()}}}const xj={[fy]:"never",[lp]:"less",[py]:"equal",[up]:"less-equal",[my]:"greater",[_y]:"greater-equal",[vy]:"always",[gy]:"not-equal"},Sj=[0,1,3,2,4,5];class Tj{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new Ho,this.depthTexture.name="depthBuffer"}createSampler(e){const t=this.backend,i=t.device,r=t.get(e),s={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};s.magFilter===nl.Linear&&s.minFilter===nl.Linear&&s.mipmapFilter===nl.Linear&&(s.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(s.compare=xj[e.compareFunction]),r.sampler=i.createSampler(s)}createDefaultTexture(e){let t;const i=NS(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(i):e.isVideoTexture?this.backend.get(e).externalTexture=this._getDefaultVideoFrame():t=this._getDefaultTextureGPU(i),this.backend.get(e).texture=t}createTexture(e,t={}){const i=this.backend,r=i.get(e);if(r.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:s,height:o,depth:a,levels:l}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const u=this._getDimension(e),c=e.internalFormat||t.format||NS(e,i.device);r.format=c;const{samples:h,primarySamples:d,isMSAA:f}=i.utils.getTextureSampleData(e);let m=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(m|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&(m|=GPUTextureUsage.RENDER_ATTACHMENT);const _={label:e.name,size:{width:s,height:o,depthOrArrayLayers:a},mipLevelCount:l,sampleCount:d,dimension:u,format:c,usage:m};if(e.isVideoTexture){const g=e.source.data,p=new VideoFrame(g);_.size.width=p.displayWidth,_.size.height=p.displayHeight,p.close(),r.externalTexture=g}else{if(c===void 0)return console.warn("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);r.texture=i.device.createTexture(_)}if(f){const g=Object.assign({},_);g.label=g.label+"-msaa",g.sampleCount=h,r.msaaTexture=i.device.createTexture(g)}r.initialized=!0,r.textureDescriptorGPU=_}destroyTexture(e){const t=this.backend,i=t.get(e);i.texture!==void 0&&i.texture.destroy(),i.msaaTexture!==void 0&&i.msaaTexture.destroy(),t.delete(e)}destroySampler(e){const i=this.backend.get(e);delete i.sampler}generateMipmaps(e){const t=this.backend.get(e);if(e.isCubeTexture)for(let i=0;i<6;i++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,i);else{const i=e.image.depth||1;for(let r=0;r<i;r++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,r)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const e=this.backend,{width:t,height:i}=e.getDrawingBufferSize();return this.colorBuffer=e.device.createTexture({label:"colorBuffer",size:{width:t,height:i,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.samples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(e=!0,t=!1){const i=this.backend,{width:r,height:s}=i.getDrawingBufferSize(),o=this.depthTexture,a=i.get(o).texture;let l,u;if(t?(l=is,u=ts):e&&(l=ns,u=en),a!==void 0){if(o.image.width===r&&o.image.height===s&&o.format===l&&o.type===u)return a;this.destroyTexture(o)}return o.name="depthBuffer",o.format=l,o.type=u,o.image.width=r,o.image.height=s,this.createTexture(o,{width:r,height:s}),i.get(o).texture}updateTexture(e,t){const i=this.backend.get(e),{textureDescriptorGPU:r}=i;if(!(e.isRenderTargetTexture||r===void 0)){if(e.isDataTexture)this._copyBufferToTexture(t.image,i.texture,r,0,e.flipY);else if(e.isDataArrayTexture||e.isData3DTexture)for(let s=0;s<t.image.depth;s++)this._copyBufferToTexture(t.image,i.texture,r,s,e.flipY,s);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,i.texture,r);else if(e.isCubeTexture)this._copyCubeMapToTexture(t.images,i.texture,r,e.flipY);else if(e.isVideoTexture){const s=e.source.data;i.externalTexture=s}else this._copyImageToTexture(t.image,i.texture,r,0,e.flipY);i.version=e.version,e.onUpdate&&e.onUpdate(e)}}async copyTextureToBuffer(e,t,i,r,s,o){const a=this.backend.device,l=this.backend.get(e),u=l.texture,c=l.textureDescriptorGPU.format,h=this._getBytesPerTexel(c);let d=r*h;d=Math.ceil(d/256)*256;const f=a.createBuffer({size:r*s*h,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),m=a.createCommandEncoder();m.copyTextureToBuffer({texture:u,origin:{x:t,y:i,z:o}},{buffer:f,bytesPerRow:d},{width:r,height:s});const _=this._getTypedArrayType(c);a.queue.submit([m.finish()]),await f.mapAsync(GPUMapMode.READ);const g=f.getMappedRange();return new _(g)}_isEnvironmentTexture(e){const t=e.mapping;return t===No||t===Po||t===fr||t===pr}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const i=new gn;i.minFilter=zt,i.magFilter=zt,this.createTexture(i,{width:1,height:1,format:e}),this.defaultTexture[e]=t=i}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const i=new Pp;i.minFilter=zt,i.magFilter=zt,this.createTexture(i,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=i}return this.backend.get(t).texture}_getDefaultVideoFrame(){let e=this.defaultVideoFrame;if(e===null){const t={timestamp:0,codedWidth:1,codedHeight:1,format:"RGBA"};this.defaultVideoFrame=e=new VideoFrame(new Uint8Array([0,0,0,255]),t)}return e}_copyCubeMapToTexture(e,t,i,r){for(let s=0;s<6;s++){const o=e[s],a=r===!0?Sj[s]:s;o.isDataTexture?this._copyBufferToTexture(o.image,t,i,a,r):this._copyImageToTexture(o,t,i,a,r)}}_copyImageToTexture(e,t,i,r,s){this.backend.device.queue.copyExternalImageToTexture({source:e},{texture:t,mipLevel:0,origin:{x:0,y:0,z:r}},{width:e.width,height:e.height,depthOrArrayLayers:1}),s===!0&&this._flipY(t,i,r)}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new yj(this.backend.device)),e}_generateMipmaps(e,t,i=0){this._getPassUtils().generateMipmaps(e,t,i)}_flipY(e,t,i=0){this._getPassUtils().flipY(e,t,i)}_copyBufferToTexture(e,t,i,r,s,o=0){const a=this.backend.device,l=e.data,u=this._getBytesPerTexel(i.format),c=e.width*u;a.queue.writeTexture({texture:t,mipLevel:0,origin:{x:0,y:0,z:r}},l,{offset:e.width*e.height*u*o,bytesPerRow:c},{width:e.width,height:e.height,depthOrArrayLayers:1}),s===!0&&this._flipY(t,i,r)}_copyCompressedBufferToTexture(e,t,i){const r=this.backend.device,s=this._getBlockData(i.format),o=i.size.depthOrArrayLayers>1;for(let a=0;a<e.length;a++){const l=e[a],u=l.width,c=l.height,h=o?i.size.depthOrArrayLayers:1,d=Math.ceil(u/s.width)*s.byteLength,f=d*Math.ceil(c/s.height);for(let m=0;m<h;m++)r.queue.writeTexture({texture:t,mipLevel:a,origin:{x:0,y:0,z:m}},l.data,{offset:m*f,bytesPerRow:d,rowsPerImage:Math.ceil(c/s.height)},{width:Math.ceil(u/s.width)*s.width,height:Math.ceil(c/s.height)*s.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===U.BC1RGBAUnorm||e===U.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===U.BC2RGBAUnorm||e===U.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===U.BC3RGBAUnorm||e===U.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===U.BC4RUnorm||e===U.BC4RSNorm)return{byteLength:8,width:4,height:4};if(e===U.BC5RGUnorm||e===U.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===U.BC6HRGBUFloat||e===U.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===U.BC7RGBAUnorm||e===U.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===U.ETC2RGB8Unorm||e===U.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===U.ETC2RGB8A1Unorm||e===U.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===U.ETC2RGBA8Unorm||e===U.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===U.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===U.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===U.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===U.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===U.ASTC4x4Unorm||e===U.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===U.ASTC5x4Unorm||e===U.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===U.ASTC5x5Unorm||e===U.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===U.ASTC6x5Unorm||e===U.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===U.ASTC6x6Unorm||e===U.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===U.ASTC8x5Unorm||e===U.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===U.ASTC8x6Unorm||e===U.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===U.ASTC8x8Unorm||e===U.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===U.ASTC10x5Unorm||e===U.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===U.ASTC10x6Unorm||e===U.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===U.ASTC10x8Unorm||e===U.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===U.ASTC10x10Unorm||e===U.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===U.ASTC12x10Unorm||e===U.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===U.ASTC12x12Unorm||e===U.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=ES.ClampToEdge;return e===ba?t=ES.Repeat:e===wa&&(t=ES.MirrorRepeat),t}_convertFilterMode(e){let t=nl.Linear;return(e===zt||e===ip||e===es)&&(t=nl.Nearest),t}_getBytesPerTexel(e){if(e===U.R8Unorm||e===U.R8Snorm||e===U.R8Uint||e===U.R8Sint)return 1;if(e===U.R16Uint||e===U.R16Sint||e===U.R16Float||e===U.RG8Unorm||e===U.RG8Snorm||e===U.RG8Uint||e===U.RG8Sint)return 2;if(e===U.R32Uint||e===U.R32Sint||e===U.R32Float||e===U.RG16Uint||e===U.RG16Sint||e===U.RG16Float||e===U.RGBA8Unorm||e===U.RGBA8UnormSRGB||e===U.RGBA8Snorm||e===U.RGBA8Uint||e===U.RGBA8Sint||e===U.BGRA8Unorm||e===U.BGRA8UnormSRGB||e===U.RGB9E5UFloat||e===U.RGB10A2Unorm||e===U.RG11B10UFloat||e===U.Depth32Float||e===U.Depth24Plus||e===U.Depth24PlusStencil8||e===U.Depth32FloatStencil8)return 4;if(e===U.RG32Uint||e===U.RG32Sint||e===U.RG32Float||e===U.RGBA16Uint||e===U.RGBA16Sint||e===U.RGBA16Float)return 8;if(e===U.RGBA32Uint||e===U.RGBA32Sint||e===U.RGBA32Float)return 16}_getTypedArrayType(e){if(e===U.R8Uint)return Uint8Array;if(e===U.R8Sint)return Int8Array;if(e===U.R8Unorm)return Uint8Array;if(e===U.R8Snorm)return Int8Array;if(e===U.RG8Uint)return Uint8Array;if(e===U.RG8Sint)return Int8Array;if(e===U.RG8Unorm)return Uint8Array;if(e===U.RG8Snorm)return Int8Array;if(e===U.RGBA8Uint)return Uint8Array;if(e===U.RGBA8Sint)return Int8Array;if(e===U.RGBA8Unorm)return Uint8Array;if(e===U.RGBA8Snorm)return Int8Array;if(e===U.R16Uint)return Uint16Array;if(e===U.R16Sint)return Int16Array;if(e===U.RG16Uint)return Uint16Array;if(e===U.RG16Sint)return Int16Array;if(e===U.RGBA16Uint)return Uint16Array;if(e===U.RGBA16Sint)return Int16Array;if(e===U.R16Float||e===U.RG16Float||e===U.RGBA16Float)return Uint16Array;if(e===U.R32Uint)return Uint32Array;if(e===U.R32Sint)return Int32Array;if(e===U.R32Float)return Float32Array;if(e===U.RG32Uint)return Uint32Array;if(e===U.RG32Sint)return Int32Array;if(e===U.RG32Float)return Float32Array;if(e===U.RGBA32Uint)return Uint32Array;if(e===U.RGBA32Sint)return Int32Array;if(e===U.RGBA32Float)return Float32Array;if(e===U.BGRA8Unorm||e===U.BGRA8UnormSRGB)return Uint8Array;if(e===U.RGB10A2Unorm||e===U.RGB9E5UFloat||e===U.RG11B10UFloat)return Uint32Array;if(e===U.Depth32Float)return Float32Array;if(e===U.Depth24Plus||e===U.Depth24PlusStencil8)return Uint32Array;if(e===U.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.isData3DTexture?t=rP.ThreeD:t=rP.TwoD,t}}function NS(n,e=null){const t=n.format,i=n.type,r=n.colorSpace;let s;if(n.isCompressedTexture===!0||n.isCompressedArrayTexture===!0)switch(t){case Do:s=r===Be?U.BC1RGBAUnormSRGB:U.BC1RGBAUnorm;break;case Lo:s=r===Be?U.BC2RGBAUnormSRGB:U.BC2RGBAUnorm;break;case Io:s=r===Be?U.BC3RGBAUnormSRGB:U.BC3RGBAUnorm;break;case Xl:s=r===Be?U.ETC2RGB8UnormSRGB:U.ETC2RGB8Unorm;break;case ql:s=r===Be?U.ETC2RGBA8UnormSRGB:U.ETC2RGBA8Unorm;break;case Yl:s=r===Be?U.ASTC4x4UnormSRGB:U.ASTC4x4Unorm;break;case Kl:s=r===Be?U.ASTC5x4UnormSRGB:U.ASTC5x4Unorm;break;case Ql:s=r===Be?U.ASTC5x5UnormSRGB:U.ASTC5x5Unorm;break;case Zl:s=r===Be?U.ASTC6x5UnormSRGB:U.ASTC6x5Unorm;break;case Jl:s=r===Be?U.ASTC6x6UnormSRGB:U.ASTC6x6Unorm;break;case eu:s=r===Be?U.ASTC8x5UnormSRGB:U.ASTC8x5Unorm;break;case tu:s=r===Be?U.ASTC8x6UnormSRGB:U.ASTC8x6Unorm;break;case nu:s=r===Be?U.ASTC8x8UnormSRGB:U.ASTC8x8Unorm;break;case iu:s=r===Be?U.ASTC10x5UnormSRGB:U.ASTC10x5Unorm;break;case ru:s=r===Be?U.ASTC10x6UnormSRGB:U.ASTC10x6Unorm;break;case su:s=r===Be?U.ASTC10x8UnormSRGB:U.ASTC10x8Unorm;break;case ou:s=r===Be?U.ASTC10x10UnormSRGB:U.ASTC10x10Unorm;break;case au:s=r===Be?U.ASTC12x10UnormSRGB:U.ASTC12x10Unorm;break;case lu:s=r===Be?U.ASTC12x12UnormSRGB:U.ASTC12x12Unorm;break;case Gn:s=r===Be?U.RGBA8UnormSRGB:U.RGBA8Unorm;break;default:console.error("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case Gn:switch(i){case Ma:s=U.RGBA8Snorm;break;case Ea:s=U.RGBA16Sint;break;case Pr:s=U.RGBA16Uint;break;case en:s=U.RGBA32Uint;break;case Un:s=U.RGBA32Sint;break;case Kn:s=r===Be?U.RGBA8UnormSRGB:U.RGBA8Unorm;break;case hi:s=U.RGBA16Float;break;case cn:s=U.RGBA32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",i)}break;case dh:switch(i){case op:s=U.RGB9E5UFloat;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",i)}break;case fh:switch(i){case Ma:s=U.R8Snorm;break;case Ea:s=U.R16Sint;break;case Pr:s=U.R16Uint;break;case en:s=U.R32Uint;break;case Un:s=U.R32Sint;break;case Kn:s=U.R8Unorm;break;case hi:s=U.R16Float;break;case cn:s=U.R32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",i)}break;case Aa:switch(i){case Ma:s=U.RG8Snorm;break;case Ea:s=U.RG16Sint;break;case Pr:s=U.RG16Uint;break;case en:s=U.RG32Uint;break;case Un:s=U.RG32Sint;break;case Kn:s=U.RG8Unorm;break;case hi:s=U.RG16Float;break;case cn:s=U.RG32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",i)}break;case ns:switch(i){case Pr:s=U.Depth16Unorm;break;case en:s=U.Depth24Plus;break;case cn:s=U.Depth32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",i)}break;case is:switch(i){case ts:s=U.Depth24PlusStencil8;break;case cn:e&&e.features.has(RS.Depth32FloatStencil8)===!1&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),s=U.Depth32FloatStencil8;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",i)}break;case Wl:switch(i){case Un:s=U.R32Sint;break;case en:s=U.R32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",i)}break;case $l:switch(i){case Un:s=U.RG32Sint;break;case en:s=U.RG32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",i)}break;case jl:switch(i){case Un:s=U.RGBA32Sint;break;case en:s=U.RGBA32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",i)}break;default:console.error("WebGPURenderer: Unsupported texture format.",t)}return s}const bj=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,wj=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,sP={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},Mj=n=>{n=n.trim();const e=n.match(bj);if(e!==null&&e.length===4){const t=e[2],i=[];let r=null;for(;(r=wj.exec(t))!==null;)i.push({name:r[1],type:r[2]});const s=[];for(let c=0;c<i.length;c++){const{name:h,type:d}=i[c];let f=d;f.startsWith("ptr")?f="pointer":(f.startsWith("texture")&&(f=d.split("<")[0]),f=sP[f]),s.push(new pS(f,h))}const o=n.substring(e[0].length),a=e[3]||"void",l=e[1]!==void 0?e[1]:"";return{type:sP[a]||a,inputs:s,name:l,inputsCode:t,blockCode:o,outputType:a}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class Ej extends gS{constructor(e){const{type:t,inputs:i,name:r,inputsCode:s,blockCode:o,outputType:a}=Mj(e);super(t,i,r),this.inputsCode=s,this.blockCode=o,this.outputType=a}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class Aj extends BN{parseFunction(e){return new Ej(e)}}const sc=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},Cj={[js.READ_ONLY]:"read",[js.WRITE_ONLY]:"write",[js.READ_WRITE]:"read_write"},oP={[ba]:"repeat",[Jr]:"clamp",[wa]:"mirror"},lg={vertex:sc?sc.VERTEX:1,fragment:sc?sc.FRAGMENT:2,compute:sc?sc.COMPUTE:4},aP={instance:!0,swizzleAssign:!1,storageBuffer:!0},Rj={"^^":"tsl_xor"},Nj={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},lP={},xr={tsl_xor:new Nn("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new Nn("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new Nn("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new Nn("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new Nn("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new Nn("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new Nn("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new Nn("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new Nn("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new Nn("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new Nn("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new Nn("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new Nn(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},Nd={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};typeof navigator<"u"&&/Windows/g.test(navigator.userAgent)&&(xr.pow_float=new Nn("fn tsl_pow_float( a : f32, b : f32 ) -> f32 { return select( -pow( -a, b ), pow( a, b ), a > 0.0 ); }"),xr.pow_vec2=new Nn("fn tsl_pow_vec2( a : vec2f, b : vec2f ) -> vec2f { return vec2f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ) ); }",[xr.pow_float]),xr.pow_vec3=new Nn("fn tsl_pow_vec3( a : vec3f, b : vec3f ) -> vec3f { return vec3f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ) ); }",[xr.pow_float]),xr.pow_vec4=new Nn("fn tsl_pow_vec4( a : vec4f, b : vec4f ) -> vec4f { return vec4f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ), tsl_pow_float( a.w, b.w ) ); }",[xr.pow_float]),Nd.pow_float="tsl_pow_float",Nd.pow_vec2="tsl_pow_vec2",Nd.pow_vec3="tsl_pow_vec3",Nd.pow_vec4="tsl_pow_vec4");let uP="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(uP+=`diagnostic( off, derivative_uniformity );
`);class Pj extends UN{constructor(e,t){super(e,t,new Aj),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==Yi}_generateTextureSample(e,t,i,r,s=this.shaderStage){return s==="fragment"?r?`textureSample( ${t}, ${t}_sampler, ${i}, ${r} )`:`textureSample( ${t}, ${t}_sampler, ${i} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,i):this.generateTextureLod(e,t,i,r,"0")}_generateVideoSample(e,t,i=this.shaderStage){if(i==="fragment")return`textureSampleBaseClampToEdge( ${e}, ${e}_sampler, vec2<f32>( ${t}.x, 1.0 - ${t}.y ) )`;console.error(`WebGPURenderer: THREE.VideoTexture does not support ${i} shader.`)}_generateTextureSampleLevel(e,t,i,r,s,o=this.shaderStage){return(o==="fragment"||o==="compute")&&this.isUnfilterable(e)===!1?`textureSampleLevel( ${t}, ${t}_sampler, ${i}, ${r} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,i,r):this.generateTextureLod(e,t,i,s,r)}generateWrapFunction(e){const t=`tsl_coord_${oP[e.wrapS]}S_${oP[e.wrapT]}_${e.isData3DTexture?"3d":"2d"}T`;let i=lP[t];if(i===void 0){const r=[],s=e.isData3DTexture?"vec3f":"vec2f";let o=`fn ${t}( coord : ${s} ) -> ${s} {

	return ${s}(
`;const a=(l,u)=>{l===ba?(r.push(xr.repeatWrapping_float),o+=`		tsl_repeatWrapping_float( coord.${u} )`):l===Jr?(r.push(xr.clampWrapping_float),o+=`		tsl_clampWrapping_float( coord.${u} )`):l===wa?(r.push(xr.mirrorWrapping_float),o+=`		tsl_mirrorWrapping_float( coord.${u} )`):(o+=`		coord.${u}`,console.warn(`WebGPURenderer: Unsupported texture wrap type "${l}" for vertex shader.`))};a(e.wrapS,"x"),o+=`,
`,a(e.wrapT,"y"),e.isData3DTexture&&(o+=`,
`,a(e.wrapR,"z")),o+=`
	);

}
`,lP[t]=i=new Nn(o,r)}return i.build(this),t}generateTextureDimension(e,t,i){const r=this.getDataFromNode(e,this.shaderStage,this.globalCache);r.dimensionsSnippet===void 0&&(r.dimensionsSnippet={});let s=r.dimensionsSnippet[i];if(r.dimensionsSnippet[i]===void 0){let o,a;const{primarySamples:l}=this.renderer.backend.utils.getTextureSampleData(e),u=l>1;e.isData3DTexture?a="vec3<u32>":a="vec2<u32>",u||e.isVideoTexture||e.isStorageTexture?o=t:o=`${t}${i?`, u32( ${i} )`:""}`,s=new Um(new Bm(`textureDimensions( ${o} )`,a)),r.dimensionsSnippet[i]=s,(e.isDataArrayTexture||e.isData3DTexture)&&(r.arrayLayerCount=new Um(new Bm(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(r.cubeFaceCount=new Um(new Bm("6u","u32")))}return s.build(this)}generateFilteredTexture(e,t,i,r="0u"){this._include("biquadraticTexture");const s=this.generateWrapFunction(e),o=this.generateTextureDimension(e,t,r);return`tsl_biquadraticTexture( ${t}, ${s}( ${i} ), ${o}, u32( ${r} ) )`}generateTextureLod(e,t,i,r,s="0u"){const o=this.generateWrapFunction(e),a=this.generateTextureDimension(e,t,s),l=e.isData3DTexture?"vec3":"vec2",u=`${l}<u32>(${o}(${i}) * ${l}<f32>(${a}))`;return this.generateTextureLoad(e,t,u,r,s)}generateTextureLoad(e,t,i,r,s="0u"){return e.isVideoTexture===!0||e.isStorageTexture===!0?`textureLoad( ${t}, ${i} )`:r?`textureLoad( ${t}, ${i}, ${r}, u32( ${s} ) )`:`textureLoad( ${t}, ${i}, u32( ${s} ) )`}generateTextureStore(e,t,i,r){return`textureStore( ${t}, ${i}, ${r} )`}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===cn||this.isSampleCompare(e)===!1&&e.minFilter===zt&&e.magFilter===zt||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,i,r,s=this.shaderStage){let o=null;return e.isVideoTexture===!0?o=this._generateVideoSample(t,i,s):this.isUnfilterable(e)?o=this.generateTextureLod(e,t,i,r,"0",s):o=this._generateTextureSample(e,t,i,r,s),o}generateTextureGrad(e,t,i,r,s,o=this.shaderStage){if(o==="fragment")return`textureSampleGrad( ${t}, ${t}_sampler, ${i},  ${r[0]}, ${r[1]} )`;console.error(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${o} shader.`)}generateTextureCompare(e,t,i,r,s,o=this.shaderStage){if(o==="fragment")return`textureSampleCompare( ${t}, ${t}_sampler, ${i}, ${r} )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}generateTextureLevel(e,t,i,r,s,o=this.shaderStage){let a=null;return e.isVideoTexture===!0?a=this._generateVideoSample(t,i,o):a=this._generateTextureSampleLevel(e,t,i,r,s,o),a}generateTextureBias(e,t,i,r,s,o=this.shaderStage){if(o==="fragment")return`textureSampleBias( ${t}, ${t}_sampler, ${i}, ${r} )`;console.error(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${o} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const i=e.name,r=e.type;return r==="texture"||r==="cubeTexture"||r==="storageTexture"||r==="texture3D"?i:r==="buffer"||r==="storageBuffer"||r==="indirectStorageBuffer"?`NodeBuffer_${e.id}.${i}`:e.groupNode.name+"."+i}return super.getPropertyName(e)}getOutputStructName(){return"output"}_getUniformGroupCount(e){return Object.keys(this.uniforms[e]).length}getFunctionOperator(e){const t=Rj[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?js.READ_ONLY:e.access}getStorageAccess(e,t){return Cj[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,i,r=null){const s=super.getUniformFromNode(e,t,i,r),o=this.getDataFromNode(e,i,this.globalCache);if(o.uniformGPU===void 0){let a;const l=e.groupNode,u=l.name,c=this.getBindGroupArray(u,i);if(t==="texture"||t==="cubeTexture"||t==="storageTexture"||t==="texture3D"){let h=null;const d=this.getNodeAccess(e,i);if(t==="texture"||t==="storageTexture"?h=new sg(s.name,s.node,l,d):t==="cubeTexture"?h=new XN(s.name,s.node,l,d):t==="texture3D"&&(h=new qN(s.name,s.node,l,d)),h.store=e.isStorageTextureNode===!0,h.setVisibility(lg[i]),(i==="fragment"||i==="compute")&&this.isUnfilterable(e.value)===!1&&h.store===!1){const f=new mj(`${s.name}_sampler`,s.node,l);f.setVisibility(lg[i]),c.push(f,h),a=[f,h]}else c.push(h),a=[h]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const h=t==="buffer"?$N:vj,d=new h(e,l);d.setVisibility(lg[i]),c.push(d),a=d}else{const h=this.uniformGroups[i]||(this.uniformGroups[i]={});let d=h[u];d===void 0&&(d=new jN(u,l),d.setVisibility(lg[i]),h[u]=d,c.push(d)),a=this.getNodeUniform(s,t),d.addUniform(a)}o.uniformGPU=a}return s}getBuiltin(e,t,i,r=this.shaderStage){const s=this.builtins[r]||(this.builtins[r]=new Map);return s.has(e)===!1&&s.set(e,{name:e,property:t,type:i}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,i=this.flowShaderNode(e),r=[];for(const o of t.inputs)r.push(o.name+" : "+this.getType(o.type));let s=`fn ${t.name}( ${r.join(", ")} ) -> ${this.getType(t.type)} {
${i.vars}
${i.code}
`;return i.result&&(s+=`	return ${i.result};
`),s+=`
}
`,s}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],i=this.directives[e];if(i!==void 0)for(const r of i)t.push(`enable ${r};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],i=this.builtins[e];if(i!==void 0)for(const{name:r,property:s,type:o}of i.values())t.push(`@builtin( ${r} ) ${s} : ${o}`);return t.join(`,
	`)}getScopedArray(e,t,i,r){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:i,bufferCount:r}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:i,scope:r,bufferType:s,bufferCount:o}of this.scopedArrays.values()){const a=this.getType(s);t.push(`var<${r}> ${i}: array< ${a}, ${o} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","id","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const i=this.getBuiltins("attribute");i&&t.push(i);const r=this.getAttributesArray();for(let s=0,o=r.length;s<o;s++){const a=r[s],l=a.name,u=this.getType(a.type);t.push(`@location( ${s} ) ${l} : ${u}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[],i=e.getMemberTypes();for(let s=0;s<i.length;s++){const o=i[s];t.push(`	@location( ${s} ) m${s} : ${o}<f32>`)}const r=this.getBuiltins("output");return r&&t.push("	"+r),t.join(`,
`)}getStructs(e){const t=[],i=this.structs[e];for(let r=0,s=i.length;r<s;r++){const o=i[r],a=o.name;let l=`struct ${a} {
`;l+=this.getStructMembers(o),l+=`
}`,t.push(l),t.push(`
var<private> output : ${a};

`)}return t.join(`

`)}getVar(e,t){return`var ${t} : ${this.getType(e)}`}getVars(e){const t=[],i=this.vars[e];if(i!==void 0)for(const r of i)t.push(`	${this.getVar(r.type,r.name)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const s=this.varyings,o=this.vars[e];for(let a=0;a<s.length;a++){const l=s[a];if(l.needsInterpolation){let u=`@location( ${a} )`;/^(int|uint|ivec|uvec)/.test(l.type)&&(u+=" @interpolate( flat )"),t.push(`${u} ${l.name} : ${this.getType(l.type)}`)}else e==="vertex"&&o.includes(l)===!1&&o.push(l)}}const i=this.getBuiltins(e);i&&t.push(i);const r=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+r):r}getUniforms(e){const t=this.uniforms[e],i=[],r=[],s=[],o={};for(const l of t){const u=l.groupNode.name,c=this.bindingsIndexes[u];if(l.type==="texture"||l.type==="cubeTexture"||l.type==="storageTexture"||l.type==="texture3D"){const h=l.node.value;(e==="fragment"||e==="compute")&&this.isUnfilterable(h)===!1&&l.node.isStorageTextureNode!==!0&&(this.isSampleCompare(h)?i.push(`@binding( ${c.binding++} ) @group( ${c.group} ) var ${l.name}_sampler : sampler_comparison;`):i.push(`@binding( ${c.binding++} ) @group( ${c.group} ) var ${l.name}_sampler : sampler;`));let d,f="";const{primarySamples:m}=this.renderer.backend.utils.getTextureSampleData(h);if(m>1&&(f="_multisampled"),h.isCubeTexture===!0)d="texture_cube<f32>";else if(h.isDataArrayTexture===!0||h.isCompressedArrayTexture===!0)d="texture_2d_array<f32>";else if(h.isDepthTexture===!0)d=`texture_depth${f}_2d`;else if(h.isVideoTexture===!0)d="texture_external";else if(h.isData3DTexture===!0)d="texture_3d<f32>";else if(l.node.isStorageTextureNode===!0){const _=NS(h),g=this.getStorageAccess(l.node,e);d=`texture_storage_2d<${_}, ${g}>`}else{const _=this.getComponentTypeFromTexture(h).charAt(0);d=`texture${f}_2d<${_}32>`}i.push(`@binding( ${c.binding++} ) @group( ${c.group} ) var ${l.name} : ${d};`)}else if(l.type==="buffer"||l.type==="storageBuffer"||l.type==="indirectStorageBuffer"){const h=l.node,d=this.getType(h.bufferType),f=h.bufferCount,m=f>0&&l.type==="buffer"?", "+f:"",_=h.isAtomic?`atomic<${d}>`:`${d}`,g=`	${l.name} : array< ${_}${m} >
`,p=h.isStorageBufferNode?`storage, ${this.getStorageAccess(h,e)}`:"uniform";r.push(this._getWGSLStructBinding("NodeBuffer_"+h.id,g,p,c.binding++,c.group))}else{const h=this.getType(this.getVectorType(l.type)),d=l.groupNode.name;(o[d]||(o[d]={index:c.binding++,id:c.group,snippets:[]})).snippets.push(`	${l.name} : ${h}`)}}for(const l in o){const u=o[l];s.push(this._getWGSLStructBinding(l,u.snippets.join(`,
`),"uniform",u.index,u.id))}let a=i.join(`
`);return a+=r.join(`
`),a+=s.join(`
`),a}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){const i=e[t];i.uniforms=this.getUniforms(t),i.attributes=this.getAttributes(t),i.varyings=this.getVaryings(t),i.structs=this.getStructs(t),i.vars=this.getVars(t),i.codes=this.getCodes(t),i.directives=this.getDirectives(t),i.scopedArrays=this.getScopedArrays(t);let r=`// code

`;r+=this.flowCode[t];const s=this.flowNodes[t],o=s[s.length-1],a=o.outputNode,l=a!==void 0&&a.isOutputStructNode===!0;for(const u of s){const c=this.getFlowData(u),h=u.name;if(h&&(r.length>0&&(r+=`
`),r+=`	// flow -> ${h}
	`),r+=`${c.code}
	`,u===o&&t!=="compute"){if(r+=`// result

	`,t==="vertex")r+=`varyings.Vertex = ${c.result};`;else if(t==="fragment")if(l)i.returnType=a.nodeType,r+=`return ${c.result};`;else{let d="	@location(0) color: vec4<f32>";const f=this.getBuiltins("output");f&&(d+=`,
	`+f),i.returnType="OutputStruct",i.structs+=this._getWGSLStruct("OutputStruct",d),i.structs+=`
var<private> output : OutputStruct;

`,r+=`output.color = ${c.result};

	return output;`}}}i.flow=r}this.material!==null?(this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment)):this.computeShader=this._getWGSLComputeCode(e.compute,(this.object.workgroupSize||[64]).join(", "))}getMethod(e,t=null){let i;return t!==null&&(i=this._getWGSLMethod(e+"_"+t)),i===void 0&&(i=this._getWGSLMethod(e)),i||e}getType(e){return Nj[e]||e}isAvailable(e){let t=aP[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),aP[e]=t),t}_getWGSLMethod(e){return xr[e]!==void 0&&this._include(e),Nd[e]}_include(e){const t=xr[e];return t.build(this),this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${uP}

// uniforms
${e.uniforms}

// structs
${e.structs}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${t} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = id.x + id.y * numWorkgroups.x * u32(${t}) + id.z * numWorkgroups.x * numWorkgroups.y * u32(${t});

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,i,r=0,s=0){const o=e+"Struct";return`${this._getWGSLStruct(o,t)}
@binding( ${r} ) @group( ${s} )
var<${i}> ${e} : ${o};`}}class Dj{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=U.Depth24PlusStencil8:e.depth&&(t=U.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const s=this.backend.renderer,o=s.getRenderTarget();t=o?o.samples:s.samples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const i=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:i?1:t,isMSAA:i}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return nc.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return nc.LineList;if(e.isLine)return nc.LineStrip;if(e.isMesh)return nc.TriangleList}getSampleCount(e){let t=1;return e>1&&(t=Math.pow(2,Math.floor(Math.log2(e))),t===2&&(t=4)),t}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.samples)}getPreferredCanvasFormat(){return navigator.userAgent.includes("Quest")?U.BGRA8Unorm:navigator.gpu.getPreferredCanvasFormat()}}const Lj=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),Ij=new Map([[hE,["float16"]]]),Uj=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class Fj{constructor(e){this.backend=e}createAttribute(e,t){const i=this._getBufferAttribute(e),r=this.backend,s=r.get(i);let o=s.buffer;if(o===void 0){const a=r.device;let l=i.array;if(e.normalized===!1&&(l.constructor===Int16Array||l.constructor===Uint16Array)){const c=new Uint32Array(l.length);for(let h=0;h<l.length;h++)c[h]=l[h];l=c}if(i.array=l,(i.isStorageBufferAttribute||i.isStorageInstancedBufferAttribute)&&i.itemSize===3){l=new l.constructor(i.count*4);for(let c=0;c<i.count;c++)l.set(i.array.subarray(c*3,c*3+3),c*4);i.itemSize=4,i.array=l}const u=l.byteLength+(4-l.byteLength%4)%4;o=a.createBuffer({label:i.name,size:u,usage:t,mappedAtCreation:!0}),new l.constructor(o.getMappedRange()).set(l),o.unmap(),s.buffer=o}}updateAttribute(e){const t=this._getBufferAttribute(e),i=this.backend,r=i.device,s=i.get(t).buffer,o=t.array,a=this._isTypedArray(o),l=t.updateRanges;if(l.length===0)r.queue.writeBuffer(s,0,o,0);else{const u=a?1:o.BYTES_PER_ELEMENT;for(let c=0,h=l.length;c<h;c++){const d=l[c],f=d.start*u,m=d.count*u;r.queue.writeBuffer(s,0,o,f,m)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),i=new Map;for(let r=0;r<t.length;r++){const s=t[r],o=s.array.BYTES_PER_ELEMENT,a=this._getBufferAttribute(s);let l=i.get(a);if(l===void 0){let h,d;s.isInterleavedBufferAttribute===!0?(h=s.data.stride*o,d=s.data.isInstancedInterleavedBuffer?ag.Instance:ag.Vertex):(h=s.itemSize*o,d=s.isInstancedBufferAttribute?ag.Instance:ag.Vertex),s.normalized===!1&&(s.array.constructor===Int16Array||s.array.constructor===Uint16Array)&&(h=4),l={arrayStride:h,attributes:[],stepMode:d},i.set(a,l)}const u=this._getVertexFormat(s),c=s.isInterleavedBufferAttribute===!0?s.offset*o:0;l.attributes.push({shaderLocation:r,offset:c,format:u})}return Array.from(i.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,i=t.device,s=t.get(this._getBufferAttribute(e)).buffer,o=s.size,a=i.createBuffer({label:`${e.name}_readback`,size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),l=i.createCommandEncoder({label:`readback_encoder_${e.name}`});l.copyBufferToBuffer(s,0,a,0,o);const u=l.finish();i.queue.submit([u]),await a.mapAsync(GPUMapMode.READ);const c=a.getMappedRange(),h=new e.array.constructor(c.slice(0));return a.unmap(),h.buffer}_getVertexFormat(e){const{itemSize:t,normalized:i}=e,r=e.array.constructor,s=e.constructor;let o;if(t===1)o=Uj.get(r);else{const l=(Ij.get(s)||Lj.get(r))[i?1:0];if(l){const u=r.BYTES_PER_ELEMENT*t,h=Math.floor((u+3)/4)*4/r.BYTES_PER_ELEMENT;if(h%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");o=`${l}x${h}`}}return o||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),o}_isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class Oj{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){const t=this.backend,i=t.device,r=[];let s=0;for(const o of e.bindings){const a={binding:s++,visibility:o.visibility};if(o.isUniformBuffer||o.isStorageBuffer){const l={};o.isStorageBuffer&&(o.visibility&4&&(o.access===js.READ_WRITE||o.access===js.WRITE_ONLY)?l.type=AS.Storage:l.type=AS.ReadOnlyStorage),a.buffer=l}else if(o.isSampler){const l={};o.texture.isDepthTexture&&o.texture.compareFunction!==null&&(l.type="comparison"),a.sampler=l}else if(o.isSampledTexture&&o.texture.isVideoTexture)a.externalTexture={};else if(o.isSampledTexture&&o.store){const l={};l.format=this.backend.get(o.texture).texture.format;const u=o.access;u===js.READ_WRITE?l.access=CS.ReadWrite:u===js.WRITE_ONLY?l.access=CS.WriteOnly:l.access=CS.ReadOnly,a.storageTexture=l}else if(o.isSampledTexture){const l={},{primarySamples:u}=t.utils.getTextureSampleData(o.texture);if(u>1&&(l.multisampled=!0,o.texture.isDepthTexture||(l.sampleType=rc.UnfilterableFloat)),o.texture.isDepthTexture)l.sampleType=rc.Depth;else if(o.texture.isDataTexture||o.texture.isDataArrayTexture||o.texture.isData3DTexture){const c=o.texture.type;c===Un?l.sampleType=rc.SInt:c===en?l.sampleType=rc.UInt:c===cn&&(this.backend.hasFeature("float32-filterable")?l.sampleType=rc.Float:l.sampleType=rc.UnfilterableFloat)}o.isSampledCubeTexture?l.viewDimension=Oi.Cube:o.texture.isDataArrayTexture||o.texture.isCompressedArrayTexture?l.viewDimension=Oi.TwoDArray:o.isSampledTexture3D&&(l.viewDimension=Oi.ThreeD),a.texture=l}else console.error(`WebGPUBindingUtils: Unsupported binding "${o}".`);r.push(a)}return i.createBindGroupLayout({entries:r})}createBindings(e,t,i,r=0){const{backend:s,bindGroupLayoutCache:o}=this,a=s.get(e);let l=o.get(e.bindingsReference);l===void 0&&(l=this.createBindingsLayout(e),o.set(e.bindingsReference,l));let u;i>0&&(a.groups===void 0&&(a.groups=[],a.versions=[]),a.versions[i]===r&&(u=a.groups[i])),u===void 0&&(u=this.createBindGroup(e,l),i>0&&(a.groups[i]=u,a.versions[i]=r)),a.group=u,a.layout=l}updateBinding(e){const t=this.backend,i=t.device,r=e.buffer,s=t.get(e).buffer;i.queue.writeBuffer(s,0,r,0)}createBindGroup(e,t){const i=this.backend,r=i.device;let s=0;const o=[];for(const a of e.bindings){if(a.isUniformBuffer){const l=i.get(a);if(l.buffer===void 0){const u=a.byteLength,c=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,h=r.createBuffer({label:"bindingBuffer_"+a.name,size:u,usage:c});l.buffer=h}o.push({binding:s,resource:{buffer:l.buffer}})}else if(a.isStorageBuffer){const l=i.get(a);if(l.buffer===void 0){const u=a.attribute;l.buffer=i.get(u).buffer}o.push({binding:s,resource:{buffer:l.buffer}})}else if(a.isSampler){const l=i.get(a.texture);o.push({binding:s,resource:l.sampler})}else if(a.isSampledTexture){const l=i.get(a.texture);let u;if(l.externalTexture!==void 0)u=r.importExternalTexture({source:l.externalTexture});else{const c=a.store?1:l.texture.mipLevelCount,h=`view-${l.texture.width}-${l.texture.height}-${c}`;if(u=l[h],u===void 0){const d=fj.All;let f;a.isSampledCubeTexture?f=Oi.Cube:a.isSampledTexture3D?f=Oi.ThreeD:a.texture.isDataArrayTexture||a.texture.isCompressedArrayTexture?f=Oi.TwoDArray:f=Oi.TwoD,u=l[h]=l.texture.createView({aspect:d,dimension:f,mipLevelCount:c})}}o.push({binding:s,resource:u})}s++}return r.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:o})}}class Bj{constructor(e){this.backend=e}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:i,material:r,geometry:s,pipeline:o}=e,{vertexProgram:a,fragmentProgram:l}=o,u=this.backend,c=u.device,h=u.utils,d=u.get(o),f=[];for(const B of e.getBindings()){const D=u.get(B);f.push(D.layout)}const m=u.attributeUtils.createShaderVertexBuffers(e);let _;r.transparent===!0&&r.blending!==Ei&&(_=this._getBlending(r));let g={};r.stencilWrite===!0&&(g={compare:this._getStencilCompare(r),failOp:this._getStencilOperation(r.stencilFail),depthFailOp:this._getStencilOperation(r.stencilZFail),passOp:this._getStencilOperation(r.stencilZPass)});const p=this._getColorWriteMask(r),v=[];if(e.context.textures!==null){const B=e.context.textures;for(let D=0;D<B.length;D++){const L=h.getTextureFormatGPU(B[D]);v.push({format:L,blend:_,writeMask:p})}}else{const B=h.getCurrentColorFormat(e.context);v.push({format:B,blend:_,writeMask:p})}const y=u.get(a).module,x=u.get(l).module,T=this._getPrimitiveState(i,s,r),S=this._getDepthCompare(r),w=h.getCurrentDepthStencilFormat(e.context),E=this._getSampleCount(e.context),M={label:`renderPipeline_${r.name||r.type}_${r.id}`,vertex:Object.assign({},y,{buffers:m}),fragment:Object.assign({},x,{targets:v}),primitive:T,multisample:{count:E,alphaToCoverageEnabled:r.alphaToCoverage&&E>1},layout:c.createPipelineLayout({bindGroupLayouts:f})},b={},R=e.context.depth,I=e.context.stencil;if((R===!0||I===!0)&&(R===!0&&(b.format=w,b.depthWriteEnabled=r.depthWrite,b.depthCompare=S),I===!0&&(b.stencilFront=g,b.stencilBack={},b.stencilReadMask=r.stencilFuncMask,b.stencilWriteMask=r.stencilWriteMask),M.depthStencil=b),t===null)d.pipeline=c.createRenderPipeline(M);else{const B=new Promise(D=>{c.createRenderPipelineAsync(M).then(L=>{d.pipeline=L,D()})});t.push(B)}}createBundleEncoder(e){const t=this.backend,{utils:i,device:r}=t,s=i.getCurrentDepthStencilFormat(e),o=i.getCurrentColorFormat(e),a=this._getSampleCount(e),l={label:"renderBundleEncoder",colorFormats:[o],depthStencilFormat:s,sampleCount:a};return r.createRenderBundleEncoder(l)}createComputePipeline(e,t){const i=this.backend,r=i.device,s=i.get(e.computeProgram).module,o=i.get(e),a=[];for(const l of t){const u=i.get(l);a.push(u.layout)}o.pipeline=r.createComputePipeline({compute:s,layout:r.createPipelineLayout({bindGroupLayouts:a})})}_getBlending(e){let t,i;const r=e.blending,s=e.blendSrc,o=e.blendDst,a=e.blendEquation;if(r===Xv){const l=e.blendSrcAlpha!==null?e.blendSrcAlpha:s,u=e.blendDstAlpha!==null?e.blendDstAlpha:o,c=e.blendEquationAlpha!==null?e.blendEquationAlpha:a;t={srcFactor:this._getBlendFactor(s),dstFactor:this._getBlendFactor(o),operation:this._getBlendOperation(a)},i={srcFactor:this._getBlendFactor(l),dstFactor:this._getBlendFactor(u),operation:this._getBlendOperation(c)}}else{const l=e.premultipliedAlpha,u=(c,h,d,f)=>{t={srcFactor:c,dstFactor:h,operation:il.Add},i={srcFactor:d,dstFactor:f,operation:il.Add}};if(l)switch(r){case dr:u(qe.One,qe.OneMinusSrcAlpha,qe.One,qe.OneMinusSrcAlpha);break;case zl:u(qe.One,qe.One,qe.One,qe.One);break;case Gl:u(qe.Zero,qe.OneMinusSrc,qe.Zero,qe.One);break;case Vl:u(qe.Zero,qe.Src,qe.Zero,qe.SrcAlpha);break}else switch(r){case dr:u(qe.SrcAlpha,qe.OneMinusSrcAlpha,qe.One,qe.OneMinusSrcAlpha);break;case zl:u(qe.SrcAlpha,qe.One,qe.SrcAlpha,qe.One);break;case Gl:u(qe.Zero,qe.OneMinusSrc,qe.Zero,qe.One);break;case Vl:u(qe.Zero,qe.Src,qe.Zero,qe.Src);break}}if(t!==void 0&&i!==void 0)return{color:t,alpha:i};console.error("THREE.WebGPURenderer: Invalid blending: ",r)}_getBlendFactor(e){let t;switch(e){case Kv:t=qe.Zero;break;case Qv:t=qe.One;break;case Zv:t=qe.Src;break;case Jv:t=qe.OneMinusSrc;break;case nh:t=qe.SrcAlpha;break;case ih:t=qe.OneMinusSrcAlpha;break;case ny:t=qe.Dst;break;case iy:t=qe.OneMinusDstColor;break;case ey:t=qe.DstAlpha;break;case ty:t=qe.OneMinusDstAlpha;break;case ry:t=qe.SrcAlphaSaturated;break;case UW:t=qe.Constant;break;case FW:t=qe.OneMinusConstant;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const i=e.stencilFunc;switch(i){case fI:t=Wn.Never;break;case dy:t=Wn.Always;break;case pI:t=Wn.Less;break;case gI:t=Wn.LessEqual;break;case mI:t=Wn.Equal;break;case yI:t=Wn.GreaterEqual;break;case _I:t=Wn.Greater;break;case vI:t=Wn.NotEqual;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",i)}return t}_getStencilOperation(e){let t;switch(e){case Na:t=na.Keep;break;case oI:t=na.Zero;break;case aI:t=na.Replace;break;case dI:t=na.Invert;break;case lI:t=na.IncrementClamp;break;case uI:t=na.DecrementClamp;break;case cI:t=na.IncrementWrap;break;case hI:t=na.DecrementWrap;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case qi:t=il.Add;break;case qv:t=il.Subtract;break;case Yv:t=il.ReverseSubtract;break;case FM:t=il.Min;break;case OM:t=il.Max;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,i){const r={},s=this.backend.utils;switch(r.topology=s.getPrimitiveTopology(e,i),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(r.stripIndexFormat=t.index.array instanceof Uint16Array?ic.Uint16:ic.Uint32),i.side){case Nr:r.frontFace=wS.CCW,r.cullMode=MS.Back;break;case $t:r.frontFace=wS.CCW,r.cullMode=MS.Front;break;case ui:r.frontFace=wS.CCW,r.cullMode=MS.None;break;default:console.error("THREE.WebGPUPipelineUtils: Unknown material.side value.",i.side);break}return r}_getColorWriteMask(e){return e.colorWrite===!0?iP.All:iP.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=Wn.Always;else{const i=e.depthFunc;switch(i){case rh:t=Wn.Never;break;case sh:t=Wn.Always;break;case oh:t=Wn.Less;break;case Ro:t=Wn.LessEqual;break;case ah:t=Wn.Equal;break;case lh:t=Wn.GreaterEqual;break;case uh:t=Wn.Greater;break;case ch:t=Wn.NotEqual;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",i)}}return t}}class kj extends QN{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.trackTimestamp=e.trackTimestamp===!0,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new Dj(this),this.attributeUtils=new Fj(this),this.bindingUtils=new Oj(this),this.pipelineUtils=new Bj(this),this.textureUtils=new Tj(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let i;if(t.device===void 0){const o={powerPreference:t.powerPreference},a=typeof navigator<"u"?await navigator.gpu.requestAdapter(o):null;if(a===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const l=Object.values(RS),u=[];for(const h of l)a.features.has(h)&&u.push(h);const c={requiredFeatures:u,requiredLimits:t.requiredLimits};i=await a.requestDevice(c)}else i=t.device;i.lost.then(o=>{const a={api:"WebGPU",message:o.message||"Unknown reason",reason:o.reason||null,originalEvent:o};e.onDeviceLost(a)});const r=t.context!==void 0?t.context:e.domElement.getContext("webgpu");this.device=i,this.context=r;const s=t.alpha?"premultiplied":"opaque";this.trackTimestamp=this.trackTimestamp&&this.hasFeature(RS.TimestampQuery),this.context.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:s}),this.updateSize()}get coordinateSystem(){return Uo}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let e=this.defaultRenderPassdescriptor;if(e===null){const i=this.renderer;e={colorAttachments:[{view:null}]},(this.renderer.depth===!0||this.renderer.stencil===!0)&&(e.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(i.depth,i.stencil).createView()});const r=e.colorAttachments[0];this.renderer.samples>0?r.view=this.colorBuffer.createView():r.resolveTarget=void 0,this.defaultRenderPassdescriptor=e}const t=e.colorAttachments[0];return this.renderer.samples>0?t.resolveTarget=this.context.getCurrentTexture().createView():t.view=this.context.getCurrentTexture().createView(),e}_getRenderPassDescriptor(e,t={}){const i=e.renderTarget,r=this.get(i);let s=r.descriptors;if(s===void 0||r.width!==i.width||r.height!==i.height||r.dimensions!==i.dimensions||r.activeMipmapLevel!==i.activeMipmapLevel||r.activeCubeFace!==e.activeCubeFace||r.samples!==i.samples||r.loadOp!==t.loadOp){s={},r.descriptors=s;const l=()=>{i.removeEventListener("dispose",l),this.delete(i)};i.addEventListener("dispose",l)}const o=e.getCacheKey();let a=s[o];if(a===void 0){const l=e.textures,u=[];let c;for(let h=0;h<l.length;h++){const d=this.get(l[h]),f={label:`colorAttachment_${h}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:Oi.TwoD};i.isRenderTarget3D?(c=e.activeCubeFace,f.baseArrayLayer=0,f.dimension=Oi.ThreeD,f.depthOrArrayLayers=l[h].image.depth):i.isRenderTargetArray&&(f.dimension=Oi.TwoDArray,f.depthOrArrayLayers=l[h].image.depth);const m=d.texture.createView(f);let _,g;d.msaaTexture!==void 0?(_=d.msaaTexture.createView(),g=m):(_=m,g=void 0),u.push({view:_,depthSlice:c,resolveTarget:g,loadOp:fn.Load,storeOp:ii.Store,...t})}if(a={colorAttachments:u},e.depth){const d={view:this.get(e.depthTexture).texture.createView()};a.depthStencilAttachment=d}s[o]=a,r.width=i.width,r.height=i.height,r.samples=i.samples,r.activeMipmapLevel=e.activeMipmapLevel,r.activeCubeFace=e.activeCubeFace,r.dimensions=i.dimensions,r.depthSlice=c,r.loadOp=u[0].loadOp}return a}beginRender(e){const t=this.get(e),i=this.device,r=e.occlusionQueryCount;let s;r>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,s=i.createQuerySet({type:"occlusion",count:r,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=s,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(r),t.lastOcclusionObject=null);let o;e.textures===null?o=this._getDefaultRenderPassDescriptor():o=this._getRenderPassDescriptor(e,{loadOp:fn.Load}),this.initTimestampQuery(e,o),o.occlusionQuerySet=s;const a=o.depthStencilAttachment;if(e.textures!==null){const c=o.colorAttachments;for(let h=0;h<c.length;h++){const d=c[h];e.clearColor?(d.clearValue=h===0?e.clearColorValue:{r:0,g:0,b:0,a:1},d.loadOp=fn.Clear,d.storeOp=ii.Store):(d.loadOp=fn.Load,d.storeOp=ii.Store)}}else{const c=o.colorAttachments[0];e.clearColor?(c.clearValue=e.clearColorValue,c.loadOp=fn.Clear,c.storeOp=ii.Store):(c.loadOp=fn.Load,c.storeOp=ii.Store)}e.depth&&(e.clearDepth?(a.depthClearValue=e.clearDepthValue,a.depthLoadOp=fn.Clear,a.depthStoreOp=ii.Store):(a.depthLoadOp=fn.Load,a.depthStoreOp=ii.Store)),e.stencil&&(e.clearStencil?(a.stencilClearValue=e.clearStencilValue,a.stencilLoadOp=fn.Clear,a.stencilStoreOp=ii.Store):(a.stencilLoadOp=fn.Load,a.stencilStoreOp=ii.Store));const l=i.createCommandEncoder({label:"renderContext_"+e.id}),u=l.beginRenderPass(o);if(t.descriptor=o,t.encoder=l,t.currentPass=u,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[],e.viewport&&this.updateViewport(e),e.scissor){const{x:c,y:h,width:d,height:f}=e.scissorValue;u.setScissorRect(c,h,d,f)}}finishRender(e){const t=this.get(e),i=e.occlusionQueryCount;if(t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),i>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery(),t.currentPass.end(),i>0){const r=i*8;let s=this.occludedResolveCache.get(r);s===void 0&&(s=this.device.createBuffer({size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(r,s));const o=this.device.createBuffer({size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,i,s,0),t.encoder.copyBufferToBuffer(s,0,o,0,r),t.occlusionQueryBuffer=o,this.resolveOccludedAsync(e)}if(this.prepareTimestampBuffer(e,t.encoder),this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const r=e.textures;for(let s=0;s<r.length;s++){const o=r[s];o.generateMipmaps===!0&&this.textureUtils.generateMipmaps(o)}}}isOccluded(e,t){const i=this.get(e);return i.occluded&&i.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:i,currentOcclusionQueryObjects:r}=t;if(i&&r){const s=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await i.mapAsync(GPUMapMode.READ);const o=i.getMappedRange(),a=new BigUint64Array(o);for(let l=0;l<r.length;l++)a[l]!==BigInt(0)&&s.add(r[l]);i.destroy(),t.occluded=s}}updateViewport(e){const{currentPass:t}=this.get(e),{x:i,y:r,width:s,height:o,minDepth:a,maxDepth:l}=e.viewportValue;t.setViewport(i,r,s,o,a,l)}clear(e,t,i,r=null){const s=this.device,o=this.renderer;let a=[],l,u,c,h;if(e){const m=this.getClearColor();if(this.renderer.alpha===!0){const _=m.a;u={r:m.r*_,g:m.g*_,b:m.b*_,a:_}}else u={r:m.r,g:m.g,b:m.b,a:m.a}}if(r===null){c=o.depth,h=o.stencil;const m=this._getDefaultRenderPassDescriptor();if(e){a=m.colorAttachments;const _=a[0];_.clearValue=u,_.loadOp=fn.Clear,_.storeOp=ii.Store}(c||h)&&(l=m.depthStencilAttachment)}else c=r.depth,h=r.stencil,e&&(a=this._getRenderPassDescriptor(r,{loadOp:fn.Clear}).colorAttachments),(c||h)&&(l={view:this.get(r.depthTexture).texture.createView()});c&&(t?(l.depthLoadOp=fn.Clear,l.depthClearValue=o.getClearDepth(),l.depthStoreOp=ii.Store):(l.depthLoadOp=fn.Load,l.depthStoreOp=ii.Store)),h&&(i?(l.stencilLoadOp=fn.Clear,l.stencilClearValue=o.getClearStencil(),l.stencilStoreOp=ii.Store):(l.stencilLoadOp=fn.Load,l.stencilStoreOp=ii.Store));const d=s.createCommandEncoder({});d.beginRenderPass({colorAttachments:a,depthStencilAttachment:l}).end(),s.queue.submit([d.finish()])}beginCompute(e){const t=this.get(e),i={};this.initTimestampQuery(e,i),t.cmdEncoderGPU=this.device.createCommandEncoder(),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(i)}compute(e,t,i,r){const{passEncoderGPU:s}=this.get(e),o=this.get(r).pipeline;s.setPipeline(o);for(let c=0,h=i.length;c<h;c++){const d=i[c],f=this.get(d);s.setBindGroup(c,f.group)}const a=this.device.limits.maxComputeWorkgroupsPerDimension,l=this.get(t);l.dispatchSize===void 0&&(l.dispatchSize={x:0,y:1,z:1});const{dispatchSize:u}=l;t.dispatchCount>a?(u.x=Math.min(t.dispatchCount,a),u.y=Math.ceil(t.dispatchCount/a)):u.x=t.dispatchCount,s.dispatchWorkgroups(u.x,u.y,u.z)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.prepareTimestampBuffer(e,t.cmdEncoderGPU),this.device.queue.submit([t.cmdEncoderGPU.finish()])}async waitForGPU(){await this.device.queue.onSubmittedWorkDone()}draw(e,t){const{object:i,context:r,pipeline:s}=e,o=e.getBindings(),a=this.get(r),l=this.get(s).pipeline,u=a.currentSets,c=a.currentPass,h=e.getDrawParameters();if(h===null)return;u.pipeline!==l&&(c.setPipeline(l),u.pipeline=l);const d=u.bindingGroups;for(let g=0,p=o.length;g<p;g++){const v=o[g],y=this.get(v);d[v.index]!==v.id&&(c.setBindGroup(v.index,y.group),d[v.index]=v.id)}const f=e.getIndex(),m=f!==null;if(m===!0&&u.index!==f){const g=this.get(f).buffer,p=f.array instanceof Uint16Array?ic.Uint16:ic.Uint32;c.setIndexBuffer(g,p),u.index=f}const _=e.getVertexBuffers();for(let g=0,p=_.length;g<p;g++){const v=_[g];if(u.attributes[g]!==v){const y=this.get(v).buffer;c.setVertexBuffer(g,y),u.attributes[g]=v}}if(a.occlusionQuerySet!==void 0){const g=a.lastOcclusionObject;g!==i&&(g!==null&&g.occlusionTest===!0&&(c.endOcclusionQuery(),a.occlusionQueryIndex++),i.occlusionTest===!0&&(c.beginOcclusionQuery(a.occlusionQueryIndex),a.occlusionQueryObjects[a.occlusionQueryIndex]=i),a.lastOcclusionObject=i)}if(i.isBatchedMesh===!0){const g=i._multiDrawStarts,p=i._multiDrawCounts,v=i._multiDrawCount,y=i._multiDrawInstances;for(let x=0;x<v;x++){const T=y?y[x]:1,S=T>1?0:x;m===!0?c.drawIndexed(p[x],T,g[x]/f.array.BYTES_PER_ELEMENT,0,S):c.draw(p[x],T,g[x],S)}}else if(m===!0){const{vertexCount:g,instanceCount:p,firstVertex:v}=h,y=e.getIndirect();if(y!==null){const x=this.get(y).buffer;c.drawIndexedIndirect(x,0)}else c.drawIndexed(g,p,v,0,0);t.update(i,g,p)}else{const{vertexCount:g,instanceCount:p,firstVertex:v}=h,y=e.getIndirect();if(y!==null){const x=this.get(y).buffer;c.drawIndirect(x,0)}else c.draw(g,p,v,0);t.update(i,g,p)}}needsRenderUpdate(e){const t=this.get(e),{object:i,material:r}=e,s=this.utils,o=s.getSampleCountRenderContext(e.context),a=s.getCurrentColorSpace(e.context),l=s.getCurrentColorFormat(e.context),u=s.getCurrentDepthStencilFormat(e.context),c=s.getPrimitiveTopology(i,r);let h=!1;return(t.material!==r||t.materialVersion!==r.version||t.transparent!==r.transparent||t.blending!==r.blending||t.premultipliedAlpha!==r.premultipliedAlpha||t.blendSrc!==r.blendSrc||t.blendDst!==r.blendDst||t.blendEquation!==r.blendEquation||t.blendSrcAlpha!==r.blendSrcAlpha||t.blendDstAlpha!==r.blendDstAlpha||t.blendEquationAlpha!==r.blendEquationAlpha||t.colorWrite!==r.colorWrite||t.depthWrite!==r.depthWrite||t.depthTest!==r.depthTest||t.depthFunc!==r.depthFunc||t.stencilWrite!==r.stencilWrite||t.stencilFunc!==r.stencilFunc||t.stencilFail!==r.stencilFail||t.stencilZFail!==r.stencilZFail||t.stencilZPass!==r.stencilZPass||t.stencilFuncMask!==r.stencilFuncMask||t.stencilWriteMask!==r.stencilWriteMask||t.side!==r.side||t.alphaToCoverage!==r.alphaToCoverage||t.sampleCount!==o||t.colorSpace!==a||t.colorFormat!==l||t.depthStencilFormat!==u||t.primitiveTopology!==c||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=r,t.materialVersion=r.version,t.transparent=r.transparent,t.blending=r.blending,t.premultipliedAlpha=r.premultipliedAlpha,t.blendSrc=r.blendSrc,t.blendDst=r.blendDst,t.blendEquation=r.blendEquation,t.blendSrcAlpha=r.blendSrcAlpha,t.blendDstAlpha=r.blendDstAlpha,t.blendEquationAlpha=r.blendEquationAlpha,t.colorWrite=r.colorWrite,t.depthWrite=r.depthWrite,t.depthTest=r.depthTest,t.depthFunc=r.depthFunc,t.stencilWrite=r.stencilWrite,t.stencilFunc=r.stencilFunc,t.stencilFail=r.stencilFail,t.stencilZFail=r.stencilZFail,t.stencilZPass=r.stencilZPass,t.stencilFuncMask=r.stencilFuncMask,t.stencilWriteMask=r.stencilWriteMask,t.side=r.side,t.alphaToCoverage=r.alphaToCoverage,t.sampleCount=o,t.colorSpace=a,t.colorFormat=l,t.depthStencilFormat=u,t.primitiveTopology=c,t.clippingContextCacheKey=e.clippingContextCacheKey,h=!0),h}getRenderCacheKey(e){const{object:t,material:i}=e,r=this.utils,s=e.context;return[i.transparent,i.blending,i.premultipliedAlpha,i.blendSrc,i.blendDst,i.blendEquation,i.blendSrcAlpha,i.blendDstAlpha,i.blendEquationAlpha,i.colorWrite,i.depthWrite,i.depthTest,i.depthFunc,i.stencilWrite,i.stencilFunc,i.stencilFail,i.stencilZFail,i.stencilZPass,i.stencilFuncMask,i.stencilWriteMask,i.side,r.getSampleCountRenderContext(s),r.getCurrentColorSpace(s),r.getCurrentColorFormat(s),r.getCurrentDepthStencilFormat(s),r.getPrimitiveTopology(t,i),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}createSampler(e){this.textureUtils.createSampler(e)}destroySampler(e){this.textureUtils.destroySampler(e)}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}copyTextureToBuffer(e,t,i,r,s,o){return this.textureUtils.copyTextureToBuffer(e,t,i,r,s,o)}initTimestampQuery(e,t){if(!this.trackTimestamp)return;const i=this.get(e);if(!i.timeStampQuerySet){const r=e.isComputeNode?"compute":"render",s=this.device.createQuerySet({type:"timestamp",count:2,label:`timestamp_${r}_${e.id}`});Object.assign(t,{timestampWrites:{querySet:s,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1}}),i.timeStampQuerySet=s}}prepareTimestampBuffer(e,t){if(!this.trackTimestamp)return;const i=this.get(e),r=2*BigInt64Array.BYTES_PER_ELEMENT;i.currentTimestampQueryBuffers===void 0&&(i.currentTimestampQueryBuffers={resolveBuffer:this.device.createBuffer({label:"timestamp resolve buffer",size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),resultBuffer:this.device.createBuffer({label:"timestamp result buffer",size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})});const{resolveBuffer:s,resultBuffer:o}=i.currentTimestampQueryBuffers;t.resolveQuerySet(i.timeStampQuerySet,0,2,s,0),o.mapState==="unmapped"&&t.copyBufferToBuffer(s,0,o,0,r)}async resolveTimestampAsync(e,t="render"){if(!this.trackTimestamp)return;const i=this.get(e);if(i.currentTimestampQueryBuffers===void 0)return;const{resultBuffer:r}=i.currentTimestampQueryBuffers;r.mapState==="unmapped"&&r.mapAsync(GPUMapMode.READ).then(()=>{const s=new BigUint64Array(r.getMappedRange()),o=Number(s[1]-s[0])/1e6;this.renderer.info.updateTimestamp(t,o),r.unmap()})}createNodeBuilder(e,t){return new Pj(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const i=this.get(e),s=i.currentPass.finish();this.get(t).bundleGPU=s,i.currentSets=i._currentSets,i.currentPass=i._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,i,r){this.bindingUtils.createBindings(e,t,i,r)}updateBindings(e,t,i,r){this.bindingUtils.createBindings(e,t,i,r)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(e){return this.device.features.has(e)}copyTextureToTexture(e,t,i=null,r=null,s=0){let o=0,a=0,l=0,u=0,c=0,h=0,d=e.image.width,f=e.image.height;i!==null&&(u=i.x,c=i.y,h=i.z||0,d=i.width,f=i.height),r!==null&&(o=r.x,a=r.y,l=r.z||0);const m=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),_=this.get(e).texture,g=this.get(t).texture;m.copyTextureToTexture({texture:_,mipLevel:s,origin:{x:u,y:c,z:h}},{texture:g,mipLevel:s,origin:{x:o,y:a,z:l}},[d,f,1]),this.device.queue.submit([m.finish()])}copyFramebufferToTexture(e,t,i){const r=this.get(t);let s=null;t.renderTarget?e.isDepthTexture?s=this.get(t.depthTexture).texture:s=this.get(t.textures[0]).texture:e.isDepthTexture?s=this.textureUtils.getDepthBuffer(t.depth,t.stencil):s=this.context.getCurrentTexture();const o=this.get(e).texture;if(s.format!==o.format){console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",s.format,o.format);return}let a;if(r.currentPass?(r.currentPass.end(),a=r.encoder):a=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),a.copyTextureToTexture({texture:s,origin:[i.x,i.y,0]},{texture:o},[i.z,i.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e),r.currentPass){const{descriptor:l}=r;for(let u=0;u<l.colorAttachments.length;u++)l.colorAttachments[u].loadOp=fn.Load;if(t.depth&&(l.depthStencilAttachment.depthLoadOp=fn.Load),t.stencil&&(l.depthStencilAttachment.stencilLoadOp=fn.Load),r.currentPass=a.beginRenderPass(l),r.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor){const{x:u,y:c,width:h,height:d}=t.scissorValue;r.currentPass.setScissorRect(u,c,h,d)}}else this.device.queue.submit([a.finish()])}}class zj extends UE{constructor(e,t,i,r,s,o){super(e,t,i,r,s,o),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class Gj extends GN{constructor(){super(),this.addMaterial(E8,"MeshPhongMaterial"),this.addMaterial(sN,"MeshStandardMaterial"),this.addMaterial(dW,"MeshPhysicalMaterial"),this.addMaterial(gW,"MeshToonMaterial"),this.addMaterial(y8,"MeshBasicMaterial"),this.addMaterial(w8,"MeshLambertMaterial"),this.addMaterial(f8,"MeshNormalMaterial"),this.addMaterial(xW,"MeshMatcapMaterial"),this.addMaterial(l8,"LineBasicMaterial"),this.addMaterial(c8,"LineDashedMaterial"),this.addMaterial(TW,"PointsMaterial"),this.addMaterial(EW,"SpriteMaterial"),this.addMaterial(RW,"ShadowMaterial"),this.addLight(e9,WU),this.addLight(N9,OE),this.addLight(P9,jU),this.addLight(ON,UE),this.addLight(L9,BE),this.addLight(I9,GU),this.addLight(U9,qU),this.addLight(D9,zj),this.addToneMapping(u$,zM),this.addToneMapping(c$,GM),this.addToneMapping(h$,VM),this.addToneMapping(f$,HM),this.addToneMapping(_$,WM),this.addToneMapping(v$,$M)}}class Vj extends j9{constructor(e={}){let t;e.forceWebGL?t=nP:(t=kj,e.getFallback=()=>(console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new nP(e)));const i=new t(e);super(i,e),this.library=new Gj,this.isWebGPURenderer=!0}}const PS={type:"change"},DS={type:"start"},LS={type:"end"},cP=1e-6,Mt={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},ug=new ce,ia=new ce,Hj=new N,cg=new N,IS=new N,oc=new Dr,hP=new N,hg=new N,US=new N,dg=new N;class Wj extends $p{constructor(e,t=null){super(e,t),this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:In.ROTATE,MIDDLE:In.DOLLY,RIGHT:In.PAN},this.state=Mt.NONE,this.keyState=Mt.NONE,this.target=new N,this._lastPosition=new N,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new N,this._movePrev=new ce,this._moveCurr=new ce,this._lastAxis=new N,this._zoomStart=new ce,this._zoomEnd=new ce,this._panStart=new ce,this._panEnd=new ce,this._pointers=[],this._pointerPositions={},this._onPointerMove=jj.bind(this),this._onPointerDown=$j.bind(this),this._onPointerUp=Xj.bind(this),this._onPointerCancel=qj.bind(this),this._onContextMenu=t7.bind(this),this._onMouseWheel=e7.bind(this),this._onKeyDown=Kj.bind(this),this._onKeyUp=Yj.bind(this),this._onTouchStart=n7.bind(this),this._onTouchMove=i7.bind(this),this._onTouchEnd=r7.bind(this),this._onMouseDown=Qj.bind(this),this._onMouseMove=Zj.bind(this),this._onMouseUp=Jj.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,t!==null&&(this.connect(),this.handleResize()),this.update()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>cP&&(this.dispatchEvent(PS),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>cP||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(PS),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=Mt.NONE,this.keyState=Mt.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(PS),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(ia.copy(this._panEnd).sub(this._panStart),ia.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,t=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;ia.x*=e,ia.y*=t}ia.multiplyScalar(this._eye.length()*this.panSpeed),cg.copy(this._eye).cross(this.object.up).setLength(ia.x),cg.add(Hj.copy(this.object.up).setLength(ia.y)),this.object.position.add(cg),this.target.add(cg),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(ia.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){dg.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=dg.length();e?(this._eye.copy(this.object.position).sub(this.target),hP.copy(this._eye).normalize(),hg.copy(this.object.up).normalize(),US.crossVectors(hg,hP).normalize(),hg.setLength(this._moveCurr.y-this._movePrev.y),US.setLength(this._moveCurr.x-this._movePrev.x),dg.copy(hg.add(US)),IS.crossVectors(dg,this._eye).normalize(),e*=this.rotateSpeed,oc.setFromAxisAngle(IS,e),this._eye.applyQuaternion(oc),this.object.up.applyQuaternion(oc),this._lastAxis.copy(IS),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),oc.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(oc),this.object.up.applyQuaternion(oc)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===Mt.TOUCH_ZOOM_PAN?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=hp.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,e!==1&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=hp.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,t){return ug.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),ug}_getMouseOnCircle(e,t){return ug.set((e-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-t))/this.screen.width),ug}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId==e.pointerId){this._pointers.splice(t,1);return}}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new ce,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[t.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function $j(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n))}function jj(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function Xj(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchEnd(n):this._onMouseUp(),this._removePointer(n),this._pointers.length===0&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function qj(n){this._removePointer(n)}function Yj(){this.enabled!==!1&&(this.keyState=Mt.NONE,window.addEventListener("keydown",this._onKeyDown))}function Kj(n){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===Mt.NONE&&(n.code===this.keys[Mt.ROTATE]&&!this.noRotate?this.keyState=Mt.ROTATE:n.code===this.keys[Mt.ZOOM]&&!this.noZoom?this.keyState=Mt.ZOOM:n.code===this.keys[Mt.PAN]&&!this.noPan&&(this.keyState=Mt.PAN)))}function Qj(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case In.DOLLY:this.state=Mt.ZOOM;break;case In.ROTATE:this.state=Mt.ROTATE;break;case In.PAN:this.state=Mt.PAN;break;default:this.state=Mt.NONE}const t=this.keyState!==Mt.NONE?this.keyState:this.state;t===Mt.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr)):t===Mt.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(n.pageX,n.pageY)),this._zoomEnd.copy(this._zoomStart)):t===Mt.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(n.pageX,n.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(DS)}function Zj(n){const e=this.keyState!==Mt.NONE?this.keyState:this.state;e===Mt.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY))):e===Mt.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(n.pageX,n.pageY)):e===Mt.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(n.pageX,n.pageY))}function Jj(){this.state=Mt.NONE,this.dispatchEvent(LS)}function e7(n){if(this.enabled!==!1&&this.noZoom!==!0){switch(n.preventDefault(),n.deltaMode){case 2:this._zoomStart.y-=n.deltaY*.025;break;case 1:this._zoomStart.y-=n.deltaY*.01;break;default:this._zoomStart.y-=n.deltaY*25e-5;break}this.dispatchEvent(DS),this.dispatchEvent(LS)}}function t7(n){this.enabled!==!1&&n.preventDefault()}function n7(n){switch(this._trackPointer(n),this._pointers.length){case 1:this.state=Mt.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this.state=Mt.TOUCH_ZOOM_PAN;const e=this._pointers[0].pageX-this._pointers[1].pageX,t=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+t*t);const i=(this._pointers[0].pageX+this._pointers[1].pageX)/2,r=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(i,r)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(DS)}function i7(n){switch(this._trackPointer(n),this._pointers.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY));break;default:const e=this._getSecondPointerPosition(n),t=n.pageX-e.x,i=n.pageY-e.y;this._touchZoomDistanceEnd=Math.sqrt(t*t+i*i);const r=(n.pageX+e.x)/2,s=(n.pageY+e.y)/2;this._panEnd.copy(this._getMouseOnScreen(r,s));break}}function r7(n){switch(this._pointers.length){case 0:this.state=Mt.NONE;break;case 1:this.state=Mt.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=Mt.TOUCH_ZOOM_PAN;for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId!==n.pointerId){const t=this._pointerPositions[this._pointers[e].pointerId];this._moveCurr.copy(this._getMouseOnCircle(t.x,t.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent(LS)}const dP={type:"change"},FS={type:"start"},fP={type:"end"},fg=new vp,pP=new Fr,s7=Math.cos(70*hp.DEG2RAD),Pn=new N,Bi=2*Math.PI,It={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},OS=1e-6;class o7 extends $p{constructor(e,t=null){super(e,t),this.state=It.NONE,this.enabled=!0,this.target=new N,this.cursor=new N,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:In.ROTATE,MIDDLE:In.DOLLY,RIGHT:In.PAN},this.touches={ONE:Cs.ROTATE,TWO:Cs.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new N,this._lastQuaternion=new Dr,this._lastTargetPosition=new N,this._quat=new Dr().setFromUnitVectors(e.up,new N(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new a0,this._sphericalDelta=new a0,this._scale=1,this._panOffset=new N,this._rotateStart=new ce,this._rotateEnd=new ce,this._rotateDelta=new ce,this._panStart=new ce,this._panEnd=new ce,this._panDelta=new ce,this._dollyStart=new ce,this._dollyEnd=new ce,this._dollyDelta=new ce,this._dollyDirection=new N,this._mouse=new ce,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=l7.bind(this),this._onPointerDown=a7.bind(this),this._onPointerUp=u7.bind(this),this._onContextMenu=g7.bind(this),this._onMouseWheel=d7.bind(this),this._onKeyDown=f7.bind(this),this._onTouchStart=p7.bind(this),this._onTouchMove=m7.bind(this),this._onMouseDown=c7.bind(this),this._onMouseMove=h7.bind(this),this._interceptControlDown=_7.bind(this),this._interceptControlUp=v7.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(dP),this.update(),this.state=It.NONE}update(e=null){const t=this.object.position;Pn.copy(t).sub(this.target),Pn.applyQuaternion(this._quat),this._spherical.setFromVector3(Pn),this.autoRotate&&this.state===It.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let i=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(i)&&isFinite(r)&&(i<-Math.PI?i+=Bi:i>Math.PI&&(i-=Bi),r<-Math.PI?r+=Bi:r>Math.PI&&(r-=Bi),i<=r?this._spherical.theta=Math.max(i,Math.min(r,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(i+r)/2?Math.max(i,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=o!=this._spherical.radius}if(Pn.setFromSpherical(this._spherical),Pn.applyQuaternion(this._quatInverse),t.copy(this.target).add(Pn),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const a=Pn.length();o=this._clampDistance(a*this._scale);const l=a-o;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),s=!!l}else if(this.object.isOrthographicCamera){const a=new N(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=l!==this.object.zoom;const u=new N(this._mouse.x,this._mouse.y,0);u.unproject(this.object),this.object.position.sub(u).add(a),this.object.updateMatrixWorld(),o=Pn.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(fg.origin.copy(this.object.position),fg.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(fg.direction))<s7?this.object.lookAt(this.target):(pP.setFromNormalAndCoplanarPoint(this.object.up,this.target),fg.intersectPlane(pP,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,s||this._lastPosition.distanceToSquared(this.object.position)>OS||8*(1-this._lastQuaternion.dot(this.object.quaternion))>OS||this._lastTargetPosition.distanceToSquared(this.target)>OS?(this.dispatchEvent(dP),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Bi/60*this.autoRotateSpeed*e:Bi/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){Pn.setFromMatrixColumn(t,0),Pn.multiplyScalar(-e),this._panOffset.add(Pn)}_panUp(e,t){this.screenSpacePanning===!0?Pn.setFromMatrixColumn(t,1):(Pn.setFromMatrixColumn(t,0),Pn.crossVectors(this.object.up,Pn)),Pn.multiplyScalar(e),this._panOffset.add(Pn)}_pan(e,t){const i=this.domElement;if(this.object.isPerspectiveCamera){const r=this.object.position;Pn.copy(r).sub(this.target);let s=Pn.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*s/i.clientHeight,this.object.matrix),this._panUp(2*t*s/i.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const i=this.domElement.getBoundingClientRect(),r=e-i.left,s=t-i.top,o=i.width,a=i.height;this._mouse.x=r/o*2-1,this._mouse.y=-(s/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Bi*this._rotateDelta.x/t.clientHeight),this._rotateUp(Bi*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(Bi*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-Bi*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(Bi*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-Bi*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._rotateStart.set(i,r)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panStart.set(i,r)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(i*i+r*r);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),r=.5*(e.pageX+i.x),s=.5*(e.pageY+i.y);this._rotateEnd.set(r,s)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Bi*this._rotateDelta.x/t.clientHeight),this._rotateUp(Bi*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panEnd.set(i,r)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(i*i+r*r);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(e.pageX+t.x)*.5,a=(e.pageY+t.y)*.5;this._updateZoomParameters(o,a)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new ce,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,i={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(i.deltaY*=10),i}}function a7(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(n)&&(this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n)))}function l7(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function u7(n){switch(this._removePointer(n),this._pointers.length){case 0:this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(fP),this.state=It.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function c7(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case In.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(n),this.state=It.DOLLY;break;case In.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=It.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=It.ROTATE}break;case In.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=It.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=It.PAN}break;default:this.state=It.NONE}this.state!==It.NONE&&this.dispatchEvent(FS)}function h7(n){switch(this.state){case It.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(n);break;case It.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(n);break;case It.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(n);break}}function d7(n){this.enabled===!1||this.enableZoom===!1||this.state!==It.NONE||(n.preventDefault(),this.dispatchEvent(FS),this._handleMouseWheel(this._customWheelEvent(n)),this.dispatchEvent(fP))}function f7(n){this.enabled!==!1&&this._handleKeyDown(n)}function p7(n){switch(this._trackPointer(n),this._pointers.length){case 1:switch(this.touches.ONE){case Cs.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(n),this.state=It.TOUCH_ROTATE;break;case Cs.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(n),this.state=It.TOUCH_PAN;break;default:this.state=It.NONE}break;case 2:switch(this.touches.TWO){case Cs.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(n),this.state=It.TOUCH_DOLLY_PAN;break;case Cs.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(n),this.state=It.TOUCH_DOLLY_ROTATE;break;default:this.state=It.NONE}break;default:this.state=It.NONE}this.state!==It.NONE&&this.dispatchEvent(FS)}function m7(n){switch(this._trackPointer(n),this.state){case It.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(n),this.update();break;case It.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(n),this.update();break;case It.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(n),this.update();break;case It.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(n),this.update();break;default:this.state=It.NONE}}function g7(n){this.enabled!==!1&&n.preventDefault()}function _7(n){n.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function v7(n){n.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const y7={type:"change"},mP=1e-6,gP=new Dr;class x7 extends $p{constructor(e,t=null){super(e,t),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new N(0,0,0),this._rotationVector=new N(0,0,0),this._lastQuaternion=new Dr,this._lastPosition=new N,this._status=0,this._onKeyDown=S7.bind(this),this._onKeyUp=T7.bind(this),this._onPointerMove=w7.bind(this),this._onPointerDown=b7.bind(this),this._onPointerUp=M7.bind(this),this._onPointerCancel=E7.bind(this),this._onContextMenu=A7.bind(this),t!==null&&this.connect()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(this.enabled===!1)return;const t=this.object,i=e*this.movementSpeed,r=e*this.rollSpeed;t.translateX(this._moveVector.x*i),t.translateY(this._moveVector.y*i),t.translateZ(this._moveVector.z*i),gP.set(this._rotationVector.x*r,this._rotationVector.y*r,this._rotationVector.z*r,1).normalize(),t.quaternion.multiply(gP),(this._lastPosition.distanceToSquared(t.position)>mP||8*(1-this._lastQuaternion.dot(t.quaternion))>mP)&&(this.dispatchEvent(y7),this._lastQuaternion.copy(t.quaternion),this._lastPosition.copy(t.position))}_updateMovementVector(){const e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function S7(n){if(!(n.altKey||this.enabled===!1)){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1;break}this._updateMovementVector(),this._updateRotationVector()}}function T7(n){if(this.enabled!==!1){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0;break}this._updateMovementVector(),this._updateRotationVector()}}function b7(n){if(this.enabled!==!1)if(this.dragToLook)this._status++;else{switch(n.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1;break}this._updateMovementVector()}}function w7(n){if(this.enabled!==!1&&(!this.dragToLook||this._status>0)){const e=this._getContainerDimensions(),t=e.size[0]/2,i=e.size[1]/2;this._moveState.yawLeft=-(n.pageX-e.offset[0]-t)/t,this._moveState.pitchDown=(n.pageY-e.offset[1]-i)/i,this._updateRotationVector()}}function M7(n){if(this.enabled!==!1){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(n.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0;break}this._updateMovementVector()}this._updateRotationVector()}}function E7(){this.enabled!==!1&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function A7(n){this.enabled!==!1&&n.preventDefault()}const C7={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class pg{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const R7=new kh(-1,1,1,-1,0,1);class N7 extends ei{constructor(){super(),this.setAttribute("position",new dn([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new dn([0,2,0,0,2,0],2))}}const P7=new N7;class D7{constructor(e){this._mesh=new On(P7,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,R7)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class L7 extends pg{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof rs?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=gE.clone(e.uniforms),this.material=new rs({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new D7(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class _P extends pg{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const r=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let o,a;this.inverse?(o=0,a=1):(o=1,a=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),s.buffers.stencil.setFunc(r.ALWAYS,o,4294967295),s.buffers.stencil.setClear(a),s.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.color.setMask(!0),s.buffers.depth.setMask(!0),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(r.EQUAL,1,4294967295),s.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),s.buffers.stencil.setLocked(!0)}}class I7 extends pg{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class U7{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const i=e.getSize(new ce);this._width=i.width,this._height=i.height,t=new Fo(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:hi}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new L7(C7),this.copyPass.material.blending=Ei,this.clock=new kE}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let r=0,s=this.passes.length;r<s;r++){const o=this.passes[r];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),o.needsSwap){if(i){const a=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}_P!==void 0&&(o instanceof _P?i=!0:o instanceof I7&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new ce);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(i,r),this.renderTarget2.setSize(i,r);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(i,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class F7 extends pg{constructor(e,t,i=null,r=null,s=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=r,this.clearAlpha=s,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Ue}render(e,t,i){const r=e.autoClear;e.autoClear=!1;let s,o;this.overrideMaterial!==null&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(s=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(s),this.overrideMaterial!==null&&(this.scene.overrideMaterial=o),e.autoClear=r}}function ki(){return ki=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},ki.apply(null,arguments)}function O7(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Pd(n,e){return Pd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t},Pd(n,e)}function B7(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,Pd(n,e)}function BS(n){return BS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},BS(n)}function k7(n){try{return Function.toString.call(n).indexOf("[native code]")!==-1}catch{return typeof n=="function"}}function vP(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(vP=function(){return!!n})()}function z7(n,e,t){if(vP())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,e);var r=new(n.bind.apply(n,i));return t&&Pd(r,t.prototype),r}function kS(n){var e=typeof Map=="function"?new Map:void 0;return kS=function(i){if(i===null||!k7(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(i))return e.get(i);e.set(i,r)}function r(){return z7(i,arguments,BS(this).constructor)}return r.prototype=Object.create(i.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Pd(r,i)},kS(n)}var ps=function(n){B7(e,n);function e(t){var i;return i=n.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+t+" for more information.")||this,O7(i)}return e}(kS(Error));function zS(n){return Math.round(n*255)}function G7(n,e,t){return zS(n)+","+zS(e)+","+zS(t)}function mg(n,e,t,i){if(i===void 0&&(i=G7),e===0)return i(t,t,t);var r=(n%360+360)%360/60,s=(1-Math.abs(2*t-1))*e,o=s*(1-Math.abs(r%2-1)),a=0,l=0,u=0;r>=0&&r<1?(a=s,l=o):r>=1&&r<2?(a=o,l=s):r>=2&&r<3?(l=s,u=o):r>=3&&r<4?(l=o,u=s):r>=4&&r<5?(a=o,u=s):r>=5&&r<6&&(a=s,u=o);var c=t-s/2,h=a+c,d=l+c,f=u+c;return i(h,d,f)}var yP={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};function V7(n){if(typeof n!="string")return n;var e=n.toLowerCase();return yP[e]?"#"+yP[e]:n}var H7=/^#[a-fA-F0-9]{6}$/,W7=/^#[a-fA-F0-9]{8}$/,$7=/^#[a-fA-F0-9]{3}$/,j7=/^#[a-fA-F0-9]{4}$/,GS=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,X7=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,q7=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,Y7=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function ac(n){if(typeof n!="string")throw new ps(3);var e=V7(n);if(e.match(H7))return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16)};if(e.match(W7)){var t=parseFloat((parseInt(""+e[7]+e[8],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16),alpha:t}}if(e.match($7))return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16)};if(e.match(j7)){var i=parseFloat((parseInt(""+e[4]+e[4],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16),alpha:i}}var r=GS.exec(e);if(r)return{red:parseInt(""+r[1],10),green:parseInt(""+r[2],10),blue:parseInt(""+r[3],10)};var s=X7.exec(e.substring(0,50));if(s)return{red:parseInt(""+s[1],10),green:parseInt(""+s[2],10),blue:parseInt(""+s[3],10),alpha:parseFloat(""+s[4])>1?parseFloat(""+s[4])/100:parseFloat(""+s[4])};var o=q7.exec(e);if(o){var a=parseInt(""+o[1],10),l=parseInt(""+o[2],10)/100,u=parseInt(""+o[3],10)/100,c="rgb("+mg(a,l,u)+")",h=GS.exec(c);if(!h)throw new ps(4,e,c);return{red:parseInt(""+h[1],10),green:parseInt(""+h[2],10),blue:parseInt(""+h[3],10)}}var d=Y7.exec(e.substring(0,50));if(d){var f=parseInt(""+d[1],10),m=parseInt(""+d[2],10)/100,_=parseInt(""+d[3],10)/100,g="rgb("+mg(f,m,_)+")",p=GS.exec(g);if(!p)throw new ps(4,e,g);return{red:parseInt(""+p[1],10),green:parseInt(""+p[2],10),blue:parseInt(""+p[3],10),alpha:parseFloat(""+d[4])>1?parseFloat(""+d[4])/100:parseFloat(""+d[4])}}throw new ps(5)}function K7(n){var e=n.red/255,t=n.green/255,i=n.blue/255,r=Math.max(e,t,i),s=Math.min(e,t,i),o=(r+s)/2;if(r===s)return n.alpha!==void 0?{hue:0,saturation:0,lightness:o,alpha:n.alpha}:{hue:0,saturation:0,lightness:o};var a,l=r-s,u=o>.5?l/(2-r-s):l/(r+s);switch(r){case e:a=(t-i)/l+(t<i?6:0);break;case t:a=(i-e)/l+2;break;default:a=(e-t)/l+4;break}return a*=60,n.alpha!==void 0?{hue:a,saturation:u,lightness:o,alpha:n.alpha}:{hue:a,saturation:u,lightness:o}}function ra(n){return K7(ac(n))}var Q7=function(e){return e.length===7&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e},VS=Q7;function rl(n){var e=n.toString(16);return e.length===1?"0"+e:e}function HS(n){return rl(Math.round(n*255))}function Z7(n,e,t){return VS("#"+HS(n)+HS(e)+HS(t))}function xP(n,e,t){return mg(n,e,t,Z7)}function J7(n,e,t){if(typeof n=="object"&&e===void 0&&t===void 0)return xP(n.hue,n.saturation,n.lightness);throw new ps(1)}function eX(n,e,t,i){if(typeof n=="object"&&e===void 0&&t===void 0&&i===void 0)return n.alpha>=1?xP(n.hue,n.saturation,n.lightness):"rgba("+mg(n.hue,n.saturation,n.lightness)+","+n.alpha+")";throw new ps(2)}function SP(n,e,t){if(typeof n=="number"&&typeof e=="number"&&typeof t=="number")return VS("#"+rl(n)+rl(e)+rl(t));if(typeof n=="object"&&e===void 0&&t===void 0)return VS("#"+rl(n.red)+rl(n.green)+rl(n.blue));throw new ps(6)}function gg(n,e,t,i){if(typeof n=="object"&&e===void 0&&t===void 0&&i===void 0)return n.alpha>=1?SP(n.red,n.green,n.blue):"rgba("+n.red+","+n.green+","+n.blue+","+n.alpha+")";throw new ps(7)}var tX=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},nX=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&typeof e.alpha=="number"},iX=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},rX=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&typeof e.alpha=="number"};function sa(n){if(typeof n!="object")throw new ps(8);if(nX(n))return gg(n);if(tX(n))return SP(n);if(rX(n))return eX(n);if(iX(n))return J7(n);throw new ps(8)}function TP(n,e,t){return function(){var r=t.concat(Array.prototype.slice.call(arguments));return r.length>=e?n.apply(this,r):TP(n,e,r)}}function ir(n){return TP(n,n.length,[])}function sX(n,e){if(e==="transparent")return e;var t=ra(e);return sa(ki({},t,{hue:t.hue+parseFloat(n)}))}ir(sX);function lc(n,e,t){return Math.max(n,Math.min(e,t))}function oX(n,e){if(e==="transparent")return e;var t=ra(e);return sa(ki({},t,{lightness:lc(0,1,t.lightness-parseFloat(n))}))}ir(oX);function aX(n,e){if(e==="transparent")return e;var t=ra(e);return sa(ki({},t,{saturation:lc(0,1,t.saturation-parseFloat(n))}))}ir(aX);function lX(n,e){if(e==="transparent")return e;var t=ra(e);return sa(ki({},t,{lightness:lc(0,1,t.lightness+parseFloat(n))}))}ir(lX);function uX(n,e,t){if(e==="transparent")return t;if(t==="transparent")return e;if(n===0)return t;var i=ac(e),r=ki({},i,{alpha:typeof i.alpha=="number"?i.alpha:1}),s=ac(t),o=ki({},s,{alpha:typeof s.alpha=="number"?s.alpha:1}),a=r.alpha-o.alpha,l=parseFloat(n)*2-1,u=l*a===-1?l:l+a,c=1+l*a,h=(u/c+1)/2,d=1-h,f={red:Math.floor(r.red*h+o.red*d),green:Math.floor(r.green*h+o.green*d),blue:Math.floor(r.blue*h+o.blue*d),alpha:r.alpha*parseFloat(n)+o.alpha*(1-parseFloat(n))};return gg(f)}var cX=ir(uX),bP=cX;function hX(n,e){if(e==="transparent")return e;var t=ac(e),i=typeof t.alpha=="number"?t.alpha:1,r=ki({},t,{alpha:lc(0,1,(i*100+parseFloat(n)*100)/100)});return gg(r)}var dX=ir(hX),fX=dX;function pX(n,e){if(e==="transparent")return e;var t=ra(e);return sa(ki({},t,{saturation:lc(0,1,t.saturation+parseFloat(n))}))}ir(pX);function mX(n,e){return e==="transparent"?e:sa(ki({},ra(e),{hue:parseFloat(n)}))}ir(mX);function gX(n,e){return e==="transparent"?e:sa(ki({},ra(e),{lightness:parseFloat(n)}))}ir(gX);function _X(n,e){return e==="transparent"?e:sa(ki({},ra(e),{saturation:parseFloat(n)}))}ir(_X);function vX(n,e){return e==="transparent"?e:bP(parseFloat(n),"rgb(0, 0, 0)",e)}ir(vX);function yX(n,e){return e==="transparent"?e:bP(parseFloat(n),"rgb(255, 255, 255)",e)}ir(yX);function xX(n,e){if(e==="transparent")return e;var t=ac(e),i=typeof t.alpha=="number"?t.alpha:1,r=ki({},t,{alpha:lc(0,1,+(i*100-parseFloat(n)*100).toFixed(2)/100)});return gg(r)}ir(xX);var sl=Object.freeze({Linear:Object.freeze({None:function(n){return n},In:function(n){return n},Out:function(n){return n},InOut:function(n){return n}}),Quadratic:Object.freeze({In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}}),Cubic:Object.freeze({In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}}),Quartic:Object.freeze({In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}}),Quintic:Object.freeze({In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}}),Sinusoidal:Object.freeze({In:function(n){return 1-Math.sin((1-n)*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return .5*(1-Math.sin(Math.PI*(.5-n)))}}),Exponential:Object.freeze({In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}}),Circular:Object.freeze({In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}}),Elastic:Object.freeze({In:function(n){return n===0?0:n===1?1:-Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI)},Out:function(n){return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n-.1)*5*Math.PI)+1},InOut:function(n){return n===0?0:n===1?1:(n*=2,n<1?-.5*Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI):.5*Math.pow(2,-10*(n-1))*Math.sin((n-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(n){var e=1.70158;return n===1?1:n*n*((e+1)*n-e)},Out:function(n){var e=1.70158;return n===0?0:--n*n*((e+1)*n+e)+1},InOut:function(n){var e=2.5949095;return(n*=2)<1?.5*(n*n*((e+1)*n-e)):.5*((n-=2)*n*((e+1)*n+e)+2)}}),Bounce:Object.freeze({In:function(n){return 1-sl.Bounce.Out(1-n)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(n){return n<.5?sl.Bounce.In(n*2)*.5:sl.Bounce.Out(n*2-1)*.5+.5}}),generatePow:function(n){return n===void 0&&(n=4),n=n<Number.EPSILON?Number.EPSILON:n,n=n>1e4?1e4:n,{In:function(e){return Math.pow(e,n)},Out:function(e){return 1-Math.pow(1-e,n)},InOut:function(e){return e<.5?Math.pow(e*2,n)/2:(1-Math.pow(2-e*2,n))/2+.5}}}}),Dd=function(){return performance.now()},wP=function(){function n(){this._tweens={},this._tweensAddedDuringUpdate={}}return n.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},n.prototype.removeAll=function(){this._tweens={}},n.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},n.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},n.prototype.update=function(e,t){e===void 0&&(e=Dd()),t===void 0&&(t=!1);var i=Object.keys(this._tweens);if(i.length===0)return!1;for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<i.length;r++){var s=this._tweens[i[r]],o=!t;s&&s.update(e,o)===!1&&!t&&delete this._tweens[i[r]]}i=Object.keys(this._tweensAddedDuringUpdate)}return!0},n}(),uc={Linear:function(n,e){var t=n.length-1,i=t*e,r=Math.floor(i),s=uc.Utils.Linear;return e<0?s(n[0],n[1],i):e>1?s(n[t],n[t-1],t-i):s(n[r],n[r+1>t?t:r+1],i-r)},Bezier:function(n,e){for(var t=0,i=n.length-1,r=Math.pow,s=uc.Utils.Bernstein,o=0;o<=i;o++)t+=r(1-e,i-o)*r(e,o)*n[o]*s(i,o);return t},CatmullRom:function(n,e){var t=n.length-1,i=t*e,r=Math.floor(i),s=uc.Utils.CatmullRom;return n[0]===n[t]?(e<0&&(r=Math.floor(i=t*(1+e))),s(n[(r-1+t)%t],n[r],n[(r+1)%t],n[(r+2)%t],i-r)):e<0?n[0]-(s(n[0],n[0],n[1],n[1],-i)-n[0]):e>1?n[t]-(s(n[t],n[t],n[t-1],n[t-1],i-t)-n[t]):s(n[r?r-1:0],n[r],n[t<r+1?t:r+1],n[t<r+2?t:r+2],i-r)},Utils:{Linear:function(n,e,t){return(e-n)*t+n},Bernstein:function(n,e){var t=uc.Utils.Factorial;return t(n)/t(e)/t(n-e)},Factorial:function(){var n=[1];return function(e){var t=1;if(n[e])return n[e];for(var i=e;i>1;i--)t*=i;return n[e]=t,t}}(),CatmullRom:function(n,e,t,i,r){var s=(t-n)*.5,o=(i-e)*.5,a=r*r,l=r*a;return(2*e-2*t+s+o)*l+(-3*e+3*t-2*s-o)*a+s*r+e}}},SX=function(){function n(){}return n.nextId=function(){return n._nextId++},n._nextId=0,n}(),WS=new wP,MP=function(){function n(e,t){t===void 0&&(t=WS),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=sl.Linear.None,this._interpolationFunction=uc.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=SX.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return n.prototype.getId=function(){return this._id},n.prototype.isPlaying=function(){return this._isPlaying},n.prototype.isPaused=function(){return this._isPaused},n.prototype.getDuration=function(){return this._duration},n.prototype.to=function(e,t){if(t===void 0&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},n.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},n.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},n.prototype.start=function(e,t){if(e===void 0&&(e=Dd()),t===void 0&&(t=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var i in this._valuesStartRepeat)this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var r={};for(var s in this._valuesEnd)r[s]=this._valuesEnd[s];this._valuesEnd=r}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},n.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},n.prototype._setupProperties=function(e,t,i,r,s){for(var o in i){var a=e[o],l=Array.isArray(a),u=l?"array":typeof a,c=!l&&Array.isArray(i[o]);if(!(u==="undefined"||u==="function")){if(c){var h=i[o];if(h.length===0)continue;for(var d=[a],f=0,m=h.length;f<m;f+=1){var _=this._handleRelativeValue(a,h[f]);if(isNaN(_)){c=!1,console.warn("Found invalid interpolation list. Skipping.");break}d.push(_)}c&&(i[o]=d)}if((u==="object"||l)&&a&&!c){t[o]=l?[]:{};var g=a;for(var p in g)t[o][p]=g[p];r[o]=l?[]:{};var h=i[o];if(!this._isDynamic){var v={};for(var p in h)v[p]=h[p];i[o]=h=v}this._setupProperties(g,t[o],h,r[o],s)}else(typeof t[o]>"u"||s)&&(t[o]=a),l||(t[o]*=1),c?r[o]=i[o].slice().reverse():r[o]=t[o]||0}}},n.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},n.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},n.prototype.pause=function(e){return e===void 0&&(e=Dd()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this),this)},n.prototype.resume=function(e){return e===void 0&&(e=Dd()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},n.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},n.prototype.group=function(e){return e===void 0&&(e=WS),this._group=e,this},n.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},n.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},n.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},n.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},n.prototype.easing=function(e){return e===void 0&&(e=sl.Linear.None),this._easingFunction=e,this},n.prototype.interpolation=function(e){return e===void 0&&(e=uc.Linear),this._interpolationFunction=e,this},n.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},n.prototype.onStart=function(e){return this._onStartCallback=e,this},n.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},n.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},n.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},n.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},n.prototype.onStop=function(e){return this._onStopCallback=e,this},n.prototype.update=function(e,t){var i=this,r;if(e===void 0&&(e=Dd()),t===void 0&&(t=!0),this._isPaused)return!0;var s,o=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>o)return!1;t&&this.start(e,!0)}if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var a=e-this._startTime,l=this._duration+((r=this._repeatDelayTime)!==null&&r!==void 0?r:this._delayTime),u=this._duration+this._repeat*l,c=function(){if(i._duration===0||a>u)return 1;var g=Math.trunc(a/l),p=a-g*l,v=Math.min(p/i._duration,1);return v===0&&a===i._duration?1:v},h=c(),d=this._easingFunction(h);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,d),this._onUpdateCallback&&this._onUpdateCallback(this._object,h),this._duration===0||a>=this._duration)if(this._repeat>0){var f=Math.min(Math.trunc((a-this._duration)/l)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=f);for(s in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[s]=="string"&&(this._valuesStartRepeat[s]=this._valuesStartRepeat[s]+parseFloat(this._valuesEnd[s])),this._yoyo&&this._swapEndStartRepeatValues(s),this._valuesStart[s]=this._valuesStartRepeat[s];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=l*f,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var m=0,_=this._chainedTweens.length;m<_;m++)this._chainedTweens[m].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},n.prototype._updateProperties=function(e,t,i,r){for(var s in i)if(t[s]!==void 0){var o=t[s]||0,a=i[s],l=Array.isArray(e[s]),u=Array.isArray(a),c=!l&&u;c?e[s]=this._interpolationFunction(a,r):typeof a=="object"&&a?this._updateProperties(e[s],o,a,r):(a=this._handleRelativeValue(o,a),typeof a=="number"&&(e[s]=o+(a-o)*r))}},n.prototype._handleRelativeValue=function(e,t){return typeof t!="string"?t:t.charAt(0)==="+"||t.charAt(0)==="-"?e+parseFloat(t):parseFloat(t)},n.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],i=this._valuesEnd[e];typeof i=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(i):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},n}(),ms=WS;ms.getAll.bind(ms),ms.removeAll.bind(ms),ms.add.bind(ms),ms.remove.bind(ms),ms.update.bind(ms);var $S="http://www.w3.org/1999/xhtml";const EP={svg:"http://www.w3.org/2000/svg",xhtml:$S,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function _g(n){var e=n+="",t=e.indexOf(":");return t>=0&&(e=n.slice(0,t))!=="xmlns"&&(n=n.slice(t+1)),EP.hasOwnProperty(e)?{space:EP[e],local:n}:n}function TX(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===$S&&e.documentElement.namespaceURI===$S?e.createElement(n):e.createElementNS(t,n)}}function bX(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function AP(n){var e=_g(n);return(e.local?bX:TX)(e)}function wX(){}function jS(n){return n==null?wX:function(){return this.querySelector(n)}}function MX(n){typeof n!="function"&&(n=jS(n));for(var e=this._groups,t=e.length,i=new Array(t),r=0;r<t;++r)for(var s=e[r],o=s.length,a=i[r]=new Array(o),l,u,c=0;c<o;++c)(l=s[c])&&(u=n.call(l,l.__data__,c,s))&&("__data__"in l&&(u.__data__=l.__data__),a[c]=u);return new rr(i,this._parents)}function EX(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function AX(){return[]}function CP(n){return n==null?AX:function(){return this.querySelectorAll(n)}}function CX(n){return function(){return EX(n.apply(this,arguments))}}function RX(n){typeof n=="function"?n=CX(n):n=CP(n);for(var e=this._groups,t=e.length,i=[],r=[],s=0;s<t;++s)for(var o=e[s],a=o.length,l,u=0;u<a;++u)(l=o[u])&&(i.push(n.call(l,l.__data__,u,o)),r.push(l));return new rr(i,r)}function RP(n){return function(){return this.matches(n)}}function NP(n){return function(e){return e.matches(n)}}var NX=Array.prototype.find;function PX(n){return function(){return NX.call(this.children,n)}}function DX(){return this.firstElementChild}function LX(n){return this.select(n==null?DX:PX(typeof n=="function"?n:NP(n)))}var IX=Array.prototype.filter;function UX(){return Array.from(this.children)}function FX(n){return function(){return IX.call(this.children,n)}}function OX(n){return this.selectAll(n==null?UX:FX(typeof n=="function"?n:NP(n)))}function BX(n){typeof n!="function"&&(n=RP(n));for(var e=this._groups,t=e.length,i=new Array(t),r=0;r<t;++r)for(var s=e[r],o=s.length,a=i[r]=[],l,u=0;u<o;++u)(l=s[u])&&n.call(l,l.__data__,u,s)&&a.push(l);return new rr(i,this._parents)}function PP(n){return new Array(n.length)}function kX(){return new rr(this._enter||this._groups.map(PP),this._parents)}function vg(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}vg.prototype={constructor:vg,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function zX(n){return function(){return n}}function GX(n,e,t,i,r,s){for(var o=0,a,l=e.length,u=s.length;o<u;++o)(a=e[o])?(a.__data__=s[o],i[o]=a):t[o]=new vg(n,s[o]);for(;o<l;++o)(a=e[o])&&(r[o]=a)}function VX(n,e,t,i,r,s,o){var a,l,u=new Map,c=e.length,h=s.length,d=new Array(c),f;for(a=0;a<c;++a)(l=e[a])&&(d[a]=f=o.call(l,l.__data__,a,e)+"",u.has(f)?r[a]=l:u.set(f,l));for(a=0;a<h;++a)f=o.call(n,s[a],a,s)+"",(l=u.get(f))?(i[a]=l,l.__data__=s[a],u.delete(f)):t[a]=new vg(n,s[a]);for(a=0;a<c;++a)(l=e[a])&&u.get(d[a])===l&&(r[a]=l)}function HX(n){return n.__data__}function WX(n,e){if(!arguments.length)return Array.from(this,HX);var t=e?VX:GX,i=this._parents,r=this._groups;typeof n!="function"&&(n=zX(n));for(var s=r.length,o=new Array(s),a=new Array(s),l=new Array(s),u=0;u<s;++u){var c=i[u],h=r[u],d=h.length,f=$X(n.call(c,c&&c.__data__,u,i)),m=f.length,_=a[u]=new Array(m),g=o[u]=new Array(m),p=l[u]=new Array(d);t(c,h,_,g,p,f,e);for(var v=0,y=0,x,T;v<m;++v)if(x=_[v]){for(v>=y&&(y=v+1);!(T=g[y])&&++y<m;);x._next=T||null}}return o=new rr(o,i),o._enter=a,o._exit=l,o}function $X(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function jX(){return new rr(this._exit||this._groups.map(PP),this._parents)}function XX(n,e,t){var i=this.enter(),r=this,s=this.exit();return typeof n=="function"?(i=n(i),i&&(i=i.selection())):i=i.append(n+""),e!=null&&(r=e(r),r&&(r=r.selection())),t==null?s.remove():t(s),i&&r?i.merge(r).order():r}function qX(n){for(var e=n.selection?n.selection():n,t=this._groups,i=e._groups,r=t.length,s=i.length,o=Math.min(r,s),a=new Array(r),l=0;l<o;++l)for(var u=t[l],c=i[l],h=u.length,d=a[l]=new Array(h),f,m=0;m<h;++m)(f=u[m]||c[m])&&(d[m]=f);for(;l<r;++l)a[l]=t[l];return new rr(a,this._parents)}function YX(){for(var n=this._groups,e=-1,t=n.length;++e<t;)for(var i=n[e],r=i.length-1,s=i[r],o;--r>=0;)(o=i[r])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function KX(n){n||(n=QX);function e(h,d){return h&&d?n(h.__data__,d.__data__):!h-!d}for(var t=this._groups,i=t.length,r=new Array(i),s=0;s<i;++s){for(var o=t[s],a=o.length,l=r[s]=new Array(a),u,c=0;c<a;++c)(u=o[c])&&(l[c]=u);l.sort(e)}return new rr(r,this._parents).order()}function QX(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function ZX(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function JX(){return Array.from(this)}function eq(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var i=n[e],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null}function tq(){let n=0;for(const e of this)++n;return n}function nq(){return!this.node()}function iq(n){for(var e=this._groups,t=0,i=e.length;t<i;++t)for(var r=e[t],s=0,o=r.length,a;s<o;++s)(a=r[s])&&n.call(a,a.__data__,s,r);return this}function rq(n){return function(){this.removeAttribute(n)}}function sq(n){return function(){this.removeAttributeNS(n.space,n.local)}}function oq(n,e){return function(){this.setAttribute(n,e)}}function aq(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function lq(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(n):this.setAttribute(n,t)}}function uq(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}}function cq(n,e){var t=_g(n);if(arguments.length<2){var i=this.node();return t.local?i.getAttributeNS(t.space,t.local):i.getAttribute(t)}return this.each((e==null?t.local?sq:rq:typeof e=="function"?t.local?uq:lq:t.local?aq:oq)(t,e))}function DP(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function hq(n){return function(){this.style.removeProperty(n)}}function dq(n,e,t){return function(){this.style.setProperty(n,e,t)}}function fq(n,e,t){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(n):this.style.setProperty(n,i,t)}}function pq(n,e,t){return arguments.length>1?this.each((e==null?hq:typeof e=="function"?fq:dq)(n,e,t??"")):cc(this.node(),n)}function cc(n,e){return n.style.getPropertyValue(e)||DP(n).getComputedStyle(n,null).getPropertyValue(e)}function mq(n){return function(){delete this[n]}}function gq(n,e){return function(){this[n]=e}}function _q(n,e){return function(){var t=e.apply(this,arguments);t==null?delete this[n]:this[n]=t}}function vq(n,e){return arguments.length>1?this.each((e==null?mq:typeof e=="function"?_q:gq)(n,e)):this.node()[n]}function LP(n){return n.trim().split(/^|\s+/)}function XS(n){return n.classList||new IP(n)}function IP(n){this._node=n,this._names=LP(n.getAttribute("class")||"")}IP.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function UP(n,e){for(var t=XS(n),i=-1,r=e.length;++i<r;)t.add(e[i])}function FP(n,e){for(var t=XS(n),i=-1,r=e.length;++i<r;)t.remove(e[i])}function yq(n){return function(){UP(this,n)}}function xq(n){return function(){FP(this,n)}}function Sq(n,e){return function(){(e.apply(this,arguments)?UP:FP)(this,n)}}function Tq(n,e){var t=LP(n+"");if(arguments.length<2){for(var i=XS(this.node()),r=-1,s=t.length;++r<s;)if(!i.contains(t[r]))return!1;return!0}return this.each((typeof e=="function"?Sq:e?yq:xq)(t,e))}function bq(){this.textContent=""}function wq(n){return function(){this.textContent=n}}function Mq(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function Eq(n){return arguments.length?this.each(n==null?bq:(typeof n=="function"?Mq:wq)(n)):this.node().textContent}function Aq(){this.innerHTML=""}function Cq(n){return function(){this.innerHTML=n}}function Rq(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function Nq(n){return arguments.length?this.each(n==null?Aq:(typeof n=="function"?Rq:Cq)(n)):this.node().innerHTML}function Pq(){this.nextSibling&&this.parentNode.appendChild(this)}function Dq(){return this.each(Pq)}function Lq(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Iq(){return this.each(Lq)}function Uq(n){var e=typeof n=="function"?n:AP(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Fq(){return null}function Oq(n,e){var t=typeof n=="function"?n:AP(n),i=e==null?Fq:typeof e=="function"?e:jS(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),i.apply(this,arguments)||null)})}function Bq(){var n=this.parentNode;n&&n.removeChild(this)}function kq(){return this.each(Bq)}function zq(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function Gq(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function Vq(n){return this.select(n?Gq:zq)}function Hq(n){return arguments.length?this.property("__data__",n):this.node().__data__}function Wq(n){return function(e){n.call(this,e,this.__data__)}}function $q(n){return n.trim().split(/^|\s+/).map(function(e){var t="",i=e.indexOf(".");return i>=0&&(t=e.slice(i+1),e=e.slice(0,i)),{type:e,name:t}})}function jq(n){return function(){var e=this.__on;if(e){for(var t=0,i=-1,r=e.length,s;t<r;++t)s=e[t],(!n.type||s.type===n.type)&&s.name===n.name?this.removeEventListener(s.type,s.listener,s.options):e[++i]=s;++i?e.length=i:delete this.__on}}}function Xq(n,e,t){return function(){var i=this.__on,r,s=Wq(e);if(i){for(var o=0,a=i.length;o<a;++o)if((r=i[o]).type===n.type&&r.name===n.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=t),r.value=e;return}}this.addEventListener(n.type,s,t),r={type:n.type,name:n.name,value:e,listener:s,options:t},i?i.push(r):this.__on=[r]}}function qq(n,e,t){var i=$q(n+""),r,s=i.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,u=a.length,c;l<u;++l)for(r=0,c=a[l];r<s;++r)if((o=i[r]).type===c.type&&o.name===c.name)return c.value}return}for(a=e?Xq:jq,r=0;r<s;++r)this.each(a(i[r],e,t));return this}function OP(n,e,t){var i=DP(n),r=i.CustomEvent;typeof r=="function"?r=new r(e,t):(r=i.document.createEvent("Event"),t?(r.initEvent(e,t.bubbles,t.cancelable),r.detail=t.detail):r.initEvent(e,!1,!1)),n.dispatchEvent(r)}function Yq(n,e){return function(){return OP(this,n,e)}}function Kq(n,e){return function(){return OP(this,n,e.apply(this,arguments))}}function Qq(n,e){return this.each((typeof e=="function"?Kq:Yq)(n,e))}function*Zq(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var i=n[e],r=0,s=i.length,o;r<s;++r)(o=i[r])&&(yield o)}var BP=[null];function rr(n,e){this._groups=n,this._parents=e}function Ld(){return new rr([[document.documentElement]],BP)}function Jq(){return this}rr.prototype=Ld.prototype={constructor:rr,select:MX,selectAll:RX,selectChild:LX,selectChildren:OX,filter:BX,data:WX,enter:kX,exit:jX,join:XX,merge:qX,selection:Jq,order:YX,sort:KX,call:ZX,nodes:JX,node:eq,size:tq,empty:nq,each:iq,attr:cq,style:pq,property:vq,classed:Tq,text:Eq,html:Nq,raise:Dq,lower:Iq,append:Uq,insert:Oq,remove:kq,clone:Vq,datum:Hq,on:qq,dispatch:Qq,[Symbol.iterator]:Zq};function eY(n){return typeof n=="string"?new rr([[document.querySelector(n)]],[document.documentElement]):new rr([[n]],BP)}function tY(n){let e;for(;e=n.sourceEvent;)n=e;return n}function nY(n,e){if(n=tY(n),e===void 0&&(e=n.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var i=t.createSVGPoint();return i.x=n.clientX,i.y=n.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[n.clientX-r.left-e.clientLeft,n.clientY-r.top-e.clientTop]}}return[n.pageX,n.pageY]}var Id,qt,kP,zP,ol,GP,VP,qS,HP,YS,KS,QS,Ud={},WP=[],iY=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ZS=Array.isArray;function io(n,e){for(var t in e)n[t]=e[t];return n}function JS(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function rY(n,e,t){var i,r,s,o={};for(s in e)s=="key"?i=e[s]:s=="ref"?r=e[s]:o[s]=e[s];if(arguments.length>2&&(o.children=arguments.length>3?Id.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(s in n.defaultProps)o[s]===void 0&&(o[s]=n.defaultProps[s]);return Fd(n,o,i,r,null)}function Fd(n,e,t,i,r){var s={type:n,props:e,key:t,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r??++kP,__i:-1,__u:0};return r==null&&qt.vnode!=null&&qt.vnode(s),s}function yg(n){return n.children}function xg(n,e){this.props=n,this.context=e}function hc(n,e){if(e==null)return n.__?hc(n.__,n.__i+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?hc(n):null}function $P(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return $P(n)}}function jP(n){(!n.__d&&(n.__d=!0)&&ol.push(n)&&!Sg.__r++||GP!==qt.debounceRendering)&&((GP=qt.debounceRendering)||VP)(Sg)}function Sg(){var n,e,t,i,r,s,o,a;for(ol.sort(qS);n=ol.shift();)n.__d&&(e=ol.length,i=void 0,s=(r=(t=n).__v).__e,o=[],a=[],t.__P&&((i=io({},r)).__v=r.__v+1,qt.vnode&&qt.vnode(i),eT(t.__P,i,r,t.__n,t.__P.namespaceURI,32&r.__u?[s]:null,o,s??hc(r),!!(32&r.__u),a),i.__v=r.__v,i.__.__k[i.__i]=i,QP(o,i,a),i.__e!=s&&$P(i)),ol.length>e&&ol.sort(qS));Sg.__r=0}function XP(n,e,t,i,r,s,o,a,l,u,c){var h,d,f,m,_,g,p=i&&i.__k||WP,v=e.length;for(l=sY(t,e,p,l,v),h=0;h<v;h++)(f=t.__k[h])!=null&&(d=f.__i===-1?Ud:p[f.__i]||Ud,f.__i=h,g=eT(n,f,d,r,s,o,a,l,u,c),m=f.__e,f.ref&&d.ref!=f.ref&&(d.ref&&tT(d.ref,null,f),c.push(f.ref,f.__c||m,f)),_==null&&m!=null&&(_=m),4&f.__u||d.__k===f.__k?l=qP(f,l,n):typeof f.type=="function"&&g!==void 0?l=g:m&&(l=m.nextSibling),f.__u&=-7);return t.__e=_,l}function sY(n,e,t,i,r){var s,o,a,l,u,c=t.length,h=c,d=0;for(n.__k=new Array(r),s=0;s<r;s++)(o=e[s])!=null&&typeof o!="boolean"&&typeof o!="function"?(l=s+d,(o=n.__k[s]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?Fd(null,o,null,null,null):ZS(o)?Fd(yg,{children:o},null,null,null):o.constructor===void 0&&o.__b>0?Fd(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=n,o.__b=n.__b+1,a=null,(u=o.__i=oY(o,t,l,h))!==-1&&(h--,(a=t[u])&&(a.__u|=2)),a==null||a.__v===null?(u==-1&&d--,typeof o.type!="function"&&(o.__u|=4)):u!=l&&(u==l-1?d--:u==l+1?d++:(u>l?d--:d++,o.__u|=4))):n.__k[s]=null;if(h)for(s=0;s<c;s++)(a=t[s])!=null&&!(2&a.__u)&&(a.__e==i&&(i=hc(a)),ZP(a,a));return i}function qP(n,e,t){var i,r;if(typeof n.type=="function"){for(i=n.__k,r=0;i&&r<i.length;r++)i[r]&&(i[r].__=n,e=qP(i[r],e,t));return e}n.__e!=e&&(e&&n.type&&!t.contains(e)&&(e=hc(n)),t.insertBefore(n.__e,e||null),e=n.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function oY(n,e,t,i){var r,s,o=n.key,a=n.type,l=e[t];if(l===null||l&&o==l.key&&a===l.type&&!(2&l.__u))return t;if(i>(l!=null&&!(2&l.__u)?1:0))for(r=t-1,s=t+1;r>=0||s<e.length;){if(r>=0){if((l=e[r])&&!(2&l.__u)&&o==l.key&&a===l.type)return r;r--}if(s<e.length){if((l=e[s])&&!(2&l.__u)&&o==l.key&&a===l.type)return s;s++}}return-1}function YP(n,e,t){e[0]=="-"?n.setProperty(e,t??""):n[e]=t==null?"":typeof t!="number"||iY.test(e)?t:t+"px"}function Tg(n,e,t,i,r){var s;e:if(e=="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof i=="string"&&(n.style.cssText=i=""),i)for(e in i)t&&e in t||YP(n.style,e,"");if(t)for(e in t)i&&t[e]===i[e]||YP(n.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(HP,"$1")),e=e.toLowerCase()in n||e=="onFocusOut"||e=="onFocusIn"?e.toLowerCase().slice(2):e.slice(2),n.l||(n.l={}),n.l[e+s]=t,t?i?t.u=i.u:(t.u=YS,n.addEventListener(e,s?QS:KS,s)):n.removeEventListener(e,s?QS:KS,s);else{if(r=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in n)try{n[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?n.removeAttribute(e):n.setAttribute(e,e=="popover"&&t==1?"":t))}}function KP(n){return function(e){if(this.l){var t=this.l[e.type+n];if(e.t==null)e.t=YS++;else if(e.t<t.u)return;return t(qt.event?qt.event(e):e)}}}function eT(n,e,t,i,r,s,o,a,l,u){var c,h,d,f,m,_,g,p,v,y,x,T,S,w,E,M,b,R=e.type;if(e.constructor!==void 0)return null;128&t.__u&&(l=!!(32&t.__u),s=[a=e.__e=t.__e]),(c=qt.__b)&&c(e);e:if(typeof R=="function")try{if(p=e.props,v="prototype"in R&&R.prototype.render,y=(c=R.contextType)&&i[c.__c],x=c?y?y.props.value:c.__:i,t.__c?g=(h=e.__c=t.__c).__=h.__E:(v?e.__c=h=new R(p,x):(e.__c=h=new xg(p,x),h.constructor=R,h.render=lY),y&&y.sub(h),h.props=p,h.state||(h.state={}),h.context=x,h.__n=i,d=h.__d=!0,h.__h=[],h._sb=[]),v&&h.__s==null&&(h.__s=h.state),v&&R.getDerivedStateFromProps!=null&&(h.__s==h.state&&(h.__s=io({},h.__s)),io(h.__s,R.getDerivedStateFromProps(p,h.__s))),f=h.props,m=h.state,h.__v=e,d)v&&R.getDerivedStateFromProps==null&&h.componentWillMount!=null&&h.componentWillMount(),v&&h.componentDidMount!=null&&h.__h.push(h.componentDidMount);else{if(v&&R.getDerivedStateFromProps==null&&p!==f&&h.componentWillReceiveProps!=null&&h.componentWillReceiveProps(p,x),!h.__e&&(h.shouldComponentUpdate!=null&&h.shouldComponentUpdate(p,h.__s,x)===!1||e.__v==t.__v)){for(e.__v!=t.__v&&(h.props=p,h.state=h.__s,h.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(I){I&&(I.__=e)}),T=0;T<h._sb.length;T++)h.__h.push(h._sb[T]);h._sb=[],h.__h.length&&o.push(h);break e}h.componentWillUpdate!=null&&h.componentWillUpdate(p,h.__s,x),v&&h.componentDidUpdate!=null&&h.__h.push(function(){h.componentDidUpdate(f,m,_)})}if(h.context=x,h.props=p,h.__P=n,h.__e=!1,S=qt.__r,w=0,v){for(h.state=h.__s,h.__d=!1,S&&S(e),c=h.render(h.props,h.state,h.context),E=0;E<h._sb.length;E++)h.__h.push(h._sb[E]);h._sb=[]}else do h.__d=!1,S&&S(e),c=h.render(h.props,h.state,h.context),h.state=h.__s;while(h.__d&&++w<25);h.state=h.__s,h.getChildContext!=null&&(i=io(io({},i),h.getChildContext())),v&&!d&&h.getSnapshotBeforeUpdate!=null&&(_=h.getSnapshotBeforeUpdate(f,m)),a=XP(n,ZS(M=c!=null&&c.type===yg&&c.key==null?c.props.children:c)?M:[M],e,t,i,r,s,o,a,l,u),h.base=e.__e,e.__u&=-161,h.__h.length&&o.push(h),g&&(h.__E=h.__=null)}catch(I){if(e.__v=null,l||s!=null)if(I.then){for(e.__u|=l?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;s[s.indexOf(a)]=null,e.__e=a}else for(b=s.length;b--;)JS(s[b]);else e.__e=t.__e,e.__k=t.__k;qt.__e(I,e,t)}else s==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):a=e.__e=aY(t.__e,e,t,i,r,s,o,l,u);return(c=qt.diffed)&&c(e),128&e.__u?void 0:a}function QP(n,e,t){for(var i=0;i<t.length;i++)tT(t[i],t[++i],t[++i]);qt.__c&&qt.__c(e,n),n.some(function(r){try{n=r.__h,r.__h=[],n.some(function(s){s.call(r)})}catch(s){qt.__e(s,r.__v)}})}function aY(n,e,t,i,r,s,o,a,l){var u,c,h,d,f,m,_,g=t.props,p=e.props,v=e.type;if(v=="svg"?r="http://www.w3.org/2000/svg":v=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),s!=null){for(u=0;u<s.length;u++)if((f=s[u])&&"setAttribute"in f==!!v&&(v?f.localName==v:f.nodeType==3)){n=f,s[u]=null;break}}if(n==null){if(v==null)return document.createTextNode(p);n=document.createElementNS(r,v,p.is&&p),a&&(qt.__m&&qt.__m(e,s),a=!1),s=null}if(v===null)g===p||a&&n.data===p||(n.data=p);else{if(s=s&&Id.call(n.childNodes),g=t.props||Ud,!a&&s!=null)for(g={},u=0;u<n.attributes.length;u++)g[(f=n.attributes[u]).name]=f.value;for(u in g)if(f=g[u],u!="children"){if(u=="dangerouslySetInnerHTML")h=f;else if(!(u in p)){if(u=="value"&&"defaultValue"in p||u=="checked"&&"defaultChecked"in p)continue;Tg(n,u,null,f,r)}}for(u in p)f=p[u],u=="children"?d=f:u=="dangerouslySetInnerHTML"?c=f:u=="value"?m=f:u=="checked"?_=f:a&&typeof f!="function"||g[u]===f||Tg(n,u,f,g[u],r);if(c)a||h&&(c.__html===h.__html||c.__html===n.innerHTML)||(n.innerHTML=c.__html),e.__k=[];else if(h&&(n.innerHTML=""),XP(n,ZS(d)?d:[d],e,t,i,v=="foreignObject"?"http://www.w3.org/1999/xhtml":r,s,o,s?s[0]:t.__k&&hc(t,0),a,l),s!=null)for(u=s.length;u--;)JS(s[u]);a||(u="value",v=="progress"&&m==null?n.removeAttribute("value"):m!==void 0&&(m!==n[u]||v=="progress"&&!m||v=="option"&&m!==g[u])&&Tg(n,u,m,g[u],r),u="checked",_!==void 0&&_!==n[u]&&Tg(n,u,_,g[u],r))}return n}function tT(n,e,t){try{if(typeof n=="function"){var i=typeof n.__u=="function";i&&n.__u(),i&&e==null||(n.__u=n(e))}else n.current=e}catch(r){qt.__e(r,t)}}function ZP(n,e,t){var i,r;if(qt.unmount&&qt.unmount(n),(i=n.ref)&&(i.current&&i.current!==n.__e||tT(i,null,e)),(i=n.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(s){qt.__e(s,e)}i.base=i.__P=null}if(i=n.__k)for(r=0;r<i.length;r++)i[r]&&ZP(i[r],e,t||typeof n.type!="function");t||JS(n.__e),n.__c=n.__=n.__e=void 0}function lY(n,e,t){return this.constructor(n,t)}function uY(n,e,t){var i,r,s,o;e==document&&(e=document.documentElement),qt.__&&qt.__(n,e),r=(i=!1)?null:e.__k,s=[],o=[],eT(e,n=e.__k=rY(yg,null,[n]),r||Ud,Ud,e.namespaceURI,r?null:e.firstChild?Id.call(e.childNodes):null,s,r?r.__e:e.firstChild,i,o),QP(s,n,o)}function JP(n,e,t){var i,r,s,o,a=io({},n.props);for(s in n.type&&n.type.defaultProps&&(o=n.type.defaultProps),e)s=="key"?i=e[s]:s=="ref"?r=e[s]:a[s]=e[s]===void 0&&o!==void 0?o[s]:e[s];return arguments.length>2&&(a.children=arguments.length>3?Id.call(arguments,2):t),Fd(n.type,a,i||n.key,r||n.ref,null)}Id=WP.slice,qt={__e:function(n,e,t,i){for(var r,s,o;e=e.__;)if((r=e.__c)&&!r.__)try{if((s=r.constructor)&&s.getDerivedStateFromError!=null&&(r.setState(s.getDerivedStateFromError(n)),o=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(n,i||{}),o=r.__d),o)return r.__E=r}catch(a){n=a}throw n}},kP=0,zP=function(n){return n!=null&&n.constructor==null},xg.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=io({},this.state),typeof n=="function"&&(n=n(io({},t),this.props)),n&&io(t,n),n!=null&&this.__v&&(e&&this._sb.push(e),jP(this))},xg.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),jP(this))},xg.prototype.render=yg,ol=[],VP=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,qS=function(n,e){return n.__v.__b-e.__v.__b},Sg.__r=0,HP=/(PointerCapture)$|Capture$/i,YS=0,KS=KP(!1),QS=KP(!0);function e2(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function cY(n){if(Array.isArray(n))return n}function hY(n,e,t){return(e=_Y(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function dY(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,r,s,o,a=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(i=s.call(t)).done)&&(a.push(i.value),a.length!==e);l=!0);}catch(c){u=!0,r=c}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(u)throw r}}return a}}function fY(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function t2(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function pY(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?t2(Object(t),!0).forEach(function(i){hY(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):t2(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function mY(n,e){return cY(n)||dY(n,e)||vY(n,e)||fY()}function gY(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function _Y(n){var e=gY(n,"string");return typeof e=="symbol"?e:e+""}function bg(n){"@babel/helpers - typeof";return bg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bg(n)}function vY(n,e){if(n){if(typeof n=="string")return e2(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?e2(n,e):void 0}}var nT=function(e){if(bg(e)!=="object")return e;var t=JP(e);if(t.props){var i;t.props=pY({},t.props),t!=null&&(i=t.props)!==null&&i!==void 0&&i.children&&(t.props.children=Array.isArray(t.props.children)?t.props.children.map(nT):nT(t.props.children))}return t},yY=function(e){return zP(JP(e))},xY=function(e,t){delete t.__k,uY(nT(e),t)};function SY(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}}var TY=`.float-tooltip-kap {
  position: absolute;
  width: max-content; /* prevent shrinking near right edge */
  max-width: max(50%, 150px);
  padding: 3px 5px;
  border-radius: 3px;
  font: 12px sans-serif;
  color: #eee;
  background: rgba(0,0,0,0.6);
  pointer-events: none;
}
`;SY(TY);var bY=am({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=i.style,s=r===void 0?{}:r,o=!!e&&bg(e)==="object"&&!!e.node&&typeof e.node=="function",a=eY(o?e.node():e);a.style("position")==="static"&&a.style("position","relative"),t.tooltipEl=a.append("div").attr("class","float-tooltip-kap"),Object.entries(s).forEach(function(u){var c=mY(u,2),h=c[0],d=c[1];return t.tooltipEl.style(h,d)}),t.tooltipEl.style("left","-10000px").style("display","none");var l="tooltip-".concat(Math.round(Math.random()*1e12));t.mouseInside=!1,a.on("mousemove.".concat(l),function(u){t.mouseInside=!0;var c=nY(u),h=a.node(),d=h.offsetWidth,f=h.offsetHeight,m=[t.offsetX===null||t.offsetX===void 0?"-".concat(c[0]/d*100,"%"):typeof t.offsetX=="number"?"calc(-50% + ".concat(t.offsetX,"px)"):t.offsetX,t.offsetY===null||t.offsetY===void 0?f>130&&f-c[1]<100?"calc(-100% - 6px)":"21px":typeof t.offsetY=="number"?t.offsetY<0?"calc(-100% - ".concat(Math.abs(t.offsetY),"px)"):"".concat(t.offsetY,"px"):t.offsetY];t.tooltipEl.style("left",c[0]+"px").style("top",c[1]+"px").style("transform","translate(".concat(m.join(","),")")),t.content&&t.tooltipEl.style("display","inline")}),a.on("mouseover.".concat(l),function(){t.mouseInside=!0,t.content&&t.tooltipEl.style("display","inline")}),a.on("mouseout.".concat(l),function(){t.mouseInside=!1,t.tooltipEl.style("display","none")})},update:function(e){e.tooltipEl.style("display",e.content&&e.mouseInside?"inline":"none"),e.content?e.content instanceof HTMLElement?(e.tooltipEl.text(""),e.tooltipEl.append(function(){return e.content})):typeof e.content=="string"?e.tooltipEl.html(e.content):yY(e.content)?(e.tooltipEl.text(""),xY(e.content,e.tooltipEl.node())):(e.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",e.content,e.content.toString())):e.tooltipEl.text("")}});function wY(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}}var MY=`.scene-nav-info {
  position: absolute;
  bottom: 5px;
  width: 100%;
  text-align: center;
  color: slategrey;
  opacity: 0.7;
  font-size: 10px;
  font-family: sans-serif;
  pointer-events: none;
  user-select: none;
}

.scene-container canvas:focus {
  outline: none;
}`;wY(MY);function iT(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function EY(n){if(Array.isArray(n))return n}function AY(n){if(Array.isArray(n))return iT(n)}function CY(n,e,t){return(e=UY(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function RY(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function NY(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,r,s,o,a=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(i=s.call(t)).done)&&(a.push(i.value),a.length!==e);l=!0);}catch(c){u=!0,r=c}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(u)throw r}}return a}}function PY(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DY(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LY(n,e){return EY(n)||NY(n,e)||n2(n,e)||PY()}function Od(n){return AY(n)||RY(n)||n2(n)||DY()}function IY(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function UY(n){var e=IY(n,"string");return typeof e=="symbol"?e:e+""}function n2(n,e){if(n){if(typeof n=="string")return iT(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?iT(n,e):void 0}}var Yt=window.THREE?window.THREE:{WebGLRenderer:JB,Scene:Hy,PerspectiveCamera:pi,Raycaster:VE,SRGBColorSpace:Be,TextureLoader:zU,Vector2:ce,Vector3:N,Box3:Da,Color:Ue,Mesh:On,SphereGeometry:Oh,MeshBasicMaterial:Ch,BackSide:$t,EventDispatcher:Ns,MOUSE:In,Quaternion:Dr,Spherical:a0,Clock:kE},i2=am({props:{width:{default:window.innerWidth,onChange:function(e,t,i){isNaN(e)&&(t.width=i)}},height:{default:window.innerHeight,onChange:function(e,t,i){isNaN(e)&&(t.height=i)}},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(e,t){t.hoverObj=null,t.tooltip&&t.tooltip.content(null)},triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},pointsHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(e){if(e.initialised){if(e.controls.update&&e.controls.update(Math.min(1,e.clock.getDelta())),e.postProcessingComposer?e.postProcessingComposer.render():e.renderer.render(e.scene,e.camera),e.extraRenderers.forEach(function(s){return s.render(e.scene,e.camera)}),e.enablePointerInteraction){var t=null;if(e.hoverDuringDrag||!e.isPointerDragging){var i=this.intersectingObjects(e.pointerPos.x,e.pointerPos.y);e.hoverOrderComparator&&i.sort(function(s,o){return e.hoverOrderComparator(s.object,o.object)});var r=i.find(function(s){return e.hoverFilter(s.object)})||null;t=r?r.object:null,e.intersection=r||null}t!==e.hoverObj&&(e.onHover(t,e.hoverObj,e.intersection),e.tooltip.content(t&&vt(e.tooltipContent)(t,e.intersection)||null),e.hoverObj=t)}e.tweenGroup.update()}return this},getPointerPos:function(e){var t=e.pointerPos,i=t.x,r=t.y;return{x:i,y:r}},cameraPosition:function(e,t,i,r){var s=e.camera;if(t&&e.initialised){var o=t,a=i||{x:0,y:0,z:0};if(!r)c(o),h(a);else{var l=Object.assign({},s.position),u=d();e.tweenGroup.add(new MP(l).to(o,r).easing(sl.Quadratic.Out).onUpdate(c).start()),e.tweenGroup.add(new MP(u).to(a,r/3).easing(sl.Quadratic.Out).onUpdate(h).start())}return this}return Object.assign({},s.position,{lookAt:d()});function c(f){var m=f.x,_=f.y,g=f.z;m!==void 0&&(s.position.x=m),_!==void 0&&(s.position.y=_),g!==void 0&&(s.position.z=g)}function h(f){var m=new Yt.Vector3(f.x,f.y,f.z);e.controls.target?e.controls.target=m:s.lookAt(m)}function d(){return Object.assign(new Yt.Vector3(0,0,-1e3).applyQuaternion(s.quaternion).add(s.position))}},zoomToFit:function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,r=arguments.length,s=new Array(r>3?r-3:0),o=3;o<r;o++)s[o-3]=arguments[o];return this.fitToBbox(this.getBbox.apply(this,s),t,i)},fitToBbox:function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:10,s=e.camera;if(t){var o=new Yt.Vector3(0,0,0),a=Math.max.apply(Math,Od(Object.entries(t).map(function(f){var m=LY(f,2),_=m[0],g=m[1];return Math.max.apply(Math,Od(g.map(function(p){return Math.abs(o[_]-p)})))})))*2,l=(1-r*2/e.height)*s.fov,u=a/Math.atan(l*Math.PI/180),c=u/s.aspect,h=Math.max(u,c);if(h>0){var d=o.clone().sub(s.position).normalize().multiplyScalar(-h);this.cameraPosition(d,o,i)}}return this},getBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},i=new Yt.Box3(new Yt.Vector3(0,0,0),new Yt.Vector3(0,0,0)),r=e.objects.filter(t);return r.length?(r.forEach(function(s){return i.expandByObject(s)}),Object.assign.apply(Object,Od(["x","y","z"].map(function(s){return CY({},s,[i.min[s],i.max[s]])})))):null},getScreenCoords:function(e,t,i,r){var s=new Yt.Vector3(t,i,r);return s.project(this.camera()),{x:(s.x+1)*e.width/2,y:-(s.y-1)*e.height/2}},getSceneCoords:function(e,t,i){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=new Yt.Vector2(t/e.width*2-1,-(i/e.height)*2+1),o=new Yt.Raycaster;return o.setFromCamera(s,e.camera),Object.assign({},o.ray.at(r,new Yt.Vector3))},intersectingObjects:function(e,t,i){var r=new Yt.Vector2(t/e.width*2-1,-(i/e.height)*2+1),s=new Yt.Raycaster;return s.params.Line.threshold=e.lineHoverPrecision,s.params.Points.threshold=e.pointsHoverPrecision,s.setFromCamera(r,e.camera),s.intersectObjects(e.objects,!0)},renderer:function(e){return e.renderer},scene:function(e){return e.scene},camera:function(e){return e.camera},postProcessingComposer:function(e){return e.postProcessingComposer},controls:function(e){return e.controls},tbControls:function(e){return e.controls}},stateInit:function(){return{scene:new Yt.Scene,camera:new Yt.PerspectiveCamera,clock:new Yt.Clock,tweenGroup:new wP}},init:function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=i.controlType,s=r===void 0?"trackball":r,o=i.useWebGPU,a=o===void 0?!1:o,l=i.rendererConfig,u=l===void 0?{}:l,c=i.extraRenderers,h=c===void 0?[]:c,d=i.waitForLoadComplete,f=d===void 0?!0:d;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.className="scene-container",t.container.style.position="relative",t.container.appendChild(t.navInfo=document.createElement("div")),t.navInfo.className="scene-nav-info",t.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[s]||"",t.navInfo.style.display=t.showNavInfo?null:"none",t.tooltip=new bY(t.container),t.pointerPos=new Yt.Vector2,t.pointerPos.x=-2,t.pointerPos.y=-2,["pointermove","pointerdown"].forEach(function(m){return t.container.addEventListener(m,function(_){if(m==="pointerdown"&&(t.isPointerPressed=!0),!t.isPointerDragging&&_.type==="pointermove"&&(_.pressure>0||t.isPointerPressed)&&(_.pointerType!=="touch"||_.movementX===void 0||[_.movementX,_.movementY].some(function(v){return Math.abs(v)>1}))&&(t.isPointerDragging=!0),t.enablePointerInteraction){var g=p(t.container);t.pointerPos.x=_.pageX-g.left,t.pointerPos.y=_.pageY-g.top}function p(v){var y=v.getBoundingClientRect(),x=window.pageXOffset||document.documentElement.scrollLeft,T=window.pageYOffset||document.documentElement.scrollTop;return{top:y.top+T,left:y.left+x}}},{passive:!0})}),t.container.addEventListener("pointerup",function(m){t.isPointerPressed=!1,!(t.isPointerDragging&&(t.isPointerDragging=!1,!t.clickAfterDrag))&&requestAnimationFrame(function(){m.button===0&&t.onClick(t.hoverObj||null,m,t.intersection),m.button===2&&t.onRightClick&&t.onRightClick(t.hoverObj||null,m,t.intersection)})},{passive:!0,capture:!0}),t.container.addEventListener("contextmenu",function(m){t.onRightClick&&m.preventDefault()}),t.renderer=new(a?Vj:Yt.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},u)),t.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),t.container.appendChild(t.renderer.domElement),t.extraRenderers=h,t.extraRenderers.forEach(function(m){m.domElement.style.position="absolute",m.domElement.style.top="0px",m.domElement.style.pointerEvents="none",t.container.appendChild(m.domElement)}),t.postProcessingComposer=new U7(t.renderer),t.postProcessingComposer.addPass(new F7(t.scene,t.camera)),t.controls=new{trackball:Wj,orbit:o7,fly:x7}[s](t.camera,t.renderer.domElement),s==="fly"&&(t.controls.movementSpeed=300,t.controls.rollSpeed=Math.PI/6,t.controls.dragToLook=!0),(s==="trackball"||s==="orbit")&&(t.controls.minDistance=.1,t.controls.maxDistance=t.skyRadius,t.controls.addEventListener("start",function(){t.controlsEngaged=!0}),t.controls.addEventListener("change",function(){t.controlsEngaged&&(t.controlsDragging=!0)}),t.controls.addEventListener("end",function(){t.controlsEngaged=!1,t.controlsDragging=!1})),[t.renderer,t.postProcessingComposer].concat(Od(t.extraRenderers)).forEach(function(m){return m.setSize(t.width,t.height)}),t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),t.camera.position.z=1e3,t.scene.add(t.skysphere=new Yt.Mesh),t.skysphere.visible=!1,t.loadComplete=t.scene.visible=!f,window.scene=t.scene},update:function(e,t){if(e.width&&e.height&&(t.hasOwnProperty("width")||t.hasOwnProperty("height"))&&(e.container.style.width="".concat(e.width,"px"),e.container.style.height="".concat(e.height,"px"),[e.renderer,e.postProcessingComposer].concat(Od(e.extraRenderers)).forEach(function(s){return s.setSize(e.width,e.height)}),e.camera.aspect=e.width/e.height,e.camera.updateProjectionMatrix()),t.hasOwnProperty("skyRadius")&&e.skyRadius&&(e.controls.hasOwnProperty("maxDistance")&&t.skyRadius&&(e.controls.maxDistance=Math.min(e.controls.maxDistance,e.skyRadius)),e.camera.far=e.skyRadius*2.5,e.camera.updateProjectionMatrix(),e.skysphere.geometry=new Yt.SphereGeometry(e.skyRadius)),t.hasOwnProperty("backgroundColor")){var i=ac(e.backgroundColor).alpha;i===void 0&&(i=1),e.renderer.setClearColor(new Yt.Color(fX(1,e.backgroundColor)),i)}t.hasOwnProperty("backgroundImageUrl")&&(e.backgroundImageUrl?new Yt.TextureLoader().load(e.backgroundImageUrl,function(s){s.colorSpace=Yt.SRGBColorSpace,e.skysphere.material=new Yt.MeshBasicMaterial({map:s,side:Yt.BackSide}),e.skysphere.visible=!0,e.onBackgroundImageLoaded&&setTimeout(e.onBackgroundImageLoaded),!e.loadComplete&&r()}):(e.skysphere.visible=!1,e.skysphere.material.map=null,!e.loadComplete&&r())),t.hasOwnProperty("showNavInfo")&&(e.navInfo.style.display=e.showNavInfo?null:"none"),t.hasOwnProperty("lights")&&((t.lights||[]).forEach(function(s){return e.scene.remove(s)}),e.lights.forEach(function(s){return e.scene.add(s)})),t.hasOwnProperty("objects")&&((t.objects||[]).forEach(function(s){return e.scene.remove(s)}),e.objects.forEach(function(s){return e.scene.add(s)}));function r(){e.loadComplete=e.scene.visible=!0}}});function FY(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}}var OY=`.graph-info-msg {
  top: 50%;
  width: 100%;
  text-align: center;
  color: lavender;
  opacity: 0.7;
  font-size: 22px;
  position: absolute;
  font-family: Sans-serif;
}

.scene-container .clickable {
  cursor: pointer;
}

.scene-container .grabbable {
  cursor: move;
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

.scene-container .grabbable:active {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
}`;FY(OY);function rT(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function BY(n){if(Array.isArray(n))return rT(n)}function Bd(n,e,t){return(e=VY(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function kY(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function zY(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function r2(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function wg(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?r2(Object(t),!0).forEach(function(i){Bd(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):r2(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function Mg(n){return BY(n)||kY(n)||HY(n)||zY()}function GY(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function VY(n){var e=GY(n,"string");return typeof e=="symbol"?e:e+""}function HY(n,e){if(n){if(typeof n=="string")return rT(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?rT(n,e):void 0}}function s2(n,e){var t=new e;return t._destructor&&t._destructor(),{linkProp:function(r){return{default:t[r](),onChange:function(o,a){a[n][r](o)},triggerUpdate:!1}},linkMethod:function(r){return function(s){for(var o=s[n],a=arguments.length,l=new Array(a>1?a-1:0),u=1;u<a;u++)l[u-1]=arguments[u];var c=o[r].apply(o,l);return c===o?this:c}}}}var sT=window.THREE?window.THREE:{AmbientLight:BE,DirectionalLight:OE,Vector3:N,REVISION:kl},WY=170,o2=s2("forceGraph",aC),$Y=Object.assign.apply(Object,Mg(["jsonUrl","graphData","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaDecay","d3VelocityDecay","d3AlphaMin","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map(function(n){return Bd({},n,o2.linkProp(n))}))),jY=Object.assign.apply(Object,Mg(["refresh","getGraphBbox","d3Force","d3ReheatSimulation","emitParticle"].map(function(n){return Bd({},n,o2.linkMethod(n))}))),Eg=s2("renderObjs",i2),XY=Object.assign.apply(Object,Mg(["width","height","backgroundColor","showNavInfo","enablePointerInteraction"].map(function(n){return Bd({},n,Eg.linkProp(n))}))),qY=Object.assign.apply(Object,Mg(["lights","cameraPosition","postProcessingComposer"].map(function(n){return Bd({},n,Eg.linkMethod(n))})).concat([{graph2ScreenCoords:Eg.linkMethod("getScreenCoords"),screen2GraphCoords:Eg.linkMethod("getSceneCoords")}])),YY=am({props:wg(wg({nodeLabel:{default:"name",triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:1,onChange:function(e,t){return t.renderObjs.lineHoverPrecision(e)},triggerUpdate:!1},enableNavigationControls:{default:!0,onChange:function(e,t){var i=t.renderObjs.controls();i&&(i.enabled=e,e&&i.domElement&&i.domElement.dispatchEvent(new PointerEvent("pointerup")))},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1}},$Y),XY),methods:wg(wg({zoomToFit:function(e,t,i){for(var r,s=arguments.length,o=new Array(s>3?s-3:0),a=3;a<s;a++)o[a-3]=arguments[a];return e.renderObjs.fitToBbox((r=e.forceGraph).getGraphBbox.apply(r,o),t,i),this},pauseAnimation:function(e){return e.animationFrameRequestId!==null&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),this},resumeAnimation:function(e){return e.animationFrameRequestId===null&&this._animationCycle(),this},_animationCycle:function(e){e.enablePointerInteraction&&(this.renderer().domElement.style.cursor=null),e.forceGraph.tickFrame(),e.renderObjs.tick(),e.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},scene:function(e){return e.renderObjs.scene()},camera:function(e){return e.renderObjs.camera()},renderer:function(e){return e.renderObjs.renderer()},controls:function(e){return e.renderObjs.controls()},tbControls:function(e){return e.renderObjs.tbControls()},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},jY),qY),stateInit:function(e){var t=e.controlType,i=e.rendererConfig,r=e.extraRenderers,s=new aC;return{forceGraph:s,renderObjs:i2({controlType:t,rendererConfig:i,extraRenderers:r}).objects([s]).lights([new sT.AmbientLight(13421772,Math.PI),new sT.DirectionalLight(16777215,.6*Math.PI)])}},init:function(e,t){e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.style.position="relative";var i=document.createElement("div");t.container.appendChild(i),t.renderObjs(i);var r=t.renderObjs.camera(),s=t.renderObjs.renderer(),o=t.renderObjs.controls();o.enabled=!!t.enableNavigationControls,t.lastSetCameraZ=r.position.z;var a;t.container.appendChild(a=document.createElement("div")),a.className="graph-info-msg",a.textContent="",t.forceGraph.onLoading(function(){a.textContent="Loading..."}).onFinishLoading(function(){a.textContent=""}).onUpdate(function(){t.graphData=t.forceGraph.graphData(),r.position.x===0&&r.position.y===0&&r.position.z===t.lastSetCameraZ&&t.graphData.nodes.length&&(r.lookAt(t.forceGraph.position),t.lastSetCameraZ=r.position.z=Math.cbrt(t.graphData.nodes.length)*WY)}).onFinishUpdate(function(){if(t._dragControls){var l=t.graphData.nodes.find(function(c){return c.__initialFixedPos&&!c.__disposeControlsAfterDrag});l?l.__disposeControlsAfterDrag=!0:t._dragControls.dispose(),t._dragControls=void 0}if(t.enableNodeDrag&&t.enablePointerInteraction&&t.forceEngine==="d3"){var u=t._dragControls=new ek(t.graphData.nodes.map(function(c){return c.__threeObj}).filter(function(c){return c}),r,s.domElement);u.addEventListener("dragstart",function(c){o.enabled=!1,c.object.__initialPos=c.object.position.clone(),c.object.__prevPos=c.object.position.clone();var h=ro(c.object).__data;!h.__initialFixedPos&&(h.__initialFixedPos={fx:h.fx,fy:h.fy,fz:h.fz}),!h.__initialPos&&(h.__initialPos={x:h.x,y:h.y,z:h.z}),["x","y","z"].forEach(function(d){return h["f".concat(d)]=h[d]}),s.domElement.classList.add("grabbable")}),u.addEventListener("drag",function(c){var h=ro(c.object);if(!c.object.hasOwnProperty("__graphObjType")){var d=c.object.__initialPos,f=c.object.__prevPos,m=c.object.position;h.position.add(m.clone().sub(f)),f.copy(m),m.copy(d)}var _=h.__data,g=h.position,p={x:g.x-_.x,y:g.y-_.y,z:g.z-_.z};["x","y","z"].forEach(function(v){return _["f".concat(v)]=_[v]=g[v]}),t.forceGraph.d3AlphaTarget(.3).resetCountdown(),_.__dragged=!0,t.onNodeDrag(_,p)}),u.addEventListener("dragend",function(c){delete c.object.__initialPos,delete c.object.__prevPos;var h=ro(c.object).__data;h.__disposeControlsAfterDrag&&(u.dispose(),delete h.__disposeControlsAfterDrag);var d=h.__initialFixedPos,f=h.__initialPos,m={x:f.x-h.x,y:f.y-h.y,z:f.z-h.z};d&&(["x","y","z"].forEach(function(_){var g="f".concat(_);d[g]===void 0&&delete h[g]}),delete h.__initialFixedPos,delete h.__initialPos,h.__dragged&&(delete h.__dragged,t.onNodeDragEnd(h,m))),t.forceGraph.d3AlphaTarget(0).resetCountdown(),t.enableNavigationControls&&(o.enabled=!0,o.domElement&&o.domElement.ownerDocument&&o.domElement.ownerDocument.dispatchEvent(new PointerEvent("pointerup",{pointerType:"touch"}))),s.domElement.classList.remove("grabbable")})}}),sT.REVISION<155&&(t.renderObjs.renderer().useLegacyLights=!1),t.renderObjs.hoverOrderComparator(function(l,u){var c=ro(l);if(!c)return 1;var h=ro(u);if(!h)return-1;var d=function(m){return m.__graphObjType==="node"};return d(h)-d(c)}).tooltipContent(function(l){var u=ro(l);return u&&vt(t["".concat(u.__graphObjType,"Label")])(u.__data)||""}).hoverDuringDrag(!1).onHover(function(l){var u=ro(l);if(u!==t.hoverObj){var c=t.hoverObj?t.hoverObj.__graphObjType:null,h=t.hoverObj?t.hoverObj.__data:null,d=u?u.__graphObjType:null,f=u?u.__data:null;if(c&&c!==d){var m=t["on".concat(c==="node"?"Node":"Link","Hover")];m&&m(null,h)}if(d){var _=t["on".concat(d==="node"?"Node":"Link","Hover")];_&&_(f,c===d?h:null)}s.domElement.classList[u&&t["on".concat(d==="node"?"Node":"Link","Click")]||!u&&t.onBackgroundClick?"add":"remove"]("clickable"),t.hoverObj=u}}).clickAfterDrag(!1).onClick(function(l,u){var c=ro(l);if(c){var h=t["on".concat(c.__graphObjType==="node"?"Node":"Link","Click")];h&&h(c.__data,u)}else t.onBackgroundClick&&t.onBackgroundClick(u)}).onRightClick(function(l,u){var c=ro(l);if(c){var h=t["on".concat(c.__graphObjType==="node"?"Node":"Link","RightClick")];h&&h(c.__data,u)}else t.onBackgroundRightClick&&t.onBackgroundRightClick(u)}),this._animationCycle()}});function ro(n){for(var e=n;e&&!e.hasOwnProperty("__graphObjType");)e=e.parent;return e}const oa={type:{enabled:!1,strength:.1,distance:100},author:{enabled:!0,strength:.2,distance:40},issue:{enabled:!0,strength:1,distance:20},visual:{width:.1,opacity:0,color:"#D7D7D7"},physics:{repulsion:{strength:-400,maxDistance:220},collision:{radius:1,strength:.6},centerForce:!0}};oa.physics.repulsion.strength,oa.physics.repulsion.maxDistance,oa.physics.collision.radius,oa.physics.collision.strength,oa.physics.centerForce;const a2=(n=oa)=>({TYPE:{STRENGTH:n.type.enabled?n.type.strength:0,DISTANCE:n.type.distance},AUTHOR:{STRENGTH:n.author.enabled?n.author.strength:0,DISTANCE:n.author.distance},ISSUE:{STRENGTH:n.issue.enabled?n.issue.strength:0,DISTANCE:n.issue.distance}}),KY=(n,e=oa)=>{const t=[];a2(e);const i={};n.forEach(o=>{i[o.type]||(i[o.type]=[]),i[o.type].push(o)}),e.type.enabled&&Object.entries(i).forEach(([o,a])=>{for(let l=0;l<a.length;l++)for(let u=l+1;u<a.length;u++)t.push({source:a[l].id,target:a[u].id,type:"type-link",linkType:o})});const r={};n.forEach(o=>{o.author&&(r[o.author]||(r[o.author]=[]),r[o.author].push(o))}),e.author.enabled&&Object.entries(r).forEach(([o,a])=>{for(let l=0;l<a.length;l++)for(let u=l+1;u<a.length;u++)t.push({source:a[l].id,target:a[u].id,type:"author-link",authorGroup:o})});const s={};return n.forEach(o=>{o.issue&&(s[o.issue]||(s[o.issue]=[]),s[o.issue].push(o))}),e.issue.enabled&&Object.entries(s).forEach(([o,a])=>{for(let l=0;l<a.length;l++)for(let u=l+1;u<a.length;u++)t.push({source:a[l].id,target:a[u].id,type:"issue-link",issueGroup:o})}),t},l2=[{id:"crash-course",topic:'A crash course in "crash course',title:'A crash course in "crash course',descriptor:"The Too-Often-Untold Story of The Totally Uncloneable Hank Green",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/66c35b57bfb182b3b38b3727_66c35791cdd6ab918c5e69ed_Art_3_Splash.avif",author:"nick-gaudio",issue:"com-1-august-2024",tags:"youtube; creators; opinion",type:"article",x:0,y:0,z:0},{id:"like-worth",topic:"What's a like on Instagram 'worth' in 2024?",title:"What's a like on Instagram 'worth' in 2024?",descriptor:"Actually More Than You'd Think!",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/66c35b656b4ad8437c28b691_66c357918e37552c6623c6e7_Art_1_Splash.avif",author:"nick-gaudio",issue:"com-1-august-2024",tags:"instagram; influencers; marketers; creators",type:"article",x:50,y:0,z:0},{id:"speed-sells",topic:"Speed sells: Why it's important to respond lickety-split",title:"Speed sells: Why it's important to respond lickety-split",descriptor:"",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/66c35b883ba1d3f499457b0c_66c357b16fde1d8a9b5a02c5_Art_2_Splash.avif",author:"nick-gaudio",issue:"com-1-august-2024",tags:"marketers; creators; influencers",type:"article",x:-50,y:0,z:0},{id:"survey-creators-psychology",topic:"Survey: reators feeling stress, stress, and careful curations",title:"Survey: reators feeling stress, stress, and careful curations",descriptor:"",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/66f1629c34ce3b4fd720b973_Art_5_Feature.avif",author:"dustin-dooling",issue:"com-2-sep-2024",tags:"creators; survey; trends",type:"article",x:0,y:50,z:0},{id:"creators-in-the-headlights",topic:"Creators in the Headlights: When Big Media Shifts Gears",title:"Creators in the Headlights: When Big Media Shifts Gears",descriptor:"",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/66f162b83bf5eee0c536fc52_Art_6_Feature.avif",author:"robert-hilliard",issue:"com-2-sep-2024",tags:"creators; youtube; news",type:"article",x:50,y:50,z:0},{id:"will-post-for-food",topic:"Will Post for Food",title:"Will Post for Food",descriptor:"",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/66f186f8ea579be24ac2dff4_Art_4_Feature_1.avif",author:"nick-gaudio",issue:"com-2-sep-2024",tags:"opinion; creators; instagram; trends",type:"article",x:-50,y:50,z:0},{id:"robots-red-lace",topic:"Robots & Red Lace",title:"Robots & Red Lace",descriptor:"How OnlyFans Creators Are Using AI for 'Intimacy at Scale'",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/671fa6b106217cf3b311fe44_Feature_A2-3.avif",author:"nick-gaudio",issue:"com-3-edition",tags:"instagram; influencers; creators; bot-builders",type:"article",x:0,y:-50,z:0},{id:"mr-least",topic:"From Mr. Beast to Mr. Least?",title:"From Mr. Beast to Mr. Least?",descriptor:"Lessons from creator to CEO (and the collateral damage along the way)",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/671fa5604eacaedf503f2cd6_Feature_A2-2.avif",author:"ashley-sava",issue:"com-3-edition",tags:"youtube; creators; influencers; news",type:"article",x:50,y:-50,z:0},{id:"parental-discretion-advised",topic:"Parental Discretion (Still) Advised",title:"Parental Discretion (Still) Advised",descriptor:"Going undercover with Instagram's new Teen Accounts",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/671fa6caa89e547b3bd93e0e_Feature_A3.avif",author:"dustin-dooling",issue:"com-3-edition",tags:"instagram; news; marketers; influencers",type:"article",x:-50,y:-50,z:0},{id:"email-doesnt-suck",topic:"It's 2024 and  Wait, Email Doesn't Suck?",title:"It's 2024 and  Wait, Email Doesn't Suck?",descriptor:"Creators, fans, and the strikingly powerful sticking power of getting an email address.",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/671fa6e6883fde668bb72aea_Feature_A5-1.avif",author:"nick-gaudio",issue:"com-3-edition",tags:"opinion; marketers; agencies",type:"article",x:25,y:25,z:25},{id:"cardboard-pizza",topic:"Cardboard Pizza: The Deadly Art of Losing Your Social Media Credibility",title:"Cardboard Pizza: The Deadly Art of Losing Your Social Media Credibility",descriptor:"",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/671fa7127645f993bf2f0470_Feature_A2-4.avif",author:"robert-hilliard",issue:"com-3-edition",tags:"influencers; opinion; trends",type:"article",x:-25,y:25,z:25},{id:"fur-ever-famous",topic:"Fur-Ever Famous",title:"Fur-Ever Famous",descriptor:"When Internet Pets Never (Officially) Die",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/6745a6b288a0d4961d7ec2a9_4_Feature_A1.avif",author:"robert-hilliard",issue:"november-issue",tags:"",type:"article",x:25,y:-25,z:25},{id:"engagement-dread",topic:"Engagement Dread: It's Not Your Fault (But It Kinda Is?)",title:"Engagement Dread: It's Not Your Fault (But It Kinda Is?)",descriptor:"",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/6745a74615e706bbc37165f8_4_Feature_A5.avif",author:"nick-gaudio",issue:"november-issue",tags:"",type:"article",x:-25,y:-25,z:25},{id:"still-posting",topic:"Still Posting Post-Death",title:"Still Posting Post-Death",descriptor:"The future of social: Too many zombies, not enough brains",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/6746f84a23ad26938dddd3c8_Feature_A3.avif",author:"dustin-dooling",issue:"november-issue",tags:"",type:"article",x:25,y:25,z:-25},{id:"mercy-kill",topic:"Mercy Kill Your Online Persona",title:"Mercy Kill Your Online Persona",descriptor:"A Step-by-Step Guide to Euthanizing Your Brand",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/6745a77d1aa6309002cd2f80_4_Feature_A4.avif",author:"ashley-sava",issue:"november-issue",tags:"",type:"article",x:-25,y:25,z:-25},{id:"prove-youre-human",topic:"Prove You're Human",title:"Prove You're Human",descriptor:"",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/6745a7bfefbafc1c8e5fc26d_4_Feature_A2.avif",author:"nick-gaudio",issue:"november-issue",tags:"",type:"article",x:25,y:-25,z:-25},{id:"creator-fortune",topic:"What's Your Creator Fortune?",title:"What's Your Creator Fortune?",descriptor:"Understanding Your Tarot Card Future for 2025",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/676aea529861bfd54580285b_Feature_A3com5.jpg",author:"ashley-sava",issue:"december-issue",tags:"quiz; creators; influencers",type:"special_project",x:-25,y:-25,z:-25},{id:"2025-bingo",topic:"That's Not On My Bingo Card: 2025 edition",title:"That's Not On My Bingo Card: 2025 edition",descriptor:"2025 edition",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/676aea64f1ad8bf1a6a48f0e_Feature_A4com5.jpg",author:"nick-gaudio",issue:"december-issue",tags:"",type:"special_project",x:0,y:0,z:50},{id:"parasocial-paradox",topic:"The Parasocial Paradox",title:"The Parasocial Paradox",descriptor:"The Flipside of Instagram Fame",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/676aea780211dcaef8d6a5fd_Feature_A1com5.jpg",author:"maria-valaikaite",issue:"december-issue",tags:"",type:"article",x:0,y:0,z:-50},{id:"influencers-peaked",topic:"Have Influencers Peaked?",title:"Have Influencers Peaked?",descriptor:"The Glittering Rise and the Quiet Plateau",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/676aead53185ee11f9b23527_Feature_A2com5-1.jpg",author:"robert-hilliard",issue:"december-issue",tags:"",type:"article",x:50,y:0,z:50},{id:"reasons-to-expand",topic:"Right & Wrong Reasons to Expand",title:"Right & Wrong Reasons to Expand",descriptor:"So you want to expand your social media empire? Let's talk about it.",imageUrl:"https://cdn.prod.website-files.com/66b0cbf53f3798cc2ace2b42/6797639025be2e8f0c27d2f7_Feature_A1.jpg",author:"ashley-sava",issue:"january-issue",tags:"",type:"article",x:-50,y:0,z:50}],QY={nodes:l2,links:KY(l2)},ZY=n=>n.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),JY=({selectedNode:n,onClose:e})=>{if(!n)return null;const t=n.tags?n.tags.split(";").map(i=>i.trim()):[];return rn.jsxs("div",{className:"com-fixed com-right-0 com-top-0 com-h-full com-w-80 com-bg-white/90 com-backdrop-blur-sm com-shadow-lg com-p-6 com-transform com-transition-transform com-duration-300 com-ease-in-out com-overflow-y-auto",children:[rn.jsx("button",{onClick:e,className:"com-absolute com-top-4 com-right-4 com-text-gray-500 hover:com-text-gray-700 com-text-xl",children:""}),rn.jsxs("div",{className:"com-mt-8 com-space-y-4",children:[rn.jsxs("div",{className:"com-flex com-flex-wrap com-gap-2",children:[rn.jsx("span",{className:`com-inline-block com-px-2 com-py-1 com-rounded-sm com-text-xs com-text-white com-font-medium cofo-sans-mono
            ${n.type==="article"?"com-bg-[#0057FF]":""}
            ${n.type==="youtube_video"?"com-bg-[#FD00FD]":""}
            ${n.type==="special_project"?"com-bg-[#FF4B00]":""}
          `,children:n.type.toUpperCase()}),t.length>0&&t.map((i,r)=>rn.jsx("span",{className:"com-inline-block com-px-2 com-py-1 com-bg-gray-800 com-text-white com-rounded-sm com-text-xs com-font-medium cofo-sans-mono",children:i.toUpperCase()},r))]}),n.imageUrl&&rn.jsx("img",{src:n.imageUrl,alt:n.title,className:"com-rounded-lg com-shadow-sm com-w-full com-object-cover com-aspect-video com-mb-4"}),rn.jsx("h2",{className:"com-text-xl com-font-semibold",children:n.title}),n.descriptor&&rn.jsx("div",{className:"com-text-sm com-text-gray-500 cofo-sans-mono",children:n.descriptor}),n.author&&rn.jsxs("div",{className:"com-text-sm com-text-gray-600",children:["by ",rn.jsx("span",{className:"com-font-medium",children:ZY(n.author)})]}),n.description&&rn.jsx("p",{className:"com-text-gray-600 com-text-sm com-leading-relaxed",children:n.description})]})]})},eK=({onZoomIn:n,onZoomOut:e,onReset:t})=>rn.jsxs("div",{className:"com-absolute com-bottom-6 com-left-6 com-flex com-gap-2",children:[rn.jsx("button",{onClick:n,className:"com-bg-white/90 com-backdrop-blur-sm com-p-2 com-rounded-lg com-shadow-md hover:com-bg-white com-transition-colors","aria-label":"Zoom in",children:"+"}),rn.jsx("button",{onClick:e,className:"com-bg-white/90 com-backdrop-blur-sm com-p-2 com-rounded-lg com-shadow-md hover:com-bg-white com-transition-colors","aria-label":"Zoom out",children:"-"}),rn.jsx("button",{onClick:t,className:"com-bg-white/90 com-backdrop-blur-sm com-px-3 com-py-2 com-rounded-lg com-shadow-md hover:com-bg-white com-transition-colors",children:"Reset"})]});var tK=T0("start","end","cancel","interrupt"),nK=[],u2=0,c2=1,oT=2,Ag=3,h2=4,aT=5,Cg=6;function Rg(n,e,t,i,r,s){var o=n.__transition;if(!o)n.__transition={};else if(t in o)return;iK(n,t,{name:e,index:i,group:r,on:tK,tween:nK,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:u2})}function lT(n,e){var t=$r(n,e);if(t.state>u2)throw new Error("too late; already scheduled");return t}function gs(n,e){var t=$r(n,e);if(t.state>Ag)throw new Error("too late; already running");return t}function $r(n,e){var t=n.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function iK(n,e,t){var i=n.__transition,r;i[e]=t,t.timer=w0(s,0,t.time);function s(u){t.state=c2,t.timer.restart(o,t.delay,t.time),t.delay<=u&&o(u-t.delay)}function o(u){var c,h,d,f;if(t.state!==c2)return l();for(c in i)if(f=i[c],f.name===t.name){if(f.state===Ag)return B1(o);f.state===h2?(f.state=Cg,f.timer.stop(),f.on.call("interrupt",n,n.__data__,f.index,f.group),delete i[c]):+c<e&&(f.state=Cg,f.timer.stop(),f.on.call("cancel",n,n.__data__,f.index,f.group),delete i[c])}if(B1(function(){t.state===Ag&&(t.state=h2,t.timer.restart(a,t.delay,t.time),a(u))}),t.state=oT,t.on.call("start",n,n.__data__,t.index,t.group),t.state===oT){for(t.state=Ag,r=new Array(d=t.tween.length),c=0,h=-1;c<d;++c)(f=t.tween[c].value.call(n,n.__data__,t.index,t.group))&&(r[++h]=f);r.length=h+1}}function a(u){for(var c=u<t.duration?t.ease.call(null,u/t.duration):(t.timer.restart(l),t.state=aT,1),h=-1,d=r.length;++h<d;)r[h].call(n,c);t.state===aT&&(t.on.call("end",n,n.__data__,t.index,t.group),l())}function l(){t.state=Cg,t.timer.stop(),delete i[e];for(var u in i)return;delete n.__transition}}function rK(n,e){var t=n.__transition,i,r,s=!0,o;if(t){e=e==null?null:e+"";for(o in t){if((i=t[o]).name!==e){s=!1;continue}r=i.state>oT&&i.state<aT,i.state=Cg,i.timer.stop(),i.on.call(r?"interrupt":"cancel",n,n.__data__,i.index,i.group),delete t[o]}s&&delete n.__transition}}function sK(n){return this.each(function(){rK(this,n)})}function oK(n,e){var t,i;return function(){var r=gs(this,n),s=r.tween;if(s!==t){i=t=s;for(var o=0,a=i.length;o<a;++o)if(i[o].name===e){i=i.slice(),i.splice(o,1);break}}r.tween=i}}function aK(n,e,t){var i,r;if(typeof t!="function")throw new Error;return function(){var s=gs(this,n),o=s.tween;if(o!==i){r=(i=o).slice();for(var a={name:e,value:t},l=0,u=r.length;l<u;++l)if(r[l].name===e){r[l]=a;break}l===u&&r.push(a)}s.tween=r}}function lK(n,e){var t=this._id;if(n+="",arguments.length<2){for(var i=$r(this.node(),t).tween,r=0,s=i.length,o;r<s;++r)if((o=i[r]).name===n)return o.value;return null}return this.each((e==null?oK:aK)(t,n,e))}function uT(n,e,t){var i=n._id;return n.each(function(){var r=gs(this,i);(r.value||(r.value={}))[e]=t.apply(this,arguments)}),function(r){return $r(r,i).value[e]}}function d2(n,e){var t;return(typeof e=="number"?Xo:e instanceof Zh?IA:(t=Zh(e))?(e=t,IA):E4)(n,e)}function uK(n){return function(){this.removeAttribute(n)}}function cK(n){return function(){this.removeAttributeNS(n.space,n.local)}}function hK(n,e,t){var i,r=t+"",s;return function(){var o=this.getAttribute(n);return o===r?null:o===i?s:s=e(i=o,t)}}function dK(n,e,t){var i,r=t+"",s;return function(){var o=this.getAttributeNS(n.space,n.local);return o===r?null:o===i?s:s=e(i=o,t)}}function fK(n,e,t){var i,r,s;return function(){var o,a=t(this),l;return a==null?void this.removeAttribute(n):(o=this.getAttribute(n),l=a+"",o===l?null:o===i&&l===r?s:(r=l,s=e(i=o,a)))}}function pK(n,e,t){var i,r,s;return function(){var o,a=t(this),l;return a==null?void this.removeAttributeNS(n.space,n.local):(o=this.getAttributeNS(n.space,n.local),l=a+"",o===l?null:o===i&&l===r?s:(r=l,s=e(i=o,a)))}}function mK(n,e){var t=_g(n),i=t==="transform"?N4:d2;return this.attrTween(n,typeof e=="function"?(t.local?pK:fK)(t,i,uT(this,"attr."+n,e)):e==null?(t.local?cK:uK)(t):(t.local?dK:hK)(t,i,e))}function gK(n,e){return function(t){this.setAttribute(n,e.call(this,t))}}function _K(n,e){return function(t){this.setAttributeNS(n.space,n.local,e.call(this,t))}}function vK(n,e){var t,i;function r(){var s=e.apply(this,arguments);return s!==i&&(t=(i=s)&&_K(n,s)),t}return r._value=e,r}function yK(n,e){var t,i;function r(){var s=e.apply(this,arguments);return s!==i&&(t=(i=s)&&gK(n,s)),t}return r._value=e,r}function xK(n,e){var t="attr."+n;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var i=_g(n);return this.tween(t,(i.local?vK:yK)(i,e))}function SK(n,e){return function(){lT(this,n).delay=+e.apply(this,arguments)}}function TK(n,e){return e=+e,function(){lT(this,n).delay=e}}function bK(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?SK:TK)(e,n)):$r(this.node(),e).delay}function wK(n,e){return function(){gs(this,n).duration=+e.apply(this,arguments)}}function MK(n,e){return e=+e,function(){gs(this,n).duration=e}}function EK(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?wK:MK)(e,n)):$r(this.node(),e).duration}function AK(n,e){if(typeof e!="function")throw new Error;return function(){gs(this,n).ease=e}}function CK(n){var e=this._id;return arguments.length?this.each(AK(e,n)):$r(this.node(),e).ease}function RK(n,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;gs(this,n).ease=t}}function NK(n){if(typeof n!="function")throw new Error;return this.each(RK(this._id,n))}function PK(n){typeof n!="function"&&(n=RP(n));for(var e=this._groups,t=e.length,i=new Array(t),r=0;r<t;++r)for(var s=e[r],o=s.length,a=i[r]=[],l,u=0;u<o;++u)(l=s[u])&&n.call(l,l.__data__,u,s)&&a.push(l);return new so(i,this._parents,this._name,this._id)}function DK(n){if(n._id!==this._id)throw new Error;for(var e=this._groups,t=n._groups,i=e.length,r=t.length,s=Math.min(i,r),o=new Array(i),a=0;a<s;++a)for(var l=e[a],u=t[a],c=l.length,h=o[a]=new Array(c),d,f=0;f<c;++f)(d=l[f]||u[f])&&(h[f]=d);for(;a<i;++a)o[a]=e[a];return new so(o,this._parents,this._name,this._id)}function LK(n){return(n+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function IK(n,e,t){var i,r,s=LK(e)?lT:gs;return function(){var o=s(this,n),a=o.on;a!==i&&(r=(i=a).copy()).on(e,t),o.on=r}}function UK(n,e){var t=this._id;return arguments.length<2?$r(this.node(),t).on.on(n):this.each(IK(t,n,e))}function FK(n){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==n)return;e&&e.removeChild(this)}}function OK(){return this.on("end.remove",FK(this._id))}function BK(n){var e=this._name,t=this._id;typeof n!="function"&&(n=jS(n));for(var i=this._groups,r=i.length,s=new Array(r),o=0;o<r;++o)for(var a=i[o],l=a.length,u=s[o]=new Array(l),c,h,d=0;d<l;++d)(c=a[d])&&(h=n.call(c,c.__data__,d,a))&&("__data__"in c&&(h.__data__=c.__data__),u[d]=h,Rg(u[d],e,t,d,u,$r(c,t)));return new so(s,this._parents,e,t)}function kK(n){var e=this._name,t=this._id;typeof n!="function"&&(n=CP(n));for(var i=this._groups,r=i.length,s=[],o=[],a=0;a<r;++a)for(var l=i[a],u=l.length,c,h=0;h<u;++h)if(c=l[h]){for(var d=n.call(c,c.__data__,h,l),f,m=$r(c,t),_=0,g=d.length;_<g;++_)(f=d[_])&&Rg(f,e,t,_,d,m);s.push(d),o.push(c)}return new so(s,o,e,t)}var zK=Ld.prototype.constructor;function GK(){return new zK(this._groups,this._parents)}function VK(n,e){var t,i,r;return function(){var s=cc(this,n),o=(this.style.removeProperty(n),cc(this,n));return s===o?null:s===t&&o===i?r:r=e(t=s,i=o)}}function f2(n){return function(){this.style.removeProperty(n)}}function HK(n,e,t){var i,r=t+"",s;return function(){var o=cc(this,n);return o===r?null:o===i?s:s=e(i=o,t)}}function WK(n,e,t){var i,r,s;return function(){var o=cc(this,n),a=t(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(n),cc(this,n))),o===l?null:o===i&&l===r?s:(r=l,s=e(i=o,a))}}function $K(n,e){var t,i,r,s="style."+e,o="end."+s,a;return function(){var l=gs(this,n),u=l.on,c=l.value[s]==null?a||(a=f2(e)):void 0;(u!==t||r!==c)&&(i=(t=u).copy()).on(o,r=c),l.on=i}}function jK(n,e,t){var i=(n+="")=="transform"?R4:d2;return e==null?this.styleTween(n,VK(n,i)).on("end.style."+n,f2(n)):typeof e=="function"?this.styleTween(n,WK(n,i,uT(this,"style."+n,e))).each($K(this._id,n)):this.styleTween(n,HK(n,i,e),t).on("end.style."+n,null)}function XK(n,e,t){return function(i){this.style.setProperty(n,e.call(this,i),t)}}function qK(n,e,t){var i,r;function s(){var o=e.apply(this,arguments);return o!==r&&(i=(r=o)&&XK(n,o,t)),i}return s._value=e,s}function YK(n,e,t){var i="style."+(n+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,qK(n,e,t??""))}function KK(n){return function(){this.textContent=n}}function QK(n){return function(){var e=n(this);this.textContent=e??""}}function ZK(n){return this.tween("text",typeof n=="function"?QK(uT(this,"text",n)):KK(n==null?"":n+""))}function JK(n){return function(e){this.textContent=n.call(this,e)}}function eQ(n){var e,t;function i(){var r=n.apply(this,arguments);return r!==t&&(e=(t=r)&&JK(r)),e}return i._value=n,i}function tQ(n){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;return this.tween(e,eQ(n))}function nQ(){for(var n=this._name,e=this._id,t=p2(),i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],a=o.length,l,u=0;u<a;++u)if(l=o[u]){var c=$r(l,e);Rg(l,n,t,u,o,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new so(i,this._parents,n,t)}function iQ(){var n,e,t=this,i=t._id,r=t.size();return new Promise(function(s,o){var a={value:o},l={value:function(){--r===0&&s()}};t.each(function(){var u=gs(this,i),c=u.on;c!==n&&(e=(n=c).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),u.on=e}),r===0&&s()})}var rQ=0;function so(n,e,t,i){this._groups=n,this._parents=e,this._name=t,this._id=i}function p2(){return++rQ}var oo=Ld.prototype;so.prototype={constructor:so,select:BK,selectAll:kK,selectChild:oo.selectChild,selectChildren:oo.selectChildren,filter:PK,merge:DK,selection:GK,transition:nQ,call:oo.call,nodes:oo.nodes,node:oo.node,size:oo.size,empty:oo.empty,each:oo.each,on:UK,attr:mK,attrTween:xK,style:jK,styleTween:YK,text:ZK,textTween:tQ,remove:OK,tween:lK,delay:bK,duration:EK,ease:CK,easeVarying:NK,end:iQ,[Symbol.iterator]:oo[Symbol.iterator]};function sQ(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var oQ={time:null,delay:0,duration:250,ease:sQ};function aQ(n,e){for(var t;!(t=n.__transition)||!(t=t[e]);)if(!(n=n.parentNode))throw new Error(`transition ${e} not found`);return t}function lQ(n){var e,t;n instanceof so?(e=n._id,n=n._name):(e=p2(),(t=oQ).time=b0(),n=n==null?null:n+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],a=o.length,l,u=0;u<a;++u)(l=o[u])&&Rg(l,n,e,u,o,t||aQ(l,e));return new so(i,this._parents,n,e)}Ld.prototype.interrupt=sK,Ld.prototype.transition=lQ;function uQ(n,e){var t,i=1;n==null&&(n=0),e==null&&(e=0);function r(){var s,o=t.length,a,l=0,u=0;for(s=0;s<o;++s)a=t[s],l+=a.x,u+=a.y;for(l=(l/o-n)*i,u=(u/o-e)*i,s=0;s<o;++s)a=t[s],a.x-=l,a.y-=u}return r.initialize=function(s){t=s},r.x=function(s){return arguments.length?(n=+s,r):n},r.y=function(s){return arguments.length?(e=+s,r):e},r.strength=function(s){return arguments.length?(i=+s,r):i},r}function al(n){return function(){return n}}function aa(n){return(n()-.5)*1e-6}function cQ(n){return n.x+n.vx}function hQ(n){return n.y+n.vy}function dQ(n){var e,t,i,r=1,s=1;typeof n!="function"&&(n=al(n==null?1:+n));function o(){for(var u,c=e.length,h,d,f,m,_,g,p=0;p<s;++p)for(h=Jp(e,cQ,hQ).visitAfter(a),u=0;u<c;++u)d=e[u],_=t[d.index],g=_*_,f=d.x+d.vx,m=d.y+d.vy,h.visit(v);function v(y,x,T,S,w){var E=y.data,M=y.r,b=_+M;if(E){if(E.index>d.index){var R=f-E.x-E.vx,I=m-E.y-E.vy,B=R*R+I*I;B<b*b&&(R===0&&(R=aa(i),B+=R*R),I===0&&(I=aa(i),B+=I*I),B=(b-(B=Math.sqrt(B)))/B*r,d.vx+=(R*=B)*(b=(M*=M)/(g+M)),d.vy+=(I*=B)*b,E.vx-=R*(b=1-b),E.vy-=I*b)}return}return x>f+b||S<f-b||T>m+b||w<m-b}}function a(u){if(u.data)return u.r=t[u.data.index];for(var c=u.r=0;c<4;++c)u[c]&&u[c].r>u.r&&(u.r=u[c].r)}function l(){if(e){var u,c=e.length,h;for(t=new Array(c),u=0;u<c;++u)h=e[u],t[h.index]=+n(h,u,e)}}return o.initialize=function(u,c){e=u,i=c,l()},o.iterations=function(u){return arguments.length?(s=+u,o):s},o.strength=function(u){return arguments.length?(r=+u,o):r},o.radius=function(u){return arguments.length?(n=typeof u=="function"?u:al(+u),l(),o):n},o}function fQ(n){return n.index}function m2(n,e){var t=n.get(e);if(!t)throw new Error("node not found: "+e);return t}function pQ(n){var e=fQ,t=h,i,r=al(30),s,o,a,l,u,c=1;n==null&&(n=[]);function h(g){return 1/Math.min(a[g.source.index],a[g.target.index])}function d(g){for(var p=0,v=n.length;p<c;++p)for(var y=0,x,T,S,w,E,M,b;y<v;++y)x=n[y],T=x.source,S=x.target,w=S.x+S.vx-T.x-T.vx||aa(u),E=S.y+S.vy-T.y-T.vy||aa(u),M=Math.sqrt(w*w+E*E),M=(M-s[y])/M*g*i[y],w*=M,E*=M,S.vx-=w*(b=l[y]),S.vy-=E*b,T.vx+=w*(b=1-b),T.vy+=E*b}function f(){if(o){var g,p=o.length,v=n.length,y=new Map(o.map((T,S)=>[e(T,S,o),T])),x;for(g=0,a=new Array(p);g<v;++g)x=n[g],x.index=g,typeof x.source!="object"&&(x.source=m2(y,x.source)),typeof x.target!="object"&&(x.target=m2(y,x.target)),a[x.source.index]=(a[x.source.index]||0)+1,a[x.target.index]=(a[x.target.index]||0)+1;for(g=0,l=new Array(v);g<v;++g)x=n[g],l[g]=a[x.source.index]/(a[x.source.index]+a[x.target.index]);i=new Array(v),m(),s=new Array(v),_()}}function m(){if(o)for(var g=0,p=n.length;g<p;++g)i[g]=+t(n[g],g,n)}function _(){if(o)for(var g=0,p=n.length;g<p;++g)s[g]=+r(n[g],g,n)}return d.initialize=function(g,p){o=g,u=p,f()},d.links=function(g){return arguments.length?(n=g,f(),d):n},d.id=function(g){return arguments.length?(e=g,d):e},d.iterations=function(g){return arguments.length?(c=+g,d):c},d.strength=function(g){return arguments.length?(t=typeof g=="function"?g:al(+g),m(),d):t},d.distance=function(g){return arguments.length?(r=typeof g=="function"?g:al(+g),_(),d):r},d}function mQ(n){return n.x}function gQ(n){return n.y}function _Q(){var n,e,t,i,r=al(-30),s,o=1,a=1/0,l=.81;function u(f){var m,_=n.length,g=Jp(n,mQ,gQ).visitAfter(h);for(i=f,m=0;m<_;++m)e=n[m],g.visit(d)}function c(){if(n){var f,m=n.length,_;for(s=new Array(m),f=0;f<m;++f)_=n[f],s[_.index]=+r(_,f,n)}}function h(f){var m=0,_,g,p=0,v,y,x;if(f.length){for(v=y=x=0;x<4;++x)(_=f[x])&&(g=Math.abs(_.value))&&(m+=_.value,p+=g,v+=g*_.x,y+=g*_.y);f.x=v/p,f.y=y/p}else{_=f,_.x=_.data.x,_.y=_.data.y;do m+=s[_.data.index];while(_=_.next)}f.value=m}function d(f,m,_,g){if(!f.value)return!0;var p=f.x-e.x,v=f.y-e.y,y=g-m,x=p*p+v*v;if(y*y/l<x)return x<a&&(p===0&&(p=aa(t),x+=p*p),v===0&&(v=aa(t),x+=v*v),x<o&&(x=Math.sqrt(o*x)),e.vx+=p*f.value*i/x,e.vy+=v*f.value*i/x),!0;if(f.length||x>=a)return;(f.data!==e||f.next)&&(p===0&&(p=aa(t),x+=p*p),v===0&&(v=aa(t),x+=v*v),x<o&&(x=Math.sqrt(o*x)));do f.data!==e&&(y=s[f.data.index]*i/x,e.vx+=p*y,e.vy+=v*y);while(f=f.next)}return u.initialize=function(f,m){n=f,t=m,c()},u.strength=function(f){return arguments.length?(r=typeof f=="function"?f:al(+f),c(),u):r},u.distanceMin=function(f){return arguments.length?(o=f*f,u):Math.sqrt(o)},u.distanceMax=function(f){return arguments.length?(a=f*f,u):Math.sqrt(a)},u.theta=function(f){return arguments.length?(l=f*f,u):Math.sqrt(l)},u}function kd(n,e,t){this.k=n,this.x=e,this.y=t}kd.prototype={constructor:kd,scale:function(n){return n===1?this:new kd(this.k*n,this.x,this.y)},translate:function(n,e){return n===0&e===0?this:new kd(this.k,this.x+this.k*n,this.y+this.k*e)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},kd.prototype;const vQ=()=>{const n=_s.useRef(null),e=_s.useRef(null),t=_s.useRef(null),[i,r]=_s.useState(null),[s,o]=_s.useState(oa);_s.useEffect(()=>{if(!n.current)return;const c=document.createElement("div");c.className="tooltip",document.body.appendChild(c),t.current=c;const h=a2(s),d=YY()(n.current).backgroundColor("rgba(0,0,0,0)").graphData(QY).nodeLabel(null).nodeColor(_=>{switch(_.type){case"article":return"#0057FF";case"youtube_video":return"#FD00FD";case"special_project":return"#FF4B00";default:return"#999"}}).d3Force("link",pQ().id(_=>_.id).distance(_=>{switch(_.type){case"type-link":return h.TYPE.DISTANCE;case"author-link":return h.AUTHOR.DISTANCE;case"issue-link":return h.ISSUE.DISTANCE;default:return 80}}).strength(_=>{switch(_.type){case"type-link":return h.TYPE.STRENGTH;case"author-link":return h.AUTHOR.STRENGTH;case"issue-link":return h.ISSUE.STRENGTH;default:return .6}})).linkColor(()=>s.visual.color).linkWidth(()=>s.visual.width).linkOpacity(s.visual.opacity).d3Force("charge",_Q().strength(s.physics.repulsion.strength).distanceMax(s.physics.repulsion.maxDistance)).d3Force("collision",dQ().radius(s.physics.collision.radius).strength(s.physics.collision.strength)).d3Force("center",s.physics.centerForce?uQ():null).nodeRelSize(6).nodeThreeObject(_=>{const g=document.createElement("canvas"),p=g.getContext("2d"),v=new Image;g.width=1024,g.height=Math.round(1024*(9/16));const x=Math.round(g.width*.1),T=new dU(g);T.minFilter=ci,T.magFilter=mn,T.anisotropy=16,T.colorSpace=Be,T.generateMipmaps=!0;const S=new $y({map:T,transparent:!0,depthWrite:!0,sizeAttenuation:!0}),w=new rU(S),E=24,M=E*(9/16);return w.scale.set(E,M,1),v.crossOrigin="Anonymous",v.onload=()=>{p&&(p.clearRect(0,0,g.width,g.height),p.imageSmoothingEnabled=!0,p.imageSmoothingQuality="high",p.beginPath(),p.roundRect(0,0,g.width,g.height,x),p.clip(),p.drawImage(v,0,0,g.width,g.height),T.needsUpdate=!0)},v.src=_.imageUrl,w}).onNodeClick(_=>{r(_);const p=1+40/Math.hypot(_.x,_.y,_.z);e.current.cameraPosition({x:_.x*p,y:_.y*p,z:_.z*p},_,3e3)}).onNodeHover(_=>{if(t.current)if(_){const g=d.graph2ScreenCoords(_.x,_.y,_.z);switch(t.current.style.display="block",t.current.style.left=`${g.x}px`,t.current.style.top=`${g.y-10}px`,t.current.textContent=_.title.toUpperCase(),_.type){case"article":t.current.style.backgroundColor="#0057FF";break;case"youtube_video":t.current.style.backgroundColor="#FD00FD";break;case"special_project":t.current.style.backgroundColor="#FF4B00";break;default:t.current.style.backgroundColor="#999"}t.current.style.color="#FFFFFF",t.current.style.padding="2px 6px",t.current.style.borderRadius="4px",t.current.style.fontSize="14px",t.current.style.fontWeight="500",t.current.style.whiteSpace="nowrap",t.current.style.zIndex="1000",t.current.style.transition="all 0.2s ease"}else t.current.style.display="none"}),f=d.renderer();f.setClearAlpha(0),f.setPixelRatio(window.devicePixelRatio),f.setClearColor(0,0),f.alpha=!0,d.controls().enableDamping=!0,d.controls().dampingFactor=.1,d.controls().rotateSpeed=.8,e.current=d;const m=()=>{var _,g;d.width(((_=n.current)==null?void 0:_.clientWidth)??window.innerWidth),d.height(((g=n.current)==null?void 0:g.clientHeight)??window.innerHeight)};return window.addEventListener("resize",m),()=>{window.removeEventListener("resize",m),t.current&&document.body.removeChild(t.current),d._destructor()}},[]);const a=()=>{if(e.current){const c=e.current.camera().position.z;e.current.cameraPosition({z:c*.8})}},l=()=>{if(e.current){const c=e.current.camera().position.z;e.current.cameraPosition({z:c*1.2})}},u=()=>{e.current&&e.current.cameraPosition({x:0,y:0,z:200},{x:0,y:0,z:0},1e3)};return rn.jsxs("div",{className:"relative w-full h-screen",children:[rn.jsx("div",{ref:n,className:"w-full h-full"}),rn.jsx(eK,{onZoomIn:a,onZoomOut:l,onReset:u}),i&&rn.jsx(JY,{selectedNode:i,onClose:()=>r(null)})]})};function yQ(){document.querySelector("style[data-tailwind]")&&console.warn("Found existing Tailwind styles. Widget styles might conflict."),document.querySelector("style[data-mui]")&&console.warn("Found existing MUI styles. Widget styles might conflict.")}function xQ(n){return n.classList.add("com-widget-root"),yQ(),()=>{n.classList.remove("com-widget-root")}}function g2(n="root"){const e=document.getElementById(n);if(!e){console.error(`Container with id "${n}" not found`);return}if(e.hasAttribute("data-widget-initialized")){console.warn(`Widget already initialized in container "${n}"`);return}try{const t=xQ(e),i=DM(e);return i.render(rn.jsx(k2.StrictMode,{children:rn.jsx(vQ,{})})),e.setAttribute("data-widget-initialized","true"),{destroy:()=>{i.unmount(),t(),e.removeAttribute("data-widget-initialized")}}}catch(t){return console.error("Failed to initialize widget:",t),null}}window.ComWidget={init:g2},document.getElementById("root")&&g2()})();
//# sourceMappingURL=widget.js.map
